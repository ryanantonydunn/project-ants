var config = config || {};
config.animations = {
  "ant-body-hit": [
    "ant-body-hit-1",
    "ant-body-hit-2",
    "ant-body-hit-1",
    "ant-body-hit-3"
  ],
  "ant-body-still-left": ["ant-body-walk-left-1"],
  "ant-body-still-right": ["ant-body-walk-right-1"],
  "ant-body-walk-left": [
    "ant-body-walk-left-2",
    "ant-body-walk-left-3",
    "ant-body-walk-left-4",
    "ant-body-walk-left-5"
  ],
  "ant-body-walk-right": [
    "ant-body-walk-right-2",
    "ant-body-walk-right-3",
    "ant-body-walk-right-4",
    "ant-body-walk-right-5"
  ],
  "ant-head-left": [
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-2",
    "ant-head-left-3",
    "ant-head-left-2"
  ],
  "ant-head-right": [
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-2",
    "ant-head-right-3",
    "ant-head-right-2"
  ],
  "ant-head-hit": ["ant-head-hit-1", "ant-head-hit-2", "ant-head-hit-3"],
  "ant-weapon-bazooka-left": ["ant-weapon-bazooka-left"],
  "ant-weapon-bazooka-right": ["ant-weapon-bazooka-right"],
  "ant-weapon-laser-left": ["ant-weapon-laser-left"],
  "ant-weapon-laser-right": ["ant-weapon-laser-right"],
  "ant-weapon-throw-left": ["ant-weapon-throw-left-1"],
  "ant-weapon-throw-fire-left": [
    "ant-weapon-throw-left-2",
    "ant-weapon-throw-left-3",
    "ant-weapon-throw-left-4",
    "ant-weapon-throw-left-5",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1"
  ],
  "ant-weapon-throw-right": ["ant-weapon-throw-right-1"],
  "ant-weapon-throw-fire-right": [
    "ant-weapon-throw-right-2",
    "ant-weapon-throw-right-3",
    "ant-weapon-throw-right-4",
    "ant-weapon-throw-right-5",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1"
  ],
  "ant-weapon-dig-left": ["ant-weapon-dig-left-1"],
  "ant-weapon-dig-fire-left": [
    "ant-weapon-dig-left-2",
    "ant-weapon-dig-left-3",
    "ant-weapon-dig-left-4"
  ],
  "ant-weapon-dig-right": ["ant-weapon-dig-right-1"],
  "ant-weapon-dig-fire-right": [
    "ant-weapon-dig-right-2",
    "ant-weapon-dig-right-3",
    "ant-weapon-dig-right-4"
  ],
  "ant-ghost": [
    "ant-ghost-1",
    "ant-ghost-1",
    "ant-ghost-2",
    "ant-ghost-2",
    "ant-ghost-3",
    "ant-ghost-3",
    "ant-ghost-2",
    "ant-ghost-2"
  ],
  "bubble-blue": [
    "ball-blue-1",
    "ball-blue-2",
    "ball-blue-3",
    "ball-blue-4",
    "ball-blue-5"
  ],
  "explosion-l": [
    "explosion-l-1",
    "explosion-l-2",
    "explosion-l-3",
    "explosion-l-4",
    "explosion-l-5",
    "explosion-l-6",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion2-l": [
    "explosion2-l-1",
    "explosion2-l-2",
    "explosion2-l-3",
    "explosion2-l-4",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion-green-l": [
    "explosion-green-l-1",
    "explosion-green-l-2",
    "explosion-green-l-3",
    "explosion-green-l-4",
    "explosion-green-l-5",
    "explosion-green-l-6",
    "explosion-green-l-7",
    "explosion-green-l-8"
  ],
  "explosion-laser-blue": [
    "explosion-laser-blue-1",
    "explosion-laser-blue-2",
    "explosion-laser-blue-3",
    "explosion-laser-blue-4",
    "explosion-laser-blue-5"
  ],
  flame: ["flame-1", "flame-2", "flame-3", "flame-4", "flame-5"],
  "flame-large": [
    "flame-large-1",
    "flame-large-2",
    "flame-large-3",
    "flame-large-4",
    "flame-large-5",
    "flame-large-6"
  ],
  focus: [
    "focus-1",
    "focus-2",
    "focus-3",
    "focus-4",
    "focus-5",
    "focus-6",
    "focus-7",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8"
  ],
  "gem-green": [
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-2",
    "gem-green-3",
    "gem-green-4"
  ],
  "gem-blue": [
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-2",
    "gem-blue-3",
    "gem-blue-4"
  ],
  "gem-red": [
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-2",
    "gem-red-3",
    "gem-red-4"
  ],
  "gem-purple": [
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-2",
    "gem-purple-3",
    "gem-purple-4"
  ],
  "gem-silver": [
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-2",
    "gem-silver-3",
    "gem-silver-4"
  ],
  "grenade-armed": [
    "grenade-green",
    "grenade-red",
    "grenade-red",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green"
  ],
  "mine-active": [
    "mine-red",
    "mine-red",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey"
  ],
  "smoke-green": [
    "smoke-green-1",
    "smoke-green-2",
    "smoke-green-3",
    "smoke-green-4",
    "smoke-green-5",
    "smoke-green-6",
    "smoke-green-7",
    "smoke-green-8"
  ],
  teleport: [
    "teleport-1",
    "teleport-2",
    "teleport-3",
    "teleport-4",
    "teleport-5",
    "teleport-6",
    "teleport-7"
  ],
  vortex: [
    "vortex-1",
    "vortex-2",
    "vortex-3",
    "vortex-4",
    "vortex-5",
    "vortex-6",
    "vortex-7",
    "vortex-8",
    "vortex-10",
    "vortex-11"
  ]
};

var config = config || {};
config.mapgen = {
  land_type: [
    {
      edge: 1,
      bg: "dirt",
      fg: "rock",
      decorations: {
        "1": [
          {
            x: 432,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 468,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 504,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 540,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 576,
            y: 0,
            w: 36,
            h: 72
          }
        ],
        "2": [
          {
            x: 0,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 72,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 144,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 216,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 288,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 360,
            y: 0,
            w: 72,
            h: 72
          }
        ]
      }
    }
  ]
};

var config = config || {};
config.names = [
  "Dave Lister",
  "Ace Rimmer",
  "Queeg 500",
  "Abradolf Lincler",
  "Beardless Riker",
  "The Ant With No Name",
  "Al Capone",
  "The Queen",
  "Mickey Eyes"
];

var config = config || {};
config.objects = {
  default: {
    size: 1,
    weight: 0,
    bounce: 0.4,
    timeout: 0,
    damage: 30,
    knock: 1,
    spawn: false,
    player_lock: false,
    launch_distance: 2,
    destroy_ground: true,
    stop: 0,
    ignore_level_damage: false,
    events: {
      frame: "",
      ground: "",
      object: "",
      explosion: "",
      die: ""
    },
    object_events: {},
    speed: {
      max_gravity: 30,
      max: 40,
      move: 4,
      jump: 10
    },
    cluster: {
      circle: true,
      object: "grenade",
      speed: 2,
      count: 6
    },
    animation: {
      explosion: "explosion-l",
      sprite: "",
      air_spin: false,
      air_float: false,
      static_angle: false,
      ground: false
    },
    audio: {
      explosion: "explosion",
      bounce: "donk",
      hit: "",
      air: "",
      walk: "walk"
    },
    labels: {
      player_health: false,
      player_name: false,
      timeout: false
    },
    trails: {
      count: 0,
      speed: 0.6,
      offset_x: 0,
      offset_y: 0,
      timeout: 0,
      rotate: false,
      move: true,
      sprite: ""
    }
  },
  player: {
    size: 12,
    weight: 0.7,
    bounce: 0.7,
    events: {
      ground: "player_bounce",
      explosion: "hit_receive"
    },
    object_events: {
      crate: "collect",
      medpack: "collect",
      "gem-1": "collect",
      "gem-5": "collect",
      "gem-20": "collect",
      "gem-50": "collect",
      "gem-200": "collect",
      vortex: "collect"
    },
    animation: {
      sprite: "ant-body",
      air_spin: false,
      ground: false
    },
    audio: {
      bounce: "doink",
      explosion: "pop"
    },
    labels: {
      player_health: true,
      player_name: true
    }
  },
  player_missile: {
    size: 12,
    weight: 0.7,
    damage: 50,
    events: {
      ground: ["bounce_explode", "spawn_ghost"],
      explosion: ["bounce_explode", "spawn_ghost"]
    },
    object_events: {
      player: ["bounce_explode", "spawn_ghost"]
    },
    animation: {
      sprite: "ant-bomb",
      air_spin: true
    },
    labels: {
      player_name: true
    },
    trails: {
      count: 2,
      speed: 0.6,
      timeout: 10,
      sprite: "ball-red"
    }
  },
  player_ghost: {
    size: 12,
    weight: 0,
    damage: 1,
    knock: 0,
    events: {
      object: "hit_receive",
      explosion: "hit_receive"
    },
    object_events: {
      player: "hit_give"
    },
    speed: {
      max: 2.5,
      move: 0.3
    },
    animation: {
      sprite: "ant-ghost",
      air_float: true
    },
    labels: {
      player_name: true
    }
  },
  crate: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-weapon",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-blue"
    }
  },
  medpack: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-health",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-red"
    }
  },
  "gem-1": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-green",
      static_angle: true,
      air_float: true
    }
  },
  "gem-5": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-blue",
      static_angle: true,
      air_float: true
    }
  },
  "gem-20": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-red",
      static_angle: true,
      air_float: true
    }
  },
  "gem-50": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-purple",
      static_angle: true,
      air_float: true
    }
  },
  "gem-200": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-silver",
      static_angle: true,
      air_float: true
    }
  },
  vortex: {
    size: 22,
    animation: {
      sprite: "vortex"
    }
  },
  target: {
    size: 22,
    damage: 0,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion-laser-blue",
      sprite: "target",
      air_float: true
    },
    audio: {
      explosion: "pop",
      air: "none"
    }
  },
  nuclear: {
    size: 22,
    damage: 100,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    animation: {
      explosion: "explosion-green-l",
      sprite: "nuclear",
      air_float: true
    },
    audio: {
      explosion: "explosion_gas",
      air: "none"
    }
  },
  mine: {
    size: 58,
    damage: 80,
    events: {
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "mine",
      air_float: true
    }
  },
  "asteroid-small": {
    size: 15,
    weight: 1,
    damage: 40,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-small",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 10,
      sprite: "flame"
    }
  },
  "asteroid-large": {
    size: 34,
    weight: 1,
    damage: 80,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    cluster: {
      circle: true,
      object: "asteroid-small",
      speed: 16,
      count: 3
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-large",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 20,
      sprite: "flame"
    }
  },
  dig: {
    size: 2,
    weight: 0,
    damage: 16,
    timeout: 6,
    ignore_level_damage: true,
    events: {
      ground: ["destroy", "drag_player", "die"]
    }
  },
  punch: {
    size: 20,
    weight: 0,
    damage: 16,
    timeout: 26,
    player_lock: true,
    stop: 24,
    events: {
      ground: "slide"
    },
    object_events: {
      player: "hit_give"
    },
    animation: {
      sprite: "flame-large"
    },
    audio: {
      air: "fly",
      bounce: "doink",
      hit: "punch"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  laser: {
    size: 24,
    weight: 0,
    timeout: 20,
    damage: 30,
    destroy_ground: false,
    events: {
      ground: "die",
      object: "none",
      die: "none"
    },
    object_events: {
      player: ["explode", "die"],
      player_ghost: ["hit_give", "die"]
    },
    animation: {
      sprite: "laser-blue",
      explosion: "explosion-laser-blue"
    },
    audio: {
      explosion: "explosion_laser"
    },
    trails: {
      count: 1,
      speed: 0,
      timeout: 10,
      rotate: false,
      move: false,
      sprite: "bubble-blue"
    }
  },
  bazooka: {
    size: 6,
    weight: 0.7,
    timeout: 300,
    damage: 70,
    events: {
      ground: "die",
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "bazooka-shell"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  grenade: {
    size: 4,
    weight: 0.7,
    timeout: 72,
    damage: 50,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "explode"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "grenade-armed"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "countdown"
    },
    trails: {
      count: 1,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-green"
    }
  },
  pumpkin: {
    size: 10,
    weight: 1,
    timeout: 120,
    damage: 70,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "cluster"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "spooky"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      rotate: true,
      sprite: "bat"
    },
    cluster: {
      circle: false,
      object: "pumpkin_slice",
      speed: 15,
      count: 3
    }
  },
  pumpkin_slice: {
    size: 6,
    weight: 1,
    timeout: 200,
    damage: 30,
    events: {
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin-slice"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-orange"
    }
  },
  paingiver: {
    size: 20,
    weight: 1,
    damage: 50,
    cluster: {
      circle: false,
      object: "grenade",
      speed: 15,
      count: 3
    },
    events: {
      ground: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "rocket"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  }
};

// prep objects
config.object_refs = [];
for (key in config.objects) {
  config.object_refs.push(key);
  config.objects[key] = deepmerge(config.objects.default, config.objects[key], {
    arrayMerge: dont_merge
  });
}

var config = config || {};
config.sprites = {
  "ball-blue": {
    size: 48,
    x: 192,
    y: 1056
  },
  "ball-green": {
    size: 48,
    x: 240,
    y: 1056
  },
  "ball-orange": {
    size: 48,
    x: 288,
    y: 1056
  },
  "ball-red": {
    size: 48,
    x: 336,
    y: 1056
  },
  "ball-silver": {
    size: 48,
    x: 384,
    y: 1056
  },
  bat: {
    size: 48,
    x: 432,
    y: 1056
  },
  "flame-1": {
    size: 48,
    x: 480,
    y: 1056
  },
  "flame-2": {
    size: 48,
    x: 528,
    y: 1056
  },
  "flame-3": {
    size: 48,
    x: 576,
    y: 1056
  },
  "flame-4": {
    size: 48,
    x: 624,
    y: 1056
  },
  "flame-5": {
    size: 48,
    x: 672,
    y: 1056
  },
  "mine-grey": {
    size: 48,
    x: 720,
    y: 1056
  },
  "mine-red": {
    size: 48,
    x: 768,
    y: 1056
  },
  "pumpkin-slice": {
    size: 48,
    x: 816,
    y: 1056
  },
  pumpkin: {
    size: 48,
    x: 864,
    y: 1056
  },
  "star-blue": {
    size: 48,
    x: 912,
    y: 1056
  },
  "ant-body-air-left": {
    size: 48,
    x: 960,
    y: 1056
  },
  "ant-body-air-right": {
    size: 48,
    x: 1008,
    y: 1056
  },
  "ant-body-hit-1": {
    size: 48,
    x: 1056,
    y: 1056
  },
  "ant-body-hit-2": {
    size: 48,
    x: 1120,
    y: 0
  },
  "ant-body-hit-3": {
    size: 48,
    x: 1120,
    y: 48
  },
  "ant-body-superman-left": {
    size: 48,
    x: 1120,
    y: 96
  },
  "ant-body-superman-right": {
    size: 48,
    x: 1120,
    y: 144
  },
  "ant-body-walk-left-1": {
    size: 48,
    x: 1120,
    y: 192
  },
  "ant-body-walk-left-2": {
    size: 48,
    x: 1120,
    y: 240
  },
  "ant-body-walk-left-3": {
    size: 48,
    x: 1120,
    y: 288
  },
  "ant-body-walk-left-4": {
    size: 48,
    x: 1120,
    y: 336
  },
  "ant-body-walk-left-5": {
    size: 48,
    x: 1120,
    y: 384
  },
  "ant-body-walk-right-1": {
    size: 48,
    x: 1120,
    y: 432
  },
  "ant-body-walk-right-2": {
    size: 48,
    x: 1120,
    y: 480
  },
  "ant-body-walk-right-3": {
    size: 48,
    x: 1120,
    y: 528
  },
  "ant-body-walk-right-4": {
    size: 48,
    x: 1120,
    y: 576
  },
  "ant-body-walk-right-5": {
    size: 48,
    x: 1120,
    y: 624
  },
  "ant-bomb": {
    size: 48,
    x: 1120,
    y: 672
  },
  "ant-ghost-1": {
    size: 64,
    x: 576,
    y: 960
  },
  "ant-ghost-2": {
    size: 64,
    x: 640,
    y: 960
  },
  "ant-ghost-3": {
    size: 64,
    x: 704,
    y: 960
  },
  "ant-head-hit-1": {
    size: 64,
    x: 768,
    y: 960
  },
  "ant-head-hit-2": {
    size: 64,
    x: 832,
    y: 960
  },
  "ant-head-hit-3": {
    size: 64,
    x: 896,
    y: 960
  },
  "ant-head-left-1": {
    size: 64,
    x: 960,
    y: 960
  },
  "ant-head-left-2": {
    size: 64,
    x: 1056,
    y: 0
  },
  "ant-head-left-3": {
    size: 64,
    x: 1056,
    y: 64
  },
  "ant-head-right-1": {
    size: 64,
    x: 1056,
    y: 128
  },
  "ant-head-right-2": {
    size: 64,
    x: 1056,
    y: 192
  },
  "ant-head-right-3": {
    size: 64,
    x: 1056,
    y: 256
  },
  "ant-weapon-bazooka-left": {
    size: 64,
    x: 1056,
    y: 320
  },
  "ant-weapon-bazooka-right": {
    size: 64,
    x: 1056,
    y: 384
  },
  "ant-weapon-dig-left-1": {
    size: 64,
    x: 1056,
    y: 448
  },
  "ant-weapon-dig-left-2": {
    size: 64,
    x: 1056,
    y: 512
  },
  "ant-weapon-dig-left-3": {
    size: 64,
    x: 1056,
    y: 576
  },
  "ant-weapon-dig-left-4": {
    size: 64,
    x: 1056,
    y: 640
  },
  "ant-weapon-dig-right-1": {
    size: 64,
    x: 1056,
    y: 704
  },
  "ant-weapon-dig-right-2": {
    size: 64,
    x: 1056,
    y: 768
  },
  "ant-weapon-dig-right-3": {
    size: 64,
    x: 1056,
    y: 832
  },
  "ant-weapon-dig-right-4": {
    size: 64,
    x: 1056,
    y: 896
  },
  "ant-weapon-laser-left": {
    size: 64,
    x: 1056,
    y: 960
  },
  "ant-weapon-laser-right": {
    size: 64,
    x: 0,
    y: 1056
  },
  "ant-weapon-punch-left": {
    size: 64,
    x: 64,
    y: 1056
  },
  "ant-weapon-punch-right": {
    size: 64,
    x: 128,
    y: 1056
  },
  "ant-weapon-throw-left-1": {
    size: 48,
    x: 1120,
    y: 720
  },
  "ant-weapon-throw-left-2": {
    size: 48,
    x: 1120,
    y: 768
  },
  "ant-weapon-throw-left-3": {
    size: 48,
    x: 1120,
    y: 816
  },
  "ant-weapon-throw-left-4": {
    size: 48,
    x: 1120,
    y: 864
  },
  "ant-weapon-throw-left-5": {
    size: 48,
    x: 1120,
    y: 912
  },
  "ant-weapon-throw-right-1": {
    size: 48,
    x: 1120,
    y: 960
  },
  "ant-weapon-throw-right-2": {
    size: 48,
    x: 1120,
    y: 1008
  },
  "ant-weapon-throw-right-3": {
    size: 48,
    x: 1120,
    y: 1056
  },
  "ant-weapon-throw-right-4": {
    size: 48,
    x: 0,
    y: 1120
  },
  "ant-weapon-throw-right-5": {
    size: 48,
    x: 48,
    y: 1120
  },
  "armoury-dig": {
    size: 48,
    x: 96,
    y: 1120
  },
  "armoury-extinguishe": {
    size: 48,
    x: 144,
    y: 1120
  },
  "armoury-laser-blue": {
    size: 48,
    x: 192,
    y: 1120
  },
  "armoury-laser-red": {
    size: 48,
    x: 240,
    y: 1120
  },
  "armoury-punch": {
    size: 48,
    x: 288,
    y: 1120
  },
  "arrow-blue": {
    size: 48,
    x: 336,
    y: 1120
  },
  "arrow-green": {
    size: 48,
    x: 384,
    y: 1120
  },
  "arrow-grey": {
    size: 48,
    x: 432,
    y: 1120
  },
  "arrow-purple": {
    size: 48,
    x: 480,
    y: 1120
  },
  "arrow-red": {
    size: 48,
    x: 528,
    y: 1120
  },
  "asteroid-1": {
    size: 96,
    x: 0,
    y: 768
  },
  "asteroid-2": {
    size: 96,
    x: 96,
    y: 768
  },
  "ball-blue-1": {
    size: 24,
    x: 1056,
    y: 1024
  },
  "ball-blue-2": {
    size: 24,
    x: 1080,
    y: 1024
  },
  "ball-blue-3": {
    size: 24,
    x: 1024,
    y: 960
  },
  "ball-blue-4": {
    size: 24,
    x: 1024,
    y: 984
  },
  "ball-blue-5": {
    size: 24,
    x: 576,
    y: 1024
  },
  "bazooka-shell": {
    size: 48,
    x: 576,
    y: 1120
  },
  "crate-health": {
    size: 48,
    x: 624,
    y: 1120
  },
  "crate-weapon": {
    size: 48,
    x: 672,
    y: 1120
  },
  crosshair: {
    size: 48,
    x: 720,
    y: 1120
  },
  "explosion-green-l-1": {
    size: 192,
    x: 0,
    y: 0
  },
  "explosion-green-l-2": {
    size: 192,
    x: 192,
    y: 0
  },
  "explosion-green-l-3": {
    size: 192,
    x: 0,
    y: 192
  },
  "explosion-green-l-4": {
    size: 192,
    x: 192,
    y: 192
  },
  "explosion-green-l-5": {
    size: 192,
    x: 384,
    y: 0
  },
  "explosion-green-l-6": {
    size: 192,
    x: 384,
    y: 192
  },
  "explosion-green-l-7": {
    size: 192,
    x: 0,
    y: 384
  },
  "explosion-green-l-8": {
    size: 192,
    x: 192,
    y: 384
  },
  "explosion-l-1": {
    size: 192,
    x: 384,
    y: 384
  },
  "explosion-l-2": {
    size: 192,
    x: 576,
    y: 0
  },
  "explosion-l-3": {
    size: 192,
    x: 576,
    y: 192
  },
  "explosion-l-4": {
    size: 192,
    x: 576,
    y: 384
  },
  "explosion-l-5": {
    size: 192,
    x: 0,
    y: 576
  },
  "explosion-l-6": {
    size: 192,
    x: 192,
    y: 576
  },
  "explosion-l-7": {
    size: 192,
    x: 384,
    y: 576
  },
  "explosion-laser-blue-1": {
    size: 96,
    x: 192,
    y: 768
  },
  "explosion-laser-blue-2": {
    size: 96,
    x: 288,
    y: 768
  },
  "explosion-laser-blue-3": {
    size: 96,
    x: 384,
    y: 768
  },
  "explosion-laser-blue-4": {
    size: 96,
    x: 480,
    y: 768
  },
  "explosion-laser-blue-5": {
    size: 96,
    x: 576,
    y: 768
  },
  "explosion2-l-1": {
    size: 96,
    x: 672,
    y: 768
  },
  "explosion2-l-2": {
    size: 96,
    x: 768,
    y: 768
  },
  "explosion2-l-3": {
    size: 96,
    x: 864,
    y: 768
  },
  "explosion2-l-4": {
    size: 192,
    x: 576,
    y: 576
  },
  "explosion2-l-5": {
    size: 192,
    x: 768,
    y: 0
  },
  "explosion2-l-6": {
    size: 192,
    x: 768,
    y: 192
  },
  "explosion2-l-7": {
    size: 192,
    x: 768,
    y: 384
  },
  "explosion2-l-8": {
    size: 192,
    x: 768,
    y: 576
  },
  extinguisher: {
    size: 48,
    x: 768,
    y: 1120
  },
  "flame-large-1": {
    size: 96,
    x: 0,
    y: 864
  },
  "flame-large-2": {
    size: 96,
    x: 96,
    y: 864
  },
  "flame-large-3": {
    size: 96,
    x: 192,
    y: 864
  },
  "flame-large-4": {
    size: 96,
    x: 288,
    y: 864
  },
  "flame-large-5": {
    size: 96,
    x: 384,
    y: 864
  },
  "flame-large-6": {
    size: 96,
    x: 480,
    y: 864
  },
  "focus-1": {
    size: 96,
    x: 576,
    y: 864
  },
  "focus-2": {
    size: 96,
    x: 672,
    y: 864
  },
  "focus-3": {
    size: 96,
    x: 768,
    y: 864
  },
  "focus-4": {
    size: 96,
    x: 864,
    y: 864
  },
  "focus-5": {
    size: 96,
    x: 960,
    y: 0
  },
  "focus-6": {
    size: 96,
    x: 960,
    y: 96
  },
  "focus-7": {
    size: 96,
    x: 960,
    y: 192
  },
  "focus-8": {
    size: 96,
    x: 960,
    y: 288
  },
  "gem-blue-1": {
    size: 48,
    x: 816,
    y: 1120
  },
  "gem-blue-2": {
    size: 48,
    x: 864,
    y: 1120
  },
  "gem-blue-3": {
    size: 48,
    x: 912,
    y: 1120
  },
  "gem-blue-4": {
    size: 48,
    x: 960,
    y: 1120
  },
  "gem-green-1": {
    size: 48,
    x: 1008,
    y: 1120
  },
  "gem-green-2": {
    size: 48,
    x: 1056,
    y: 1120
  },
  "gem-green-3": {
    size: 48,
    x: 1104,
    y: 1120
  },
  "gem-green-4": {
    size: 48,
    x: 1168,
    y: 0
  },
  "gem-purple-1": {
    size: 48,
    x: 1168,
    y: 48
  },
  "gem-purple-2": {
    size: 48,
    x: 1168,
    y: 96
  },
  "gem-purple-3": {
    size: 48,
    x: 1168,
    y: 144
  },
  "gem-purple-4": {
    size: 48,
    x: 1168,
    y: 192
  },
  "gem-red-1": {
    size: 48,
    x: 1168,
    y: 240
  },
  "gem-red-2": {
    size: 48,
    x: 1168,
    y: 288
  },
  "gem-red-3": {
    size: 48,
    x: 1168,
    y: 336
  },
  "gem-red-4": {
    size: 48,
    x: 1168,
    y: 384
  },
  "gem-silver-1": {
    size: 48,
    x: 1168,
    y: 432
  },
  "gem-silver-2": {
    size: 48,
    x: 1168,
    y: 480
  },
  "gem-silver-3": {
    size: 48,
    x: 1168,
    y: 528
  },
  "gem-silver-4": {
    size: 48,
    x: 1168,
    y: 576
  },
  "grenade-green": {
    size: 48,
    x: 1168,
    y: 624
  },
  "grenade-red": {
    size: 48,
    x: 1168,
    y: 672
  },
  "laser-blue": {
    size: 48,
    x: 1168,
    y: 720
  },
  "laser-red": {
    size: 48,
    x: 1168,
    y: 768
  },
  nuclear: {
    size: 96,
    x: 960,
    y: 384
  },
  rocket: {
    size: 48,
    x: 1168,
    y: 816
  },
  smoke: {
    size: 24,
    x: 600,
    y: 1024
  },
  target: {
    size: 48,
    x: 48,
    y: 1168
  },
  "teleport-1": {
    size: 48,
    x: 1168,
    y: 864
  },
  "teleport-2": {
    size: 48,
    x: 1168,
    y: 912
  },
  "teleport-3": {
    size: 48,
    x: 1168,
    y: 960
  },
  "teleport-4": {
    size: 48,
    x: 1168,
    y: 1008
  },
  "teleport-5": {
    size: 48,
    x: 1168,
    y: 1056
  },
  "teleport-6": {
    size: 48,
    x: 1168,
    y: 1104
  },
  "teleport-7": {
    size: 48,
    x: 0,
    y: 1168
  },
  "vortex-1": {
    size: 96,
    x: 960,
    y: 480
  },
  "vortex-10": {
    size: 96,
    x: 960,
    y: 576
  },
  "vortex-11": {
    size: 96,
    x: 960,
    y: 672
  },
  "vortex-2": {
    size: 96,
    x: 960,
    y: 768
  },
  "vortex-3": {
    size: 96,
    x: 960,
    y: 864
  },
  "vortex-4": {
    size: 96,
    x: 0,
    y: 960
  },
  "vortex-5": {
    size: 96,
    x: 96,
    y: 960
  },
  "vortex-6": {
    size: 96,
    x: 192,
    y: 960
  },
  "vortex-7": {
    size: 96,
    x: 288,
    y: 960
  },
  "vortex-8": {
    size: 96,
    x: 384,
    y: 960
  },
  "vortex-9": {
    size: 96,
    x: 480,
    y: 960
  }
};

var config = config || {};
config.weapons = {
  default: {
    title: "",
    armoury_sprite: "",
    sprite: "",
    fire_audio: "",
    fire_sprite: "",
    fire_body_sprite: "",
    fire_angle_lock: false,
    auto_follow: false,
    require_walk: false,
    speed: 0,
    object: "",
    cooldown: 0,
    recoil: 0,
    inertia: 0
  },
  dig: {
    title: "Dig",
    armoury_sprite: "armoury-dig",
    sprite: "dig",
    fire_sprite: "dig-fire",
    fire_body_sprite: "walk",
    fire_angle_lock: true,
    speed: 3,
    object: "dig",
    cooldown: 10
  },
  phaser: {
    title: "Phaser",
    armoury_sprite: "armoury-laser-blue",
    sprite: "laser",
    fire_audio: "shoot_laser",
    speed: 30,
    object: "laser",
    cooldown: 6,
    recoil: 0.1,
    inertia: 0.5
  },
  bazookoid: {
    title: "Bazookoid",
    armoury_sprite: "bazooka-shell",
    sprite: "bazooka",
    fire_audio: "shoot",
    auto_follow: true,
    speed: 24,
    object: "bazooka",
    cooldown: 40,
    recoil: 0.2,
    inertia: 0.5
  },
  grenade: {
    title: "Grenade",
    armoury_sprite: "grenade-green",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 24,
    object: "grenade",
    cooldown: 30,
    recoil: 0,
    inertia: 0.5
  },
  punch: {
    title: "Fire Punch",
    armoury_sprite: "armoury-punch",
    sprite: "punch",
    fire_audio: "throw",
    fire_body_sprite: "superman",
    speed: 24,
    object: "punch",
    cooldown: 120,
    recoil: 0,
    inertia: 0.5
  },
  pumpkin: {
    title: "Pumpkin",
    armoury_sprite: "pumpkin",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 30,
    object: "pumpkin",
    cooldown: 48,
    recoil: 0,
    inertia: 0.5
  },
  paingiver: {
    title: "Paingiver 2000",
    armoury_sprite: "rocket",
    sprite: "bazooka",
    fire_audio: "shoot",
    speed: 24,
    object: "paingiver",
    cooldown: 10,
    recoil: 0.4,
    inertia: 0.5
  }
};

// prep weapons
for (key in config.weapons) {
  config.weapons[key] = deepmerge(config.weapons.default, config.weapons[key], {
    arrayMerge: dont_merge
  });
}

/* ========================================================================
    Actions
 ========================================================================== */

/* Perform action
	---------------------------------------- */

core.prototype.action = function(player_id, action) {
  var response = { success: false };
  var player = this.state.players[player_id];
  var obj = this.state.objects["player-" + player_id];
  if (!player || !action || !obj) {
    return response;
  }

  var locked_obj = this.state.objects[player.locked];

  // players can do stuff
  if (!player.dead && !locked_obj && player.hit === 0) {
    // run them
    if (action.action === "move") {
      response = this.action_move(response, player, obj, action);
    }
    if (action.action === "jump") {
      response = this.action_jump(response, player, obj, action);
    }
    if (action.action === "shoot") {
      response = this.action_shoot(response, player, obj, action);
    }
  }

  response.x = obj.x;
  response.y = obj.y;
  response.speed_x = obj.speed_x;
  response.speed_y = obj.speed_y;
  response.frame = this.state.frame;

  // return status
  return response;
};

/* Walking
	---------------------------------------- */

core.prototype.action_move = function(response, player, obj, action) {
  response.type = "walk";

  if (obj.grounded) {
    var speed = this.scheme.levels.speed[player.level] || obj.c.speed.move;
    var speed = action.speed || speed;
    var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, action.angle, speed);
    if (walk.move) {
      if (this.action_walk_move(obj, walk.path)) {
        // record player event
        player.events.push({ frame: this.state.frame, type: "walk" });

        // return success
        response.success = true;
      }
    }
  }

  return response;
};

/* Walking in a direction
	---------------------------------------- */

core.prototype.action_walk_dir = function(obj, dir, speed) {
  var speed = speed || obj.c.speed.move;

  // get initial path
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 0, speed);

  if (walk.direction != dir) {
    walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 180, speed);
    if (walk.direction != dir) {
      walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 90, speed);
      if (walk.direction != dir) {
        walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 270, speed);
        if (walk.direction != dir) {
          return;
        }
      }
    }
  }
  if (!walk.move) {
    return;
  }

  this.action_walk_move(obj, walk.path);
};

/* Walk moving
	---------------------------------------- */

core.prototype.action_walk_move = function(obj, path) {
  // go through the course
  var x1 = obj.x;
  var y1 = obj.y;
  for (var i = 1; i < path.length; i++) {
    var point = path[i];

    // check object collisions
    var col = this.collisions(obj, point.x, point.y);
    if (col) {
      return;
    }

    obj.x = point.x;
    obj.y = point.y;
    obj.moved = true;
  }

  if (obj.moved) {
    return true;
  }
};

/* Jumping
	---------------------------------------- */

core.prototype.action_jump = function(response, player, obj, action) {
  response.type = "jump";

  if (obj.grounded && player.cooldown === 0) {
    var speed = this.scheme.levels.jump[player.level] || obj.c.speed.jump;
    var xy = xy_speed(action.angle, speed);
    obj.speed_x = xy.x.fixed();
    obj.speed_y = xy.y.fixed();
    if (this.physics_move(obj)) {
      // set grounding
      obj.grounded = false;

      // set cooldown
      player.cooldown = 7;

      // record player event
      player.events.push({ frame: this.state.frame, type: "jump" });

      // return success
      response.success = true;
    }
  }

  return response;
};

/* Shooting weapon
	---------------------------------------- */

core.prototype.action_shoot = function(response, player, obj, action) {
  response.type = "shoot";

  // if waiting for cooldown
  // is not real weapon
  // do we need to walk
  // check armoury count
  var weapon = this.c.weapons[action.weapon];
  if (
    (player.cooldown === 0 && !weapon) ||
    (weapon.require_walk && !obj.grounded) ||
    player.armoury[action.weapon] === 0
  ) {
    return response;
  }

  // crate the object
  var speed = xy_speed(action.angle, weapon.speed);
  var shot_obj = this.create_object({
    type: weapon.object,
    player_id: player.id,
    x: obj.x,
    y: obj.y,
    speed_x: (speed.x + obj.speed_x * weapon.inertia).fixed(),
    speed_y: (speed.y + obj.speed_y * weapon.inertia).fixed()
  });

  // set player recoil
  if (!obj.grounded) {
    obj.speed_x += (-speed.x * weapon.recoil).fixed();
    obj.speed_y += (-speed.y * weapon.recoil).fixed();
  }

  // set armoury values
  this.update_player_armoury(player.id, action.weapon, -1);

  // set cooldown
  player.cooldown = weapon.cooldown;

  // set player lock
  if (shot_obj.c.player_lock) {
    player.locked = shot_obj.key;
  }

  // record player event
  player.events.push({
    frame: this.state.frame,
    type: "shoot",
    obj: shot_obj.key,
    weapon: action.weapon
  });

  // return success
  response.success = true;
  return response;
};

/* ========================================================================
    Collisions
 ========================================================================== */

/* Run single collision check
	---------------------------------------- */

core.prototype.collisions = function(obj, x, y) {
  // check collision with ground
  if (this.map.i(round(x), round(y))) {
    var event = this.event(obj, "ground", null);
    if (event) {
      return event;
    }
  }

  // check collisions with other objects
  for (var key in this.state.objects) {
    if (obj.key === key) {
      continue;
    }
    if (this.collision_obj(obj, x, y, this.state.objects[key])) {
      return true;
    }
  }

  return false;
};

/* Run object collision check
	---------------------------------------- */

core.prototype.collision_obj = function(obj, x, y, check_obj) {
  // if no collision
  if (
    this.collision_check(
      x,
      y,
      check_obj.x,
      check_obj.y,
      obj.c.size,
      check_obj.c.size
    )
  ) {
    return;
  }

  // prevent hits on parent players for a short time or if they're player locked
  if (
    check_obj.type === "player" &&
    check_obj.player_id === obj.player_id &&
    (this.state.frame < obj.frame + 15 || obj.c.player_lock)
  ) {
    return;
  }

  // prevent clusters hitting each other for a short time
  if (
    check_obj.frame === obj.frame &&
    check_obj.player_id === obj.player_id &&
    this.state.frame < obj.frame + 60
  ) {
    return;
  }

  // trigger basic object collision event
  if (this.event(obj, "object", check_obj)) {
    return true;
  }

  // trigger specific object collision event
  var event = obj.c.object_events[check_obj.type];
  if (event) {
    if (this.run_event(obj, event, check_obj)) {
      return true;
    }
  }
};

/* Collision Maths
	---------------------------------------- */

core.prototype.collision_check = function(x1, y1, x2, y2, s1, s2) {
  return this.map.get_distance(x1, y1, x2, y2) > s1 + s2;
};

/* ========================================================================
    Core
 ========================================================================== */

/* create core object
	---------------------------------------- */

function core(config, scheme, map, gravity_map) {
  // config
  this.c = config;
  this.scheme = scheme;
  this.map = new core_map(map, scheme, gravity_map);

  // crate chance table
  this.crate_list = [];
  for (var key in this.scheme.weapons) {
    for (var i = 0; i < this.scheme.weapons[key].crate_chance; i++) {
      this.crate_list.push(key);
    }
  }

  // armoury reference table
  this.armoury_refs = [];
  for (key in this.scheme.weapons) {
    this.armoury_refs.push(key);
  }
}

/* Set a blank state
	---------------------------------------- */

core.prototype.blank_state = function() {
  return {
    frame: 0,
    explosions: {},
    objects: {},
    players: {},
    events: []
  };
};

/* Run every frame
	---------------------------------------- */

core.prototype.frame = function() {
  this.frame_explosions();
  this.frame_players();
  this.frame_objects();
};

/* ========================================================================
    Events
 ========================================================================== */

/* Run a specific type of event
	---------------------------------------- */

core.prototype.event = function(obj, type, collided_obj) {
  var event = obj.c.events[type];
  if (!event) {
    return;
  }
  return this.run_event(obj, event, collided_obj, type);
};

/* Run a specific event
	---------------------------------------- */

core.prototype.run_event = function(obj, event, collided_obj, type) {
  // handle arrays of events
  if (Array.isArray(event)) {
    var stop = false;
    for (var i = 0; i < event.length; i++) {
      var stop2 = this.run_event(obj, event[i], collided_obj, type);
      stop = stop2 ? true : stop;
    }
    return stop;
  }

  // run event function
  if (event === "die") {
    return this.event_die(obj, collided_obj, type);
  } else if (event === "kill") {
    return this.event_kill(obj, collided_obj);
  } else if (event === "explode") {
    return this.event_explode(obj);
  } else if (event === "hit_give") {
    return this.event_hit_give(obj, collided_obj, type);
  } else if (event === "hit_receive") {
    return this.event_hit_receive(obj, collided_obj, type);
  } else if (event === "destroy") {
    return this.event_destroy(obj);
  } else if (event === "cluster") {
    return this.event_cluster(obj);
  } else if (event === "bounce") {
    return this.event_bounce(obj, collided_obj, type);
  } else if (event === "bounce_explode") {
    return this.event_bounce_explode(obj, collided_obj, type);
  } else if (event === "stick") {
    return this.event_stick(obj);
  } else if (event === "slide") {
    return this.event_slide(obj);
  } else if (event === "player_bounce") {
    return this.event_player_bounce(obj, collided_obj, type);
  } else if (event === "drag_player") {
    return this.event_drag_player(obj);
  } else if (event === "spawn_ghost") {
    return this.event_spawn_ghost(obj);
  } else if (event === "collect") {
    return this.event_collect(obj, collided_obj);
  }
};

/* Object die
	---------------------------------------- */

core.prototype.event_die = function(obj, collided_obj, type) {
  // die event
  this.event(obj, "die");

  // check for destroy events
  if (this.scheme.events.destroy) {
    if (this.scheme.events.destroy[obj.id]) {
      this.state.events.push(this.scheme.events.destroy[obj.id]);
    }
  }

  // delete the object
  delete this.state.objects[obj.key];

  return true;
};

/* Object kill
	---------------------------------------- */

core.prototype.event_kill = function(obj, collided_obj) {
  // destroy it
  this.run_event(collided_obj, "die");
};

/* Explode
	---------------------------------------- */

core.prototype.event_explode = function(obj) {
  // create explosion object
  this.create_explosion({
    player_id: obj.player_id,
    x: obj.x,
    y: obj.y,
    parent: obj.key,
    parent_type: obj.type
  });
};

/* Give a hit
	---------------------------------------- */

core.prototype.event_hit_give = function(obj, collided_obj, type) {
  return this.run_event(collided_obj, "hit_receive", obj, type);
};

/* Receive a hit
	---------------------------------------- */

core.prototype.event_hit_receive = function(obj, collided_obj, type) {
  // prevent instant hits
  if (obj.hits) {
    for (var key in obj.hits) {
      if (key === collided_obj.key) {
        return;
      }
    }
  }

  // calculate direction and distance it came from
  var angle = this.map.get_heading(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );
  var distance = this.map.get_distance(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );

  // get damage values from collided object
  var damage = this.get_damage(collided_obj);
  var knock = collided_obj.c.knock;
  if (collided_obj.type === "explosion") {
    damage *= max(0, (damage * 2 - distance) / (damage * 2));
  }

  // ignore if there's no damage
  if (damage === 0) {
    return;
  }

  // knock object
  if (knock > 0) {
    var xy = xy_speed(angle, damage);
    obj.speed_x -= xy.x.fixed();
    obj.speed_y -= xy.y.fixed();
    obj.grounded = false;
  }

  // are we hitting player
  if (obj.type === "player") {
    this.player_health_add(obj.player_id, -round(damage));
    var player = this.state.players[obj.player_id];
    if (player) {
      player.hit = damage * 2;
    }
  }

  // sound effect
  if (collided_obj.c.audio.hit) {
    this.state.events.push({
      type: "sound",
      x: obj.x,
      y: obj.y,
      sound: collided_obj.c.audio.hit
    });
  }

  // set hits
  if (!obj.hits) {
    obj.hits = {};
  }
  obj.hits[collided_obj.key] = true;
};

/* Destroy ground
	---------------------------------------- */

core.prototype.event_destroy = function(obj) {
  // limit to once per frame
  if (obj.destroyed) {
    return;
  }
  obj.destroyed = true;

  var damage = this.get_damage(obj);

  // record ground damage
  this.state.events.push({
    type: "ground_damage",
    frame: this.state.frame,
    dig: true,
    x: obj.x,
    y: obj.y,
    radius: damage
  });
};

/* Object bounce
	---------------------------------------- */

core.prototype.event_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  // check speed
  var speed = get_speed(obj.speed_x, obj.speed_y);
  var check_speed = speed * obj.c.bounce;
  if (check_speed < 1) {
    obj.speed_x = 0;
    obj.speed_y = 0;
    return true;
  }

  // get new direction angle
  var direction = get_angle(obj.speed_x, obj.speed_y);
  var surface_angle = 0;

  // get angle from ground
  if (type === "ground") {
    var walk = this.map.walk(round(obj.x), round(obj.y), 0, 0, direction, 6);
    if (walk.move) {
      surface_angle = walk.angle;
    }
  }

  // get angle from object
  else {
    var heading = this.map.get_heading(
      obj.x,
      obj.y,
      collided_obj.x,
      collided_obj.y
    );
    surface_angle = angle_add(heading, 90);
  }

  // reflect direction angle with collision angle
  var reflection = (direction - surface_angle) * 2;
  var new_angle = angle_add(direction, -reflection);

  // transform main velocity towards new angle
  var new_speed = xy_speed(new_angle, check_speed);
  obj.speed_x = new_speed.x.fixed();
  obj.speed_y = new_speed.y.fixed();

  // record bounce event
  if (speed > 2) {
    this.state.events.push({
      type: "bounce",
      x: obj.x,
      y: obj.y,
      obj: obj.key
    });
  }

  return true;
};

/* Object stick to ground
	---------------------------------------- */

core.prototype.event_stick = function(obj) {
  obj.grounded = true;
  obj.speed_x = 0;
  obj.speed_y = 0;
  return true;
};

/* Object slide
	---------------------------------------- */

core.prototype.event_slide = function(obj) {
  var angle = get_angle(obj.speed_x, obj.speed_y);
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, angle, obj.speed_left);
  if (walk.move) {
    this.action_walk_move(obj, walk.path);
  }
  return true;
};

/* Player bounce
	---------------------------------------- */

core.prototype.event_player_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }
  var speed = get_speed(obj.speed_x, obj.speed_y);

  var max_speed = this.scheme.levels.jump[player.level] || 0;
  max_speed += 10;
  if (player.hit > 0 || speed > max_speed) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "stick");
  }
};

/* Drag player
	---------------------------------------- */

core.prototype.event_drag_player = function(obj) {
  var player_obj = this.state.objects["player-" + obj.player_id];
  if (!player_obj) {
    return;
  }

  player_obj.speed_x = obj.speed_x;
  player_obj.speed_y = obj.speed_y;
  player_obj.dragged = true;
};

/* First Destroy
	---------------------------------------- */

core.prototype.event_bounce_explode = function(obj, collided_obj, type) {
  if (obj.frame + 10 > this.state.frame) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "explode");
  }
};

/* Spawn player ghost
	---------------------------------------- */

core.prototype.event_spawn_ghost = function(obj) {
  // transform object into ghost
  obj.type = "player_ghost";
  obj.c = this.c.objects["player_ghost"];
  obj.speed_x = 0;
  obj.speed_y = 0;
};

/* Clusters
	---------------------------------------- */

core.prototype.event_cluster = function(obj) {
  // set off explosions
  this.run_event(obj, "explode");

  // get cluster constants
  var cluster = obj.c.cluster;

  // get opposite angle of gravity
  var angle = this.map.get_gravity_angle(obj.x, obj.y);
  angle = angle_add(angle, 135);

  // go through clusters
  var range = cluster.circle ? 360 - 360 / cluster.count : 90;
  var angle_diff = range / (cluster.count - 1);
  for (var i = 0; i < cluster.count; i++) {
    // create cluster objects
    var launch_angle = angle_add(angle, i * angle_diff);
    var speed = xy_speed(launch_angle, cluster.speed);

    // create cluster object
    this.create_object({
      type: cluster.object,
      id: obj.id,
      data: i + 1,
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: speed.x.fixed(),
      speed_y: speed.y.fixed()
    });
  }

  return true;
};

/* Collect Crate
	---------------------------------------- */

core.prototype.event_collect = function(obj, collided_obj) {
  // prep event to send to game
  var event = {
    type: "collect",
    obj: collided_obj.key,
    player_id: obj.player_id
  };
  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // crate
  if (collided_obj.type === "crate") {
    var count = this.scheme.weapons[collided_obj.data].crate_count;
    count = count === -1 ? "infinite" : count;
    this.update_player_armoury(obj.player_id, collided_obj.data, count);
    event.collected = "crate";
    event.weapon = collided_obj.data;
    event.count = count;
    player.events.push({
      frame: this.state.frame,
      type: "crate",
      obj: collided_obj.key
    });
  }

  // medpack
  else if (collided_obj.type === "medpack") {
    this.player_health_add(obj.player_id, this.scheme.drops.medpack.add);
    event.collected = "medpack";
    player.events.push({
      frame: this.state.frame,
      type: "medpack",
      obj: collided_obj.key
    });
  }

  // gems
  else if (collided_obj.type === "gem-1") {
    this.player_score_add(obj.player_id, 1);
    event.collected = "gem";
    event.n = 1;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-5") {
    this.player_score_add(obj.player_id, 5);
    event.collected = "gem";
    event.n = 5;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-20") {
    this.player_score_add(obj.player_id, 20);
    event.collected = "gem";
    event.n = 20;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-50") {
    this.player_score_add(obj.player_id, 50);
    event.collected = "gem";
    event.n = 50;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-200") {
    this.player_score_add(obj.player_id, 200);
    event.collected = "gem";
    event.n = 200;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  }

  // record event
  this.state.events.push(event);

  // kill object
  this.run_event(collided_obj, "die", obj, "collect");

  // check for collection events
  if (this.scheme.events.collect) {
    if (this.scheme.events.collect[collided_obj.id]) {
      this.state.events.push(this.scheme.events.collect[collided_obj.id]);
    }
  }

  return false;
};

/* ========================================================================
    Explosions
 ========================================================================== */

/* Create an explosion
	---------------------------------------- */

core.prototype.create_explosion = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "explosion",
    player_id: "",
    frame: state_ref.frame,
    x: 0,
    y: 0,
    parent: "",
    parent_type: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.parent_type];

  // add to state objects
  state_ref.explosions[obj.parent] = obj;
};

/* Check all existing explosions
	---------------------------------------- */

core.prototype.frame_explosions = function() {
  // go through all explosions
  for (var key in this.state.explosions) {
    var explode = this.state.explosions[key];

    // if expired remove
    if (this.state.frame > explode.frame + 40) {
      delete this.state.explosions[key];
    }

    // if exploding this frame run
    if (this.state.frame === explode.frame + 1) {
      this.run_explosion(explode);
    }
  }
};

/* Run an explosion
	---------------------------------------- */

core.prototype.run_explosion = function(explode) {
  // if no damage
  if (!explode.c.damage) {
    return;
  }

  // calculate additional player damage
  var damage = this.get_damage(explode);

  // check collisions
  for (key in this.state.objects) {
    var obj = this.state.objects[key];

    // if object was just made
    if (this.state.frame < obj.frame + 2) {
      continue;
    }

    // run collision check
    if (
      !this.collision_check(
        obj.x,
        obj.y,
        explode.x,
        explode.y,
        obj.c.size,
        damage * 2
      )
    ) {
      this.event(obj, "explosion", explode);
    }
  }

  // record ground damage
  var ptype = this.c.objects[explode.parent_type];
  if (ptype && ptype.destroy_ground) {
    this.state.events.push({
      type: "ground_damage",
      frame: this.state.frame,
      x: explode.x,
      y: explode.y,
      radius: damage
    });
  }
};

/* ========================================================================
    Objects
 ========================================================================== */

/* Create a new game object
	---------------------------------------- */

core.prototype.create_object = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "",
    player_id: "",
    id: "",
    frame: state_ref.frame,
    grounded: false,
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    data: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.type];
  var key_type = obj.type;

  // set key
  if (
    obj.type === "player" ||
    obj.type === "player_ghost" ||
    obj.type === "player_missile"
  ) {
    obj.key = "player-" + obj.player_id;
  } else {
    obj.key =
      obj.type +
      "-" +
      obj.player_id +
      "-" +
      obj.id +
      "-" +
      obj.frame +
      "-" +
      obj.data;
  }

  // add to state objects
  state_ref.objects[obj.key] = obj;

  // return it
  return obj;
};

/* Snap object to another object
	---------------------------------------- */

core.prototype.snap_object = function(obj1, obj2) {
  obj1.grounded = obj2.grounded;
  obj1.x = obj2.x;
  obj1.y = obj2.y;
  obj1.speed_x = obj2.speed_x;
  obj1.speed_y = obj2.speed_y;
};

/* Run through object frame events
	---------------------------------------- */

core.prototype.frame_objects = function() {
  // run through all objects
  for (var key in this.state.objects) {
    this.frame_object(this.state.objects[key]);
  }

  // check for player lock
  for (var key in this.state.players) {
    this.frame_player_lock(this.state.players[key]);
  }
};

core.prototype.frame_object = function(obj) {
  if (!obj) {
    return;
  }
  obj.destroyed = false;

  // stopping
  if (obj.c.stop > 0 && this.state.frame > obj.frame + obj.c.stop) {
    obj.speed_x = 0;
    obj.speed_y = 0;
  }

  // timeout
  if (obj.c.timeout > 0 && obj.frame + obj.c.timeout <= this.state.frame) {
    this.run_event(obj, "die");
    return;
  }

  // run physics on object
  this.physics(obj);

  // events
  this.event(obj, "frame");
};

/* Spawns
	---------------------------------------- */

core.prototype.spawn = function(props) {
  // weapon crate contents
  if (props.type == "crate") {
    if (this.crate_list.length < 1) {
      return;
    }
    props.data = this.crate_list[rand(0, this.crate_list.length)];
  }

  // do we have a set position
  if (!props.x && !props.y) {
    var pos = this.map.air_find_spot();
    props.x = pos.x;
    props.y = pos.y;
  }

  return this.create_object(props);
};

/* ========================================================================
    Physics
 ========================================================================== */

/* Run air physics
	---------------------------------------- */

core.prototype.physics = function(obj) {
  // are we still grounded
  if (obj.grounded) {
    if (!this.map.ground_pixel(round(obj.x), round(obj.y))) {
      obj.grounded = false;
    }
  }

  // run the main physics
  if (!obj.grounded) {
    this.physics_gravity(obj);
    this.physics_move(obj);
  }
};

/* Calculate gravity
	---------------------------------------- */

core.prototype.physics_gravity = function(obj) {
  // if no weight
  if (obj.c.weight <= 0) {
    return;
  }

  // get gravity values
  var gravity = this.map.get_gravity(round(obj.x), round(obj.y));

  // adjust speed
  this.physics_adjust_speed(
    obj,
    gravity.x,
    gravity.y,
    obj.c.speed.max_gravity,
    obj.c.weight
  );
};

/* Adjust speed of object
	---------------------------------------- */

core.prototype.physics_adjust_speed = function(
  obj,
  new_speed_x,
  new_speed_y,
  max_speed,
  weight
) {
  var angle = get_angle(new_speed_x, new_speed_y);
  var max_speed = xy_speed(angle, max_speed);
  var speed_add_x = new_speed_x * weight;
  var speed_add_y = new_speed_y * weight;
  var diff_x = max_speed.x - obj.speed_x;
  var diff_y = max_speed.y - obj.speed_y;

  // only add speed up to the limit without bringing it down
  if (max_speed.x < 0) {
    obj.speed_x += max(speed_add_x, min(0, diff_x));
  } else {
    obj.speed_x += min(speed_add_x, max(0, diff_x));
  }
  if (max_speed.y < 0) {
    obj.speed_y += max(speed_add_y, min(0, diff_y));
  } else {
    obj.speed_y += min(speed_add_y, max(0, diff_y));
  }

  obj.speed_x = obj.speed_x.fixed();
  obj.speed_y = obj.speed_y.fixed();
};

/* Do the movement
	---------------------------------------- */

core.prototype.physics_move = function(obj) {
  // check speed
  var speed_limit = check_speed(obj.speed_x, obj.speed_y, obj.c.speed.max);
  obj.speed_x = speed_limit.x.fixed();
  obj.speed_y = speed_limit.y.fixed();

  // plot a course
  var course = plot_course(obj.x, obj.y, obj.speed_x, obj.speed_y);

  // if no course
  if (!course.move) {
    this.collisions(obj, obj.x, obj.y);
    return;
  }

  // move through course
  var moved = false;
  for (var i = 1; i < course.points.length; i++) {
    // remaining movement points left
    obj.speed_left = course.points.length - i;

    var point = course.points[i];
    var nx = this.map.loop_x(round(point.x));
    var ny = this.map.loop_y(round(point.y));

    // collisions
    var collision = this.collisions(obj, nx, ny);
    if (collision) {
      break;
    }

    // move object
    obj.x = nx;
    obj.y = ny;
    moved = true;
  }

  return moved;
};

/* ========================================================================
    Players
 ========================================================================== */

/* Create a new player
	---------------------------------------- */

core.prototype.create_player = function(props, state) {
  if (typeof props.id === "undefined") {
    return;
  }

  var state_ref = state || this.state;

  // set up object
  var obj = {
    id: "",
    level: 0,
    score: 0,
    dead: false,
    health: this.scheme.levels.health[0],
    cooldown: 0,
    hit: 0,
    weapon: "",
    locked: "",
    events: [],
    armoury: {}
  };
  obj = deepmerge(obj, props);
  obj.id = parseInt(obj.id);

  // set level
  this.player_level(obj.id);

  // add to state objects
  state_ref.players[obj.id] = obj;

  return obj;
};

/* Remove player
	---------------------------------------- */

core.prototype.remove_player = function(player_id) {
  if (!this.state.players[player_id]) {
    return;
  }

  delete this.state.objects["player-" + player_id];
  delete this.state.players[player_id];
};

/* Start the player
	---------------------------------------- */

core.prototype.init_player = function(player_id, state) {
  player_id = parseInt(player_id);
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // player values
  player.level = 0;
  player.score = 0;
  player.dead = false;
  player.health = this.scheme.levels.health[0];
  player.cooldown = 0;
  player.events = [];

  // armoury
  var armoury = {};
  for (var key in this.scheme.weapons) {
    armoury[key] = this.scheme.weapons[key].start_count;
  }
  player.armoury = armoury;

  // merge with an external state
  if (state) {
    this.state.players[player_id] = deepmerge(player, state);
  }

  // set level
  this.player_level(player_id);

  // object values
  var obj = this.state.objects["player-" + player_id];
  if (!obj) {
    return;
  }
  if (this.scheme.spawn.length > 0) {
    var pos = this.scheme.spawn[rand(0, this.scheme.spawn.length)];
  } else {
    var pos = this.map.air_find_spot();
  }
  obj.type = "player";
  obj.grounded = false;
  obj.x = pos.x;
  obj.y = pos.y;
  obj.speed_x = 0;
  obj.speed_y = 0;
  obj.c = this.c.objects["player"];
};

/* Update armoury
	---------------------------------------- */

core.prototype.update_player_armoury = function(player_id, weapon, count) {
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // if infinite or if zero and taking away
  var old_count = player.armoury[weapon];
  if (!is_numeric(old_count)) {
    return false;
  }
  if (old_count === -1) {
    return true;
  }
  if (old_count === 0 && count < 1) {
    return false;
  }

  // if infinite
  if (count === "infinite") {
    player.armoury[weapon] = -1;
  } else {
    player.armoury[weapon] += count;
  }

  // record event
  this.state.events.push({
    type: "armoury",
    player_id: player_id,
    weapon: weapon
  });

  return true;
};

/* Add health to player
	---------------------------------------- */

core.prototype.player_health_add = function(player_id, health, no_message) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // no health enabled
  if (!this.scheme.health) {
    return;
  }

  // add it
  player.health += health;
  player.health = min(player.health, this.scheme.levels.health[player.level]);

  // are we dead
  if (player.health <= 0) {
    this.player_die(player_id);
  }

  // set event
  if (!no_message) {
    this.state.events.push({
      type: "player_health",
      id: player_id,
      health: health
    });
  }
};

/* Add score to player
	---------------------------------------- */

core.prototype.player_score_add = function(player_id, score) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // add it
  player.score += score;

  // set level
  this.player_level(player_id);

  // set event
  this.state.events.push({
    type: "player_score",
    id: player_id,
    score: score
  });
};

/* Set player level
	---------------------------------------- */

core.prototype.player_level = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // go through levels
  var level = 0;
  for (var i = 0; i < this.scheme.levels.score.length; i++) {
    if (this.scheme.levels.score[i] <= player.score) {
      level = i;
    }
  }
  player.level = level;
};

/* Player die
	---------------------------------------- */

core.prototype.player_die = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  player.dead = true;

  var obj = this.state.objects["player-" + player_id];
  obj.type = "player_missile";
  obj.c = this.c.objects["player_missile"];

  // figure out gems to spawn
  var n = max(round(player.score / 2), 3);
  var gems = [];
  while (n > 200) {
    gems.push(200);
    n -= 200;
  }
  while (n > 50) {
    gems.push(50);
    n -= 50;
  }
  while (n > 20) {
    gems.push(20);
    n -= 20;
  }
  while (n > 5) {
    gems.push(5);
    n -= 5;
  }
  while (n > 1) {
    gems.push(1);
    n -= 1;
  }

  // spawn them
  var angle_inc = round(360 / gems.length);
  for (var i = 0; i < gems.length; i++) {
    var n = ((i % 3) + 1) * 2;
    var xy = xy_speed(angle_inc * i, n);
    this.create_object({
      type: "gem-" + gems[i],
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: xy.x.fixed(),
      speed_y: xy.y.fixed(),
      data: i + 1
    });
  }
};

/* Run through players
	---------------------------------------- */

core.prototype.frame_players = function(ignore) {
  // run through all objects
  for (var key in this.state.players) {
    if (parseInt(key) !== ignore) {
      this.frame_player(this.state.players[key]);
    }
  }
};

core.prototype.frame_player = function(player) {
  if (!player) {
    return;
  }

  // cooldown
  if (player.cooldown > 0) {
    player.cooldown--;
  }

  // hit
  if (player.hit > 0) {
    player.hit--;
  }

  // health regen
  if (this.state.frame % 24 === 0) {
    if (player.health < this.scheme.levels.health[player.level]) {
      this.player_health_add(player.id, 2, true);
    }
  }

  // remove old events
  for (var i = 0; i < player.events.length; i++) {
    if (this.state.frame > player.events[i].frame + 18) {
      player.events.splice(i, 1);
    }
  }
};

/* Run through player locked objects
	---------------------------------------- */

core.prototype.frame_player_lock = function(player) {
  var player_obj = this.state.objects["player-" + player.id];
  var obj = this.state.objects[player.locked];
  if (player_obj && obj) {
    player_obj.x = obj.x;
    player_obj.y = obj.y;
    player_obj.speed_x = obj.speed_x;
    player_obj.speed_y = obj.speed_y;
  } else {
    player.locked = "";
  }
};

/* Get damage modifiers from player
	---------------------------------------- */

core.prototype.get_damage = function(obj) {
  var damage = obj.c.damage;
  var player = this.state.players[obj.player_id];
  if (player && damage !== 0 && !obj.c.ignore_level_damage) {
    var level = this.scheme.levels.damage[player.level];
    if (level) {
      damage += level;
    }
  }
  return damage;
};

/* ========================================================================
    State management
 ========================================================================== */

/* Get state
	---------------------------------------- */

core.prototype.pack_state = function(state) {
  // players
  var players = [];
  for (var id in state.players) {
    players.push(this.pack_player(state.players[id]));
  }

  // go through objects
  var objects = [];
  for (var key in state.objects) {
    objects.push(this.pack_object(state.objects[key]));
  }

  // go through explosions
  var explosions = [];
  for (key in state.explosions) {
    explosions.push(this.pack_explosion(state.explosions[key]));
  }

  return (
    players.join("#") + "+" + objects.join("#") + "+" + explosions.join("#")
  );
};

/* Set state
	---------------------------------------- */

core.prototype.unpack_state = function(str) {
  // blank state
  var state = this.blank_state();

  // run through state string
  var split = str.split("+");
  for (var i = 0; i < split.length; i++) {
    if (split[i]) {
      var split2 = split[i].split("#");
      for (var j = 0; j < split2.length; j++) {
        if (i == 0) {
          this.unpack_player(state, split2[j]);
        }
        if (i == 1) {
          this.unpack_object(state, split2[j]);
        }
        if (i == 2) {
          this.unpack_explosion(state, split2[j]);
        }
      }
    }
  }

  return state;
};

/* Players
	---------------------------------------- */

core.prototype.pack_player = function(obj) {
  // prep basic values
  var dead = obj.dead ? "1" : "";
  var weapon = this.armoury_refs.indexOf(obj.weapon);

  // prep armoury
  var armoury = [];
  for (var key in obj.armoury) {
    armoury.push(obj.armoury[key]);
  }
  armoury = armoury.join("$");

  // prep events
  var events = [];
  for (var i = 0; i < obj.events.length; i++) {
    var event = obj.events[i];
    if (event.type === "walk") {
      events.push(event.frame + "~0");
    }
    if (event.type === "jump") {
      events.push(event.frame + "~1");
    }
    if (event.type === "shoot") {
      events.push(event.frame + "~2~" + event.obj + "~" + event.weapon);
    }
    if (event.type === "crate") {
      events.push(event.frame + "~3~" + event.obj);
    }
    if (event.type === "medpack") {
      events.push(event.frame + "~4~" + event.obj);
    }
    if (event.type === "gem") {
      events.push(event.frame + "~5~" + event.obj);
    }
  }
  events = events.join("$");

  // return player string
  var arr = [
    obj.id,
    obj.level,
    obj.score,
    dead,
    obj.health,
    obj.cooldown,
    obj.hit,
    obj.locked,
    armoury,
    weapon,
    events
  ];
  return arr.join("/");
};

core.prototype.unpack_player = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.id = parseInt(split[0]);
  props.level = parseInt(split[1]);
  props.score = parseInt(split[2]);
  props.dead = split[3] === "1" ? true : false;
  props.health = parseInt(split[4]);
  props.cooldown = parseInt(split[5]);
  props.hit = parseInt(split[6]);
  props.locked = split[7];

  // prep armoury
  props.armoury = {};
  var split2 = split[8].split("$");
  for (var i = 0; i < split2.length; i++) {
    var key = this.armoury_refs[i];
    props.armoury[key] = parseInt(split2[i]);
  }

  // weapon
  var wep = parseInt(split[9]);
  if (wep !== -1) {
    props.weapon = this.armoury_refs[wep];
  }

  // prep events
  props.events = [];
  var split2 = split[10].split("$");
  for (var i = 0; i < split2.length; i++) {
    var split3 = split2[i].split("~");
    var obj = { frame: parseInt(split3[0]) };
    if (split3[1] === "0") {
      obj.type = "walk";
    }
    if (split3[1] === "1") {
      obj.type = "jump";
    }
    if (split3[1] === "2") {
      obj.type = "shoot";
      obj.obj = split3[2];
      obj.weapon = split3[3];
    }
    if (split3[1] === "3") {
      obj.type = "crate";
      obj.obj = split3[2];
    }
    if (split3[1] === "4") {
      obj.type = "medpack";
      obj.obj = split3[2];
    }
    if (split3[1] === "5") {
      obj.type = "gem";
      obj.obj = split3[2];
    }
    if (obj) {
      props.events.push(obj);
    }
  }

  // make it
  this.create_player(props, state);
};

/* Objects
	---------------------------------------- */

core.prototype.pack_object = function(obj) {
  var grounded = obj.grounded ? "1" : "";
  var arr = [
    obj.type,
    obj.player_id,
    obj.id,
    obj.frame,
    grounded,
    obj.x,
    obj.y,
    obj.speed_x,
    obj.speed_y,
    obj.data
  ];
  return arr.join("/");
};

core.prototype.unpack_object = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.type = split[0];
  props.player_id = parseInt(split[1]);
  props.id = split[2];
  props.frame = parseInt(split[3]);
  props.grounded = split[4] === "1" ? true : false;
  props.x = parseFloat(split[5]);
  props.y = parseFloat(split[6]);
  props.speed_x = parseFloat(split[7]);
  props.speed_y = parseFloat(split[8]);
  props.data = split[9];

  this.create_object(props, state);
};

/* Explosions
	---------------------------------------- */

core.prototype.pack_explosion = function(obj) {
  var arr = [
    obj.player_id,
    obj.frame,
    obj.x,
    obj.y,
    obj.parent,
    obj.parent_type
  ];
  return arr.join("/");
};

core.prototype.unpack_explosion = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.player_id = parseInt(split[0]);
  props.frame = parseInt(split[1]);
  props.x = parseFloat(split[2]);
  props.y = parseFloat(split[3]);
  props.parent = split[4];
  props.parent_type = split[5];

  this.create_explosion(props, state);
};

function isMergeableObject(val) {
  var nonNullObject = val && typeof val === "object";

  return (
    nonNullObject &&
    Object.prototype.toString.call(val) !== "[object RegExp]" &&
    Object.prototype.toString.call(val) !== "[object Date]"
  );
}

function emptyTarget(val) {
  return Array.isArray(val) ? [] : {};
}

function cloneIfNecessary(value, optionsArgument) {
  var clone = optionsArgument && optionsArgument.clone === true;
  return clone && isMergeableObject(value)
    ? deepmerge(emptyTarget(value), value, optionsArgument)
    : value;
}

function defaultArrayMerge(target, source, optionsArgument) {
  var destination = target.slice();
  source.forEach(function(e, i) {
    if (typeof destination[i] === "undefined") {
      destination[i] = cloneIfNecessary(e, optionsArgument);
    } else if (isMergeableObject(e)) {
      destination[i] = deepmerge(target[i], e, optionsArgument);
    } else if (target.indexOf(e) === -1) {
      destination.push(cloneIfNecessary(e, optionsArgument));
    }
  });
  return destination;
}

function mergeObject(target, source, optionsArgument) {
  var destination = {};
  if (isMergeableObject(target)) {
    Object.keys(target).forEach(function(key) {
      destination[key] = cloneIfNecessary(target[key], optionsArgument);
    });
  }
  Object.keys(source).forEach(function(key) {
    if (!isMergeableObject(source[key]) || !target[key]) {
      destination[key] = cloneIfNecessary(source[key], optionsArgument);
    } else {
      destination[key] = deepmerge(target[key], source[key], optionsArgument);
    }
  });
  return destination;
}

function deepmerge(target, source, optionsArgument) {
  var array = Array.isArray(source);
  var options = optionsArgument || { arrayMerge: defaultArrayMerge };
  var arrayMerge = options.arrayMerge || defaultArrayMerge;

  if (array) {
    return Array.isArray(target)
      ? arrayMerge(target, source, optionsArgument)
      : cloneIfNecessary(source, optionsArgument);
  } else {
    return mergeObject(target, source, optionsArgument);
  }
}

deepmerge.all = function deepmergeAll(array, optionsArgument) {
  if (!Array.isArray(array) || array.length < 2) {
    throw new Error(
      "first argument should be an array with at least two elements"
    );
  }

  // we are sure there are at least 2 values, so it is safe to have no initial value
  return array.reduce(function(prev, next) {
    return deepmerge(prev, next, optionsArgument);
  });
};

/* ========================================================================
    Math Functions
 ========================================================================== */

/* Shorten "Math" functions
	---------------------------------------- */

function cos(n) {
  return Math.cos(n);
}
function sin(n) {
  return Math.sin(n);
}
function pow(n) {
  return Math.pow(n);
}
function abs(n) {
  return Math.abs(n);
}
function sqr(n) {
  return Math.pow(n, 2);
}
function sqrt(n) {
  return Math.sqrt(n);
}
function round(n) {
  return Math.round(n);
}
function floor(n) {
  return Math.floor(n);
}
function ceil(n) {
  return Math.ceil(n);
}
function atan2(n1, n2) {
  return Math.atan2(n1, n2);
}
function min(n1, n2) {
  return Math.min(n1, n2);
}
function max(n1, n2) {
  return Math.max(n1, n2);
}
function rand(n1, n2) {
  return floor(Math.random() * n2) + n1;
}
var pi = Math.PI;

/* Fix number to decimal places
	---------------------------------------- */

Number.prototype.fixed = function(n) {
  n = n || 2;
  return parseFloat(this.toFixed(n));
};

/* Add preceding zeroes to number
	---------------------------------------- */

function preceding_zeroes(n, length) {
  var length = length || 2;
  var n = n.toString();
  while (n.length < length) {
    n = "0" + n;
  }
  return n;
}

/* Is number
	---------------------------------------- */

function is_numeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

/* Get distance between two points
	---------------------------------------- */

function get_speed(sx, sy) {
  return round(sqrt(sqr(sx) + sqr(sy)));
}

function get_distance(x1, y1, x2, y2) {
  var dx = x2 - x1,
    dy = y2 - y1;
  return get_speed(dx, dy);
}

/* Check speed limit
	---------------------------------------- */

function check_speed(sx, sy, speed) {
  var d = get_distance(0, 0, sx, sy),
    ns = {
      x: sx,
      y: sy,
      total: d
    };
  if (speed < d) {
    var multi = speed / d;
    ns.x = sx * multi;
    ns.y = sy * multi;
    ns.total = speed;
  }
  return ns;
}

/* Get Heading Angle From X and Y Speed
	// 0 = left, 360 = left
	---------------------------------------- */

function get_angle(sx, sy) {
  return (((atan2(sy, sx) * 180) / pi) % 360) + 180;
}

function get_heading(x1, y1, x2, y2) {
  var xs = x2 - x1,
    ys = y2 - y1;
  return get_angle(xs, ys);
}

/* Get X and Y speed from heading and velocity
	---------------------------------------- */

function xy_speed(angle, speed) {
  var a = angle_add(angle, 180),
    r = (a / 180) * pi;
  return {
    x: speed * cos(r),
    y: speed * sin(r)
  };
}

/* Get X and Y offset from heading and velocity
	---------------------------------------- */

function xy_offset(angle, sx, sy) {
  var xy1 = xy_speed(angle, sx);
  var xy2 = xy_speed(angle_add(angle, 90), sy);
  return {
    x: xy1.x + xy2.x,
    y: xy1.y + xy2.y
  };
}

/* Get difference between two numbers in a loop
	---------------------------------------- */

function n_diff(current, target, bottom, top) {
  if (current == target) {
    return 0;
  }

  var scale = abs(top - bottom), // get total size of the loop
    c_current = current - bottom, // correct current for negative numbers
    c_target = target - bottom, // correct target for negative numbers
    n1 = (c_target + scale - c_current) % scale, // get difference when adding
    n2 = (c_current + scale - c_target) % scale; // get difference when subtracting

  // return smallest distance
  if (n1 < n2) {
    return n1;
  } else {
    return -n2;
  }
}

/* Auto loop a number
	---------------------------------------- */

function n_loop(n, bottom, top) {
  var difference = abs(top - bottom);
  while (n <= bottom) {
    n += difference;
  }
  while (n > top) {
    n -= difference;
  }
  return n;
}

/* Add to a number without overflowing up or down from min/max
	---------------------------------------- */

function n_add(n1, n2, t1, t2) {
  var dif = abs(t2 - t1),
    na = n1 + n2;
  while (na < t1) {
    na += dif;
  }
  while (na >= t2) {
    na -= dif;
  }
  return na;
}

/* Add to an angle without overflowing up or down from 0-360
	---------------------------------------- */

function angle_add(angle, add) {
  if (!angle) {
    angle = 0;
  }
  return n_add(angle, add, 0, 360);
}

/* Move number towards a new number with loop
	---------------------------------------- */

function increment_num(current, target, bottom, top, speed) {
  var diff = n_diff(current, target, bottom, top); // get shortest route to number
  move = min(abs(diff) / 10, 4) * speed; // calculate how much to move

  // if difference is less then movement, return target
  if (abs(diff) < move) {
    return target;
  }

  // add or subtract movement
  move = diff < 0 ? -move : move;
  return n_add(current, move, bottom, top);
}

/* Move angle towards a new angle
	---------------------------------------- */

function increment_angle(old_angle, new_angle, speed) {
  return increment_num(old_angle, new_angle, 0, 360, speed);
}

/* If a point is within a circle
	---------------------------------------- */

function in_circle(x, y, cx, cy, radius) {
  return get_distance(x, y, cx, cy) < radius;
}

/* Plot a course
	---------------------------------------- */

function plot_course(x, y, sx, sy, extend) {
  // get initial speed
  var extend = extend ? extend : 0,
    speed = get_speed(sx, sy);

  // if no distance then do nothing
  if (speed == 0) {
    return { move: false };
  }

  // calculate increments
  var increment_x = sx / speed,
    increment_y = sy / speed,
    new_x = x - increment_x * extend,
    new_y = y - increment_y * extend,
    points = [{ x: new_x, y: new_y }];

  // iterate through path and record points
  for (var i = 0; i < speed + extend * 2; i++) {
    (new_x += increment_x), (new_y += increment_y);
    points.push({
      x: new_x,
      y: new_y
    });
  }

  // return point array
  return {
    move: true,
    points: points
  };
}

/* translate co-ordinates by an angle
	---------------------------------------- */

function rotate_coords(x, y, cx, cy, angle) {
  var r = (pi / 180) * angle;
  return {
    x: cos(r) * (x - cx) + sin(r) * (y - cy) + cx,
    y: cos(r) * (y - cy) - sin(r) * (x - cx) + cy
  };
}

/* ========================================================================
    Misc Functions
 ========================================================================== */

/* Duplicate object
	---------------------------------------- */

function duplicate_obj(obj) {
  return JSON.parse(JSON.stringify(obj));
}

/* Prevent array merging
	---------------------------------------- */

function dont_merge(destination, source) {
  if (!source) {
    return destination;
  } else {
    return source;
  }
}

/* Add space to a string
	---------------------------------------- */

function str_space(str) {
  var new_str = "";
  for (var i = 0; i < str.length; i++) {
    var add = i == str.length - 1 ? "" : "\u200A";
    new_str += str[i] + add;
  }
  return new_str;
}

/* Log multiple values
	---------------------------------------- */

function clog(
  s1,
  s2,
  s3,
  s4,
  s5,
  s6,
  s7,
  s8,
  s9,
  s10,
  s11,
  s12,
  s13,
  s14,
  s15
) {
  var str = s1;
  if (s2 != undefined) {
    str += " | " + s2;
  }
  if (s3 != undefined) {
    str += " | " + s3;
  }
  if (s4 != undefined) {
    str += " | " + s4;
  }
  if (s5 != undefined) {
    str += " | " + s5;
  }
  if (s6 != undefined) {
    str += " | " + s6;
  }
  if (s7 != undefined) {
    str += " | " + s7;
  }
  if (s8 != undefined) {
    str += " | " + s8;
  }
  if (s9 != undefined) {
    str += " | " + s9;
  }
  if (s10 != undefined) {
    str += " | " + s10;
  }
  if (s11 != undefined) {
    str += " | " + s11;
  }
  if (s12 != undefined) {
    str += " | " + s12;
  }
  if (s13 != undefined) {
    str += " | " + s13;
  }
  if (s14 != undefined) {
    str += " | " + s14;
  }
  if (s15 != undefined) {
    str += " | " + s15;
  }
  console.log(str);
}

/* ========================================================================
	Map Generator
	Blobs
 ========================================================================== */

/* Draw a blob
	---------------------------------------- */

function mapgen_blob(img, config, decorations, radius, type) {
  this.size = 36;
  this.img = img;
  this.c = config;

  // get land type
  var type = type || Math.floor(Math.random() * this.c.land_type.length);
  this.ref = this.c.land_type[type];

  // set up main anchor points
  var anchors = [];
  var points = Math.floor(radius / 2) + 4;
  var spike = Math.floor(radius / 2) + 2;
  for (var p = 0; p < points; p++) {
    var new_radius =
      Math.max(radius - Math.floor(Math.random() * spike), 1) + 1;
    var x =
      radius + Math.floor(new_radius * Math.cos((2 * Math.PI * p) / points));
    var y =
      radius + Math.floor(new_radius * Math.sin((2 * Math.PI * p) / points));
    anchors.push({ x: x, y: y });
  }

  // draw shape to canvas
  var size = radius * 2 + 1;
  var shape = mapgen_canvas(size, size);
  this.draw_path(shape, anchors);

  // build array of land or not tiles
  var pixels = shape.cont.getImageData(0, 0, shape.w, shape.h);
  this.land = [];
  for (var y = 0; y < size; y++) {
    this.land[y] = [];
    for (var x = 0; x < size; x++) {
      var i = (y * size + x) * 4 + 3;
      this.land[y][x] = pixels.data[i] > 30 ? 1 : 0;
    }
  }

  // build tile array and assign corners and land
  this.tiles = [];
  for (var y = 0; y < size; y++) {
    this.tiles[y] = [];
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] = this.set_corner_tile(y, x);
    }
  }

  // assign pixels a tile value
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] =
        this.tiles[y][x] === 12 ? this.set_land_tile(y, x) : this.tiles[y][x];
    }
  }

  // draw them
  var wh = (size + 4) * this.size;
  this.alpha = mapgen_canvas(wh, wh);
  this.edge = mapgen_canvas(wh, wh);
  this.bg = mapgen_canvas(wh, wh);
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      var tile = this.tiles[y][x];
      if (tile === -1) {
        continue;
      }

      // draw it
      var x1 = (x + 2) * this.size;
      var y1 = (y + 2) * this.size;
      this.draw_to_canvas(this.alpha.cont, x1, y1, tile, 0);
      this.draw_to_canvas(this.edge.cont, x1, y1, tile, this.ref.edge);

      if (decorations) {
        this.draw_decoration(this.bg.cont, x, y, tile);
      }
    }
  }

  // draw rest of fg
  var fg = mapgen_pattern(this.alpha.canv, this.img[this.ref.fg]);
  fg.cont.drawImage(this.edge.canv, 0, 0);

  // draw dirt bg
  var fg_dirt = mapgen_pattern(fg.canv, this.img[this.ref.bg]);
  this.bg.cont.drawImage(fg_dirt.canv, 0, 0);

  // export
  return {
    fg: fg,
    bg: this.bg
  };
}

/* Draw an alpha path
	---------------------------------------- */

mapgen_blob.prototype.draw_path = function(canv, path) {
  // start paths on canvases
  canv.cont.beginPath();
  canv.cont.moveTo(path[0].x, path[0].y);

  // go through path
  for (var i = 1; i < path.length - 1; i++) {
    // get next point to curve around
    var point1 = path[i],
      point2 = path[i + 1],
      qx,
      qy;

    // get curve values
    if (i < path.length - 1) {
      qx = (point1.x + point2.x) / 2;
      qy = (point1.y + point2.y) / 2;
    } else {
      qx = point2.x;
      qy = point2.y;
    }

    // draw curve to path
    canv.cont.quadraticCurveTo(point1.x, point1.y, qx, qy);
  }

  // rejoin the beginning of the path and fill
  canv.cont.lineTo(path[0].x, path[0].y);
  canv.cont.fill();
};

/* Draw a decoration
	---------------------------------------- */

mapgen_blob.prototype.draw_decoration = function(cont, x, y, tile) {
  // are we drawing one
  if (tile > 7 || Math.floor(Math.random() * 2) !== 0) {
    return;
  }

  // can we do doubles
  var double = false;
  if (tile === 0 && this.is_type(y, x + 1, 0)) {
    double = true;
  }
  if (tile === 1 && this.is_type(y, x - 1, 1)) {
    double = true;
  }
  if (tile === 2 && this.is_type(y - 1, x, 2)) {
    double = true;
  }
  if (tile === 3 && this.is_type(y + 1, x, 3)) {
    double = true;
  }
  if (tile === 4 && this.is_type(y - 1, x + 1, 4)) {
    double = true;
  }
  if (tile === 5 && this.is_type(y + 1, x + 1, 5)) {
    double = true;
  }
  if (tile === 6 && this.is_type(y - 1, x - 1, 6)) {
    double = true;
  }
  if (tile === 7 && this.is_type(y + 1, x - 1, 7)) {
    double = true;
  }

  // choose source
  var source = this.ref.decorations[1];
  if (double && Math.floor(Math.random() * 2) === 0) {
    source = this.ref.decorations[2];
  } else {
    double = false;
  }

  // choose decoration
  var i = Math.floor(Math.random() * source.length);
  var ref = source[i];

  // get position to draw it
  var half = this.size / 2;
  var x1 = (x + 2) * this.size;
  var y1 = (y + 2) * this.size;
  var angle = 0;
  if (tile === 1) {
    x1 += this.size;
    y1 += this.size;
    angle = 180;
  }
  if (tile === 2) {
    y1 += this.size;
    angle = 270;
  }
  if (tile === 3) {
    x1 += this.size;
    angle = 90;
  }
  if (tile === 4) {
    y1 += this.size;
    angle = 315;
  }
  if (tile === 5) {
    angle = 45;
  }
  if (tile === 6) {
    x1 += this.size;
    y1 += this.size;
    angle = 225;
  }
  if (tile === 7) {
    x1 += this.size;
    angle = 135;
  }

  // draw that shit
  var x_add = double ? this.size : 0;
  cont.save();
  cont.translate(x1, y1);
  cont.rotate((angle * Math.PI) / 180);
  cont.drawImage(
    this.img.decorations,
    ref.x,
    ref.y,
    ref.w,
    ref.h,
    0,
    -ref.h + 5,
    ref.w,
    ref.h
  );
  cont.translate(-x1, -y1);
  cont.restore();
};

/* Draw a tile to a canvas
	---------------------------------------- */

mapgen_blob.prototype.draw_to_canvas = function(cont, x, y, tile, key) {
  var ts = this.size;
  cont.save();
  cont.translate(x, y);
  cont.drawImage(this.img.edge, tile * ts, key * ts, ts, ts, 0, 0, ts, ts);
  cont.translate(-y, -y);
  cont.restore();
};

/* Get corner and land tiles
	---------------------------------------- */

mapgen_blob.prototype.set_corner_tile = function(y, x) {
  var tile = -1;

  //land
  if (this.is_land(y, x)) {
    tile = 12;

    // not land
  } else {
    // corners
    if (
      !this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 4;
    } else if (
      !this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 5;
    } else if (
      this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 6;
    } else if (
      this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 7;
    }
  }

  return tile;
};

/* Set land tile types
	---------------------------------------- */

mapgen_blob.prototype.set_land_tile = function(y, x) {
  var tile = 12;

  // corners
  if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 4;
  } else if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 5;
  } else if (
    !this.is_land(y, x - 1) &&
    !this.is_land(y + 1, x) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 6;
  } else if (
    !this.is_land(y + 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x - 1) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 7;

    // flat edges
  } else if (
    !this.is_land(y - 1, x) &&
    this.is_land(y + 1, x) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 0;
  } else if (
    !this.is_land(y + 1, x) &&
    this.is_land(y - 1, x) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 1;
  } else if (
    !this.is_land(y, x - 1) &&
    this.is_land(y, x + 1) &&
    !this.is_corner(y, x - 1)
  ) {
    tile = 2;
  } else if (
    !this.is_land(y, x + 1) &&
    this.is_land(y, x - 1) &&
    !this.is_corner(y, x + 1)
  ) {
    tile = 3;

    // inside corners
  } else if (this.is_type(y + 1, x, 7) || this.is_type(y, x + 1, 7)) {
    tile = 8;
  } else if (this.is_type(y + 1, x, 6) || this.is_type(y, x - 1, 6)) {
    tile = 9;
  } else if (this.is_type(y - 1, x, 5) || this.is_type(y, x + 1, 5)) {
    tile = 10;
  } else if (this.is_type(y - 1, x, 4) || this.is_type(y, x - 1, 4)) {
    tile = 11;
  }

  return tile;
};

/* Check arrays for values
	---------------------------------------- */

mapgen_blob.prototype.is_land_or_corner = function(y, x) {
  if (this.is_corner(y, x) || this.is_land(y, x)) {
    return true;
  }
};

mapgen_blob.prototype.is_corner = function(y, x) {
  return this.check_arr(this.tiles, y, x, [4, 5, 6, 7]);
};

mapgen_blob.prototype.is_type = function(y, x, type) {
  return this.check_arr(this.tiles, y, x, [type]);
};

mapgen_blob.prototype.is_land = function(y, x) {
  return this.check_arr(this.land, y, x, [1]);
};

mapgen_blob.prototype.check_arr = function(arr, y, x, checks) {
  if (y < 0 || y >= arr.length || x < 0 || x >= arr[0].length) {
    return false;
  }
  for (var i = 0; i < checks.length; i++) {
    if (arr[y][x] == checks[i]) {
      return true;
    }
  }
};

/* ========================================================================
	Map Generator
	Make Canvas
 ========================================================================== */

/* Set up a new canvas
	---------------------------------------- */

function mapgen_canvas(w, h) {
  var obj = {};
  if ("undefined" != typeof global) {
    obj.canv = new canvas();
  } else {
    obj.canv = document.createElement("canvas");
  }
  obj.cont = obj.canv.getContext("2d");
  obj.canv.width = w;
  obj.canv.height = h;
  obj.cont.fillStyle = "#fff";
  obj.w = w;
  obj.h = h;
  return obj;
}

/* Draw a pattern to a canvas
	---------------------------------------- */

function mapgen_pattern(alpha, pattern) {
  var canv = mapgen_canvas(alpha.width, alpha.height);
  if (typeof pattern !== "string") {
    pattern = canv.cont.createPattern(pattern, "repeat");
  }
  canv.cont.fillStyle = pattern;
  canv.cont.fillRect(0, 0, alpha.width, alpha.height);
  canv.cont.globalCompositeOperation = "destination-in";
  canv.cont.drawImage(alpha, 0, 0);
  canv.cont.globalCompositeOperation = "normal";

  return canv;
}

/* ========================================================================
	Map Generator
	------------
	Config:
	w           // width of map
	h           // height of map
	crust       // thickness of outer crust on land
	blobs       // initial blobs
	center_blob // size of center blob of land, 0 for none
	small_blobs // number of random small circles of land
	large_blobs // number of random large circles of land
	-----------
 ========================================================================== */

/* Server side only
	---------------------------------------- */

if ("undefined" != typeof global) {
  var fs = require("fs");
}

/* New Map Generation
	---------------------------------------- */

function mapgen(img, config, scheme, map_img) {
  this.size = 36;
  this.img = img;
  this.c = config;
  this.scheme = scheme;

  // choose type
  if (this.scheme.type == "random") {
    return this.draw_random();
  }
  if (this.scheme.type == "image") {
    return this.draw_image(map_img);
  }
}

/* Draw image
	---------------------------------------- */

mapgen.prototype.draw_image = function(map_img) {
  var fg = mapgen_canvas(
    map_img.width + this.scheme.gap * 2,
    map_img.height + this.scheme.gap * 2
  );
  fg.cont.drawImage(map_img, this.scheme.gap, this.scheme.gap);
  var bg = mapgen_pattern(fg.canv, this.img.dirt);
  return { fg: fg, bg: bg };
};

/* Draw random
	---------------------------------------- */

mapgen.prototype.draw_random = function() {
  // setup
  this.blobs = JSON.parse(JSON.stringify(this.scheme.blobs));
  this.bg = mapgen_canvas(this.scheme.w, this.scheme.h);
  this.fg = mapgen_canvas(this.scheme.w, this.scheme.h);

  // generate some random large circles
  for (var i = 0; i < this.scheme.large_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 4, 6);
  }

  // generate some random small circles
  for (var i = 0; i < this.scheme.small_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 1, 3);
  }

  // go through each blob
  for (var i = 0; i < this.blobs.length; i++) {
    var blob = this.blobs[i];

    // create the blobs
    var bg = new mapgen_blob(this.img, this.c, false, blob.r + 4, blob.type);
    var fg = new mapgen_blob(
      this.img,
      this.c,
      this.scheme.decorations,
      blob.r,
      blob.type
    );

    // combine the backgrounds
    var wh = fg.fg.canv.width;
    var new_bg = mapgen_canvas(wh, wh);
    new_bg.cont.drawImage(bg.fg.canv, wh * 0.1, wh * 0.1, wh * 0.8, wh * 0.8);
    new_bg.cont.globalCompositeOperation = "source-atop";
    new_bg.cont.fillStyle = "rgba(0,0,0,0.8)";
    new_bg.cont.fillRect(0, 0, wh, wh);
    new_bg.cont.globalCompositeOperation = "normal";
    new_bg.cont.drawImage(fg.bg.canv, 0, 0);

    // draw it to main canvas
    this.bg.cont.drawImage(new_bg.canv, blob.x - wh / 2, blob.y - wh / 2);
    this.fg.cont.drawImage(fg.fg.canv, blob.x - wh / 2, blob.y - wh / 2);
  }

  // return it
  return {
    bg: this.bg,
    fg: this.fg
  };
};

/* Get a far away circle
	---------------------------------------- */

mapgen.prototype.get_circle = function(arr, min_radius, max_radius) {
  // generate many circles and find furthest away
  var distance = 0;
  var circle = null;

  for (var i = 0; i < 20; i++) {
    // make new circle
    var test_circle = this.circle(min_radius, max_radius);
    var smallest_distance = 999999;

    // find shortest distance from all other circles
    for (var j = 0; j < arr.length; j++) {
      var dx = arr[j].x - test_circle.x;
      var dy = arr[j].y - test_circle.y;
      var test_distance = Math.round(
        Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))
      );
      smallest_distance =
        test_distance < smallest_distance ? test_distance : smallest_distance;
    }

    // if is the largest distance record this as furthest
    if (distance < smallest_distance) {
      distance = smallest_distance;
      circle = test_circle;
    }
  }

  // add furthest away circle to new array
  arr.push(circle);
  return arr;
};

/* Generate a random circle
	---------------------------------------- */

mapgen.prototype.circle = function(min_radius, max_radius) {
  var r = Math.floor(Math.random() * max_radius) + min_radius;
  var gap = (r + 2) * this.size + this.scheme.gap;
  var x = Math.floor(Math.random() * (this.scheme.w - gap * 2)) + gap;
  var y = Math.floor(Math.random() * (this.scheme.h - gap * 2)) + gap;
  return {
    r: r,
    x: x,
    y: y
  };
};

var schemes = schemes || {};
schemes.deathmatch = {
  title: "Deathmatch",
  time_limit: 0,
  destroy_land: true,
  gravity: 2,
  score: true,
  drops: {
    crate: {
      time: 100,
      max: 1
    },
    medpack: {
      time: 100,
      add: 30,
      max: 1
    },
    "gem-1": {
      time: 100,
      max: 5
    },
    "gem-5": {
      time: 150,
      max: 1
    },
    "gem-20": {
      time: 500,
      max: 1
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 5,
      crate_chance: 1,
      crate_count: 5
    },
    paingiver: {
      start_count: 20,
      crate_chance: 1,
      crate_count: 5
    }
  },
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1900,
    h: 1400,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

var schemes = schemes || {};
schemes.default = {
  title: "",
  description: "",
  time_limit: 0,
  show_time: true,
  destroy_land: true,
  gravity_type: "land",
  gravity: 1,
  stars: {},
  score: false,
  health: true,
  levels: {
    score: [
      0,
      10,
      25,
      40,
      60,
      90,
      120,
      150,
      200,
      250,
      300,
      360,
      420,
      490,
      570,
      650,
      720,
      810,
      900,
      1000
    ],
    health: [
      100,
      120,
      120,
      120,
      140,
      140,
      140,
      140,
      160,
      180,
      200,
      200,
      200,
      200,
      220,
      220,
      220,
      220,
      240,
      300
    ],
    damage: [
      0,
      10,
      10,
      15,
      15,
      15,
      15,
      20,
      20,
      25,
      25,
      25,
      30,
      30,
      30,
      30,
      35,
      35,
      35,
      50
    ],
    speed: [
      4,
      6,
      8,
      8,
      8,
      8,
      10,
      10,
      10,
      12,
      12,
      12,
      12,
      14,
      14,
      14,
      14,
      16,
      16,
      20
    ],
    jump: [
      10,
      12,
      12,
      12,
      12,
      15,
      15,
      15,
      15,
      18,
      18,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      25
    ]
  },
  drops: {
    crate: {
      time: 0,
      max: 20
    },
    medpack: {
      time: 0,
      add: 30,
      max: 50
    },
    nuclear: {
      time: 0,
      max: 20
    },
    target: {
      time: 0,
      max: 100
    },
    asteroid_center: {
      time: 0,
      increase_frequency: false,
      max: 30
    },
    "gem-1": {
      time: 0,
      max: 20
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 1
    },
    paingiver: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 10
    }
  },
  armoury: [
    "dig",
    "phaser",
    "bazookoid",
    "grenade",
    "punch",
    "pumpkin",
    "paingiver"
  ],
  arrows: {
    nuclear: "green",
    player: "red",
    target: "blue",
    "asteroid-small": "grey",
    "asteroid-large": "grey",
    vortex: "purple",
    crate: "blue"
  },
  spawn: [],
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1000,
    h: 1000,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

/* ========================================================================
	Map Gravity
 ========================================================================== */

/* Set up gravity
	----------------------------------------- */

core_map.prototype.init_gravity = function(gravity_map) {
  this.weight = this.scheme.gravity || 1;
  this.gravity_type = this.scheme.gravity_type || "land";

  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // set values
  this.gravity = {
    w: 0,
    h: 0,
    map: [],
    scale: 24,
    reach: 18
  };

  if (gravity_map) {
    this.gravity.map = JSON.parse(gravity_map);
    this.gravity.w = this.gravity.map[0].length;
    this.gravity.h = this.gravity.map.length;
  } else {
    this.init_gravity_map();
  }
};

/* Generate gravity map
	---------------------------------------- */

core_map.prototype.init_gravity_map = function() {
  // set size of new gravity grid
  this.gravity.w = ceil(this.w / this.gravity.scale);
  this.gravity.h = ceil(this.h / this.gravity.scale);

  // generate map array
  var new_arr = [];
  for (var y = 0; y < this.gravity.h; y++) {
    this.gravity.map[y] = [];
    for (var x = 0; x < this.gravity.w; x++) {
      this.gravity.map[y].push([0, 0, 0]);
    }
  }

  // do the calculating
  this.action_gravity_generate(0, 0, this.w, this.h);
};

/* Apply new gravity calculations to a set of pixels
	---------------------------------------- */

core_map.prototype.action_gravity_generate = function(x, y, w, h) {
  // calculate which tiles are affected
  var x1 = max(0, min(floor(x / this.gravity.scale), this.gravity.w));
  var y1 = max(0, min(floor(y / this.gravity.scale), this.gravity.h));
  var x2 = max(0, min(floor((x + w) / this.gravity.scale), this.gravity.w));
  var y2 = max(0, min(floor((y + h) / this.gravity.scale), this.gravity.h));

  // get the weight of all affected tiles
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      this.gravity.map[y3][x3][0] = this.get_tile_weight(x3, y3);
    }
  }

  // calculate surrounding tiles
  var x1 = max(0, min(x1 - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y1 - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x2 + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y2 + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var xy = this.get_tile_gravity(x3, y3);
      this.gravity.map[y3][x3][1] = xy.x;
      this.gravity.map[y3][x3][2] = xy.y;
    }
  }
};

/* Get weight of a tile in the gravity map
	---------------------------------------- */

core_map.prototype.get_tile_weight = function(x, y) {
  // limit x and y to within the area
  var y1 = max(0, min(y * this.gravity.scale, this.h));
  var x1 = max(0, min(x * this.gravity.scale, this.w));
  var y2 = max(0, min(y * this.gravity.scale + this.gravity.scale, this.h));
  var x2 = max(0, min(x * this.gravity.scale + this.gravity.scale, this.w));

  // go through the grid of pixels
  var c = 0;
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var id = this.i(x3, y3);
      if (id == 1 || id == 2) {
        c += 1;
      }
      if (id == 3) {
        c += 3;
      }
    }
  }
  return c;
};

/* Get gravity of a tile from the weight of surrounding tiles
	---------------------------------------- */

core_map.prototype.get_tile_gravity = function(x, y) {
  // calculate surrounding tiles
  var wx = 0;
  var wy = 0;
  var x1 = max(0, min(x - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      wx += (x3 - x) * this.gravity.map[y3][x3][0];
      wy += (y3 - y) * this.gravity.map[y3][x3][0];
    }
  }

  wx = round(wx / 5000 / this.gravity.reach) / 60;
  wy = round(wy / 5000 / this.gravity.reach) / 60;

  return {
    x: wx,
    y: wy
  };
};

/* Reset gravity from destruction event
	---------------------------------------- */

core_map.prototype.gravity_event_recalculate = function(x, y, radius) {
  // if we are not using land gravity
  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // recalculate gravity
  var x1 = round(x - radius);
  var y1 = round(y - radius);
  var size = round(radius * 2 + 1);
  this.action_gravity_generate(x1, y1, size, size);
};

/* Return gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity = function(x, y) {
  // flat
  if (this.scheme.gravity_type === "flat") {
    return { x: 0, y: this.weight };
  }

  // map
  if (this.scheme.gravity_type === "land") {
    var x1 = max(0, min(round(x / this.gravity.scale), this.gravity.w - 1));
    var y1 = max(0, min(round(y / this.gravity.scale), this.gravity.h - 1));
    var obj = this.gravity.map[y1][x1];
    return {
      x: min(obj[1], 1) * this.weight,
      y: min(obj[2], 1) * this.weight
    };
  }
};

/* Return the angle of gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity_angle = function(x, y) {
  var grav = this.get_gravity(x, y);
  var a1 = get_angle(grav.x, grav.y);
  return a1;
};

/* ========================================================================
	Map Ground Checkers
 ========================================================================== */

/* Get array of offsets to check in an angles direction
	---------------------------------------- */

core_map.prototype.get_angle_offsets = function(a) {
  if (a > 22 && a <= 67) {
    return [[-1, -1], [0, -1], [-1, 0], [1, -1], [-1, 1], [1, 0], [0, 1]];
  } // up left
  if (a > 67 && a <= 112) {
    return [[0, -1], [-1, -1], [1, -1], [-1, 0], [1, 0], [-1, 1], [1, 1]];
  } // up
  if (a > 112 && a <= 157) {
    return [[1, -1], [0, -1], [1, 0], [-1, -1], [1, 1], [-1, 0], [0, 1]];
  } // up right
  if (a > 157 && a <= 202) {
    return [[1, 0], [1, -1], [1, 1], [0, -1], [0, 1], [-1, -1], [-1, 1]];
  } // right
  if (a > 202 && a <= 247) {
    return [[1, 1], [1, 0], [0, 1], [1, -1], [-1, 1], [0, -1], [-1, 0]];
  } // down right
  if (a > 247 && a <= 292) {
    return [[0, 1], [-1, 1], [1, 1], [-1, 0], [1, 0], [-1, -1], [1, -1]];
  } // down
  if (a > 292 && a <= 337) {
    return [[-1, 1], [-1, 0], [0, 1], [-1, -1], [1, 1], [0, -1], [1, 0]];
  } // down left
  if (a > 337 || a <= 22) {
    return [[-1, 0], [-1, -1], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 1]];
  } // left
};

/* Calculate walk path by angle
	---------------------------------------- */

core_map.prototype.walk = function(x, y, px, py, angle, speed) {
  // get neighboring pixels
  var offsets = this.get_angle_offsets(angle);

  // record old position
  var ox = x;
  var oy = y;

  // record result
  var result = {
    move: false, // we are moving
    angle: 0, // actual angle of movement
    path: [] // recorded coordinates
  };

  // go through number of movements per frame
  for (var i = 0; i < speed; i++) {
    var moved = false;

    // go through directional pixels to check based on angle of path
    for (var j = 0; j < offsets.length; j++) {
      // co-ordinates we're checking
      var x1 = x + offsets[j][0];
      var y1 = y + offsets[j][1];

      // if is previous location, land or not an edge
      if ((x1 == px && y1 == py) || !this.ground_pixel(x1, y1)) {
        continue;
      }

      // set new position
      px = x;
      py = y;
      x = x1;
      y = y1;
      result.move = true;
      result.angle = get_heading(ox, oy, x, y);
      result.path.push({ x: x1, y: y1 });

      var moved = true;
      break;
    }

    // if movement failed
    if (!moved) {
      break;
    }
  }

  // set direction left or right
  result.direction = this.ground_dir(ox, oy, x, y);

  return result;
};

/* Check a pixel is next to ground
	---------------------------------------- */

core_map.prototype.ground_pixel = function(x, y) {
  // if we have hit ground
  if (this.i(x, y)) {
    return false;
  }

  var trigger = false,
    off = [
      [0, -1],
      [-1, 0],
      [1, 0],
      [0, 1],
      [-1, -1],
      [-1, 1],
      [1, 1],
      [1, -1]
    ];

  for (var i = 0; i < off.length; i++) {
    // go through offsets
    var x1 = x + off[i][0]; // new x coordinate
    var y1 = y + off[i][1]; // new y coordinate
    if (this.i(x1, y1)) {
      // if pixel is land
      trigger = true; // we did it
      break;
    }
  }

  return trigger;
};

/* Calculate left or right movement
	//
	// calculates direction of land from a line of movement
	// 1. rotate line coords 90 degrees
	// 2. if the top part of the new line has more land then we are moving right
	// 3. if the bottom part we are moving left
	// 4. bananas, all of it
	---------------------------------------- */

core_map.prototype.ground_dir = function(x1, y1, x2, y2) {
  // rotate co-ordinated 90 degrees to point into the ground we're on
  var center_x = x1 + (x2 - x1) / 2;
  var center_y = y1 + (y2 - y1) / 2;
  var rotated_1 = rotate_coords(x1, y1, center_x, center_y, 90);
  var rotated_2 = rotate_coords(x2, y2, center_x, center_y, 90);

  // plot a course of co-ordinates to check
  var speed_x = this.get_distance_x(rotated_1.x, rotated_2.x);
  var speed_y = this.get_distance_y(rotated_1.y, rotated_2.y);
  var plotted = plot_course(rotated_1.x, rotated_1.y, speed_x, speed_y, 8);
  if (!plotted.move) {
    return "right";
  }

  // go through course and count which side has more land on it
  var count_left = 0,
    count_right = 0;
  for (var i = 0; i < plotted.points.length; i++) {
    var point = plotted.points[i];
    if (this.i(round(point.x), round(point.y))) {
      if (i < plotted.points.length / 2) {
        count_right++;
      } else {
        count_left++;
      }
    }
  }
  return count_left > count_right ? "left" : "right";
};

/* Set values in a circle in the ground array
	---------------------------------------- */

core_map.prototype.set_circle = function(x, y, radius, type) {
  // get boundaries
  var x1 = max(round(x - radius), 0);
  var x2 = min(round(x + radius), this.w - 1);
  var y1 = max(round(y - radius), 0);
  var y2 = min(round(y + radius), this.h - 1);

  // loop through co-ordinates
  for (var ly = y1; ly <= y2; ly++) {
    for (var lx = x1; lx <= x2; lx++) {
      if (in_circle(lx, ly, x, y, radius)) {
        this.i_set(lx, ly, type);
      }
    }
  }
};

/* Set block of cells from arr
	---------------------------------------- */

core_map.prototype.set_block_from_arr = function(x, y, arr) {
  for (var ly = 0; ly < arr.length; ly++) {
    for (var lx = 0; lx < arr[ly].length; lx++) {
      this.i_set(x + lx, y + ly, arr[ly][lx]);
    }
  }
};

/* Get block of cells
	---------------------------------------- */

core_map.prototype.get_block = function(x, y, w, h) {
  var response = [];

  // loop through co-ordinates
  for (var ly = 0; ly < h; ly++) {
    response[ly] = [];
    for (var lx = 0; lx < w; lx++) {
      response[ly][lx] = this.i(lx + x, ly + y);
    }
  }

  return response;
};

/* Find nearby ground spot
	---------------------------------------- */

core_map.prototype.find_ground_nearby = function(x, y) {
  var x1 = round(x);
  var y1 = round(y);

  // already on ground
  if (this.ground_pixel(x1, y1)) {
    return { x: x1, y: y1 };
  }

  var spiral_1 = 0;
  var spiral_2 = 1;
  var inc = 1;
  var dir = true;

  for (var i = 0; i < 450; i++) {
    x1 += dir ? inc : 0;
    y1 += !dir ? inc : 0;
    spiral_1++;
    if (spiral_1 == spiral_2) {
      spiral_1 = 0;
      if ((dir = !dir)) {
        inc = inc == 1 ? -1 : 1;
        spiral_2++;
      }
    }

    // check point for ground pixels
    if (this.ground_pixel(x1, y1)) {
      return { x: x1, y: y1 };
    }
  }
  return false;
};

/* Get random empty spot
	---------------------------------------- */

core_map.prototype.air_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if air pixel
    if (id == 0) {
      return { x: x, y: y };
    }

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* Get random ground spot
	---------------------------------------- */

core_map.prototype.ground_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if not land pixel
    if (id !== 1 && id !== 2) {
      continue;
    }

    // plot course to random angle
    var angle = rand(0, 360);
    for (var i = 0; i < 100; i++) {}

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* ========================================================================
    Map
 ========================================================================== */

// create map object
function core_map(canv, scheme, gravity_map) {
  // Server side only
  if ("undefined" != typeof global) {
    var canvas = require("canvas");
  }

  this.scheme = scheme;

  // set dimensions
  this.w = canv.canv.width;
  this.h = canv.canv.height;

  // get pixels
  var pixels = canv.cont.getImageData(0, 0, this.w, this.h);
  var length = Math.floor(pixels.data.length / 4);

  // create 8 bit alpha array
  // 0. air
  // 1. destructible land
  // 2. indestructible land
  // 3. sun
  this.arr = new Int8Array(length);
  for (var i = 0; i < length; i++) {
    if (pixels.data[i * 4 + 3] > 30) {
      this.arr[i] = 1;
    }
  }

  // set up gravity
  this.init_gravity(gravity_map);
}

/* Get and set array co-ordinate values
	---------------------------------------- */

core_map.prototype.i_get = function(x, y) {
  var x2 = this.loop_x(x);
  var y2 = this.loop_y(y);
  return y2 * this.w + x2;
};

core_map.prototype.i = function(x, y) {
  var i = this.i_get(x, y);
  if (i == null) {
    return 0;
  } else {
    return this.arr[i];
  }
};

core_map.prototype.i_set = function(x, y, val) {
  var i = this.i_get(x, y);
  if (i) {
    this.arr[i] = val;
  }
};

/* Get distance between two points in looping area
	---------------------------------------- */

core_map.prototype.get_distance = function(x1, y1, x2, y2) {
  var x = this.get_distance_x(x1, x2);
  var y = this.get_distance_y(y1, y2);
  return get_speed(x, y);
};

core_map.prototype.get_distance_x = function(x1, x2) {
  return n_diff(x1, x2, 0, this.w);
};
core_map.prototype.get_distance_y = function(y1, y2) {
  return n_diff(y1, y2, 0, this.h);
};

/* Get heading between two points in looping area
	---------------------------------------- */

core_map.prototype.get_heading = function(x1, y1, x2, y2) {
  var x = n_diff(x1, x2, 0, this.w);
  var y = n_diff(y1, y2, 0, this.h);
  return get_angle(x, y);
};

/* Get looping co-ordinate
	---------------------------------------- */

core_map.prototype.loop_x = function(x) {
  return n_loop(x, 0, this.w - 1);
};

core_map.prototype.loop_y = function(y) {
  return n_loop(y, 0, this.h - 1);
};

/* ========================================================================
    App
 ========================================================================== */

const url = new URL(window.location);
const watch = !!url.searchParams.get("watch");

function app() {
  var self = this;
  this.assets_url = ASSETS;
  this.assets = {};
  this.started = false;
  this.watch = watch;
  this.nickname = "the watcher";

  this.sockets = new SocketConnection(function(event) {
    self.run_event(event);
  });
  this.init_interface();

  this.input = new input(function(event) {
    self.run_event(event);
  });
  this.audio = new audio();

  this.init_settings();

  if (this.watch || singlePlayer) {
    this.load_room();
  } else {
    this.init_start();
  }
}

/* Load room
    ---------------------------------------- */

app.prototype.load_room = function() {
  if (this.start) {
    hide(this.start);
  }
  show(this.loading);

  // load assets
  var self = this;
  new loader(
    this.assets_url,
    {
      img: {
        sprites: "/images/sprites/sprites.png",
        bg: "/images/textures/space.jpg"
      },
      audio: {
        bleep1: "/audio/bleep1.mp3",
        bloop1: "/audio/bloop1.mp3",
        bloop2: "/audio/bloop2.mp3",
        bing: "/audio/bing.mp3",
        dig: "/audio/dig.mp3",
        doink: "/audio/doink.mp3",
        donk: "/audio/donk.mp3",
        explosion: "/audio/explosion.mp3",
        explosion_gas: "/audio/explosion_gas.mp3",
        explosion_laser: "/audio/explosion_laser.mp3",
        homing: "/audio/homing.mp3",
        fly: "/audio/fly.mp3",
        countdown: "/audio/countdown.mp3",
        jump: "/audio/jump.mp3",
        levelup: "/audio/levelup.mp3",
        locknload: "/audio/locknload.mp3",
        phase: "/audio/phase.mp3",
        pop: "/audio/pop.mp3",
        punch: "/audio/punch.mp3",
        shoot: "/audio/shoot.mp3",
        shoot_laser: "/audio/shoot_laser.mp3",
        throw: "/audio/throw.mp3",
        spooky: "/audio/spooky.mp3",
        walk: "/audio/walk.mp3"
      }
    },
    function(assets) {
      self.init_room(assets);
    }
  );
};

/* Start the app
    ---------------------------------------- */

app.prototype.init_room = function(assets) {
  hide(this.loading);

  this.started = true;
  this.assets = assets;
  this.audio.add_buffers(assets.audio);

  if (singlePlayer) {
    this.room = new demo(
      this.assets,
      this.assets_url,
      this.audio,
      this.input,
      "Demo name"
    );
  } else {
    this.room = new multiplayer(
      this.assets,
      this.assets_url,
      this.audio,
      this.input,
      this.nickname,
      this.watch,
      this.run_event,
      this.sockets,
      new onboarding()
    );
    if (this.watch) {
      this.sockets.message_send("watcher", []);
    } else {
      this.nickname = this.check_name(this.nickname);
      this.sockets.message_send("send_name", [this.nickname]);
    }
  }
  append(this.div, this.room.div);
};

window.onload = function() {
  new app();
};

/* ========================================================================
    App
    Events
 ========================================================================== */

/* Events
    ---------------------------------------- */

app.prototype.run_event = function(event) {
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // show and hide menu
  if (event.type == "show_menu") {
    show(this.menu);
  } else if (event.type == "hide_menu") {
    hide(this.menu);

    // if game is full
  } else if (event.type === "full") {
    hide(this.loading);
    show(this.game_full);
    if (this.room && this.room.connecting) {
      hide(this.room.connecting);
    }

    // show the controls screen
  } else if (event.type == "show_settings") {
    this.toggle_settings_screen();

    // send event down a level
  } else {
    if (this.room) {
      this.room.run_event(event);
    }
  }
};

/* ========================================================================
    App Interface
 ========================================================================== */

app.prototype.init_interface = function() {
  this.div = element({ id: "projectants", class: "app" });
  append(document.body, this.div);

  // game full
  this.game_full = element({
    class: "cont_center",
    text: "Oh dear, this room is very full!<br><br><br></div>"
  });
  this.button_new_game = element({
    type: "button",
    class: "button red",
    text: "Find A New One"
  });
  append(this.div, this.game_full);
  append(this.game_full, this.button_new_game);
  hide(this.game_full);

  // find new room
  this.button_new_game.onclick = function() {
    window.location = "/";
  };

  // limit game aspect ratio
  var ratio = this.div.offsetWidth / this.div.offsetHeight;
  this.div.style.width =
    ratio > 1.8
      ? round(this.div.offsetHeight * 1.8) + "px"
      : this.div.offsetWidth + "px";
  this.div.style.height =
    ratio < 1 ? this.div.offsetWidth + "px" : this.div.offsetHeight + "px";

  // loading
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);
};

/* ========================================================================
    App
    Settings
 ========================================================================== */

/* Start settings screen
    ---------------------------------------- */

app.prototype.init_settings = function() {
  var self = this;

  // corner button
  this.icon_settings = element({ class: "settings" });
  this.icon_settings_img = element({
    type: "img",
    src: this.assets_url + "/images/cog.png"
  });
  append(this.div, this.icon_settings);
  append(this.icon_settings, this.icon_settings_img);

  this.settings_visible = false;
  this.icon_settings.onclick = function() {
    self.toggle_settings_screen();
  };

  // box
  this.div_settings = element({ class: "full full_bg" });
  this.div_settings_cont = element({
    class: "cont_center div_controls",
    text: "<div class='top_message'>Settings</div>"
  });
  append(this.div, this.div_settings);
  append(this.div_settings, this.div_settings_cont);
  hide(this.div_settings);

  // volume
  this.div_volume = element({ text: "<h2>Volume</h2>" });
  this.input_volume = element({ type: "input" });
  this.input_volume.type = "range";
  this.input_volume.setAttribute("min", 0);
  this.input_volume.setAttribute("max", 1);
  this.input_volume.setAttribute("step", 0.1);
  this.input_volume.value = this.audio.volume;
  append(this.div_settings_cont, this.div_volume);
  append(this.div_volume, this.input_volume);

  this.input_volume.onchange = function(e) {
    self.audio.set_global_volume(this.value);
  };

  // controls
  var ctext = "<h2>Controls</h2>";
  ctext += "<dl>";
  ctext += "<dt>Move</dt><dd>Left Click</dd>";
  ctext += "<dt>Jump</dt><dd>Spacebar</dd>";
  ctext += "<dt>Shoot</dt><dd>Right Click / Alt + Left Click</dd>";
  ctext += "<dt>Select Weapon</dt><dd>1-9 / Scroll Wheel</dd>";
  ctext += "<dt>Follow Weapons</dt><dd>F</dd>";
  ctext += "<dt>Free Cam</dt><dd>Middle Click</dd>";
  ctext += "</dl>";
  this.div_controls = element({ text: ctext });
  append(this.div_settings_cont, this.div_controls);

  // server
  this.div_server = element({
    text:
      "<h2>Server</h2><p><a href='http://uk.projectants.com/'>UK</a> | <a href='http://us.projectants.com/'>US</a></p>"
  });
  append(this.div_settings_cont, this.div_server);

  // close button
  this.div_settings_buttons = element({ class: "buttons" });
  this.button_close_settings = element({ type: "button", text: "Close" });
  append(this.div_settings_cont, this.div_settings_buttons);
  append(this.div_settings_buttons, this.button_close_settings);

  this.button_close_settings.onclick = function() {
    self.settings_visible = false;
    hide(self.div_settings);
  };
};

app.prototype.toggle_settings_screen = function() {
  if ((this.settings_visible = !this.settings_visible)) {
    this.audio.play("bleep1", 0.8);
    show(this.div_settings);
  } else {
    hide(this.div_settings);
  }
};

/* ========================================================================
    App
    Start Screen
 ========================================================================== */

app.prototype.init_start = function() {
  var self = this;

  // get a new or stored nickname
  this.nickname = config.names[rand(0, config.names.length - 1)];
  if (typeof Storage !== "undefined") {
    var lsname = localStorage.getItem("pants_nn");
    if (config.names.indexOf(lsname) === -1) {
      this.nickname = lsname || this.nickname;
    }
  }

  this.start = element({ class: "start" });
  var logo = element({
    type: "img",
    class: "logo",
    src: this.assets_url + "/images/logo.png"
  });
  var instructions = element({
    type: "ul",
    class: "fade",
    text:
      "<li>Collect gems to get stronger</li><li>Destroy the enemy to get their gems!</li><li>Click to Move</li><li>Alt + Click or Right Click to Shoot</li>"
  });
  this.input_name = element({
    type: "input",
    intype: "text",
    value: this.nickname,
    maxlength: 20
  });
  this.button_start = element({
    type: "button",
    class: "break",
    text: "Play Now"
  });

  append(this.div, this.start);
  append(this.start, logo);
  append(this.start, instructions);
  append(this.start, this.input_name);
  append(this.start, this.button_start);

  // start up the app
  this.button_start.onclick = function() {
    self.load_room();
  };
};

/* Check name
    ---------------------------------------- */

app.prototype.check_name = function() {
  var new_name = this.nickname;
  if (this.input_name) {
    new_name = this.input_name.value;
  }
  new_name = new_name.length > 20 ? new_name.substring(0, 20) : new_name;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_nn", new_name);
  }
  return new_name;
};

/* ========================================================================
    Missions
 ========================================================================== */

function demo(assets, assets_url, audio, input, name) {
  // setup
  this.assets = assets;
  this.assets_url = assets_url;
  this.audio = audio;
  this.input = input;
  this.name = name;
  this.active = false;
  this.player_id = 0;
  this.players_ref = {
    "0": {
      user_id: 0,
      name: name,
      level: 0
    }
  };
  this.scheme = deepmerge(schemes.default, schemes.deathmatch);
  this.div = element({ class: "full" });

  var self = this;
  new loader(
    this.assets_url,
    {
      img: {
        edge: "/images/sprites/edge.png",
        decorations: "/images/sprites/decorations.png",
        dirt: "/images/textures/dirt.png",
        rock: "/images/textures/rock.png"
      }
    },
    function(assets) {
      self.loaded(assets.img);
    }
  );
}

/* Start demo
---------------------------------------- */

demo.prototype.loaded = function(img) {
  // get the map
  this.map = new mapgen(img, config.mapgen, this.scheme.mapgen);
  this.map.fg.cont.globalCompositeOperation = "destination-out";

  // start up game object
  this.game = new game(
    this.assets,
    this.audio,
    this.input,
    this.scheme,
    this.map,
    this.players_ref,
    this.player_id
  );
  append(this.div, this.game.div);

  this.game.core.create_player({ id: this.player_id });
  this.game.core.create_object({ type: "player", player_id: this.player_id });
  this.game.core.init_player(this.player_id);

  this.game.start(0);
  this.game.player.armoury = duplicate_obj(
    this.game.core.state.players[this.player_id].armoury
  );
  this.game.set_armoury();

  console.log(this.game.core.state);

  this.loop_start();
};

/* ========================================================================
    Multiplayer
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

demo.prototype.run_event = function(event) {
  if (!event) {
    return;
  }

  // handle arrays of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // run events
  if (event.type === "player_death") {
    this.event_player_death(event);
  }

  // send event down a level
  else if (this.game) {
    this.game.run_event(event);
  }
};

/* Player death
  ---------------------------------------- */

demo.prototype.event_player_death = function(event) {
  if (this.initialised) {
    console.log("died");
  }
};

/* ========================================================================
    Mulitplayer
    Frames
 ========================================================================== */

/* Start/stop loop
    ---------------------------------------- */

demo.prototype.loop_start = function(start_frame) {
  // close any open loops
  this.loop_stop();

  // set loop vars
  this.start_frame = start_frame || 0;
  this.frames = this.start_frame;
  this.start_time = new Date().getTime();
  this.drop_positions = {};

  var self = this;
  this.interval = setInterval(function() {
    self.frame();
  }, 24);
};

demo.prototype.loop_stop = function() {
  clearInterval(this.interval);
};

/* Frame process
---------------------------------------- */

demo.prototype.frame = function() {
  this.frames++;

  // do drops
  var counts = this.object_counts();
  for (var type in this.scheme.drops) {
    var time = this.scheme.drops[type].time;
    if (time < 1 || counts[type] >= this.scheme.drops[type].max) {
      continue;
    }
    if (this.frames % time === 0) {
      var props = { type: type };
      var obj = this.game.core.spawn(props);
      this.game.create_object(obj);
    }
  }

  // check for level ups
  for (var id in this.players_ref) {
    var player = this.players_ref[id];
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    if (player.level !== core_player.level) {
      this.run_event({
        type: "player_level",
        id: parseInt(id),
        prev: player.level,
        new: core_player.level
      });
      this.players_ref[id].level = core_player.level;
    }
  }

  var action = this.game.player && this.game.get_input();
  this.game.frame_core(this.frames, action);
  this.run_event(this.game.core.state.events);
  this.game.frame_display();
};

/* Object counts
    ---------------------------------------- */

demo.prototype.object_counts = function() {
  var counts = {};
  for (var key in this.game.core.state.objects) {
    var obj = this.game.core.state.objects[key];
    if (!counts[obj.type]) {
      counts[obj.type] = 0;
    }
    counts[obj.type]++;
  }
  return counts;
};

/* ========================================================================
	Audio
 ========================================================================== */

window.AudioContext = window.AudioContext || window.webkitAudioContext;

function audio(assets_url) {
  var self = this;

  this.cont = new AudioContext();
  this.buffers = {};
  this.repeaters = {};
  this.volume = 0.1;
  this.stored_volume = 0.1;

  // button hover swish events
  this.button_hover = null;
  document.onmousemove = function(e) {
    if (self.volume == 0) {
      return;
    }
    if (
      e.target.classList.contains("button") ||
      e.target.tagName.toLowerCase() == "button"
    ) {
      if (
        e.target != self.button_hover &&
        !e.target.classList.contains("disabled")
      ) {
        self.button_hover = e.target;
        self.play("bloop1", 1);
      }
    } else {
      self.button_hover = null;
    }
  };
}

/* Set volume
	---------------------------------------- */

audio.prototype.set_global_volume = function(vol) {
  this.volume = vol;
};

/* Add buffers
	---------------------------------------- */

audio.prototype.add_buffers = function(buffers) {
  this.buffers = Object.assign(this.buffers, buffers);
};

/* Play a file
	---------------------------------------- */

audio.prototype.play = function(key, volume, repeat) {
  // if no sound effect
  if (!this.buffers[key]) {
    return;
  }

  // if we're not active
  if (!document.hasFocus() && key !== "join") {
    return;
  }

  var obj = {};
  obj.audio_key = key;
  obj.gain = this.cont.createGain();
  obj.source = this.cont.createBufferSource();
  obj.source.buffer = this.buffers[key];
  obj.source.connect(obj.gain);
  obj.gain.connect(this.cont.destination);
  obj.source.loop = repeat;
  obj.source.start(0);

  this.set_volume(obj, volume);

  return obj;
};

/* Set volume
	---------------------------------------- */

audio.prototype.set_volume = function(obj, volume) {
  if (!obj) {
    return;
  }
  volume = !volume ? 0 : min(volume, 1);
  obj.gain.gain.value = (volume * this.volume).fixed();
};

/* Stop playing audio
	---------------------------------------- */

audio.prototype.stop = function(obj) {
  this.cont.close();
  this.cont = new AudioContext();
};

/* ========================================================================
	Element Functions
 ========================================================================== */

function element(props) {
  // create the element
  var type = props.type ? props.type : "div",
    el = document.createElement(type);

  // set properties
  if (props.id) {
    el.id = props.id;
  }
  if (props.src) {
    el.src = props.src;
  }
  if (props.intype) {
    el.type = props.intype;
  }
  if (props.class) {
    el.className = props.class;
  }
  if (props.text) {
    el.innerHTML = props.text;
  }
  if (props.value) {
    el.value = props.value;
  }
  if (props.data) {
    el.dataset.data = props.data;
  }
  if (props.placeholder) {
    el.placeholder = props.placeholder;
  }
  if (props.maxlength) {
    el.maxLength = props.maxlength;
  }
  if (props.href) {
    el.href = props.href;
  }

  return el;
}

function select(id) {
  return document.getElementById(id);
}

function hide(el) {
  el.style.display = "none";
}

function show(el) {
  el.style.display = "block";
}

function remove(el) {
  el.parentNode.removeChild(el);
}

function empty(el) {
  while (el.firstChild) {
    el.removeChild(el.firstChild);
  }
}

function append(parent, child) {
  parent.appendChild(child);
}

function add_class(el, class_name) {
  var split = el.className.split(" ");
  if (!split.includes(class_name)) {
    split.push(class_name);
  }
  el.className = split.join(" ");
}

function remove_class(el, class_name) {
  var split = el.className.split(" "),
    i = split.indexOf(class_name);
  if (i != -1) {
    split.splice(i, 1);
  }
  el.className = split.join(" ");
}

function display_time(frames) {
  var secs = floor(frames / 30);
  var minutes = floor(secs / 60);
  var seconds = (secs - minutes * 60).toString();
  seconds = seconds.length < 2 ? "0" + seconds : seconds;
  return minutes + ":" + seconds;
}

function debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, br) {
  var e = select("debug");
  if (br) {
    e.innerHTML += "<br>";
  } else {
    e.innerHTML = "";
  }
  if (s1 != undefined) {
    e.innerHTML += s1;
  }
  if (s2 != undefined) {
    e.innerHTML += " | " + s2;
  }
  if (s3 != undefined) {
    e.innerHTML += " | " + s3;
  }
  if (s4 != undefined) {
    e.innerHTML += " | " + s4;
  }
  if (s5 != undefined) {
    e.innerHTML += " | " + s5;
  }
  if (s6 != undefined) {
    e.innerHTML += " | " + s6;
  }
  if (s7 != undefined) {
    e.innerHTML += " | " + s7;
  }
  if (s8 != undefined) {
    e.innerHTML += " | " + s8;
  }
  if (s9 != undefined) {
    e.innerHTML += " | " + s9;
  }
}

function debugbr(s1, s2, s3, s4, s5, s6, s7, s8, s9) {
  debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, true);
}

/* ========================================================================
	Input
 ========================================================================== */

function input(callback) {
  var self = this;
  this.callback = callback;

  // default action keys
  this.action_keys = {
    move: ["0"], // click
    shoot: ["2", ["0", "17"], ["0", "18"], ["0", "91"]], // click, ctrl, alt, cmd
    jump: ["32"], // space
    switch_watcher_camera: ["80"], // p
    follow_weapon: ["70"], // f
    follow_mouse: ["1"], // middle click
    // move_left: ["37", "65"], // left, a
    // move_up: ["38", "87"], // up, w
    // move_right: ["39", "68"], // right, d
    // move_down: ["40", "83"], // down, s
    show_settings: ["27", "13"], // esc, enter
    weapon_select_1: ["49"], // 1
    weapon_select_2: ["50"], // 2
    weapon_select_3: ["51"], // 3
    weapon_select_4: ["52"], // 4
    weapon_select_5: ["53"], // 5
    weapon_select_6: ["54"], // 6
    weapon_select_7: ["55"], // 7
    weapon_select_8: ["56"], // 8
    weapon_select_9: ["57"] // 9
  };

  // set up reference for pressed key codes
  this.key_codes = {};

  // cursor
  this.cursor_moved = false;
  this.cursor = { x: 0, y: 0 };

  // set cursor points
  document.body.onmousemove = function(e) {
    if (e.target.id === "game_input") {
      self.input_cursor(e.clientX, e.clientY);
    }
  };

  // prevent default right click behaviour
  document.body.oncontextmenu = function(e) {
    e.preventDefault();
    return false;
  };

  // manage click events
  document.body.onmousedown = function(e) {
    if (e.target.id === "game_input") {
      self.input_button(e.button, "down");
    }
    if (e.button == 1) {
      e.preventDefault();
      return false;
    }
  };
  document.body.onmouseup = function(e) {
    self.input_button(e.button, "up");
  };

  // mouse wheel
  // if ("onmousewheel" in document.body) {
  //   document.body.onmousewheel = function(e) {
  //     e.preventDefault && e.preventDefault();
  //     e.returnValue = false;
  //     e = e || window.event;
  //     self.scroll_wheel(e);
  //     return false;
  //   };
  // } else {
  //   document.body.addEventListener("DOMMouseScroll", function(e) {
  //     self.scroll_wheel(e);
  //   });
  // }

  // manage keyboard events
  document.body.onkeydown = function(e) {
    self.input_button(e.keyCode, "down");
  };
  document.body.onkeyup = function(e) {
    self.input_button(e.keyCode, "up");
  };

  // turn off input when window is not focused
  window.onblur = function() {
    self.input_reset();
  };
}

/* Is an action active
	---------------------------------------- */

input.prototype.active = function(type) {
  const action = this.action_keys[type];
  if (!action) {
    return;
  }
  for (let i = 0; i < action.length; i++) {
    const codes = action[i];
    if (Array.isArray(codes)) {
      let trigger = true;
      for (let i2 = 0; i2 < codes.length; i2++) {
        const code = codes[i2];
        if (!this.key_codes[code]) {
          trigger = false;
        }
      }
      if (trigger) {
        return true;
      }
    } else {
      if (this.key_codes[codes]) {
        return true;
      }
    }
  }
};

/* Find the action of a code
	---------------------------------------- */

input.prototype.find_action = function(code) {
  const actions = [];
  for (let key in this.action_keys) {
    for (let i = 0; i < this.action_keys[key].length; i++) {
      const codes = this.action_keys[key][i];
      if (!Array.isArray(codes) && String(codes) === String(code)) {
        const obj = { type: key };
        // if (key == "show_settings") {
        //   if (this.actions.shoot) {
        //     return [];
        //   }
        // }

        // please don't tell anybody I did this
        if (key == "weapon_select_1") {
          obj.type = "weapon_select";
          obj.n = 0;
        }
        if (key == "weapon_select_2") {
          obj.type = "weapon_select";
          obj.n = 1;
        }
        if (key == "weapon_select_3") {
          obj.type = "weapon_select";
          obj.n = 2;
        }
        if (key == "weapon_select_4") {
          obj.type = "weapon_select";
          obj.n = 3;
        }
        if (key == "weapon_select_5") {
          obj.type = "weapon_select";
          obj.n = 4;
        }
        if (key == "weapon_select_6") {
          obj.type = "weapon_select";
          obj.n = 5;
        }
        if (key == "weapon_select_7") {
          obj.type = "weapon_select";
          obj.n = 6;
        }
        if (key == "weapon_select_8") {
          obj.type = "weapon_select";
          obj.n = 7;
        }
        if (key == "weapon_select_9") {
          obj.type = "weapon_select";
          obj.n = 8;
        }
        actions.push(obj);
      }
    }
  }
  return actions;
};

/* Process input events
	---------------------------------------- */

input.prototype.input_button = function(code, type) {
  // ignore input on a text box
  if (document.activeElement.tagName.toLowerCase() === "input") {
    return;
  }

  if (type == "up") {
    this.key_codes[code] = false;
  }
  if (type == "down") {
    this.key_codes[code] = true;
    const actions = this.find_action(code);
    for (let i = 0; i < actions.length; i++) {
      this.callback(actions[i]);
    }
  }
};

/* Cursor move
    ---------------------------------------- */

input.prototype.input_cursor = function(x, y) {
  this.cursor_moved = true;
  this.cursor.x = x;
  this.cursor.y = y;
};

/* Scroll wheel
    ---------------------------------------- */

input.prototype.scroll_wheel = function(e) {
  // normalize delta for cross browser
  var d = e.detail,
    w = e.wheelDelta,
    d = d ? (w && (f = w / d) ? d / f : -d / 1.35) : w / 120;

  // up or down
  var down = d < 0 ? true : false;

  // event
  this.callback({ type: "weapon_scroll", down: down });
};

/* Reset actions
    ---------------------------------------- */

input.prototype.input_reset = function() {
  for (key in this.key_codes) {
    this.key_codes[key] = false;
  }
};

/* ========================================================================
	Asset Loader
 ========================================================================== */

function loader(assets_url, assets, onload) {
  var self = this;

  // set up loading values
  this.onload = onload;
  this.output = {};
  this.loaded = 0;
  this.count = 0;
  for (var type in assets) {
    this.count += Object.keys(assets[type]).length;
    this.output[type] = {};
  }

  // set up audio
  if (assets.audio) {
    if (Object.keys(assets.audio).length > 0) {
      this.audio_context = new AudioContext();
    }
  }

  // do the loading
  for (var type in assets) {
    for (var key in assets[type]) {
      var url = assets_url + assets[type][key];
      if (type == "json") {
        this.json(url, type, key);
      }
      if (type == "img") {
        this.image(url, type, key);
      }
      if (type == "audio") {
        this.audio(url, type, key);
      }
    }
  }
}

/* Load JSON
	---------------------------------------- */

loader.prototype.json = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.overrideMimeType("application/json");
  request.open("GET", url, true);
  request.onreadystatechange = function() {
    if (request.readyState == 4 && request.status == "200") {
      var response = JSON.parse(request.responseText);
      self.output[type][key] = response;
      self.check_loaded();
    }
  };
  request.send(null);
};

/* Load Image
	---------------------------------------- */

loader.prototype.image = function(url, type, key) {
  var self = this;

  this.output[type][key] = new Image();
  this.output[type][key].src = url;

  // when image is loaded
  this.output[type][key].onload = function() {
    self.check_loaded();
  };
};

/* Load Audio
	---------------------------------------- */

loader.prototype.audio = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.responseType = "arraybuffer";
  request.onload = function() {
    self.audio_context.decodeAudioData(request.response, function(buffer) {
      if (buffer) {
        var file = self.audio_context.createBufferSource();
        file.buffer = buffer;
        file.connect(self.audio_context.destination);

        var gain = self.audio_context.createGain();
        file.connect(gain);
        gain.connect(self.audio_context.destination);

        file.loop = true;

        // gain.gain.value = 1;
        // file.start(0);

        // this.files[key] = this.cont.createBufferSource();
        // this.files[key].buffer = files[key];
        // this.files[key].connect(this.cont.destination);

        // // set up gain node
        // this.gain[key] = this.cont.createGain();
        // this.files[key].connect(this.gain[key]);
        // this.gain[key].connect(this.cont.destination);

        self.output.audio[key] = buffer;
        self.check_loaded();
      }
    });
  };
  request.send(null);
};

/* Check Assets Are Loaded
	---------------------------------------- */

loader.prototype.check_loaded = function() {
  this.loaded++;

  // if we are not ready yet
  if (this.count <= this.loaded) {
    this.onload(this.output);
  }
};

/* ========================================================================
    Onboarding
 ========================================================================== */

function onboarding() {
  this.count = 0;
  this.done = false;
  this.action = {
    move: false,
    jump: false,
    shoot: false
  };

  if (typeof Storage !== "undefined") {
    this.count = localStorage.getItem("pants_onboarding") || 0;
    this.done = this.count > 1;
  }
}

/* Trigger onboardingness
	---------------------------------------- */

onboarding.prototype.set = function(type) {
  if (this.done) {
    return;
  }
  this.action[type] = true;
  for (let key in this.action) {
    if (!this.action[key]) {
      return;
    }
  }
  this.done = true;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_onboarding", this.count + 1);
  }
};

/* ========================================================================
    Socket Messages
    handle connection and message data to and from the server
 ========================================================================== */

function SocketConnection(callback) {
  var self = this;

  // socket connection
  if (!io.on) {
    return;
  }
  this.io = io(DOMAIN + ":" + PORT);
  this.io.on("message", function(message) {
    self.message_receive(message);
  });
  this.io.on("disconnect", function() {
    callback({ type: "wait_for_connection" });
  });

  this.callback = callback;

  // ids
  this.message_receive_ids = [
    "full",
    "connected",
    "player_join",
    "player_leave",
    "game_wait",
    "game_start",
    "game_end",
    "game_state",
    "ping"
  ];

  this.message_send_ids = [
    "watcher",
    "send_name",
    "player_input",
    "weapon_selected",
    "respawn",
    "ping"
  ];

  // string separator
  this.message_separator = "|";
}

/* Send messages to server
	---------------------------------------- */

SocketConnection.prototype.message_send = function(type, props) {
  var i = this.message_send_ids.indexOf(type);

  // if not a valid message
  if (i === "undefined") {
    return;
  }

  // send message
  var self = this;
  var message = i + this.message_separator + props.join(this.message_separator);
  if (this.lag) {
    setTimeout(function() {
      self.io.send(message);
    }, this.lag);
  } else {
    this.io.send(message);
  }
};

/* Receive messages from server
	---------------------------------------- */

SocketConnection.prototype.message_receive = function(message) {
  // get type of message from id
  var split = message.split(this.message_separator);
  var id = parseInt(split[0]);

  // if not valid id
  if (!this.message_receive_ids[id]) {
    return;
  }
  var type = this.message_receive_ids[id];
  var event = { type: type };

  // prepare information for event handler
  if (type === "full") {
  } else if (type === "connected") {
    event.player_id = split[1] === "null" ? null : parseInt(split[1]);
    event.name = split[2];
    event.players = split[3];
    event.scheme = split[4];
  } else if (type === "player_join") {
    event.user_id = split[1];
    event.name = split[2];
    event.player_id = parseInt(split[3]);
  } else if (type === "player_leave") {
    event.user_id = split[1];
  } else if (type === "game_wait") {
  } else if (type === "game_start") {
    event.reset_players = parseInt(split[1]);
    event.bg_str = split[2];
    event.fg_str = split[3];
    event.gravity_map = split[4];
  } else if (type === "game_end") {
  } else if (type === "game_state") {
    event.frames = parseInt(split[1]);
    event.state = split[2];
    event.responses = split[3];
    event.damages = split[4];
  } else if (type === "ping") {
    event.frame = parseInt(split[1]);
  }

  // run event
  this.callback(event);
};

/* ========================================================================
    Game
    Alert Messages
 ========================================================================== */

/* Set up alert div
    ---------------------------------------- */

game.prototype.init_alert = function() {
  this.div_alert = element({ class: "alert" });
  append(this.div, this.div_alert);
  this.alert_text = "";
  this.alert_count = 0;
};

/* Set alert
    ---------------------------------------- */

game.prototype.set_alert = function(text, col, count) {
  this.alert_count = count || 60;
  this.div_alert.className = "alert";
  this.div_alert.innerHTML = text;
  if (col) {
    add_class(this.div_alert, col);
  }
  show(this.div_alert);
};

/* Run alert
    ---------------------------------------- */

game.prototype.run_alert = function() {
  // do countdowns
  if (this.alert_count > 0) {
    this.alert_count--;
    if (this.alert_count == 0) {
      this.div_alert.innerHTML = "";
      hide(this.div_alert);
    }
  }
};

/* ========================================================================
    Game
    Armoury
 ========================================================================== */

/* Build armoury interface
    ---------------------------------------- */

game.prototype.init_armoury = function() {
  // selected weapon
  this.current_weapon = "";

  // detonation cooldown
  this.detonation_cooldown = 0;

  // create divs
  this.armoury = {
    div: element({ class: "armoury box" }),
    title: element({ class: "title" }),
    player: element({ class: "player_weapon hex-button" }),
    weapons: {},
    show_icon: false,
    show_icon_frame: null
  };
  append(this.div, this.armoury.div);
  append(this.div, this.armoury.player);
  hide(this.armoury.player);

  // go through armoury layout
  var self = this;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var type = this.scheme.armoury[i];

    // create elements
    this.armoury.weapons[type] = {
      box: element({ class: "hex-button weapon", data: type }),
      sprite: element({ class: "sprite" }),
      count: element({ class: "count" }),
      player_icon: element({ class: "icon sprite" }),
      i: i,
      active: false
    };
    append(this.armoury.div, this.armoury.weapons[type].box);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].sprite);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].count);
    append(this.armoury.player, this.armoury.weapons[type].player_icon);
    hide(this.armoury.weapons[type].player_icon);

    // set sprite background position
    var weapon = this.c.weapons[type];
    var sprite = this.c.sprites[weapon.armoury_sprite];
    if (!sprite) {
      continue;
    }
    var offset = ceil((sprite.size - 48) / 2);
    var x = -sprite.x - offset;
    var y = -sprite.y - offset;
    var pos = x - 1 + "px " + y + "px, 0 0";
    this.armoury.weapons[type].sprite.style.backgroundPosition = pos;
    this.armoury.weapons[type].player_icon.style.backgroundPosition = pos;

    // set element events
    this.armoury.weapons[type].box.onclick = function() {
      self.weapon_select(this.dataset.data);
    };
  }

  append(this.armoury.div, this.armoury.title);
  hide(this.armoury.div);
};

/* Initialise armoury with core data
	---------------------------------------- */

game.prototype.set_armoury = function() {
  // set display for all weapons
  for (type in this.armoury.weapons) {
    this.set_weapon(type);
  }

  // select weapon
  if (
    !this.current_weapon ||
    !this.armoury.weapons[this.current_weapon].active
  ) {
    this.weapon_select_n(0);
  }
};

/* Select weapon
	---------------------------------------- */

game.prototype.weapon_select = function(type, no_highlight) {
  // if same weapon or none left
  if (
    !this.player ||
    this.current_weapon === type ||
    this.player.armoury[type] === 0
  ) {
    return;
  }

  // do the change
  for (var key in this.armoury.weapons) {
    remove_class(this.armoury.weapons[key].box, "selected");
    hide(this.armoury.weapons[key].player_icon);
  }
  add_class(this.armoury.weapons[type].box, "selected");
  this.current_weapon = type;
  this.armoury.title.innerHTML = this.c.weapons[type].title;

  // auto following weapon
  var wep = this.c.weapons[type];
  if (
    (wep.auto_follow && !this.weapon_follow) ||
    (!wep.auto_follow && this.weapon_follow)
  ) {
    this.toggle_weapon_follow();
  }

  if (!no_highlight) {
    // play noise
    this.audio.play("bleep1", 0.8);

    // show icon
    this.armoury.show_icon = true;
    this.armoury.show_icon_frame = this.core.state.frame;
    show(this.armoury.weapons[type].player_icon);
    show(this.armoury.player);
  }

  return type;
};

/* Select weapon by position in armoury
	---------------------------------------- */

game.prototype.weapon_select_n = function(n) {
  // if is too big
  if (n >= this.scheme.armoury.length) {
    return;
  }

  // go through columns
  var n2 = 0;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var weapon = this.scheme.armoury[i];
    var active = false;
    if (this.armoury.weapons[weapon].active) {
      active = true;
      if (n2 === n && weapon !== this.current_weapon) {
        return this.weapon_select(weapon);
      }
    }

    // increase count of actual columns
    n2 = active ? n2 + 1 : n2;
  }

  return false;
};

/* Select weapon by scrolling
	---------------------------------------- */

game.prototype.weapon_scroll = function(down) {
  // if we don't have a selected weapon
  var current = this.armoury.weapons[this.current_weapon];
  if (!current) {
    return;
  }

  for (var i = 1; i < this.scheme.armoury.length; i++) {
    var i_down = down ? this.scheme.armoury.length - i : i;
    var new_i = n_loop(current.i + i_down, -1, this.scheme.armoury.length - 1);
    var weapon = this.scheme.armoury[new_i];
    if (this.armoury.weapons[weapon].active) {
      this.weapon_select(weapon);
      return weapon;
    }
  }
};

/* Change to weapon
	---------------------------------------- */

game.prototype.set_weapon = function(type) {
  if (!this.player) {
    return;
  }

  var count = this.player.armoury[type];
  this.armoury.weapons[type].count.innerHTML = count;

  if (count == -1) {
    this.armoury.weapons[type].active = true;
    show(this.armoury.weapons[type].box);
    hide(this.armoury.weapons[type].count);
  } else {
    if (count < 1) {
      this.armoury.weapons[type].active = false;
      hide(this.armoury.weapons[type].box);
      if (type == this.current_weapon) {
        this.weapon_select_n(0);
      }
    } else {
      this.armoury.weapons[type].active = true;
      show(this.armoury.weapons[type].box);
    }
  }

  if (!this.current_weapon) {
    this.weapon_select_n(0);
  }
  this.display_armoury();
};

/* Show armoury or not
	---------------------------------------- */

game.prototype.display_armoury = function() {
  var show_it = false;
  var even = false;
  if (this.player) {
    for (key in this.player.armoury) {
      if (this.player.armoury[key] > 0 || this.player.armoury[key] == -1) {
        show_it = true;
        even = !even;
      }
      this.armoury.weapons[key].box.style.marginTop = even ? "26px" : "0px";
    }
  }
  if (show_it) {
    show(this.armoury.div);
  } else {
    hide(this.armoury.div);
  }
};

/* Run every frame
	---------------------------------------- */

game.prototype.run_armoury = function() {
  // turn off icon
  if (
    this.armoury.show_icon &&
    this.core.state.frame > this.armoury.show_icon_frame + 30
  ) {
    this.armoury.show_icon = false;
    hide(this.armoury.player);
  }
};

/* ========================================================================
    Game
    Audio
 ========================================================================== */

/* Set up audio objects
    ---------------------------------------- */

game.prototype.init_audio = function() {
  // objects with repeating sounds
  this.audio_objs = {};

  // weapon loops
  this.audio_weapons = {};

  // set up power up sound
  this.power_up_audio_on = false;
};

/* Check all game objects with audio objects
    ---------------------------------------- */

game.prototype.run_audio = function() {
  // remove old audio objects
  for (key in this.audio_objs) {
    if (!this.core.state.objects[key]) {
      if (this.audio_objs[key]) {
        this.audio_objs[key].gain.disconnect();
        this.audio_objs[key] = null;
      }
    }
  }

  // objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];

    // what noise should be playing
    var audio_key = null;
    if (obj.grounded && obj.animate && obj.actioned) {
      audio_key = obj.c.audio.walk;
    } else {
      audio_key = obj.c.audio.air;
    }

    var volume = this.get_dist_volume(obj.x, obj.y);
    var audio_obj = this.audio_objs[key];

    // if there is an audio file playing
    if (audio_obj) {
      // change its volume
      this.audio.set_volume(audio_obj, volume);

      // disconnect it
      if (volume <= 0 || audio_obj.audio_key != audio_key || !audio_key) {
        audio_obj.gain.disconnect();
        this.audio_objs[key] = null;
      }

      // if there is not an audio file playing
    } else {
      if (audio_key) {
        this.audio_objs[key] = this.audio.play(audio_key, volume, true);
      }
    }
  }
};

/* Set a weapon shot sound effect
    ---------------------------------------- */

game.prototype.play_weapon_audio = function(props) {
  var weapon = this.c.weapons[props.weapon];
  if (!weapon) {
    return;
  }
  if (!this.audio.buffers[weapon.fire_audio]) {
    return;
  }

  // get volume
  var volume = this.get_dist_volume(props.x, props.y);
  this.audio.play(weapon.fire_audio, volume);
};

/* Get distance volume
    ---------------------------------------- */

game.prototype.get_dist_volume = function(x, y) {
  var distance = this.core.map.get_distance(x, y, this.camera.x, this.camera.y);
  var volume = (1200 - distance) / 1200;
  volume *= volume;
  return volume;
};

/* ========================================================================
    Game
    Crosshair
 ========================================================================== */

/* Set up crosshair
	---------------------------------------- */

game.prototype.init_crosshair = function() {
  this.crosshair = 0;
  this.crosshair_source = "button";
};

/* Calculate crosshair from cursor position
	---------------------------------------- */

game.prototype.run_crosshair = function() {
  if (!this.player || this.player.dead || !this.player_obj) {
    return;
  }
  var obj = this.core.state.objects[this.player_obj.key];
  if (!obj) {
    return;
  }

  this.crosshair = this.core.map.get_heading(
    obj.x,
    obj.y,
    this.cursor.x,
    this.cursor.y
  );

  // // calculate from cursor
  // if (this.crosshair_source == "cursor") {
  // 	this.crosshair = this.core.map.get_heading(obj.x, obj.y, this.cursor.x, this.cursor.y);

  // // calculate from buttons
  // } else
  // if (this.crosshair_source == "button") {

  // 	// calculate angle of crosshair
  // 	var angle = -1;
  // 	if (this.input.actions.move_up) {
  // 		angle = 90;
  // 		if (this.input.actions.move_right) { angle = 135; }
  // 		if (this.input.actions.move_left) { angle = 45; }
  // 	} else
  // 	if (this.input.actions.move_down) {
  // 		angle = 270;
  // 		if (this.input.actions.move_right) { angle = 225; }
  // 		if (this.input.actions.move_left) { angle = 305; }
  // 	} else {
  // 		if (this.input.actions.move_right) { angle = 180; }
  // 		if (this.input.actions.move_left) { angle = 0; }
  // 	}
  // 	if (angle !== -1) {
  // 		this.crosshair = increment_angle(this.crosshair, angle, 4);
  // 	}
  // }
};

/* ========================================================================
    Game
    Decorations
 ========================================================================== */

/* Create decoration
    ---------------------------------------- */

game.prototype.create_decoration = function(props) {
  var obj = {
    frame: this.core.state.frame,
    type: "",
    id: "",
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    timeout: 0,
    angle: 0,
    repeat: true,
    sprite: ""
  };
  obj = deepmerge(obj, props);
  obj.key =
    obj.frame + "-" + obj.x + "-" + obj.y + "-" + obj.sprite + "-" + obj.id;
  this.decorations[obj.key] = obj;
};

/* Run decorations
    ---------------------------------------- */

game.prototype.run_decorations = function() {
  // create trails from objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.trails.count === 0) {
      continue;
    }
    this.create_trail(obj, obj.c.trails);
  }

  // go through all decorations
  for (var key in this.decorations) {
    var dec = this.decorations[key];

    // do timeout
    dec.timeout--;
    if (dec.timeout < 1) {
      delete this.decorations[key];
      continue;
    }

    // move
    dec.x = this.core.map.loop_x(dec.x + dec.speed_x).fixed();
    dec.y = this.core.map.loop_y(dec.y + dec.speed_y).fixed();
  }
};

/* Create trails
	---------------------------------------- */

game.prototype.create_trail = function(obj, trails) {
  // create the trails
  for (var i = 0; i < trails.count; i++) {
    var args = {
      id: i,
      sprite: trails.sprite,
      timeout: trails.timeout,
      x: obj.dx,
      y: obj.dy
    };
    if (trails.rotate) {
      args.angle = rand(0, 360);
    } else {
      args.angle = angle_add(get_angle(-obj.speed_x, -obj.speed_y), 90);
      args.x -= obj.speed_x;
      args.y -= obj.speed_y;
      if (trails.offset_x || trails.offset_y) {
        var xyx = xy_speed(angle_add(args.angle, 90), trails.offset_x);
        var xyy = xy_speed(angle_add(args.angle, 180), trails.offset_y);
        args.x += xyx.x + xyy.x;
        args.y += xyx.y + xyy.y;
      }
    }
    if (trails.move) {
      var move_angle = rand(0, 360);
      var xy = xy_speed(move_angle, trails.speed);
      args.speed_x = -xy.x;
      args.speed_y = -xy.y;
    }
    this.create_decoration(args);
  }
};

/* ========================================================================
    Game
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

game.prototype.run_events = function(events) {
  // events from scheme
  var f_event = this.scheme.events.frame[this.core.current_frame];
  if (f_event) {
    this.run_event(f_event);
  }
};

game.prototype.run_event = function(event) {
  // handle array of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
  }

  // run event
  if (event.type === "weapon_select") {
    this.weapon_select_n(event.n);
  } else if (event.type === "weapon_scroll") {
    this.weapon_scroll(event.down);
  } else if (event.type === "switch_watcher_camera") {
    this.switch_watcher_camera();
  } else if (event.type === "follow_weapon") {
    this.toggle_weapon_follow(true);
  } else if (event.type === "follow_mouse") {
    this.toggle_mouse_follow();
  } else if (event.type === "ground_damage") {
    this.run_event_ground_damage(event);
  } else if (event.type === "screen_shake") {
    this.run_event_screen_shake(event);
  } else if (event.type === "player_health") {
    this.run_event_player_health(event);
  } else if (event.type === "player_level") {
    this.run_event_player_level(event);
  } else if (event.type === "explosion") {
    this.run_event_explosion(event);
  } else if (event.type === "armoury") {
    this.run_event_armoury(event);
  } else if (event.type === "bounce") {
    this.run_event_bounce(event);
  } else if (event.type === "sound") {
    this.run_event_sound(event);
  } else if (event.type === "target") {
    this.run_event_target(event);
  } else if (event.type === "spawn") {
    this.run_event_spawn(event);
  } else if (event.type === "focus") {
    this.run_event_focus(event);
  } else if (event.type === "alert") {
    this.run_event_alert(event);
  } else if (event.type === "collect") {
    this.run_event_collect(event);
  }
};

/* Ground Damage
    ---------------------------------------- */

game.prototype.run_event_ground_damage = function(event) {
  // are we destroying land
  if (!this.scheme.destroy_land) {
    return;
  }

  // damage the ground
  this.core.map.set_circle(event.x, event.y, event.radius, 0);
  this.destroy_land(event.x, event.y, event.radius);
  // this.core.map.gravity_event_recalculate(event.x, event.y, event.radius);

  // do the dig noise and smoke trails
  if (event.dig) {
    this.run_event_sound({ x: event.x, y: event.y, sound: "dig" });
    this.create_trail(
      { dx: event.x, dy: event.y },
      {
        count: 7,
        sprite: "smoke",
        timeout: 20,
        rotate: true,
        move: true,
        speed: 1
      }
    );
  }
};

/* Screen Shake
    ---------------------------------------- */

game.prototype.run_event_screen_shake = function(event) {
  var distance = this.core.map.get_distance(
    event.x,
    event.y,
    this.camera.x,
    this.camera.y
  );
  if (distance < event.radius * 2) {
    this.camera.shake_frame = this.core.state.frame;
    this.camera.shake_size = (distance - event.radius) / 4;
  }
};

/* Health
    ---------------------------------------- */

game.prototype.run_event_player_health = function(event) {
  var obj = this.core.state.objects["player-" + event.id];
  if (obj) {
    var text = String.fromCharCode(9829) + " " + event.health;
    this.create_message(obj, "#ff9999", text, 22);
  }
};

/* Level
    ---------------------------------------- */

game.prototype.run_event_player_level = function(event) {
  var obj = this.core.state.objects["player-" + event.id];

  // is this us
  if (this.player_id === event.id) {
    this.set_score();

    // set alert
    if (event.new > event.prev) {
      var lv = this.scheme.levels;
      var n1 = event.new;
      var n2 = event.prev;
      var benefits = "";
      if (lv.health[n1] > lv.health[n2]) {
        benefits += "<br>+" + (lv.health[n1] - lv.health[n2]) + " max health";
      }
      if (lv.damage[n1] > lv.damage[n2]) {
        benefits += "<br>+" + (lv.damage[n1] - lv.damage[n2]) + " damage";
      }
      if (lv.speed[n1] > lv.speed[n2]) {
        benefits += "<br>+" + (lv.speed[n1] - lv.speed[n2]) + " speed";
      }
      if (lv.jump[n1] > lv.jump[n2]) {
        benefits += "<br>+" + (lv.jump[n1] - lv.jump[n2]) + " jump power";
      }
      var text =
        "<small>You have reached</small><br><span class='large'>Level " +
        (event.new + 1) +
        "</span><small class='blue'>" +
        benefits +
        "</small>";
      this.set_alert(text, "#eeeeee", 150);
    }
  }

  // do the flourish
  if (event.new > event.prev) {
    this.create_message(obj, "#eee", "lvl " + (event.new + 1), 30, -30);
    this.run_event_sound({ x: obj.x, y: obj.y, sound: "levelup" });
    this.create_trail(obj, {
      count: 7,
      sprite: "star-blue",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 1.5
    });
    this.create_trail(obj, {
      count: 7,
      sprite: "ball-red",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 2
    });
  }
};

/* Explosion
    ---------------------------------------- */

game.prototype.run_event_explosion = function(event) {
  // focus camera if we were following it
  if (this.weapon_following === event.key) {
    this.camera.focus = this.core.state.frame;
    this.camera.focus_time = 30;
    this.camera.fx = event.x;
    this.camera.fy = event.y;
  }
};

/* Armoury
    ---------------------------------------- */

game.prototype.run_event_armoury = function(event) {
  if (event.player_id == this.player_id) {
    this.set_weapon(event.weapon);
  }
};

/* Bounce
    ---------------------------------------- */

game.prototype.run_event_bounce = function(event) {
  var obj = this.core.state.objects[event.obj];
  if (!obj) {
    return;
  }
  var sound = obj.c.audio.bounce;
  if (sound) {
    this.run_event_sound({ x: event.x, y: event.y, sound: sound });
  }
};

/* Sound
    ---------------------------------------- */

game.prototype.run_event_sound = function(event) {
  var volume = this.get_dist_volume(event.x, event.y);
  if (volume > 0) {
    this.audio.play(event.sound, volume);
  }
};

/* Set a target on the map
    ---------------------------------------- */

game.prototype.run_event_target = function(event) {
  this.create_decoration({
    sprite: "focus",
    timeout: event.time,
    x: event.x,
    y: event.y,
    repeat: false
  });
  this.audio.play("homing", 1);
};

/* Spawn Objects
    ---------------------------------------- */

game.prototype.run_event_spawn = function(event) {
  this.create_object(event.args, true);

  event.args.time = 30;
  if (event.target) {
    this.run_event_target(event.args);
  }
  if (event.focus) {
    this.run_event_focus(event.args);
  }
};

/* Focus Camera
    ---------------------------------------- */

game.prototype.run_event_focus = function(event) {
  this.camera.focus = this.core.state.frame;
  this.camera.focus_time = event.time;
  this.camera.fx = event.x;
  this.camera.fy = event.y;
  if (event.target) {
    this.run_event_target(event);
  }
};

/* Show alert
    ---------------------------------------- */

game.prototype.run_event_alert = function(event) {
  this.set_alert(event.text, "#eeeeee", event.time);
};

/* Crate Grab
    ---------------------------------------- */

game.prototype.run_event_collect = function(event) {
  // is this not us
  if (event.player_id !== this.player_id) {
    return;
  }

  // get our object
  var obj = this.core.state.objects["player-" + event.player_id];
  if (!obj) {
    return;
  }

  // crates
  if (event.collected === "crate") {
    var weapon = this.c.weapons[event.weapon];
    this.create_message(
      obj,
      "#eeeeee",
      "+" + event.count + " " + weapon.title,
      18
    );
  }

  // gems
  if (event.collected === "gem") {
    this.set_score();
    this.create_message(obj, "#aaff99", "+" + event.n, 22);
  }
};

/* ========================================================================
    Game
    Explosions
 ========================================================================== */

/* Check for explosions
    ---------------------------------------- */

game.prototype.run_explosions = function() {
  // run through all explosions
  for (var key in this.core.state.explosions) {
    var explode_state = this.core.state.explosions[key];
    var explode_sprite = this.explosions[key];

    // if it's not started
    if (!explode_sprite) {
      var type = this.c.objects[explode_state.parent_type];
      if (!type) {
        continue;
      }

      // create sprite reference
      this.explosions[key] = {
        sprite: type.animation.explosion,
        frame: this.core.state.frame,
        x: explode_state.x,
        y: explode_state.y
      };

      // run sound effect
      if (type.audio.explosion) {
        this.run_event_sound({
          sound: type.audio.explosion,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      // run screen shake
      if (type.damage > 0) {
        this.run_event_screen_shake({
          radius: type.damage,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      continue;
    }

    // match position
    explode_sprite.x = explode_sprite.x;
    explode_sprite.y = explode_sprite.y;
  }

  // remove explosions
  for (var key in this.explosions) {
    if (this.core.state.frame > this.explosions[key].frame + 60) {
      delete this.explosions[key];
    }
  }
};

/* ========================================================================
    Game
 ========================================================================== */

function game(
  assets,
  audio,
  input,
  scheme,
  map,
  players,
  player_id,
  top_event,
  onboarding
) {
  // args
  this.c = config;
  this.img = assets.img;
  this.audio = audio;
  this.input = input;
  this.scheme = scheme;
  this.map = map;
  this.players = players;
  this.player_id = player_id;
  this.leader = null;
  this.top_event = top_event;
  this.onboarding = onboarding;

  // game running
  this.active = false;
  this.last_frame = 0;

  // main div
  this.div = element({ class: "game full" });
  this.game_area = element({ id: "game_input" });
  append(this.div, this.game_area);

  // set up game modules
  this.init_crosshair();
  this.init_canvas();
  this.init_armoury();
  this.init_map();
  this.init_camera();
  this.init_background();
  this.init_time();
  this.init_score();
  this.init_alert();
  this.init_audio();

  // things to display
  this.objects = {};
  this.explosions = {};
  this.decorations = {};
  this.actions = {};
  this.sprites = [];
  this.messages = [];
  this.labels = {};

  // wait period before on fired weapon immediately after
  this.detonation_cooldown = 0;

  // create core
  this.core = new core(this.c, this.scheme, this.map.fg, this.map.gravity_map);
  this.core.state = this.core.blank_state();
  this.core.state = this.core.state;
}

/* Init game
    ---------------------------------------- */

game.prototype.start = function(frame) {
  // mark player events
  this.player_events = {};

  // set game status to active
  this.active = true;

  // set player obj
  this.set_this_player_refs();
  this.set_score();

  // set initial camera
  if (this.player) {
    this.camera.x = this.player_obj.x;
    this.camera.y = this.player_obj.y;
  }
};

/* Run core
    ---------------------------------------- */

game.prototype.frame_core = function(frame, actions) {
  // set up this state
  this.core.state.frame = frame;
  this.core.state.events = [];
  var response = this.core.action(this.player_id, actions);

  // run player actions
  this.run_players_events();

  // run this state
  this.core.frame();

  // return the input response
  return response;
};

/* Run display
    ---------------------------------------- */

game.prototype.frame_display = function() {
  this.run_objects();
  this.run_crosshair();
  this.run_camera();
  this.run_explosions();
  this.run_decorations();
  this.run_labels();
  this.run_canvas();
  this.run_audio();
  this.run_time();
  this.run_alert();
  this.run_armoury();

  // detonation cooldown
  this.detonation_cooldown -= this.detonation_cooldown > 0 ? 1 : 0;
};

/* ========================================================================
	Game
	Input
 ========================================================================== */

/* Get current core action input
	---------------------------------------- */

game.prototype.get_input = function() {
  // is the game active and does it have a player
  if (!this.active || !this.player || this.player.dead) {
    return;
  }

  // set source of crosshair movement
  if (
    this.input.active("move_up") ||
    this.input.active("move_down") ||
    this.input.active("move_left") ||
    this.input.active("move_right")
  ) {
    this.crosshair_source = "button";
  } else {
    if (this.input.cursor_moved) {
      this.crosshair_source = "cursor";
    }
  }
  this.input.cursor_moved = false;

  // get player actions
  var active = false;
  var response = {
    action: "none",
    angle: round(this.crosshair)
  };

  // weapon keys
  var shoot_key = false;
  var fire_weapon = false;
  var weapon = this.c.weapons[this.current_weapon];
  if (weapon && this.detonation_cooldown === 0 && this.input.active("shoot")) {
    // abandon a followed weapon
    if (this.core.state.objects[this.weapon_following]) {
      this.detonation_cooldown = 15;
      this.weapon_following = "";

      // normal firing
    } else {
      // on screen
      var pos = this.screen_position(
        this.player_obj.x,
        this.player_obj.y,
        this.player_obj.c.size
      );
      if (!pos.on_screen) {
        return;
      }

      // cooldown
      if (this.player.cooldown > 0) {
        return;
      }

      var weapon = this.c.weapons[this.current_weapon];
      if (!weapon) {
        return;
      }
      if (weapon.power_up && this.power_up < 60) {
        this.power_up++;
      } else {
        fire_weapon = true;
      }
    }
  } else {
    this.powered = false;
    if (this.power_up > 0) {
      fire_weapon = true;
    } else {
      this.power_up = 0;
    }
  }

  // fire weapon
  if (fire_weapon) {
    this.powered = true;
    response.action = "shoot";
    response.power = this.power_up;
    response.weapon = this.current_weapon;
    active = true;
    this.power_up = 0;
  }

  // walking restricted actions
  if (this.player_obj.grounded && !active) {
    // arrow key movement
    var arrow_angle = -1;
    if (this.input.active("move_up")) {
      arrow_angle = 90;
      if (this.input.active("move_right")) {
        arrow_angle = 135;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 45;
      }
    } else if (this.input.active("move_down")) {
      arrow_angle = 270;
      if (this.input.active("move_right")) {
        arrow_angle = 225;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 305;
      }
    } else {
      if (this.input.active("move_right")) {
        arrow_angle = 180;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 0;
      }
    }
    if (arrow_angle !== -1) {
      response.action = "move";
      response.angle = arrow_angle;
      active = true;
    }

    // move crosshair key
    if (this.input.active("move")) {
      response.action = "move";
      active = true;
    }

    // jumping
    if (this.input.active("jump")) {
      response.action = "jump";
      active = true;
    }
  }

  // cancel mouse follow if doing stuff
  if (active) {
    this.cancel_mouse_follow();
  }

  if (!active) {
    return false;
  }

  // set the onboarding
  this.onboarding && this.onboarding.set(response.action);

  return response;
};

/* ========================================================================
    Game
    Run Objects
 ========================================================================== */

/* Start objects
	---------------------------------------- */

game.prototype.create_object = function(props, spawn) {
  // use existing props to make new core object
  var obj = this.core.create_object(props);

  // previous position
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = false;
  obj.px2 = obj.x;
  obj.py2 = obj.y;

  // display values
  obj.heading = 0;
  obj.hide = 0;
  obj.barrel_angle = 0;
  obj.actioned = false;
  obj.player_locked = false;

  // display position
  obj.dx = obj.x;
  obj.dy = obj.y;
  obj.ds = 0;

  // check for shoot events
  this.set_shot_object(obj);

  // previous display position
  obj.pdx = obj.x;
  obj.pdy = obj.y;

  // spawn
  if (obj.c.spawn || spawn) {
    // hide new object for x frames
    obj.hide = 9;

    // add a spawn decoration over top
    this.create_decoration({
      x: obj.x,
      y: obj.y,
      timeout: 16,
      repeat: false,
      type: "spawn",
      sprite: "teleport"
    });

    // play spawn sound
    this.run_event_sound({
      sound: "phase",
      x: obj.x,
      y: obj.y
    });
  }

  return obj;
};

/* Set a shot items new location
	---------------------------------------- */

game.prototype.set_shot_object = function(obj) {
  // check for a player
  var player = this.core.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // check for an action
  for (var i = 0; i < player.events.length; i++) {
    var act = player.events[i];
    if (act.obj === obj.key) {
      obj.hide = 100;
    }
  }
};

/* Run objects
	---------------------------------------- */

game.prototype.run_objects = function() {
  // check for player locked objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.player_lock) {
      var player = this.core.state.objects["player-" + obj.player_id];
      if (player) {
        player.player_locked = true;
      }
    }
  }

  for (var key in this.core.state.objects) {
    this.run_object(this.core.state.objects[key]);
  }
};

game.prototype.run_object = function(obj) {
  // snap immediately if us
  if (obj.player_id === this.player_id) {
    obj.dx = obj.x;
    obj.dy = obj.y;

    // prevent bobbling
    if (obj.x === obj.px2 && obj.y === obj.py2) {
      obj.dx = obj.pdx;
      obj.dy = obj.pdy;
    }

    // interpolate others
  } else {
    // get max speed of movement
    if (!obj.actioned) {
      obj.ds = get_speed(obj.speed_x, obj.speed_y);
    }

    // interpolate
    var dist_x = this.core.map.get_distance_x(obj.dx, obj.x);
    var dist_y = this.core.map.get_distance_y(obj.dy, obj.y);
    var max_speed = this.core.map.get_distance(obj.dx, obj.dy, obj.x, obj.y);
    var speed = max(max_speed / 4, min(max_speed, obj.ds));
    var move = check_speed(dist_x, dist_y, speed);
    obj.dx = this.core.map.loop_x(obj.dx + round(move.x));
    obj.dy = this.core.map.loop_y(obj.dy + round(move.y));
  }

  // have we moved
  var moved = obj.pdx !== obj.dx || obj.pdy !== obj.dy;

  // set heading and barrel angle
  if (moved) {
    obj.heading = this.core.map.get_heading(obj.pdx, obj.pdy, obj.dx, obj.dy);
    obj.barrel_angle = increment_angle(obj.barrel_angle, obj.heading, 3);
  }

  // is us
  if (obj.player_id === this.player_id) {
    obj.barrel_angle = obj.player_locked ? obj.heading : this.crosshair;
  }

  // if we have just landed set initial angle
  if (obj.grounded && !obj.pg) {
    var angle = get_angle(obj.speed_x, obj.speed_y);
    var walk = this.core.map.walk(obj.x, obj.y, obj.px, obj.py, angle, 6);
    if (walk.move) {
      obj.angle = walk.angle;
      obj.direction = walk.direction;
      obj.px = obj.x;
      obj.py = obj.y;
      obj.animate = false;
    }
  }

  // if walking
  else if (obj.grounded) {
    // set the display values
    var dist_x = this.core.map.get_distance_x(obj.pdx, obj.dx);
    var dist_y = this.core.map.get_distance_y(obj.pdy, obj.dy);
    var amount_moved = get_speed(dist_x, dist_y);
    if (amount_moved > 3) {
      obj.animate = true;
      obj.direction = this.core.map.ground_dir(
        obj.pdx,
        obj.pdy,
        obj.dx,
        obj.dy
      );
      obj.angle = obj.heading;
    } else {
      obj.animate = obj.c.animation.ground;
    }

    // set sprites
    var suffix = obj.animate ? "-walk-" : "-still-";
    obj.sprite_key = obj.c.animation.sprite + suffix + obj.direction;
    obj.display_angle =
      obj.direction === "left" ? obj.angle : angle_add(obj.angle, 180);

    // not walking
  } else {
    obj.sprite_key = obj.c.animation.sprite;
    obj.animate = true;

    // players
    var player = this.core.state.players[obj.player_id];
    if (obj.type === "player" && player.hit === 0) {
      obj.direction =
        obj.barrel_angle >= 90 && obj.barrel_angle < 270 ? "right" : "left";
      obj.sprite_key += "-air-" + obj.direction;
      obj.display_angle =
        obj.direction === "left"
          ? obj.barrel_angle
          : angle_add(obj.barrel_angle, 180);
    }

    // spinning in the air
    else if (obj.c.animation.air_spin) {
      var ground = this.core.map.ground_pixel(round(obj.dx), round(obj.dy));
      var speed = get_speed(obj.speed_x, obj.speed_y);
      var n = ground ? 0 : 1;
      var angle_adding = moved ? speed * 2 : n;
      obj.display_angle = angle_add(obj.display_angle, angle_adding);

      // pointing towards trajectory
    } else {
      if (round(abs(obj.speed_x) === 0) && round(abs(obj.speed_y) === 0)) {
        if (obj.c.animation.air_spin) {
          obj.display_angle = angle_add(obj.display_angle, 2);
        }
      } else {
        obj.display_angle = angle_add(
          get_angle(-obj.speed_x, -obj.speed_y),
          90
        );
      }
    }
  }

  // static angle flag
  if (obj.c.animation.static_angle) {
    obj.display_angle = 0;
  }

  // weapon just fired flags
  if (obj.fire_sprite_count) {
    obj.fire_sprite_count--;
  }
  if (obj.fire_angle_lock_count) {
    obj.direction = obj.fire_direction;
    obj.display_angle =
      obj.direction === "left"
        ? obj.fire_angle_lock
        : angle_add(obj.fire_angle_lock, 180);
    obj.fire_angle_lock_count--;
  }
  if (obj.fire_body_sprite_count) {
    obj.sprite_key = obj.fire_body_sprite + "-" + obj.direction;
    obj.animate = true;
    obj.fire_body_sprite_count--;
  }

  // previous position
  obj.px2 = obj.px;
  obj.py2 = obj.py;
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = obj.grounded;
  obj.pdx = obj.dx;
  obj.pdy = obj.dy;
  obj.player_locked = false;
};

/* ========================================================================
    Game
    Run Players
 ========================================================================== */

/* Start this player
	---------------------------------------- */

game.prototype.init_player = function(player, preserve_events, remove_events) {
  var new_player;

  // use sources
  if (player) {
    var core_player = this.core.state.players[player.id];
    if (preserve_events && core_player) {
      player.events = core_player.events.concat(player.events);
    }
    new_player = this.core.create_player(player);
    if (remove_events) {
      new_player.events = [];
    }

    // create new
  } else {
    new_player = this.core.create_player({ id: this.player_id });
    this.create_object({ type: "player", player_id: this.player_id });
    this.core.init_player(this.player_id);
  }

  // set this player
  if (new_player.id === this.player_id) {
    this.player = new_player;
    this.set_armoury();
  }
};

/* Resolve players from other states
	---------------------------------------- */

game.prototype.run_players_events = function(players) {
  // clear object actioned events
  for (var key in this.core.state.objects) {
    this.core.state.objects[key].actioned = false;
  }

  // run player events
  for (var key in this.core.state.players) {
    this.run_player_events(this.core.state.players[key]);
  }

  // remove old events
  for (var id in this.player_events) {
    for (var key in this.player_events[id]) {
      if (this.core.state.frame > this.player_events[id][key] + 30) {
        delete this.player_events[id][key];
      }
    }
  }
};

game.prototype.run_player_events = function(player) {
  // init player events
  if (!this.player_events[player.id]) {
    this.player_events[player.id] = {};
  }

  // go through events
  for (var i = 0; i < player.events.length; i++) {
    var event = player.events[i];
    var key = event.frame + "-" + event.type;
    if (!this.player_events[key]) {
      this.player_event(player, event);
      this.player_events[key] = this.core.state.frame;
      break;
    }
  }
};

/* Player action
	---------------------------------------- */

game.prototype.player_event = function(player, event) {
  // is there isn't an action
  if (!event) {
    return;
  }

  // get player object
  var obj = this.core.state.objects["player-" + player.id];
  if (!obj) {
    return;
  }

  // mark object as having performed an action
  obj.actioned = true;

  // movement
  if (event.type === "walk") {
    obj.ds = this.scheme.levels.speed[player.level] || obj.c.speed.move;
  }

  // jump
  if (event.type === "jump") {
    obj.ds = this.scheme.levels.jump[player.level] || obj.c.speed.jump;

    // play jump sound
    this.run_event_sound({
      sound: "jump",
      x: obj.x,
      y: obj.y
    });
  }

  // shooting
  if (event.type === "shoot") {
    var weapon = this.c.weapons[event.weapon];
    var weapon_obj = this.c.objects[weapon.object];

    // are we firing the weapon
    if (obj.player_id === this.player_id) {
      this.detonation_cooldown = min(20, weapon.cooldown);
      this.weapon_following = this.weapon_follow ? event.obj : "";

      // other players shots
    } else {
      var shot_obj = this.core.state.objects[event.obj];
      if (shot_obj) {
        shot_obj.hide = 0;
        shot_obj.dx = obj.dx;
        shot_obj.dy = obj.dy;
        obj.barrel_angle = this.core.map.get_heading(
          obj.x,
          obj.y,
          shot_obj.x,
          shot_obj.y
        );
      }
    }

    // if we are not a player and auto follow weapons
    if (this.player_id === null) {
      if (obj.player_id === parseInt(this.leader) && weapon.auto_follow) {
        this.weapon_following = event.obj;
      }
    }

    // weapon just fired sprite
    if (weapon.fire_sprite) {
      var sprite_key = "ant-weapon-" + weapon.fire_sprite;
      var animation = this.c.animations[sprite_key + "-left"];
      obj.fire_sprite = sprite_key;
      obj.fire_sprite_count = animation ? animation.length + 1 : 1;
      obj.fire_sprite_frame = this.core.state.frame;
    }

    // weapon body sprite
    if (weapon.fire_body_sprite) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_body_sprite = "ant-body-" + weapon.fire_body_sprite;
      obj.fire_body_sprite_count = cool;
    }

    // weapon angle lock
    if (weapon.fire_angle_lock) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_direction = obj.direction;
      obj.fire_angle_lock = obj.barrel_angle;
      obj.fire_angle_lock_count = cool;
    }

    // play sound effect
    this.play_weapon_audio({
      x: obj.dx,
      y: obj.dy,
      player_id: obj.player_id,
      weapon: event.weapon
    });
  }

  // collect a crate or medpack
  if (event.type === "crate" || event.type === "medpack") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "locknload"
    });
  }

  // collected a gem
  if (event.type === "gem") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "bing"
    });
  }
};

/* Set this player references
	---------------------------------------- */

game.prototype.set_this_player_refs = function() {
  // set player ref
  if (this.core.state.players[this.player_id]) {
    this.player = this.core.state.players[this.player_id];
  }

  // set object ref
  if (this.core.state.objects["player-" + this.player_id]) {
    this.player_obj = this.core.state.objects["player-" + this.player_id];
  }
};

/* ========================================================================
    Game
    Scores
 ========================================================================== */

/* Build score interface
    ---------------------------------------- */

game.prototype.init_score = function() {
  if (!this.scheme.score) {
    return;
  }

  this.div_score = element({ class: "score" });
  append(this.div, this.div_score);

  this.div_score_gem = element({ class: "gem" });
  this.div_score_text = element({ class: "text" });
  append(this.div_score, this.div_score_gem);
  append(this.div_score, this.div_score_text);

  // are we doing levels
  if (this.scheme.levels) {
    this.div_score_bar = element({ class: "bar" });
    this.div_score_bar_in = element({ class: "bar-inner" });
    this.div_score_level = element({ class: "level hex-button", text: " LVL" });
    this.div_score_level_num = element({ class: "level-num", text: "1" });
    append(this.div_score, this.div_score_bar);
    append(this.div_score_bar, this.div_score_bar_in);
    append(this.div_score, this.div_score_level);
    append(this.div_score_level, this.div_score_level_num);
  }
};

/* Set score interface
    ---------------------------------------- */

game.prototype.set_score = function() {
  if (!this.scheme.score) {
    return;
  }
  if (!this.player) {
    hide(this.div_score);
    return;
  } else {
    show(this.div_score);
  }

  this.div_score_text.innerHTML = this.player.score;
  if (this.scheme.levels) {
    this.div_score_level_num.innerHTML = this.player.level + 1;

    // do exp bar
    var width = 0;
    var this_level = this.scheme.levels.score[this.player.level];
    var next_level = this.scheme.levels.score[this.player.level + 1];
    if (this_level && next_level) {
      width = (
        ((this.player.score - this_level) / (next_level - this_level)) *
        94
      ).fixed();
    }
    this.div_score_bar_in.style.width = width + "%";
  }
};

/* ========================================================================
    Game
    Timer
 ========================================================================== */

/* Build time interface
    ---------------------------------------- */

game.prototype.init_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  // time divs
  this.div_time = element({ class: "time" });
  this.div_timeout = element({ class: "timeout" });
  append(this.div, this.div_time);
  append(this.div, this.div_timeout);
  hide(this.div_timeout);

  this.display_time = "";
};

/* Run the time interface
    ---------------------------------------- */

game.prototype.run_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  var secs;

  // counting up
  if (this.scheme.time_limit === 0) {
    secs = floor(this.core.state.frame / 24);

    // counting down
  } else {
    var dif = this.scheme.time_limit - this.core.state.frame;
    secs = ceil(dif / 24);

    // timeout
    if (dif === 240) {
      show(this.div_timeout);
    }
    if (dif <= 240 && dif % 24 === 0 && dif > 1) {
      this.audio.play("bloop2", 0.5);
    }
    if (dif === 1) {
      hide(this.div_timeout);
    }
    if (secs <= 10) {
      if (dif % 24 === 0 && secs >= 1) {
        this.div_timeout.innerHTML = secs;
      }
      if (dif === 96) {
        this.audio.play("timeout", 0.8);
      }
    }
  }

  // do time
  var new_time = "0:00";
  if (secs > 0) {
    var minutes = floor(secs / 60),
      seconds = (secs - minutes * 60).toString();
    seconds = seconds.length < 2 ? "0" + seconds : seconds;
    new_time = minutes + ":" + seconds;
  }
  if (this.display_time !== new_time) {
    this.display_time = new_time;
    this.div_time.innerHTML = new_time;
  }
};

/* ========================================================================
    Multiplayer
    Player Deaths
 ========================================================================== */

/* Check if we're dead
    ---------------------------------------- */

multiplayer.prototype.frame_dead = function() {
  // not ready for any death stuff
  if (!this.game || !this.game.core || !this.game.player) {
    return;
  }

  // count up to deadness
  if (this.game.player.dead) {
    if (!this.dead) {
      if (this.wait_for_dead < 48) {
        this.wait_for_dead++;
      } else {
        this.death();
      }
    }
  } else {
    this.wait_for_dead = 0;
    if (this.dead) {
      this.respawn();
    }
  }

  // deadness
  if (this.dead) {
    if (this.wait_for_respawn > 0) {
      this.wait_for_respawn--;
      if (this.wait_for_respawn === 0) {
        this.div_dead_countdown.innerHTML = "Click to respawn";
        remove_class(this.button_respawn, "disabled");
      } else {
        this.div_dead_countdown.innerHTML =
          "Respawn in " + ceil(this.wait_for_respawn / 24) + " seconds";
      }
    }
  }
};

/* We have died
    ---------------------------------------- */

multiplayer.prototype.death = function() {
  this.dead = true;
  this.wait_for_dead = 0;
  this.wait_for_respawn = 96;

  hide(this.div_dead_text);
  add_class(this.button_respawn, "disabled");
  show(this.div_dead);
};

/* Respawn triggered
    ---------------------------------------- */

multiplayer.prototype.respawn = function() {
  this.dead = false;
  hide(this.div_dead);
};

/* ========================================================================
    Multiplayer
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

multiplayer.prototype.run_event = function(event) {
  if (!event) {
    return;
  }

  // handle arrays of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // run events
  if (event.type === "full") {
    this.game_full();
  } else if (event.type === "connected") {
    this.connected(event);
  } else if (event.type === "wait_for_connection") {
    this.wait_for_connection();
  } else if (event.type === "player_join") {
    this.player_join(event);
  } else if (event.type === "player_leave") {
    this.player_leave(event);
  } else if (event.type === "game_wait") {
  } else if (event.type === "game_start") {
    this.game_start(event);
  } else if (event.type === "game_end") {
    this.game_end(event);
  } else if (event.type === "game_state") {
    this.game_state_received(event);
  } else if (event.type === "collect") {
    this.event_collect(event);
  } else if (event.type === "ground_damage") {
    this.event_ground_damage(event);
  } else if (event.type === "player_death") {
    this.event_player_death(event);
  } else if (event.type === "weapon_selected") {
    this.sockets.message_send("weapon_selected", [event.weapon]);
  } else if (event.type === "ping") {
    this.event_ping(event);
  }

  // send event down a level
  else if (this.game) {
    this.game.run_event(event);
  }
};

/* Collected item
    ---------------------------------------- */

multiplayer.prototype.event_collect = function(event) {
  if (this.initialised) {
    // wait to recreate
    this.wait_to_create[event.obj] = this.game.core.state.frame;

    // run client collection events
    this.game.run_event(event);

    // run players interface
    this.players_interface();
  }
};

/* Player death
    ---------------------------------------- */

multiplayer.prototype.event_player_death = function(event) {
  // only use server events
  if (!event.from_server) {
    return;
  }

  // run it
  if (this.initialised) {
    this.player_death(event);
  }
};

/* Ping
    ---------------------------------------- */

multiplayer.prototype.event_ping = function(event) {
  // did we request this
  if (!this.pings[event.frame]) {
    return;
  }

  var now = new Date().getTime();

  // record end time for ping
  this.pings[event.frame].end = now;

  // go through all pings
  var ping_count = 0;
  var ping_total = 0;
  for (var frame in this.pings) {
    var ping = this.pings[frame];

    // remove old ones
    if (ping.end && ping.end + 10000 < now) {
      delete this.pings[frame];
      continue;
    }

    // calculate average
    ping_total += ping.end - ping.start;
    ping_count++;
  }

  // show ping
  this.div_ping.innerHTML = round(ping_total / ping_count);
};

/* ========================================================================
    Mulitplayer
    Frames
 ========================================================================== */

/* Start/stop loop
    ---------------------------------------- */

multiplayer.prototype.loop_start = function(start_frame) {
  // close any open loops
  this.loop_stop();

  // set loop vars
  this.start_frame = start_frame || 0;
  this.frames = this.start_frame;
  this.start_time = new Date().getTime();

  var self = this;
  this.interval = setInterval(function() {
    self.run_tick();
  }, 10);
};

multiplayer.prototype.loop_stop = function() {
  clearInterval(this.interval);
};

/* Run tick
    ---------------------------------------- */

multiplayer.prototype.run_tick = function() {
  // calculate number of frames since game start
  var now = new Date().getTime();
  var frames =
    this.start_frame + Math.floor((now - this.start_time) / this.ms_loop);

  // get number of remaining steps
  var frame_difference = frames - this.frames;

  // waiting
  if (frame_difference < 1) {
    return;
  }

  // too much lag
  if (frame_difference > 10) {
    this.loop_start();
    // console.log("tick lag | " + frame_difference);
    return;
  }

  // go through frames to process
  for (var i = 0; i < frame_difference; i++) {
    this.frame();
  }

  // run display loop
  this.game.frame_display();

  // record time this was done
  this.fpses.push(new Date().getTime());
  if (this.fpses.length > 72) {
    this.div_fps.innerHTML = round(
      (3000 / (this.fpses[72] - this.fpses[0])) * this.fps
    );
    this.fpses.splice(0, 1);
  }
};

/* Frame process
    ---------------------------------------- */

multiplayer.prototype.frame = function() {
  // increment frame count
  this.frames++;

  // store input
  if (this.game.player) {
    var action = this.game.get_input();
    if (action) {
      this.store_input[this.frames] = action;
      this.send_input(action);
    }
  }

  // run frame
  this.frame_run(this.frames);

  // remove old states
  this.remove_old_states();

  // run ground damage checks
  this.frame_ground();

  // run death frames
  this.frame_dead();

  // run players interface
  if (this.frames % 48 === 0) {
    this.players_interface();
  }

  // run ping
  if (this.frames % 12 === 0) {
    this.sockets.message_send("ping", [this.frames]);
    this.pings[this.frames] = { start: new Date().getTime() };
  }
};

/* Frame run
    ---------------------------------------- */

multiplayer.prototype.frame_run = function(frame) {
  // run core and store response
  var response = this.game.frame_core(frame, this.store_input[frame]);
  if (response.success) {
    this.store_responses.push(response);
  }

  // events
  this.run_event(this.game.core.state.events);

  // unpack any stored server state for this frame
  if (this.store_packet[frame]) {
    this.set_game_state(this.store_packet[frame]);
    delete this.store_packet[frame];
  }

  // record game state
  this.store_state[frame] = {
    frames: frame,
    state: this.game.core.pack_state(this.game.core.state)
  };
};

/* Remove old states
    ---------------------------------------- */

multiplayer.prototype.remove_old_states = function() {
  for (var frame in this.store_packet) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_packet[frame];
    }
  }
  for (var frame in this.store_state) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_state[frame];
    }
  }
  for (var frame in this.store_input) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_input[frame];
    }
  }
  for (var i = 0; i < this.store_responses.length; i++) {
    if (this.store_responses[i].frame + 50 < this.frames) {
      this.store_responses.splice(i, 1);
    }
  }
};

/* ========================================================================
    Mulitplayer
    Ground Damage
 ========================================================================== */

/* Damage the ground event
    ---------------------------------------- */

multiplayer.prototype.event_ground_damage = function(event) {
  var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

  // did we already have this happen
  if (this.ground_events[key]) {
    return;
  }

  // get boundaries
  var x1 = max(round(event.x - event.radius), 0);
  var x2 = min(round(event.x + event.radius), this.game.core.map.w - 1);
  var y1 = max(round(event.y - event.radius), 0);
  var y2 = min(round(event.y + event.radius), this.game.core.map.h - 1);
  var w = x2 - x1;
  var h = y2 - y1;

  // get array from the map
  var arr = this.game.core.map.get_block(x1, y1, w, h);

  // get piece of the map
  var canv = this.game.get_land_block(x1, y1, w, h);

  // store backed up damage
  this.ground_temp[key] = {
    frame: event.frame,
    x: x1,
    y: y1,
    arr: arr,
    canv: canv
  };

  // store the event itself
  this.ground_events[key] = duplicate_obj(event);
  this.ground_events[key].done = true;

  // run the event
  this.game.run_event(event);
};

/* Check ground damage events
    ---------------------------------------- */

multiplayer.prototype.frame_ground = function() {
  // go through all checks
  for (var key in this.ground_temp) {
    if (this.frames > this.ground_temp[key].frame + 40) {
      clog("damage not confirmed");
      this.undo_ground_damage(this.ground_temp[key], key);
      delete this.ground_temp[key];
      delete this.ground_events[key];
    }
  }

  // go through all events
  for (var key in this.ground_events) {
    var event = this.ground_events[key];
    if (this.frames >= event.frame) {
      if (!event.done) {
        this.game.run_event(event);
        this.ground_events[key].done = true;
      }
    }
    if (this.frames > this.ground_events[key].frame + 50) {
      delete this.ground_events[key];
    }
  }
};

/* Undo ground damage
    ---------------------------------------- */

multiplayer.prototype.undo_ground_damage = function(damage, d_key) {
  // restore it
  this.game.core.map.set_block_from_arr(damage.x, damage.y, damage.arr);
  this.game.draw_land_block(damage.x, damage.y, damage.canv);

  // redo any other events that happened since
  for (var key in this.ground_events) {
    if (d_key === key) {
      continue;
    }
    this.game.run_event(this.ground_events[key]);
  }
};

/* Server response
    ---------------------------------------- */

multiplayer.prototype.resolve_ground = function(str) {
  if (!str) {
    return;
  }

  // unpack damages
  var split = str.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    var event = {
      type: "ground_damage",
      frame: parseInt(split2[0]),
      x: parseFloat(split2[1]),
      y: parseFloat(split2[2]),
      radius: parseFloat(split2[3]),
      dig: split2[4] === "1"
    };
    var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

    // confirm already done damage
    if (this.ground_temp[key]) {
      delete this.ground_temp[key];

      // wait to perform it
    } else {
      this.ground_events[key] = event;
    }
  }
};

/* ========================================================================
    Multiplayer
    Interface
 ========================================================================== */

/* Init interface
    ---------------------------------------- */

multiplayer.prototype.init_interface = function() {
  // loading screen
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);

  // between games screen
  this.between_games = element({
    class: "cont_center",
    text: "Dimension jump in progress!<br><br><div class='loader'></div>"
  });
  append(this.div, this.between_games);
  hide(this.between_games);

  // performance
  this.div_ping = element({ class: "ping" });
  this.div_fps = element({ class: "fps" });
  append(this.div, this.div_ping);
  append(this.div, this.div_fps);

  // dead div
  this.div_dead = element({ class: "full full_bg" });
  this.div_dead_cont = element({
    class: "cont_center red",
    text: "<h3>You have died!</h3>"
  });
  this.div_dead_text = element({
    type: "p",
    text: "You were killed in action."
  });
  this.div_dead_countdown = element({ type: "p", class: "grey" });
  this.div_dead_buttons = element({ class: "buttons" });
  this.button_respawn = element({
    type: "button",
    class: "button red disabled",
    text: "Respawn"
  });
  append(this.div, this.div_dead);
  append(this.div_dead, this.div_dead_cont);
  append(this.div_dead_cont, this.div_dead_text);
  append(this.div_dead_cont, this.div_dead_countdown);
  append(this.div_dead_cont, this.div_dead_buttons);
  append(this.div_dead_buttons, this.button_respawn);
  hide(this.div_dead);

  // game full screen
  this.full = element({
    class: "cont_center",
    text:
      "Game server full. Please try again later...<br><br><div class='loader'></div>"
  });
  append(this.div, this.full);
  hide(this.full);

  // respawn on click
  var self = this;
  this.button_respawn.onclick = function() {
    if (self.wait_for_respawn === 0) {
      self.sockets.message_send("respawn", []);
    }
  };

  // players
  this.div_players = element({ class: "players" });
  this.table_players = element({ type: "table" });
  append(this.div, this.div_players);
  append(this.div_players, this.table_players);
};

/* ========================================================================
    App
 ========================================================================== */

function multiplayer(
  assets,
  assets_url,
  audio,
  input,
  name,
  watcher,
  run_event,
  sockets,
  onboarding
) {
  // setup
  this.assets = assets;
  this.assets_url = assets_url;
  this.audio = audio;
  this.input = input;
  this.name = name;
  this.watcher = watcher;
  this.top_event = run_event;
  this.sockets = sockets;
  this.scheme = null;
  this.lag = 0;
  this.onboarding = onboarding;

  // loop
  this.fps = 24;
  this.ms_loop = Math.floor(1000 / this.fps);
  this.ms_tick = 10;
  this.active = false;

  // main divs
  this.div = element({ class: "full" });
  this.connecting = element({
    class: "cont_center",
    text: "Waiting for connection...<br><br><div class='loader'></div>"
  });
  append(this.div, this.connecting);

  // set up interface
  this.init_interface();

  // when joining a game record any incoming events for later use
  this.initial_game_events = [];
}

/* Wait for connection
    ---------------------------------------- */

multiplayer.prototype.wait_for_connection = function(event) {
  this.loop_stop();
  hide(this.between_games);
  hide(this.loading);
  hide(this.div_dead);
  show(this.connecting);
};

/* Connected
    ---------------------------------------- */

multiplayer.prototype.connected = function(event) {
  // set up scheme
  this.scheme = deepmerge(schemes.default, schemes[event.scheme]);

  // active values
  this.name = event.name;
  this.player_id = event.player_id;
  this.player_count = 0;
  this.players = {};
  this.players_ref = {};

  // go through string of players
  var split = event.players.split("+");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("/");
    this.init_player({
      user_id: split2[0],
      name: split2[1],
      player_id: parseInt(split2[2])
    });
  }

  // run the player interface
  this.players_interface();
};

/* Start game
    ---------------------------------------- */

multiplayer.prototype.game_start = function(event) {
  this.loading_start = true;
  this.initialised = false;
  this.gravity_map = event.gravity_map;

  this.game_close();

  // reset scores
  if (event.reset_players) {
    for (var id in this.players) {
      this.players[id].level = 0;
      this.players[id].score = 0;
    }
    this.players_interface();
  }

  // stored game states and actions
  this.store_packet = {};
  this.store_state = {};
  this.store_input = {};
  this.store_responses = [];

  // ground damage
  this.ground_temp = {};
  this.ground_events = {};

  // objects that we are waiting on for server confirmation
  this.wait_to_destroy = {};
  this.wait_to_create = {};

  // performance
  this.pings = {};
  this.fpses = [];

  // load the map from data url
  var self = this;
  new loader(
    "",
    {
      img: {
        bg: event.bg_str,
        fg: event.fg_str
      }
    },
    function(assets) {
      self.game_start_loaded(assets.img);
    }
  );
};

multiplayer.prototype.game_start_loaded = function(map) {
  // set up map
  var new_map = {
    fg: mapgen_canvas(map.fg.width, map.fg.height),
    bg: mapgen_canvas(map.bg.width, map.bg.height),
    gravity_map: this.gravity_map
  };
  new_map.fg.cont.drawImage(map.fg, 0, 0);
  new_map.bg.cont.drawImage(map.bg, 0, 0);

  // start up game object
  this.game = new game(
    this.assets,
    this.audio,
    this.input,
    this.scheme,
    new_map,
    this.players_ref,
    this.player_id,
    this.top_event,
    this.onboarding
  );
  append(this.div, this.game.div);

  // finished loading
  this.loading_start = false;
};

/* Init game
    ---------------------------------------- */

multiplayer.prototype.init_game = function(event) {
  if (!this.game || !this.game.core) {
    return;
  }

  // show interface
  hide(this.between_games);
  hide(this.div_dead);
  hide(this.connecting);
  hide(this.loading);

  // stop game
  this.loop_stop();

  // prepare state
  this.set_game_state(event, true);

  // start game
  this.game.start(event.frames);
  this.status = "active";

  // last frame a server packet was received
  this.last_packet = event.frames;
  this.disconnected = false;

  // run initial events
  this.run_event(this.initial_game_events);
  this.initial_game_events = [];
  this.initialised = true;

  // start loop
  this.loop_start(event.frames);
};

/* Close game
    ---------------------------------------- */

multiplayer.prototype.game_close = function(event) {
  this.loop_stop();
  if (this.game) {
    remove(this.game.div);
    delete this.game;
  }
};

/* End Game
    ---------------------------------------- */

multiplayer.prototype.game_end = function(event) {
  // stop game
  this.loop_stop();

  // stop audio
  this.audio.stop();

  // show loading screen
  hide(this.loading);
  hide(this.div_dead);
  hide(this.connecting);
  show(this.between_games);
};

/* Send input to server
    ---------------------------------------- */

multiplayer.prototype.send_input = function(action) {
  var arr = [this.frames, action.action, action.angle];
  if (action.action === "shoot") {
    arr.push(action.weapon);
  }
  this.sockets.message_send("player_input", arr);
};

/* ========================================================================
    Room Players
 ========================================================================== */

/* Create player objects
    ---------------------------------------- */

multiplayer.prototype.init_player = function(props) {
  // add player to array
  this.player_count++;
  this.players[props.user_id] = {
    name: props.name,
    id: props.player_id
  };

  // set players reference
  this.players_ref[props.player_id] = {
    user_id: props.user_id,
    name: props.name,
    level: 0
  };
};

/* Draw players interface
    ---------------------------------------- */

multiplayer.prototype.players_interface = function() {
  // are we good and active
  if (!this.initialised || !this.game.core.state.players) {
    return;
  }

  // show players
  var str = "";
  var sortable = this.players_sort();
  if (!sortable) {
    return;
  }

  // set leader id
  this.game.leader = parseInt(sortable[0].id);

  str = "<thead><th></th><th>lvl</th><th>score</th></thead>";
  for (var i = 0; i < sortable.length; i++) {
    var player = sortable[i];
    var tr_class = "";
    if (player.id == this.player_id) {
      tr_class += "highlight ";
    }
    if (player.dead) {
      tr_class += "dead ";
    }
    str +=
      "<tr class='" +
      tr_class +
      "''><td>" +
      player.name +
      "</td><td class='red'>" +
      (player.level + 1) +
      "</td><td class='green'>" +
      player.score +
      "</td></tr>";
  }

  // check for level ups
  for (var id in this.players_ref) {
    var player = this.players_ref[id];
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    if (player.level !== core_player.level) {
      this.run_event({
        type: "player_level",
        id: parseInt(id),
        prev: player.level,
        new: core_player.level
      });
      this.players_ref[id].level = core_player.level;
    }
  }

  // set content
  this.table_players.innerHTML = str;
};

/* Sort players by score
    ---------------------------------------- */

multiplayer.prototype.players_sort = function() {
  var sortable = [];
  for (var id in this.players_ref) {
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    sortable.push({
      id: id,
      name: this.players_ref[id].name,
      level: core_player.level,
      score: core_player.score,
      dead: core_player.dead
    });
  }
  sortable.sort(function(a, b) {
    return b.score - a.score;
  });
  return sortable;
};

/* Player has joined
    ---------------------------------------- */

multiplayer.prototype.player_join = function(event) {
  this.init_player(event, true);
  this.audio.play("join", 1);
};

/* Player left
    ---------------------------------------- */

multiplayer.prototype.player_leave = function(event) {
  if (!this.players[event.user_id]) {
    return;
  }

  var id = this.players[event.user_id].player_id;
  delete this.players_ref[id];
  delete this.players[event.user_id];
  this.player_count--;

  // remove from game
  if (this.game && this.game.core) {
    this.game.core.remove_player(id);
  }
};

/* ========================================================================
    Game States
 ========================================================================== */

/* Receive game state from server
    ---------------------------------------- */

multiplayer.prototype.game_state_received = function(event) {
  // if we are loading
  if (this.loading_start) {
    return;
  }

  // start the game
  if (!this.initialised || this.disconnected) {
    this.initialised = true;
    this.init_game(event);
    return;
  }

  var diff = event.frames - this.frames;

  // if we are too quick
  if (diff < 0) {
    // console.log("client too fast");
    this.init_game(event);
    return;
  }

  // if it's too far behind resync
  if (diff > 9) {
    // console.log("resync");
    this.init_game(event);
    return;
  }

  // apply the state
  if (event.frames === this.frames) {
    this.set_game_state(event);
  } else {
    this.store_packet[event.frames] = duplicate_obj(event);
  }
};

/* Set game state
    ---------------------------------------- */

multiplayer.prototype.set_game_state = function(event, ignore_res) {
  // run damages
  this.resolve_ground(event.damages);

  // unpack the state
  var state = this.game.core.unpack_state(event.state);

  // set players
  this.resolve_players(state, ignore_res);

  // set this player
  if (!ignore_res) {
    this.resolve_this_player(state, event.responses);
  }

  // set objects
  this.resolve_objects(state.objects, event.frames);

  // set explosions
  this.resolve_explosions(state.explosions, event.frames);

  // set game player references
  this.game.set_this_player_refs();
};

/* Resolve players
    ---------------------------------------- */

multiplayer.prototype.resolve_players = function(state, ignore_res) {
  // set all other players
  for (var key in state.players) {
    if (parseInt(key) !== this.player_id || ignore_res) {
      this.game.init_player(state.players[key], true);
    }
  }

  // remove players
  for (var key in this.game.core.state.players) {
    if (!state.players[key]) {
      this.game.core.remove_player(key);
    }
  }
};

/* Resolve this player
    ---------------------------------------- */

multiplayer.prototype.resolve_this_player = function(state, responses) {
  // prep server state objects
  var server_player = state.players[this.player_id];
  var server_obj = state.objects["player-" + this.player_id];
  if (!server_player || !server_obj) {
    return;
  }

  // prep server responses
  var server_responses = [];
  var split = responses.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    server_responses.push({
      frame: parseInt(split2[0]),
      success: split2[1] === "1",
      x: parseFloat(split2[2]),
      y: parseFloat(split2[3]),
      speed_x: parseFloat(split2[4]),
      speed_y: parseFloat(split2[5]),
      type: split2[6]
    });
  }

  // check player weapon
  if (server_player.weapon !== this.game.current_weapon) {
    this.sockets.message_send("weapon_selected", [this.game.current_weapon]);
  }

  // if we have no more actions
  if (this.store_responses.length === 0) {
    this.game.player.level = server_player.level;
    this.game.player.score = server_player.score;
    this.game.player.dead = server_player.dead;
    this.game.player.health = server_player.health;
    this.game.player.cooldown = server_player.cooldown;
    this.game.player.armoury = duplicate_obj(server_player.armoury);
    this.game.set_armoury();
  }

  // resolve our player
  for (var i = 0; i < this.store_responses.length; i++) {
    var client_response = this.store_responses[i];

    // go through action responses
    for (var j = 0; j < server_responses.length; j++) {
      var server_response = server_responses[j];

      // correct frame
      if (client_response.frame === server_response.frame) {
        // compare the response
        if (
          client_response.success === server_response.success &&
          client_response.x === server_response.x &&
          client_response.y === server_response.y &&
          client_response.speed_x === server_response.speed_x &&
          client_response.speed_y === server_response.speed_y
        ) {
          // clog("act success", server_response.frame, this.frames, server_response.type, client_response.x, server_response.x, client_response.y, server_response.y);
        } else {
          // resync the player
          clog(
            "act fail",
            server_response.frame,
            this.frames,
            server_response.type,
            client_response.x,
            server_response.x,
            client_response.y,
            server_response.y
          );
          if (!this.resync_this_player(server_response)) {
            this.game.init_player(server_player, false, true);
            this.game.create_object(server_obj);
            return;
          }
        }
        server_responses.splice(j, 1);
        this.store_responses.splice(i, 1);
        i--;
        break;
      }
    }
  }
};

/* Sync this player
    ---------------------------------------- */

multiplayer.prototype.resync_this_player = function(server_response) {
  // how far back is this
  var frame = server_response.frame;
  var frame_difference = this.frames - frame;

  // if it's too far back
  // if we have no state to roll back to
  if (frame_difference > 20 || !this.store_state[frame]) {
    // console.log("sync too far back | " + frame_difference);
    return false;
  }

  // reset game state
  this.set_game_state(this.store_state[frame], true);

  // reset player
  this.store_responses = [];
  this.game.player_obj.x = server_response.x;
  this.game.player_obj.y = server_response.y;
  this.game.player_obj.speed_x = server_response.speed_x;
  this.game.player_obj.speed_y = server_response.speed_y;

  // run all frames up to this point
  for (var i = 1; i <= frame_difference; i++) {
    this.frame_run(frame + i);
  }

  return true;
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_objects = function(objects, frame) {
  // check for uncreated objects
  for (var key in objects) {
    if (!this.game.core.state.objects[key]) {
      if (!this.wait_to_create[key] || this.wait_to_create[key] + 40 < frame) {
        delete this.wait_to_create[key];
        this.game.create_object(objects[key]);
      }
    }
  }

  // if there's no corresponding server object
  for (var key in this.game.core.state.objects) {
    if (!objects[key]) {
      // give them a delay
      if (!this.wait_to_destroy[key]) {
        this.wait_to_destroy[key] = frame + 40;
        continue;

        // remove when delay has expired
      } else if (this.wait_to_destroy[key] < frame) {
        delete this.game.core.state.objects[key];
        delete this.wait_to_destroy[key];
      }
    }
  }

  // match up objects
  for (var key in this.game.core.state.objects) {
    // if our player and waiting for action responses
    if (key === "player-" + this.player_id) {
      if (this.store_responses.length !== 0) {
        continue;
      }
    }

    var obj = this.game.core.state.objects[key];
    var res_obj = objects[key];

    // ignore any objects with no reference
    if (!res_obj) {
      continue;
    }

    // match values
    if (obj.type !== res_obj.type) {
      obj.type = res_obj.type;
      obj.c = this.game.c.objects[obj.type];
    }
    obj.grounded = res_obj.grounded;

    // if grounded or us
    if (obj.grounded || obj.player_id === this.player_id) {
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;

      // set interpolation position
    } else if (!obj.actioned) {
      obj.ghost = frame;
      obj.gx = obj.x;
      obj.gy = obj.y;
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;
    }
  }
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_explosions = function(explosions, frame) {
  // check for uncreated explosions
  for (var key in explosions) {
    if (!this.game.core.state.explosions[key]) {
      this.game.core.create_explosion(explosions[key]);

      // ensure correct position
    } else {
      this.game.core.state.explosions[key].x = explosions[key].x;
      this.game.core.state.explosions[key].y = explosions[key].y;
    }
  }
};

/* ========================================================================
    Game
    Tracker Arrows
 ========================================================================== */

/* Run the arrows
    ---------------------------------------- */

game.prototype.run_arrows = function() {
  for (var type in this.scheme.arrows) {
    var arrow = this.scheme.arrows[type];
    if (!arrow) {
      continue;
    }

    // find closest thing
    var lowest = 99999;
    var closest_obj = null;
    for (var key in this.core.state.objects) {
      var obj = this.core.state.objects[key];
      if (obj.type === "player" && obj.player_id === this.player_id) {
        continue;
      }
      if (obj.type === type) {
        var dist = this.core.map.get_distance(
          obj.x,
          obj.y,
          this.camera.x,
          this.camera.y
        );
        if (dist < lowest) {
          lowest = dist;
          closest_obj = obj;
        }
      }
    }
    if (!closest_obj) {
      continue;
    }

    // get screen position
    var pos = this.screen_position(closest_obj.x, closest_obj.y, 80);
    if (pos.on_screen) {
      continue;
    }

    // show an arrow
    var angle = this.core.map.get_heading(
      this.camera.x,
      this.camera.y,
      closest_obj.x,
      closest_obj.y
    );
    var dist = min(lowest, min(this.canvas.cx, this.canvas.cy)) - 22;
    var xy = xy_speed(angle, dist);
    this.sprites.push({
      type: "arrow-" + arrow,
      x: round(this.camera.x + xy.x),
      y: round(this.camera.y + xy.y),
      angle: angle_add(angle, 270)
    });
  }
};

/* ========================================================================
    Game
    Background Layer
 ========================================================================== */

/* Set up background
    ---------------------------------------- */

game.prototype.init_background = function() {
  this.bg = {};
  this.bg.parallax = 0.5;
  this.bg.x = 0;
  this.bg.y = 0;
  this.bg.w = this.img.bg.width;
  this.bg.h = this.img.bg.height;
  this.bg.pattern = this.canvas.cont.createPattern(this.img.bg, "repeat");
};

/* Draw the background
	---------------------------------------- */

game.prototype.draw_background = function() {
  // how much have we moved by
  var dx =
      this.core.map.get_distance_x(this.camera.x, this.camera.px) *
      this.bg.parallax,
    dy =
      this.core.map.get_distance_y(this.camera.y, this.camera.py) *
      this.bg.parallax;

  // add movement multiplied by parallax degree
  this.bg.x = n_loop(this.bg.x + dx, 0, this.bg.w);
  this.bg.y = n_loop(this.bg.y + dy, 0, this.bg.h);

  // draw it
  var size = max(this.canvas.h, this.canvas.w);
  this.canvas.cont.translate(
    this.bg.x + this.camera.sx,
    this.bg.y + this.camera.sy
  );
  this.canvas.cont.fillStyle = this.bg.pattern;
  this.canvas.cont.fillRect(-size, -size, size * 3, size * 3);
  this.canvas.cont.translate(
    -(this.bg.x + this.camera.sx),
    -(this.bg.y + this.camera.sy)
  );
};

/* ========================================================================
    Game
    Camera Position
 ========================================================================== */

/* Set up camera position
	---------------------------------------- */

game.prototype.init_camera = function() {
  this.camera = {};
  this.camera.x = round(this.map.fg.canv.width / 2);
  this.camera.y = round(this.map.fg.canv.height / 2);
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  // watcher follow player
  this.camera.watch_follow = "leader";
  this.camera.watch_follow_player = "";

  // camera weapon
  this.camera_weapon_key = null;

  // camera shake on hit
  this.camera.shake_frame = null;
  this.camera.sx = 0;
  this.camera.sy = 0;

  // camera focus event
  this.camera.focus = null;
  this.camera.focus_time = 0;
  this.camera.fx = 0;
  this.camera.fy = 0;

  // cursor
  this.cursor = { x: 0, y: 0 };

  // weapon following
  this.weapon_follow = false;
  this.weapon_following = "";
};

/* Switch watcher camera
	---------------------------------------- */

game.prototype.switch_watcher_camera = function() {
  if (!watch) {
    return;
  }
  var keys = Object.keys(this.players);
  var index = keys.indexOf(this.camera.watch_follow_player);
  if (index !== -1) {
    if (index === keys.length - 1) {
      this.camera.watch_follow_player = null;
      this.camera.watch_follow = "leader";
      this.set_alert("Following the Leader", "#ccffcc", 100);
      return;
    } else {
      this.camera.watch_follow_player = keys[index + 1];
    }
  } else {
    this.camera.watch_follow_player = keys[0];
  }
  console.log(this.camera.watch_follow_player);
  var player = this.players[this.camera.watch_follow_player];
  this.camera.watch_follow = "player";
  this.set_alert("Following " + player.name, "#eeeeee", 100);
};

/* Calculate current camera position
	---------------------------------------- */

game.prototype.run_camera = function() {
  // stop following if hit
  if (this.weapon_following && this.player && this.player.hit > 0) {
    this.weapon_following = "";
  }

  // set previous position
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  var x, y, move;

  // set fallback camera
  var watch_player_id = 0;
  if (this.camera.watch_follow === "leader") {
    watch_player_id = this.leader;
  } else if (this.camera.watch_follow === "player") {
    watch_player_id = this.camera.watch_follow_player;
  }

  // find object to follow
  var follow_obj = this.core.state.objects[this.weapon_following];
  var watch_obj = this.core.state.objects["player-" + watch_player_id];
  if (follow_obj) {
    x = follow_obj.dx;
    y = follow_obj.dy;
    move = 30;
  } else if (this.player_obj) {
    x = this.player_obj.dx;
    y = this.player_obj.dy;
    move = 60;
  } else if (watch_obj) {
    x = watch_obj.dx;
    y = watch_obj.dy;
    move = 30;
  }

  // go to focus event
  if (
    this.camera.focus != null &&
    this.camera.focus < this.core.state.frame &&
    this.camera.focus + this.camera.focus_time > this.core.state.frame
  ) {
    x = this.camera.fx;
    y = this.camera.fy;
    move = 100;

    // follow cursor
  } else if (this.mouse_follow || !move) {
    x = this.cursor.x;
    y = this.cursor.y;
    move =
      this.core.map.get_distance(this.camera.x, this.camera.y, x, y) * 0.05;
  }

  // move towards new position
  if (move) {
    var dx = this.core.map.get_distance_x(this.camera.x, x);
    var dy = this.core.map.get_distance_y(this.camera.y, y);
    var limit = check_speed(dx, dy, move);
    this.camera.x = this.core.map.loop_x(round(this.camera.x + limit.x));
    this.camera.y = this.core.map.loop_y(round(this.camera.y + limit.y));
  }

  // add screen shake
  this.camera.sx = 0;
  this.camera.sy = 0;
  var diff = this.camera.shake_frame
    ? this.core.state.frame - this.camera.shake_frame
    : 0;
  if (diff < 15 && diff > 0) {
    this.camera.sx = cos((diff / 2.5 - 1.5) * pi) * this.camera.shake_size;
    this.camera.sy = sin((diff / 3 - 1) * pi) * this.camera.shake_size;
  }

  // fix cursor input
  this.cursor_map();
};

/* Toggle weapon following
	---------------------------------------- */

game.prototype.toggle_weapon_follow = function(message) {
  this.weapon_follow = !this.weapon_follow;

  if (message) {
    var text = "on";
    if (!this.weapon_follow) {
      text = "off";
      this.weapon_following = "";
    }
    text = "Follow weapons " + text;
    this.set_alert(text, "#eee");
  }
};

/* Toggle mouse following
	---------------------------------------- */

game.prototype.toggle_mouse_follow = function() {
  this.mouse_follow = !this.mouse_follow;
  var text = this.mouse_follow ? "on" : "off";
  text = "Free cam " + text;
  this.set_alert(text, "#eee");
};

game.prototype.cancel_mouse_follow = function() {
  if (this.mouse_follow) {
    this.toggle_mouse_follow();
  }
};

/* Calculate cursor position on map
	---------------------------------------- */

game.prototype.cursor_map = function() {
  var scale_x = this.canvas.canv.offsetWidth / this.canvas.w;
  var scale_y = this.canvas.canv.offsetHeight / this.canvas.h;
  var x1 =
    this.camera.x +
    round((this.input.cursor.x - round(innerWidth / 2)) * scale_x);
  var y1 =
    this.camera.y +
    round((this.input.cursor.y - round(innerHeight / 2)) * scale_y);
  this.cursor.x = this.core.map.loop_x(round(x1));
  this.cursor.y = this.core.map.loop_y(round(y1));
};

/* Screen position of a co-ordinate
	---------------------------------------- */

game.prototype.screen_position = function(x, y, size) {
  var x1 =
      this.canvas.cx +
      this.core.map.get_distance_x(this.camera.x - this.camera.sx, x),
    y1 =
      this.canvas.cy +
      this.core.map.get_distance_y(this.camera.y - this.camera.sy, y),
    on_screen =
      x1 > -size &&
      x1 < this.canvas.w + size &&
      y1 > -size &&
      y1 < this.canvas.h + size;

  return {
    x: x1,
    y: y1,
    on_screen: on_screen
  };
};

/* ========================================================================
    Game
    Main Canvas
 ========================================================================== */

/* Set up canvas
    ---------------------------------------- */

game.prototype.init_canvas = function() {
  // set up main canvas dimensions and position
  var d = select("projectants");
  this.canvas = {};

  // limit game size
  this.canvas.w = d.offsetWidth;
  this.canvas.h = d.offsetHeight;
  if (this.canvas.h < 800) {
    this.canvas.w = round(this.canvas.w * (800 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (800 / this.canvas.h));
  }
  if (this.canvas.h > 1000) {
    this.canvas.w = round(this.canvas.w * (1000 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (1000 / this.canvas.h));
  }
  this.canvas.cx = round(this.canvas.w / 2);
  this.canvas.cy = round(this.canvas.h / 2);

  // initialise main canvas
  this.canvas.canv = element({ type: "canvas" });
  this.canvas.canv.style.position = "relative";
  this.canvas.cont = this.canvas.canv.getContext("2d");
  this.canvas.canv.width = this.canvas.w;
  this.canvas.canv.height = this.canvas.h;

  append(this.div, this.canvas.canv);
};

/* Frame rendering
    ---------------------------------------- */

game.prototype.run_canvas = function() {
  // clear the canvas
  this.canvas.cont.clearRect(0, 0, this.w, this.h);

  // do the drawing
  this.draw_background();
  this.draw_map();
  this.draw_sprites();
  this.draw_labels();
  this.draw_messages();

  // clear sprites
  this.sprites = [];
};

/* ========================================================================
    Game
    Object Labels
 ========================================================================== */

/* Manage labels
	---------------------------------------- */

game.prototype.run_labels = function() {
  // create labels
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.labels && !this.labels[key]) {
      this.labels[key] = {};
      for (type in obj.c.labels) {
        if (obj.c.labels[type]) {
          this.create_label(this.labels[key], type, key);
        }
      }
    }
  }

  // run through labels
  for (key in this.labels) {
    var obj = this.core.state.objects[key];
    if (!obj) {
      delete this.labels[key];
      continue;
    }
    for (type in this.labels[key]) {
      this.set_label(this.labels[key][type], obj);
    }
  }
};

/* Create label
	---------------------------------------- */

game.prototype.create_label = function(ref, type, key) {
  // check health is active
  if (type === "player_health" && !this.scheme.health) {
    return;
  }

  // create and add to ref object
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  ref[type] = { canv: canv, cont: cont, text: "", key: key, type: type };
};

/* Set label
	---------------------------------------- */

game.prototype.set_label = function(label, obj) {
  // position
  if (label.type === "position") {
    this.set_label_text(label, obj.x + " | " + obj.y);
  }

  // player name
  else if (label.type === "player_name") {
    var player = this.players[obj.player_id];
    if (player) {
      this.set_label_text(label, player.name);
    } else {
      delete this.labels[label.key][label.type];
      return;
    }
  }

  // health bar
  else if (label.type === "player_health") {
    this.set_label_health(label, obj.player_id);
  }

  // timeout
  else if (label.type === "timeout") {
    this.set_label_text(
      label,
      ceil((obj.c.timeout - (this.core.state.frame - obj.frame)) / 24)
    );
  }
};

/* Set text label
	---------------------------------------- */

game.prototype.set_label_text = function(label, text) {
  // prep text
  text = String(text);
  text = str_space(text);

  // if there's no change to text
  if (label.text === text) {
    return;
  }

  // draw text
  label.w = label.cont.measureText(text).width + 9;
  label.h = 18;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.restore();
  label.cont.clearRect(0, 0, label.canv.width, label.canv.height);
  label.cont.font = "12px 'Orbitron'";
  label.cont.fillStyle = "#000";
  label.cont.filter = "drop-shadow(0 2px 4px #000)";
  label.cont.fillText(text, 4, 14 + 0.5);
  label.cont.fillStyle = "#ddd";
  label.cont.fillText(text, 4, 12 + 0.5);
  label.cont.save();
};

/* Set health label
	---------------------------------------- */

game.prototype.set_label_health = function(label, player_id) {
  if (!this.scheme.health) {
    return;
  }

  var player = this.core.state.players[player_id];
  if (!player) {
    delete this.labels[label.key][label.type];
    return;
  }

  // are we doing anything at all
  var level = this.scheme.levels.health[player.level];
  if (!level) {
    return;
  }

  // is it the same
  var text = player.health + " / " + level;
  if (text === label.text) {
    return;
  }
  label.text = text;

  // draw label
  label.w = round(level / 2) + 6;
  label.h = 8;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.fillStyle = "rgba(255,255,255,0.1)";
  label.cont.fillRect(0, 0, label.w, label.h);
  label.cont.fillStyle = "rgba(0,0,0,0.8)";
  label.cont.fillRect(1, 1, label.w - 2, label.h - 2);
  label.cont.fillStyle = "#e41a1a";
  label.cont.fillRect(3, 3, round(player.health / 2), 2);

  // are we hiding it
  label.hide = player.dead;
};

/* Draw labels
	---------------------------------------- */

game.prototype.draw_labels = function() {
  // go through all labels
  for (key in this.labels) {
    // ignore empties or hiddens
    if (!this.labels[key]) {
      continue;
    }

    // get screen position of object
    var obj = this.core.state.objects[key];
    var position = this.screen_position(obj.dx, obj.dy, 50);

    // ignore too far away objects
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var n = 0;
    for (type in this.labels[key]) {
      var label = this.labels[key][type];
      if (label.hide) {
        continue;
      }
      var x = round(position.x - label.w / 2) + 0;
      var y =
        round(position.y - label.h / 2 - obj.c.size * 2 - (label.h - 5) * n) -
        20;
      this.canvas.cont.drawImage(label.canv, x, y);
      n++;
    }
  }
};

/* ========================================================================
    Game
    Map Graphics
 ========================================================================== */

/* Set up the map canvases
	---------------------------------------- */

game.prototype.init_map = function() {
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* Draw the map
	---------------------------------------- */

game.prototype.draw_map = function() {
  var x = this.canvas.cx - this.camera.x + this.camera.sx;
  var y = this.canvas.cy - this.camera.y + this.camera.sy;

  // draw layers
  this.draw_repeating_layer(this.map.bg.canv, x, y);
  this.draw_repeating_layer(this.map.fg.canv, x, y);
};

/* Draw layer canvas repeating on all sides
	---------------------------------------- */

game.prototype.draw_repeating_layer = function(canv, x, y) {
  this.canvas.cont.drawImage(canv, x - canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x, y - canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x - canv.width, y);
  this.canvas.cont.drawImage(canv, x + canv.width, y);
  this.canvas.cont.drawImage(canv, x - canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y + canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y);
};

/* Destroy land on the map
	---------------------------------------- */

game.prototype.destroy_land = function(x, y, size) {
  this.map.fg.cont.beginPath();
  this.map.fg.cont.arc(x, y, size, 0, 2 * pi);
  this.map.fg.cont.fill();
};

/* Get a piece of land
	---------------------------------------- */

game.prototype.get_land_block = function(x, y, w, h) {
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  canv.width = w;
  canv.height = h;
  cont.drawImage(this.map.fg.canv, x, y, w, h, 0, 0, w, h);

  return canv;
};

/* Draw piece of land
	---------------------------------------- */

game.prototype.draw_land_block = function(x, y, canv) {
  this.map.fg.cont.globalCompositeOperation = "normal";
  this.map.fg.cont.drawImage(canv, x, y);
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* ========================================================================
    Game
    Object Messages
 ========================================================================== */

/* Draw the messages
	---------------------------------------- */

game.prototype.draw_messages = function() {
  // go through messages
  for (var i = 0; i < this.messages.length; i++) {
    var message = this.messages[i];

    // increment time
    message.time++;
    if (message.time > 40) {
      this.messages.splice(i, 1);
      continue;
    }

    // get screen position of message
    var position = this.screen_position(message.x, message.y, 50);

    // ignore too far away messages
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var x = round(position.x - message.w / 2) + 0.5;
    var y = round(position.y - message.h / 2) - 30.5 - message.time;

    this.canvas.cont.save();
    this.canvas.cont.translate(0, 0);
    this.canvas.cont.drawImage(message.canv, x, y);
    this.canvas.cont.restore();
  }
};

/* Look for changes in health
	---------------------------------------- */

game.prototype.create_message = function(obj, col, text, size, y_offset) {
  // set up canvas
  var message = {};
  message.canv = element({ type: "canvas" });
  message.cont = message.canv.getContext("2d");

  // draw text
  text = str_space(text);
  message.cont.font = size + "px Orbitron";
  message.w = round(message.cont.measureText(text).width) + 8;
  message.h = size + 4;
  message.canv.width = message.w;
  message.canv.height = message.h;
  message.cont.font = size + "px Orbitron";
  // message.cont.fillStyle = "#000";
  // message.cont.fillText(text, 3.5, size + 0.5);
  message.cont.fillStyle = col;
  message.cont.fillText(text, 3.5, size + 0.5);

  // set position
  var y_offset = y_offset || 0;
  message.x = obj.x;
  message.y = obj.y + y_offset;
  message.time = 0;

  // add to array
  this.messages.push(message);
};

/* ========================================================================
    Game
    Sprites
 ========================================================================== */

/* Run sprites
	---------------------------------------- */

game.prototype.draw_sprites = function() {
  this.sprites = [];

  // objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.hide > 0) {
      obj.hide--;
      continue;
    }
    if (obj.type === "player") {
      var player = this.core.state.players[obj.player_id];
      if (player) {
        if (player.hit > 0) {
          this.draw_player_hit_sprites(obj, player.hit);
        } else {
          this.draw_player_sprites(obj, player);
        }
      }
      continue;
    }
    var args = {
      frame: obj.frame,
      type: obj.sprite_key,
      x: obj.dx,
      y: obj.dy,
      angle: obj.display_angle,
      animate: obj.animate,
      float: obj.c.animation.air_float,
      repeat: true
    };
    this.sprites.unshift(args);
  }

  // explosions
  for (var key in this.explosions) {
    var obj = this.explosions[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      animate: true
    };
    this.sprites.push(args);
  }

  // decorations
  for (var key in this.decorations) {
    var obj = this.decorations[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      angle: obj.angle,
      animate: true,
      repeat: obj.repeat
    };
    this.sprites.unshift(args);
  }

  // get arrows
  this.run_arrows();

  // draw them
  this.draw_sprites_canv();
};

/* Player sprites
	---------------------------------------- */

game.prototype.draw_player_sprites = function(obj, player) {
  var w =
    this.player_id === obj.player_id ? this.current_weapon : player.weapon;
  var weapon = this.c.weapons[w];

  // body
  this.sprites.push({
    frame: obj.frame,
    type: obj.sprite_key,
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // get head direction and angle
  var head_dir = obj.direction;
  if (obj.grounded) {
    var diff = n_diff(
      obj.barrel_angle,
      angle_add(obj.display_angle, 90),
      0,
      360
    );
    head_dir = diff >= -180 && diff < 0 ? "right" : "left";
  }
  var head_angle =
    head_dir === "right" ? angle_add(obj.barrel_angle, 180) : obj.barrel_angle;

  // weapons
  var weapon_sprite = "";
  if (weapon && weapon.sprite) {
    var weapon_sprite = weapon.sprite;
    var weapon_frame = 0;
    var throwing = weapon.sprite === "throw";

    // just fired sprites
    if (obj.fire_sprite_count) {
      weapon_sprite = weapon.fire_sprite;
      weapon_frame = obj.fire_sprite_frame;
      throwing = false;
    }

    // add the weapon sprite
    this.sprites.push({
      type: "ant-weapon-" + weapon_sprite + "-" + head_dir,
      x: this.core.map.loop_x(obj.dx),
      y: this.core.map.loop_y(obj.dy),
      frame: weapon_frame,
      animate: true,
      repeat: true,
      angle: head_angle
    });
  }

  // head
  this.sprites.push({
    type: "ant-head-" + head_dir,
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: head_angle
  });

  // add a throw weapon
  if (throwing) {
    var tobj = this.c.objects[weapon.object];
    var tsprite = tobj.animation.sprite;
    var toff_x = xy_speed(obj.barrel_angle, -16);
    var toff_y = xy_speed(angle_add(head_angle, 90), 14);
    this.sprites.push({
      type: tsprite,
      x: this.core.map.loop_x(obj.dx + toff_x.x + toff_y.x),
      y: this.core.map.loop_y(obj.dy + toff_x.y + toff_y.y),
      animate: false,
      angle: angle_add(obj.barrel_angle, 90)
    });
  }

  // // set crosshair
  // if (this.player_id === obj.player_id) {
  // 	var offx = xy_speed(angle, 50 + weapon.offset_x);
  // 	var offy = xy_speed(offset_angle, 7);
  // 	this.sprites.push({
  // 		type: "crosshair",
  // 		x: round(obj.dx + offx.x + offy.x),
  // 		y: round(obj.dy + offx.y + offy.y),
  // 		angle: angle_add(this.crosshair, 180)
  // 	});
  // }
};

/* Player hit sprites
	---------------------------------------- */

game.prototype.draw_player_hit_sprites = function(obj, hit) {
  // body
  this.sprites.push({
    frame: obj.frame,
    type: hit < 15 ? "ant-body-air-left" : "ant-body-hit",
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // head
  this.sprites.push({
    type: hit < 15 ? "ant-head-left" : "ant-head-hit",
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: obj.display_angle
  });
};

/* Draw sprites on the canvas
	---------------------------------------- */

game.prototype.draw_sprites_canv = function() {
  for (var i = 0; i < this.sprites.length; i++) {
    var sprite = this.sprites[i];

    // get position on screen
    var screen_position = this.screen_position(sprite.x, sprite.y, 48);
    if (!screen_position.on_screen) {
      continue;
    }

    // get sprite key
    var sprite_key = sprite.type;
    var animation = this.c.animations[sprite_key];
    if (animation) {
      sprite_key = animation[0];
      if (sprite.animate) {
        var frame = sprite.frame || 0;
        frame = floor((this.core.state.frame - frame) / 2);
        if (sprite.repeat) {
          frame = frame % animation.length;
        }
        sprite_key = animation[frame];
      }
    }

    // get sprite reference positions
    var sprite_ref = this.c.sprites[sprite_key];
    if (!sprite_ref) {
      continue;
    }

    // get new position to draw on
    var size = sprite_ref.size;
    var pos = -(size / 2);

    // float effect
    var y_add = 0;
    if (sprite.float) {
      y_add = cos((this.core.state.frame - sprite.frame) / 4) * 2;
    }

    // draw it
    this.canvas.cont.save();
    this.canvas.cont.translate(screen_position.x, screen_position.y + y_add);
    if (sprite.angle !== 0) {
      this.canvas.cont.rotate((sprite.angle * Math.PI) / 180);
    }
    this.canvas.cont.drawImage(
      this.img.sprites,
      sprite_ref.x,
      sprite_ref.y,
      size,
      size,
      pos,
      pos,
      size,
      size
    );
    this.canvas.cont.translate(
      -screen_position.x,
      -(screen_position.y + y_add)
    );
    this.canvas.cont.restore();
  }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9hbmltYXRpb25zLmpzIiwiY29uZmlnL21hcGdlbi5qcyIsImNvbmZpZy9uYW1lcy5qcyIsImNvbmZpZy9vYmplY3RzLmpzIiwiY29uZmlnL3Nwcml0ZXMuanMiLCJjb25maWcvd2VhcG9ucy5qcyIsImVuZ2luZS9hY3Rpb25zLmpzIiwiZW5naW5lL2NvbGxpc2lvbnMuanMiLCJlbmdpbmUvY29yZS5qcyIsImVuZ2luZS9ldmVudHMuanMiLCJlbmdpbmUvZXhwbG9zaW9ucy5qcyIsImVuZ2luZS9vYmplY3RzLmpzIiwiZW5naW5lL3BoeXNpY3MuanMiLCJlbmdpbmUvcGxheWVycy5qcyIsImVuZ2luZS9zdGF0ZXMuanMiLCJoZWxwZXJzL2RlZXBtZXJnZS5qcyIsImhlbHBlcnMvbWF0aC5qcyIsImhlbHBlcnMvbWlzYy5qcyIsIm1hcGdlbi9ibG9icy5qcyIsIm1hcGdlbi9jYW52YXMuanMiLCJtYXBnZW4vbWFwZ2VuLmpzIiwic2NoZW1lcy9kZWF0aG1hdGNoLmpzIiwic2NoZW1lcy9kZWZhdWx0LmpzIiwiZW5naW5lL21hcC9ncmF2aXR5LmpzIiwiZW5naW5lL21hcC9ncm91bmQuanMiLCJlbmdpbmUvbWFwL21hcC5qcyIsImFwcC5qcyIsImV2ZW50cy5qcyIsImludGVyZmFjZS5qcyIsInNldHRpbmdzLmpzIiwic3RhcnQuanMiLCJkZW1vL2RlbW8uanMiLCJkZW1vL2V2ZW50cy5qcyIsImRlbW8vZnJhbWVzLmpzIiwibW9kdWxlcy9hdWRpby5qcyIsIm1vZHVsZXMvZWxlbWVudHMuanMiLCJtb2R1bGVzL2lucHV0LmpzIiwibW9kdWxlcy9sb2FkZXIuanMiLCJtb2R1bGVzL29uYm9hcmRpbmcuanMiLCJtb2R1bGVzL3NvY2tldHMuanMiLCJnYW1lL2FsZXJ0LmpzIiwiZ2FtZS9hcm1vdXJ5LmpzIiwiZ2FtZS9hdWRpby5qcyIsImdhbWUvY3Jvc3NoYWlyLmpzIiwiZ2FtZS9kZWNvcmF0aW9ucy5qcyIsImdhbWUvZXZlbnRzLmpzIiwiZ2FtZS9leHBsb3Npb25zLmpzIiwiZ2FtZS9nYW1lLmpzIiwiZ2FtZS9pbnB1dC5qcyIsImdhbWUvb2JqZWN0cy5qcyIsImdhbWUvcGxheWVycy5qcyIsImdhbWUvc2NvcmUuanMiLCJnYW1lL3RpbWUuanMiLCJtdWx0aXBsYXllci9kZWF0aHMuanMiLCJtdWx0aXBsYXllci9ldmVudHMuanMiLCJtdWx0aXBsYXllci9mcmFtZXMuanMiLCJtdWx0aXBsYXllci9ncm91bmQuanMiLCJtdWx0aXBsYXllci9pbnRlcmZhY2UuanMiLCJtdWx0aXBsYXllci9tdWx0aXBsYXllci5qcyIsIm11bHRpcGxheWVyL3BsYXllcnMuanMiLCJtdWx0aXBsYXllci9zdGF0ZXMuanMiLCJnYW1lL2NhbnZhcy9hcnJvd3MuanMiLCJnYW1lL2NhbnZhcy9iYWNrZ3JvdW5kLmpzIiwiZ2FtZS9jYW52YXMvY2FtZXJhLmpzIiwiZ2FtZS9jYW52YXMvY2FudmFzLmpzIiwiZ2FtZS9jYW52YXMvbGFiZWxzLmpzIiwiZ2FtZS9jYW52YXMvbWFwLmpzIiwiZ2FtZS9jYW52YXMvbWVzc2FnZXMuanMiLCJnYW1lL2NhbnZhcy9zcHJpdGVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0bEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdjRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9lQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5WkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDalRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9TQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLmFuaW1hdGlvbnMgPSB7XG4gIFwiYW50LWJvZHktaGl0XCI6IFtcbiAgICBcImFudC1ib2R5LWhpdC0xXCIsXG4gICAgXCJhbnQtYm9keS1oaXQtMlwiLFxuICAgIFwiYW50LWJvZHktaGl0LTFcIixcbiAgICBcImFudC1ib2R5LWhpdC0zXCJcbiAgXSxcbiAgXCJhbnQtYm9keS1zdGlsbC1sZWZ0XCI6IFtcImFudC1ib2R5LXdhbGstbGVmdC0xXCJdLFxuICBcImFudC1ib2R5LXN0aWxsLXJpZ2h0XCI6IFtcImFudC1ib2R5LXdhbGstcmlnaHQtMVwiXSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnRcIjogW1xuICAgIFwiYW50LWJvZHktd2Fsay1sZWZ0LTJcIixcbiAgICBcImFudC1ib2R5LXdhbGstbGVmdC0zXCIsXG4gICAgXCJhbnQtYm9keS13YWxrLWxlZnQtNFwiLFxuICAgIFwiYW50LWJvZHktd2Fsay1sZWZ0LTVcIlxuICBdLFxuICBcImFudC1ib2R5LXdhbGstcmlnaHRcIjogW1xuICAgIFwiYW50LWJvZHktd2Fsay1yaWdodC0yXCIsXG4gICAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTNcIixcbiAgICBcImFudC1ib2R5LXdhbGstcmlnaHQtNFwiLFxuICAgIFwiYW50LWJvZHktd2Fsay1yaWdodC01XCJcbiAgXSxcbiAgXCJhbnQtaGVhZC1sZWZ0XCI6IFtcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMlwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0zXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTJcIlxuICBdLFxuICBcImFudC1oZWFkLXJpZ2h0XCI6IFtcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTJcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTNcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTJcIlxuICBdLFxuICBcImFudC1oZWFkLWhpdFwiOiBbXCJhbnQtaGVhZC1oaXQtMVwiLCBcImFudC1oZWFkLWhpdC0yXCIsIFwiYW50LWhlYWQtaGl0LTNcIl0sXG4gIFwiYW50LXdlYXBvbi1iYXpvb2thLWxlZnRcIjogW1wiYW50LXdlYXBvbi1iYXpvb2thLWxlZnRcIl0sXG4gIFwiYW50LXdlYXBvbi1iYXpvb2thLXJpZ2h0XCI6IFtcImFudC13ZWFwb24tYmF6b29rYS1yaWdodFwiXSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLWxlZnRcIjogW1wiYW50LXdlYXBvbi1sYXNlci1sZWZ0XCJdLFxuICBcImFudC13ZWFwb24tbGFzZXItcmlnaHRcIjogW1wiYW50LXdlYXBvbi1sYXNlci1yaWdodFwiXSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnRcIjogW1wiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIl0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1maXJlLWxlZnRcIjogW1xuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTJcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0zXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNFwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTVcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiXG4gIF0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodFwiOiBbXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIl0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1maXJlLXJpZ2h0XCI6IFtcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMlwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0zXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTRcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtNVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIlxuICBdLFxuICBcImFudC13ZWFwb24tZGlnLWxlZnRcIjogW1wiYW50LXdlYXBvbi1kaWctbGVmdC0xXCJdLFxuICBcImFudC13ZWFwb24tZGlnLWZpcmUtbGVmdFwiOiBbXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTJcIixcbiAgICBcImFudC13ZWFwb24tZGlnLWxlZnQtM1wiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctbGVmdC00XCJcbiAgXSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodFwiOiBbXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0xXCJdLFxuICBcImFudC13ZWFwb24tZGlnLWZpcmUtcmlnaHRcIjogW1xuICAgIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtMlwiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtM1wiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtNFwiXG4gIF0sXG4gIFwiYW50LWdob3N0XCI6IFtcbiAgICBcImFudC1naG9zdC0xXCIsXG4gICAgXCJhbnQtZ2hvc3QtMVwiLFxuICAgIFwiYW50LWdob3N0LTJcIixcbiAgICBcImFudC1naG9zdC0yXCIsXG4gICAgXCJhbnQtZ2hvc3QtM1wiLFxuICAgIFwiYW50LWdob3N0LTNcIixcbiAgICBcImFudC1naG9zdC0yXCIsXG4gICAgXCJhbnQtZ2hvc3QtMlwiXG4gIF0sXG4gIFwiYnViYmxlLWJsdWVcIjogW1xuICAgIFwiYmFsbC1ibHVlLTFcIixcbiAgICBcImJhbGwtYmx1ZS0yXCIsXG4gICAgXCJiYWxsLWJsdWUtM1wiLFxuICAgIFwiYmFsbC1ibHVlLTRcIixcbiAgICBcImJhbGwtYmx1ZS01XCJcbiAgXSxcbiAgXCJleHBsb3Npb24tbFwiOiBbXG4gICAgXCJleHBsb3Npb24tbC0xXCIsXG4gICAgXCJleHBsb3Npb24tbC0yXCIsXG4gICAgXCJleHBsb3Npb24tbC0zXCIsXG4gICAgXCJleHBsb3Npb24tbC00XCIsXG4gICAgXCJleHBsb3Npb24tbC01XCIsXG4gICAgXCJleHBsb3Npb24tbC02XCIsXG4gICAgXCJleHBsb3Npb24yLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTZcIixcbiAgICBcImV4cGxvc2lvbjItbC03XCIsXG4gICAgXCJleHBsb3Npb24yLWwtOFwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uMi1sXCI6IFtcbiAgICBcImV4cGxvc2lvbjItbC0xXCIsXG4gICAgXCJleHBsb3Npb24yLWwtMlwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTNcIixcbiAgICBcImV4cGxvc2lvbjItbC00XCIsXG4gICAgXCJleHBsb3Npb24yLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTZcIixcbiAgICBcImV4cGxvc2lvbjItbC03XCIsXG4gICAgXCJleHBsb3Npb24yLWwtOFwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWxcIjogW1xuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtMVwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtMlwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtM1wiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtNFwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtNlwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtN1wiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtOFwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWVcIjogW1xuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMVwiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMlwiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtM1wiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNFwiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNVwiXG4gIF0sXG4gIGZsYW1lOiBbXCJmbGFtZS0xXCIsIFwiZmxhbWUtMlwiLCBcImZsYW1lLTNcIiwgXCJmbGFtZS00XCIsIFwiZmxhbWUtNVwiXSxcbiAgXCJmbGFtZS1sYXJnZVwiOiBbXG4gICAgXCJmbGFtZS1sYXJnZS0xXCIsXG4gICAgXCJmbGFtZS1sYXJnZS0yXCIsXG4gICAgXCJmbGFtZS1sYXJnZS0zXCIsXG4gICAgXCJmbGFtZS1sYXJnZS00XCIsXG4gICAgXCJmbGFtZS1sYXJnZS01XCIsXG4gICAgXCJmbGFtZS1sYXJnZS02XCJcbiAgXSxcbiAgZm9jdXM6IFtcbiAgICBcImZvY3VzLTFcIixcbiAgICBcImZvY3VzLTJcIixcbiAgICBcImZvY3VzLTNcIixcbiAgICBcImZvY3VzLTRcIixcbiAgICBcImZvY3VzLTVcIixcbiAgICBcImZvY3VzLTZcIixcbiAgICBcImZvY3VzLTdcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIlxuICBdLFxuICBcImdlbS1ncmVlblwiOiBbXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMlwiLFxuICAgIFwiZ2VtLWdyZWVuLTNcIixcbiAgICBcImdlbS1ncmVlbi00XCJcbiAgXSxcbiAgXCJnZW0tYmx1ZVwiOiBbXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0yXCIsXG4gICAgXCJnZW0tYmx1ZS0zXCIsXG4gICAgXCJnZW0tYmx1ZS00XCJcbiAgXSxcbiAgXCJnZW0tcmVkXCI6IFtcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMlwiLFxuICAgIFwiZ2VtLXJlZC0zXCIsXG4gICAgXCJnZW0tcmVkLTRcIlxuICBdLFxuICBcImdlbS1wdXJwbGVcIjogW1xuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0yXCIsXG4gICAgXCJnZW0tcHVycGxlLTNcIixcbiAgICBcImdlbS1wdXJwbGUtNFwiXG4gIF0sXG4gIFwiZ2VtLXNpbHZlclwiOiBbXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTJcIixcbiAgICBcImdlbS1zaWx2ZXItM1wiLFxuICAgIFwiZ2VtLXNpbHZlci00XCJcbiAgXSxcbiAgXCJncmVuYWRlLWFybWVkXCI6IFtcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtcmVkXCIsXG4gICAgXCJncmVuYWRlLXJlZFwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiXG4gIF0sXG4gIFwibWluZS1hY3RpdmVcIjogW1xuICAgIFwibWluZS1yZWRcIixcbiAgICBcIm1pbmUtcmVkXCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIlxuICBdLFxuICBcInNtb2tlLWdyZWVuXCI6IFtcbiAgICBcInNtb2tlLWdyZWVuLTFcIixcbiAgICBcInNtb2tlLWdyZWVuLTJcIixcbiAgICBcInNtb2tlLWdyZWVuLTNcIixcbiAgICBcInNtb2tlLWdyZWVuLTRcIixcbiAgICBcInNtb2tlLWdyZWVuLTVcIixcbiAgICBcInNtb2tlLWdyZWVuLTZcIixcbiAgICBcInNtb2tlLWdyZWVuLTdcIixcbiAgICBcInNtb2tlLWdyZWVuLThcIlxuICBdLFxuICB0ZWxlcG9ydDogW1xuICAgIFwidGVsZXBvcnQtMVwiLFxuICAgIFwidGVsZXBvcnQtMlwiLFxuICAgIFwidGVsZXBvcnQtM1wiLFxuICAgIFwidGVsZXBvcnQtNFwiLFxuICAgIFwidGVsZXBvcnQtNVwiLFxuICAgIFwidGVsZXBvcnQtNlwiLFxuICAgIFwidGVsZXBvcnQtN1wiXG4gIF0sXG4gIHZvcnRleDogW1xuICAgIFwidm9ydGV4LTFcIixcbiAgICBcInZvcnRleC0yXCIsXG4gICAgXCJ2b3J0ZXgtM1wiLFxuICAgIFwidm9ydGV4LTRcIixcbiAgICBcInZvcnRleC01XCIsXG4gICAgXCJ2b3J0ZXgtNlwiLFxuICAgIFwidm9ydGV4LTdcIixcbiAgICBcInZvcnRleC04XCIsXG4gICAgXCJ2b3J0ZXgtMTBcIixcbiAgICBcInZvcnRleC0xMVwiXG4gIF1cbn07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLm1hcGdlbiA9IHtcbiAgbGFuZF90eXBlOiBbXG4gICAge1xuICAgICAgZWRnZTogMSxcbiAgICAgIGJnOiBcImRpcnRcIixcbiAgICAgIGZnOiBcInJvY2tcIixcbiAgICAgIGRlY29yYXRpb25zOiB7XG4gICAgICAgIFwiMVwiOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNDMyLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDQ2OCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA1MDQsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogMzYsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNTQwLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDU3NixcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcIjJcIjogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNzIsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMTQ0LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDIxNixcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiAyODgsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMzYwLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG4gIF1cbn07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLm5hbWVzID0gW1xuICBcIkRhdmUgTGlzdGVyXCIsXG4gIFwiQWNlIFJpbW1lclwiLFxuICBcIlF1ZWVnIDUwMFwiLFxuICBcIkFicmFkb2xmIExpbmNsZXJcIixcbiAgXCJCZWFyZGxlc3MgUmlrZXJcIixcbiAgXCJUaGUgQW50IFdpdGggTm8gTmFtZVwiLFxuICBcIkFsIENhcG9uZVwiLFxuICBcIlRoZSBRdWVlblwiLFxuICBcIk1pY2tleSBFeWVzXCJcbl07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLm9iamVjdHMgPSB7XG4gIGRlZmF1bHQ6IHtcbiAgICBzaXplOiAxLFxuICAgIHdlaWdodDogMCxcbiAgICBib3VuY2U6IDAuNCxcbiAgICB0aW1lb3V0OiAwLFxuICAgIGRhbWFnZTogMzAsXG4gICAga25vY2s6IDEsXG4gICAgc3Bhd246IGZhbHNlLFxuICAgIHBsYXllcl9sb2NrOiBmYWxzZSxcbiAgICBsYXVuY2hfZGlzdGFuY2U6IDIsXG4gICAgZGVzdHJveV9ncm91bmQ6IHRydWUsXG4gICAgc3RvcDogMCxcbiAgICBpZ25vcmVfbGV2ZWxfZGFtYWdlOiBmYWxzZSxcbiAgICBldmVudHM6IHtcbiAgICAgIGZyYW1lOiBcIlwiLFxuICAgICAgZ3JvdW5kOiBcIlwiLFxuICAgICAgb2JqZWN0OiBcIlwiLFxuICAgICAgZXhwbG9zaW9uOiBcIlwiLFxuICAgICAgZGllOiBcIlwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7fSxcbiAgICBzcGVlZDoge1xuICAgICAgbWF4X2dyYXZpdHk6IDMwLFxuICAgICAgbWF4OiA0MCxcbiAgICAgIG1vdmU6IDQsXG4gICAgICBqdW1wOiAxMFxuICAgIH0sXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiB0cnVlLFxuICAgICAgb2JqZWN0OiBcImdyZW5hZGVcIixcbiAgICAgIHNwZWVkOiAyLFxuICAgICAgY291bnQ6IDZcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbi1sXCIsXG4gICAgICBzcHJpdGU6IFwiXCIsXG4gICAgICBhaXJfc3BpbjogZmFsc2UsXG4gICAgICBhaXJfZmxvYXQ6IGZhbHNlLFxuICAgICAgc3RhdGljX2FuZ2xlOiBmYWxzZSxcbiAgICAgIGdyb3VuZDogZmFsc2VcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uXCIsXG4gICAgICBib3VuY2U6IFwiZG9ua1wiLFxuICAgICAgaGl0OiBcIlwiLFxuICAgICAgYWlyOiBcIlwiLFxuICAgICAgd2FsazogXCJ3YWxrXCJcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgcGxheWVyX2hlYWx0aDogZmFsc2UsXG4gICAgICBwbGF5ZXJfbmFtZTogZmFsc2UsXG4gICAgICB0aW1lb3V0OiBmYWxzZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMCxcbiAgICAgIHNwZWVkOiAwLjYsXG4gICAgICBvZmZzZXRfeDogMCxcbiAgICAgIG9mZnNldF95OiAwLFxuICAgICAgdGltZW91dDogMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcIlwiXG4gICAgfVxuICB9LFxuICBwbGF5ZXI6IHtcbiAgICBzaXplOiAxMixcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICBib3VuY2U6IDAuNyxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJwbGF5ZXJfYm91bmNlXCIsXG4gICAgICBleHBsb3Npb246IFwiaGl0X3JlY2VpdmVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgY3JhdGU6IFwiY29sbGVjdFwiLFxuICAgICAgbWVkcGFjazogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS0xXCI6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tNVwiOiBcImNvbGxlY3RcIixcbiAgICAgIFwiZ2VtLTIwXCI6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tNTBcIjogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS0yMDBcIjogXCJjb2xsZWN0XCIsXG4gICAgICB2b3J0ZXg6IFwiY29sbGVjdFwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJhbnQtYm9keVwiLFxuICAgICAgYWlyX3NwaW46IGZhbHNlLFxuICAgICAgZ3JvdW5kOiBmYWxzZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGJvdW5jZTogXCJkb2lua1wiLFxuICAgICAgZXhwbG9zaW9uOiBcInBvcFwiXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHBsYXllcl9oZWFsdGg6IHRydWUsXG4gICAgICBwbGF5ZXJfbmFtZTogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgcGxheWVyX21pc3NpbGU6IHtcbiAgICBzaXplOiAxMixcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICBkYW1hZ2U6IDUwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBbXCJib3VuY2VfZXhwbG9kZVwiLCBcInNwYXduX2dob3N0XCJdLFxuICAgICAgZXhwbG9zaW9uOiBbXCJib3VuY2VfZXhwbG9kZVwiLCBcInNwYXduX2dob3N0XCJdXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFtcImJvdW5jZV9leHBsb2RlXCIsIFwic3Bhd25fZ2hvc3RcIl1cbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImFudC1ib21iXCIsXG4gICAgICBhaXJfc3BpbjogdHJ1ZVxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICBwbGF5ZXJfbmFtZTogdHJ1ZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAwLjYsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHNwcml0ZTogXCJiYWxsLXJlZFwiXG4gICAgfVxuICB9LFxuICBwbGF5ZXJfZ2hvc3Q6IHtcbiAgICBzaXplOiAxMixcbiAgICB3ZWlnaHQ6IDAsXG4gICAgZGFtYWdlOiAxLFxuICAgIGtub2NrOiAwLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImhpdF9yZWNlaXZlXCIsXG4gICAgICBleHBsb3Npb246IFwiaGl0X3JlY2VpdmVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImhpdF9naXZlXCJcbiAgICB9LFxuICAgIHNwZWVkOiB7XG4gICAgICBtYXg6IDIuNSxcbiAgICAgIG1vdmU6IDAuM1xuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiYW50LWdob3N0XCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgcGxheWVyX25hbWU6IHRydWVcbiAgICB9XG4gIH0sXG4gIGNyYXRlOiB7XG4gICAgc2l6ZTogMTYsXG4gICAgc3Bhd246IHRydWUsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiY3JhdGUtd2VhcG9uXCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMSxcbiAgICAgIHRpbWVvdXQ6IDMwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1ibHVlXCJcbiAgICB9XG4gIH0sXG4gIG1lZHBhY2s6IHtcbiAgICBzaXplOiAxNixcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJjcmF0ZS1oZWFsdGhcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAxLFxuICAgICAgdGltZW91dDogMzAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYWxsLXJlZFwiXG4gICAgfVxuICB9LFxuICBcImdlbS0xXCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tZ3JlZW5cIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tNVwiOiB7XG4gICAgc2l6ZTogMTgsXG4gICAgc3Bhd246IHRydWUsXG4gICAgc3RvcDogMTAsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZ2VtLWJsdWVcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tMjBcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1yZWRcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tNTBcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1wdXJwbGVcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tMjAwXCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tc2lsdmVyXCIsXG4gICAgICBzdGF0aWNfYW5nbGU6IHRydWUsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIHZvcnRleDoge1xuICAgIHNpemU6IDIyLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcInZvcnRleFwiXG4gICAgfVxuICB9LFxuICB0YXJnZXQ6IHtcbiAgICBzaXplOiAyMixcbiAgICBkYW1hZ2U6IDAsXG4gICAgc3Bhd246IHRydWUsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbi1sYXNlci1ibHVlXCIsXG4gICAgICBzcHJpdGU6IFwidGFyZ2V0XCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBleHBsb3Npb246IFwicG9wXCIsXG4gICAgICBhaXI6IFwibm9uZVwiXG4gICAgfVxuICB9LFxuICBudWNsZWFyOiB7XG4gICAgc2l6ZTogMjIsXG4gICAgZGFtYWdlOiAxMDAsXG4gICAgc3Bhd246IHRydWUsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24tZ3JlZW4tbFwiLFxuICAgICAgc3ByaXRlOiBcIm51Y2xlYXJcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb25fZ2FzXCIsXG4gICAgICBhaXI6IFwibm9uZVwiXG4gICAgfVxuICB9LFxuICBtaW5lOiB7XG4gICAgc2l6ZTogNTgsXG4gICAgZGFtYWdlOiA4MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwibWluZVwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICBcImFzdGVyb2lkLXNtYWxsXCI6IHtcbiAgICBzaXplOiAxNSxcbiAgICB3ZWlnaHQ6IDEsXG4gICAgZGFtYWdlOiA0MCxcbiAgICBldmVudHM6IHtcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uMi1sXCIsXG4gICAgICBzcHJpdGU6IFwiYXN0ZXJvaWQtc21hbGxcIixcbiAgICAgIGFpcl9zcGluOiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgc3BlZWQ6IDAuNixcbiAgICAgIG9mZnNldF94OiAtNSxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH0sXG4gIFwiYXN0ZXJvaWQtbGFyZ2VcIjoge1xuICAgIHNpemU6IDM0LFxuICAgIHdlaWdodDogMSxcbiAgICBkYW1hZ2U6IDgwLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImRpZVwiLFxuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImNsdXN0ZXJcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBjbHVzdGVyOiB7XG4gICAgICBjaXJjbGU6IHRydWUsXG4gICAgICBvYmplY3Q6IFwiYXN0ZXJvaWQtc21hbGxcIixcbiAgICAgIHNwZWVkOiAxNixcbiAgICAgIGNvdW50OiAzXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24yLWxcIixcbiAgICAgIHNwcml0ZTogXCJhc3Rlcm9pZC1sYXJnZVwiLFxuICAgICAgYWlyX3NwaW46IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMC42LFxuICAgICAgb2Zmc2V0X3g6IC01LFxuICAgICAgdGltZW91dDogMjAsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfSxcbiAgZGlnOiB7XG4gICAgc2l6ZTogMixcbiAgICB3ZWlnaHQ6IDAsXG4gICAgZGFtYWdlOiAxNixcbiAgICB0aW1lb3V0OiA2LFxuICAgIGlnbm9yZV9sZXZlbF9kYW1hZ2U6IHRydWUsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFtcImRlc3Ryb3lcIiwgXCJkcmFnX3BsYXllclwiLCBcImRpZVwiXVxuICAgIH1cbiAgfSxcbiAgcHVuY2g6IHtcbiAgICBzaXplOiAyMCxcbiAgICB3ZWlnaHQ6IDAsXG4gICAgZGFtYWdlOiAxNixcbiAgICB0aW1lb3V0OiAyNixcbiAgICBwbGF5ZXJfbG9jazogdHJ1ZSxcbiAgICBzdG9wOiAyNCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJzbGlkZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiaGl0X2dpdmVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZmxhbWUtbGFyZ2VcIlxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIixcbiAgICAgIGJvdW5jZTogXCJkb2lua1wiLFxuICAgICAgaGl0OiBcInB1bmNoXCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDEsXG4gICAgICBzcGVlZDogMS41LFxuICAgICAgb2Zmc2V0X3g6IC0xMCxcbiAgICAgIG9mZnNldF95OiAwLFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJmbGFtZVwiXG4gICAgfVxuICB9LFxuICBsYXNlcjoge1xuICAgIHNpemU6IDI0LFxuICAgIHdlaWdodDogMCxcbiAgICB0aW1lb3V0OiAyMCxcbiAgICBkYW1hZ2U6IDMwLFxuICAgIGRlc3Ryb3lfZ3JvdW5kOiBmYWxzZSxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIG9iamVjdDogXCJub25lXCIsXG4gICAgICBkaWU6IFwibm9uZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFtcImV4cGxvZGVcIiwgXCJkaWVcIl0sXG4gICAgICBwbGF5ZXJfZ2hvc3Q6IFtcImhpdF9naXZlXCIsIFwiZGllXCJdXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJsYXNlci1ibHVlXCIsXG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uLWxhc2VyLWJsdWVcIlxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb25fbGFzZXJcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHNwZWVkOiAwLFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogZmFsc2UsXG4gICAgICBzcHJpdGU6IFwiYnViYmxlLWJsdWVcIlxuICAgIH1cbiAgfSxcbiAgYmF6b29rYToge1xuICAgIHNpemU6IDYsXG4gICAgd2VpZ2h0OiAwLjcsXG4gICAgdGltZW91dDogMzAwLFxuICAgIGRhbWFnZTogNzAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImJhem9va2Etc2hlbGxcIlxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHNwZWVkOiAxLjUsXG4gICAgICBvZmZzZXRfeDogLTEwLFxuICAgICAgb2Zmc2V0X3k6IDAsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH0sXG4gIGdyZW5hZGU6IHtcbiAgICBzaXplOiA0LFxuICAgIHdlaWdodDogMC43LFxuICAgIHRpbWVvdXQ6IDcyLFxuICAgIGRhbWFnZTogNTAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiYm91bmNlXCIsXG4gICAgICBvYmplY3Q6IFwiYm91bmNlXCIsXG4gICAgICBleHBsb3Npb246IFwiYm91bmNlXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiYm91bmNlXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgYWlyX3NwaW46IHRydWUsXG4gICAgICBzcHJpdGU6IFwiZ3JlbmFkZS1hcm1lZFwiXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHRpbWVvdXQ6IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiY291bnRkb3duXCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDEsXG4gICAgICB0aW1lb3V0OiAyMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImJhbGwtZ3JlZW5cIlxuICAgIH1cbiAgfSxcbiAgcHVtcGtpbjoge1xuICAgIHNpemU6IDEwLFxuICAgIHdlaWdodDogMSxcbiAgICB0aW1lb3V0OiAxMjAsXG4gICAgZGFtYWdlOiA3MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJib3VuY2VcIixcbiAgICAgIG9iamVjdDogXCJib3VuY2VcIixcbiAgICAgIGV4cGxvc2lvbjogXCJib3VuY2VcIixcbiAgICAgIGRpZTogXCJjbHVzdGVyXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJib3VuY2VcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBhaXJfc3BpbjogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJwdW1wa2luXCJcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgdGltZW91dDogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJzcG9va3lcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICByb3RhdGU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmF0XCJcbiAgICB9LFxuICAgIGNsdXN0ZXI6IHtcbiAgICAgIGNpcmNsZTogZmFsc2UsXG4gICAgICBvYmplY3Q6IFwicHVtcGtpbl9zbGljZVwiLFxuICAgICAgc3BlZWQ6IDE1LFxuICAgICAgY291bnQ6IDNcbiAgICB9XG4gIH0sXG4gIHB1bXBraW5fc2xpY2U6IHtcbiAgICBzaXplOiA2LFxuICAgIHdlaWdodDogMSxcbiAgICB0aW1lb3V0OiAyMDAsXG4gICAgZGFtYWdlOiAzMCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBhaXJfc3BpbjogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJwdW1wa2luLXNsaWNlXCJcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICB0aW1lb3V0OiAyMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImJhbGwtb3JhbmdlXCJcbiAgICB9XG4gIH0sXG4gIHBhaW5naXZlcjoge1xuICAgIHNpemU6IDIwLFxuICAgIHdlaWdodDogMSxcbiAgICBkYW1hZ2U6IDUwLFxuICAgIGNsdXN0ZXI6IHtcbiAgICAgIGNpcmNsZTogZmFsc2UsXG4gICAgICBvYmplY3Q6IFwiZ3JlbmFkZVwiLFxuICAgICAgc3BlZWQ6IDE1LFxuICAgICAgY291bnQ6IDNcbiAgICB9LFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgZGllOiBcImNsdXN0ZXJcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJyb2NrZXRcIlxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfVxufTtcblxuLy8gcHJlcCBvYmplY3RzXG5jb25maWcub2JqZWN0X3JlZnMgPSBbXTtcbmZvciAoa2V5IGluIGNvbmZpZy5vYmplY3RzKSB7XG4gIGNvbmZpZy5vYmplY3RfcmVmcy5wdXNoKGtleSk7XG4gIGNvbmZpZy5vYmplY3RzW2tleV0gPSBkZWVwbWVyZ2UoY29uZmlnLm9iamVjdHMuZGVmYXVsdCwgY29uZmlnLm9iamVjdHNba2V5XSwge1xuICAgIGFycmF5TWVyZ2U6IGRvbnRfbWVyZ2VcbiAgfSk7XG59XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLnNwcml0ZXMgPSB7XG4gIFwiYmFsbC1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxOTIsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImJhbGwtZ3JlZW5cIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDI0MCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYmFsbC1vcmFuZ2VcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDI4OCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYmFsbC1yZWRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDMzNixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYmFsbC1zaWx2ZXJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDM4NCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIGJhdDoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQzMixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiZmxhbWUtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJmbGFtZS0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA1MjgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImZsYW1lLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDU3NixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiZmxhbWUtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNjI0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJmbGFtZS01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2NzIsXG4gICAgeTogMTA1NlxuICB9LFxuICBcIm1pbmUtZ3JleVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzIwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJtaW5lLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzY4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJwdW1wa2luLXNsaWNlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4MTYsXG4gICAgeTogMTA1NlxuICB9LFxuICBwdW1wa2luOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogODY0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJzdGFyLWJsdWVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDkxMixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LWJvZHktYWlyLWxlZnRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDk2MCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LWJvZHktYWlyLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMDA4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtYm9keS1oaXQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LWJvZHktaGl0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMFxuICB9LFxuICBcImFudC1ib2R5LWhpdC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDQ4XG4gIH0sXG4gIFwiYW50LWJvZHktc3VwZXJtYW4tbGVmdFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA5NlxuICB9LFxuICBcImFudC1ib2R5LXN1cGVybWFuLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDE0NFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDI0MFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDI4OFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDMzNlxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDM4NFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA0MzJcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNDgwXG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDUyOFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNjI0XG4gIH0sXG4gIFwiYW50LWJvbWJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNjcyXG4gIH0sXG4gIFwiYW50LWdob3N0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDU3NixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtZ2hvc3QtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNjQwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1naG9zdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA3MDQsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWhlYWQtaGl0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDc2OCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtaGVhZC1oaXQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogODMyLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1oZWFkLWhpdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA4OTYsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWhlYWQtbGVmdC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA5NjAsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWhlYWQtbGVmdC0yXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJhbnQtaGVhZC1sZWZ0LTNcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNjRcbiAgfSxcbiAgXCJhbnQtaGVhZC1yaWdodC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDEyOFxuICB9LFxuICBcImFudC1oZWFkLXJpZ2h0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiYW50LWhlYWQtcmlnaHQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAyNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWJhem9va2EtbGVmdFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAzMjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWJhem9va2EtcmlnaHRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctbGVmdC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDQ0OFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLWxlZnQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA1MTJcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTNcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctbGVmdC00XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDY0MFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNzA0XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDgzMlxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogODk2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1sYXNlci1sZWZ0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC13ZWFwb24tbGFzZXItcmlnaHRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDAsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC13ZWFwb24tcHVuY2gtbGVmdFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNjQsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC13ZWFwb24tcHVuY2gtcmlnaHRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEyOCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNzIwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogODE2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogOTEyXG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAxMDA4XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFybW91cnktZGlnXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5NixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJtb3VyeS1leHRpbmd1aXNoZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTQ0LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcm1vdXJ5LWxhc2VyLWJsdWVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDE5MixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJtb3VyeS1sYXNlci1yZWRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDI0MCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJtb3VyeS1wdW5jaFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjg4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcnJvdy1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAzMzYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFycm93LWdyZWVuXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAzODQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFycm93LWdyZXlcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQzMixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJyb3ctcHVycGxlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA0ODAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFycm93LXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNTI4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhc3Rlcm9pZC0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAwLFxuICAgIHk6IDc2OFxuICB9LFxuICBcImFzdGVyb2lkLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImJhbGwtYmx1ZS0xXCI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDEwMjRcbiAgfSxcbiAgXCJiYWxsLWJsdWUtMlwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTA4MCxcbiAgICB5OiAxMDI0XG4gIH0sXG4gIFwiYmFsbC1ibHVlLTNcIjoge1xuICAgIHNpemU6IDI0LFxuICAgIHg6IDEwMjQsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYmFsbC1ibHVlLTRcIjoge1xuICAgIHNpemU6IDI0LFxuICAgIHg6IDEwMjQsXG4gICAgeTogOTg0XG4gIH0sXG4gIFwiYmFsbC1ibHVlLTVcIjoge1xuICAgIHNpemU6IDI0LFxuICAgIHg6IDU3NixcbiAgICB5OiAxMDI0XG4gIH0sXG4gIFwiYmF6b29rYS1zaGVsbFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNTc2LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJjcmF0ZS1oZWFsdGhcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDYyNCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiY3JhdGUtd2VhcG9uXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2NzIsXG4gICAgeTogMTEyMFxuICB9LFxuICBjcm9zc2hhaXI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA3MjAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTFcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC0yXCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMTkyLFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC0zXCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMTkyLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTVcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAzODQsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAzODQsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDAsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtOFwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDE5MixcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJleHBsb3Npb24tbC0xXCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMzg0LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTJcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiA1NzYsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTNcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiA1NzYsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtNFwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDU3NixcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJleHBsb3Npb24tbC01XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHBsb3Npb24tbC02XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMTkyLFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbi1sLTdcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAzODQsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMTkyLFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDI4OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAzODQsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNDgwLFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDU3NixcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNjcyLFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbjItbC0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA3NjgsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDg2NCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtNFwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDU3NixcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtNVwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiA3NjgsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTdcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiA3NjgsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLThcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiA3NjgsXG4gICAgeTogNTc2XG4gIH0sXG4gIGV4dGluZ3Vpc2hlcjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDc2OCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NixcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAxOTIsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMjg4LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDM4NCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS02XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA0ODAsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZm9jdXMtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNTc2LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZvY3VzLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDY3MixcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmb2N1cy0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA3NjgsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZm9jdXMtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogODY0LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZvY3VzLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZm9jdXMtNlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDk2XG4gIH0sXG4gIFwiZm9jdXMtN1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImZvY3VzLThcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAyODhcbiAgfSxcbiAgXCJnZW0tYmx1ZS0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4MTYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ibHVlLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDg2NCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWJsdWUtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTEyLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tYmx1ZS00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5NjAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ncmVlbi0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMDA4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWdyZWVuLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMDQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ncmVlbi00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDhcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogOTZcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTQ0XG4gIH0sXG4gIFwiZ2VtLXB1cnBsZS00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDE5MlxuICB9LFxuICBcImdlbS1yZWQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAyNDBcbiAgfSxcbiAgXCJnZW0tcmVkLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMjg4XG4gIH0sXG4gIFwiZ2VtLXJlZC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDMzNlxuICB9LFxuICBcImdlbS1yZWQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJnZW0tc2lsdmVyLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDMyXG4gIH0sXG4gIFwiZ2VtLXNpbHZlci0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDQ4MFxuICB9LFxuICBcImdlbS1zaWx2ZXItM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA1MjhcbiAgfSxcbiAgXCJnZW0tc2lsdmVyLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZ3JlbmFkZS1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA2MjRcbiAgfSxcbiAgXCJncmVuYWRlLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA2NzJcbiAgfSxcbiAgXCJsYXNlci1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDcyMFxuICB9LFxuICBcImxhc2VyLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgbnVjbGVhcjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAzODRcbiAgfSxcbiAgcm9ja2V0OiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA4MTZcbiAgfSxcbiAgc21va2U6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiA2MDAsXG4gICAgeTogMTAyNFxuICB9LFxuICB0YXJnZXQ6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA0OCxcbiAgICB5OiAxMTY4XG4gIH0sXG4gIFwidGVsZXBvcnQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJ0ZWxlcG9ydC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDkxMlxuICB9LFxuICBcInRlbGVwb3J0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwidGVsZXBvcnQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAxMDA4XG4gIH0sXG4gIFwidGVsZXBvcnQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwidGVsZXBvcnQtNlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAxMTA0XG4gIH0sXG4gIFwidGVsZXBvcnQtN1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMCxcbiAgICB5OiAxMTY4XG4gIH0sXG4gIFwidm9ydGV4LTFcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiA0ODBcbiAgfSxcbiAgXCJ2b3J0ZXgtMTBcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJ2b3J0ZXgtMTFcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiA2NzJcbiAgfSxcbiAgXCJ2b3J0ZXgtMlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDc2OFxuICB9LFxuICBcInZvcnRleC0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogODY0XG4gIH0sXG4gIFwidm9ydGV4LTRcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDAsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwidm9ydGV4LTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2LFxuICAgIHk6IDk2MFxuICB9LFxuICBcInZvcnRleC02XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAxOTIsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwidm9ydGV4LTdcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDI4OCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJ2b3J0ZXgtOFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMzg0LFxuICAgIHk6IDk2MFxuICB9LFxuICBcInZvcnRleC05XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA0ODAsXG4gICAgeTogOTYwXG4gIH1cbn07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLndlYXBvbnMgPSB7XG4gIGRlZmF1bHQ6IHtcbiAgICB0aXRsZTogXCJcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJcIixcbiAgICBzcHJpdGU6IFwiXCIsXG4gICAgZmlyZV9hdWRpbzogXCJcIixcbiAgICBmaXJlX3Nwcml0ZTogXCJcIixcbiAgICBmaXJlX2JvZHlfc3ByaXRlOiBcIlwiLFxuICAgIGZpcmVfYW5nbGVfbG9jazogZmFsc2UsXG4gICAgYXV0b19mb2xsb3c6IGZhbHNlLFxuICAgIHJlcXVpcmVfd2FsazogZmFsc2UsXG4gICAgc3BlZWQ6IDAsXG4gICAgb2JqZWN0OiBcIlwiLFxuICAgIGNvb2xkb3duOiAwLFxuICAgIHJlY29pbDogMCxcbiAgICBpbmVydGlhOiAwXG4gIH0sXG4gIGRpZzoge1xuICAgIHRpdGxlOiBcIkRpZ1wiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImFybW91cnktZGlnXCIsXG4gICAgc3ByaXRlOiBcImRpZ1wiLFxuICAgIGZpcmVfc3ByaXRlOiBcImRpZy1maXJlXCIsXG4gICAgZmlyZV9ib2R5X3Nwcml0ZTogXCJ3YWxrXCIsXG4gICAgZmlyZV9hbmdsZV9sb2NrOiB0cnVlLFxuICAgIHNwZWVkOiAzLFxuICAgIG9iamVjdDogXCJkaWdcIixcbiAgICBjb29sZG93bjogMTBcbiAgfSxcbiAgcGhhc2VyOiB7XG4gICAgdGl0bGU6IFwiUGhhc2VyXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiYXJtb3VyeS1sYXNlci1ibHVlXCIsXG4gICAgc3ByaXRlOiBcImxhc2VyXCIsXG4gICAgZmlyZV9hdWRpbzogXCJzaG9vdF9sYXNlclwiLFxuICAgIHNwZWVkOiAzMCxcbiAgICBvYmplY3Q6IFwibGFzZXJcIixcbiAgICBjb29sZG93bjogNixcbiAgICByZWNvaWw6IDAuMSxcbiAgICBpbmVydGlhOiAwLjVcbiAgfSxcbiAgYmF6b29rb2lkOiB7XG4gICAgdGl0bGU6IFwiQmF6b29rb2lkXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiYmF6b29rYS1zaGVsbFwiLFxuICAgIHNwcml0ZTogXCJiYXpvb2thXCIsXG4gICAgZmlyZV9hdWRpbzogXCJzaG9vdFwiLFxuICAgIGF1dG9fZm9sbG93OiB0cnVlLFxuICAgIHNwZWVkOiAyNCxcbiAgICBvYmplY3Q6IFwiYmF6b29rYVwiLFxuICAgIGNvb2xkb3duOiA0MCxcbiAgICByZWNvaWw6IDAuMixcbiAgICBpbmVydGlhOiAwLjVcbiAgfSxcbiAgZ3JlbmFkZToge1xuICAgIHRpdGxlOiBcIkdyZW5hZGVcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgc3ByaXRlOiBcInRocm93XCIsXG4gICAgZmlyZV9hdWRpbzogXCJ0aHJvd1wiLFxuICAgIGZpcmVfc3ByaXRlOiBcInRocm93LWZpcmVcIixcbiAgICBhdXRvX2ZvbGxvdzogdHJ1ZSxcbiAgICBzcGVlZDogMjQsXG4gICAgb2JqZWN0OiBcImdyZW5hZGVcIixcbiAgICBjb29sZG93bjogMzAsXG4gICAgcmVjb2lsOiAwLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBwdW5jaDoge1xuICAgIHRpdGxlOiBcIkZpcmUgUHVuY2hcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJhcm1vdXJ5LXB1bmNoXCIsXG4gICAgc3ByaXRlOiBcInB1bmNoXCIsXG4gICAgZmlyZV9hdWRpbzogXCJ0aHJvd1wiLFxuICAgIGZpcmVfYm9keV9zcHJpdGU6IFwic3VwZXJtYW5cIixcbiAgICBzcGVlZDogMjQsXG4gICAgb2JqZWN0OiBcInB1bmNoXCIsXG4gICAgY29vbGRvd246IDEyMCxcbiAgICByZWNvaWw6IDAsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIHB1bXBraW46IHtcbiAgICB0aXRsZTogXCJQdW1wa2luXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwicHVtcGtpblwiLFxuICAgIHNwcml0ZTogXCJ0aHJvd1wiLFxuICAgIGZpcmVfYXVkaW86IFwidGhyb3dcIixcbiAgICBmaXJlX3Nwcml0ZTogXCJ0aHJvdy1maXJlXCIsXG4gICAgYXV0b19mb2xsb3c6IHRydWUsXG4gICAgc3BlZWQ6IDMwLFxuICAgIG9iamVjdDogXCJwdW1wa2luXCIsXG4gICAgY29vbGRvd246IDQ4LFxuICAgIHJlY29pbDogMCxcbiAgICBpbmVydGlhOiAwLjVcbiAgfSxcbiAgcGFpbmdpdmVyOiB7XG4gICAgdGl0bGU6IFwiUGFpbmdpdmVyIDIwMDBcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJyb2NrZXRcIixcbiAgICBzcHJpdGU6IFwiYmF6b29rYVwiLFxuICAgIGZpcmVfYXVkaW86IFwic2hvb3RcIixcbiAgICBzcGVlZDogMjQsXG4gICAgb2JqZWN0OiBcInBhaW5naXZlclwiLFxuICAgIGNvb2xkb3duOiAxMCxcbiAgICByZWNvaWw6IDAuNCxcbiAgICBpbmVydGlhOiAwLjVcbiAgfVxufTtcblxuLy8gcHJlcCB3ZWFwb25zXG5mb3IgKGtleSBpbiBjb25maWcud2VhcG9ucykge1xuICBjb25maWcud2VhcG9uc1trZXldID0gZGVlcG1lcmdlKGNvbmZpZy53ZWFwb25zLmRlZmF1bHQsIGNvbmZpZy53ZWFwb25zW2tleV0sIHtcbiAgICBhcnJheU1lcmdlOiBkb250X21lcmdlXG4gIH0pO1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQWN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFBlcmZvcm0gYWN0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uID0gZnVuY3Rpb24ocGxheWVyX2lkLCBhY3Rpb24pIHtcbiAgdmFyIHJlc3BvbnNlID0geyBzdWNjZXNzOiBmYWxzZSB9O1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCAhYWN0aW9uIHx8ICFvYmopIHtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICB2YXIgbG9ja2VkX29iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1twbGF5ZXIubG9ja2VkXTtcblxuICAvLyBwbGF5ZXJzIGNhbiBkbyBzdHVmZlxuICBpZiAoIXBsYXllci5kZWFkICYmICFsb2NrZWRfb2JqICYmIHBsYXllci5oaXQgPT09IDApIHtcbiAgICAvLyBydW4gdGhlbVxuICAgIGlmIChhY3Rpb24uYWN0aW9uID09PSBcIm1vdmVcIikge1xuICAgICAgcmVzcG9uc2UgPSB0aGlzLmFjdGlvbl9tb3ZlKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKTtcbiAgICB9XG4gICAgaWYgKGFjdGlvbi5hY3Rpb24gPT09IFwianVtcFwiKSB7XG4gICAgICByZXNwb25zZSA9IHRoaXMuYWN0aW9uX2p1bXAocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYWN0aW9uLmFjdGlvbiA9PT0gXCJzaG9vdFwiKSB7XG4gICAgICByZXNwb25zZSA9IHRoaXMuYWN0aW9uX3Nob290KHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICByZXNwb25zZS54ID0gb2JqLng7XG4gIHJlc3BvbnNlLnkgPSBvYmoueTtcbiAgcmVzcG9uc2Uuc3BlZWRfeCA9IG9iai5zcGVlZF94O1xuICByZXNwb25zZS5zcGVlZF95ID0gb2JqLnNwZWVkX3k7XG4gIHJlc3BvbnNlLmZyYW1lID0gdGhpcy5zdGF0ZS5mcmFtZTtcblxuICAvLyByZXR1cm4gc3RhdHVzXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFdhbGtpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fbW92ZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKSB7XG4gIHJlc3BvbnNlLnR5cGUgPSBcIndhbGtcIjtcblxuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgdmFyIHNwZWVkID0gdGhpcy5zY2hlbWUubGV2ZWxzLnNwZWVkW3BsYXllci5sZXZlbF0gfHwgb2JqLmMuc3BlZWQubW92ZTtcbiAgICB2YXIgc3BlZWQgPSBhY3Rpb24uc3BlZWQgfHwgc3BlZWQ7XG4gICAgdmFyIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCBhY3Rpb24uYW5nbGUsIHNwZWVkKTtcbiAgICBpZiAod2Fsay5tb3ZlKSB7XG4gICAgICBpZiAodGhpcy5hY3Rpb25fd2Fsa19tb3ZlKG9iaiwgd2Fsay5wYXRoKSkge1xuICAgICAgICAvLyByZWNvcmQgcGxheWVyIGV2ZW50XG4gICAgICAgIHBsYXllci5ldmVudHMucHVzaCh7IGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLCB0eXBlOiBcIndhbGtcIiB9KTtcblxuICAgICAgICAvLyByZXR1cm4gc3VjY2Vzc1xuICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKiBXYWxraW5nIGluIGEgZGlyZWN0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX3dhbGtfZGlyID0gZnVuY3Rpb24ob2JqLCBkaXIsIHNwZWVkKSB7XG4gIHZhciBzcGVlZCA9IHNwZWVkIHx8IG9iai5jLnNwZWVkLm1vdmU7XG5cbiAgLy8gZ2V0IGluaXRpYWwgcGF0aFxuICB2YXIgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIDAsIHNwZWVkKTtcblxuICBpZiAod2Fsay5kaXJlY3Rpb24gIT0gZGlyKSB7XG4gICAgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIDE4MCwgc3BlZWQpO1xuICAgIGlmICh3YWxrLmRpcmVjdGlvbiAhPSBkaXIpIHtcbiAgICAgIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCA5MCwgc3BlZWQpO1xuICAgICAgaWYgKHdhbGsuZGlyZWN0aW9uICE9IGRpcikge1xuICAgICAgICB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgMjcwLCBzcGVlZCk7XG4gICAgICAgIGlmICh3YWxrLmRpcmVjdGlvbiAhPSBkaXIpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKCF3YWxrLm1vdmUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLmFjdGlvbl93YWxrX21vdmUob2JqLCB3YWxrLnBhdGgpO1xufTtcblxuLyogV2FsayBtb3Zpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fd2Fsa19tb3ZlID0gZnVuY3Rpb24ob2JqLCBwYXRoKSB7XG4gIC8vIGdvIHRocm91Z2ggdGhlIGNvdXJzZVxuICB2YXIgeDEgPSBvYmoueDtcbiAgdmFyIHkxID0gb2JqLnk7XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwb2ludCA9IHBhdGhbaV07XG5cbiAgICAvLyBjaGVjayBvYmplY3QgY29sbGlzaW9uc1xuICAgIHZhciBjb2wgPSB0aGlzLmNvbGxpc2lvbnMob2JqLCBwb2ludC54LCBwb2ludC55KTtcbiAgICBpZiAoY29sKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgb2JqLnggPSBwb2ludC54O1xuICAgIG9iai55ID0gcG9pbnQueTtcbiAgICBvYmoubW92ZWQgPSB0cnVlO1xuICB9XG5cbiAgaWYgKG9iai5tb3ZlZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG4vKiBKdW1waW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX2p1bXAgPSBmdW5jdGlvbihyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbikge1xuICByZXNwb25zZS50eXBlID0gXCJqdW1wXCI7XG5cbiAgaWYgKG9iai5ncm91bmRlZCAmJiBwbGF5ZXIuY29vbGRvd24gPT09IDApIHtcbiAgICB2YXIgc3BlZWQgPSB0aGlzLnNjaGVtZS5sZXZlbHMuanVtcFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLmp1bXA7XG4gICAgdmFyIHh5ID0geHlfc3BlZWQoYWN0aW9uLmFuZ2xlLCBzcGVlZCk7XG4gICAgb2JqLnNwZWVkX3ggPSB4eS54LmZpeGVkKCk7XG4gICAgb2JqLnNwZWVkX3kgPSB4eS55LmZpeGVkKCk7XG4gICAgaWYgKHRoaXMucGh5c2ljc19tb3ZlKG9iaikpIHtcbiAgICAgIC8vIHNldCBncm91bmRpbmdcbiAgICAgIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuXG4gICAgICAvLyBzZXQgY29vbGRvd25cbiAgICAgIHBsYXllci5jb29sZG93biA9IDc7XG5cbiAgICAgIC8vIHJlY29yZCBwbGF5ZXIgZXZlbnRcbiAgICAgIHBsYXllci5ldmVudHMucHVzaCh7IGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLCB0eXBlOiBcImp1bXBcIiB9KTtcblxuICAgICAgLy8gcmV0dXJuIHN1Y2Nlc3NcbiAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFNob290aW5nIHdlYXBvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbl9zaG9vdCA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKSB7XG4gIHJlc3BvbnNlLnR5cGUgPSBcInNob290XCI7XG5cbiAgLy8gaWYgd2FpdGluZyBmb3IgY29vbGRvd25cbiAgLy8gaXMgbm90IHJlYWwgd2VhcG9uXG4gIC8vIGRvIHdlIG5lZWQgdG8gd2Fsa1xuICAvLyBjaGVjayBhcm1vdXJ5IGNvdW50XG4gIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1thY3Rpb24ud2VhcG9uXTtcbiAgaWYgKFxuICAgIChwbGF5ZXIuY29vbGRvd24gPT09IDAgJiYgIXdlYXBvbikgfHxcbiAgICAod2VhcG9uLnJlcXVpcmVfd2FsayAmJiAhb2JqLmdyb3VuZGVkKSB8fFxuICAgIHBsYXllci5hcm1vdXJ5W2FjdGlvbi53ZWFwb25dID09PSAwXG4gICkge1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIC8vIGNyYXRlIHRoZSBvYmplY3RcbiAgdmFyIHNwZWVkID0geHlfc3BlZWQoYWN0aW9uLmFuZ2xlLCB3ZWFwb24uc3BlZWQpO1xuICB2YXIgc2hvdF9vYmogPSB0aGlzLmNyZWF0ZV9vYmplY3Qoe1xuICAgIHR5cGU6IHdlYXBvbi5vYmplY3QsXG4gICAgcGxheWVyX2lkOiBwbGF5ZXIuaWQsXG4gICAgeDogb2JqLngsXG4gICAgeTogb2JqLnksXG4gICAgc3BlZWRfeDogKHNwZWVkLnggKyBvYmouc3BlZWRfeCAqIHdlYXBvbi5pbmVydGlhKS5maXhlZCgpLFxuICAgIHNwZWVkX3k6IChzcGVlZC55ICsgb2JqLnNwZWVkX3kgKiB3ZWFwb24uaW5lcnRpYSkuZml4ZWQoKVxuICB9KTtcblxuICAvLyBzZXQgcGxheWVyIHJlY29pbFxuICBpZiAoIW9iai5ncm91bmRlZCkge1xuICAgIG9iai5zcGVlZF94ICs9ICgtc3BlZWQueCAqIHdlYXBvbi5yZWNvaWwpLmZpeGVkKCk7XG4gICAgb2JqLnNwZWVkX3kgKz0gKC1zcGVlZC55ICogd2VhcG9uLnJlY29pbCkuZml4ZWQoKTtcbiAgfVxuXG4gIC8vIHNldCBhcm1vdXJ5IHZhbHVlc1xuICB0aGlzLnVwZGF0ZV9wbGF5ZXJfYXJtb3VyeShwbGF5ZXIuaWQsIGFjdGlvbi53ZWFwb24sIC0xKTtcblxuICAvLyBzZXQgY29vbGRvd25cbiAgcGxheWVyLmNvb2xkb3duID0gd2VhcG9uLmNvb2xkb3duO1xuXG4gIC8vIHNldCBwbGF5ZXIgbG9ja1xuICBpZiAoc2hvdF9vYmouYy5wbGF5ZXJfbG9jaykge1xuICAgIHBsYXllci5sb2NrZWQgPSBzaG90X29iai5rZXk7XG4gIH1cblxuICAvLyByZWNvcmQgcGxheWVyIGV2ZW50XG4gIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgdHlwZTogXCJzaG9vdFwiLFxuICAgIG9iajogc2hvdF9vYmoua2V5LFxuICAgIHdlYXBvbjogYWN0aW9uLndlYXBvblxuICB9KTtcblxuICAvLyByZXR1cm4gc3VjY2Vzc1xuICByZXNwb25zZS5zdWNjZXNzID0gdHJ1ZTtcbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIENvbGxpc2lvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gc2luZ2xlIGNvbGxpc2lvbiBjaGVja1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNvbGxpc2lvbnMgPSBmdW5jdGlvbihvYmosIHgsIHkpIHtcbiAgLy8gY2hlY2sgY29sbGlzaW9uIHdpdGggZ3JvdW5kXG4gIGlmICh0aGlzLm1hcC5pKHJvdW5kKHgpLCByb3VuZCh5KSkpIHtcbiAgICB2YXIgZXZlbnQgPSB0aGlzLmV2ZW50KG9iaiwgXCJncm91bmRcIiwgbnVsbCk7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfVxuICB9XG5cbiAgLy8gY2hlY2sgY29sbGlzaW9ucyB3aXRoIG90aGVyIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUub2JqZWN0cykge1xuICAgIGlmIChvYmoua2V5ID09PSBrZXkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb2xsaXNpb25fb2JqKG9iaiwgeCwgeSwgdGhpcy5zdGF0ZS5vYmplY3RzW2tleV0pKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBSdW4gb2JqZWN0IGNvbGxpc2lvbiBjaGVja1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNvbGxpc2lvbl9vYmogPSBmdW5jdGlvbihvYmosIHgsIHksIGNoZWNrX29iaikge1xuICAvLyBpZiBubyBjb2xsaXNpb25cbiAgaWYgKFxuICAgIHRoaXMuY29sbGlzaW9uX2NoZWNrKFxuICAgICAgeCxcbiAgICAgIHksXG4gICAgICBjaGVja19vYmoueCxcbiAgICAgIGNoZWNrX29iai55LFxuICAgICAgb2JqLmMuc2l6ZSxcbiAgICAgIGNoZWNrX29iai5jLnNpemVcbiAgICApXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHByZXZlbnQgaGl0cyBvbiBwYXJlbnQgcGxheWVycyBmb3IgYSBzaG9ydCB0aW1lIG9yIGlmIHRoZXkncmUgcGxheWVyIGxvY2tlZFxuICBpZiAoXG4gICAgY2hlY2tfb2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiZcbiAgICBjaGVja19vYmoucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkICYmXG4gICAgKHRoaXMuc3RhdGUuZnJhbWUgPCBvYmouZnJhbWUgKyAxNSB8fCBvYmouYy5wbGF5ZXJfbG9jaylcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcHJldmVudCBjbHVzdGVycyBoaXR0aW5nIGVhY2ggb3RoZXIgZm9yIGEgc2hvcnQgdGltZVxuICBpZiAoXG4gICAgY2hlY2tfb2JqLmZyYW1lID09PSBvYmouZnJhbWUgJiZcbiAgICBjaGVja19vYmoucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkICYmXG4gICAgdGhpcy5zdGF0ZS5mcmFtZSA8IG9iai5mcmFtZSArIDYwXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHRyaWdnZXIgYmFzaWMgb2JqZWN0IGNvbGxpc2lvbiBldmVudFxuICBpZiAodGhpcy5ldmVudChvYmosIFwib2JqZWN0XCIsIGNoZWNrX29iaikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIHRyaWdnZXIgc3BlY2lmaWMgb2JqZWN0IGNvbGxpc2lvbiBldmVudFxuICB2YXIgZXZlbnQgPSBvYmouYy5vYmplY3RfZXZlbnRzW2NoZWNrX29iai50eXBlXTtcbiAgaWYgKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMucnVuX2V2ZW50KG9iaiwgZXZlbnQsIGNoZWNrX29iaikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ29sbGlzaW9uIE1hdGhzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY29sbGlzaW9uX2NoZWNrID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIsIHMxLCBzMikge1xuICByZXR1cm4gdGhpcy5tYXAuZ2V0X2Rpc3RhbmNlKHgxLCB5MSwgeDIsIHkyKSA+IHMxICsgczI7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQ29yZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIGNyZWF0ZSBjb3JlIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGNvcmUoY29uZmlnLCBzY2hlbWUsIG1hcCwgZ3Jhdml0eV9tYXApIHtcbiAgLy8gY29uZmlnXG4gIHRoaXMuYyA9IGNvbmZpZztcbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG4gIHRoaXMubWFwID0gbmV3IGNvcmVfbWFwKG1hcCwgc2NoZW1lLCBncmF2aXR5X21hcCk7XG5cbiAgLy8gY3JhdGUgY2hhbmNlIHRhYmxlXG4gIHRoaXMuY3JhdGVfbGlzdCA9IFtdO1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zY2hlbWUud2VhcG9ucykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUud2VhcG9uc1trZXldLmNyYXRlX2NoYW5jZTsgaSsrKSB7XG4gICAgICB0aGlzLmNyYXRlX2xpc3QucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGFybW91cnkgcmVmZXJlbmNlIHRhYmxlXG4gIHRoaXMuYXJtb3VyeV9yZWZzID0gW107XG4gIGZvciAoa2V5IGluIHRoaXMuc2NoZW1lLndlYXBvbnMpIHtcbiAgICB0aGlzLmFybW91cnlfcmVmcy5wdXNoKGtleSk7XG4gIH1cbn1cblxuLyogU2V0IGEgYmxhbmsgc3RhdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ibGFua19zdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4ge1xuICAgIGZyYW1lOiAwLFxuICAgIGV4cGxvc2lvbnM6IHt9LFxuICAgIG9iamVjdHM6IHt9LFxuICAgIHBsYXllcnM6IHt9LFxuICAgIGV2ZW50czogW11cbiAgfTtcbn07XG5cbi8qIFJ1biBldmVyeSBmcmFtZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmZyYW1lID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZnJhbWVfZXhwbG9zaW9ucygpO1xuICB0aGlzLmZyYW1lX3BsYXllcnMoKTtcbiAgdGhpcy5mcmFtZV9vYmplY3RzKCk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgRXZlbnRzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIGEgc3BlY2lmaWMgdHlwZSBvZiBldmVudFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50ID0gZnVuY3Rpb24ob2JqLCB0eXBlLCBjb2xsaWRlZF9vYmopIHtcbiAgdmFyIGV2ZW50ID0gb2JqLmMuZXZlbnRzW3R5cGVdO1xuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIGV2ZW50LCBjb2xsaWRlZF9vYmosIHR5cGUpO1xufTtcblxuLyogUnVuIGEgc3BlY2lmaWMgZXZlbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ydW5fZXZlbnQgPSBmdW5jdGlvbihvYmosIGV2ZW50LCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gaGFuZGxlIGFycmF5cyBvZiBldmVudHNcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgdmFyIHN0b3AgPSBmYWxzZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc3RvcDIgPSB0aGlzLnJ1bl9ldmVudChvYmosIGV2ZW50W2ldLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICAgICAgc3RvcCA9IHN0b3AyID8gdHJ1ZSA6IHN0b3A7XG4gICAgfVxuICAgIHJldHVybiBzdG9wO1xuICB9XG5cbiAgLy8gcnVuIGV2ZW50IGZ1bmN0aW9uXG4gIGlmIChldmVudCA9PT0gXCJkaWVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2RpZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwia2lsbFwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfa2lsbChvYmosIGNvbGxpZGVkX29iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiZXhwbG9kZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfZXhwbG9kZShvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImhpdF9naXZlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9oaXRfZ2l2ZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiaGl0X3JlY2VpdmVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2hpdF9yZWNlaXZlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJkZXN0cm95XCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9kZXN0cm95KG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiY2x1c3RlclwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfY2x1c3RlcihvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImJvdW5jZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfYm91bmNlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJib3VuY2VfZXhwbG9kZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfYm91bmNlX2V4cGxvZGUob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInN0aWNrXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9zdGljayhvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInNsaWRlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9zbGlkZShvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInBsYXllcl9ib3VuY2VcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X3BsYXllcl9ib3VuY2Uob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImRyYWdfcGxheWVyXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9kcmFnX3BsYXllcihvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInNwYXduX2dob3N0XCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9zcGF3bl9naG9zdChvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImNvbGxlY3RcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2NvbGxlY3Qob2JqLCBjb2xsaWRlZF9vYmopO1xuICB9XG59O1xuXG4vKiBPYmplY3QgZGllXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfZGllID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gZGllIGV2ZW50XG4gIHRoaXMuZXZlbnQob2JqLCBcImRpZVwiKTtcblxuICAvLyBjaGVjayBmb3IgZGVzdHJveSBldmVudHNcbiAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5kZXN0cm95KSB7XG4gICAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5kZXN0cm95W29iai5pZF0pIHtcbiAgICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2godGhpcy5zY2hlbWUuZXZlbnRzLmRlc3Ryb3lbb2JqLmlkXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gZGVsZXRlIHRoZSBvYmplY3RcbiAgZGVsZXRlIHRoaXMuc3RhdGUub2JqZWN0c1tvYmoua2V5XTtcblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIE9iamVjdCBraWxsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfa2lsbCA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqKSB7XG4gIC8vIGRlc3Ryb3kgaXRcbiAgdGhpcy5ydW5fZXZlbnQoY29sbGlkZWRfb2JqLCBcImRpZVwiKTtcbn07XG5cbi8qIEV4cGxvZGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9leHBsb2RlID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGNyZWF0ZSBleHBsb3Npb24gb2JqZWN0XG4gIHRoaXMuY3JlYXRlX2V4cGxvc2lvbih7XG4gICAgcGxheWVyX2lkOiBvYmoucGxheWVyX2lkLFxuICAgIHg6IG9iai54LFxuICAgIHk6IG9iai55LFxuICAgIHBhcmVudDogb2JqLmtleSxcbiAgICBwYXJlbnRfdHlwZTogb2JqLnR5cGVcbiAgfSk7XG59O1xuXG4vKiBHaXZlIGEgaGl0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfaGl0X2dpdmUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICByZXR1cm4gdGhpcy5ydW5fZXZlbnQoY29sbGlkZWRfb2JqLCBcImhpdF9yZWNlaXZlXCIsIG9iaiwgdHlwZSk7XG59O1xuXG4vKiBSZWNlaXZlIGEgaGl0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfaGl0X3JlY2VpdmUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBwcmV2ZW50IGluc3RhbnQgaGl0c1xuICBpZiAob2JqLmhpdHMpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqLmhpdHMpIHtcbiAgICAgIGlmIChrZXkgPT09IGNvbGxpZGVkX29iai5rZXkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGNhbGN1bGF0ZSBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGl0IGNhbWUgZnJvbVxuICB2YXIgYW5nbGUgPSB0aGlzLm1hcC5nZXRfaGVhZGluZyhcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICBjb2xsaWRlZF9vYmoueCxcbiAgICBjb2xsaWRlZF9vYmoueVxuICApO1xuICB2YXIgZGlzdGFuY2UgPSB0aGlzLm1hcC5nZXRfZGlzdGFuY2UoXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgY29sbGlkZWRfb2JqLngsXG4gICAgY29sbGlkZWRfb2JqLnlcbiAgKTtcblxuICAvLyBnZXQgZGFtYWdlIHZhbHVlcyBmcm9tIGNvbGxpZGVkIG9iamVjdFxuICB2YXIgZGFtYWdlID0gdGhpcy5nZXRfZGFtYWdlKGNvbGxpZGVkX29iaik7XG4gIHZhciBrbm9jayA9IGNvbGxpZGVkX29iai5jLmtub2NrO1xuICBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZXhwbG9zaW9uXCIpIHtcbiAgICBkYW1hZ2UgKj0gbWF4KDAsIChkYW1hZ2UgKiAyIC0gZGlzdGFuY2UpIC8gKGRhbWFnZSAqIDIpKTtcbiAgfVxuXG4gIC8vIGlnbm9yZSBpZiB0aGVyZSdzIG5vIGRhbWFnZVxuICBpZiAoZGFtYWdlID09PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8ga25vY2sgb2JqZWN0XG4gIGlmIChrbm9jayA+IDApIHtcbiAgICB2YXIgeHkgPSB4eV9zcGVlZChhbmdsZSwgZGFtYWdlKTtcbiAgICBvYmouc3BlZWRfeCAtPSB4eS54LmZpeGVkKCk7XG4gICAgb2JqLnNwZWVkX3kgLT0geHkueS5maXhlZCgpO1xuICAgIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuICB9XG5cbiAgLy8gYXJlIHdlIGhpdHRpbmcgcGxheWVyXG4gIGlmIChvYmoudHlwZSA9PT0gXCJwbGF5ZXJcIikge1xuICAgIHRoaXMucGxheWVyX2hlYWx0aF9hZGQob2JqLnBsYXllcl9pZCwgLXJvdW5kKGRhbWFnZSkpO1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gICAgaWYgKHBsYXllcikge1xuICAgICAgcGxheWVyLmhpdCA9IGRhbWFnZSAqIDI7XG4gICAgfVxuICB9XG5cbiAgLy8gc291bmQgZWZmZWN0XG4gIGlmIChjb2xsaWRlZF9vYmouYy5hdWRpby5oaXQpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwic291bmRcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBzb3VuZDogY29sbGlkZWRfb2JqLmMuYXVkaW8uaGl0XG4gICAgfSk7XG4gIH1cblxuICAvLyBzZXQgaGl0c1xuICBpZiAoIW9iai5oaXRzKSB7XG4gICAgb2JqLmhpdHMgPSB7fTtcbiAgfVxuICBvYmouaGl0c1tjb2xsaWRlZF9vYmoua2V5XSA9IHRydWU7XG59O1xuXG4vKiBEZXN0cm95IGdyb3VuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2Rlc3Ryb3kgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gbGltaXQgdG8gb25jZSBwZXIgZnJhbWVcbiAgaWYgKG9iai5kZXN0cm95ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb2JqLmRlc3Ryb3llZCA9IHRydWU7XG5cbiAgdmFyIGRhbWFnZSA9IHRoaXMuZ2V0X2RhbWFnZShvYmopO1xuXG4gIC8vIHJlY29yZCBncm91bmQgZGFtYWdlXG4gIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgIHR5cGU6IFwiZ3JvdW5kX2RhbWFnZVwiLFxuICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgIGRpZzogdHJ1ZSxcbiAgICB4OiBvYmoueCxcbiAgICB5OiBvYmoueSxcbiAgICByYWRpdXM6IGRhbWFnZVxuICB9KTtcbn07XG5cbi8qIE9iamVjdCBib3VuY2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9ib3VuY2UgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBpZiBncm91bmRlZCBkb250IGRvIGFueXRoaW5nXG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIGNoZWNrIHNwZWVkXG4gIHZhciBzcGVlZCA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICB2YXIgY2hlY2tfc3BlZWQgPSBzcGVlZCAqIG9iai5jLmJvdW5jZTtcbiAgaWYgKGNoZWNrX3NwZWVkIDwgMSkge1xuICAgIG9iai5zcGVlZF94ID0gMDtcbiAgICBvYmouc3BlZWRfeSA9IDA7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBnZXQgbmV3IGRpcmVjdGlvbiBhbmdsZVxuICB2YXIgZGlyZWN0aW9uID0gZ2V0X2FuZ2xlKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gIHZhciBzdXJmYWNlX2FuZ2xlID0gMDtcblxuICAvLyBnZXQgYW5nbGUgZnJvbSBncm91bmRcbiAgaWYgKHR5cGUgPT09IFwiZ3JvdW5kXCIpIHtcbiAgICB2YXIgd2FsayA9IHRoaXMubWFwLndhbGsocm91bmQob2JqLngpLCByb3VuZChvYmoueSksIDAsIDAsIGRpcmVjdGlvbiwgNik7XG4gICAgaWYgKHdhbGsubW92ZSkge1xuICAgICAgc3VyZmFjZV9hbmdsZSA9IHdhbGsuYW5nbGU7XG4gICAgfVxuICB9XG5cbiAgLy8gZ2V0IGFuZ2xlIGZyb20gb2JqZWN0XG4gIGVsc2Uge1xuICAgIHZhciBoZWFkaW5nID0gdGhpcy5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgICBvYmoueCxcbiAgICAgIG9iai55LFxuICAgICAgY29sbGlkZWRfb2JqLngsXG4gICAgICBjb2xsaWRlZF9vYmoueVxuICAgICk7XG4gICAgc3VyZmFjZV9hbmdsZSA9IGFuZ2xlX2FkZChoZWFkaW5nLCA5MCk7XG4gIH1cblxuICAvLyByZWZsZWN0IGRpcmVjdGlvbiBhbmdsZSB3aXRoIGNvbGxpc2lvbiBhbmdsZVxuICB2YXIgcmVmbGVjdGlvbiA9IChkaXJlY3Rpb24gLSBzdXJmYWNlX2FuZ2xlKSAqIDI7XG4gIHZhciBuZXdfYW5nbGUgPSBhbmdsZV9hZGQoZGlyZWN0aW9uLCAtcmVmbGVjdGlvbik7XG5cbiAgLy8gdHJhbnNmb3JtIG1haW4gdmVsb2NpdHkgdG93YXJkcyBuZXcgYW5nbGVcbiAgdmFyIG5ld19zcGVlZCA9IHh5X3NwZWVkKG5ld19hbmdsZSwgY2hlY2tfc3BlZWQpO1xuICBvYmouc3BlZWRfeCA9IG5ld19zcGVlZC54LmZpeGVkKCk7XG4gIG9iai5zcGVlZF95ID0gbmV3X3NwZWVkLnkuZml4ZWQoKTtcblxuICAvLyByZWNvcmQgYm91bmNlIGV2ZW50XG4gIGlmIChzcGVlZCA+IDIpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiYm91bmNlXCIsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgb2JqOiBvYmoua2V5XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIE9iamVjdCBzdGljayB0byBncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9zdGljayA9IGZ1bmN0aW9uKG9iaikge1xuICBvYmouZ3JvdW5kZWQgPSB0cnVlO1xuICBvYmouc3BlZWRfeCA9IDA7XG4gIG9iai5zcGVlZF95ID0gMDtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBPYmplY3Qgc2xpZGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9zbGlkZSA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgYW5nbGUgPSBnZXRfYW5nbGUob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgdmFyIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCBhbmdsZSwgb2JqLnNwZWVkX2xlZnQpO1xuICBpZiAod2Fsay5tb3ZlKSB7XG4gICAgdGhpcy5hY3Rpb25fd2Fsa19tb3ZlKG9iaiwgd2Fsay5wYXRoKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIFBsYXllciBib3VuY2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9wbGF5ZXJfYm91bmNlID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gaWYgZ3JvdW5kZWQgZG9udCBkbyBhbnl0aGluZ1xuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgc3BlZWQgPSBnZXRfc3BlZWQob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcblxuICB2YXIgbWF4X3NwZWVkID0gdGhpcy5zY2hlbWUubGV2ZWxzLmp1bXBbcGxheWVyLmxldmVsXSB8fCAwO1xuICBtYXhfc3BlZWQgKz0gMTA7XG4gIGlmIChwbGF5ZXIuaGl0ID4gMCB8fCBzcGVlZCA+IG1heF9zcGVlZCkge1xuICAgIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIFwiYm91bmNlXCIsIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJzdGlja1wiKTtcbiAgfVxufTtcblxuLyogRHJhZyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9kcmFnX3BsYXllciA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgcGxheWVyX29iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIG9iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcl9vYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBwbGF5ZXJfb2JqLnNwZWVkX3ggPSBvYmouc3BlZWRfeDtcbiAgcGxheWVyX29iai5zcGVlZF95ID0gb2JqLnNwZWVkX3k7XG4gIHBsYXllcl9vYmouZHJhZ2dlZCA9IHRydWU7XG59O1xuXG4vKiBGaXJzdCBEZXN0cm95XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfYm91bmNlX2V4cGxvZGUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICBpZiAob2JqLmZyYW1lICsgMTAgPiB0aGlzLnN0YXRlLmZyYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJib3VuY2VcIiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdGhpcy5ydW5fZXZlbnQob2JqLCBcImV4cGxvZGVcIik7XG4gIH1cbn07XG5cbi8qIFNwYXduIHBsYXllciBnaG9zdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X3NwYXduX2dob3N0ID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIHRyYW5zZm9ybSBvYmplY3QgaW50byBnaG9zdFxuICBvYmoudHlwZSA9IFwicGxheWVyX2dob3N0XCI7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbXCJwbGF5ZXJfZ2hvc3RcIl07XG4gIG9iai5zcGVlZF94ID0gMDtcbiAgb2JqLnNwZWVkX3kgPSAwO1xufTtcblxuLyogQ2x1c3RlcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9jbHVzdGVyID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIHNldCBvZmYgZXhwbG9zaW9uc1xuICB0aGlzLnJ1bl9ldmVudChvYmosIFwiZXhwbG9kZVwiKTtcblxuICAvLyBnZXQgY2x1c3RlciBjb25zdGFudHNcbiAgdmFyIGNsdXN0ZXIgPSBvYmouYy5jbHVzdGVyO1xuXG4gIC8vIGdldCBvcHBvc2l0ZSBhbmdsZSBvZiBncmF2aXR5XG4gIHZhciBhbmdsZSA9IHRoaXMubWFwLmdldF9ncmF2aXR5X2FuZ2xlKG9iai54LCBvYmoueSk7XG4gIGFuZ2xlID0gYW5nbGVfYWRkKGFuZ2xlLCAxMzUpO1xuXG4gIC8vIGdvIHRocm91Z2ggY2x1c3RlcnNcbiAgdmFyIHJhbmdlID0gY2x1c3Rlci5jaXJjbGUgPyAzNjAgLSAzNjAgLyBjbHVzdGVyLmNvdW50IDogOTA7XG4gIHZhciBhbmdsZV9kaWZmID0gcmFuZ2UgLyAoY2x1c3Rlci5jb3VudCAtIDEpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNsdXN0ZXIuY291bnQ7IGkrKykge1xuICAgIC8vIGNyZWF0ZSBjbHVzdGVyIG9iamVjdHNcbiAgICB2YXIgbGF1bmNoX2FuZ2xlID0gYW5nbGVfYWRkKGFuZ2xlLCBpICogYW5nbGVfZGlmZik7XG4gICAgdmFyIHNwZWVkID0geHlfc3BlZWQobGF1bmNoX2FuZ2xlLCBjbHVzdGVyLnNwZWVkKTtcblxuICAgIC8vIGNyZWF0ZSBjbHVzdGVyIG9iamVjdFxuICAgIHRoaXMuY3JlYXRlX29iamVjdCh7XG4gICAgICB0eXBlOiBjbHVzdGVyLm9iamVjdCxcbiAgICAgIGlkOiBvYmouaWQsXG4gICAgICBkYXRhOiBpICsgMSxcbiAgICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBzcGVlZF94OiBzcGVlZC54LmZpeGVkKCksXG4gICAgICBzcGVlZF95OiBzcGVlZC55LmZpeGVkKClcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogQ29sbGVjdCBDcmF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2NvbGxlY3QgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaikge1xuICAvLyBwcmVwIGV2ZW50IHRvIHNlbmQgdG8gZ2FtZVxuICB2YXIgZXZlbnQgPSB7XG4gICAgdHlwZTogXCJjb2xsZWN0XCIsXG4gICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5LFxuICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZFxuICB9O1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNyYXRlXG4gIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJjcmF0ZVwiKSB7XG4gICAgdmFyIGNvdW50ID0gdGhpcy5zY2hlbWUud2VhcG9uc1tjb2xsaWRlZF9vYmouZGF0YV0uY3JhdGVfY291bnQ7XG4gICAgY291bnQgPSBjb3VudCA9PT0gLTEgPyBcImluZmluaXRlXCIgOiBjb3VudDtcbiAgICB0aGlzLnVwZGF0ZV9wbGF5ZXJfYXJtb3VyeShvYmoucGxheWVyX2lkLCBjb2xsaWRlZF9vYmouZGF0YSwgY291bnQpO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiY3JhdGVcIjtcbiAgICBldmVudC53ZWFwb24gPSBjb2xsaWRlZF9vYmouZGF0YTtcbiAgICBldmVudC5jb3VudCA9IGNvdW50O1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiY3JhdGVcIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9XG5cbiAgLy8gbWVkcGFja1xuICBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJtZWRwYWNrXCIpIHtcbiAgICB0aGlzLnBsYXllcl9oZWFsdGhfYWRkKG9iai5wbGF5ZXJfaWQsIHRoaXMuc2NoZW1lLmRyb3BzLm1lZHBhY2suYWRkKTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcIm1lZHBhY2tcIjtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcIm1lZHBhY2tcIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9XG5cbiAgLy8gZ2Vtc1xuICBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tMVwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfc2NvcmVfYWRkKG9iai5wbGF5ZXJfaWQsIDEpO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDE7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS01XCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgNSk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gNTtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZ2VtLTIwXCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgMjApO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDIwO1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiZ2VtXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tNTBcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCA1MCk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gNTA7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS0yMDBcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCAyMDApO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDIwMDtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH1cblxuICAvLyByZWNvcmQgZXZlbnRcbiAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaChldmVudCk7XG5cbiAgLy8ga2lsbCBvYmplY3RcbiAgdGhpcy5ydW5fZXZlbnQoY29sbGlkZWRfb2JqLCBcImRpZVwiLCBvYmosIFwiY29sbGVjdFwiKTtcblxuICAvLyBjaGVjayBmb3IgY29sbGVjdGlvbiBldmVudHNcbiAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5jb2xsZWN0KSB7XG4gICAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5jb2xsZWN0W2NvbGxpZGVkX29iai5pZF0pIHtcbiAgICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2godGhpcy5zY2hlbWUuZXZlbnRzLmNvbGxlY3RbY29sbGlkZWRfb2JqLmlkXSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEV4cGxvc2lvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDcmVhdGUgYW4gZXhwbG9zaW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY3JlYXRlX2V4cGxvc2lvbiA9IGZ1bmN0aW9uKHByb3BzLCBzdGF0ZSkge1xuICB2YXIgc3RhdGVfcmVmID0gc3RhdGUgfHwgdGhpcy5zdGF0ZTtcblxuICB2YXIgb2JqID0ge1xuICAgIHR5cGU6IFwiZXhwbG9zaW9uXCIsXG4gICAgcGxheWVyX2lkOiBcIlwiLFxuICAgIGZyYW1lOiBzdGF0ZV9yZWYuZnJhbWUsXG4gICAgeDogMCxcbiAgICB5OiAwLFxuICAgIHBhcmVudDogXCJcIixcbiAgICBwYXJlbnRfdHlwZTogXCJcIlxuICB9O1xuICBvYmogPSBkZWVwbWVyZ2Uob2JqLCBwcm9wcyk7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbb2JqLnBhcmVudF90eXBlXTtcblxuICAvLyBhZGQgdG8gc3RhdGUgb2JqZWN0c1xuICBzdGF0ZV9yZWYuZXhwbG9zaW9uc1tvYmoucGFyZW50XSA9IG9iajtcbn07XG5cbi8qIENoZWNrIGFsbCBleGlzdGluZyBleHBsb3Npb25zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZnJhbWVfZXhwbG9zaW9ucyA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIGFsbCBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLmV4cGxvc2lvbnMpIHtcbiAgICB2YXIgZXhwbG9kZSA9IHRoaXMuc3RhdGUuZXhwbG9zaW9uc1trZXldO1xuXG4gICAgLy8gaWYgZXhwaXJlZCByZW1vdmVcbiAgICBpZiAodGhpcy5zdGF0ZS5mcmFtZSA+IGV4cGxvZGUuZnJhbWUgKyA0MCkge1xuICAgICAgZGVsZXRlIHRoaXMuc3RhdGUuZXhwbG9zaW9uc1trZXldO1xuICAgIH1cblxuICAgIC8vIGlmIGV4cGxvZGluZyB0aGlzIGZyYW1lIHJ1blxuICAgIGlmICh0aGlzLnN0YXRlLmZyYW1lID09PSBleHBsb2RlLmZyYW1lICsgMSkge1xuICAgICAgdGhpcy5ydW5fZXhwbG9zaW9uKGV4cGxvZGUpO1xuICAgIH1cbiAgfVxufTtcblxuLyogUnVuIGFuIGV4cGxvc2lvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnJ1bl9leHBsb3Npb24gPSBmdW5jdGlvbihleHBsb2RlKSB7XG4gIC8vIGlmIG5vIGRhbWFnZVxuICBpZiAoIWV4cGxvZGUuYy5kYW1hZ2UpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgYWRkaXRpb25hbCBwbGF5ZXIgZGFtYWdlXG4gIHZhciBkYW1hZ2UgPSB0aGlzLmdldF9kYW1hZ2UoZXhwbG9kZSk7XG5cbiAgLy8gY2hlY2sgY29sbGlzaW9uc1xuICBmb3IgKGtleSBpbiB0aGlzLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW2tleV07XG5cbiAgICAvLyBpZiBvYmplY3Qgd2FzIGp1c3QgbWFkZVxuICAgIGlmICh0aGlzLnN0YXRlLmZyYW1lIDwgb2JqLmZyYW1lICsgMikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gcnVuIGNvbGxpc2lvbiBjaGVja1xuICAgIGlmIChcbiAgICAgICF0aGlzLmNvbGxpc2lvbl9jaGVjayhcbiAgICAgICAgb2JqLngsXG4gICAgICAgIG9iai55LFxuICAgICAgICBleHBsb2RlLngsXG4gICAgICAgIGV4cGxvZGUueSxcbiAgICAgICAgb2JqLmMuc2l6ZSxcbiAgICAgICAgZGFtYWdlICogMlxuICAgICAgKVxuICAgICkge1xuICAgICAgdGhpcy5ldmVudChvYmosIFwiZXhwbG9zaW9uXCIsIGV4cGxvZGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJlY29yZCBncm91bmQgZGFtYWdlXG4gIHZhciBwdHlwZSA9IHRoaXMuYy5vYmplY3RzW2V4cGxvZGUucGFyZW50X3R5cGVdO1xuICBpZiAocHR5cGUgJiYgcHR5cGUuZGVzdHJveV9ncm91bmQpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiZ3JvdW5kX2RhbWFnZVwiLFxuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB4OiBleHBsb2RlLngsXG4gICAgICB5OiBleHBsb2RlLnksXG4gICAgICByYWRpdXM6IGRhbWFnZVxuICAgIH0pO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgT2JqZWN0c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBhIG5ldyBnYW1lIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNyZWF0ZV9vYmplY3QgPSBmdW5jdGlvbihwcm9wcywgc3RhdGUpIHtcbiAgdmFyIHN0YXRlX3JlZiA9IHN0YXRlIHx8IHRoaXMuc3RhdGU7XG5cbiAgdmFyIG9iaiA9IHtcbiAgICB0eXBlOiBcIlwiLFxuICAgIHBsYXllcl9pZDogXCJcIixcbiAgICBpZDogXCJcIixcbiAgICBmcmFtZTogc3RhdGVfcmVmLmZyYW1lLFxuICAgIGdyb3VuZGVkOiBmYWxzZSxcbiAgICB4OiAwLFxuICAgIHk6IDAsXG4gICAgc3BlZWRfeDogMCxcbiAgICBzcGVlZF95OiAwLFxuICAgIGRhdGE6IFwiXCJcbiAgfTtcbiAgb2JqID0gZGVlcG1lcmdlKG9iaiwgcHJvcHMpO1xuICBvYmouYyA9IHRoaXMuYy5vYmplY3RzW29iai50eXBlXTtcbiAgdmFyIGtleV90eXBlID0gb2JqLnR5cGU7XG5cbiAgLy8gc2V0IGtleVxuICBpZiAoXG4gICAgb2JqLnR5cGUgPT09IFwicGxheWVyXCIgfHxcbiAgICBvYmoudHlwZSA9PT0gXCJwbGF5ZXJfZ2hvc3RcIiB8fFxuICAgIG9iai50eXBlID09PSBcInBsYXllcl9taXNzaWxlXCJcbiAgKSB7XG4gICAgb2JqLmtleSA9IFwicGxheWVyLVwiICsgb2JqLnBsYXllcl9pZDtcbiAgfSBlbHNlIHtcbiAgICBvYmoua2V5ID1cbiAgICAgIG9iai50eXBlICtcbiAgICAgIFwiLVwiICtcbiAgICAgIG9iai5wbGF5ZXJfaWQgK1xuICAgICAgXCItXCIgK1xuICAgICAgb2JqLmlkICtcbiAgICAgIFwiLVwiICtcbiAgICAgIG9iai5mcmFtZSArXG4gICAgICBcIi1cIiArXG4gICAgICBvYmouZGF0YTtcbiAgfVxuXG4gIC8vIGFkZCB0byBzdGF0ZSBvYmplY3RzXG4gIHN0YXRlX3JlZi5vYmplY3RzW29iai5rZXldID0gb2JqO1xuXG4gIC8vIHJldHVybiBpdFxuICByZXR1cm4gb2JqO1xufTtcblxuLyogU25hcCBvYmplY3QgdG8gYW5vdGhlciBvYmplY3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5zbmFwX29iamVjdCA9IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgb2JqMS5ncm91bmRlZCA9IG9iajIuZ3JvdW5kZWQ7XG4gIG9iajEueCA9IG9iajIueDtcbiAgb2JqMS55ID0gb2JqMi55O1xuICBvYmoxLnNwZWVkX3ggPSBvYmoyLnNwZWVkX3g7XG4gIG9iajEuc3BlZWRfeSA9IG9iajIuc3BlZWRfeTtcbn07XG5cbi8qIFJ1biB0aHJvdWdoIG9iamVjdCBmcmFtZSBldmVudHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9vYmplY3RzID0gZnVuY3Rpb24oKSB7XG4gIC8vIHJ1biB0aHJvdWdoIGFsbCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLm9iamVjdHMpIHtcbiAgICB0aGlzLmZyYW1lX29iamVjdCh0aGlzLnN0YXRlLm9iamVjdHNba2V5XSk7XG4gIH1cblxuICAvLyBjaGVjayBmb3IgcGxheWVyIGxvY2tcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUucGxheWVycykge1xuICAgIHRoaXMuZnJhbWVfcGxheWVyX2xvY2sodGhpcy5zdGF0ZS5wbGF5ZXJzW2tleV0pO1xuICB9XG59O1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb2JqLmRlc3Ryb3llZCA9IGZhbHNlO1xuXG4gIC8vIHN0b3BwaW5nXG4gIGlmIChvYmouYy5zdG9wID4gMCAmJiB0aGlzLnN0YXRlLmZyYW1lID4gb2JqLmZyYW1lICsgb2JqLmMuc3RvcCkge1xuICAgIG9iai5zcGVlZF94ID0gMDtcbiAgICBvYmouc3BlZWRfeSA9IDA7XG4gIH1cblxuICAvLyB0aW1lb3V0XG4gIGlmIChvYmouYy50aW1lb3V0ID4gMCAmJiBvYmouZnJhbWUgKyBvYmouYy50aW1lb3V0IDw9IHRoaXMuc3RhdGUuZnJhbWUpIHtcbiAgICB0aGlzLnJ1bl9ldmVudChvYmosIFwiZGllXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJ1biBwaHlzaWNzIG9uIG9iamVjdFxuICB0aGlzLnBoeXNpY3Mob2JqKTtcblxuICAvLyBldmVudHNcbiAgdGhpcy5ldmVudChvYmosIFwiZnJhbWVcIik7XG59O1xuXG4vKiBTcGF3bnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5zcGF3biA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gIC8vIHdlYXBvbiBjcmF0ZSBjb250ZW50c1xuICBpZiAocHJvcHMudHlwZSA9PSBcImNyYXRlXCIpIHtcbiAgICBpZiAodGhpcy5jcmF0ZV9saXN0Lmxlbmd0aCA8IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcHJvcHMuZGF0YSA9IHRoaXMuY3JhdGVfbGlzdFtyYW5kKDAsIHRoaXMuY3JhdGVfbGlzdC5sZW5ndGgpXTtcbiAgfVxuXG4gIC8vIGRvIHdlIGhhdmUgYSBzZXQgcG9zaXRpb25cbiAgaWYgKCFwcm9wcy54ICYmICFwcm9wcy55KSB7XG4gICAgdmFyIHBvcyA9IHRoaXMubWFwLmFpcl9maW5kX3Nwb3QoKTtcbiAgICBwcm9wcy54ID0gcG9zLng7XG4gICAgcHJvcHMueSA9IHBvcy55O1xuICB9XG5cbiAgcmV0dXJuIHRoaXMuY3JlYXRlX29iamVjdChwcm9wcyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgUGh5c2ljc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBhaXIgcGh5c2ljc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3MgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gYXJlIHdlIHN0aWxsIGdyb3VuZGVkXG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICBpZiAoIXRoaXMubWFwLmdyb3VuZF9waXhlbChyb3VuZChvYmoueCksIHJvdW5kKG9iai55KSkpIHtcbiAgICAgIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJ1biB0aGUgbWFpbiBwaHlzaWNzXG4gIGlmICghb2JqLmdyb3VuZGVkKSB7XG4gICAgdGhpcy5waHlzaWNzX2dyYXZpdHkob2JqKTtcbiAgICB0aGlzLnBoeXNpY3NfbW92ZShvYmopO1xuICB9XG59O1xuXG4vKiBDYWxjdWxhdGUgZ3Jhdml0eVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3NfZ3Jhdml0eSA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBpZiBubyB3ZWlnaHRcbiAgaWYgKG9iai5jLndlaWdodCA8PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IGdyYXZpdHkgdmFsdWVzXG4gIHZhciBncmF2aXR5ID0gdGhpcy5tYXAuZ2V0X2dyYXZpdHkocm91bmQob2JqLngpLCByb3VuZChvYmoueSkpO1xuXG4gIC8vIGFkanVzdCBzcGVlZFxuICB0aGlzLnBoeXNpY3NfYWRqdXN0X3NwZWVkKFxuICAgIG9iaixcbiAgICBncmF2aXR5LngsXG4gICAgZ3Jhdml0eS55LFxuICAgIG9iai5jLnNwZWVkLm1heF9ncmF2aXR5LFxuICAgIG9iai5jLndlaWdodFxuICApO1xufTtcblxuLyogQWRqdXN0IHNwZWVkIG9mIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3NfYWRqdXN0X3NwZWVkID0gZnVuY3Rpb24oXG4gIG9iaixcbiAgbmV3X3NwZWVkX3gsXG4gIG5ld19zcGVlZF95LFxuICBtYXhfc3BlZWQsXG4gIHdlaWdodFxuKSB7XG4gIHZhciBhbmdsZSA9IGdldF9hbmdsZShuZXdfc3BlZWRfeCwgbmV3X3NwZWVkX3kpO1xuICB2YXIgbWF4X3NwZWVkID0geHlfc3BlZWQoYW5nbGUsIG1heF9zcGVlZCk7XG4gIHZhciBzcGVlZF9hZGRfeCA9IG5ld19zcGVlZF94ICogd2VpZ2h0O1xuICB2YXIgc3BlZWRfYWRkX3kgPSBuZXdfc3BlZWRfeSAqIHdlaWdodDtcbiAgdmFyIGRpZmZfeCA9IG1heF9zcGVlZC54IC0gb2JqLnNwZWVkX3g7XG4gIHZhciBkaWZmX3kgPSBtYXhfc3BlZWQueSAtIG9iai5zcGVlZF95O1xuXG4gIC8vIG9ubHkgYWRkIHNwZWVkIHVwIHRvIHRoZSBsaW1pdCB3aXRob3V0IGJyaW5naW5nIGl0IGRvd25cbiAgaWYgKG1heF9zcGVlZC54IDwgMCkge1xuICAgIG9iai5zcGVlZF94ICs9IG1heChzcGVlZF9hZGRfeCwgbWluKDAsIGRpZmZfeCkpO1xuICB9IGVsc2Uge1xuICAgIG9iai5zcGVlZF94ICs9IG1pbihzcGVlZF9hZGRfeCwgbWF4KDAsIGRpZmZfeCkpO1xuICB9XG4gIGlmIChtYXhfc3BlZWQueSA8IDApIHtcbiAgICBvYmouc3BlZWRfeSArPSBtYXgoc3BlZWRfYWRkX3ksIG1pbigwLCBkaWZmX3kpKTtcbiAgfSBlbHNlIHtcbiAgICBvYmouc3BlZWRfeSArPSBtaW4oc3BlZWRfYWRkX3ksIG1heCgwLCBkaWZmX3kpKTtcbiAgfVxuXG4gIG9iai5zcGVlZF94ID0gb2JqLnNwZWVkX3guZml4ZWQoKTtcbiAgb2JqLnNwZWVkX3kgPSBvYmouc3BlZWRfeS5maXhlZCgpO1xufTtcblxuLyogRG8gdGhlIG1vdmVtZW50XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGh5c2ljc19tb3ZlID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGNoZWNrIHNwZWVkXG4gIHZhciBzcGVlZF9saW1pdCA9IGNoZWNrX3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSwgb2JqLmMuc3BlZWQubWF4KTtcbiAgb2JqLnNwZWVkX3ggPSBzcGVlZF9saW1pdC54LmZpeGVkKCk7XG4gIG9iai5zcGVlZF95ID0gc3BlZWRfbGltaXQueS5maXhlZCgpO1xuXG4gIC8vIHBsb3QgYSBjb3Vyc2VcbiAgdmFyIGNvdXJzZSA9IHBsb3RfY291cnNlKG9iai54LCBvYmoueSwgb2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcblxuICAvLyBpZiBubyBjb3Vyc2VcbiAgaWYgKCFjb3Vyc2UubW92ZSkge1xuICAgIHRoaXMuY29sbGlzaW9ucyhvYmosIG9iai54LCBvYmoueSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gbW92ZSB0aHJvdWdoIGNvdXJzZVxuICB2YXIgbW92ZWQgPSBmYWxzZTtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBjb3Vyc2UucG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgLy8gcmVtYWluaW5nIG1vdmVtZW50IHBvaW50cyBsZWZ0XG4gICAgb2JqLnNwZWVkX2xlZnQgPSBjb3Vyc2UucG9pbnRzLmxlbmd0aCAtIGk7XG5cbiAgICB2YXIgcG9pbnQgPSBjb3Vyc2UucG9pbnRzW2ldO1xuICAgIHZhciBueCA9IHRoaXMubWFwLmxvb3BfeChyb3VuZChwb2ludC54KSk7XG4gICAgdmFyIG55ID0gdGhpcy5tYXAubG9vcF95KHJvdW5kKHBvaW50LnkpKTtcblxuICAgIC8vIGNvbGxpc2lvbnNcbiAgICB2YXIgY29sbGlzaW9uID0gdGhpcy5jb2xsaXNpb25zKG9iaiwgbngsIG55KTtcbiAgICBpZiAoY29sbGlzaW9uKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBtb3ZlIG9iamVjdFxuICAgIG9iai54ID0gbng7XG4gICAgb2JqLnkgPSBueTtcbiAgICBtb3ZlZCA9IHRydWU7XG4gIH1cblxuICByZXR1cm4gbW92ZWQ7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgUGxheWVyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBhIG5ldyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jcmVhdGVfcGxheWVyID0gZnVuY3Rpb24ocHJvcHMsIHN0YXRlKSB7XG4gIGlmICh0eXBlb2YgcHJvcHMuaWQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc3RhdGVfcmVmID0gc3RhdGUgfHwgdGhpcy5zdGF0ZTtcblxuICAvLyBzZXQgdXAgb2JqZWN0XG4gIHZhciBvYmogPSB7XG4gICAgaWQ6IFwiXCIsXG4gICAgbGV2ZWw6IDAsXG4gICAgc2NvcmU6IDAsXG4gICAgZGVhZDogZmFsc2UsXG4gICAgaGVhbHRoOiB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoWzBdLFxuICAgIGNvb2xkb3duOiAwLFxuICAgIGhpdDogMCxcbiAgICB3ZWFwb246IFwiXCIsXG4gICAgbG9ja2VkOiBcIlwiLFxuICAgIGV2ZW50czogW10sXG4gICAgYXJtb3VyeToge31cbiAgfTtcbiAgb2JqID0gZGVlcG1lcmdlKG9iaiwgcHJvcHMpO1xuICBvYmouaWQgPSBwYXJzZUludChvYmouaWQpO1xuXG4gIC8vIHNldCBsZXZlbFxuICB0aGlzLnBsYXllcl9sZXZlbChvYmouaWQpO1xuXG4gIC8vIGFkZCB0byBzdGF0ZSBvYmplY3RzXG4gIHN0YXRlX3JlZi5wbGF5ZXJzW29iai5pZF0gPSBvYmo7XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cbi8qIFJlbW92ZSBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5yZW1vdmVfcGxheWVyID0gZnVuY3Rpb24ocGxheWVyX2lkKSB7XG4gIGlmICghdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBkZWxldGUgdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyX2lkXTtcbiAgZGVsZXRlIHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xufTtcblxuLyogU3RhcnQgdGhlIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmluaXRfcGxheWVyID0gZnVuY3Rpb24ocGxheWVyX2lkLCBzdGF0ZSkge1xuICBwbGF5ZXJfaWQgPSBwYXJzZUludChwbGF5ZXJfaWQpO1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcGxheWVyIHZhbHVlc1xuICBwbGF5ZXIubGV2ZWwgPSAwO1xuICBwbGF5ZXIuc2NvcmUgPSAwO1xuICBwbGF5ZXIuZGVhZCA9IGZhbHNlO1xuICBwbGF5ZXIuaGVhbHRoID0gdGhpcy5zY2hlbWUubGV2ZWxzLmhlYWx0aFswXTtcbiAgcGxheWVyLmNvb2xkb3duID0gMDtcbiAgcGxheWVyLmV2ZW50cyA9IFtdO1xuXG4gIC8vIGFybW91cnlcbiAgdmFyIGFybW91cnkgPSB7fTtcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc2NoZW1lLndlYXBvbnMpIHtcbiAgICBhcm1vdXJ5W2tleV0gPSB0aGlzLnNjaGVtZS53ZWFwb25zW2tleV0uc3RhcnRfY291bnQ7XG4gIH1cbiAgcGxheWVyLmFybW91cnkgPSBhcm1vdXJ5O1xuXG4gIC8vIG1lcmdlIHdpdGggYW4gZXh0ZXJuYWwgc3RhdGVcbiAgaWYgKHN0YXRlKSB7XG4gICAgdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF0gPSBkZWVwbWVyZ2UocGxheWVyLCBzdGF0ZSk7XG4gIH1cblxuICAvLyBzZXQgbGV2ZWxcbiAgdGhpcy5wbGF5ZXJfbGV2ZWwocGxheWVyX2lkKTtcblxuICAvLyBvYmplY3QgdmFsdWVzXG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAodGhpcy5zY2hlbWUuc3Bhd24ubGVuZ3RoID4gMCkge1xuICAgIHZhciBwb3MgPSB0aGlzLnNjaGVtZS5zcGF3bltyYW5kKDAsIHRoaXMuc2NoZW1lLnNwYXduLmxlbmd0aCldO1xuICB9IGVsc2Uge1xuICAgIHZhciBwb3MgPSB0aGlzLm1hcC5haXJfZmluZF9zcG90KCk7XG4gIH1cbiAgb2JqLnR5cGUgPSBcInBsYXllclwiO1xuICBvYmouZ3JvdW5kZWQgPSBmYWxzZTtcbiAgb2JqLnggPSBwb3MueDtcbiAgb2JqLnkgPSBwb3MueTtcbiAgb2JqLnNwZWVkX3ggPSAwO1xuICBvYmouc3BlZWRfeSA9IDA7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbXCJwbGF5ZXJcIl07XG59O1xuXG4vKiBVcGRhdGUgYXJtb3VyeVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnVwZGF0ZV9wbGF5ZXJfYXJtb3VyeSA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgd2VhcG9uLCBjb3VudCkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaWYgaW5maW5pdGUgb3IgaWYgemVybyBhbmQgdGFraW5nIGF3YXlcbiAgdmFyIG9sZF9jb3VudCA9IHBsYXllci5hcm1vdXJ5W3dlYXBvbl07XG4gIGlmICghaXNfbnVtZXJpYyhvbGRfY291bnQpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChvbGRfY291bnQgPT09IC0xKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKG9sZF9jb3VudCA9PT0gMCAmJiBjb3VudCA8IDEpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBpZiBpbmZpbml0ZVxuICBpZiAoY291bnQgPT09IFwiaW5maW5pdGVcIikge1xuICAgIHBsYXllci5hcm1vdXJ5W3dlYXBvbl0gPSAtMTtcbiAgfSBlbHNlIHtcbiAgICBwbGF5ZXIuYXJtb3VyeVt3ZWFwb25dICs9IGNvdW50O1xuICB9XG5cbiAgLy8gcmVjb3JkIGV2ZW50XG4gIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgIHR5cGU6IFwiYXJtb3VyeVwiLFxuICAgIHBsYXllcl9pZDogcGxheWVyX2lkLFxuICAgIHdlYXBvbjogd2VhcG9uXG4gIH0pO1xuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogQWRkIGhlYWx0aCB0byBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfaGVhbHRoX2FkZCA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgaGVhbHRoLCBub19tZXNzYWdlKSB7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIgfHwgcGxheWVyLmRlYWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBubyBoZWFsdGggZW5hYmxlZFxuICBpZiAoIXRoaXMuc2NoZW1lLmhlYWx0aCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGFkZCBpdFxuICBwbGF5ZXIuaGVhbHRoICs9IGhlYWx0aDtcbiAgcGxheWVyLmhlYWx0aCA9IG1pbihwbGF5ZXIuaGVhbHRoLCB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoW3BsYXllci5sZXZlbF0pO1xuXG4gIC8vIGFyZSB3ZSBkZWFkXG4gIGlmIChwbGF5ZXIuaGVhbHRoIDw9IDApIHtcbiAgICB0aGlzLnBsYXllcl9kaWUocGxheWVyX2lkKTtcbiAgfVxuXG4gIC8vIHNldCBldmVudFxuICBpZiAoIW5vX21lc3NhZ2UpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwicGxheWVyX2hlYWx0aFwiLFxuICAgICAgaWQ6IHBsYXllcl9pZCxcbiAgICAgIGhlYWx0aDogaGVhbHRoXG4gICAgfSk7XG4gIH1cbn07XG5cbi8qIEFkZCBzY29yZSB0byBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfc2NvcmVfYWRkID0gZnVuY3Rpb24ocGxheWVyX2lkLCBzY29yZSkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8IHBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYWRkIGl0XG4gIHBsYXllci5zY29yZSArPSBzY29yZTtcblxuICAvLyBzZXQgbGV2ZWxcbiAgdGhpcy5wbGF5ZXJfbGV2ZWwocGxheWVyX2lkKTtcblxuICAvLyBzZXQgZXZlbnRcbiAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgdHlwZTogXCJwbGF5ZXJfc2NvcmVcIixcbiAgICBpZDogcGxheWVyX2lkLFxuICAgIHNjb3JlOiBzY29yZVxuICB9KTtcbn07XG5cbi8qIFNldCBwbGF5ZXIgbGV2ZWxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfbGV2ZWwgPSBmdW5jdGlvbihwbGF5ZXJfaWQpIHtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCBwbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggbGV2ZWxzXG4gIHZhciBsZXZlbCA9IDA7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHRoaXMuc2NoZW1lLmxldmVscy5zY29yZVtpXSA8PSBwbGF5ZXIuc2NvcmUpIHtcbiAgICAgIGxldmVsID0gaTtcbiAgICB9XG4gIH1cbiAgcGxheWVyLmxldmVsID0gbGV2ZWw7XG59O1xuXG4vKiBQbGF5ZXIgZGllXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGxheWVyX2RpZSA9IGZ1bmN0aW9uKHBsYXllcl9pZCkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8IHBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcGxheWVyLmRlYWQgPSB0cnVlO1xuXG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBvYmoudHlwZSA9IFwicGxheWVyX21pc3NpbGVcIjtcbiAgb2JqLmMgPSB0aGlzLmMub2JqZWN0c1tcInBsYXllcl9taXNzaWxlXCJdO1xuXG4gIC8vIGZpZ3VyZSBvdXQgZ2VtcyB0byBzcGF3blxuICB2YXIgbiA9IG1heChyb3VuZChwbGF5ZXIuc2NvcmUgLyAyKSwgMyk7XG4gIHZhciBnZW1zID0gW107XG4gIHdoaWxlIChuID4gMjAwKSB7XG4gICAgZ2Vtcy5wdXNoKDIwMCk7XG4gICAgbiAtPSAyMDA7XG4gIH1cbiAgd2hpbGUgKG4gPiA1MCkge1xuICAgIGdlbXMucHVzaCg1MCk7XG4gICAgbiAtPSA1MDtcbiAgfVxuICB3aGlsZSAobiA+IDIwKSB7XG4gICAgZ2Vtcy5wdXNoKDIwKTtcbiAgICBuIC09IDIwO1xuICB9XG4gIHdoaWxlIChuID4gNSkge1xuICAgIGdlbXMucHVzaCg1KTtcbiAgICBuIC09IDU7XG4gIH1cbiAgd2hpbGUgKG4gPiAxKSB7XG4gICAgZ2Vtcy5wdXNoKDEpO1xuICAgIG4gLT0gMTtcbiAgfVxuXG4gIC8vIHNwYXduIHRoZW1cbiAgdmFyIGFuZ2xlX2luYyA9IHJvdW5kKDM2MCAvIGdlbXMubGVuZ3RoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIG4gPSAoKGkgJSAzKSArIDEpICogMjtcbiAgICB2YXIgeHkgPSB4eV9zcGVlZChhbmdsZV9pbmMgKiBpLCBuKTtcbiAgICB0aGlzLmNyZWF0ZV9vYmplY3Qoe1xuICAgICAgdHlwZTogXCJnZW0tXCIgKyBnZW1zW2ldLFxuICAgICAgcGxheWVyX2lkOiBvYmoucGxheWVyX2lkLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNwZWVkX3g6IHh5LnguZml4ZWQoKSxcbiAgICAgIHNwZWVkX3k6IHh5LnkuZml4ZWQoKSxcbiAgICAgIGRhdGE6IGkgKyAxXG4gICAgfSk7XG4gIH1cbn07XG5cbi8qIFJ1biB0aHJvdWdoIHBsYXllcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9wbGF5ZXJzID0gZnVuY3Rpb24oaWdub3JlKSB7XG4gIC8vIHJ1biB0aHJvdWdoIGFsbCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLnBsYXllcnMpIHtcbiAgICBpZiAocGFyc2VJbnQoa2V5KSAhPT0gaWdub3JlKSB7XG4gICAgICB0aGlzLmZyYW1lX3BsYXllcih0aGlzLnN0YXRlLnBsYXllcnNba2V5XSk7XG4gICAgfVxuICB9XG59O1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9wbGF5ZXIgPSBmdW5jdGlvbihwbGF5ZXIpIHtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb29sZG93blxuICBpZiAocGxheWVyLmNvb2xkb3duID4gMCkge1xuICAgIHBsYXllci5jb29sZG93bi0tO1xuICB9XG5cbiAgLy8gaGl0XG4gIGlmIChwbGF5ZXIuaGl0ID4gMCkge1xuICAgIHBsYXllci5oaXQtLTtcbiAgfVxuXG4gIC8vIGhlYWx0aCByZWdlblxuICBpZiAodGhpcy5zdGF0ZS5mcmFtZSAlIDI0ID09PSAwKSB7XG4gICAgaWYgKHBsYXllci5oZWFsdGggPCB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoW3BsYXllci5sZXZlbF0pIHtcbiAgICAgIHRoaXMucGxheWVyX2hlYWx0aF9hZGQocGxheWVyLmlkLCAyLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvLyByZW1vdmUgb2xkIGV2ZW50c1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsYXllci5ldmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGhpcy5zdGF0ZS5mcmFtZSA+IHBsYXllci5ldmVudHNbaV0uZnJhbWUgKyAxOCkge1xuICAgICAgcGxheWVyLmV2ZW50cy5zcGxpY2UoaSwgMSk7XG4gICAgfVxuICB9XG59O1xuXG4vKiBSdW4gdGhyb3VnaCBwbGF5ZXIgbG9ja2VkIG9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9wbGF5ZXJfbG9jayA9IGZ1bmN0aW9uKHBsYXllcikge1xuICB2YXIgcGxheWVyX29iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllci5pZF07XG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbcGxheWVyLmxvY2tlZF07XG4gIGlmIChwbGF5ZXJfb2JqICYmIG9iaikge1xuICAgIHBsYXllcl9vYmoueCA9IG9iai54O1xuICAgIHBsYXllcl9vYmoueSA9IG9iai55O1xuICAgIHBsYXllcl9vYmouc3BlZWRfeCA9IG9iai5zcGVlZF94O1xuICAgIHBsYXllcl9vYmouc3BlZWRfeSA9IG9iai5zcGVlZF95O1xuICB9IGVsc2Uge1xuICAgIHBsYXllci5sb2NrZWQgPSBcIlwiO1xuICB9XG59O1xuXG4vKiBHZXQgZGFtYWdlIG1vZGlmaWVycyBmcm9tIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmdldF9kYW1hZ2UgPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIGRhbWFnZSA9IG9iai5jLmRhbWFnZTtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgaWYgKHBsYXllciAmJiBkYW1hZ2UgIT09IDAgJiYgIW9iai5jLmlnbm9yZV9sZXZlbF9kYW1hZ2UpIHtcbiAgICB2YXIgbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuZGFtYWdlW3BsYXllci5sZXZlbF07XG4gICAgaWYgKGxldmVsKSB7XG4gICAgICBkYW1hZ2UgKz0gbGV2ZWw7XG4gICAgfVxuICB9XG4gIHJldHVybiBkYW1hZ2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgU3RhdGUgbWFuYWdlbWVudFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEdldCBzdGF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBhY2tfc3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICAvLyBwbGF5ZXJzXG4gIHZhciBwbGF5ZXJzID0gW107XG4gIGZvciAodmFyIGlkIGluIHN0YXRlLnBsYXllcnMpIHtcbiAgICBwbGF5ZXJzLnB1c2godGhpcy5wYWNrX3BsYXllcihzdGF0ZS5wbGF5ZXJzW2lkXSkpO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBvYmplY3RzXG4gIHZhciBvYmplY3RzID0gW107XG4gIGZvciAodmFyIGtleSBpbiBzdGF0ZS5vYmplY3RzKSB7XG4gICAgb2JqZWN0cy5wdXNoKHRoaXMucGFja19vYmplY3Qoc3RhdGUub2JqZWN0c1trZXldKSk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGV4cGxvc2lvbnNcbiAgdmFyIGV4cGxvc2lvbnMgPSBbXTtcbiAgZm9yIChrZXkgaW4gc3RhdGUuZXhwbG9zaW9ucykge1xuICAgIGV4cGxvc2lvbnMucHVzaCh0aGlzLnBhY2tfZXhwbG9zaW9uKHN0YXRlLmV4cGxvc2lvbnNba2V5XSkpO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICBwbGF5ZXJzLmpvaW4oXCIjXCIpICsgXCIrXCIgKyBvYmplY3RzLmpvaW4oXCIjXCIpICsgXCIrXCIgKyBleHBsb3Npb25zLmpvaW4oXCIjXCIpXG4gICk7XG59O1xuXG4vKiBTZXQgc3RhdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS51bnBhY2tfc3RhdGUgPSBmdW5jdGlvbihzdHIpIHtcbiAgLy8gYmxhbmsgc3RhdGVcbiAgdmFyIHN0YXRlID0gdGhpcy5ibGFua19zdGF0ZSgpO1xuXG4gIC8vIHJ1biB0aHJvdWdoIHN0YXRlIHN0cmluZ1xuICB2YXIgc3BsaXQgPSBzdHIuc3BsaXQoXCIrXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHNwbGl0W2ldKSB7XG4gICAgICB2YXIgc3BsaXQyID0gc3BsaXRbaV0uc3BsaXQoXCIjXCIpO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzcGxpdDIubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKGkgPT0gMCkge1xuICAgICAgICAgIHRoaXMudW5wYWNrX3BsYXllcihzdGF0ZSwgc3BsaXQyW2pdKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA9PSAxKSB7XG4gICAgICAgICAgdGhpcy51bnBhY2tfb2JqZWN0KHN0YXRlLCBzcGxpdDJbal0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpID09IDIpIHtcbiAgICAgICAgICB0aGlzLnVucGFja19leHBsb3Npb24oc3RhdGUsIHNwbGl0MltqXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3RhdGU7XG59O1xuXG4vKiBQbGF5ZXJzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGFja19wbGF5ZXIgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gcHJlcCBiYXNpYyB2YWx1ZXNcbiAgdmFyIGRlYWQgPSBvYmouZGVhZCA/IFwiMVwiIDogXCJcIjtcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYXJtb3VyeV9yZWZzLmluZGV4T2Yob2JqLndlYXBvbik7XG5cbiAgLy8gcHJlcCBhcm1vdXJ5XG4gIHZhciBhcm1vdXJ5ID0gW107XG4gIGZvciAodmFyIGtleSBpbiBvYmouYXJtb3VyeSkge1xuICAgIGFybW91cnkucHVzaChvYmouYXJtb3VyeVtrZXldKTtcbiAgfVxuICBhcm1vdXJ5ID0gYXJtb3VyeS5qb2luKFwiJFwiKTtcblxuICAvLyBwcmVwIGV2ZW50c1xuICB2YXIgZXZlbnRzID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBldmVudCA9IG9iai5ldmVudHNbaV07XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwid2Fsa1wiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjBcIik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcImp1bXBcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn4xXCIpO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJzaG9vdFwiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjJ+XCIgKyBldmVudC5vYmogKyBcIn5cIiArIGV2ZW50LndlYXBvbik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcImNyYXRlXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+M35cIiArIGV2ZW50Lm9iaik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcIm1lZHBhY2tcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn40flwiICsgZXZlbnQub2JqKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2VtXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+NX5cIiArIGV2ZW50Lm9iaik7XG4gICAgfVxuICB9XG4gIGV2ZW50cyA9IGV2ZW50cy5qb2luKFwiJFwiKTtcblxuICAvLyByZXR1cm4gcGxheWVyIHN0cmluZ1xuICB2YXIgYXJyID0gW1xuICAgIG9iai5pZCxcbiAgICBvYmoubGV2ZWwsXG4gICAgb2JqLnNjb3JlLFxuICAgIGRlYWQsXG4gICAgb2JqLmhlYWx0aCxcbiAgICBvYmouY29vbGRvd24sXG4gICAgb2JqLmhpdCxcbiAgICBvYmoubG9ja2VkLFxuICAgIGFybW91cnksXG4gICAgd2VhcG9uLFxuICAgIGV2ZW50c1xuICBdO1xuICByZXR1cm4gYXJyLmpvaW4oXCIvXCIpO1xufTtcblxuY29yZS5wcm90b3R5cGUudW5wYWNrX3BsYXllciA9IGZ1bmN0aW9uKHN0YXRlLCBzdHIpIHtcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiL1wiKTtcbiAgdmFyIHByb3BzID0ge307XG4gIHByb3BzLmlkID0gcGFyc2VJbnQoc3BsaXRbMF0pO1xuICBwcm9wcy5sZXZlbCA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgcHJvcHMuc2NvcmUgPSBwYXJzZUludChzcGxpdFsyXSk7XG4gIHByb3BzLmRlYWQgPSBzcGxpdFszXSA9PT0gXCIxXCIgPyB0cnVlIDogZmFsc2U7XG4gIHByb3BzLmhlYWx0aCA9IHBhcnNlSW50KHNwbGl0WzRdKTtcbiAgcHJvcHMuY29vbGRvd24gPSBwYXJzZUludChzcGxpdFs1XSk7XG4gIHByb3BzLmhpdCA9IHBhcnNlSW50KHNwbGl0WzZdKTtcbiAgcHJvcHMubG9ja2VkID0gc3BsaXRbN107XG5cbiAgLy8gcHJlcCBhcm1vdXJ5XG4gIHByb3BzLmFybW91cnkgPSB7fTtcbiAgdmFyIHNwbGl0MiA9IHNwbGl0WzhdLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdDIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gdGhpcy5hcm1vdXJ5X3JlZnNbaV07XG4gICAgcHJvcHMuYXJtb3VyeVtrZXldID0gcGFyc2VJbnQoc3BsaXQyW2ldKTtcbiAgfVxuXG4gIC8vIHdlYXBvblxuICB2YXIgd2VwID0gcGFyc2VJbnQoc3BsaXRbOV0pO1xuICBpZiAod2VwICE9PSAtMSkge1xuICAgIHByb3BzLndlYXBvbiA9IHRoaXMuYXJtb3VyeV9yZWZzW3dlcF07XG4gIH1cblxuICAvLyBwcmVwIGV2ZW50c1xuICBwcm9wcy5ldmVudHMgPSBbXTtcbiAgdmFyIHNwbGl0MiA9IHNwbGl0WzEwXS5zcGxpdChcIiRcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQyLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwbGl0MyA9IHNwbGl0MltpXS5zcGxpdChcIn5cIik7XG4gICAgdmFyIG9iaiA9IHsgZnJhbWU6IHBhcnNlSW50KHNwbGl0M1swXSkgfTtcbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjBcIikge1xuICAgICAgb2JqLnR5cGUgPSBcIndhbGtcIjtcbiAgICB9XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCIxXCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJqdW1wXCI7XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiMlwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwic2hvb3RcIjtcbiAgICAgIG9iai5vYmogPSBzcGxpdDNbMl07XG4gICAgICBvYmoud2VhcG9uID0gc3BsaXQzWzNdO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjNcIikge1xuICAgICAgb2JqLnR5cGUgPSBcImNyYXRlXCI7XG4gICAgICBvYmoub2JqID0gc3BsaXQzWzJdO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjRcIikge1xuICAgICAgb2JqLnR5cGUgPSBcIm1lZHBhY2tcIjtcbiAgICAgIG9iai5vYmogPSBzcGxpdDNbMl07XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiNVwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwiZ2VtXCI7XG4gICAgICBvYmoub2JqID0gc3BsaXQzWzJdO1xuICAgIH1cbiAgICBpZiAob2JqKSB7XG4gICAgICBwcm9wcy5ldmVudHMucHVzaChvYmopO1xuICAgIH1cbiAgfVxuXG4gIC8vIG1ha2UgaXRcbiAgdGhpcy5jcmVhdGVfcGxheWVyKHByb3BzLCBzdGF0ZSk7XG59O1xuXG4vKiBPYmplY3RzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGFja19vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIGdyb3VuZGVkID0gb2JqLmdyb3VuZGVkID8gXCIxXCIgOiBcIlwiO1xuICB2YXIgYXJyID0gW1xuICAgIG9iai50eXBlLFxuICAgIG9iai5wbGF5ZXJfaWQsXG4gICAgb2JqLmlkLFxuICAgIG9iai5mcmFtZSxcbiAgICBncm91bmRlZCxcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICBvYmouc3BlZWRfeCxcbiAgICBvYmouc3BlZWRfeSxcbiAgICBvYmouZGF0YVxuICBdO1xuICByZXR1cm4gYXJyLmpvaW4oXCIvXCIpO1xufTtcblxuY29yZS5wcm90b3R5cGUudW5wYWNrX29iamVjdCA9IGZ1bmN0aW9uKHN0YXRlLCBzdHIpIHtcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiL1wiKTtcbiAgdmFyIHByb3BzID0ge307XG4gIHByb3BzLnR5cGUgPSBzcGxpdFswXTtcbiAgcHJvcHMucGxheWVyX2lkID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICBwcm9wcy5pZCA9IHNwbGl0WzJdO1xuICBwcm9wcy5mcmFtZSA9IHBhcnNlSW50KHNwbGl0WzNdKTtcbiAgcHJvcHMuZ3JvdW5kZWQgPSBzcGxpdFs0XSA9PT0gXCIxXCIgPyB0cnVlIDogZmFsc2U7XG4gIHByb3BzLnggPSBwYXJzZUZsb2F0KHNwbGl0WzVdKTtcbiAgcHJvcHMueSA9IHBhcnNlRmxvYXQoc3BsaXRbNl0pO1xuICBwcm9wcy5zcGVlZF94ID0gcGFyc2VGbG9hdChzcGxpdFs3XSk7XG4gIHByb3BzLnNwZWVkX3kgPSBwYXJzZUZsb2F0KHNwbGl0WzhdKTtcbiAgcHJvcHMuZGF0YSA9IHNwbGl0WzldO1xuXG4gIHRoaXMuY3JlYXRlX29iamVjdChwcm9wcywgc3RhdGUpO1xufTtcblxuLyogRXhwbG9zaW9uc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBhY2tfZXhwbG9zaW9uID0gZnVuY3Rpb24ob2JqKSB7XG4gIHZhciBhcnIgPSBbXG4gICAgb2JqLnBsYXllcl9pZCxcbiAgICBvYmouZnJhbWUsXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgb2JqLnBhcmVudCxcbiAgICBvYmoucGFyZW50X3R5cGVcbiAgXTtcbiAgcmV0dXJuIGFyci5qb2luKFwiL1wiKTtcbn07XG5cbmNvcmUucHJvdG90eXBlLnVucGFja19leHBsb3Npb24gPSBmdW5jdGlvbihzdGF0ZSwgc3RyKSB7XG4gIHZhciBzcGxpdCA9IHN0ci5zcGxpdChcIi9cIik7XG4gIHZhciBwcm9wcyA9IHt9O1xuICBwcm9wcy5wbGF5ZXJfaWQgPSBwYXJzZUludChzcGxpdFswXSk7XG4gIHByb3BzLmZyYW1lID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICBwcm9wcy54ID0gcGFyc2VGbG9hdChzcGxpdFsyXSk7XG4gIHByb3BzLnkgPSBwYXJzZUZsb2F0KHNwbGl0WzNdKTtcbiAgcHJvcHMucGFyZW50ID0gc3BsaXRbNF07XG4gIHByb3BzLnBhcmVudF90eXBlID0gc3BsaXRbNV07XG5cbiAgdGhpcy5jcmVhdGVfZXhwbG9zaW9uKHByb3BzLCBzdGF0ZSk7XG59O1xuIiwiZnVuY3Rpb24gaXNNZXJnZWFibGVPYmplY3QodmFsKSB7XG4gIHZhciBub25OdWxsT2JqZWN0ID0gdmFsICYmIHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCI7XG5cbiAgcmV0dXJuIChcbiAgICBub25OdWxsT2JqZWN0ICYmXG4gICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbCkgIT09IFwiW29iamVjdCBSZWdFeHBdXCIgJiZcbiAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKSAhPT0gXCJbb2JqZWN0IERhdGVdXCJcbiAgKTtcbn1cblxuZnVuY3Rpb24gZW1wdHlUYXJnZXQodmFsKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHZhbCkgPyBbXSA6IHt9O1xufVxuXG5mdW5jdGlvbiBjbG9uZUlmTmVjZXNzYXJ5KHZhbHVlLCBvcHRpb25zQXJndW1lbnQpIHtcbiAgdmFyIGNsb25lID0gb3B0aW9uc0FyZ3VtZW50ICYmIG9wdGlvbnNBcmd1bWVudC5jbG9uZSA9PT0gdHJ1ZTtcbiAgcmV0dXJuIGNsb25lICYmIGlzTWVyZ2VhYmxlT2JqZWN0KHZhbHVlKVxuICAgID8gZGVlcG1lcmdlKGVtcHR5VGFyZ2V0KHZhbHVlKSwgdmFsdWUsIG9wdGlvbnNBcmd1bWVudClcbiAgICA6IHZhbHVlO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0QXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBkZXN0aW5hdGlvbiA9IHRhcmdldC5zbGljZSgpO1xuICBzb3VyY2UuZm9yRWFjaChmdW5jdGlvbihlLCBpKSB7XG4gICAgaWYgKHR5cGVvZiBkZXN0aW5hdGlvbltpXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgZGVzdGluYXRpb25baV0gPSBjbG9uZUlmTmVjZXNzYXJ5KGUsIG9wdGlvbnNBcmd1bWVudCk7XG4gICAgfSBlbHNlIGlmIChpc01lcmdlYWJsZU9iamVjdChlKSkge1xuICAgICAgZGVzdGluYXRpb25baV0gPSBkZWVwbWVyZ2UodGFyZ2V0W2ldLCBlLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0gZWxzZSBpZiAodGFyZ2V0LmluZGV4T2YoZSkgPT09IC0xKSB7XG4gICAgICBkZXN0aW5hdGlvbi5wdXNoKGNsb25lSWZOZWNlc3NhcnkoZSwgb3B0aW9uc0FyZ3VtZW50KSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRlc3RpbmF0aW9uO1xufVxuXG5mdW5jdGlvbiBtZXJnZU9iamVjdCh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBkZXN0aW5hdGlvbiA9IHt9O1xuICBpZiAoaXNNZXJnZWFibGVPYmplY3QodGFyZ2V0KSkge1xuICAgIE9iamVjdC5rZXlzKHRhcmdldCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBjbG9uZUlmTmVjZXNzYXJ5KHRhcmdldFtrZXldLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0pO1xuICB9XG4gIE9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAoIWlzTWVyZ2VhYmxlT2JqZWN0KHNvdXJjZVtrZXldKSB8fCAhdGFyZ2V0W2tleV0pIHtcbiAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBjbG9uZUlmTmVjZXNzYXJ5KHNvdXJjZVtrZXldLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZXN0aW5hdGlvbltrZXldID0gZGVlcG1lcmdlKHRhcmdldFtrZXldLCBzb3VyY2Vba2V5XSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZGVzdGluYXRpb247XG59XG5cbmZ1bmN0aW9uIGRlZXBtZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBhcnJheSA9IEFycmF5LmlzQXJyYXkoc291cmNlKTtcbiAgdmFyIG9wdGlvbnMgPSBvcHRpb25zQXJndW1lbnQgfHwgeyBhcnJheU1lcmdlOiBkZWZhdWx0QXJyYXlNZXJnZSB9O1xuICB2YXIgYXJyYXlNZXJnZSA9IG9wdGlvbnMuYXJyYXlNZXJnZSB8fCBkZWZhdWx0QXJyYXlNZXJnZTtcblxuICBpZiAoYXJyYXkpIHtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh0YXJnZXQpXG4gICAgICA/IGFycmF5TWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnNBcmd1bWVudClcbiAgICAgIDogY2xvbmVJZk5lY2Vzc2FyeShzb3VyY2UsIG9wdGlvbnNBcmd1bWVudCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zQXJndW1lbnQpO1xuICB9XG59XG5cbmRlZXBtZXJnZS5hbGwgPSBmdW5jdGlvbiBkZWVwbWVyZ2VBbGwoYXJyYXksIG9wdGlvbnNBcmd1bWVudCkge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoYXJyYXkpIHx8IGFycmF5Lmxlbmd0aCA8IDIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcImZpcnN0IGFyZ3VtZW50IHNob3VsZCBiZSBhbiBhcnJheSB3aXRoIGF0IGxlYXN0IHR3byBlbGVtZW50c1wiXG4gICAgKTtcbiAgfVxuXG4gIC8vIHdlIGFyZSBzdXJlIHRoZXJlIGFyZSBhdCBsZWFzdCAyIHZhbHVlcywgc28gaXQgaXMgc2FmZSB0byBoYXZlIG5vIGluaXRpYWwgdmFsdWVcbiAgcmV0dXJuIGFycmF5LnJlZHVjZShmdW5jdGlvbihwcmV2LCBuZXh0KSB7XG4gICAgcmV0dXJuIGRlZXBtZXJnZShwcmV2LCBuZXh0LCBvcHRpb25zQXJndW1lbnQpO1xuICB9KTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNYXRoIEZ1bmN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNob3J0ZW4gXCJNYXRoXCIgZnVuY3Rpb25zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gY29zKG4pIHtcbiAgcmV0dXJuIE1hdGguY29zKG4pO1xufVxuZnVuY3Rpb24gc2luKG4pIHtcbiAgcmV0dXJuIE1hdGguc2luKG4pO1xufVxuZnVuY3Rpb24gcG93KG4pIHtcbiAgcmV0dXJuIE1hdGgucG93KG4pO1xufVxuZnVuY3Rpb24gYWJzKG4pIHtcbiAgcmV0dXJuIE1hdGguYWJzKG4pO1xufVxuZnVuY3Rpb24gc3FyKG4pIHtcbiAgcmV0dXJuIE1hdGgucG93KG4sIDIpO1xufVxuZnVuY3Rpb24gc3FydChuKSB7XG4gIHJldHVybiBNYXRoLnNxcnQobik7XG59XG5mdW5jdGlvbiByb3VuZChuKSB7XG4gIHJldHVybiBNYXRoLnJvdW5kKG4pO1xufVxuZnVuY3Rpb24gZmxvb3Iobikge1xuICByZXR1cm4gTWF0aC5mbG9vcihuKTtcbn1cbmZ1bmN0aW9uIGNlaWwobikge1xuICByZXR1cm4gTWF0aC5jZWlsKG4pO1xufVxuZnVuY3Rpb24gYXRhbjIobjEsIG4yKSB7XG4gIHJldHVybiBNYXRoLmF0YW4yKG4xLCBuMik7XG59XG5mdW5jdGlvbiBtaW4objEsIG4yKSB7XG4gIHJldHVybiBNYXRoLm1pbihuMSwgbjIpO1xufVxuZnVuY3Rpb24gbWF4KG4xLCBuMikge1xuICByZXR1cm4gTWF0aC5tYXgobjEsIG4yKTtcbn1cbmZ1bmN0aW9uIHJhbmQobjEsIG4yKSB7XG4gIHJldHVybiBmbG9vcihNYXRoLnJhbmRvbSgpICogbjIpICsgbjE7XG59XG52YXIgcGkgPSBNYXRoLlBJO1xuXG4vKiBGaXggbnVtYmVyIHRvIGRlY2ltYWwgcGxhY2VzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuTnVtYmVyLnByb3RvdHlwZS5maXhlZCA9IGZ1bmN0aW9uKG4pIHtcbiAgbiA9IG4gfHwgMjtcbiAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy50b0ZpeGVkKG4pKTtcbn07XG5cbi8qIEFkZCBwcmVjZWRpbmcgemVyb2VzIHRvIG51bWJlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHByZWNlZGluZ196ZXJvZXMobiwgbGVuZ3RoKSB7XG4gIHZhciBsZW5ndGggPSBsZW5ndGggfHwgMjtcbiAgdmFyIG4gPSBuLnRvU3RyaW5nKCk7XG4gIHdoaWxlIChuLmxlbmd0aCA8IGxlbmd0aCkge1xuICAgIG4gPSBcIjBcIiArIG47XG4gIH1cbiAgcmV0dXJuIG47XG59XG5cbi8qIElzIG51bWJlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGlzX251bWVyaWMobikge1xuICByZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobikpICYmIGlzRmluaXRlKG4pO1xufVxuXG4vKiBHZXQgZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gZ2V0X3NwZWVkKHN4LCBzeSkge1xuICByZXR1cm4gcm91bmQoc3FydChzcXIoc3gpICsgc3FyKHN5KSkpO1xufVxuXG5mdW5jdGlvbiBnZXRfZGlzdGFuY2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgdmFyIGR4ID0geDIgLSB4MSxcbiAgICBkeSA9IHkyIC0geTE7XG4gIHJldHVybiBnZXRfc3BlZWQoZHgsIGR5KTtcbn1cblxuLyogQ2hlY2sgc3BlZWQgbGltaXRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBjaGVja19zcGVlZChzeCwgc3ksIHNwZWVkKSB7XG4gIHZhciBkID0gZ2V0X2Rpc3RhbmNlKDAsIDAsIHN4LCBzeSksXG4gICAgbnMgPSB7XG4gICAgICB4OiBzeCxcbiAgICAgIHk6IHN5LFxuICAgICAgdG90YWw6IGRcbiAgICB9O1xuICBpZiAoc3BlZWQgPCBkKSB7XG4gICAgdmFyIG11bHRpID0gc3BlZWQgLyBkO1xuICAgIG5zLnggPSBzeCAqIG11bHRpO1xuICAgIG5zLnkgPSBzeSAqIG11bHRpO1xuICAgIG5zLnRvdGFsID0gc3BlZWQ7XG4gIH1cbiAgcmV0dXJuIG5zO1xufVxuXG4vKiBHZXQgSGVhZGluZyBBbmdsZSBGcm9tIFggYW5kIFkgU3BlZWRcblx0Ly8gMCA9IGxlZnQsIDM2MCA9IGxlZnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBnZXRfYW5nbGUoc3gsIHN5KSB7XG4gIHJldHVybiAoKChhdGFuMihzeSwgc3gpICogMTgwKSAvIHBpKSAlIDM2MCkgKyAxODA7XG59XG5cbmZ1bmN0aW9uIGdldF9oZWFkaW5nKHgxLCB5MSwgeDIsIHkyKSB7XG4gIHZhciB4cyA9IHgyIC0geDEsXG4gICAgeXMgPSB5MiAtIHkxO1xuICByZXR1cm4gZ2V0X2FuZ2xlKHhzLCB5cyk7XG59XG5cbi8qIEdldCBYIGFuZCBZIHNwZWVkIGZyb20gaGVhZGluZyBhbmQgdmVsb2NpdHlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiB4eV9zcGVlZChhbmdsZSwgc3BlZWQpIHtcbiAgdmFyIGEgPSBhbmdsZV9hZGQoYW5nbGUsIDE4MCksXG4gICAgciA9IChhIC8gMTgwKSAqIHBpO1xuICByZXR1cm4ge1xuICAgIHg6IHNwZWVkICogY29zKHIpLFxuICAgIHk6IHNwZWVkICogc2luKHIpXG4gIH07XG59XG5cbi8qIEdldCBYIGFuZCBZIG9mZnNldCBmcm9tIGhlYWRpbmcgYW5kIHZlbG9jaXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24geHlfb2Zmc2V0KGFuZ2xlLCBzeCwgc3kpIHtcbiAgdmFyIHh5MSA9IHh5X3NwZWVkKGFuZ2xlLCBzeCk7XG4gIHZhciB4eTIgPSB4eV9zcGVlZChhbmdsZV9hZGQoYW5nbGUsIDkwKSwgc3kpO1xuICByZXR1cm4ge1xuICAgIHg6IHh5MS54ICsgeHkyLngsXG4gICAgeTogeHkxLnkgKyB4eTIueVxuICB9O1xufVxuXG4vKiBHZXQgZGlmZmVyZW5jZSBiZXR3ZWVuIHR3byBudW1iZXJzIGluIGEgbG9vcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG5fZGlmZihjdXJyZW50LCB0YXJnZXQsIGJvdHRvbSwgdG9wKSB7XG4gIGlmIChjdXJyZW50ID09IHRhcmdldCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgdmFyIHNjYWxlID0gYWJzKHRvcCAtIGJvdHRvbSksIC8vIGdldCB0b3RhbCBzaXplIG9mIHRoZSBsb29wXG4gICAgY19jdXJyZW50ID0gY3VycmVudCAtIGJvdHRvbSwgLy8gY29ycmVjdCBjdXJyZW50IGZvciBuZWdhdGl2ZSBudW1iZXJzXG4gICAgY190YXJnZXQgPSB0YXJnZXQgLSBib3R0b20sIC8vIGNvcnJlY3QgdGFyZ2V0IGZvciBuZWdhdGl2ZSBudW1iZXJzXG4gICAgbjEgPSAoY190YXJnZXQgKyBzY2FsZSAtIGNfY3VycmVudCkgJSBzY2FsZSwgLy8gZ2V0IGRpZmZlcmVuY2Ugd2hlbiBhZGRpbmdcbiAgICBuMiA9IChjX2N1cnJlbnQgKyBzY2FsZSAtIGNfdGFyZ2V0KSAlIHNjYWxlOyAvLyBnZXQgZGlmZmVyZW5jZSB3aGVuIHN1YnRyYWN0aW5nXG5cbiAgLy8gcmV0dXJuIHNtYWxsZXN0IGRpc3RhbmNlXG4gIGlmIChuMSA8IG4yKSB7XG4gICAgcmV0dXJuIG4xO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAtbjI7XG4gIH1cbn1cblxuLyogQXV0byBsb29wIGEgbnVtYmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbl9sb29wKG4sIGJvdHRvbSwgdG9wKSB7XG4gIHZhciBkaWZmZXJlbmNlID0gYWJzKHRvcCAtIGJvdHRvbSk7XG4gIHdoaWxlIChuIDw9IGJvdHRvbSkge1xuICAgIG4gKz0gZGlmZmVyZW5jZTtcbiAgfVxuICB3aGlsZSAobiA+IHRvcCkge1xuICAgIG4gLT0gZGlmZmVyZW5jZTtcbiAgfVxuICByZXR1cm4gbjtcbn1cblxuLyogQWRkIHRvIGEgbnVtYmVyIHdpdGhvdXQgb3ZlcmZsb3dpbmcgdXAgb3IgZG93biBmcm9tIG1pbi9tYXhcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBuX2FkZChuMSwgbjIsIHQxLCB0Mikge1xuICB2YXIgZGlmID0gYWJzKHQyIC0gdDEpLFxuICAgIG5hID0gbjEgKyBuMjtcbiAgd2hpbGUgKG5hIDwgdDEpIHtcbiAgICBuYSArPSBkaWY7XG4gIH1cbiAgd2hpbGUgKG5hID49IHQyKSB7XG4gICAgbmEgLT0gZGlmO1xuICB9XG4gIHJldHVybiBuYTtcbn1cblxuLyogQWRkIHRvIGFuIGFuZ2xlIHdpdGhvdXQgb3ZlcmZsb3dpbmcgdXAgb3IgZG93biBmcm9tIDAtMzYwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gYW5nbGVfYWRkKGFuZ2xlLCBhZGQpIHtcbiAgaWYgKCFhbmdsZSkge1xuICAgIGFuZ2xlID0gMDtcbiAgfVxuICByZXR1cm4gbl9hZGQoYW5nbGUsIGFkZCwgMCwgMzYwKTtcbn1cblxuLyogTW92ZSBudW1iZXIgdG93YXJkcyBhIG5ldyBudW1iZXIgd2l0aCBsb29wXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gaW5jcmVtZW50X251bShjdXJyZW50LCB0YXJnZXQsIGJvdHRvbSwgdG9wLCBzcGVlZCkge1xuICB2YXIgZGlmZiA9IG5fZGlmZihjdXJyZW50LCB0YXJnZXQsIGJvdHRvbSwgdG9wKTsgLy8gZ2V0IHNob3J0ZXN0IHJvdXRlIHRvIG51bWJlclxuICBtb3ZlID0gbWluKGFicyhkaWZmKSAvIDEwLCA0KSAqIHNwZWVkOyAvLyBjYWxjdWxhdGUgaG93IG11Y2ggdG8gbW92ZVxuXG4gIC8vIGlmIGRpZmZlcmVuY2UgaXMgbGVzcyB0aGVuIG1vdmVtZW50LCByZXR1cm4gdGFyZ2V0XG4gIGlmIChhYnMoZGlmZikgPCBtb3ZlKSB7XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIC8vIGFkZCBvciBzdWJ0cmFjdCBtb3ZlbWVudFxuICBtb3ZlID0gZGlmZiA8IDAgPyAtbW92ZSA6IG1vdmU7XG4gIHJldHVybiBuX2FkZChjdXJyZW50LCBtb3ZlLCBib3R0b20sIHRvcCk7XG59XG5cbi8qIE1vdmUgYW5nbGUgdG93YXJkcyBhIG5ldyBhbmdsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGluY3JlbWVudF9hbmdsZShvbGRfYW5nbGUsIG5ld19hbmdsZSwgc3BlZWQpIHtcbiAgcmV0dXJuIGluY3JlbWVudF9udW0ob2xkX2FuZ2xlLCBuZXdfYW5nbGUsIDAsIDM2MCwgc3BlZWQpO1xufVxuXG4vKiBJZiBhIHBvaW50IGlzIHdpdGhpbiBhIGNpcmNsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGluX2NpcmNsZSh4LCB5LCBjeCwgY3ksIHJhZGl1cykge1xuICByZXR1cm4gZ2V0X2Rpc3RhbmNlKHgsIHksIGN4LCBjeSkgPCByYWRpdXM7XG59XG5cbi8qIFBsb3QgYSBjb3Vyc2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBwbG90X2NvdXJzZSh4LCB5LCBzeCwgc3ksIGV4dGVuZCkge1xuICAvLyBnZXQgaW5pdGlhbCBzcGVlZFxuICB2YXIgZXh0ZW5kID0gZXh0ZW5kID8gZXh0ZW5kIDogMCxcbiAgICBzcGVlZCA9IGdldF9zcGVlZChzeCwgc3kpO1xuXG4gIC8vIGlmIG5vIGRpc3RhbmNlIHRoZW4gZG8gbm90aGluZ1xuICBpZiAoc3BlZWQgPT0gMCkge1xuICAgIHJldHVybiB7IG1vdmU6IGZhbHNlIH07XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgaW5jcmVtZW50c1xuICB2YXIgaW5jcmVtZW50X3ggPSBzeCAvIHNwZWVkLFxuICAgIGluY3JlbWVudF95ID0gc3kgLyBzcGVlZCxcbiAgICBuZXdfeCA9IHggLSBpbmNyZW1lbnRfeCAqIGV4dGVuZCxcbiAgICBuZXdfeSA9IHkgLSBpbmNyZW1lbnRfeSAqIGV4dGVuZCxcbiAgICBwb2ludHMgPSBbeyB4OiBuZXdfeCwgeTogbmV3X3kgfV07XG5cbiAgLy8gaXRlcmF0ZSB0aHJvdWdoIHBhdGggYW5kIHJlY29yZCBwb2ludHNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVlZCArIGV4dGVuZCAqIDI7IGkrKykge1xuICAgIChuZXdfeCArPSBpbmNyZW1lbnRfeCksIChuZXdfeSArPSBpbmNyZW1lbnRfeSk7XG4gICAgcG9pbnRzLnB1c2goe1xuICAgICAgeDogbmV3X3gsXG4gICAgICB5OiBuZXdfeVxuICAgIH0pO1xuICB9XG5cbiAgLy8gcmV0dXJuIHBvaW50IGFycmF5XG4gIHJldHVybiB7XG4gICAgbW92ZTogdHJ1ZSxcbiAgICBwb2ludHM6IHBvaW50c1xuICB9O1xufVxuXG4vKiB0cmFuc2xhdGUgY28tb3JkaW5hdGVzIGJ5IGFuIGFuZ2xlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gcm90YXRlX2Nvb3Jkcyh4LCB5LCBjeCwgY3ksIGFuZ2xlKSB7XG4gIHZhciByID0gKHBpIC8gMTgwKSAqIGFuZ2xlO1xuICByZXR1cm4ge1xuICAgIHg6IGNvcyhyKSAqICh4IC0gY3gpICsgc2luKHIpICogKHkgLSBjeSkgKyBjeCxcbiAgICB5OiBjb3MocikgKiAoeSAtIGN5KSAtIHNpbihyKSAqICh4IC0gY3gpICsgY3lcbiAgfTtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1pc2MgRnVuY3Rpb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogRHVwbGljYXRlIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGR1cGxpY2F0ZV9vYmoob2JqKSB7XG4gIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xufVxuXG4vKiBQcmV2ZW50IGFycmF5IG1lcmdpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBkb250X21lcmdlKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHtcbiAgaWYgKCFzb3VyY2UpIHtcbiAgICByZXR1cm4gZGVzdGluYXRpb247XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNvdXJjZTtcbiAgfVxufVxuXG4vKiBBZGQgc3BhY2UgdG8gYSBzdHJpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBzdHJfc3BhY2Uoc3RyKSB7XG4gIHZhciBuZXdfc3RyID0gXCJcIjtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgYWRkID0gaSA9PSBzdHIubGVuZ3RoIC0gMSA/IFwiXCIgOiBcIlxcdTIwMEFcIjtcbiAgICBuZXdfc3RyICs9IHN0cltpXSArIGFkZDtcbiAgfVxuICByZXR1cm4gbmV3X3N0cjtcbn1cblxuLyogTG9nIG11bHRpcGxlIHZhbHVlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGNsb2coXG4gIHMxLFxuICBzMixcbiAgczMsXG4gIHM0LFxuICBzNSxcbiAgczYsXG4gIHM3LFxuICBzOCxcbiAgczksXG4gIHMxMCxcbiAgczExLFxuICBzMTIsXG4gIHMxMyxcbiAgczE0LFxuICBzMTVcbikge1xuICB2YXIgc3RyID0gczE7XG4gIGlmIChzMiAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMyO1xuICB9XG4gIGlmIChzMyAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMzO1xuICB9XG4gIGlmIChzNCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM0O1xuICB9XG4gIGlmIChzNSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM1O1xuICB9XG4gIGlmIChzNiAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM2O1xuICB9XG4gIGlmIChzNyAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM3O1xuICB9XG4gIGlmIChzOCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM4O1xuICB9XG4gIGlmIChzOSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM5O1xuICB9XG4gIGlmIChzMTAgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTA7XG4gIH1cbiAgaWYgKHMxMSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxMTtcbiAgfVxuICBpZiAoczEyICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczEyO1xuICB9XG4gIGlmIChzMTMgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTM7XG4gIH1cbiAgaWYgKHMxNCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxNDtcbiAgfVxuICBpZiAoczE1ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczE1O1xuICB9XG4gIGNvbnNvbGUubG9nKHN0cik7XG59XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0TWFwIEdlbmVyYXRvclxuXHRCbG9ic1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIERyYXcgYSBibG9iXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbWFwZ2VuX2Jsb2IoaW1nLCBjb25maWcsIGRlY29yYXRpb25zLCByYWRpdXMsIHR5cGUpIHtcbiAgdGhpcy5zaXplID0gMzY7XG4gIHRoaXMuaW1nID0gaW1nO1xuICB0aGlzLmMgPSBjb25maWc7XG5cbiAgLy8gZ2V0IGxhbmQgdHlwZVxuICB2YXIgdHlwZSA9IHR5cGUgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5jLmxhbmRfdHlwZS5sZW5ndGgpO1xuICB0aGlzLnJlZiA9IHRoaXMuYy5sYW5kX3R5cGVbdHlwZV07XG5cbiAgLy8gc2V0IHVwIG1haW4gYW5jaG9yIHBvaW50c1xuICB2YXIgYW5jaG9ycyA9IFtdO1xuICB2YXIgcG9pbnRzID0gTWF0aC5mbG9vcihyYWRpdXMgLyAyKSArIDQ7XG4gIHZhciBzcGlrZSA9IE1hdGguZmxvb3IocmFkaXVzIC8gMikgKyAyO1xuICBmb3IgKHZhciBwID0gMDsgcCA8IHBvaW50czsgcCsrKSB7XG4gICAgdmFyIG5ld19yYWRpdXMgPVxuICAgICAgTWF0aC5tYXgocmFkaXVzIC0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3Bpa2UpLCAxKSArIDE7XG4gICAgdmFyIHggPVxuICAgICAgcmFkaXVzICsgTWF0aC5mbG9vcihuZXdfcmFkaXVzICogTWF0aC5jb3MoKDIgKiBNYXRoLlBJICogcCkgLyBwb2ludHMpKTtcbiAgICB2YXIgeSA9XG4gICAgICByYWRpdXMgKyBNYXRoLmZsb29yKG5ld19yYWRpdXMgKiBNYXRoLnNpbigoMiAqIE1hdGguUEkgKiBwKSAvIHBvaW50cykpO1xuICAgIGFuY2hvcnMucHVzaCh7IHg6IHgsIHk6IHkgfSk7XG4gIH1cblxuICAvLyBkcmF3IHNoYXBlIHRvIGNhbnZhc1xuICB2YXIgc2l6ZSA9IHJhZGl1cyAqIDIgKyAxO1xuICB2YXIgc2hhcGUgPSBtYXBnZW5fY2FudmFzKHNpemUsIHNpemUpO1xuICB0aGlzLmRyYXdfcGF0aChzaGFwZSwgYW5jaG9ycyk7XG5cbiAgLy8gYnVpbGQgYXJyYXkgb2YgbGFuZCBvciBub3QgdGlsZXNcbiAgdmFyIHBpeGVscyA9IHNoYXBlLmNvbnQuZ2V0SW1hZ2VEYXRhKDAsIDAsIHNoYXBlLncsIHNoYXBlLmgpO1xuICB0aGlzLmxhbmQgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCBzaXplOyB5KyspIHtcbiAgICB0aGlzLmxhbmRbeV0gPSBbXTtcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNpemU7IHgrKykge1xuICAgICAgdmFyIGkgPSAoeSAqIHNpemUgKyB4KSAqIDQgKyAzO1xuICAgICAgdGhpcy5sYW5kW3ldW3hdID0gcGl4ZWxzLmRhdGFbaV0gPiAzMCA/IDEgOiAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIGJ1aWxkIHRpbGUgYXJyYXkgYW5kIGFzc2lnbiBjb3JuZXJzIGFuZCBsYW5kXG4gIHRoaXMudGlsZXMgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCBzaXplOyB5KyspIHtcbiAgICB0aGlzLnRpbGVzW3ldID0gW107XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzaXplOyB4KyspIHtcbiAgICAgIHRoaXMudGlsZXNbeV1beF0gPSB0aGlzLnNldF9jb3JuZXJfdGlsZSh5LCB4KTtcbiAgICB9XG4gIH1cblxuICAvLyBhc3NpZ24gcGl4ZWxzIGEgdGlsZSB2YWx1ZVxuICBmb3IgKHZhciB5ID0gMDsgeSA8IHNpemU7IHkrKykge1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCsrKSB7XG4gICAgICB0aGlzLnRpbGVzW3ldW3hdID1cbiAgICAgICAgdGhpcy50aWxlc1t5XVt4XSA9PT0gMTIgPyB0aGlzLnNldF9sYW5kX3RpbGUoeSwgeCkgOiB0aGlzLnRpbGVzW3ldW3hdO1xuICAgIH1cbiAgfVxuXG4gIC8vIGRyYXcgdGhlbVxuICB2YXIgd2ggPSAoc2l6ZSArIDQpICogdGhpcy5zaXplO1xuICB0aGlzLmFscGhhID0gbWFwZ2VuX2NhbnZhcyh3aCwgd2gpO1xuICB0aGlzLmVkZ2UgPSBtYXBnZW5fY2FudmFzKHdoLCB3aCk7XG4gIHRoaXMuYmcgPSBtYXBnZW5fY2FudmFzKHdoLCB3aCk7XG4gIGZvciAodmFyIHkgPSAwOyB5IDwgc2l6ZTsgeSsrKSB7XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzaXplOyB4KyspIHtcbiAgICAgIHZhciB0aWxlID0gdGhpcy50aWxlc1t5XVt4XTtcbiAgICAgIGlmICh0aWxlID09PSAtMSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gZHJhdyBpdFxuICAgICAgdmFyIHgxID0gKHggKyAyKSAqIHRoaXMuc2l6ZTtcbiAgICAgIHZhciB5MSA9ICh5ICsgMikgKiB0aGlzLnNpemU7XG4gICAgICB0aGlzLmRyYXdfdG9fY2FudmFzKHRoaXMuYWxwaGEuY29udCwgeDEsIHkxLCB0aWxlLCAwKTtcbiAgICAgIHRoaXMuZHJhd190b19jYW52YXModGhpcy5lZGdlLmNvbnQsIHgxLCB5MSwgdGlsZSwgdGhpcy5yZWYuZWRnZSk7XG5cbiAgICAgIGlmIChkZWNvcmF0aW9ucykge1xuICAgICAgICB0aGlzLmRyYXdfZGVjb3JhdGlvbih0aGlzLmJnLmNvbnQsIHgsIHksIHRpbGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGRyYXcgcmVzdCBvZiBmZ1xuICB2YXIgZmcgPSBtYXBnZW5fcGF0dGVybih0aGlzLmFscGhhLmNhbnYsIHRoaXMuaW1nW3RoaXMucmVmLmZnXSk7XG4gIGZnLmNvbnQuZHJhd0ltYWdlKHRoaXMuZWRnZS5jYW52LCAwLCAwKTtcblxuICAvLyBkcmF3IGRpcnQgYmdcbiAgdmFyIGZnX2RpcnQgPSBtYXBnZW5fcGF0dGVybihmZy5jYW52LCB0aGlzLmltZ1t0aGlzLnJlZi5iZ10pO1xuICB0aGlzLmJnLmNvbnQuZHJhd0ltYWdlKGZnX2RpcnQuY2FudiwgMCwgMCk7XG5cbiAgLy8gZXhwb3J0XG4gIHJldHVybiB7XG4gICAgZmc6IGZnLFxuICAgIGJnOiB0aGlzLmJnXG4gIH07XG59XG5cbi8qIERyYXcgYW4gYWxwaGEgcGF0aFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5kcmF3X3BhdGggPSBmdW5jdGlvbihjYW52LCBwYXRoKSB7XG4gIC8vIHN0YXJ0IHBhdGhzIG9uIGNhbnZhc2VzXG4gIGNhbnYuY29udC5iZWdpblBhdGgoKTtcbiAgY2Fudi5jb250Lm1vdmVUbyhwYXRoWzBdLngsIHBhdGhbMF0ueSk7XG5cbiAgLy8gZ28gdGhyb3VnaCBwYXRoXG4gIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAvLyBnZXQgbmV4dCBwb2ludCB0byBjdXJ2ZSBhcm91bmRcbiAgICB2YXIgcG9pbnQxID0gcGF0aFtpXSxcbiAgICAgIHBvaW50MiA9IHBhdGhbaSArIDFdLFxuICAgICAgcXgsXG4gICAgICBxeTtcblxuICAgIC8vIGdldCBjdXJ2ZSB2YWx1ZXNcbiAgICBpZiAoaSA8IHBhdGgubGVuZ3RoIC0gMSkge1xuICAgICAgcXggPSAocG9pbnQxLnggKyBwb2ludDIueCkgLyAyO1xuICAgICAgcXkgPSAocG9pbnQxLnkgKyBwb2ludDIueSkgLyAyO1xuICAgIH0gZWxzZSB7XG4gICAgICBxeCA9IHBvaW50Mi54O1xuICAgICAgcXkgPSBwb2ludDIueTtcbiAgICB9XG5cbiAgICAvLyBkcmF3IGN1cnZlIHRvIHBhdGhcbiAgICBjYW52LmNvbnQucXVhZHJhdGljQ3VydmVUbyhwb2ludDEueCwgcG9pbnQxLnksIHF4LCBxeSk7XG4gIH1cblxuICAvLyByZWpvaW4gdGhlIGJlZ2lubmluZyBvZiB0aGUgcGF0aCBhbmQgZmlsbFxuICBjYW52LmNvbnQubGluZVRvKHBhdGhbMF0ueCwgcGF0aFswXS55KTtcbiAgY2Fudi5jb250LmZpbGwoKTtcbn07XG5cbi8qIERyYXcgYSBkZWNvcmF0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmRyYXdfZGVjb3JhdGlvbiA9IGZ1bmN0aW9uKGNvbnQsIHgsIHksIHRpbGUpIHtcbiAgLy8gYXJlIHdlIGRyYXdpbmcgb25lXG4gIGlmICh0aWxlID4gNyB8fCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSAhPT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNhbiB3ZSBkbyBkb3VibGVzXG4gIHZhciBkb3VibGUgPSBmYWxzZTtcbiAgaWYgKHRpbGUgPT09IDAgJiYgdGhpcy5pc190eXBlKHksIHggKyAxLCAwKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDEgJiYgdGhpcy5pc190eXBlKHksIHggLSAxLCAxKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDIgJiYgdGhpcy5pc190eXBlKHkgLSAxLCB4LCAyKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDMgJiYgdGhpcy5pc190eXBlKHkgKyAxLCB4LCAzKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDQgJiYgdGhpcy5pc190eXBlKHkgLSAxLCB4ICsgMSwgNCkpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSA1ICYmIHRoaXMuaXNfdHlwZSh5ICsgMSwgeCArIDEsIDUpKSB7XG4gICAgZG91YmxlID0gdHJ1ZTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNiAmJiB0aGlzLmlzX3R5cGUoeSAtIDEsIHggLSAxLCA2KSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDcgJiYgdGhpcy5pc190eXBlKHkgKyAxLCB4IC0gMSwgNykpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG5cbiAgLy8gY2hvb3NlIHNvdXJjZVxuICB2YXIgc291cmNlID0gdGhpcy5yZWYuZGVjb3JhdGlvbnNbMV07XG4gIGlmIChkb3VibGUgJiYgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgPT09IDApIHtcbiAgICBzb3VyY2UgPSB0aGlzLnJlZi5kZWNvcmF0aW9uc1syXTtcbiAgfSBlbHNlIHtcbiAgICBkb3VibGUgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIGNob29zZSBkZWNvcmF0aW9uXG4gIHZhciBpID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc291cmNlLmxlbmd0aCk7XG4gIHZhciByZWYgPSBzb3VyY2VbaV07XG5cbiAgLy8gZ2V0IHBvc2l0aW9uIHRvIGRyYXcgaXRcbiAgdmFyIGhhbGYgPSB0aGlzLnNpemUgLyAyO1xuICB2YXIgeDEgPSAoeCArIDIpICogdGhpcy5zaXplO1xuICB2YXIgeTEgPSAoeSArIDIpICogdGhpcy5zaXplO1xuICB2YXIgYW5nbGUgPSAwO1xuICBpZiAodGlsZSA9PT0gMSkge1xuICAgIHgxICs9IHRoaXMuc2l6ZTtcbiAgICB5MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSAxODA7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDIpIHtcbiAgICB5MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSAyNzA7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDMpIHtcbiAgICB4MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSA5MDtcbiAgfVxuICBpZiAodGlsZSA9PT0gNCkge1xuICAgIHkxICs9IHRoaXMuc2l6ZTtcbiAgICBhbmdsZSA9IDMxNTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNSkge1xuICAgIGFuZ2xlID0gNDU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDYpIHtcbiAgICB4MSArPSB0aGlzLnNpemU7XG4gICAgeTEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMjI1O1xuICB9XG4gIGlmICh0aWxlID09PSA3KSB7XG4gICAgeDEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMTM1O1xuICB9XG5cbiAgLy8gZHJhdyB0aGF0IHNoaXRcbiAgdmFyIHhfYWRkID0gZG91YmxlID8gdGhpcy5zaXplIDogMDtcbiAgY29udC5zYXZlKCk7XG4gIGNvbnQudHJhbnNsYXRlKHgxLCB5MSk7XG4gIGNvbnQucm90YXRlKChhbmdsZSAqIE1hdGguUEkpIC8gMTgwKTtcbiAgY29udC5kcmF3SW1hZ2UoXG4gICAgdGhpcy5pbWcuZGVjb3JhdGlvbnMsXG4gICAgcmVmLngsXG4gICAgcmVmLnksXG4gICAgcmVmLncsXG4gICAgcmVmLmgsXG4gICAgMCxcbiAgICAtcmVmLmggKyA1LFxuICAgIHJlZi53LFxuICAgIHJlZi5oXG4gICk7XG4gIGNvbnQudHJhbnNsYXRlKC14MSwgLXkxKTtcbiAgY29udC5yZXN0b3JlKCk7XG59O1xuXG4vKiBEcmF3IGEgdGlsZSB0byBhIGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5kcmF3X3RvX2NhbnZhcyA9IGZ1bmN0aW9uKGNvbnQsIHgsIHksIHRpbGUsIGtleSkge1xuICB2YXIgdHMgPSB0aGlzLnNpemU7XG4gIGNvbnQuc2F2ZSgpO1xuICBjb250LnRyYW5zbGF0ZSh4LCB5KTtcbiAgY29udC5kcmF3SW1hZ2UodGhpcy5pbWcuZWRnZSwgdGlsZSAqIHRzLCBrZXkgKiB0cywgdHMsIHRzLCAwLCAwLCB0cywgdHMpO1xuICBjb250LnRyYW5zbGF0ZSgteSwgLXkpO1xuICBjb250LnJlc3RvcmUoKTtcbn07XG5cbi8qIEdldCBjb3JuZXIgYW5kIGxhbmQgdGlsZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuc2V0X2Nvcm5lcl90aWxlID0gZnVuY3Rpb24oeSwgeCkge1xuICB2YXIgdGlsZSA9IC0xO1xuXG4gIC8vbGFuZFxuICBpZiAodGhpcy5pc19sYW5kKHksIHgpKSB7XG4gICAgdGlsZSA9IDEyO1xuXG4gICAgLy8gbm90IGxhbmRcbiAgfSBlbHNlIHtcbiAgICAvLyBjb3JuZXJzXG4gICAgaWYgKFxuICAgICAgIXRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNDtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgIXRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgIHRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAgIHRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICAgIXRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNjtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGlsZTtcbn07XG5cbi8qIFNldCBsYW5kIHRpbGUgdHlwZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuc2V0X2xhbmRfdGlsZSA9IGZ1bmN0aW9uKHksIHgpIHtcbiAgdmFyIHRpbGUgPSAxMjtcblxuICAvLyBjb3JuZXJzXG4gIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5ICsgMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHksIHggKyAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSAtIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSA0O1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgIXRoaXMuaXNfbGFuZCh5LCB4ICsgMSkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHksIHggLSAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSArIDEsIHgpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHksIHggKyAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5IC0gMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDU7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSAtIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCAtIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgKyAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gNjtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5IC0gMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHksIHggLSAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSArIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSA3O1xuXG4gICAgLy8gZmxhdCBlZGdlc1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5IC0gMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDA7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgKyAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gMTtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZCh5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCAtIDEpXG4gICkge1xuICAgIHRpbGUgPSAyO1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4ICsgMSlcbiAgKSB7XG4gICAgdGlsZSA9IDM7XG5cbiAgICAvLyBpbnNpZGUgY29ybmVyc1xuICB9IGVsc2UgaWYgKHRoaXMuaXNfdHlwZSh5ICsgMSwgeCwgNykgfHwgdGhpcy5pc190eXBlKHksIHggKyAxLCA3KSkge1xuICAgIHRpbGUgPSA4O1xuICB9IGVsc2UgaWYgKHRoaXMuaXNfdHlwZSh5ICsgMSwgeCwgNikgfHwgdGhpcy5pc190eXBlKHksIHggLSAxLCA2KSkge1xuICAgIHRpbGUgPSA5O1xuICB9IGVsc2UgaWYgKHRoaXMuaXNfdHlwZSh5IC0gMSwgeCwgNSkgfHwgdGhpcy5pc190eXBlKHksIHggKyAxLCA1KSkge1xuICAgIHRpbGUgPSAxMDtcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSAtIDEsIHgsIDQpIHx8IHRoaXMuaXNfdHlwZSh5LCB4IC0gMSwgNCkpIHtcbiAgICB0aWxlID0gMTE7XG4gIH1cblxuICByZXR1cm4gdGlsZTtcbn07XG5cbi8qIENoZWNrIGFycmF5cyBmb3IgdmFsdWVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmlzX2xhbmRfb3JfY29ybmVyID0gZnVuY3Rpb24oeSwgeCkge1xuICBpZiAodGhpcy5pc19jb3JuZXIoeSwgeCkgfHwgdGhpcy5pc19sYW5kKHksIHgpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn07XG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc19jb3JuZXIgPSBmdW5jdGlvbih5LCB4KSB7XG4gIHJldHVybiB0aGlzLmNoZWNrX2Fycih0aGlzLnRpbGVzLCB5LCB4LCBbNCwgNSwgNiwgN10pO1xufTtcblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmlzX3R5cGUgPSBmdW5jdGlvbih5LCB4LCB0eXBlKSB7XG4gIHJldHVybiB0aGlzLmNoZWNrX2Fycih0aGlzLnRpbGVzLCB5LCB4LCBbdHlwZV0pO1xufTtcblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmlzX2xhbmQgPSBmdW5jdGlvbih5LCB4KSB7XG4gIHJldHVybiB0aGlzLmNoZWNrX2Fycih0aGlzLmxhbmQsIHksIHgsIFsxXSk7XG59O1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuY2hlY2tfYXJyID0gZnVuY3Rpb24oYXJyLCB5LCB4LCBjaGVja3MpIHtcbiAgaWYgKHkgPCAwIHx8IHkgPj0gYXJyLmxlbmd0aCB8fCB4IDwgMCB8fCB4ID49IGFyclswXS5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGVja3MubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoYXJyW3ldW3hdID09IGNoZWNrc1tpXSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHZW5lcmF0b3Jcblx0TWFrZSBDYW52YXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgYSBuZXcgY2FudmFzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbWFwZ2VuX2NhbnZhcyh3LCBoKSB7XG4gIHZhciBvYmogPSB7fTtcbiAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICAgIG9iai5jYW52ID0gbmV3IGNhbnZhcygpO1xuICB9IGVsc2Uge1xuICAgIG9iai5jYW52ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgfVxuICBvYmouY29udCA9IG9iai5jYW52LmdldENvbnRleHQoXCIyZFwiKTtcbiAgb2JqLmNhbnYud2lkdGggPSB3O1xuICBvYmouY2Fudi5oZWlnaHQgPSBoO1xuICBvYmouY29udC5maWxsU3R5bGUgPSBcIiNmZmZcIjtcbiAgb2JqLncgPSB3O1xuICBvYmouaCA9IGg7XG4gIHJldHVybiBvYmo7XG59XG5cbi8qIERyYXcgYSBwYXR0ZXJuIHRvIGEgY2FudmFzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbWFwZ2VuX3BhdHRlcm4oYWxwaGEsIHBhdHRlcm4pIHtcbiAgdmFyIGNhbnYgPSBtYXBnZW5fY2FudmFzKGFscGhhLndpZHRoLCBhbHBoYS5oZWlnaHQpO1xuICBpZiAodHlwZW9mIHBhdHRlcm4gIT09IFwic3RyaW5nXCIpIHtcbiAgICBwYXR0ZXJuID0gY2Fudi5jb250LmNyZWF0ZVBhdHRlcm4ocGF0dGVybiwgXCJyZXBlYXRcIik7XG4gIH1cbiAgY2Fudi5jb250LmZpbGxTdHlsZSA9IHBhdHRlcm47XG4gIGNhbnYuY29udC5maWxsUmVjdCgwLCAwLCBhbHBoYS53aWR0aCwgYWxwaGEuaGVpZ2h0KTtcbiAgY2Fudi5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24taW5cIjtcbiAgY2Fudi5jb250LmRyYXdJbWFnZShhbHBoYSwgMCwgMCk7XG4gIGNhbnYuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcIm5vcm1hbFwiO1xuXG4gIHJldHVybiBjYW52O1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHZW5lcmF0b3Jcblx0LS0tLS0tLS0tLS0tXG5cdENvbmZpZzpcblx0dyAgICAgICAgICAgLy8gd2lkdGggb2YgbWFwXG5cdGggICAgICAgICAgIC8vIGhlaWdodCBvZiBtYXBcblx0Y3J1c3QgICAgICAgLy8gdGhpY2tuZXNzIG9mIG91dGVyIGNydXN0IG9uIGxhbmRcblx0YmxvYnMgICAgICAgLy8gaW5pdGlhbCBibG9ic1xuXHRjZW50ZXJfYmxvYiAvLyBzaXplIG9mIGNlbnRlciBibG9iIG9mIGxhbmQsIDAgZm9yIG5vbmVcblx0c21hbGxfYmxvYnMgLy8gbnVtYmVyIG9mIHJhbmRvbSBzbWFsbCBjaXJjbGVzIG9mIGxhbmRcblx0bGFyZ2VfYmxvYnMgLy8gbnVtYmVyIG9mIHJhbmRvbSBsYXJnZSBjaXJjbGVzIG9mIGxhbmRcblx0LS0tLS0tLS0tLS1cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXJ2ZXIgc2lkZSBvbmx5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICB2YXIgZnMgPSByZXF1aXJlKFwiZnNcIik7XG59XG5cbi8qIE5ldyBNYXAgR2VuZXJhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbihpbWcsIGNvbmZpZywgc2NoZW1lLCBtYXBfaW1nKSB7XG4gIHRoaXMuc2l6ZSA9IDM2O1xuICB0aGlzLmltZyA9IGltZztcbiAgdGhpcy5jID0gY29uZmlnO1xuICB0aGlzLnNjaGVtZSA9IHNjaGVtZTtcblxuICAvLyBjaG9vc2UgdHlwZVxuICBpZiAodGhpcy5zY2hlbWUudHlwZSA9PSBcInJhbmRvbVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZHJhd19yYW5kb20oKTtcbiAgfVxuICBpZiAodGhpcy5zY2hlbWUudHlwZSA9PSBcImltYWdlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3X2ltYWdlKG1hcF9pbWcpO1xuICB9XG59XG5cbi8qIERyYXcgaW1hZ2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmRyYXdfaW1hZ2UgPSBmdW5jdGlvbihtYXBfaW1nKSB7XG4gIHZhciBmZyA9IG1hcGdlbl9jYW52YXMoXG4gICAgbWFwX2ltZy53aWR0aCArIHRoaXMuc2NoZW1lLmdhcCAqIDIsXG4gICAgbWFwX2ltZy5oZWlnaHQgKyB0aGlzLnNjaGVtZS5nYXAgKiAyXG4gICk7XG4gIGZnLmNvbnQuZHJhd0ltYWdlKG1hcF9pbWcsIHRoaXMuc2NoZW1lLmdhcCwgdGhpcy5zY2hlbWUuZ2FwKTtcbiAgdmFyIGJnID0gbWFwZ2VuX3BhdHRlcm4oZmcuY2FudiwgdGhpcy5pbWcuZGlydCk7XG4gIHJldHVybiB7IGZnOiBmZywgYmc6IGJnIH07XG59O1xuXG4vKiBEcmF3IHJhbmRvbVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbi5wcm90b3R5cGUuZHJhd19yYW5kb20gPSBmdW5jdGlvbigpIHtcbiAgLy8gc2V0dXBcbiAgdGhpcy5ibG9icyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5zY2hlbWUuYmxvYnMpKTtcbiAgdGhpcy5iZyA9IG1hcGdlbl9jYW52YXModGhpcy5zY2hlbWUudywgdGhpcy5zY2hlbWUuaCk7XG4gIHRoaXMuZmcgPSBtYXBnZW5fY2FudmFzKHRoaXMuc2NoZW1lLncsIHRoaXMuc2NoZW1lLmgpO1xuXG4gIC8vIGdlbmVyYXRlIHNvbWUgcmFuZG9tIGxhcmdlIGNpcmNsZXNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5sYXJnZV9ibG9iczsgaSsrKSB7XG4gICAgdGhpcy5ibG9icyA9IHRoaXMuZ2V0X2NpcmNsZSh0aGlzLmJsb2JzLCA0LCA2KTtcbiAgfVxuXG4gIC8vIGdlbmVyYXRlIHNvbWUgcmFuZG9tIHNtYWxsIGNpcmNsZXNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5zbWFsbF9ibG9iczsgaSsrKSB7XG4gICAgdGhpcy5ibG9icyA9IHRoaXMuZ2V0X2NpcmNsZSh0aGlzLmJsb2JzLCAxLCAzKTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZWFjaCBibG9iXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ibG9icy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBibG9iID0gdGhpcy5ibG9ic1tpXTtcblxuICAgIC8vIGNyZWF0ZSB0aGUgYmxvYnNcbiAgICB2YXIgYmcgPSBuZXcgbWFwZ2VuX2Jsb2IodGhpcy5pbWcsIHRoaXMuYywgZmFsc2UsIGJsb2IuciArIDQsIGJsb2IudHlwZSk7XG4gICAgdmFyIGZnID0gbmV3IG1hcGdlbl9ibG9iKFxuICAgICAgdGhpcy5pbWcsXG4gICAgICB0aGlzLmMsXG4gICAgICB0aGlzLnNjaGVtZS5kZWNvcmF0aW9ucyxcbiAgICAgIGJsb2IucixcbiAgICAgIGJsb2IudHlwZVxuICAgICk7XG5cbiAgICAvLyBjb21iaW5lIHRoZSBiYWNrZ3JvdW5kc1xuICAgIHZhciB3aCA9IGZnLmZnLmNhbnYud2lkdGg7XG4gICAgdmFyIG5ld19iZyA9IG1hcGdlbl9jYW52YXMod2gsIHdoKTtcbiAgICBuZXdfYmcuY29udC5kcmF3SW1hZ2UoYmcuZmcuY2Fudiwgd2ggKiAwLjEsIHdoICogMC4xLCB3aCAqIDAuOCwgd2ggKiAwLjgpO1xuICAgIG5ld19iZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLWF0b3BcIjtcbiAgICBuZXdfYmcuY29udC5maWxsU3R5bGUgPSBcInJnYmEoMCwwLDAsMC44KVwiO1xuICAgIG5ld19iZy5jb250LmZpbGxSZWN0KDAsIDAsIHdoLCB3aCk7XG4gICAgbmV3X2JnLmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJub3JtYWxcIjtcbiAgICBuZXdfYmcuY29udC5kcmF3SW1hZ2UoZmcuYmcuY2FudiwgMCwgMCk7XG5cbiAgICAvLyBkcmF3IGl0IHRvIG1haW4gY2FudmFzXG4gICAgdGhpcy5iZy5jb250LmRyYXdJbWFnZShuZXdfYmcuY2FudiwgYmxvYi54IC0gd2ggLyAyLCBibG9iLnkgLSB3aCAvIDIpO1xuICAgIHRoaXMuZmcuY29udC5kcmF3SW1hZ2UoZmcuZmcuY2FudiwgYmxvYi54IC0gd2ggLyAyLCBibG9iLnkgLSB3aCAvIDIpO1xuICB9XG5cbiAgLy8gcmV0dXJuIGl0XG4gIHJldHVybiB7XG4gICAgYmc6IHRoaXMuYmcsXG4gICAgZmc6IHRoaXMuZmdcbiAgfTtcbn07XG5cbi8qIEdldCBhIGZhciBhd2F5IGNpcmNsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbi5wcm90b3R5cGUuZ2V0X2NpcmNsZSA9IGZ1bmN0aW9uKGFyciwgbWluX3JhZGl1cywgbWF4X3JhZGl1cykge1xuICAvLyBnZW5lcmF0ZSBtYW55IGNpcmNsZXMgYW5kIGZpbmQgZnVydGhlc3QgYXdheVxuICB2YXIgZGlzdGFuY2UgPSAwO1xuICB2YXIgY2lyY2xlID0gbnVsbDtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IDIwOyBpKyspIHtcbiAgICAvLyBtYWtlIG5ldyBjaXJjbGVcbiAgICB2YXIgdGVzdF9jaXJjbGUgPSB0aGlzLmNpcmNsZShtaW5fcmFkaXVzLCBtYXhfcmFkaXVzKTtcbiAgICB2YXIgc21hbGxlc3RfZGlzdGFuY2UgPSA5OTk5OTk7XG5cbiAgICAvLyBmaW5kIHNob3J0ZXN0IGRpc3RhbmNlIGZyb20gYWxsIG90aGVyIGNpcmNsZXNcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFyci5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIGR4ID0gYXJyW2pdLnggLSB0ZXN0X2NpcmNsZS54O1xuICAgICAgdmFyIGR5ID0gYXJyW2pdLnkgLSB0ZXN0X2NpcmNsZS55O1xuICAgICAgdmFyIHRlc3RfZGlzdGFuY2UgPSBNYXRoLnJvdW5kKFxuICAgICAgICBNYXRoLnNxcnQoTWF0aC5wb3coZHgsIDIpICsgTWF0aC5wb3coZHksIDIpKVxuICAgICAgKTtcbiAgICAgIHNtYWxsZXN0X2Rpc3RhbmNlID1cbiAgICAgICAgdGVzdF9kaXN0YW5jZSA8IHNtYWxsZXN0X2Rpc3RhbmNlID8gdGVzdF9kaXN0YW5jZSA6IHNtYWxsZXN0X2Rpc3RhbmNlO1xuICAgIH1cblxuICAgIC8vIGlmIGlzIHRoZSBsYXJnZXN0IGRpc3RhbmNlIHJlY29yZCB0aGlzIGFzIGZ1cnRoZXN0XG4gICAgaWYgKGRpc3RhbmNlIDwgc21hbGxlc3RfZGlzdGFuY2UpIHtcbiAgICAgIGRpc3RhbmNlID0gc21hbGxlc3RfZGlzdGFuY2U7XG4gICAgICBjaXJjbGUgPSB0ZXN0X2NpcmNsZTtcbiAgICB9XG4gIH1cblxuICAvLyBhZGQgZnVydGhlc3QgYXdheSBjaXJjbGUgdG8gbmV3IGFycmF5XG4gIGFyci5wdXNoKGNpcmNsZSk7XG4gIHJldHVybiBhcnI7XG59O1xuXG4vKiBHZW5lcmF0ZSBhIHJhbmRvbSBjaXJjbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmNpcmNsZSA9IGZ1bmN0aW9uKG1pbl9yYWRpdXMsIG1heF9yYWRpdXMpIHtcbiAgdmFyIHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhfcmFkaXVzKSArIG1pbl9yYWRpdXM7XG4gIHZhciBnYXAgPSAociArIDIpICogdGhpcy5zaXplICsgdGhpcy5zY2hlbWUuZ2FwO1xuICB2YXIgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLnNjaGVtZS53IC0gZ2FwICogMikpICsgZ2FwO1xuICB2YXIgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLnNjaGVtZS5oIC0gZ2FwICogMikpICsgZ2FwO1xuICByZXR1cm4ge1xuICAgIHI6IHIsXG4gICAgeDogeCxcbiAgICB5OiB5XG4gIH07XG59O1xuIiwidmFyIHNjaGVtZXMgPSBzY2hlbWVzIHx8IHt9O1xuc2NoZW1lcy5kZWF0aG1hdGNoID0ge1xuICB0aXRsZTogXCJEZWF0aG1hdGNoXCIsXG4gIHRpbWVfbGltaXQ6IDAsXG4gIGRlc3Ryb3lfbGFuZDogdHJ1ZSxcbiAgZ3Jhdml0eTogMixcbiAgc2NvcmU6IHRydWUsXG4gIGRyb3BzOiB7XG4gICAgY3JhdGU6IHtcbiAgICAgIHRpbWU6IDEwMCxcbiAgICAgIG1heDogMVxuICAgIH0sXG4gICAgbWVkcGFjazoge1xuICAgICAgdGltZTogMTAwLFxuICAgICAgYWRkOiAzMCxcbiAgICAgIG1heDogMVxuICAgIH0sXG4gICAgXCJnZW0tMVwiOiB7XG4gICAgICB0aW1lOiAxMDAsXG4gICAgICBtYXg6IDVcbiAgICB9LFxuICAgIFwiZ2VtLTVcIjoge1xuICAgICAgdGltZTogMTUwLFxuICAgICAgbWF4OiAxXG4gICAgfSxcbiAgICBcImdlbS0yMFwiOiB7XG4gICAgICB0aW1lOiA1MDAsXG4gICAgICBtYXg6IDFcbiAgICB9XG4gIH0sXG4gIHdlYXBvbnM6IHtcbiAgICBkaWc6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAtMSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgcGhhc2VyOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIGJhem9va29pZDoge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBncmVuYWRlOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bmNoOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bXBraW46IHtcbiAgICAgIHN0YXJ0X2NvdW50OiA1LFxuICAgICAgY3JhdGVfY2hhbmNlOiAxLFxuICAgICAgY3JhdGVfY291bnQ6IDVcbiAgICB9LFxuICAgIHBhaW5naXZlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IDIwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAxLFxuICAgICAgY3JhdGVfY291bnQ6IDVcbiAgICB9XG4gIH0sXG4gIG1hcGdlbjoge1xuICAgIHR5cGU6IFwicmFuZG9tXCIsXG4gICAgc3JjOiBcIlwiLFxuICAgIGdhcDogMjAsXG4gICAgdzogMTkwMCxcbiAgICBoOiAxNDAwLFxuICAgIGJsb2JzOiBbXSxcbiAgICBkZWNvcmF0aW9uczogdHJ1ZSxcbiAgICBzbWFsbF9ibG9iczogNSxcbiAgICBsYXJnZV9ibG9iczogM1xuICB9LFxuICBldmVudHM6IHtcbiAgICBmcmFtZToge30sXG4gICAgY29sbGVjdDoge30sXG4gICAgZGVzdHJveToge30sXG4gICAgdGltZW91dDoge30sXG4gICAgZGVzdHJveV9vYmpfdHlwZToge30sXG4gICAgZGVzdHJveV9vYmpfcGxheWVyOiB7fVxuICB9XG59O1xuIiwidmFyIHNjaGVtZXMgPSBzY2hlbWVzIHx8IHt9O1xuc2NoZW1lcy5kZWZhdWx0ID0ge1xuICB0aXRsZTogXCJcIixcbiAgZGVzY3JpcHRpb246IFwiXCIsXG4gIHRpbWVfbGltaXQ6IDAsXG4gIHNob3dfdGltZTogdHJ1ZSxcbiAgZGVzdHJveV9sYW5kOiB0cnVlLFxuICBncmF2aXR5X3R5cGU6IFwibGFuZFwiLFxuICBncmF2aXR5OiAxLFxuICBzdGFyczoge30sXG4gIHNjb3JlOiBmYWxzZSxcbiAgaGVhbHRoOiB0cnVlLFxuICBsZXZlbHM6IHtcbiAgICBzY29yZTogW1xuICAgICAgMCxcbiAgICAgIDEwLFxuICAgICAgMjUsXG4gICAgICA0MCxcbiAgICAgIDYwLFxuICAgICAgOTAsXG4gICAgICAxMjAsXG4gICAgICAxNTAsXG4gICAgICAyMDAsXG4gICAgICAyNTAsXG4gICAgICAzMDAsXG4gICAgICAzNjAsXG4gICAgICA0MjAsXG4gICAgICA0OTAsXG4gICAgICA1NzAsXG4gICAgICA2NTAsXG4gICAgICA3MjAsXG4gICAgICA4MTAsXG4gICAgICA5MDAsXG4gICAgICAxMDAwXG4gICAgXSxcbiAgICBoZWFsdGg6IFtcbiAgICAgIDEwMCxcbiAgICAgIDEyMCxcbiAgICAgIDEyMCxcbiAgICAgIDEyMCxcbiAgICAgIDE0MCxcbiAgICAgIDE0MCxcbiAgICAgIDE0MCxcbiAgICAgIDE0MCxcbiAgICAgIDE2MCxcbiAgICAgIDE4MCxcbiAgICAgIDIwMCxcbiAgICAgIDIwMCxcbiAgICAgIDIwMCxcbiAgICAgIDIwMCxcbiAgICAgIDIyMCxcbiAgICAgIDIyMCxcbiAgICAgIDIyMCxcbiAgICAgIDIyMCxcbiAgICAgIDI0MCxcbiAgICAgIDMwMFxuICAgIF0sXG4gICAgZGFtYWdlOiBbXG4gICAgICAwLFxuICAgICAgMTAsXG4gICAgICAxMCxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDI1LFxuICAgICAgMjUsXG4gICAgICAyNSxcbiAgICAgIDMwLFxuICAgICAgMzAsXG4gICAgICAzMCxcbiAgICAgIDMwLFxuICAgICAgMzUsXG4gICAgICAzNSxcbiAgICAgIDM1LFxuICAgICAgNTBcbiAgICBdLFxuICAgIHNwZWVkOiBbXG4gICAgICA0LFxuICAgICAgNixcbiAgICAgIDgsXG4gICAgICA4LFxuICAgICAgOCxcbiAgICAgIDgsXG4gICAgICAxMCxcbiAgICAgIDEwLFxuICAgICAgMTAsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDE0LFxuICAgICAgMTQsXG4gICAgICAxNCxcbiAgICAgIDE0LFxuICAgICAgMTYsXG4gICAgICAxNixcbiAgICAgIDIwXG4gICAgXSxcbiAgICBqdW1wOiBbXG4gICAgICAxMCxcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAxOCxcbiAgICAgIDE4LFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDI1XG4gICAgXVxuICB9LFxuICBkcm9wczoge1xuICAgIGNyYXRlOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgbWF4OiAyMFxuICAgIH0sXG4gICAgbWVkcGFjazoge1xuICAgICAgdGltZTogMCxcbiAgICAgIGFkZDogMzAsXG4gICAgICBtYXg6IDUwXG4gICAgfSxcbiAgICBudWNsZWFyOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgbWF4OiAyMFxuICAgIH0sXG4gICAgdGFyZ2V0OiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgbWF4OiAxMDBcbiAgICB9LFxuICAgIGFzdGVyb2lkX2NlbnRlcjoge1xuICAgICAgdGltZTogMCxcbiAgICAgIGluY3JlYXNlX2ZyZXF1ZW5jeTogZmFsc2UsXG4gICAgICBtYXg6IDMwXG4gICAgfSxcbiAgICBcImdlbS0xXCI6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDIwXG4gICAgfVxuICB9LFxuICB3ZWFwb25zOiB7XG4gICAgZGlnOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHBoYXNlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIGJhem9va29pZDoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIGdyZW5hZGU6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBwdW5jaDoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bXBraW46IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IDFcbiAgICB9LFxuICAgIHBhaW5naXZlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogMTBcbiAgICB9XG4gIH0sXG4gIGFybW91cnk6IFtcbiAgICBcImRpZ1wiLFxuICAgIFwicGhhc2VyXCIsXG4gICAgXCJiYXpvb2tvaWRcIixcbiAgICBcImdyZW5hZGVcIixcbiAgICBcInB1bmNoXCIsXG4gICAgXCJwdW1wa2luXCIsXG4gICAgXCJwYWluZ2l2ZXJcIlxuICBdLFxuICBhcnJvd3M6IHtcbiAgICBudWNsZWFyOiBcImdyZWVuXCIsXG4gICAgcGxheWVyOiBcInJlZFwiLFxuICAgIHRhcmdldDogXCJibHVlXCIsXG4gICAgXCJhc3Rlcm9pZC1zbWFsbFwiOiBcImdyZXlcIixcbiAgICBcImFzdGVyb2lkLWxhcmdlXCI6IFwiZ3JleVwiLFxuICAgIHZvcnRleDogXCJwdXJwbGVcIixcbiAgICBjcmF0ZTogXCJibHVlXCJcbiAgfSxcbiAgc3Bhd246IFtdLFxuICBtYXBnZW46IHtcbiAgICB0eXBlOiBcInJhbmRvbVwiLFxuICAgIHNyYzogXCJcIixcbiAgICBnYXA6IDIwLFxuICAgIHc6IDEwMDAsXG4gICAgaDogMTAwMCxcbiAgICBibG9iczogW10sXG4gICAgZGVjb3JhdGlvbnM6IHRydWUsXG4gICAgc21hbGxfYmxvYnM6IDUsXG4gICAgbGFyZ2VfYmxvYnM6IDNcbiAgfSxcbiAgZXZlbnRzOiB7XG4gICAgZnJhbWU6IHt9LFxuICAgIGNvbGxlY3Q6IHt9LFxuICAgIGRlc3Ryb3k6IHt9LFxuICAgIHRpbWVvdXQ6IHt9LFxuICAgIGRlc3Ryb3lfb2JqX3R5cGU6IHt9LFxuICAgIGRlc3Ryb3lfb2JqX3BsYXllcjoge31cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR3Jhdml0eVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBncmF2aXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5pbml0X2dyYXZpdHkgPSBmdW5jdGlvbihncmF2aXR5X21hcCkge1xuICB0aGlzLndlaWdodCA9IHRoaXMuc2NoZW1lLmdyYXZpdHkgfHwgMTtcbiAgdGhpcy5ncmF2aXR5X3R5cGUgPSB0aGlzLnNjaGVtZS5ncmF2aXR5X3R5cGUgfHwgXCJsYW5kXCI7XG5cbiAgaWYgKHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSAhPT0gXCJsYW5kXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZXQgdmFsdWVzXG4gIHRoaXMuZ3Jhdml0eSA9IHtcbiAgICB3OiAwLFxuICAgIGg6IDAsXG4gICAgbWFwOiBbXSxcbiAgICBzY2FsZTogMjQsXG4gICAgcmVhY2g6IDE4XG4gIH07XG5cbiAgaWYgKGdyYXZpdHlfbWFwKSB7XG4gICAgdGhpcy5ncmF2aXR5Lm1hcCA9IEpTT04ucGFyc2UoZ3Jhdml0eV9tYXApO1xuICAgIHRoaXMuZ3Jhdml0eS53ID0gdGhpcy5ncmF2aXR5Lm1hcFswXS5sZW5ndGg7XG4gICAgdGhpcy5ncmF2aXR5LmggPSB0aGlzLmdyYXZpdHkubWFwLmxlbmd0aDtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmluaXRfZ3Jhdml0eV9tYXAoKTtcbiAgfVxufTtcblxuLyogR2VuZXJhdGUgZ3Jhdml0eSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuaW5pdF9ncmF2aXR5X21hcCA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZXQgc2l6ZSBvZiBuZXcgZ3Jhdml0eSBncmlkXG4gIHRoaXMuZ3Jhdml0eS53ID0gY2VpbCh0aGlzLncgLyB0aGlzLmdyYXZpdHkuc2NhbGUpO1xuICB0aGlzLmdyYXZpdHkuaCA9IGNlaWwodGhpcy5oIC8gdGhpcy5ncmF2aXR5LnNjYWxlKTtcblxuICAvLyBnZW5lcmF0ZSBtYXAgYXJyYXlcbiAgdmFyIG5ld19hcnIgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmdyYXZpdHkuaDsgeSsrKSB7XG4gICAgdGhpcy5ncmF2aXR5Lm1hcFt5XSA9IFtdO1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5ncmF2aXR5Lnc7IHgrKykge1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5XS5wdXNoKFswLCAwLCAwXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGhlIGNhbGN1bGF0aW5nXG4gIHRoaXMuYWN0aW9uX2dyYXZpdHlfZ2VuZXJhdGUoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xufTtcblxuLyogQXBwbHkgbmV3IGdyYXZpdHkgY2FsY3VsYXRpb25zIHRvIGEgc2V0IG9mIHBpeGVsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSA9IGZ1bmN0aW9uKHgsIHksIHcsIGgpIHtcbiAgLy8gY2FsY3VsYXRlIHdoaWNoIHRpbGVzIGFyZSBhZmZlY3RlZFxuICB2YXIgeDEgPSBtYXgoMCwgbWluKGZsb29yKHggLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTEgPSBtYXgoMCwgbWluKGZsb29yKHkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKGZsb29yKCh4ICsgdykgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTIgPSBtYXgoMCwgbWluKGZsb29yKCh5ICsgaCkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCkpO1xuXG4gIC8vIGdldCB0aGUgd2VpZ2h0IG9mIGFsbCBhZmZlY3RlZCB0aWxlc1xuICBmb3IgKHZhciB5MyA9IHkxOyB5MyA8IHkyOyB5MysrKSB7XG4gICAgZm9yICh2YXIgeDMgPSB4MTsgeDMgPCB4MjsgeDMrKykge1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdID0gdGhpcy5nZXRfdGlsZV93ZWlnaHQoeDMsIHkzKTtcbiAgICB9XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgc3Vycm91bmRpbmcgdGlsZXNcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4MSAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5MSAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcbiAgdmFyIHgyID0gbWF4KDAsIG1pbih4MiArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5MiArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcblxuICAvLyBnbyB0aHJvdWdoIHN1cnJvdW5kaW5nIHRpbGVzIHRvIGdldCBncmF2aXR5XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB2YXIgeHkgPSB0aGlzLmdldF90aWxlX2dyYXZpdHkoeDMsIHkzKTtcbiAgICAgIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVsxXSA9IHh5Lng7XG4gICAgICB0aGlzLmdyYXZpdHkubWFwW3kzXVt4M11bMl0gPSB4eS55O1xuICAgIH1cbiAgfVxufTtcblxuLyogR2V0IHdlaWdodCBvZiBhIHRpbGUgaW4gdGhlIGdyYXZpdHkgbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF90aWxlX3dlaWdodCA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gbGltaXQgeCBhbmQgeSB0byB3aXRoaW4gdGhlIGFyZWFcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5ICogdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLmgpKTtcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4ICogdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5ICogdGhpcy5ncmF2aXR5LnNjYWxlICsgdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLmgpKTtcbiAgdmFyIHgyID0gbWF4KDAsIG1pbih4ICogdGhpcy5ncmF2aXR5LnNjYWxlICsgdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLncpKTtcblxuICAvLyBnbyB0aHJvdWdoIHRoZSBncmlkIG9mIHBpeGVsc1xuICB2YXIgYyA9IDA7XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB2YXIgaWQgPSB0aGlzLmkoeDMsIHkzKTtcbiAgICAgIGlmIChpZCA9PSAxIHx8IGlkID09IDIpIHtcbiAgICAgICAgYyArPSAxO1xuICAgICAgfVxuICAgICAgaWYgKGlkID09IDMpIHtcbiAgICAgICAgYyArPSAzO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYztcbn07XG5cbi8qIEdldCBncmF2aXR5IG9mIGEgdGlsZSBmcm9tIHRoZSB3ZWlnaHQgb2Ygc3Vycm91bmRpbmcgdGlsZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X3RpbGVfZ3Jhdml0eSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gY2FsY3VsYXRlIHN1cnJvdW5kaW5nIHRpbGVzXG4gIHZhciB3eCA9IDA7XG4gIHZhciB3eSA9IDA7XG4gIHZhciB4MSA9IG1heCgwLCBtaW4oeCAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5IC0gdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKHggKyB0aGlzLmdyYXZpdHkucmVhY2gsIHRoaXMuZ3Jhdml0eS53KSk7XG4gIHZhciB5MiA9IG1heCgwLCBtaW4oeSArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcblxuICAvLyBnbyB0aHJvdWdoIHN1cnJvdW5kaW5nIHRpbGVzIHRvIGdldCBncmF2aXR5XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB3eCArPSAoeDMgLSB4KSAqIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVswXTtcbiAgICAgIHd5ICs9ICh5MyAtIHkpICogdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdO1xuICAgIH1cbiAgfVxuXG4gIHd4ID0gcm91bmQod3ggLyA1MDAwIC8gdGhpcy5ncmF2aXR5LnJlYWNoKSAvIDYwO1xuICB3eSA9IHJvdW5kKHd5IC8gNTAwMCAvIHRoaXMuZ3Jhdml0eS5yZWFjaCkgLyA2MDtcblxuICByZXR1cm4ge1xuICAgIHg6IHd4LFxuICAgIHk6IHd5XG4gIH07XG59O1xuXG4vKiBSZXNldCBncmF2aXR5IGZyb20gZGVzdHJ1Y3Rpb24gZXZlbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3Jhdml0eV9ldmVudF9yZWNhbGN1bGF0ZSA9IGZ1bmN0aW9uKHgsIHksIHJhZGl1cykge1xuICAvLyBpZiB3ZSBhcmUgbm90IHVzaW5nIGxhbmQgZ3Jhdml0eVxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlICE9PSBcImxhbmRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJlY2FsY3VsYXRlIGdyYXZpdHlcbiAgdmFyIHgxID0gcm91bmQoeCAtIHJhZGl1cyk7XG4gIHZhciB5MSA9IHJvdW5kKHkgLSByYWRpdXMpO1xuICB2YXIgc2l6ZSA9IHJvdW5kKHJhZGl1cyAqIDIgKyAxKTtcbiAgdGhpcy5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSh4MSwgeTEsIHNpemUsIHNpemUpO1xufTtcblxuLyogUmV0dXJuIGdyYXZpdHkgZm9yIGNvLW9yZGluYXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZ3Jhdml0eSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gZmxhdFxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlID09PSBcImZsYXRcIikge1xuICAgIHJldHVybiB7IHg6IDAsIHk6IHRoaXMud2VpZ2h0IH07XG4gIH1cblxuICAvLyBtYXBcbiAgaWYgKHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSA9PT0gXCJsYW5kXCIpIHtcbiAgICB2YXIgeDEgPSBtYXgoMCwgbWluKHJvdW5kKHggLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudyAtIDEpKTtcbiAgICB2YXIgeTEgPSBtYXgoMCwgbWluKHJvdW5kKHkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCAtIDEpKTtcbiAgICB2YXIgb2JqID0gdGhpcy5ncmF2aXR5Lm1hcFt5MV1beDFdO1xuICAgIHJldHVybiB7XG4gICAgICB4OiBtaW4ob2JqWzFdLCAxKSAqIHRoaXMud2VpZ2h0LFxuICAgICAgeTogbWluKG9ialsyXSwgMSkgKiB0aGlzLndlaWdodFxuICAgIH07XG4gIH1cbn07XG5cbi8qIFJldHVybiB0aGUgYW5nbGUgb2YgZ3Jhdml0eSBmb3IgY28tb3JkaW5hdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9ncmF2aXR5X2FuZ2xlID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgZ3JhdiA9IHRoaXMuZ2V0X2dyYXZpdHkoeCwgeSk7XG4gIHZhciBhMSA9IGdldF9hbmdsZShncmF2LngsIGdyYXYueSk7XG4gIHJldHVybiBhMTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0TWFwIEdyb3VuZCBDaGVja2Vyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEdldCBhcnJheSBvZiBvZmZzZXRzIHRvIGNoZWNrIGluIGFuIGFuZ2xlcyBkaXJlY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2FuZ2xlX29mZnNldHMgPSBmdW5jdGlvbihhKSB7XG4gIGlmIChhID4gMjIgJiYgYSA8PSA2Nykge1xuICAgIHJldHVybiBbWy0xLCAtMV0sIFswLCAtMV0sIFstMSwgMF0sIFsxLCAtMV0sIFstMSwgMV0sIFsxLCAwXSwgWzAsIDFdXTtcbiAgfSAvLyB1cCBsZWZ0XG4gIGlmIChhID4gNjcgJiYgYSA8PSAxMTIpIHtcbiAgICByZXR1cm4gW1swLCAtMV0sIFstMSwgLTFdLCBbMSwgLTFdLCBbLTEsIDBdLCBbMSwgMF0sIFstMSwgMV0sIFsxLCAxXV07XG4gIH0gLy8gdXBcbiAgaWYgKGEgPiAxMTIgJiYgYSA8PSAxNTcpIHtcbiAgICByZXR1cm4gW1sxLCAtMV0sIFswLCAtMV0sIFsxLCAwXSwgWy0xLCAtMV0sIFsxLCAxXSwgWy0xLCAwXSwgWzAsIDFdXTtcbiAgfSAvLyB1cCByaWdodFxuICBpZiAoYSA+IDE1NyAmJiBhIDw9IDIwMikge1xuICAgIHJldHVybiBbWzEsIDBdLCBbMSwgLTFdLCBbMSwgMV0sIFswLCAtMV0sIFswLCAxXSwgWy0xLCAtMV0sIFstMSwgMV1dO1xuICB9IC8vIHJpZ2h0XG4gIGlmIChhID4gMjAyICYmIGEgPD0gMjQ3KSB7XG4gICAgcmV0dXJuIFtbMSwgMV0sIFsxLCAwXSwgWzAsIDFdLCBbMSwgLTFdLCBbLTEsIDFdLCBbMCwgLTFdLCBbLTEsIDBdXTtcbiAgfSAvLyBkb3duIHJpZ2h0XG4gIGlmIChhID4gMjQ3ICYmIGEgPD0gMjkyKSB7XG4gICAgcmV0dXJuIFtbMCwgMV0sIFstMSwgMV0sIFsxLCAxXSwgWy0xLCAwXSwgWzEsIDBdLCBbLTEsIC0xXSwgWzEsIC0xXV07XG4gIH0gLy8gZG93blxuICBpZiAoYSA+IDI5MiAmJiBhIDw9IDMzNykge1xuICAgIHJldHVybiBbWy0xLCAxXSwgWy0xLCAwXSwgWzAsIDFdLCBbLTEsIC0xXSwgWzEsIDFdLCBbMCwgLTFdLCBbMSwgMF1dO1xuICB9IC8vIGRvd24gbGVmdFxuICBpZiAoYSA+IDMzNyB8fCBhIDw9IDIyKSB7XG4gICAgcmV0dXJuIFtbLTEsIDBdLCBbLTEsIC0xXSwgWy0xLCAxXSwgWzAsIC0xXSwgWzAsIDFdLCBbMSwgLTFdLCBbMSwgMV1dO1xuICB9IC8vIGxlZnRcbn07XG5cbi8qIENhbGN1bGF0ZSB3YWxrIHBhdGggYnkgYW5nbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUud2FsayA9IGZ1bmN0aW9uKHgsIHksIHB4LCBweSwgYW5nbGUsIHNwZWVkKSB7XG4gIC8vIGdldCBuZWlnaGJvcmluZyBwaXhlbHNcbiAgdmFyIG9mZnNldHMgPSB0aGlzLmdldF9hbmdsZV9vZmZzZXRzKGFuZ2xlKTtcblxuICAvLyByZWNvcmQgb2xkIHBvc2l0aW9uXG4gIHZhciBveCA9IHg7XG4gIHZhciBveSA9IHk7XG5cbiAgLy8gcmVjb3JkIHJlc3VsdFxuICB2YXIgcmVzdWx0ID0ge1xuICAgIG1vdmU6IGZhbHNlLCAvLyB3ZSBhcmUgbW92aW5nXG4gICAgYW5nbGU6IDAsIC8vIGFjdHVhbCBhbmdsZSBvZiBtb3ZlbWVudFxuICAgIHBhdGg6IFtdIC8vIHJlY29yZGVkIGNvb3JkaW5hdGVzXG4gIH07XG5cbiAgLy8gZ28gdGhyb3VnaCBudW1iZXIgb2YgbW92ZW1lbnRzIHBlciBmcmFtZVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWVkOyBpKyspIHtcbiAgICB2YXIgbW92ZWQgPSBmYWxzZTtcblxuICAgIC8vIGdvIHRocm91Z2ggZGlyZWN0aW9uYWwgcGl4ZWxzIHRvIGNoZWNrIGJhc2VkIG9uIGFuZ2xlIG9mIHBhdGhcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9mZnNldHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIC8vIGNvLW9yZGluYXRlcyB3ZSdyZSBjaGVja2luZ1xuICAgICAgdmFyIHgxID0geCArIG9mZnNldHNbal1bMF07XG4gICAgICB2YXIgeTEgPSB5ICsgb2Zmc2V0c1tqXVsxXTtcblxuICAgICAgLy8gaWYgaXMgcHJldmlvdXMgbG9jYXRpb24sIGxhbmQgb3Igbm90IGFuIGVkZ2VcbiAgICAgIGlmICgoeDEgPT0gcHggJiYgeTEgPT0gcHkpIHx8ICF0aGlzLmdyb3VuZF9waXhlbCh4MSwgeTEpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBzZXQgbmV3IHBvc2l0aW9uXG4gICAgICBweCA9IHg7XG4gICAgICBweSA9IHk7XG4gICAgICB4ID0geDE7XG4gICAgICB5ID0geTE7XG4gICAgICByZXN1bHQubW92ZSA9IHRydWU7XG4gICAgICByZXN1bHQuYW5nbGUgPSBnZXRfaGVhZGluZyhveCwgb3ksIHgsIHkpO1xuICAgICAgcmVzdWx0LnBhdGgucHVzaCh7IHg6IHgxLCB5OiB5MSB9KTtcblxuICAgICAgdmFyIG1vdmVkID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIGlmIG1vdmVtZW50IGZhaWxlZFxuICAgIGlmICghbW92ZWQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCBkaXJlY3Rpb24gbGVmdCBvciByaWdodFxuICByZXN1bHQuZGlyZWN0aW9uID0gdGhpcy5ncm91bmRfZGlyKG94LCBveSwgeCwgeSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8qIENoZWNrIGEgcGl4ZWwgaXMgbmV4dCB0byBncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3JvdW5kX3BpeGVsID0gZnVuY3Rpb24oeCwgeSkge1xuICAvLyBpZiB3ZSBoYXZlIGhpdCBncm91bmRcbiAgaWYgKHRoaXMuaSh4LCB5KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciB0cmlnZ2VyID0gZmFsc2UsXG4gICAgb2ZmID0gW1xuICAgICAgWzAsIC0xXSxcbiAgICAgIFstMSwgMF0sXG4gICAgICBbMSwgMF0sXG4gICAgICBbMCwgMV0sXG4gICAgICBbLTEsIC0xXSxcbiAgICAgIFstMSwgMV0sXG4gICAgICBbMSwgMV0sXG4gICAgICBbMSwgLTFdXG4gICAgXTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IG9mZi5sZW5ndGg7IGkrKykge1xuICAgIC8vIGdvIHRocm91Z2ggb2Zmc2V0c1xuICAgIHZhciB4MSA9IHggKyBvZmZbaV1bMF07IC8vIG5ldyB4IGNvb3JkaW5hdGVcbiAgICB2YXIgeTEgPSB5ICsgb2ZmW2ldWzFdOyAvLyBuZXcgeSBjb29yZGluYXRlXG4gICAgaWYgKHRoaXMuaSh4MSwgeTEpKSB7XG4gICAgICAvLyBpZiBwaXhlbCBpcyBsYW5kXG4gICAgICB0cmlnZ2VyID0gdHJ1ZTsgLy8gd2UgZGlkIGl0XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJpZ2dlcjtcbn07XG5cbi8qIENhbGN1bGF0ZSBsZWZ0IG9yIHJpZ2h0IG1vdmVtZW50XG5cdC8vXG5cdC8vIGNhbGN1bGF0ZXMgZGlyZWN0aW9uIG9mIGxhbmQgZnJvbSBhIGxpbmUgb2YgbW92ZW1lbnRcblx0Ly8gMS4gcm90YXRlIGxpbmUgY29vcmRzIDkwIGRlZ3JlZXNcblx0Ly8gMi4gaWYgdGhlIHRvcCBwYXJ0IG9mIHRoZSBuZXcgbGluZSBoYXMgbW9yZSBsYW5kIHRoZW4gd2UgYXJlIG1vdmluZyByaWdodFxuXHQvLyAzLiBpZiB0aGUgYm90dG9tIHBhcnQgd2UgYXJlIG1vdmluZyBsZWZ0XG5cdC8vIDQuIGJhbmFuYXMsIGFsbCBvZiBpdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5ncm91bmRfZGlyID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcbiAgLy8gcm90YXRlIGNvLW9yZGluYXRlZCA5MCBkZWdyZWVzIHRvIHBvaW50IGludG8gdGhlIGdyb3VuZCB3ZSdyZSBvblxuICB2YXIgY2VudGVyX3ggPSB4MSArICh4MiAtIHgxKSAvIDI7XG4gIHZhciBjZW50ZXJfeSA9IHkxICsgKHkyIC0geTEpIC8gMjtcbiAgdmFyIHJvdGF0ZWRfMSA9IHJvdGF0ZV9jb29yZHMoeDEsIHkxLCBjZW50ZXJfeCwgY2VudGVyX3ksIDkwKTtcbiAgdmFyIHJvdGF0ZWRfMiA9IHJvdGF0ZV9jb29yZHMoeDIsIHkyLCBjZW50ZXJfeCwgY2VudGVyX3ksIDkwKTtcblxuICAvLyBwbG90IGEgY291cnNlIG9mIGNvLW9yZGluYXRlcyB0byBjaGVja1xuICB2YXIgc3BlZWRfeCA9IHRoaXMuZ2V0X2Rpc3RhbmNlX3gocm90YXRlZF8xLngsIHJvdGF0ZWRfMi54KTtcbiAgdmFyIHNwZWVkX3kgPSB0aGlzLmdldF9kaXN0YW5jZV95KHJvdGF0ZWRfMS55LCByb3RhdGVkXzIueSk7XG4gIHZhciBwbG90dGVkID0gcGxvdF9jb3Vyc2Uocm90YXRlZF8xLngsIHJvdGF0ZWRfMS55LCBzcGVlZF94LCBzcGVlZF95LCA4KTtcbiAgaWYgKCFwbG90dGVkLm1vdmUpIHtcbiAgICByZXR1cm4gXCJyaWdodFwiO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBjb3Vyc2UgYW5kIGNvdW50IHdoaWNoIHNpZGUgaGFzIG1vcmUgbGFuZCBvbiBpdFxuICB2YXIgY291bnRfbGVmdCA9IDAsXG4gICAgY291bnRfcmlnaHQgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsb3R0ZWQucG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHBvaW50ID0gcGxvdHRlZC5wb2ludHNbaV07XG4gICAgaWYgKHRoaXMuaShyb3VuZChwb2ludC54KSwgcm91bmQocG9pbnQueSkpKSB7XG4gICAgICBpZiAoaSA8IHBsb3R0ZWQucG9pbnRzLmxlbmd0aCAvIDIpIHtcbiAgICAgICAgY291bnRfcmlnaHQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvdW50X2xlZnQrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvdW50X2xlZnQgPiBjb3VudF9yaWdodCA/IFwibGVmdFwiIDogXCJyaWdodFwiO1xufTtcblxuLyogU2V0IHZhbHVlcyBpbiBhIGNpcmNsZSBpbiB0aGUgZ3JvdW5kIGFycmF5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLnNldF9jaXJjbGUgPSBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHR5cGUpIHtcbiAgLy8gZ2V0IGJvdW5kYXJpZXNcbiAgdmFyIHgxID0gbWF4KHJvdW5kKHggLSByYWRpdXMpLCAwKTtcbiAgdmFyIHgyID0gbWluKHJvdW5kKHggKyByYWRpdXMpLCB0aGlzLncgLSAxKTtcbiAgdmFyIHkxID0gbWF4KHJvdW5kKHkgLSByYWRpdXMpLCAwKTtcbiAgdmFyIHkyID0gbWluKHJvdW5kKHkgKyByYWRpdXMpLCB0aGlzLmggLSAxKTtcblxuICAvLyBsb29wIHRocm91Z2ggY28tb3JkaW5hdGVzXG4gIGZvciAodmFyIGx5ID0geTE7IGx5IDw9IHkyOyBseSsrKSB7XG4gICAgZm9yICh2YXIgbHggPSB4MTsgbHggPD0geDI7IGx4KyspIHtcbiAgICAgIGlmIChpbl9jaXJjbGUobHgsIGx5LCB4LCB5LCByYWRpdXMpKSB7XG4gICAgICAgIHRoaXMuaV9zZXQobHgsIGx5LCB0eXBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFNldCBibG9jayBvZiBjZWxscyBmcm9tIGFyclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5zZXRfYmxvY2tfZnJvbV9hcnIgPSBmdW5jdGlvbih4LCB5LCBhcnIpIHtcbiAgZm9yICh2YXIgbHkgPSAwOyBseSA8IGFyci5sZW5ndGg7IGx5KyspIHtcbiAgICBmb3IgKHZhciBseCA9IDA7IGx4IDwgYXJyW2x5XS5sZW5ndGg7IGx4KyspIHtcbiAgICAgIHRoaXMuaV9zZXQoeCArIGx4LCB5ICsgbHksIGFycltseV1bbHhdKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIEdldCBibG9jayBvZiBjZWxsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfYmxvY2sgPSBmdW5jdGlvbih4LCB5LCB3LCBoKSB7XG4gIHZhciByZXNwb25zZSA9IFtdO1xuXG4gIC8vIGxvb3AgdGhyb3VnaCBjby1vcmRpbmF0ZXNcbiAgZm9yICh2YXIgbHkgPSAwOyBseSA8IGg7IGx5KyspIHtcbiAgICByZXNwb25zZVtseV0gPSBbXTtcbiAgICBmb3IgKHZhciBseCA9IDA7IGx4IDwgdzsgbHgrKykge1xuICAgICAgcmVzcG9uc2VbbHldW2x4XSA9IHRoaXMuaShseCArIHgsIGx5ICsgeSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogRmluZCBuZWFyYnkgZ3JvdW5kIHNwb3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZmluZF9ncm91bmRfbmVhcmJ5ID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgeDEgPSByb3VuZCh4KTtcbiAgdmFyIHkxID0gcm91bmQoeSk7XG5cbiAgLy8gYWxyZWFkeSBvbiBncm91bmRcbiAgaWYgKHRoaXMuZ3JvdW5kX3BpeGVsKHgxLCB5MSkpIHtcbiAgICByZXR1cm4geyB4OiB4MSwgeTogeTEgfTtcbiAgfVxuXG4gIHZhciBzcGlyYWxfMSA9IDA7XG4gIHZhciBzcGlyYWxfMiA9IDE7XG4gIHZhciBpbmMgPSAxO1xuICB2YXIgZGlyID0gdHJ1ZTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IDQ1MDsgaSsrKSB7XG4gICAgeDEgKz0gZGlyID8gaW5jIDogMDtcbiAgICB5MSArPSAhZGlyID8gaW5jIDogMDtcbiAgICBzcGlyYWxfMSsrO1xuICAgIGlmIChzcGlyYWxfMSA9PSBzcGlyYWxfMikge1xuICAgICAgc3BpcmFsXzEgPSAwO1xuICAgICAgaWYgKChkaXIgPSAhZGlyKSkge1xuICAgICAgICBpbmMgPSBpbmMgPT0gMSA/IC0xIDogMTtcbiAgICAgICAgc3BpcmFsXzIrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjaGVjayBwb2ludCBmb3IgZ3JvdW5kIHBpeGVsc1xuICAgIGlmICh0aGlzLmdyb3VuZF9waXhlbCh4MSwgeTEpKSB7XG4gICAgICByZXR1cm4geyB4OiB4MSwgeTogeTEgfTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyogR2V0IHJhbmRvbSBlbXB0eSBzcG90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmFpcl9maW5kX3Nwb3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGxpbWl0ID0gNTAwO1xuICB2YXIgbiA9IDA7XG5cbiAgd2hpbGUgKG4gPCBsaW1pdCkge1xuICAgIHZhciB4ID0gcmFuZCgwLCB0aGlzLncpLFxuICAgICAgeSA9IHJhbmQoMCwgdGhpcy5oKSxcbiAgICAgIGlkID0gdGhpcy5pKHgsIHkpO1xuXG4gICAgLy8gaWYgYWlyIHBpeGVsXG4gICAgaWYgKGlkID09IDApIHtcbiAgICAgIHJldHVybiB7IHg6IHgsIHk6IHkgfTtcbiAgICB9XG5cbiAgICAvLyBjb3VudCB1cFxuICAgIG4rKztcbiAgfVxuXG4gIC8vIGZhaWxlZCB0byBmaW5kIGEgc3BvdFxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBHZXQgcmFuZG9tIGdyb3VuZCBzcG90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdyb3VuZF9maW5kX3Nwb3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGxpbWl0ID0gNTAwO1xuICB2YXIgbiA9IDA7XG5cbiAgd2hpbGUgKG4gPCBsaW1pdCkge1xuICAgIHZhciB4ID0gcmFuZCgwLCB0aGlzLncpLFxuICAgICAgeSA9IHJhbmQoMCwgdGhpcy5oKSxcbiAgICAgIGlkID0gdGhpcy5pKHgsIHkpO1xuXG4gICAgLy8gaWYgbm90IGxhbmQgcGl4ZWxcbiAgICBpZiAoaWQgIT09IDEgJiYgaWQgIT09IDIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIHBsb3QgY291cnNlIHRvIHJhbmRvbSBhbmdsZVxuICAgIHZhciBhbmdsZSA9IHJhbmQoMCwgMzYwKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7fVxuXG4gICAgLy8gY291bnQgdXBcbiAgICBuKys7XG4gIH1cblxuICAvLyBmYWlsZWQgdG8gZmluZCBhIHNwb3RcbiAgcmV0dXJuIGZhbHNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1hcFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8vIGNyZWF0ZSBtYXAgb2JqZWN0XG5mdW5jdGlvbiBjb3JlX21hcChjYW52LCBzY2hlbWUsIGdyYXZpdHlfbWFwKSB7XG4gIC8vIFNlcnZlciBzaWRlIG9ubHlcbiAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICAgIHZhciBjYW52YXMgPSByZXF1aXJlKFwiY2FudmFzXCIpO1xuICB9XG5cbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG5cbiAgLy8gc2V0IGRpbWVuc2lvbnNcbiAgdGhpcy53ID0gY2Fudi5jYW52LndpZHRoO1xuICB0aGlzLmggPSBjYW52LmNhbnYuaGVpZ2h0O1xuXG4gIC8vIGdldCBwaXhlbHNcbiAgdmFyIHBpeGVscyA9IGNhbnYuY29udC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xuICB2YXIgbGVuZ3RoID0gTWF0aC5mbG9vcihwaXhlbHMuZGF0YS5sZW5ndGggLyA0KTtcblxuICAvLyBjcmVhdGUgOCBiaXQgYWxwaGEgYXJyYXlcbiAgLy8gMC4gYWlyXG4gIC8vIDEuIGRlc3RydWN0aWJsZSBsYW5kXG4gIC8vIDIuIGluZGVzdHJ1Y3RpYmxlIGxhbmRcbiAgLy8gMy4gc3VuXG4gIHRoaXMuYXJyID0gbmV3IEludDhBcnJheShsZW5ndGgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHBpeGVscy5kYXRhW2kgKiA0ICsgM10gPiAzMCkge1xuICAgICAgdGhpcy5hcnJbaV0gPSAxO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCB1cCBncmF2aXR5XG4gIHRoaXMuaW5pdF9ncmF2aXR5KGdyYXZpdHlfbWFwKTtcbn1cblxuLyogR2V0IGFuZCBzZXQgYXJyYXkgY28tb3JkaW5hdGUgdmFsdWVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmlfZ2V0ID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgeDIgPSB0aGlzLmxvb3BfeCh4KTtcbiAgdmFyIHkyID0gdGhpcy5sb29wX3koeSk7XG4gIHJldHVybiB5MiAqIHRoaXMudyArIHgyO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmkgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciBpID0gdGhpcy5pX2dldCh4LCB5KTtcbiAgaWYgKGkgPT0gbnVsbCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLmFycltpXTtcbiAgfVxufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmlfc2V0ID0gZnVuY3Rpb24oeCwgeSwgdmFsKSB7XG4gIHZhciBpID0gdGhpcy5pX2dldCh4LCB5KTtcbiAgaWYgKGkpIHtcbiAgICB0aGlzLmFycltpXSA9IHZhbDtcbiAgfVxufTtcblxuLyogR2V0IGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cyBpbiBsb29waW5nIGFyZWFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2Rpc3RhbmNlID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcbiAgdmFyIHggPSB0aGlzLmdldF9kaXN0YW5jZV94KHgxLCB4Mik7XG4gIHZhciB5ID0gdGhpcy5nZXRfZGlzdGFuY2VfeSh5MSwgeTIpO1xuICByZXR1cm4gZ2V0X3NwZWVkKHgsIHkpO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9kaXN0YW5jZV94ID0gZnVuY3Rpb24oeDEsIHgyKSB7XG4gIHJldHVybiBuX2RpZmYoeDEsIHgyLCAwLCB0aGlzLncpO1xufTtcbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZGlzdGFuY2VfeSA9IGZ1bmN0aW9uKHkxLCB5Mikge1xuICByZXR1cm4gbl9kaWZmKHkxLCB5MiwgMCwgdGhpcy5oKTtcbn07XG5cbi8qIEdldCBoZWFkaW5nIGJldHdlZW4gdHdvIHBvaW50cyBpbiBsb29waW5nIGFyZWFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2hlYWRpbmcgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5Mikge1xuICB2YXIgeCA9IG5fZGlmZih4MSwgeDIsIDAsIHRoaXMudyk7XG4gIHZhciB5ID0gbl9kaWZmKHkxLCB5MiwgMCwgdGhpcy5oKTtcbiAgcmV0dXJuIGdldF9hbmdsZSh4LCB5KTtcbn07XG5cbi8qIEdldCBsb29waW5nIGNvLW9yZGluYXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmxvb3BfeCA9IGZ1bmN0aW9uKHgpIHtcbiAgcmV0dXJuIG5fbG9vcCh4LCAwLCB0aGlzLncgLSAxKTtcbn07XG5cbmNvcmVfbWFwLnByb3RvdHlwZS5sb29wX3kgPSBmdW5jdGlvbih5KSB7XG4gIHJldHVybiBuX2xvb3AoeSwgMCwgdGhpcy5oIC0gMSk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuY29uc3QgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24pO1xuY29uc3Qgd2F0Y2ggPSAhIXVybC5zZWFyY2hQYXJhbXMuZ2V0KFwid2F0Y2hcIik7XG5cbmZ1bmN0aW9uIGFwcCgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmFzc2V0c191cmwgPSBBU1NFVFM7XG4gIHRoaXMuYXNzZXRzID0ge307XG4gIHRoaXMuc3RhcnRlZCA9IGZhbHNlO1xuICB0aGlzLndhdGNoID0gd2F0Y2g7XG4gIHRoaXMubmlja25hbWUgPSBcInRoZSB3YXRjaGVyXCI7XG5cbiAgdGhpcy5zb2NrZXRzID0gbmV3IFNvY2tldENvbm5lY3Rpb24oZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBzZWxmLnJ1bl9ldmVudChldmVudCk7XG4gIH0pO1xuICB0aGlzLmluaXRfaW50ZXJmYWNlKCk7XG5cbiAgdGhpcy5pbnB1dCA9IG5ldyBpbnB1dChmdW5jdGlvbihldmVudCkge1xuICAgIHNlbGYucnVuX2V2ZW50KGV2ZW50KTtcbiAgfSk7XG4gIHRoaXMuYXVkaW8gPSBuZXcgYXVkaW8oKTtcblxuICB0aGlzLmluaXRfc2V0dGluZ3MoKTtcblxuICBpZiAodGhpcy53YXRjaCB8fCBzaW5nbGVQbGF5ZXIpIHtcbiAgICB0aGlzLmxvYWRfcm9vbSgpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuaW5pdF9zdGFydCgpO1xuICB9XG59XG5cbi8qIExvYWQgcm9vbVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXBwLnByb3RvdHlwZS5sb2FkX3Jvb20gPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuc3RhcnQpIHtcbiAgICBoaWRlKHRoaXMuc3RhcnQpO1xuICB9XG4gIHNob3codGhpcy5sb2FkaW5nKTtcblxuICAvLyBsb2FkIGFzc2V0c1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIG5ldyBsb2FkZXIoXG4gICAgdGhpcy5hc3NldHNfdXJsLFxuICAgIHtcbiAgICAgIGltZzoge1xuICAgICAgICBzcHJpdGVzOiBcIi9pbWFnZXMvc3ByaXRlcy9zcHJpdGVzLnBuZ1wiLFxuICAgICAgICBiZzogXCIvaW1hZ2VzL3RleHR1cmVzL3NwYWNlLmpwZ1wiXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgYmxlZXAxOiBcIi9hdWRpby9ibGVlcDEubXAzXCIsXG4gICAgICAgIGJsb29wMTogXCIvYXVkaW8vYmxvb3AxLm1wM1wiLFxuICAgICAgICBibG9vcDI6IFwiL2F1ZGlvL2Jsb29wMi5tcDNcIixcbiAgICAgICAgYmluZzogXCIvYXVkaW8vYmluZy5tcDNcIixcbiAgICAgICAgZGlnOiBcIi9hdWRpby9kaWcubXAzXCIsXG4gICAgICAgIGRvaW5rOiBcIi9hdWRpby9kb2luay5tcDNcIixcbiAgICAgICAgZG9uazogXCIvYXVkaW8vZG9uay5tcDNcIixcbiAgICAgICAgZXhwbG9zaW9uOiBcIi9hdWRpby9leHBsb3Npb24ubXAzXCIsXG4gICAgICAgIGV4cGxvc2lvbl9nYXM6IFwiL2F1ZGlvL2V4cGxvc2lvbl9nYXMubXAzXCIsXG4gICAgICAgIGV4cGxvc2lvbl9sYXNlcjogXCIvYXVkaW8vZXhwbG9zaW9uX2xhc2VyLm1wM1wiLFxuICAgICAgICBob21pbmc6IFwiL2F1ZGlvL2hvbWluZy5tcDNcIixcbiAgICAgICAgZmx5OiBcIi9hdWRpby9mbHkubXAzXCIsXG4gICAgICAgIGNvdW50ZG93bjogXCIvYXVkaW8vY291bnRkb3duLm1wM1wiLFxuICAgICAgICBqdW1wOiBcIi9hdWRpby9qdW1wLm1wM1wiLFxuICAgICAgICBsZXZlbHVwOiBcIi9hdWRpby9sZXZlbHVwLm1wM1wiLFxuICAgICAgICBsb2NrbmxvYWQ6IFwiL2F1ZGlvL2xvY2tubG9hZC5tcDNcIixcbiAgICAgICAgcGhhc2U6IFwiL2F1ZGlvL3BoYXNlLm1wM1wiLFxuICAgICAgICBwb3A6IFwiL2F1ZGlvL3BvcC5tcDNcIixcbiAgICAgICAgcHVuY2g6IFwiL2F1ZGlvL3B1bmNoLm1wM1wiLFxuICAgICAgICBzaG9vdDogXCIvYXVkaW8vc2hvb3QubXAzXCIsXG4gICAgICAgIHNob290X2xhc2VyOiBcIi9hdWRpby9zaG9vdF9sYXNlci5tcDNcIixcbiAgICAgICAgdGhyb3c6IFwiL2F1ZGlvL3Rocm93Lm1wM1wiLFxuICAgICAgICBzcG9va3k6IFwiL2F1ZGlvL3Nwb29reS5tcDNcIixcbiAgICAgICAgd2FsazogXCIvYXVkaW8vd2Fsay5tcDNcIlxuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24oYXNzZXRzKSB7XG4gICAgICBzZWxmLmluaXRfcm9vbShhc3NldHMpO1xuICAgIH1cbiAgKTtcbn07XG5cbi8qIFN0YXJ0IHRoZSBhcHBcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9yb29tID0gZnVuY3Rpb24oYXNzZXRzKSB7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcblxuICB0aGlzLnN0YXJ0ZWQgPSB0cnVlO1xuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hdWRpby5hZGRfYnVmZmVycyhhc3NldHMuYXVkaW8pO1xuXG4gIGlmIChzaW5nbGVQbGF5ZXIpIHtcbiAgICB0aGlzLnJvb20gPSBuZXcgZGVtbyhcbiAgICAgIHRoaXMuYXNzZXRzLFxuICAgICAgdGhpcy5hc3NldHNfdXJsLFxuICAgICAgdGhpcy5hdWRpbyxcbiAgICAgIHRoaXMuaW5wdXQsXG4gICAgICBcIkRlbW8gbmFtZVwiXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnJvb20gPSBuZXcgbXVsdGlwbGF5ZXIoXG4gICAgICB0aGlzLmFzc2V0cyxcbiAgICAgIHRoaXMuYXNzZXRzX3VybCxcbiAgICAgIHRoaXMuYXVkaW8sXG4gICAgICB0aGlzLmlucHV0LFxuICAgICAgdGhpcy5uaWNrbmFtZSxcbiAgICAgIHRoaXMud2F0Y2gsXG4gICAgICB0aGlzLnJ1bl9ldmVudCxcbiAgICAgIHRoaXMuc29ja2V0cyxcbiAgICAgIG5ldyBvbmJvYXJkaW5nKClcbiAgICApO1xuICAgIGlmICh0aGlzLndhdGNoKSB7XG4gICAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwid2F0Y2hlclwiLCBbXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmlja25hbWUgPSB0aGlzLmNoZWNrX25hbWUodGhpcy5uaWNrbmFtZSk7XG4gICAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwic2VuZF9uYW1lXCIsIFt0aGlzLm5pY2tuYW1lXSk7XG4gICAgfVxuICB9XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5yb29tLmRpdik7XG59O1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gIG5ldyBhcHAoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiAgICBFdmVudHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBFdmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoZXZlbnRbaV0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzaG93IGFuZCBoaWRlIG1lbnVcbiAgaWYgKGV2ZW50LnR5cGUgPT0gXCJzaG93X21lbnVcIikge1xuICAgIHNob3codGhpcy5tZW51KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09IFwiaGlkZV9tZW51XCIpIHtcbiAgICBoaWRlKHRoaXMubWVudSk7XG5cbiAgICAvLyBpZiBnYW1lIGlzIGZ1bGxcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZ1bGxcIikge1xuICAgIGhpZGUodGhpcy5sb2FkaW5nKTtcbiAgICBzaG93KHRoaXMuZ2FtZV9mdWxsKTtcbiAgICBpZiAodGhpcy5yb29tICYmIHRoaXMucm9vbS5jb25uZWN0aW5nKSB7XG4gICAgICBoaWRlKHRoaXMucm9vbS5jb25uZWN0aW5nKTtcbiAgICB9XG5cbiAgICAvLyBzaG93IHRoZSBjb250cm9scyBzY3JlZW5cbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09IFwic2hvd19zZXR0aW5nc1wiKSB7XG4gICAgdGhpcy50b2dnbGVfc2V0dGluZ3Nfc2NyZWVuKCk7XG5cbiAgICAvLyBzZW5kIGV2ZW50IGRvd24gYSBsZXZlbFxuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLnJvb20pIHtcbiAgICAgIHRoaXMucm9vbS5ydW5fZXZlbnQoZXZlbnQpO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFwcCBJbnRlcmZhY2VcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5hcHAucHJvdG90eXBlLmluaXRfaW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZGl2ID0gZWxlbWVudCh7IGlkOiBcInByb2plY3RhbnRzXCIsIGNsYXNzOiBcImFwcFwiIH0pO1xuICBhcHBlbmQoZG9jdW1lbnQuYm9keSwgdGhpcy5kaXYpO1xuXG4gIC8vIGdhbWUgZnVsbFxuICB0aGlzLmdhbWVfZnVsbCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJPaCBkZWFyLCB0aGlzIHJvb20gaXMgdmVyeSBmdWxsITxicj48YnI+PGJyPjwvZGl2PlwiXG4gIH0pO1xuICB0aGlzLmJ1dHRvbl9uZXdfZ2FtZSA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnV0dG9uIHJlZFwiLFxuICAgIHRleHQ6IFwiRmluZCBBIE5ldyBPbmVcIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWVfZnVsbCk7XG4gIGFwcGVuZCh0aGlzLmdhbWVfZnVsbCwgdGhpcy5idXR0b25fbmV3X2dhbWUpO1xuICBoaWRlKHRoaXMuZ2FtZV9mdWxsKTtcblxuICAvLyBmaW5kIG5ldyByb29tXG4gIHRoaXMuYnV0dG9uX25ld19nYW1lLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB3aW5kb3cubG9jYXRpb24gPSBcIi9cIjtcbiAgfTtcblxuICAvLyBsaW1pdCBnYW1lIGFzcGVjdCByYXRpb1xuICB2YXIgcmF0aW8gPSB0aGlzLmRpdi5vZmZzZXRXaWR0aCAvIHRoaXMuZGl2Lm9mZnNldEhlaWdodDtcbiAgdGhpcy5kaXYuc3R5bGUud2lkdGggPVxuICAgIHJhdGlvID4gMS44XG4gICAgICA/IHJvdW5kKHRoaXMuZGl2Lm9mZnNldEhlaWdodCAqIDEuOCkgKyBcInB4XCJcbiAgICAgIDogdGhpcy5kaXYub2Zmc2V0V2lkdGggKyBcInB4XCI7XG4gIHRoaXMuZGl2LnN0eWxlLmhlaWdodCA9XG4gICAgcmF0aW8gPCAxID8gdGhpcy5kaXYub2Zmc2V0V2lkdGggKyBcInB4XCIgOiB0aGlzLmRpdi5vZmZzZXRIZWlnaHQgKyBcInB4XCI7XG5cbiAgLy8gbG9hZGluZ1xuICB0aGlzLmxvYWRpbmcgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiTG9hZGluZy4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gICAgU2V0dGluZ3NcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTdGFydCBzZXR0aW5ncyBzY3JlZW5cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9zZXR0aW5ncyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgLy8gY29ybmVyIGJ1dHRvblxuICB0aGlzLmljb25fc2V0dGluZ3MgPSBlbGVtZW50KHsgY2xhc3M6IFwic2V0dGluZ3NcIiB9KTtcbiAgdGhpcy5pY29uX3NldHRpbmdzX2ltZyA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiaW1nXCIsXG4gICAgc3JjOiB0aGlzLmFzc2V0c191cmwgKyBcIi9pbWFnZXMvY29nLnBuZ1wiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuaWNvbl9zZXR0aW5ncyk7XG4gIGFwcGVuZCh0aGlzLmljb25fc2V0dGluZ3MsIHRoaXMuaWNvbl9zZXR0aW5nc19pbWcpO1xuXG4gIHRoaXMuc2V0dGluZ3NfdmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLmljb25fc2V0dGluZ3Mub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYudG9nZ2xlX3NldHRpbmdzX3NjcmVlbigpO1xuICB9O1xuXG4gIC8vIGJveFxuICB0aGlzLmRpdl9zZXR0aW5ncyA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsIGZ1bGxfYmdcIiB9KTtcbiAgdGhpcy5kaXZfc2V0dGluZ3NfY29udCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyIGRpdl9jb250cm9sc1wiLFxuICAgIHRleHQ6IFwiPGRpdiBjbGFzcz0ndG9wX21lc3NhZ2UnPlNldHRpbmdzPC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfc2V0dGluZ3MpO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3MsIHRoaXMuZGl2X3NldHRpbmdzX2NvbnQpO1xuICBoaWRlKHRoaXMuZGl2X3NldHRpbmdzKTtcblxuICAvLyB2b2x1bWVcbiAgdGhpcy5kaXZfdm9sdW1lID0gZWxlbWVudCh7IHRleHQ6IFwiPGgyPlZvbHVtZTwvaDI+XCIgfSk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lID0gZWxlbWVudCh7IHR5cGU6IFwiaW5wdXRcIiB9KTtcbiAgdGhpcy5pbnB1dF92b2x1bWUudHlwZSA9IFwicmFuZ2VcIjtcbiAgdGhpcy5pbnB1dF92b2x1bWUuc2V0QXR0cmlidXRlKFwibWluXCIsIDApO1xuICB0aGlzLmlucHV0X3ZvbHVtZS5zZXRBdHRyaWJ1dGUoXCJtYXhcIiwgMSk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lLnNldEF0dHJpYnV0ZShcInN0ZXBcIiwgMC4xKTtcbiAgdGhpcy5pbnB1dF92b2x1bWUudmFsdWUgPSB0aGlzLmF1ZGlvLnZvbHVtZTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2NvbnQsIHRoaXMuZGl2X3ZvbHVtZSk7XG4gIGFwcGVuZCh0aGlzLmRpdl92b2x1bWUsIHRoaXMuaW5wdXRfdm9sdW1lKTtcblxuICB0aGlzLmlucHV0X3ZvbHVtZS5vbmNoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmF1ZGlvLnNldF9nbG9iYWxfdm9sdW1lKHRoaXMudmFsdWUpO1xuICB9O1xuXG4gIC8vIGNvbnRyb2xzXG4gIHZhciBjdGV4dCA9IFwiPGgyPkNvbnRyb2xzPC9oMj5cIjtcbiAgY3RleHQgKz0gXCI8ZGw+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0Pk1vdmU8L2R0PjxkZD5MZWZ0IENsaWNrPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+SnVtcDwvZHQ+PGRkPlNwYWNlYmFyPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+U2hvb3Q8L2R0PjxkZD5SaWdodCBDbGljayAvIEFsdCArIExlZnQgQ2xpY2s8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5TZWxlY3QgV2VhcG9uPC9kdD48ZGQ+MS05IC8gU2Nyb2xsIFdoZWVsPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+Rm9sbG93IFdlYXBvbnM8L2R0PjxkZD5GPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+RnJlZSBDYW08L2R0PjxkZD5NaWRkbGUgQ2xpY2s8L2RkPlwiO1xuICBjdGV4dCArPSBcIjwvZGw+XCI7XG4gIHRoaXMuZGl2X2NvbnRyb2xzID0gZWxlbWVudCh7IHRleHQ6IGN0ZXh0IH0pO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3NfY29udCwgdGhpcy5kaXZfY29udHJvbHMpO1xuXG4gIC8vIHNlcnZlclxuICB0aGlzLmRpdl9zZXJ2ZXIgPSBlbGVtZW50KHtcbiAgICB0ZXh0OlxuICAgICAgXCI8aDI+U2VydmVyPC9oMj48cD48YSBocmVmPSdodHRwOi8vdWsucHJvamVjdGFudHMuY29tLyc+VUs8L2E+IHwgPGEgaHJlZj0naHR0cDovL3VzLnByb2plY3RhbnRzLmNvbS8nPlVTPC9hPjwvcD5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2NvbnQsIHRoaXMuZGl2X3NlcnZlcik7XG5cbiAgLy8gY2xvc2UgYnV0dG9uXG4gIHRoaXMuZGl2X3NldHRpbmdzX2J1dHRvbnMgPSBlbGVtZW50KHsgY2xhc3M6IFwiYnV0dG9uc1wiIH0pO1xuICB0aGlzLmJ1dHRvbl9jbG9zZV9zZXR0aW5ncyA9IGVsZW1lbnQoeyB0eXBlOiBcImJ1dHRvblwiLCB0ZXh0OiBcIkNsb3NlXCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19jb250LCB0aGlzLmRpdl9zZXR0aW5nc19idXR0b25zKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2J1dHRvbnMsIHRoaXMuYnV0dG9uX2Nsb3NlX3NldHRpbmdzKTtcblxuICB0aGlzLmJ1dHRvbl9jbG9zZV9zZXR0aW5ncy5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5zZXR0aW5nc192aXNpYmxlID0gZmFsc2U7XG4gICAgaGlkZShzZWxmLmRpdl9zZXR0aW5ncyk7XG4gIH07XG59O1xuXG5hcHAucHJvdG90eXBlLnRvZ2dsZV9zZXR0aW5nc19zY3JlZW4gPSBmdW5jdGlvbigpIHtcbiAgaWYgKCh0aGlzLnNldHRpbmdzX3Zpc2libGUgPSAhdGhpcy5zZXR0aW5nc192aXNpYmxlKSkge1xuICAgIHRoaXMuYXVkaW8ucGxheShcImJsZWVwMVwiLCAwLjgpO1xuICAgIHNob3codGhpcy5kaXZfc2V0dGluZ3MpO1xuICB9IGVsc2Uge1xuICAgIGhpZGUodGhpcy5kaXZfc2V0dGluZ3MpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gICAgU3RhcnQgU2NyZWVuXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuYXBwLnByb3RvdHlwZS5pbml0X3N0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBnZXQgYSBuZXcgb3Igc3RvcmVkIG5pY2tuYW1lXG4gIHRoaXMubmlja25hbWUgPSBjb25maWcubmFtZXNbcmFuZCgwLCBjb25maWcubmFtZXMubGVuZ3RoIC0gMSldO1xuICBpZiAodHlwZW9mIFN0b3JhZ2UgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB2YXIgbHNuYW1lID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJwYW50c19ublwiKTtcbiAgICBpZiAoY29uZmlnLm5hbWVzLmluZGV4T2YobHNuYW1lKSA9PT0gLTEpIHtcbiAgICAgIHRoaXMubmlja25hbWUgPSBsc25hbWUgfHwgdGhpcy5uaWNrbmFtZTtcbiAgICB9XG4gIH1cblxuICB0aGlzLnN0YXJ0ID0gZWxlbWVudCh7IGNsYXNzOiBcInN0YXJ0XCIgfSk7XG4gIHZhciBsb2dvID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJpbWdcIixcbiAgICBjbGFzczogXCJsb2dvXCIsXG4gICAgc3JjOiB0aGlzLmFzc2V0c191cmwgKyBcIi9pbWFnZXMvbG9nby5wbmdcIlxuICB9KTtcbiAgdmFyIGluc3RydWN0aW9ucyA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwidWxcIixcbiAgICBjbGFzczogXCJmYWRlXCIsXG4gICAgdGV4dDpcbiAgICAgIFwiPGxpPkNvbGxlY3QgZ2VtcyB0byBnZXQgc3Ryb25nZXI8L2xpPjxsaT5EZXN0cm95IHRoZSBlbmVteSB0byBnZXQgdGhlaXIgZ2VtcyE8L2xpPjxsaT5DbGljayB0byBNb3ZlPC9saT48bGk+QWx0ICsgQ2xpY2sgb3IgUmlnaHQgQ2xpY2sgdG8gU2hvb3Q8L2xpPlwiXG4gIH0pO1xuICB0aGlzLmlucHV0X25hbWUgPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcImlucHV0XCIsXG4gICAgaW50eXBlOiBcInRleHRcIixcbiAgICB2YWx1ZTogdGhpcy5uaWNrbmFtZSxcbiAgICBtYXhsZW5ndGg6IDIwXG4gIH0pO1xuICB0aGlzLmJ1dHRvbl9zdGFydCA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnJlYWtcIixcbiAgICB0ZXh0OiBcIlBsYXkgTm93XCJcbiAgfSk7XG5cbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLnN0YXJ0KTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIGxvZ28pO1xuICBhcHBlbmQodGhpcy5zdGFydCwgaW5zdHJ1Y3Rpb25zKTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIHRoaXMuaW5wdXRfbmFtZSk7XG4gIGFwcGVuZCh0aGlzLnN0YXJ0LCB0aGlzLmJ1dHRvbl9zdGFydCk7XG5cbiAgLy8gc3RhcnQgdXAgdGhlIGFwcFxuICB0aGlzLmJ1dHRvbl9zdGFydC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5sb2FkX3Jvb20oKTtcbiAgfTtcbn07XG5cbi8qIENoZWNrIG5hbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuY2hlY2tfbmFtZSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbmV3X25hbWUgPSB0aGlzLm5pY2tuYW1lO1xuICBpZiAodGhpcy5pbnB1dF9uYW1lKSB7XG4gICAgbmV3X25hbWUgPSB0aGlzLmlucHV0X25hbWUudmFsdWU7XG4gIH1cbiAgbmV3X25hbWUgPSBuZXdfbmFtZS5sZW5ndGggPiAyMCA/IG5ld19uYW1lLnN1YnN0cmluZygwLCAyMCkgOiBuZXdfbmFtZTtcbiAgaWYgKHR5cGVvZiBTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJwYW50c19ublwiLCBuZXdfbmFtZSk7XG4gIH1cbiAgcmV0dXJuIG5ld19uYW1lO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1pc3Npb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gZGVtbyhhc3NldHMsIGFzc2V0c191cmwsIGF1ZGlvLCBpbnB1dCwgbmFtZSkge1xuICAvLyBzZXR1cFxuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hc3NldHNfdXJsID0gYXNzZXRzX3VybDtcbiAgdGhpcy5hdWRpbyA9IGF1ZGlvO1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gIHRoaXMucGxheWVyX2lkID0gMDtcbiAgdGhpcy5wbGF5ZXJzX3JlZiA9IHtcbiAgICBcIjBcIjoge1xuICAgICAgdXNlcl9pZDogMCxcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBsZXZlbDogMFxuICAgIH1cbiAgfTtcbiAgdGhpcy5zY2hlbWUgPSBkZWVwbWVyZ2Uoc2NoZW1lcy5kZWZhdWx0LCBzY2hlbWVzLmRlYXRobWF0Y2gpO1xuICB0aGlzLmRpdiA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsXCIgfSk7XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBuZXcgbG9hZGVyKFxuICAgIHRoaXMuYXNzZXRzX3VybCxcbiAgICB7XG4gICAgICBpbWc6IHtcbiAgICAgICAgZWRnZTogXCIvaW1hZ2VzL3Nwcml0ZXMvZWRnZS5wbmdcIixcbiAgICAgICAgZGVjb3JhdGlvbnM6IFwiL2ltYWdlcy9zcHJpdGVzL2RlY29yYXRpb25zLnBuZ1wiLFxuICAgICAgICBkaXJ0OiBcIi9pbWFnZXMvdGV4dHVyZXMvZGlydC5wbmdcIixcbiAgICAgICAgcm9jazogXCIvaW1hZ2VzL3RleHR1cmVzL3JvY2sucG5nXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIGZ1bmN0aW9uKGFzc2V0cykge1xuICAgICAgc2VsZi5sb2FkZWQoYXNzZXRzLmltZyk7XG4gICAgfVxuICApO1xufVxuXG4vKiBTdGFydCBkZW1vXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmRlbW8ucHJvdG90eXBlLmxvYWRlZCA9IGZ1bmN0aW9uKGltZykge1xuICAvLyBnZXQgdGhlIG1hcFxuICB0aGlzLm1hcCA9IG5ldyBtYXBnZW4oaW1nLCBjb25maWcubWFwZ2VuLCB0aGlzLnNjaGVtZS5tYXBnZW4pO1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24tb3V0XCI7XG5cbiAgLy8gc3RhcnQgdXAgZ2FtZSBvYmplY3RcbiAgdGhpcy5nYW1lID0gbmV3IGdhbWUoXG4gICAgdGhpcy5hc3NldHMsXG4gICAgdGhpcy5hdWRpbyxcbiAgICB0aGlzLmlucHV0LFxuICAgIHRoaXMuc2NoZW1lLFxuICAgIHRoaXMubWFwLFxuICAgIHRoaXMucGxheWVyc19yZWYsXG4gICAgdGhpcy5wbGF5ZXJfaWRcbiAgKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWUuZGl2KTtcblxuICB0aGlzLmdhbWUuY29yZS5jcmVhdGVfcGxheWVyKHsgaWQ6IHRoaXMucGxheWVyX2lkIH0pO1xuICB0aGlzLmdhbWUuY29yZS5jcmVhdGVfb2JqZWN0KHsgdHlwZTogXCJwbGF5ZXJcIiwgcGxheWVyX2lkOiB0aGlzLnBsYXllcl9pZCB9KTtcbiAgdGhpcy5nYW1lLmNvcmUuaW5pdF9wbGF5ZXIodGhpcy5wbGF5ZXJfaWQpO1xuXG4gIHRoaXMuZ2FtZS5zdGFydCgwKTtcbiAgdGhpcy5nYW1lLnBsYXllci5hcm1vdXJ5ID0gZHVwbGljYXRlX29iaihcbiAgICB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXS5hcm1vdXJ5XG4gICk7XG4gIHRoaXMuZ2FtZS5zZXRfYXJtb3VyeSgpO1xuXG4gIGNvbnNvbGUubG9nKHRoaXMuZ2FtZS5jb3JlLnN0YXRlKTtcblxuICB0aGlzLmxvb3Bfc3RhcnQoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWx0aXBsYXllclxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmRlbW8ucHJvdG90eXBlLnJ1bl9ldmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmICghZXZlbnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBoYW5kbGUgYXJyYXlzIG9mIGV2ZW50c1xuICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudChldmVudFtpXSk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJ1biBldmVudHNcbiAgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2RlYXRoXCIpIHtcbiAgICB0aGlzLmV2ZW50X3BsYXllcl9kZWF0aChldmVudCk7XG4gIH1cblxuICAvLyBzZW5kIGV2ZW50IGRvd24gYSBsZXZlbFxuICBlbHNlIGlmICh0aGlzLmdhbWUpIHtcbiAgICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcbiAgfVxufTtcblxuLyogUGxheWVyIGRlYXRoXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZGVtby5wcm90b3R5cGUuZXZlbnRfcGxheWVyX2RlYXRoID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKHRoaXMuaW5pdGlhbGlzZWQpIHtcbiAgICBjb25zb2xlLmxvZyhcImRpZWRcIik7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWxpdHBsYXllclxuICAgIEZyYW1lc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFN0YXJ0L3N0b3AgbG9vcFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZGVtby5wcm90b3R5cGUubG9vcF9zdGFydCA9IGZ1bmN0aW9uKHN0YXJ0X2ZyYW1lKSB7XG4gIC8vIGNsb3NlIGFueSBvcGVuIGxvb3BzXG4gIHRoaXMubG9vcF9zdG9wKCk7XG5cbiAgLy8gc2V0IGxvb3AgdmFyc1xuICB0aGlzLnN0YXJ0X2ZyYW1lID0gc3RhcnRfZnJhbWUgfHwgMDtcbiAgdGhpcy5mcmFtZXMgPSB0aGlzLnN0YXJ0X2ZyYW1lO1xuICB0aGlzLnN0YXJ0X3RpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgdGhpcy5kcm9wX3Bvc2l0aW9ucyA9IHt9O1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuZnJhbWUoKTtcbiAgfSwgMjQpO1xufTtcblxuZGVtby5wcm90b3R5cGUubG9vcF9zdG9wID0gZnVuY3Rpb24oKSB7XG4gIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG59O1xuXG4vKiBGcmFtZSBwcm9jZXNzXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmRlbW8ucHJvdG90eXBlLmZyYW1lID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZnJhbWVzKys7XG5cbiAgLy8gZG8gZHJvcHNcbiAgdmFyIGNvdW50cyA9IHRoaXMub2JqZWN0X2NvdW50cygpO1xuICBmb3IgKHZhciB0eXBlIGluIHRoaXMuc2NoZW1lLmRyb3BzKSB7XG4gICAgdmFyIHRpbWUgPSB0aGlzLnNjaGVtZS5kcm9wc1t0eXBlXS50aW1lO1xuICAgIGlmICh0aW1lIDwgMSB8fCBjb3VudHNbdHlwZV0gPj0gdGhpcy5zY2hlbWUuZHJvcHNbdHlwZV0ubWF4KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZnJhbWVzICUgdGltZSA9PT0gMCkge1xuICAgICAgdmFyIHByb3BzID0geyB0eXBlOiB0eXBlIH07XG4gICAgICB2YXIgb2JqID0gdGhpcy5nYW1lLmNvcmUuc3Bhd24ocHJvcHMpO1xuICAgICAgdGhpcy5nYW1lLmNyZWF0ZV9vYmplY3Qob2JqKTtcbiAgICB9XG4gIH1cblxuICAvLyBjaGVjayBmb3IgbGV2ZWwgdXBzXG4gIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVyc19yZWYpIHtcbiAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzX3JlZltpZF07XG4gICAgdmFyIGNvcmVfcGxheWVyID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUucGxheWVyc1tpZF07XG4gICAgaWYgKCFjb3JlX3BsYXllcikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChwbGF5ZXIubGV2ZWwgIT09IGNvcmVfcGxheWVyLmxldmVsKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudCh7XG4gICAgICAgIHR5cGU6IFwicGxheWVyX2xldmVsXCIsXG4gICAgICAgIGlkOiBwYXJzZUludChpZCksXG4gICAgICAgIHByZXY6IHBsYXllci5sZXZlbCxcbiAgICAgICAgbmV3OiBjb3JlX3BsYXllci5sZXZlbFxuICAgICAgfSk7XG4gICAgICB0aGlzLnBsYXllcnNfcmVmW2lkXS5sZXZlbCA9IGNvcmVfcGxheWVyLmxldmVsO1xuICAgIH1cbiAgfVxuXG4gIHZhciBhY3Rpb24gPSB0aGlzLmdhbWUucGxheWVyICYmIHRoaXMuZ2FtZS5nZXRfaW5wdXQoKTtcbiAgdGhpcy5nYW1lLmZyYW1lX2NvcmUodGhpcy5mcmFtZXMsIGFjdGlvbik7XG4gIHRoaXMucnVuX2V2ZW50KHRoaXMuZ2FtZS5jb3JlLnN0YXRlLmV2ZW50cyk7XG4gIHRoaXMuZ2FtZS5mcmFtZV9kaXNwbGF5KCk7XG59O1xuXG4vKiBPYmplY3QgY291bnRzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5kZW1vLnByb3RvdHlwZS5vYmplY3RfY291bnRzID0gZnVuY3Rpb24oKSB7XG4gIHZhciBjb3VudHMgPSB7fTtcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmICghY291bnRzW29iai50eXBlXSkge1xuICAgICAgY291bnRzW29iai50eXBlXSA9IDA7XG4gICAgfVxuICAgIGNvdW50c1tvYmoudHlwZV0rKztcbiAgfVxuICByZXR1cm4gY291bnRzO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRBdWRpb1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbndpbmRvdy5BdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7XG5cbmZ1bmN0aW9uIGF1ZGlvKGFzc2V0c191cmwpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIHRoaXMuY29udCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgdGhpcy5idWZmZXJzID0ge307XG4gIHRoaXMucmVwZWF0ZXJzID0ge307XG4gIHRoaXMudm9sdW1lID0gMC4xO1xuICB0aGlzLnN0b3JlZF92b2x1bWUgPSAwLjE7XG5cbiAgLy8gYnV0dG9uIGhvdmVyIHN3aXNoIGV2ZW50c1xuICB0aGlzLmJ1dHRvbl9ob3ZlciA9IG51bGw7XG4gIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChzZWxmLnZvbHVtZSA9PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImJ1dHRvblwiKSB8fFxuICAgICAgZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IFwiYnV0dG9uXCJcbiAgICApIHtcbiAgICAgIGlmIChcbiAgICAgICAgZS50YXJnZXQgIT0gc2VsZi5idXR0b25faG92ZXIgJiZcbiAgICAgICAgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImRpc2FibGVkXCIpXG4gICAgICApIHtcbiAgICAgICAgc2VsZi5idXR0b25faG92ZXIgPSBlLnRhcmdldDtcbiAgICAgICAgc2VsZi5wbGF5KFwiYmxvb3AxXCIsIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLmJ1dHRvbl9ob3ZlciA9IG51bGw7XG4gICAgfVxuICB9O1xufVxuXG4vKiBTZXQgdm9sdW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnNldF9nbG9iYWxfdm9sdW1lID0gZnVuY3Rpb24odm9sKSB7XG4gIHRoaXMudm9sdW1lID0gdm9sO1xufTtcblxuLyogQWRkIGJ1ZmZlcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuYWRkX2J1ZmZlcnMgPSBmdW5jdGlvbihidWZmZXJzKSB7XG4gIHRoaXMuYnVmZmVycyA9IE9iamVjdC5hc3NpZ24odGhpcy5idWZmZXJzLCBidWZmZXJzKTtcbn07XG5cbi8qIFBsYXkgYSBmaWxlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbihrZXksIHZvbHVtZSwgcmVwZWF0KSB7XG4gIC8vIGlmIG5vIHNvdW5kIGVmZmVjdFxuICBpZiAoIXRoaXMuYnVmZmVyc1trZXldKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaWYgd2UncmUgbm90IGFjdGl2ZVxuICBpZiAoIWRvY3VtZW50Lmhhc0ZvY3VzKCkgJiYga2V5ICE9PSBcImpvaW5cIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBvYmogPSB7fTtcbiAgb2JqLmF1ZGlvX2tleSA9IGtleTtcbiAgb2JqLmdhaW4gPSB0aGlzLmNvbnQuY3JlYXRlR2FpbigpO1xuICBvYmouc291cmNlID0gdGhpcy5jb250LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICBvYmouc291cmNlLmJ1ZmZlciA9IHRoaXMuYnVmZmVyc1trZXldO1xuICBvYmouc291cmNlLmNvbm5lY3Qob2JqLmdhaW4pO1xuICBvYmouZ2Fpbi5jb25uZWN0KHRoaXMuY29udC5kZXN0aW5hdGlvbik7XG4gIG9iai5zb3VyY2UubG9vcCA9IHJlcGVhdDtcbiAgb2JqLnNvdXJjZS5zdGFydCgwKTtcblxuICB0aGlzLnNldF92b2x1bWUob2JqLCB2b2x1bWUpO1xuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBTZXQgdm9sdW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnNldF92b2x1bWUgPSBmdW5jdGlvbihvYmosIHZvbHVtZSkge1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuICB2b2x1bWUgPSAhdm9sdW1lID8gMCA6IG1pbih2b2x1bWUsIDEpO1xuICBvYmouZ2Fpbi5nYWluLnZhbHVlID0gKHZvbHVtZSAqIHRoaXMudm9sdW1lKS5maXhlZCgpO1xufTtcblxuLyogU3RvcCBwbGF5aW5nIGF1ZGlvXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbihvYmopIHtcbiAgdGhpcy5jb250LmNsb3NlKCk7XG4gIHRoaXMuY29udCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0RWxlbWVudCBGdW5jdGlvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBlbGVtZW50KHByb3BzKSB7XG4gIC8vIGNyZWF0ZSB0aGUgZWxlbWVudFxuICB2YXIgdHlwZSA9IHByb3BzLnR5cGUgPyBwcm9wcy50eXBlIDogXCJkaXZcIixcbiAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XG5cbiAgLy8gc2V0IHByb3BlcnRpZXNcbiAgaWYgKHByb3BzLmlkKSB7XG4gICAgZWwuaWQgPSBwcm9wcy5pZDtcbiAgfVxuICBpZiAocHJvcHMuc3JjKSB7XG4gICAgZWwuc3JjID0gcHJvcHMuc3JjO1xuICB9XG4gIGlmIChwcm9wcy5pbnR5cGUpIHtcbiAgICBlbC50eXBlID0gcHJvcHMuaW50eXBlO1xuICB9XG4gIGlmIChwcm9wcy5jbGFzcykge1xuICAgIGVsLmNsYXNzTmFtZSA9IHByb3BzLmNsYXNzO1xuICB9XG4gIGlmIChwcm9wcy50ZXh0KSB7XG4gICAgZWwuaW5uZXJIVE1MID0gcHJvcHMudGV4dDtcbiAgfVxuICBpZiAocHJvcHMudmFsdWUpIHtcbiAgICBlbC52YWx1ZSA9IHByb3BzLnZhbHVlO1xuICB9XG4gIGlmIChwcm9wcy5kYXRhKSB7XG4gICAgZWwuZGF0YXNldC5kYXRhID0gcHJvcHMuZGF0YTtcbiAgfVxuICBpZiAocHJvcHMucGxhY2Vob2xkZXIpIHtcbiAgICBlbC5wbGFjZWhvbGRlciA9IHByb3BzLnBsYWNlaG9sZGVyO1xuICB9XG4gIGlmIChwcm9wcy5tYXhsZW5ndGgpIHtcbiAgICBlbC5tYXhMZW5ndGggPSBwcm9wcy5tYXhsZW5ndGg7XG4gIH1cbiAgaWYgKHByb3BzLmhyZWYpIHtcbiAgICBlbC5ocmVmID0gcHJvcHMuaHJlZjtcbiAgfVxuXG4gIHJldHVybiBlbDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0KGlkKSB7XG4gIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG59XG5cbmZ1bmN0aW9uIGhpZGUoZWwpIHtcbiAgZWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xufVxuXG5mdW5jdGlvbiBzaG93KGVsKSB7XG4gIGVsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZShlbCkge1xuICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTtcbn1cblxuZnVuY3Rpb24gZW1wdHkoZWwpIHtcbiAgd2hpbGUgKGVsLmZpcnN0Q2hpbGQpIHtcbiAgICBlbC5yZW1vdmVDaGlsZChlbC5maXJzdENoaWxkKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhcHBlbmQocGFyZW50LCBjaGlsZCkge1xuICBwYXJlbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xufVxuXG5mdW5jdGlvbiBhZGRfY2xhc3MoZWwsIGNsYXNzX25hbWUpIHtcbiAgdmFyIHNwbGl0ID0gZWwuY2xhc3NOYW1lLnNwbGl0KFwiIFwiKTtcbiAgaWYgKCFzcGxpdC5pbmNsdWRlcyhjbGFzc19uYW1lKSkge1xuICAgIHNwbGl0LnB1c2goY2xhc3NfbmFtZSk7XG4gIH1cbiAgZWwuY2xhc3NOYW1lID0gc3BsaXQuam9pbihcIiBcIik7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZV9jbGFzcyhlbCwgY2xhc3NfbmFtZSkge1xuICB2YXIgc3BsaXQgPSBlbC5jbGFzc05hbWUuc3BsaXQoXCIgXCIpLFxuICAgIGkgPSBzcGxpdC5pbmRleE9mKGNsYXNzX25hbWUpO1xuICBpZiAoaSAhPSAtMSkge1xuICAgIHNwbGl0LnNwbGljZShpLCAxKTtcbiAgfVxuICBlbC5jbGFzc05hbWUgPSBzcGxpdC5qb2luKFwiIFwiKTtcbn1cblxuZnVuY3Rpb24gZGlzcGxheV90aW1lKGZyYW1lcykge1xuICB2YXIgc2VjcyA9IGZsb29yKGZyYW1lcyAvIDMwKTtcbiAgdmFyIG1pbnV0ZXMgPSBmbG9vcihzZWNzIC8gNjApO1xuICB2YXIgc2Vjb25kcyA9IChzZWNzIC0gbWludXRlcyAqIDYwKS50b1N0cmluZygpO1xuICBzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPCAyID8gXCIwXCIgKyBzZWNvbmRzIDogc2Vjb25kcztcbiAgcmV0dXJuIG1pbnV0ZXMgKyBcIjpcIiArIHNlY29uZHM7XG59XG5cbmZ1bmN0aW9uIGRlYnVnKHMxLCBzMiwgczMsIHM0LCBzNSwgczYsIHM3LCBzOCwgczksIGJyKSB7XG4gIHZhciBlID0gc2VsZWN0KFwiZGVidWdcIik7XG4gIGlmIChicikge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiPGJyPlwiO1xuICB9IGVsc2Uge1xuICAgIGUuaW5uZXJIVE1MID0gXCJcIjtcbiAgfVxuICBpZiAoczEgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gczE7XG4gIH1cbiAgaWYgKHMyICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzMjtcbiAgfVxuICBpZiAoczMgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHMzO1xuICB9XG4gIGlmIChzNCAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczQ7XG4gIH1cbiAgaWYgKHM1ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzNTtcbiAgfVxuICBpZiAoczYgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM2O1xuICB9XG4gIGlmIChzNyAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczc7XG4gIH1cbiAgaWYgKHM4ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzODtcbiAgfVxuICBpZiAoczkgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM5O1xuICB9XG59XG5cbmZ1bmN0aW9uIGRlYnVnYnIoczEsIHMyLCBzMywgczQsIHM1LCBzNiwgczcsIHM4LCBzOSkge1xuICBkZWJ1ZyhzMSwgczIsIHMzLCBzNCwgczUsIHM2LCBzNywgczgsIHM5LCB0cnVlKTtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRJbnB1dFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIGlucHV0KGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuXG4gIC8vIGRlZmF1bHQgYWN0aW9uIGtleXNcbiAgdGhpcy5hY3Rpb25fa2V5cyA9IHtcbiAgICBtb3ZlOiBbXCIwXCJdLCAvLyBjbGlja1xuICAgIHNob290OiBbXCIyXCIsIFtcIjBcIiwgXCIxN1wiXSwgW1wiMFwiLCBcIjE4XCJdLCBbXCIwXCIsIFwiOTFcIl1dLCAvLyBjbGljaywgY3RybCwgYWx0LCBjbWRcbiAgICBqdW1wOiBbXCIzMlwiXSwgLy8gc3BhY2VcbiAgICBzd2l0Y2hfd2F0Y2hlcl9jYW1lcmE6IFtcIjgwXCJdLCAvLyBwXG4gICAgZm9sbG93X3dlYXBvbjogW1wiNzBcIl0sIC8vIGZcbiAgICBmb2xsb3dfbW91c2U6IFtcIjFcIl0sIC8vIG1pZGRsZSBjbGlja1xuICAgIC8vIG1vdmVfbGVmdDogW1wiMzdcIiwgXCI2NVwiXSwgLy8gbGVmdCwgYVxuICAgIC8vIG1vdmVfdXA6IFtcIjM4XCIsIFwiODdcIl0sIC8vIHVwLCB3XG4gICAgLy8gbW92ZV9yaWdodDogW1wiMzlcIiwgXCI2OFwiXSwgLy8gcmlnaHQsIGRcbiAgICAvLyBtb3ZlX2Rvd246IFtcIjQwXCIsIFwiODNcIl0sIC8vIGRvd24sIHNcbiAgICBzaG93X3NldHRpbmdzOiBbXCIyN1wiLCBcIjEzXCJdLCAvLyBlc2MsIGVudGVyXG4gICAgd2VhcG9uX3NlbGVjdF8xOiBbXCI0OVwiXSwgLy8gMVxuICAgIHdlYXBvbl9zZWxlY3RfMjogW1wiNTBcIl0sIC8vIDJcbiAgICB3ZWFwb25fc2VsZWN0XzM6IFtcIjUxXCJdLCAvLyAzXG4gICAgd2VhcG9uX3NlbGVjdF80OiBbXCI1MlwiXSwgLy8gNFxuICAgIHdlYXBvbl9zZWxlY3RfNTogW1wiNTNcIl0sIC8vIDVcbiAgICB3ZWFwb25fc2VsZWN0XzY6IFtcIjU0XCJdLCAvLyA2XG4gICAgd2VhcG9uX3NlbGVjdF83OiBbXCI1NVwiXSwgLy8gN1xuICAgIHdlYXBvbl9zZWxlY3RfODogW1wiNTZcIl0sIC8vIDhcbiAgICB3ZWFwb25fc2VsZWN0Xzk6IFtcIjU3XCJdIC8vIDlcbiAgfTtcblxuICAvLyBzZXQgdXAgcmVmZXJlbmNlIGZvciBwcmVzc2VkIGtleSBjb2Rlc1xuICB0aGlzLmtleV9jb2RlcyA9IHt9O1xuXG4gIC8vIGN1cnNvclxuICB0aGlzLmN1cnNvcl9tb3ZlZCA9IGZhbHNlO1xuICB0aGlzLmN1cnNvciA9IHsgeDogMCwgeTogMCB9O1xuXG4gIC8vIHNldCBjdXJzb3IgcG9pbnRzXG4gIGRvY3VtZW50LmJvZHkub25tb3VzZW1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmlkID09PSBcImdhbWVfaW5wdXRcIikge1xuICAgICAgc2VsZi5pbnB1dF9jdXJzb3IoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgIH1cbiAgfTtcblxuICAvLyBwcmV2ZW50IGRlZmF1bHQgcmlnaHQgY2xpY2sgYmVoYXZpb3VyXG4gIGRvY3VtZW50LmJvZHkub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIC8vIG1hbmFnZSBjbGljayBldmVudHNcbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwiZ2FtZV9pbnB1dFwiKSB7XG4gICAgICBzZWxmLmlucHV0X2J1dHRvbihlLmJ1dHRvbiwgXCJkb3duXCIpO1xuICAgIH1cbiAgICBpZiAoZS5idXR0b24gPT0gMSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNldXAgPSBmdW5jdGlvbihlKSB7XG4gICAgc2VsZi5pbnB1dF9idXR0b24oZS5idXR0b24sIFwidXBcIik7XG4gIH07XG5cbiAgLy8gbW91c2Ugd2hlZWxcbiAgLy8gaWYgKFwib25tb3VzZXdoZWVsXCIgaW4gZG9jdW1lbnQuYm9keSkge1xuICAvLyAgIGRvY3VtZW50LmJvZHkub25tb3VzZXdoZWVsID0gZnVuY3Rpb24oZSkge1xuICAvLyAgICAgZS5wcmV2ZW50RGVmYXVsdCAmJiBlLnByZXZlbnREZWZhdWx0KCk7XG4gIC8vICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gIC8vICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gIC8vICAgICBzZWxmLnNjcm9sbF93aGVlbChlKTtcbiAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgLy8gICB9O1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTU1vdXNlU2Nyb2xsXCIsIGZ1bmN0aW9uKGUpIHtcbiAgLy8gICAgIHNlbGYuc2Nyb2xsX3doZWVsKGUpO1xuICAvLyAgIH0pO1xuICAvLyB9XG5cbiAgLy8gbWFuYWdlIGtleWJvYXJkIGV2ZW50c1xuICBkb2N1bWVudC5ib2R5Lm9ua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmlucHV0X2J1dHRvbihlLmtleUNvZGUsIFwiZG93blwiKTtcbiAgfTtcbiAgZG9jdW1lbnQuYm9keS5vbmtleXVwID0gZnVuY3Rpb24oZSkge1xuICAgIHNlbGYuaW5wdXRfYnV0dG9uKGUua2V5Q29kZSwgXCJ1cFwiKTtcbiAgfTtcblxuICAvLyB0dXJuIG9mZiBpbnB1dCB3aGVuIHdpbmRvdyBpcyBub3QgZm9jdXNlZFxuICB3aW5kb3cub25ibHVyID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5pbnB1dF9yZXNldCgpO1xuICB9O1xufVxuXG4vKiBJcyBhbiBhY3Rpb24gYWN0aXZlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmFjdGl2ZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgY29uc3QgYWN0aW9uID0gdGhpcy5hY3Rpb25fa2V5c1t0eXBlXTtcbiAgaWYgKCFhY3Rpb24pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3Rpb24ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjb2RlcyA9IGFjdGlvbltpXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb2RlcykpIHtcbiAgICAgIGxldCB0cmlnZ2VyID0gdHJ1ZTtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBjb2Rlcy5sZW5ndGg7IGkyKyspIHtcbiAgICAgICAgY29uc3QgY29kZSA9IGNvZGVzW2kyXTtcbiAgICAgICAgaWYgKCF0aGlzLmtleV9jb2Rlc1tjb2RlXSkge1xuICAgICAgICAgIHRyaWdnZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRyaWdnZXIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmtleV9jb2Rlc1tjb2Rlc10pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKiBGaW5kIHRoZSBhY3Rpb24gb2YgYSBjb2RlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmZpbmRfYWN0aW9uID0gZnVuY3Rpb24oY29kZSkge1xuICBjb25zdCBhY3Rpb25zID0gW107XG4gIGZvciAobGV0IGtleSBpbiB0aGlzLmFjdGlvbl9rZXlzKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFjdGlvbl9rZXlzW2tleV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNvZGVzID0gdGhpcy5hY3Rpb25fa2V5c1trZXldW2ldO1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvZGVzKSAmJiBTdHJpbmcoY29kZXMpID09PSBTdHJpbmcoY29kZSkpIHtcbiAgICAgICAgY29uc3Qgb2JqID0geyB0eXBlOiBrZXkgfTtcbiAgICAgICAgLy8gaWYgKGtleSA9PSBcInNob3dfc2V0dGluZ3NcIikge1xuICAgICAgICAvLyAgIGlmICh0aGlzLmFjdGlvbnMuc2hvb3QpIHtcbiAgICAgICAgLy8gICAgIHJldHVybiBbXTtcbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vIH1cblxuICAgICAgICAvLyBwbGVhc2UgZG9uJ3QgdGVsbCBhbnlib2R5IEkgZGlkIHRoaXNcbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfMVwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfMlwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfM1wiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfNFwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfNVwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfNlwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfN1wiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDY7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfOFwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfOVwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDg7XG4gICAgICAgIH1cbiAgICAgICAgYWN0aW9ucy5wdXNoKG9iaik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBhY3Rpb25zO1xufTtcblxuLyogUHJvY2VzcyBpbnB1dCBldmVudHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuaW5wdXRfYnV0dG9uID0gZnVuY3Rpb24oY29kZSwgdHlwZSkge1xuICAvLyBpZ25vcmUgaW5wdXQgb24gYSB0ZXh0IGJveFxuICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0eXBlID09IFwidXBcIikge1xuICAgIHRoaXMua2V5X2NvZGVzW2NvZGVdID0gZmFsc2U7XG4gIH1cbiAgaWYgKHR5cGUgPT0gXCJkb3duXCIpIHtcbiAgICB0aGlzLmtleV9jb2Rlc1tjb2RlXSA9IHRydWU7XG4gICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuZmluZF9hY3Rpb24oY29kZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrKGFjdGlvbnNbaV0pO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ3Vyc29yIG1vdmVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5pbnB1dF9jdXJzb3IgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHRoaXMuY3Vyc29yX21vdmVkID0gdHJ1ZTtcbiAgdGhpcy5jdXJzb3IueCA9IHg7XG4gIHRoaXMuY3Vyc29yLnkgPSB5O1xufTtcblxuLyogU2Nyb2xsIHdoZWVsXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuc2Nyb2xsX3doZWVsID0gZnVuY3Rpb24oZSkge1xuICAvLyBub3JtYWxpemUgZGVsdGEgZm9yIGNyb3NzIGJyb3dzZXJcbiAgdmFyIGQgPSBlLmRldGFpbCxcbiAgICB3ID0gZS53aGVlbERlbHRhLFxuICAgIGQgPSBkID8gKHcgJiYgKGYgPSB3IC8gZCkgPyBkIC8gZiA6IC1kIC8gMS4zNSkgOiB3IC8gMTIwO1xuXG4gIC8vIHVwIG9yIGRvd25cbiAgdmFyIGRvd24gPSBkIDwgMCA/IHRydWUgOiBmYWxzZTtcblxuICAvLyBldmVudFxuICB0aGlzLmNhbGxiYWNrKHsgdHlwZTogXCJ3ZWFwb25fc2Nyb2xsXCIsIGRvd246IGRvd24gfSk7XG59O1xuXG4vKiBSZXNldCBhY3Rpb25zXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuaW5wdXRfcmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgZm9yIChrZXkgaW4gdGhpcy5rZXlfY29kZXMpIHtcbiAgICB0aGlzLmtleV9jb2Rlc1trZXldID0gZmFsc2U7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0QXNzZXQgTG9hZGVyXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gbG9hZGVyKGFzc2V0c191cmwsIGFzc2V0cywgb25sb2FkKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBzZXQgdXAgbG9hZGluZyB2YWx1ZXNcbiAgdGhpcy5vbmxvYWQgPSBvbmxvYWQ7XG4gIHRoaXMub3V0cHV0ID0ge307XG4gIHRoaXMubG9hZGVkID0gMDtcbiAgdGhpcy5jb3VudCA9IDA7XG4gIGZvciAodmFyIHR5cGUgaW4gYXNzZXRzKSB7XG4gICAgdGhpcy5jb3VudCArPSBPYmplY3Qua2V5cyhhc3NldHNbdHlwZV0pLmxlbmd0aDtcbiAgICB0aGlzLm91dHB1dFt0eXBlXSA9IHt9O1xuICB9XG5cbiAgLy8gc2V0IHVwIGF1ZGlvXG4gIGlmIChhc3NldHMuYXVkaW8pIHtcbiAgICBpZiAoT2JqZWN0LmtleXMoYXNzZXRzLmF1ZGlvKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmF1ZGlvX2NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGhlIGxvYWRpbmdcbiAgZm9yICh2YXIgdHlwZSBpbiBhc3NldHMpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gYXNzZXRzW3R5cGVdKSB7XG4gICAgICB2YXIgdXJsID0gYXNzZXRzX3VybCArIGFzc2V0c1t0eXBlXVtrZXldO1xuICAgICAgaWYgKHR5cGUgPT0gXCJqc29uXCIpIHtcbiAgICAgICAgdGhpcy5qc29uKHVybCwgdHlwZSwga2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09IFwiaW1nXCIpIHtcbiAgICAgICAgdGhpcy5pbWFnZSh1cmwsIHR5cGUsIGtleSk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PSBcImF1ZGlvXCIpIHtcbiAgICAgICAgdGhpcy5hdWRpbyh1cmwsIHR5cGUsIGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qIExvYWQgSlNPTlxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmxvYWRlci5wcm90b3R5cGUuanNvbiA9IGZ1bmN0aW9uKHVybCwgdHlwZSwga2V5KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICByZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcbiAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09IDQgJiYgcmVxdWVzdC5zdGF0dXMgPT0gXCIyMDBcIikge1xuICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICBzZWxmLm91dHB1dFt0eXBlXVtrZXldID0gcmVzcG9uc2U7XG4gICAgICBzZWxmLmNoZWNrX2xvYWRlZCgpO1xuICAgIH1cbiAgfTtcbiAgcmVxdWVzdC5zZW5kKG51bGwpO1xufTtcblxuLyogTG9hZCBJbWFnZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmxvYWRlci5wcm90b3R5cGUuaW1hZ2UgPSBmdW5jdGlvbih1cmwsIHR5cGUsIGtleSkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdGhpcy5vdXRwdXRbdHlwZV1ba2V5XSA9IG5ldyBJbWFnZSgpO1xuICB0aGlzLm91dHB1dFt0eXBlXVtrZXldLnNyYyA9IHVybDtcblxuICAvLyB3aGVuIGltYWdlIGlzIGxvYWRlZFxuICB0aGlzLm91dHB1dFt0eXBlXVtrZXldLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuY2hlY2tfbG9hZGVkKCk7XG4gIH07XG59O1xuXG4vKiBMb2FkIEF1ZGlvXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubG9hZGVyLnByb3RvdHlwZS5hdWRpbyA9IGZ1bmN0aW9uKHVybCwgdHlwZSwga2V5KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcbiAgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XG4gIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5hdWRpb19jb250ZXh0LmRlY29kZUF1ZGlvRGF0YShyZXF1ZXN0LnJlc3BvbnNlLCBmdW5jdGlvbihidWZmZXIpIHtcbiAgICAgIGlmIChidWZmZXIpIHtcbiAgICAgICAgdmFyIGZpbGUgPSBzZWxmLmF1ZGlvX2NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgIGZpbGUuYnVmZmVyID0gYnVmZmVyO1xuICAgICAgICBmaWxlLmNvbm5lY3Qoc2VsZi5hdWRpb19jb250ZXh0LmRlc3RpbmF0aW9uKTtcblxuICAgICAgICB2YXIgZ2FpbiA9IHNlbGYuYXVkaW9fY29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgIGZpbGUuY29ubmVjdChnYWluKTtcbiAgICAgICAgZ2Fpbi5jb25uZWN0KHNlbGYuYXVkaW9fY29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgICAgZmlsZS5sb29wID0gdHJ1ZTtcblxuICAgICAgICAvLyBnYWluLmdhaW4udmFsdWUgPSAxO1xuICAgICAgICAvLyBmaWxlLnN0YXJ0KDApO1xuXG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XSA9IHRoaXMuY29udC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgLy8gdGhpcy5maWxlc1trZXldLmJ1ZmZlciA9IGZpbGVzW2tleV07XG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XS5jb25uZWN0KHRoaXMuY29udC5kZXN0aW5hdGlvbik7XG5cbiAgICAgICAgLy8gLy8gc2V0IHVwIGdhaW4gbm9kZVxuICAgICAgICAvLyB0aGlzLmdhaW5ba2V5XSA9IHRoaXMuY29udC5jcmVhdGVHYWluKCk7XG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XS5jb25uZWN0KHRoaXMuZ2FpbltrZXldKTtcbiAgICAgICAgLy8gdGhpcy5nYWluW2tleV0uY29ubmVjdCh0aGlzLmNvbnQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgIHNlbGYub3V0cHV0LmF1ZGlvW2tleV0gPSBidWZmZXI7XG4gICAgICAgIHNlbGYuY2hlY2tfbG9hZGVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJlcXVlc3Quc2VuZChudWxsKTtcbn07XG5cbi8qIENoZWNrIEFzc2V0cyBBcmUgTG9hZGVkXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubG9hZGVyLnByb3RvdHlwZS5jaGVja19sb2FkZWQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5sb2FkZWQrKztcblxuICAvLyBpZiB3ZSBhcmUgbm90IHJlYWR5IHlldFxuICBpZiAodGhpcy5jb3VudCA8PSB0aGlzLmxvYWRlZCkge1xuICAgIHRoaXMub25sb2FkKHRoaXMub3V0cHV0KTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE9uYm9hcmRpbmdcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBvbmJvYXJkaW5nKCkge1xuICB0aGlzLmNvdW50ID0gMDtcbiAgdGhpcy5kb25lID0gZmFsc2U7XG4gIHRoaXMuYWN0aW9uID0ge1xuICAgIG1vdmU6IGZhbHNlLFxuICAgIGp1bXA6IGZhbHNlLFxuICAgIHNob290OiBmYWxzZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgU3RvcmFnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHRoaXMuY291bnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInBhbnRzX29uYm9hcmRpbmdcIikgfHwgMDtcbiAgICB0aGlzLmRvbmUgPSB0aGlzLmNvdW50ID4gMTtcbiAgfVxufVxuXG4vKiBUcmlnZ2VyIG9uYm9hcmRpbmduZXNzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxub25ib2FyZGluZy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24odHlwZSkge1xuICBpZiAodGhpcy5kb25lKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHRoaXMuYWN0aW9uW3R5cGVdID0gdHJ1ZTtcbiAgZm9yIChsZXQga2V5IGluIHRoaXMuYWN0aW9uKSB7XG4gICAgaWYgKCF0aGlzLmFjdGlvbltrZXldKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIHRoaXMuZG9uZSA9IHRydWU7XG4gIGlmICh0eXBlb2YgU3RvcmFnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwicGFudHNfb25ib2FyZGluZ1wiLCB0aGlzLmNvdW50ICsgMSk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBTb2NrZXQgTWVzc2FnZXNcbiAgICBoYW5kbGUgY29ubmVjdGlvbiBhbmQgbWVzc2FnZSBkYXRhIHRvIGFuZCBmcm9tIHRoZSBzZXJ2ZXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBTb2NrZXRDb25uZWN0aW9uKGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBzb2NrZXQgY29ubmVjdGlvblxuICBpZiAoIWlvLm9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHRoaXMuaW8gPSBpbyhET01BSU4gKyBcIjpcIiArIFBPUlQpO1xuICB0aGlzLmlvLm9uKFwibWVzc2FnZVwiLCBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgc2VsZi5tZXNzYWdlX3JlY2VpdmUobWVzc2FnZSk7XG4gIH0pO1xuICB0aGlzLmlvLm9uKFwiZGlzY29ubmVjdFwiLCBmdW5jdGlvbigpIHtcbiAgICBjYWxsYmFjayh7IHR5cGU6IFwid2FpdF9mb3JfY29ubmVjdGlvblwiIH0pO1xuICB9KTtcblxuICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG5cbiAgLy8gaWRzXG4gIHRoaXMubWVzc2FnZV9yZWNlaXZlX2lkcyA9IFtcbiAgICBcImZ1bGxcIixcbiAgICBcImNvbm5lY3RlZFwiLFxuICAgIFwicGxheWVyX2pvaW5cIixcbiAgICBcInBsYXllcl9sZWF2ZVwiLFxuICAgIFwiZ2FtZV93YWl0XCIsXG4gICAgXCJnYW1lX3N0YXJ0XCIsXG4gICAgXCJnYW1lX2VuZFwiLFxuICAgIFwiZ2FtZV9zdGF0ZVwiLFxuICAgIFwicGluZ1wiXG4gIF07XG5cbiAgdGhpcy5tZXNzYWdlX3NlbmRfaWRzID0gW1xuICAgIFwid2F0Y2hlclwiLFxuICAgIFwic2VuZF9uYW1lXCIsXG4gICAgXCJwbGF5ZXJfaW5wdXRcIixcbiAgICBcIndlYXBvbl9zZWxlY3RlZFwiLFxuICAgIFwicmVzcGF3blwiLFxuICAgIFwicGluZ1wiXG4gIF07XG5cbiAgLy8gc3RyaW5nIHNlcGFyYXRvclxuICB0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yID0gXCJ8XCI7XG59XG5cbi8qIFNlbmQgbWVzc2FnZXMgdG8gc2VydmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuU29ja2V0Q29ubmVjdGlvbi5wcm90b3R5cGUubWVzc2FnZV9zZW5kID0gZnVuY3Rpb24odHlwZSwgcHJvcHMpIHtcbiAgdmFyIGkgPSB0aGlzLm1lc3NhZ2Vfc2VuZF9pZHMuaW5kZXhPZih0eXBlKTtcblxuICAvLyBpZiBub3QgYSB2YWxpZCBtZXNzYWdlXG4gIGlmIChpID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2VuZCBtZXNzYWdlXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIG1lc3NhZ2UgPSBpICsgdGhpcy5tZXNzYWdlX3NlcGFyYXRvciArIHByb3BzLmpvaW4odGhpcy5tZXNzYWdlX3NlcGFyYXRvcik7XG4gIGlmICh0aGlzLmxhZykge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmlvLnNlbmQobWVzc2FnZSk7XG4gICAgfSwgdGhpcy5sYWcpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuaW8uc2VuZChtZXNzYWdlKTtcbiAgfVxufTtcblxuLyogUmVjZWl2ZSBtZXNzYWdlcyBmcm9tIHNlcnZlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblNvY2tldENvbm5lY3Rpb24ucHJvdG90eXBlLm1lc3NhZ2VfcmVjZWl2ZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgLy8gZ2V0IHR5cGUgb2YgbWVzc2FnZSBmcm9tIGlkXG4gIHZhciBzcGxpdCA9IG1lc3NhZ2Uuc3BsaXQodGhpcy5tZXNzYWdlX3NlcGFyYXRvcik7XG4gIHZhciBpZCA9IHBhcnNlSW50KHNwbGl0WzBdKTtcblxuICAvLyBpZiBub3QgdmFsaWQgaWRcbiAgaWYgKCF0aGlzLm1lc3NhZ2VfcmVjZWl2ZV9pZHNbaWRdKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciB0eXBlID0gdGhpcy5tZXNzYWdlX3JlY2VpdmVfaWRzW2lkXTtcbiAgdmFyIGV2ZW50ID0geyB0eXBlOiB0eXBlIH07XG5cbiAgLy8gcHJlcGFyZSBpbmZvcm1hdGlvbiBmb3IgZXZlbnQgaGFuZGxlclxuICBpZiAodHlwZSA9PT0gXCJmdWxsXCIpIHtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImNvbm5lY3RlZFwiKSB7XG4gICAgZXZlbnQucGxheWVyX2lkID0gc3BsaXRbMV0gPT09IFwibnVsbFwiID8gbnVsbCA6IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgICBldmVudC5uYW1lID0gc3BsaXRbMl07XG4gICAgZXZlbnQucGxheWVycyA9IHNwbGl0WzNdO1xuICAgIGV2ZW50LnNjaGVtZSA9IHNwbGl0WzRdO1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicGxheWVyX2pvaW5cIikge1xuICAgIGV2ZW50LnVzZXJfaWQgPSBzcGxpdFsxXTtcbiAgICBldmVudC5uYW1lID0gc3BsaXRbMl07XG4gICAgZXZlbnQucGxheWVyX2lkID0gcGFyc2VJbnQoc3BsaXRbM10pO1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicGxheWVyX2xlYXZlXCIpIHtcbiAgICBldmVudC51c2VyX2lkID0gc3BsaXRbMV07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX3dhaXRcIikge1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiZ2FtZV9zdGFydFwiKSB7XG4gICAgZXZlbnQucmVzZXRfcGxheWVycyA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgICBldmVudC5iZ19zdHIgPSBzcGxpdFsyXTtcbiAgICBldmVudC5mZ19zdHIgPSBzcGxpdFszXTtcbiAgICBldmVudC5ncmF2aXR5X21hcCA9IHNwbGl0WzRdO1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiZ2FtZV9lbmRcIikge1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiZ2FtZV9zdGF0ZVwiKSB7XG4gICAgZXZlbnQuZnJhbWVzID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICAgIGV2ZW50LnN0YXRlID0gc3BsaXRbMl07XG4gICAgZXZlbnQucmVzcG9uc2VzID0gc3BsaXRbM107XG4gICAgZXZlbnQuZGFtYWdlcyA9IHNwbGl0WzRdO1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicGluZ1wiKSB7XG4gICAgZXZlbnQuZnJhbWUgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gIH1cblxuICAvLyBydW4gZXZlbnRcbiAgdGhpcy5jYWxsYmFjayhldmVudCk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEFsZXJ0IE1lc3NhZ2VzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGFsZXJ0IGRpdlxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9hbGVydCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRpdl9hbGVydCA9IGVsZW1lbnQoeyBjbGFzczogXCJhbGVydFwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X2FsZXJ0KTtcbiAgdGhpcy5hbGVydF90ZXh0ID0gXCJcIjtcbiAgdGhpcy5hbGVydF9jb3VudCA9IDA7XG59O1xuXG4vKiBTZXQgYWxlcnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9hbGVydCA9IGZ1bmN0aW9uKHRleHQsIGNvbCwgY291bnQpIHtcbiAgdGhpcy5hbGVydF9jb3VudCA9IGNvdW50IHx8IDYwO1xuICB0aGlzLmRpdl9hbGVydC5jbGFzc05hbWUgPSBcImFsZXJ0XCI7XG4gIHRoaXMuZGl2X2FsZXJ0LmlubmVySFRNTCA9IHRleHQ7XG4gIGlmIChjb2wpIHtcbiAgICBhZGRfY2xhc3ModGhpcy5kaXZfYWxlcnQsIGNvbCk7XG4gIH1cbiAgc2hvdyh0aGlzLmRpdl9hbGVydCk7XG59O1xuXG4vKiBSdW4gYWxlcnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9hbGVydCA9IGZ1bmN0aW9uKCkge1xuICAvLyBkbyBjb3VudGRvd25zXG4gIGlmICh0aGlzLmFsZXJ0X2NvdW50ID4gMCkge1xuICAgIHRoaXMuYWxlcnRfY291bnQtLTtcbiAgICBpZiAodGhpcy5hbGVydF9jb3VudCA9PSAwKSB7XG4gICAgICB0aGlzLmRpdl9hbGVydC5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgaGlkZSh0aGlzLmRpdl9hbGVydCk7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEFybW91cnlcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBCdWlsZCBhcm1vdXJ5IGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9hcm1vdXJ5ID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNlbGVjdGVkIHdlYXBvblxuICB0aGlzLmN1cnJlbnRfd2VhcG9uID0gXCJcIjtcblxuICAvLyBkZXRvbmF0aW9uIGNvb2xkb3duXG4gIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA9IDA7XG5cbiAgLy8gY3JlYXRlIGRpdnNcbiAgdGhpcy5hcm1vdXJ5ID0ge1xuICAgIGRpdjogZWxlbWVudCh7IGNsYXNzOiBcImFybW91cnkgYm94XCIgfSksXG4gICAgdGl0bGU6IGVsZW1lbnQoeyBjbGFzczogXCJ0aXRsZVwiIH0pLFxuICAgIHBsYXllcjogZWxlbWVudCh7IGNsYXNzOiBcInBsYXllcl93ZWFwb24gaGV4LWJ1dHRvblwiIH0pLFxuICAgIHdlYXBvbnM6IHt9LFxuICAgIHNob3dfaWNvbjogZmFsc2UsXG4gICAgc2hvd19pY29uX2ZyYW1lOiBudWxsXG4gIH07XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5hcm1vdXJ5LmRpdik7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5hcm1vdXJ5LnBsYXllcik7XG4gIGhpZGUodGhpcy5hcm1vdXJ5LnBsYXllcik7XG5cbiAgLy8gZ28gdGhyb3VnaCBhcm1vdXJ5IGxheW91dFxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGg7IGkrKykge1xuICAgIHZhciB0eXBlID0gdGhpcy5zY2hlbWUuYXJtb3VyeVtpXTtcblxuICAgIC8vIGNyZWF0ZSBlbGVtZW50c1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdID0ge1xuICAgICAgYm94OiBlbGVtZW50KHsgY2xhc3M6IFwiaGV4LWJ1dHRvbiB3ZWFwb25cIiwgZGF0YTogdHlwZSB9KSxcbiAgICAgIHNwcml0ZTogZWxlbWVudCh7IGNsYXNzOiBcInNwcml0ZVwiIH0pLFxuICAgICAgY291bnQ6IGVsZW1lbnQoeyBjbGFzczogXCJjb3VudFwiIH0pLFxuICAgICAgcGxheWVyX2ljb246IGVsZW1lbnQoeyBjbGFzczogXCJpY29uIHNwcml0ZVwiIH0pLFxuICAgICAgaTogaSxcbiAgICAgIGFjdGl2ZTogZmFsc2VcbiAgICB9O1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkuZGl2LCB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gpO1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gsIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnNwcml0ZSk7XG4gICAgYXBwZW5kKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCwgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uY291bnQpO1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkucGxheWVyLCB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5wbGF5ZXJfaWNvbik7XG4gICAgaGlkZSh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5wbGF5ZXJfaWNvbik7XG5cbiAgICAvLyBzZXQgc3ByaXRlIGJhY2tncm91bmQgcG9zaXRpb25cbiAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbdHlwZV07XG4gICAgdmFyIHNwcml0ZSA9IHRoaXMuYy5zcHJpdGVzW3dlYXBvbi5hcm1vdXJ5X3Nwcml0ZV07XG4gICAgaWYgKCFzcHJpdGUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB2YXIgb2Zmc2V0ID0gY2VpbCgoc3ByaXRlLnNpemUgLSA0OCkgLyAyKTtcbiAgICB2YXIgeCA9IC1zcHJpdGUueCAtIG9mZnNldDtcbiAgICB2YXIgeSA9IC1zcHJpdGUueSAtIG9mZnNldDtcbiAgICB2YXIgcG9zID0geCAtIDEgKyBcInB4IFwiICsgeSArIFwicHgsIDAgMFwiO1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnNwcml0ZS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb24gPSBwb3M7XG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0ucGxheWVyX2ljb24uc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gcG9zO1xuXG4gICAgLy8gc2V0IGVsZW1lbnQgZXZlbnRzXG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94Lm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYud2VhcG9uX3NlbGVjdCh0aGlzLmRhdGFzZXQuZGF0YSk7XG4gICAgfTtcbiAgfVxuXG4gIGFwcGVuZCh0aGlzLmFybW91cnkuZGl2LCB0aGlzLmFybW91cnkudGl0bGUpO1xuICBoaWRlKHRoaXMuYXJtb3VyeS5kaXYpO1xufTtcblxuLyogSW5pdGlhbGlzZSBhcm1vdXJ5IHdpdGggY29yZSBkYXRhXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgLy8gc2V0IGRpc3BsYXkgZm9yIGFsbCB3ZWFwb25zXG4gIGZvciAodHlwZSBpbiB0aGlzLmFybW91cnkud2VhcG9ucykge1xuICAgIHRoaXMuc2V0X3dlYXBvbih0eXBlKTtcbiAgfVxuXG4gIC8vIHNlbGVjdCB3ZWFwb25cbiAgaWYgKFxuICAgICF0aGlzLmN1cnJlbnRfd2VhcG9uIHx8XG4gICAgIXRoaXMuYXJtb3VyeS53ZWFwb25zW3RoaXMuY3VycmVudF93ZWFwb25dLmFjdGl2ZVxuICApIHtcbiAgICB0aGlzLndlYXBvbl9zZWxlY3RfbigwKTtcbiAgfVxufTtcblxuLyogU2VsZWN0IHdlYXBvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLndlYXBvbl9zZWxlY3QgPSBmdW5jdGlvbih0eXBlLCBub19oaWdobGlnaHQpIHtcbiAgLy8gaWYgc2FtZSB3ZWFwb24gb3Igbm9uZSBsZWZ0XG4gIGlmIChcbiAgICAhdGhpcy5wbGF5ZXIgfHxcbiAgICB0aGlzLmN1cnJlbnRfd2VhcG9uID09PSB0eXBlIHx8XG4gICAgdGhpcy5wbGF5ZXIuYXJtb3VyeVt0eXBlXSA9PT0gMFxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBkbyB0aGUgY2hhbmdlXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmFybW91cnkud2VhcG9ucykge1xuICAgIHJlbW92ZV9jbGFzcyh0aGlzLmFybW91cnkud2VhcG9uc1trZXldLmJveCwgXCJzZWxlY3RlZFwiKTtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS53ZWFwb25zW2tleV0ucGxheWVyX2ljb24pO1xuICB9XG4gIGFkZF9jbGFzcyh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gsIFwic2VsZWN0ZWRcIik7XG4gIHRoaXMuY3VycmVudF93ZWFwb24gPSB0eXBlO1xuICB0aGlzLmFybW91cnkudGl0bGUuaW5uZXJIVE1MID0gdGhpcy5jLndlYXBvbnNbdHlwZV0udGl0bGU7XG5cbiAgLy8gYXV0byBmb2xsb3dpbmcgd2VhcG9uXG4gIHZhciB3ZXAgPSB0aGlzLmMud2VhcG9uc1t0eXBlXTtcbiAgaWYgKFxuICAgICh3ZXAuYXV0b19mb2xsb3cgJiYgIXRoaXMud2VhcG9uX2ZvbGxvdykgfHxcbiAgICAoIXdlcC5hdXRvX2ZvbGxvdyAmJiB0aGlzLndlYXBvbl9mb2xsb3cpXG4gICkge1xuICAgIHRoaXMudG9nZ2xlX3dlYXBvbl9mb2xsb3coKTtcbiAgfVxuXG4gIGlmICghbm9faGlnaGxpZ2h0KSB7XG4gICAgLy8gcGxheSBub2lzZVxuICAgIHRoaXMuYXVkaW8ucGxheShcImJsZWVwMVwiLCAwLjgpO1xuXG4gICAgLy8gc2hvdyBpY29uXG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbiA9IHRydWU7XG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbl9mcmFtZSA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICBzaG93KHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnBsYXllcl9pY29uKTtcbiAgICBzaG93KHRoaXMuYXJtb3VyeS5wbGF5ZXIpO1xuICB9XG5cbiAgcmV0dXJuIHR5cGU7XG59O1xuXG4vKiBTZWxlY3Qgd2VhcG9uIGJ5IHBvc2l0aW9uIGluIGFybW91cnlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS53ZWFwb25fc2VsZWN0X24gPSBmdW5jdGlvbihuKSB7XG4gIC8vIGlmIGlzIHRvbyBiaWdcbiAgaWYgKG4gPj0gdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGgpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGNvbHVtbnNcbiAgdmFyIG4yID0gMDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuc2NoZW1lLmFybW91cnlbaV07XG4gICAgdmFyIGFjdGl2ZSA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmFybW91cnkud2VhcG9uc1t3ZWFwb25dLmFjdGl2ZSkge1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgIGlmIChuMiA9PT0gbiAmJiB3ZWFwb24gIT09IHRoaXMuY3VycmVudF93ZWFwb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2VhcG9uX3NlbGVjdCh3ZWFwb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGluY3JlYXNlIGNvdW50IG9mIGFjdHVhbCBjb2x1bW5zXG4gICAgbjIgPSBhY3RpdmUgPyBuMiArIDEgOiBuMjtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qIFNlbGVjdCB3ZWFwb24gYnkgc2Nyb2xsaW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUud2VhcG9uX3Njcm9sbCA9IGZ1bmN0aW9uKGRvd24pIHtcbiAgLy8gaWYgd2UgZG9uJ3QgaGF2ZSBhIHNlbGVjdGVkIHdlYXBvblxuICB2YXIgY3VycmVudCA9IHRoaXMuYXJtb3VyeS53ZWFwb25zW3RoaXMuY3VycmVudF93ZWFwb25dO1xuICBpZiAoIWN1cnJlbnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaV9kb3duID0gZG93biA/IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoIC0gaSA6IGk7XG4gICAgdmFyIG5ld19pID0gbl9sb29wKGN1cnJlbnQuaSArIGlfZG93biwgLTEsIHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoIC0gMSk7XG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuc2NoZW1lLmFybW91cnlbbmV3X2ldO1xuICAgIGlmICh0aGlzLmFybW91cnkud2VhcG9uc1t3ZWFwb25dLmFjdGl2ZSkge1xuICAgICAgdGhpcy53ZWFwb25fc2VsZWN0KHdlYXBvbik7XG4gICAgICByZXR1cm4gd2VhcG9uO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ2hhbmdlIHRvIHdlYXBvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF93ZWFwb24gPSBmdW5jdGlvbih0eXBlKSB7XG4gIGlmICghdGhpcy5wbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY291bnQgPSB0aGlzLnBsYXllci5hcm1vdXJ5W3R5cGVdO1xuICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5jb3VudC5pbm5lckhUTUwgPSBjb3VudDtcblxuICBpZiAoY291bnQgPT0gLTEpIHtcbiAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5hY3RpdmUgPSB0cnVlO1xuICAgIHNob3codGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94KTtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmNvdW50KTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoY291bnQgPCAxKSB7XG4gICAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgIGhpZGUodGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94KTtcbiAgICAgIGlmICh0eXBlID09IHRoaXMuY3VycmVudF93ZWFwb24pIHtcbiAgICAgICAgdGhpcy53ZWFwb25fc2VsZWN0X24oMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmFjdGl2ZSA9IHRydWU7XG4gICAgICBzaG93KHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCF0aGlzLmN1cnJlbnRfd2VhcG9uKSB7XG4gICAgdGhpcy53ZWFwb25fc2VsZWN0X24oMCk7XG4gIH1cbiAgdGhpcy5kaXNwbGF5X2FybW91cnkoKTtcbn07XG5cbi8qIFNob3cgYXJtb3VyeSBvciBub3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kaXNwbGF5X2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNob3dfaXQgPSBmYWxzZTtcbiAgdmFyIGV2ZW4gPSBmYWxzZTtcbiAgaWYgKHRoaXMucGxheWVyKSB7XG4gICAgZm9yIChrZXkgaW4gdGhpcy5wbGF5ZXIuYXJtb3VyeSkge1xuICAgICAgaWYgKHRoaXMucGxheWVyLmFybW91cnlba2V5XSA+IDAgfHwgdGhpcy5wbGF5ZXIuYXJtb3VyeVtrZXldID09IC0xKSB7XG4gICAgICAgIHNob3dfaXQgPSB0cnVlO1xuICAgICAgICBldmVuID0gIWV2ZW47XG4gICAgICB9XG4gICAgICB0aGlzLmFybW91cnkud2VhcG9uc1trZXldLmJveC5zdHlsZS5tYXJnaW5Ub3AgPSBldmVuID8gXCIyNnB4XCIgOiBcIjBweFwiO1xuICAgIH1cbiAgfVxuICBpZiAoc2hvd19pdCkge1xuICAgIHNob3codGhpcy5hcm1vdXJ5LmRpdik7XG4gIH0gZWxzZSB7XG4gICAgaGlkZSh0aGlzLmFybW91cnkuZGl2KTtcbiAgfVxufTtcblxuLyogUnVuIGV2ZXJ5IGZyYW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgLy8gdHVybiBvZmYgaWNvblxuICBpZiAoXG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbiAmJlxuICAgIHRoaXMuY29yZS5zdGF0ZS5mcmFtZSA+IHRoaXMuYXJtb3VyeS5zaG93X2ljb25fZnJhbWUgKyAzMFxuICApIHtcbiAgICB0aGlzLmFybW91cnkuc2hvd19pY29uID0gZmFsc2U7XG4gICAgaGlkZSh0aGlzLmFybW91cnkucGxheWVyKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBBdWRpb1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBhdWRpbyBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2F1ZGlvID0gZnVuY3Rpb24oKSB7XG4gIC8vIG9iamVjdHMgd2l0aCByZXBlYXRpbmcgc291bmRzXG4gIHRoaXMuYXVkaW9fb2JqcyA9IHt9O1xuXG4gIC8vIHdlYXBvbiBsb29wc1xuICB0aGlzLmF1ZGlvX3dlYXBvbnMgPSB7fTtcblxuICAvLyBzZXQgdXAgcG93ZXIgdXAgc291bmRcbiAgdGhpcy5wb3dlcl91cF9hdWRpb19vbiA9IGZhbHNlO1xufTtcblxuLyogQ2hlY2sgYWxsIGdhbWUgb2JqZWN0cyB3aXRoIGF1ZGlvIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9hdWRpbyA9IGZ1bmN0aW9uKCkge1xuICAvLyByZW1vdmUgb2xkIGF1ZGlvIG9iamVjdHNcbiAgZm9yIChrZXkgaW4gdGhpcy5hdWRpb19vYmpzKSB7XG4gICAgaWYgKCF0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldKSB7XG4gICAgICBpZiAodGhpcy5hdWRpb19vYmpzW2tleV0pIHtcbiAgICAgICAgdGhpcy5hdWRpb19vYmpzW2tleV0uZ2Fpbi5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRoaXMuYXVkaW9fb2Jqc1trZXldID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBvYmplY3RzXG4gIGZvciAoa2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG5cbiAgICAvLyB3aGF0IG5vaXNlIHNob3VsZCBiZSBwbGF5aW5nXG4gICAgdmFyIGF1ZGlvX2tleSA9IG51bGw7XG4gICAgaWYgKG9iai5ncm91bmRlZCAmJiBvYmouYW5pbWF0ZSAmJiBvYmouYWN0aW9uZWQpIHtcbiAgICAgIGF1ZGlvX2tleSA9IG9iai5jLmF1ZGlvLndhbGs7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF1ZGlvX2tleSA9IG9iai5jLmF1ZGlvLmFpcjtcbiAgICB9XG5cbiAgICB2YXIgdm9sdW1lID0gdGhpcy5nZXRfZGlzdF92b2x1bWUob2JqLngsIG9iai55KTtcbiAgICB2YXIgYXVkaW9fb2JqID0gdGhpcy5hdWRpb19vYmpzW2tleV07XG5cbiAgICAvLyBpZiB0aGVyZSBpcyBhbiBhdWRpbyBmaWxlIHBsYXlpbmdcbiAgICBpZiAoYXVkaW9fb2JqKSB7XG4gICAgICAvLyBjaGFuZ2UgaXRzIHZvbHVtZVxuICAgICAgdGhpcy5hdWRpby5zZXRfdm9sdW1lKGF1ZGlvX29iaiwgdm9sdW1lKTtcblxuICAgICAgLy8gZGlzY29ubmVjdCBpdFxuICAgICAgaWYgKHZvbHVtZSA8PSAwIHx8IGF1ZGlvX29iai5hdWRpb19rZXkgIT0gYXVkaW9fa2V5IHx8ICFhdWRpb19rZXkpIHtcbiAgICAgICAgYXVkaW9fb2JqLmdhaW4uZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLmF1ZGlvX29ianNba2V5XSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRoZXJlIGlzIG5vdCBhbiBhdWRpbyBmaWxlIHBsYXlpbmdcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGF1ZGlvX2tleSkge1xuICAgICAgICB0aGlzLmF1ZGlvX29ianNba2V5XSA9IHRoaXMuYXVkaW8ucGxheShhdWRpb19rZXksIHZvbHVtZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKiBTZXQgYSB3ZWFwb24gc2hvdCBzb3VuZCBlZmZlY3RcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnBsYXlfd2VhcG9uX2F1ZGlvID0gZnVuY3Rpb24ocHJvcHMpIHtcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW3Byb3BzLndlYXBvbl07XG4gIGlmICghd2VhcG9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghdGhpcy5hdWRpby5idWZmZXJzW3dlYXBvbi5maXJlX2F1ZGlvXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCB2b2x1bWVcbiAgdmFyIHZvbHVtZSA9IHRoaXMuZ2V0X2Rpc3Rfdm9sdW1lKHByb3BzLngsIHByb3BzLnkpO1xuICB0aGlzLmF1ZGlvLnBsYXkod2VhcG9uLmZpcmVfYXVkaW8sIHZvbHVtZSk7XG59O1xuXG4vKiBHZXQgZGlzdGFuY2Ugdm9sdW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5nZXRfZGlzdF92b2x1bWUgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciBkaXN0YW5jZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlKHgsIHksIHRoaXMuY2FtZXJhLngsIHRoaXMuY2FtZXJhLnkpO1xuICB2YXIgdm9sdW1lID0gKDEyMDAgLSBkaXN0YW5jZSkgLyAxMjAwO1xuICB2b2x1bWUgKj0gdm9sdW1lO1xuICByZXR1cm4gdm9sdW1lO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBDcm9zc2hhaXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgY3Jvc3NoYWlyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9jcm9zc2hhaXIgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jcm9zc2hhaXIgPSAwO1xuICB0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPSBcImJ1dHRvblwiO1xufTtcblxuLyogQ2FsY3VsYXRlIGNyb3NzaGFpciBmcm9tIGN1cnNvciBwb3NpdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9jcm9zc2hhaXIgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLnBsYXllciB8fCB0aGlzLnBsYXllci5kZWFkIHx8ICF0aGlzLnBsYXllcl9vYmopIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW3RoaXMucGxheWVyX29iai5rZXldO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuY3Jvc3NoYWlyID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICB0aGlzLmN1cnNvci54LFxuICAgIHRoaXMuY3Vyc29yLnlcbiAgKTtcblxuICAvLyAvLyBjYWxjdWxhdGUgZnJvbSBjdXJzb3JcbiAgLy8gaWYgKHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9PSBcImN1cnNvclwiKSB7XG4gIC8vIFx0dGhpcy5jcm9zc2hhaXIgPSB0aGlzLmNvcmUubWFwLmdldF9oZWFkaW5nKG9iai54LCBvYmoueSwgdGhpcy5jdXJzb3IueCwgdGhpcy5jdXJzb3IueSk7XG5cbiAgLy8gLy8gY2FsY3VsYXRlIGZyb20gYnV0dG9uc1xuICAvLyB9IGVsc2VcbiAgLy8gaWYgKHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9PSBcImJ1dHRvblwiKSB7XG5cbiAgLy8gXHQvLyBjYWxjdWxhdGUgYW5nbGUgb2YgY3Jvc3NoYWlyXG4gIC8vIFx0dmFyIGFuZ2xlID0gLTE7XG4gIC8vIFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3VwKSB7XG4gIC8vIFx0XHRhbmdsZSA9IDkwO1xuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3JpZ2h0KSB7IGFuZ2xlID0gMTM1OyB9XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfbGVmdCkgeyBhbmdsZSA9IDQ1OyB9XG4gIC8vIFx0fSBlbHNlXG4gIC8vIFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX2Rvd24pIHtcbiAgLy8gXHRcdGFuZ2xlID0gMjcwO1xuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3JpZ2h0KSB7IGFuZ2xlID0gMjI1OyB9XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfbGVmdCkgeyBhbmdsZSA9IDMwNTsgfVxuICAvLyBcdH0gZWxzZSB7XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfcmlnaHQpIHsgYW5nbGUgPSAxODA7IH1cbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9sZWZ0KSB7IGFuZ2xlID0gMDsgfVxuICAvLyBcdH1cbiAgLy8gXHRpZiAoYW5nbGUgIT09IC0xKSB7XG4gIC8vIFx0XHR0aGlzLmNyb3NzaGFpciA9IGluY3JlbWVudF9hbmdsZSh0aGlzLmNyb3NzaGFpciwgYW5nbGUsIDQpO1xuICAvLyBcdH1cbiAgLy8gfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBEZWNvcmF0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBkZWNvcmF0aW9uXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfZGVjb3JhdGlvbiA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gIHZhciBvYmogPSB7XG4gICAgZnJhbWU6IHRoaXMuY29yZS5zdGF0ZS5mcmFtZSxcbiAgICB0eXBlOiBcIlwiLFxuICAgIGlkOiBcIlwiLFxuICAgIHg6IDAsXG4gICAgeTogMCxcbiAgICBzcGVlZF94OiAwLFxuICAgIHNwZWVkX3k6IDAsXG4gICAgdGltZW91dDogMCxcbiAgICBhbmdsZTogMCxcbiAgICByZXBlYXQ6IHRydWUsXG4gICAgc3ByaXRlOiBcIlwiXG4gIH07XG4gIG9iaiA9IGRlZXBtZXJnZShvYmosIHByb3BzKTtcbiAgb2JqLmtleSA9XG4gICAgb2JqLmZyYW1lICsgXCItXCIgKyBvYmoueCArIFwiLVwiICsgb2JqLnkgKyBcIi1cIiArIG9iai5zcHJpdGUgKyBcIi1cIiArIG9iai5pZDtcbiAgdGhpcy5kZWNvcmF0aW9uc1tvYmoua2V5XSA9IG9iajtcbn07XG5cbi8qIFJ1biBkZWNvcmF0aW9uc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2RlY29yYXRpb25zID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNyZWF0ZSB0cmFpbHMgZnJvbSBvYmplY3RzXG4gIGZvciAoa2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKG9iai5jLnRyYWlscy5jb3VudCA9PT0gMCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlX3RyYWlsKG9iaiwgb2JqLmMudHJhaWxzKTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggYWxsIGRlY29yYXRpb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmRlY29yYXRpb25zKSB7XG4gICAgdmFyIGRlYyA9IHRoaXMuZGVjb3JhdGlvbnNba2V5XTtcblxuICAgIC8vIGRvIHRpbWVvdXRcbiAgICBkZWMudGltZW91dC0tO1xuICAgIGlmIChkZWMudGltZW91dCA8IDEpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmRlY29yYXRpb25zW2tleV07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBtb3ZlXG4gICAgZGVjLnggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChkZWMueCArIGRlYy5zcGVlZF94KS5maXhlZCgpO1xuICAgIGRlYy55ID0gdGhpcy5jb3JlLm1hcC5sb29wX3koZGVjLnkgKyBkZWMuc3BlZWRfeSkuZml4ZWQoKTtcbiAgfVxufTtcblxuLyogQ3JlYXRlIHRyYWlsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV90cmFpbCA9IGZ1bmN0aW9uKG9iaiwgdHJhaWxzKSB7XG4gIC8vIGNyZWF0ZSB0aGUgdHJhaWxzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhaWxzLmNvdW50OyBpKyspIHtcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgIGlkOiBpLFxuICAgICAgc3ByaXRlOiB0cmFpbHMuc3ByaXRlLFxuICAgICAgdGltZW91dDogdHJhaWxzLnRpbWVvdXQsXG4gICAgICB4OiBvYmouZHgsXG4gICAgICB5OiBvYmouZHlcbiAgICB9O1xuICAgIGlmICh0cmFpbHMucm90YXRlKSB7XG4gICAgICBhcmdzLmFuZ2xlID0gcmFuZCgwLCAzNjApO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcmdzLmFuZ2xlID0gYW5nbGVfYWRkKGdldF9hbmdsZSgtb2JqLnNwZWVkX3gsIC1vYmouc3BlZWRfeSksIDkwKTtcbiAgICAgIGFyZ3MueCAtPSBvYmouc3BlZWRfeDtcbiAgICAgIGFyZ3MueSAtPSBvYmouc3BlZWRfeTtcbiAgICAgIGlmICh0cmFpbHMub2Zmc2V0X3ggfHwgdHJhaWxzLm9mZnNldF95KSB7XG4gICAgICAgIHZhciB4eXggPSB4eV9zcGVlZChhbmdsZV9hZGQoYXJncy5hbmdsZSwgOTApLCB0cmFpbHMub2Zmc2V0X3gpO1xuICAgICAgICB2YXIgeHl5ID0geHlfc3BlZWQoYW5nbGVfYWRkKGFyZ3MuYW5nbGUsIDE4MCksIHRyYWlscy5vZmZzZXRfeSk7XG4gICAgICAgIGFyZ3MueCArPSB4eXgueCArIHh5eS54O1xuICAgICAgICBhcmdzLnkgKz0geHl4LnkgKyB4eXkueTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRyYWlscy5tb3ZlKSB7XG4gICAgICB2YXIgbW92ZV9hbmdsZSA9IHJhbmQoMCwgMzYwKTtcbiAgICAgIHZhciB4eSA9IHh5X3NwZWVkKG1vdmVfYW5nbGUsIHRyYWlscy5zcGVlZCk7XG4gICAgICBhcmdzLnNwZWVkX3ggPSAteHkueDtcbiAgICAgIGFyZ3Muc3BlZWRfeSA9IC14eS55O1xuICAgIH1cbiAgICB0aGlzLmNyZWF0ZV9kZWNvcmF0aW9uKGFyZ3MpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudHMgPSBmdW5jdGlvbihldmVudHMpIHtcbiAgLy8gZXZlbnRzIGZyb20gc2NoZW1lXG4gIHZhciBmX2V2ZW50ID0gdGhpcy5zY2hlbWUuZXZlbnRzLmZyYW1lW3RoaXMuY29yZS5jdXJyZW50X2ZyYW1lXTtcbiAgaWYgKGZfZXZlbnQpIHtcbiAgICB0aGlzLnJ1bl9ldmVudChmX2V2ZW50KTtcbiAgfVxufTtcblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gaGFuZGxlIGFycmF5IG9mIGV2ZW50c1xuICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudChldmVudFtpXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIGV2ZW50XG4gIGlmIChldmVudC50eXBlID09PSBcIndlYXBvbl9zZWxlY3RcIikge1xuICAgIHRoaXMud2VhcG9uX3NlbGVjdF9uKGV2ZW50Lm4pO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwid2VhcG9uX3Njcm9sbFwiKSB7XG4gICAgdGhpcy53ZWFwb25fc2Nyb2xsKGV2ZW50LmRvd24pO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwic3dpdGNoX3dhdGNoZXJfY2FtZXJhXCIpIHtcbiAgICB0aGlzLnN3aXRjaF93YXRjaGVyX2NhbWVyYSgpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZm9sbG93X3dlYXBvblwiKSB7XG4gICAgdGhpcy50b2dnbGVfd2VhcG9uX2ZvbGxvdyh0cnVlKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZvbGxvd19tb3VzZVwiKSB7XG4gICAgdGhpcy50b2dnbGVfbW91c2VfZm9sbG93KCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJncm91bmRfZGFtYWdlXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9ncm91bmRfZGFtYWdlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInNjcmVlbl9zaGFrZVwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc2NyZWVuX3NoYWtlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9oZWFsdGhcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3BsYXllcl9oZWFsdGgoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2xldmVsXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9wbGF5ZXJfbGV2ZWwoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZXhwbG9zaW9uXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9leHBsb3Npb24oZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiYXJtb3VyeVwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfYXJtb3VyeShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJib3VuY2VcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2JvdW5jZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJzb3VuZFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwidGFyZ2V0XCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF90YXJnZXQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwic3Bhd25cIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3NwYXduKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZvY3VzXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9mb2N1cyhldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJhbGVydFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfYWxlcnQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiY29sbGVjdFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfY29sbGVjdChldmVudCk7XG4gIH1cbn07XG5cbi8qIEdyb3VuZCBEYW1hZ2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9ncm91bmRfZGFtYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gYXJlIHdlIGRlc3Ryb3lpbmcgbGFuZFxuICBpZiAoIXRoaXMuc2NoZW1lLmRlc3Ryb3lfbGFuZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGRhbWFnZSB0aGUgZ3JvdW5kXG4gIHRoaXMuY29yZS5tYXAuc2V0X2NpcmNsZShldmVudC54LCBldmVudC55LCBldmVudC5yYWRpdXMsIDApO1xuICB0aGlzLmRlc3Ryb3lfbGFuZChldmVudC54LCBldmVudC55LCBldmVudC5yYWRpdXMpO1xuICAvLyB0aGlzLmNvcmUubWFwLmdyYXZpdHlfZXZlbnRfcmVjYWxjdWxhdGUoZXZlbnQueCwgZXZlbnQueSwgZXZlbnQucmFkaXVzKTtcblxuICAvLyBkbyB0aGUgZGlnIG5vaXNlIGFuZCBzbW9rZSB0cmFpbHNcbiAgaWYgKGV2ZW50LmRpZykge1xuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHsgeDogZXZlbnQueCwgeTogZXZlbnQueSwgc291bmQ6IFwiZGlnXCIgfSk7XG4gICAgdGhpcy5jcmVhdGVfdHJhaWwoXG4gICAgICB7IGR4OiBldmVudC54LCBkeTogZXZlbnQueSB9LFxuICAgICAge1xuICAgICAgICBjb3VudDogNyxcbiAgICAgICAgc3ByaXRlOiBcInNtb2tlXCIsXG4gICAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgICByb3RhdGU6IHRydWUsXG4gICAgICAgIG1vdmU6IHRydWUsXG4gICAgICAgIHNwZWVkOiAxXG4gICAgICB9XG4gICAgKTtcbiAgfVxufTtcblxuLyogU2NyZWVuIFNoYWtlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfc2NyZWVuX3NoYWtlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIGRpc3RhbmNlID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2UoXG4gICAgZXZlbnQueCxcbiAgICBldmVudC55LFxuICAgIHRoaXMuY2FtZXJhLngsXG4gICAgdGhpcy5jYW1lcmEueVxuICApO1xuICBpZiAoZGlzdGFuY2UgPCBldmVudC5yYWRpdXMgKiAyKSB7XG4gICAgdGhpcy5jYW1lcmEuc2hha2VfZnJhbWUgPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgdGhpcy5jYW1lcmEuc2hha2Vfc2l6ZSA9IChkaXN0YW5jZSAtIGV2ZW50LnJhZGl1cykgLyA0O1xuICB9XG59O1xuXG4vKiBIZWFsdGhcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9wbGF5ZXJfaGVhbHRoID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgZXZlbnQuaWRdO1xuICBpZiAob2JqKSB7XG4gICAgdmFyIHRleHQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDk4MjkpICsgXCIgXCIgKyBldmVudC5oZWFsdGg7XG4gICAgdGhpcy5jcmVhdGVfbWVzc2FnZShvYmosIFwiI2ZmOTk5OVwiLCB0ZXh0LCAyMik7XG4gIH1cbn07XG5cbi8qIExldmVsXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfcGxheWVyX2xldmVsID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgZXZlbnQuaWRdO1xuXG4gIC8vIGlzIHRoaXMgdXNcbiAgaWYgKHRoaXMucGxheWVyX2lkID09PSBldmVudC5pZCkge1xuICAgIHRoaXMuc2V0X3Njb3JlKCk7XG5cbiAgICAvLyBzZXQgYWxlcnRcbiAgICBpZiAoZXZlbnQubmV3ID4gZXZlbnQucHJldikge1xuICAgICAgdmFyIGx2ID0gdGhpcy5zY2hlbWUubGV2ZWxzO1xuICAgICAgdmFyIG4xID0gZXZlbnQubmV3O1xuICAgICAgdmFyIG4yID0gZXZlbnQucHJldjtcbiAgICAgIHZhciBiZW5lZml0cyA9IFwiXCI7XG4gICAgICBpZiAobHYuaGVhbHRoW24xXSA+IGx2LmhlYWx0aFtuMl0pIHtcbiAgICAgICAgYmVuZWZpdHMgKz0gXCI8YnI+K1wiICsgKGx2LmhlYWx0aFtuMV0gLSBsdi5oZWFsdGhbbjJdKSArIFwiIG1heCBoZWFsdGhcIjtcbiAgICAgIH1cbiAgICAgIGlmIChsdi5kYW1hZ2VbbjFdID4gbHYuZGFtYWdlW24yXSkge1xuICAgICAgICBiZW5lZml0cyArPSBcIjxicj4rXCIgKyAobHYuZGFtYWdlW24xXSAtIGx2LmRhbWFnZVtuMl0pICsgXCIgZGFtYWdlXCI7XG4gICAgICB9XG4gICAgICBpZiAobHYuc3BlZWRbbjFdID4gbHYuc3BlZWRbbjJdKSB7XG4gICAgICAgIGJlbmVmaXRzICs9IFwiPGJyPitcIiArIChsdi5zcGVlZFtuMV0gLSBsdi5zcGVlZFtuMl0pICsgXCIgc3BlZWRcIjtcbiAgICAgIH1cbiAgICAgIGlmIChsdi5qdW1wW24xXSA+IGx2Lmp1bXBbbjJdKSB7XG4gICAgICAgIGJlbmVmaXRzICs9IFwiPGJyPitcIiArIChsdi5qdW1wW24xXSAtIGx2Lmp1bXBbbjJdKSArIFwiIGp1bXAgcG93ZXJcIjtcbiAgICAgIH1cbiAgICAgIHZhciB0ZXh0ID1cbiAgICAgICAgXCI8c21hbGw+WW91IGhhdmUgcmVhY2hlZDwvc21hbGw+PGJyPjxzcGFuIGNsYXNzPSdsYXJnZSc+TGV2ZWwgXCIgK1xuICAgICAgICAoZXZlbnQubmV3ICsgMSkgK1xuICAgICAgICBcIjwvc3Bhbj48c21hbGwgY2xhc3M9J2JsdWUnPlwiICtcbiAgICAgICAgYmVuZWZpdHMgK1xuICAgICAgICBcIjwvc21hbGw+XCI7XG4gICAgICB0aGlzLnNldF9hbGVydCh0ZXh0LCBcIiNlZWVlZWVcIiwgMTUwKTtcbiAgICB9XG4gIH1cblxuICAvLyBkbyB0aGUgZmxvdXJpc2hcbiAgaWYgKGV2ZW50Lm5ldyA+IGV2ZW50LnByZXYpIHtcbiAgICB0aGlzLmNyZWF0ZV9tZXNzYWdlKG9iaiwgXCIjZWVlXCIsIFwibHZsIFwiICsgKGV2ZW50Lm5ldyArIDEpLCAzMCwgLTMwKTtcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7IHg6IG9iai54LCB5OiBvYmoueSwgc291bmQ6IFwibGV2ZWx1cFwiIH0pO1xuICAgIHRoaXMuY3JlYXRlX3RyYWlsKG9iaiwge1xuICAgICAgY291bnQ6IDcsXG4gICAgICBzcHJpdGU6IFwic3Rhci1ibHVlXCIsXG4gICAgICB0aW1lb3V0OiAzMCxcbiAgICAgIHJvdGF0ZTogdHJ1ZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcGVlZDogMS41XG4gICAgfSk7XG4gICAgdGhpcy5jcmVhdGVfdHJhaWwob2JqLCB7XG4gICAgICBjb3VudDogNyxcbiAgICAgIHNwcml0ZTogXCJiYWxsLXJlZFwiLFxuICAgICAgdGltZW91dDogMzAsXG4gICAgICByb3RhdGU6IHRydWUsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3BlZWQ6IDJcbiAgICB9KTtcbiAgfVxufTtcblxuLyogRXhwbG9zaW9uXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfZXhwbG9zaW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gZm9jdXMgY2FtZXJhIGlmIHdlIHdlcmUgZm9sbG93aW5nIGl0XG4gIGlmICh0aGlzLndlYXBvbl9mb2xsb3dpbmcgPT09IGV2ZW50LmtleSkge1xuICAgIHRoaXMuY2FtZXJhLmZvY3VzID0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHRoaXMuY2FtZXJhLmZvY3VzX3RpbWUgPSAzMDtcbiAgICB0aGlzLmNhbWVyYS5meCA9IGV2ZW50Lng7XG4gICAgdGhpcy5jYW1lcmEuZnkgPSBldmVudC55O1xuICB9XG59O1xuXG4vKiBBcm1vdXJ5XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfYXJtb3VyeSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmIChldmVudC5wbGF5ZXJfaWQgPT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICB0aGlzLnNldF93ZWFwb24oZXZlbnQud2VhcG9uKTtcbiAgfVxufTtcblxuLyogQm91bmNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfYm91bmNlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBzb3VuZCA9IG9iai5jLmF1ZGlvLmJvdW5jZTtcbiAgaWYgKHNvdW5kKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoeyB4OiBldmVudC54LCB5OiBldmVudC55LCBzb3VuZDogc291bmQgfSk7XG4gIH1cbn07XG5cbi8qIFNvdW5kXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfc291bmQgPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgdm9sdW1lID0gdGhpcy5nZXRfZGlzdF92b2x1bWUoZXZlbnQueCwgZXZlbnQueSk7XG4gIGlmICh2b2x1bWUgPiAwKSB7XG4gICAgdGhpcy5hdWRpby5wbGF5KGV2ZW50LnNvdW5kLCB2b2x1bWUpO1xuICB9XG59O1xuXG4vKiBTZXQgYSB0YXJnZXQgb24gdGhlIG1hcFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3RhcmdldCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuY3JlYXRlX2RlY29yYXRpb24oe1xuICAgIHNwcml0ZTogXCJmb2N1c1wiLFxuICAgIHRpbWVvdXQ6IGV2ZW50LnRpbWUsXG4gICAgeDogZXZlbnQueCxcbiAgICB5OiBldmVudC55LFxuICAgIHJlcGVhdDogZmFsc2VcbiAgfSk7XG4gIHRoaXMuYXVkaW8ucGxheShcImhvbWluZ1wiLCAxKTtcbn07XG5cbi8qIFNwYXduIE9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9zcGF3biA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuY3JlYXRlX29iamVjdChldmVudC5hcmdzLCB0cnVlKTtcblxuICBldmVudC5hcmdzLnRpbWUgPSAzMDtcbiAgaWYgKGV2ZW50LnRhcmdldCkge1xuICAgIHRoaXMucnVuX2V2ZW50X3RhcmdldChldmVudC5hcmdzKTtcbiAgfVxuICBpZiAoZXZlbnQuZm9jdXMpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9mb2N1cyhldmVudC5hcmdzKTtcbiAgfVxufTtcblxuLyogRm9jdXMgQ2FtZXJhXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfZm9jdXMgPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmNhbWVyYS5mb2N1cyA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgdGhpcy5jYW1lcmEuZm9jdXNfdGltZSA9IGV2ZW50LnRpbWU7XG4gIHRoaXMuY2FtZXJhLmZ4ID0gZXZlbnQueDtcbiAgdGhpcy5jYW1lcmEuZnkgPSBldmVudC55O1xuICBpZiAoZXZlbnQudGFyZ2V0KSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfdGFyZ2V0KGV2ZW50KTtcbiAgfVxufTtcblxuLyogU2hvdyBhbGVydFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2FsZXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5zZXRfYWxlcnQoZXZlbnQudGV4dCwgXCIjZWVlZWVlXCIsIGV2ZW50LnRpbWUpO1xufTtcblxuLyogQ3JhdGUgR3JhYlxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2NvbGxlY3QgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBpcyB0aGlzIG5vdCB1c1xuICBpZiAoZXZlbnQucGxheWVyX2lkICE9PSB0aGlzLnBsYXllcl9pZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCBvdXIgb2JqZWN0XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIGV2ZW50LnBsYXllcl9pZF07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY3JhdGVzXG4gIGlmIChldmVudC5jb2xsZWN0ZWQgPT09IFwiY3JhdGVcIikge1xuICAgIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1tldmVudC53ZWFwb25dO1xuICAgIHRoaXMuY3JlYXRlX21lc3NhZ2UoXG4gICAgICBvYmosXG4gICAgICBcIiNlZWVlZWVcIixcbiAgICAgIFwiK1wiICsgZXZlbnQuY291bnQgKyBcIiBcIiArIHdlYXBvbi50aXRsZSxcbiAgICAgIDE4XG4gICAgKTtcbiAgfVxuXG4gIC8vIGdlbXNcbiAgaWYgKGV2ZW50LmNvbGxlY3RlZCA9PT0gXCJnZW1cIikge1xuICAgIHRoaXMuc2V0X3Njb3JlKCk7XG4gICAgdGhpcy5jcmVhdGVfbWVzc2FnZShvYmosIFwiI2FhZmY5OVwiLCBcIitcIiArIGV2ZW50Lm4sIDIyKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBFeHBsb3Npb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ2hlY2sgZm9yIGV4cGxvc2lvbnNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9leHBsb3Npb25zID0gZnVuY3Rpb24oKSB7XG4gIC8vIHJ1biB0aHJvdWdoIGFsbCBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUuZXhwbG9zaW9ucykge1xuICAgIHZhciBleHBsb2RlX3N0YXRlID0gdGhpcy5jb3JlLnN0YXRlLmV4cGxvc2lvbnNba2V5XTtcbiAgICB2YXIgZXhwbG9kZV9zcHJpdGUgPSB0aGlzLmV4cGxvc2lvbnNba2V5XTtcblxuICAgIC8vIGlmIGl0J3Mgbm90IHN0YXJ0ZWRcbiAgICBpZiAoIWV4cGxvZGVfc3ByaXRlKSB7XG4gICAgICB2YXIgdHlwZSA9IHRoaXMuYy5vYmplY3RzW2V4cGxvZGVfc3RhdGUucGFyZW50X3R5cGVdO1xuICAgICAgaWYgKCF0eXBlKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBjcmVhdGUgc3ByaXRlIHJlZmVyZW5jZVxuICAgICAgdGhpcy5leHBsb3Npb25zW2tleV0gPSB7XG4gICAgICAgIHNwcml0ZTogdHlwZS5hbmltYXRpb24uZXhwbG9zaW9uLFxuICAgICAgICBmcmFtZTogdGhpcy5jb3JlLnN0YXRlLmZyYW1lLFxuICAgICAgICB4OiBleHBsb2RlX3N0YXRlLngsXG4gICAgICAgIHk6IGV4cGxvZGVfc3RhdGUueVxuICAgICAgfTtcblxuICAgICAgLy8gcnVuIHNvdW5kIGVmZmVjdFxuICAgICAgaWYgKHR5cGUuYXVkaW8uZXhwbG9zaW9uKSB7XG4gICAgICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgICAgICBzb3VuZDogdHlwZS5hdWRpby5leHBsb3Npb24sXG4gICAgICAgICAgeDogZXhwbG9kZV9zdGF0ZS54LFxuICAgICAgICAgIHk6IGV4cGxvZGVfc3RhdGUueVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gcnVuIHNjcmVlbiBzaGFrZVxuICAgICAgaWYgKHR5cGUuZGFtYWdlID4gMCkge1xuICAgICAgICB0aGlzLnJ1bl9ldmVudF9zY3JlZW5fc2hha2Uoe1xuICAgICAgICAgIHJhZGl1czogdHlwZS5kYW1hZ2UsXG4gICAgICAgICAgeDogZXhwbG9kZV9zdGF0ZS54LFxuICAgICAgICAgIHk6IGV4cGxvZGVfc3RhdGUueVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gbWF0Y2ggcG9zaXRpb25cbiAgICBleHBsb2RlX3Nwcml0ZS54ID0gZXhwbG9kZV9zcHJpdGUueDtcbiAgICBleHBsb2RlX3Nwcml0ZS55ID0gZXhwbG9kZV9zcHJpdGUueTtcbiAgfVxuXG4gIC8vIHJlbW92ZSBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmV4cGxvc2lvbnMpIHtcbiAgICBpZiAodGhpcy5jb3JlLnN0YXRlLmZyYW1lID4gdGhpcy5leHBsb3Npb25zW2tleV0uZnJhbWUgKyA2MCkge1xuICAgICAgZGVsZXRlIHRoaXMuZXhwbG9zaW9uc1trZXldO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBnYW1lKFxuICBhc3NldHMsXG4gIGF1ZGlvLFxuICBpbnB1dCxcbiAgc2NoZW1lLFxuICBtYXAsXG4gIHBsYXllcnMsXG4gIHBsYXllcl9pZCxcbiAgdG9wX2V2ZW50LFxuICBvbmJvYXJkaW5nXG4pIHtcbiAgLy8gYXJnc1xuICB0aGlzLmMgPSBjb25maWc7XG4gIHRoaXMuaW1nID0gYXNzZXRzLmltZztcbiAgdGhpcy5hdWRpbyA9IGF1ZGlvO1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMuc2NoZW1lID0gc2NoZW1lO1xuICB0aGlzLm1hcCA9IG1hcDtcbiAgdGhpcy5wbGF5ZXJzID0gcGxheWVycztcbiAgdGhpcy5wbGF5ZXJfaWQgPSBwbGF5ZXJfaWQ7XG4gIHRoaXMubGVhZGVyID0gbnVsbDtcbiAgdGhpcy50b3BfZXZlbnQgPSB0b3BfZXZlbnQ7XG4gIHRoaXMub25ib2FyZGluZyA9IG9uYm9hcmRpbmc7XG5cbiAgLy8gZ2FtZSBydW5uaW5nXG4gIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gIHRoaXMubGFzdF9mcmFtZSA9IDA7XG5cbiAgLy8gbWFpbiBkaXZcbiAgdGhpcy5kaXYgPSBlbGVtZW50KHsgY2xhc3M6IFwiZ2FtZSBmdWxsXCIgfSk7XG4gIHRoaXMuZ2FtZV9hcmVhID0gZWxlbWVudCh7IGlkOiBcImdhbWVfaW5wdXRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWVfYXJlYSk7XG5cbiAgLy8gc2V0IHVwIGdhbWUgbW9kdWxlc1xuICB0aGlzLmluaXRfY3Jvc3NoYWlyKCk7XG4gIHRoaXMuaW5pdF9jYW52YXMoKTtcbiAgdGhpcy5pbml0X2FybW91cnkoKTtcbiAgdGhpcy5pbml0X21hcCgpO1xuICB0aGlzLmluaXRfY2FtZXJhKCk7XG4gIHRoaXMuaW5pdF9iYWNrZ3JvdW5kKCk7XG4gIHRoaXMuaW5pdF90aW1lKCk7XG4gIHRoaXMuaW5pdF9zY29yZSgpO1xuICB0aGlzLmluaXRfYWxlcnQoKTtcbiAgdGhpcy5pbml0X2F1ZGlvKCk7XG5cbiAgLy8gdGhpbmdzIHRvIGRpc3BsYXlcbiAgdGhpcy5vYmplY3RzID0ge307XG4gIHRoaXMuZXhwbG9zaW9ucyA9IHt9O1xuICB0aGlzLmRlY29yYXRpb25zID0ge307XG4gIHRoaXMuYWN0aW9ucyA9IHt9O1xuICB0aGlzLnNwcml0ZXMgPSBbXTtcbiAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuICB0aGlzLmxhYmVscyA9IHt9O1xuXG4gIC8vIHdhaXQgcGVyaW9kIGJlZm9yZSBvbiBmaXJlZCB3ZWFwb24gaW1tZWRpYXRlbHkgYWZ0ZXJcbiAgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID0gMDtcblxuICAvLyBjcmVhdGUgY29yZVxuICB0aGlzLmNvcmUgPSBuZXcgY29yZSh0aGlzLmMsIHRoaXMuc2NoZW1lLCB0aGlzLm1hcC5mZywgdGhpcy5tYXAuZ3Jhdml0eV9tYXApO1xuICB0aGlzLmNvcmUuc3RhdGUgPSB0aGlzLmNvcmUuYmxhbmtfc3RhdGUoKTtcbiAgdGhpcy5jb3JlLnN0YXRlID0gdGhpcy5jb3JlLnN0YXRlO1xufVxuXG4vKiBJbml0IGdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oZnJhbWUpIHtcbiAgLy8gbWFyayBwbGF5ZXIgZXZlbnRzXG4gIHRoaXMucGxheWVyX2V2ZW50cyA9IHt9O1xuXG4gIC8vIHNldCBnYW1lIHN0YXR1cyB0byBhY3RpdmVcbiAgdGhpcy5hY3RpdmUgPSB0cnVlO1xuXG4gIC8vIHNldCBwbGF5ZXIgb2JqXG4gIHRoaXMuc2V0X3RoaXNfcGxheWVyX3JlZnMoKTtcbiAgdGhpcy5zZXRfc2NvcmUoKTtcblxuICAvLyBzZXQgaW5pdGlhbCBjYW1lcmFcbiAgaWYgKHRoaXMucGxheWVyKSB7XG4gICAgdGhpcy5jYW1lcmEueCA9IHRoaXMucGxheWVyX29iai54O1xuICAgIHRoaXMuY2FtZXJhLnkgPSB0aGlzLnBsYXllcl9vYmoueTtcbiAgfVxufTtcblxuLyogUnVuIGNvcmVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmZyYW1lX2NvcmUgPSBmdW5jdGlvbihmcmFtZSwgYWN0aW9ucykge1xuICAvLyBzZXQgdXAgdGhpcyBzdGF0ZVxuICB0aGlzLmNvcmUuc3RhdGUuZnJhbWUgPSBmcmFtZTtcbiAgdGhpcy5jb3JlLnN0YXRlLmV2ZW50cyA9IFtdO1xuICB2YXIgcmVzcG9uc2UgPSB0aGlzLmNvcmUuYWN0aW9uKHRoaXMucGxheWVyX2lkLCBhY3Rpb25zKTtcblxuICAvLyBydW4gcGxheWVyIGFjdGlvbnNcbiAgdGhpcy5ydW5fcGxheWVyc19ldmVudHMoKTtcblxuICAvLyBydW4gdGhpcyBzdGF0ZVxuICB0aGlzLmNvcmUuZnJhbWUoKTtcblxuICAvLyByZXR1cm4gdGhlIGlucHV0IHJlc3BvbnNlXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFJ1biBkaXNwbGF5XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5mcmFtZV9kaXNwbGF5ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucnVuX29iamVjdHMoKTtcbiAgdGhpcy5ydW5fY3Jvc3NoYWlyKCk7XG4gIHRoaXMucnVuX2NhbWVyYSgpO1xuICB0aGlzLnJ1bl9leHBsb3Npb25zKCk7XG4gIHRoaXMucnVuX2RlY29yYXRpb25zKCk7XG4gIHRoaXMucnVuX2xhYmVscygpO1xuICB0aGlzLnJ1bl9jYW52YXMoKTtcbiAgdGhpcy5ydW5fYXVkaW8oKTtcbiAgdGhpcy5ydW5fdGltZSgpO1xuICB0aGlzLnJ1bl9hbGVydCgpO1xuICB0aGlzLnJ1bl9hcm1vdXJ5KCk7XG5cbiAgLy8gZGV0b25hdGlvbiBjb29sZG93blxuICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gLT0gdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID4gMCA/IDEgOiAwO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRHYW1lXG5cdElucHV0XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogR2V0IGN1cnJlbnQgY29yZSBhY3Rpb24gaW5wdXRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5nZXRfaW5wdXQgPSBmdW5jdGlvbigpIHtcbiAgLy8gaXMgdGhlIGdhbWUgYWN0aXZlIGFuZCBkb2VzIGl0IGhhdmUgYSBwbGF5ZXJcbiAgaWYgKCF0aGlzLmFjdGl2ZSB8fCAhdGhpcy5wbGF5ZXIgfHwgdGhpcy5wbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNldCBzb3VyY2Ugb2YgY3Jvc3NoYWlyIG1vdmVtZW50XG4gIGlmIChcbiAgICB0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfdXBcIikgfHxcbiAgICB0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfZG93blwiKSB8fFxuICAgIHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9sZWZ0XCIpIHx8XG4gICAgdGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3JpZ2h0XCIpXG4gICkge1xuICAgIHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9IFwiYnV0dG9uXCI7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHRoaXMuaW5wdXQuY3Vyc29yX21vdmVkKSB7XG4gICAgICB0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPSBcImN1cnNvclwiO1xuICAgIH1cbiAgfVxuICB0aGlzLmlucHV0LmN1cnNvcl9tb3ZlZCA9IGZhbHNlO1xuXG4gIC8vIGdldCBwbGF5ZXIgYWN0aW9uc1xuICB2YXIgYWN0aXZlID0gZmFsc2U7XG4gIHZhciByZXNwb25zZSA9IHtcbiAgICBhY3Rpb246IFwibm9uZVwiLFxuICAgIGFuZ2xlOiByb3VuZCh0aGlzLmNyb3NzaGFpcilcbiAgfTtcblxuICAvLyB3ZWFwb24ga2V5c1xuICB2YXIgc2hvb3Rfa2V5ID0gZmFsc2U7XG4gIHZhciBmaXJlX3dlYXBvbiA9IGZhbHNlO1xuICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbdGhpcy5jdXJyZW50X3dlYXBvbl07XG4gIGlmICh3ZWFwb24gJiYgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID09PSAwICYmIHRoaXMuaW5wdXQuYWN0aXZlKFwic2hvb3RcIikpIHtcbiAgICAvLyBhYmFuZG9uIGEgZm9sbG93ZWQgd2VhcG9uXG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW3RoaXMud2VhcG9uX2ZvbGxvd2luZ10pIHtcbiAgICAgIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA9IDE1O1xuICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcblxuICAgICAgLy8gbm9ybWFsIGZpcmluZ1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBvbiBzY3JlZW5cbiAgICAgIHZhciBwb3MgPSB0aGlzLnNjcmVlbl9wb3NpdGlvbihcbiAgICAgICAgdGhpcy5wbGF5ZXJfb2JqLngsXG4gICAgICAgIHRoaXMucGxheWVyX29iai55LFxuICAgICAgICB0aGlzLnBsYXllcl9vYmouYy5zaXplXG4gICAgICApO1xuICAgICAgaWYgKCFwb3Mub25fc2NyZWVuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gY29vbGRvd25cbiAgICAgIGlmICh0aGlzLnBsYXllci5jb29sZG93biA+IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbdGhpcy5jdXJyZW50X3dlYXBvbl07XG4gICAgICBpZiAoIXdlYXBvbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAod2VhcG9uLnBvd2VyX3VwICYmIHRoaXMucG93ZXJfdXAgPCA2MCkge1xuICAgICAgICB0aGlzLnBvd2VyX3VwKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaXJlX3dlYXBvbiA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRoaXMucG93ZXJlZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnBvd2VyX3VwID4gMCkge1xuICAgICAgZmlyZV93ZWFwb24gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBvd2VyX3VwID0gMDtcbiAgICB9XG4gIH1cblxuICAvLyBmaXJlIHdlYXBvblxuICBpZiAoZmlyZV93ZWFwb24pIHtcbiAgICB0aGlzLnBvd2VyZWQgPSB0cnVlO1xuICAgIHJlc3BvbnNlLmFjdGlvbiA9IFwic2hvb3RcIjtcbiAgICByZXNwb25zZS5wb3dlciA9IHRoaXMucG93ZXJfdXA7XG4gICAgcmVzcG9uc2Uud2VhcG9uID0gdGhpcy5jdXJyZW50X3dlYXBvbjtcbiAgICBhY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMucG93ZXJfdXAgPSAwO1xuICB9XG5cbiAgLy8gd2Fsa2luZyByZXN0cmljdGVkIGFjdGlvbnNcbiAgaWYgKHRoaXMucGxheWVyX29iai5ncm91bmRlZCAmJiAhYWN0aXZlKSB7XG4gICAgLy8gYXJyb3cga2V5IG1vdmVtZW50XG4gICAgdmFyIGFycm93X2FuZ2xlID0gLTE7XG4gICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV91cFwiKSkge1xuICAgICAgYXJyb3dfYW5nbGUgPSA5MDtcbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAxMzU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSA0NTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9kb3duXCIpKSB7XG4gICAgICBhcnJvd19hbmdsZSA9IDI3MDtcbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAyMjU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAzMDU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAxODA7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAwO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYXJyb3dfYW5nbGUgIT09IC0xKSB7XG4gICAgICByZXNwb25zZS5hY3Rpb24gPSBcIm1vdmVcIjtcbiAgICAgIHJlc3BvbnNlLmFuZ2xlID0gYXJyb3dfYW5nbGU7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIG1vdmUgY3Jvc3NoYWlyIGtleVxuICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVcIikpIHtcbiAgICAgIHJlc3BvbnNlLmFjdGlvbiA9IFwibW92ZVwiO1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBqdW1waW5nXG4gICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwianVtcFwiKSkge1xuICAgICAgcmVzcG9uc2UuYWN0aW9uID0gXCJqdW1wXCI7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNhbmNlbCBtb3VzZSBmb2xsb3cgaWYgZG9pbmcgc3R1ZmZcbiAgaWYgKGFjdGl2ZSkge1xuICAgIHRoaXMuY2FuY2VsX21vdXNlX2ZvbGxvdygpO1xuICB9XG5cbiAgaWYgKCFhY3RpdmUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBzZXQgdGhlIG9uYm9hcmRpbmdcbiAgdGhpcy5vbmJvYXJkaW5nICYmIHRoaXMub25ib2FyZGluZy5zZXQocmVzcG9uc2UuYWN0aW9uKTtcblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFJ1biBPYmplY3RzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQgb2JqZWN0c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV9vYmplY3QgPSBmdW5jdGlvbihwcm9wcywgc3Bhd24pIHtcbiAgLy8gdXNlIGV4aXN0aW5nIHByb3BzIHRvIG1ha2UgbmV3IGNvcmUgb2JqZWN0XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuY3JlYXRlX29iamVjdChwcm9wcyk7XG5cbiAgLy8gcHJldmlvdXMgcG9zaXRpb25cbiAgb2JqLnB4ID0gb2JqLng7XG4gIG9iai5weSA9IG9iai55O1xuICBvYmoucGcgPSBmYWxzZTtcbiAgb2JqLnB4MiA9IG9iai54O1xuICBvYmoucHkyID0gb2JqLnk7XG5cbiAgLy8gZGlzcGxheSB2YWx1ZXNcbiAgb2JqLmhlYWRpbmcgPSAwO1xuICBvYmouaGlkZSA9IDA7XG4gIG9iai5iYXJyZWxfYW5nbGUgPSAwO1xuICBvYmouYWN0aW9uZWQgPSBmYWxzZTtcbiAgb2JqLnBsYXllcl9sb2NrZWQgPSBmYWxzZTtcblxuICAvLyBkaXNwbGF5IHBvc2l0aW9uXG4gIG9iai5keCA9IG9iai54O1xuICBvYmouZHkgPSBvYmoueTtcbiAgb2JqLmRzID0gMDtcblxuICAvLyBjaGVjayBmb3Igc2hvb3QgZXZlbnRzXG4gIHRoaXMuc2V0X3Nob3Rfb2JqZWN0KG9iaik7XG5cbiAgLy8gcHJldmlvdXMgZGlzcGxheSBwb3NpdGlvblxuICBvYmoucGR4ID0gb2JqLng7XG4gIG9iai5wZHkgPSBvYmoueTtcblxuICAvLyBzcGF3blxuICBpZiAob2JqLmMuc3Bhd24gfHwgc3Bhd24pIHtcbiAgICAvLyBoaWRlIG5ldyBvYmplY3QgZm9yIHggZnJhbWVzXG4gICAgb2JqLmhpZGUgPSA5O1xuXG4gICAgLy8gYWRkIGEgc3Bhd24gZGVjb3JhdGlvbiBvdmVyIHRvcFxuICAgIHRoaXMuY3JlYXRlX2RlY29yYXRpb24oe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHRpbWVvdXQ6IDE2LFxuICAgICAgcmVwZWF0OiBmYWxzZSxcbiAgICAgIHR5cGU6IFwic3Bhd25cIixcbiAgICAgIHNwcml0ZTogXCJ0ZWxlcG9ydFwiXG4gICAgfSk7XG5cbiAgICAvLyBwbGF5IHNwYXduIHNvdW5kXG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgc291bmQ6IFwicGhhc2VcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnlcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBTZXQgYSBzaG90IGl0ZW1zIG5ldyBsb2NhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9zaG90X29iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBjaGVjayBmb3IgYSBwbGF5ZXJcbiAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBhbiBhY3Rpb25cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbGF5ZXIuZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGFjdCA9IHBsYXllci5ldmVudHNbaV07XG4gICAgaWYgKGFjdC5vYmogPT09IG9iai5rZXkpIHtcbiAgICAgIG9iai5oaWRlID0gMTAwO1xuICAgIH1cbiAgfVxufTtcblxuLyogUnVuIG9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fb2JqZWN0cyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjaGVjayBmb3IgcGxheWVyIGxvY2tlZCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmIChvYmouYy5wbGF5ZXJfbG9jaykge1xuICAgICAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgb2JqLnBsYXllcl9pZF07XG4gICAgICBpZiAocGxheWVyKSB7XG4gICAgICAgIHBsYXllci5wbGF5ZXJfbG9ja2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB0aGlzLnJ1bl9vYmplY3QodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XSk7XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gc25hcCBpbW1lZGlhdGVseSBpZiB1c1xuICBpZiAob2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICBvYmouZHggPSBvYmoueDtcbiAgICBvYmouZHkgPSBvYmoueTtcblxuICAgIC8vIHByZXZlbnQgYm9iYmxpbmdcbiAgICBpZiAob2JqLnggPT09IG9iai5weDIgJiYgb2JqLnkgPT09IG9iai5weTIpIHtcbiAgICAgIG9iai5keCA9IG9iai5wZHg7XG4gICAgICBvYmouZHkgPSBvYmoucGR5O1xuICAgIH1cblxuICAgIC8vIGludGVycG9sYXRlIG90aGVyc1xuICB9IGVsc2Uge1xuICAgIC8vIGdldCBtYXggc3BlZWQgb2YgbW92ZW1lbnRcbiAgICBpZiAoIW9iai5hY3Rpb25lZCkge1xuICAgICAgb2JqLmRzID0gZ2V0X3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gICAgfVxuXG4gICAgLy8gaW50ZXJwb2xhdGVcbiAgICB2YXIgZGlzdF94ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeChvYmouZHgsIG9iai54KTtcbiAgICB2YXIgZGlzdF95ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeShvYmouZHksIG9iai55KTtcbiAgICB2YXIgbWF4X3NwZWVkID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2Uob2JqLmR4LCBvYmouZHksIG9iai54LCBvYmoueSk7XG4gICAgdmFyIHNwZWVkID0gbWF4KG1heF9zcGVlZCAvIDQsIG1pbihtYXhfc3BlZWQsIG9iai5kcykpO1xuICAgIHZhciBtb3ZlID0gY2hlY2tfc3BlZWQoZGlzdF94LCBkaXN0X3ksIHNwZWVkKTtcbiAgICBvYmouZHggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHggKyByb3VuZChtb3ZlLngpKTtcbiAgICBvYmouZHkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkgKyByb3VuZChtb3ZlLnkpKTtcbiAgfVxuXG4gIC8vIGhhdmUgd2UgbW92ZWRcbiAgdmFyIG1vdmVkID0gb2JqLnBkeCAhPT0gb2JqLmR4IHx8IG9iai5wZHkgIT09IG9iai5keTtcblxuICAvLyBzZXQgaGVhZGluZyBhbmQgYmFycmVsIGFuZ2xlXG4gIGlmIChtb3ZlZCkge1xuICAgIG9iai5oZWFkaW5nID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhvYmoucGR4LCBvYmoucGR5LCBvYmouZHgsIG9iai5keSk7XG4gICAgb2JqLmJhcnJlbF9hbmdsZSA9IGluY3JlbWVudF9hbmdsZShvYmouYmFycmVsX2FuZ2xlLCBvYmouaGVhZGluZywgMyk7XG4gIH1cblxuICAvLyBpcyB1c1xuICBpZiAob2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICBvYmouYmFycmVsX2FuZ2xlID0gb2JqLnBsYXllcl9sb2NrZWQgPyBvYmouaGVhZGluZyA6IHRoaXMuY3Jvc3NoYWlyO1xuICB9XG5cbiAgLy8gaWYgd2UgaGF2ZSBqdXN0IGxhbmRlZCBzZXQgaW5pdGlhbCBhbmdsZVxuICBpZiAob2JqLmdyb3VuZGVkICYmICFvYmoucGcpIHtcbiAgICB2YXIgYW5nbGUgPSBnZXRfYW5nbGUob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgICB2YXIgd2FsayA9IHRoaXMuY29yZS5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai5weCwgb2JqLnB5LCBhbmdsZSwgNik7XG4gICAgaWYgKHdhbGsubW92ZSkge1xuICAgICAgb2JqLmFuZ2xlID0gd2Fsay5hbmdsZTtcbiAgICAgIG9iai5kaXJlY3Rpb24gPSB3YWxrLmRpcmVjdGlvbjtcbiAgICAgIG9iai5weCA9IG9iai54O1xuICAgICAgb2JqLnB5ID0gb2JqLnk7XG4gICAgICBvYmouYW5pbWF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlmIHdhbGtpbmdcbiAgZWxzZSBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgLy8gc2V0IHRoZSBkaXNwbGF5IHZhbHVlc1xuICAgIHZhciBkaXN0X3ggPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV94KG9iai5wZHgsIG9iai5keCk7XG4gICAgdmFyIGRpc3RfeSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kob2JqLnBkeSwgb2JqLmR5KTtcbiAgICB2YXIgYW1vdW50X21vdmVkID0gZ2V0X3NwZWVkKGRpc3RfeCwgZGlzdF95KTtcbiAgICBpZiAoYW1vdW50X21vdmVkID4gMykge1xuICAgICAgb2JqLmFuaW1hdGUgPSB0cnVlO1xuICAgICAgb2JqLmRpcmVjdGlvbiA9IHRoaXMuY29yZS5tYXAuZ3JvdW5kX2RpcihcbiAgICAgICAgb2JqLnBkeCxcbiAgICAgICAgb2JqLnBkeSxcbiAgICAgICAgb2JqLmR4LFxuICAgICAgICBvYmouZHlcbiAgICAgICk7XG4gICAgICBvYmouYW5nbGUgPSBvYmouaGVhZGluZztcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqLmFuaW1hdGUgPSBvYmouYy5hbmltYXRpb24uZ3JvdW5kO1xuICAgIH1cblxuICAgIC8vIHNldCBzcHJpdGVzXG4gICAgdmFyIHN1ZmZpeCA9IG9iai5hbmltYXRlID8gXCItd2Fsay1cIiA6IFwiLXN0aWxsLVwiO1xuICAgIG9iai5zcHJpdGVfa2V5ID0gb2JqLmMuYW5pbWF0aW9uLnNwcml0ZSArIHN1ZmZpeCArIG9iai5kaXJlY3Rpb247XG4gICAgb2JqLmRpc3BsYXlfYW5nbGUgPVxuICAgICAgb2JqLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIgPyBvYmouYW5nbGUgOiBhbmdsZV9hZGQob2JqLmFuZ2xlLCAxODApO1xuXG4gICAgLy8gbm90IHdhbGtpbmdcbiAgfSBlbHNlIHtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5jLmFuaW1hdGlvbi5zcHJpdGU7XG4gICAgb2JqLmFuaW1hdGUgPSB0cnVlO1xuXG4gICAgLy8gcGxheWVyc1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiYgcGxheWVyLmhpdCA9PT0gMCkge1xuICAgICAgb2JqLmRpcmVjdGlvbiA9XG4gICAgICAgIG9iai5iYXJyZWxfYW5nbGUgPj0gOTAgJiYgb2JqLmJhcnJlbF9hbmdsZSA8IDI3MCA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICAgICAgb2JqLnNwcml0ZV9rZXkgKz0gXCItYWlyLVwiICsgb2JqLmRpcmVjdGlvbjtcbiAgICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgICAgb2JqLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCJcbiAgICAgICAgICA/IG9iai5iYXJyZWxfYW5nbGVcbiAgICAgICAgICA6IGFuZ2xlX2FkZChvYmouYmFycmVsX2FuZ2xlLCAxODApO1xuICAgIH1cblxuICAgIC8vIHNwaW5uaW5nIGluIHRoZSBhaXJcbiAgICBlbHNlIGlmIChvYmouYy5hbmltYXRpb24uYWlyX3NwaW4pIHtcbiAgICAgIHZhciBncm91bmQgPSB0aGlzLmNvcmUubWFwLmdyb3VuZF9waXhlbChyb3VuZChvYmouZHgpLCByb3VuZChvYmouZHkpKTtcbiAgICAgIHZhciBzcGVlZCA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICAgICAgdmFyIG4gPSBncm91bmQgPyAwIDogMTtcbiAgICAgIHZhciBhbmdsZV9hZGRpbmcgPSBtb3ZlZCA/IHNwZWVkICogMiA6IG47XG4gICAgICBvYmouZGlzcGxheV9hbmdsZSA9IGFuZ2xlX2FkZChvYmouZGlzcGxheV9hbmdsZSwgYW5nbGVfYWRkaW5nKTtcblxuICAgICAgLy8gcG9pbnRpbmcgdG93YXJkcyB0cmFqZWN0b3J5XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyb3VuZChhYnMob2JqLnNwZWVkX3gpID09PSAwKSAmJiByb3VuZChhYnMob2JqLnNwZWVkX3kpID09PSAwKSkge1xuICAgICAgICBpZiAob2JqLmMuYW5pbWF0aW9uLmFpcl9zcGluKSB7XG4gICAgICAgICAgb2JqLmRpc3BsYXlfYW5nbGUgPSBhbmdsZV9hZGQob2JqLmRpc3BsYXlfYW5nbGUsIDIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmouZGlzcGxheV9hbmdsZSA9IGFuZ2xlX2FkZChcbiAgICAgICAgICBnZXRfYW5nbGUoLW9iai5zcGVlZF94LCAtb2JqLnNwZWVkX3kpLFxuICAgICAgICAgIDkwXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gc3RhdGljIGFuZ2xlIGZsYWdcbiAgaWYgKG9iai5jLmFuaW1hdGlvbi5zdGF0aWNfYW5nbGUpIHtcbiAgICBvYmouZGlzcGxheV9hbmdsZSA9IDA7XG4gIH1cblxuICAvLyB3ZWFwb24ganVzdCBmaXJlZCBmbGFnc1xuICBpZiAob2JqLmZpcmVfc3ByaXRlX2NvdW50KSB7XG4gICAgb2JqLmZpcmVfc3ByaXRlX2NvdW50LS07XG4gIH1cbiAgaWYgKG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQpIHtcbiAgICBvYmouZGlyZWN0aW9uID0gb2JqLmZpcmVfZGlyZWN0aW9uO1xuICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgIG9iai5kaXJlY3Rpb24gPT09IFwibGVmdFwiXG4gICAgICAgID8gb2JqLmZpcmVfYW5nbGVfbG9ja1xuICAgICAgICA6IGFuZ2xlX2FkZChvYmouZmlyZV9hbmdsZV9sb2NrLCAxODApO1xuICAgIG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQtLTtcbiAgfVxuICBpZiAob2JqLmZpcmVfYm9keV9zcHJpdGVfY291bnQpIHtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5maXJlX2JvZHlfc3ByaXRlICsgXCItXCIgKyBvYmouZGlyZWN0aW9uO1xuICAgIG9iai5hbmltYXRlID0gdHJ1ZTtcbiAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZV9jb3VudC0tO1xuICB9XG5cbiAgLy8gcHJldmlvdXMgcG9zaXRpb25cbiAgb2JqLnB4MiA9IG9iai5weDtcbiAgb2JqLnB5MiA9IG9iai5weTtcbiAgb2JqLnB4ID0gb2JqLng7XG4gIG9iai5weSA9IG9iai55O1xuICBvYmoucGcgPSBvYmouZ3JvdW5kZWQ7XG4gIG9iai5wZHggPSBvYmouZHg7XG4gIG9iai5wZHkgPSBvYmouZHk7XG4gIG9iai5wbGF5ZXJfbG9ja2VkID0gZmFsc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFJ1biBQbGF5ZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQgdGhpcyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X3BsYXllciA9IGZ1bmN0aW9uKHBsYXllciwgcHJlc2VydmVfZXZlbnRzLCByZW1vdmVfZXZlbnRzKSB7XG4gIHZhciBuZXdfcGxheWVyO1xuXG4gIC8vIHVzZSBzb3VyY2VzXG4gIGlmIChwbGF5ZXIpIHtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1twbGF5ZXIuaWRdO1xuICAgIGlmIChwcmVzZXJ2ZV9ldmVudHMgJiYgY29yZV9wbGF5ZXIpIHtcbiAgICAgIHBsYXllci5ldmVudHMgPSBjb3JlX3BsYXllci5ldmVudHMuY29uY2F0KHBsYXllci5ldmVudHMpO1xuICAgIH1cbiAgICBuZXdfcGxheWVyID0gdGhpcy5jb3JlLmNyZWF0ZV9wbGF5ZXIocGxheWVyKTtcbiAgICBpZiAocmVtb3ZlX2V2ZW50cykge1xuICAgICAgbmV3X3BsYXllci5ldmVudHMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgbmV3XG4gIH0gZWxzZSB7XG4gICAgbmV3X3BsYXllciA9IHRoaXMuY29yZS5jcmVhdGVfcGxheWVyKHsgaWQ6IHRoaXMucGxheWVyX2lkIH0pO1xuICAgIHRoaXMuY3JlYXRlX29iamVjdCh7IHR5cGU6IFwicGxheWVyXCIsIHBsYXllcl9pZDogdGhpcy5wbGF5ZXJfaWQgfSk7XG4gICAgdGhpcy5jb3JlLmluaXRfcGxheWVyKHRoaXMucGxheWVyX2lkKTtcbiAgfVxuXG4gIC8vIHNldCB0aGlzIHBsYXllclxuICBpZiAobmV3X3BsYXllci5pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICB0aGlzLnBsYXllciA9IG5ld19wbGF5ZXI7XG4gICAgdGhpcy5zZXRfYXJtb3VyeSgpO1xuICB9XG59O1xuXG4vKiBSZXNvbHZlIHBsYXllcnMgZnJvbSBvdGhlciBzdGF0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fcGxheWVyc19ldmVudHMgPSBmdW5jdGlvbihwbGF5ZXJzKSB7XG4gIC8vIGNsZWFyIG9iamVjdCBhY3Rpb25lZCBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XS5hY3Rpb25lZCA9IGZhbHNlO1xuICB9XG5cbiAgLy8gcnVuIHBsYXllciBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgdGhpcy5ydW5fcGxheWVyX2V2ZW50cyh0aGlzLmNvcmUuc3RhdGUucGxheWVyc1trZXldKTtcbiAgfVxuXG4gIC8vIHJlbW92ZSBvbGQgZXZlbnRzXG4gIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVyX2V2ZW50cykge1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnBsYXllcl9ldmVudHNbaWRdKSB7XG4gICAgICBpZiAodGhpcy5jb3JlLnN0YXRlLmZyYW1lID4gdGhpcy5wbGF5ZXJfZXZlbnRzW2lkXVtrZXldICsgMzApIHtcbiAgICAgICAgZGVsZXRlIHRoaXMucGxheWVyX2V2ZW50c1tpZF1ba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9wbGF5ZXJfZXZlbnRzID0gZnVuY3Rpb24ocGxheWVyKSB7XG4gIC8vIGluaXQgcGxheWVyIGV2ZW50c1xuICBpZiAoIXRoaXMucGxheWVyX2V2ZW50c1twbGF5ZXIuaWRdKSB7XG4gICAgdGhpcy5wbGF5ZXJfZXZlbnRzW3BsYXllci5pZF0gPSB7fTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZXZlbnRzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBldmVudCA9IHBsYXllci5ldmVudHNbaV07XG4gICAgdmFyIGtleSA9IGV2ZW50LmZyYW1lICsgXCItXCIgKyBldmVudC50eXBlO1xuICAgIGlmICghdGhpcy5wbGF5ZXJfZXZlbnRzW2tleV0pIHtcbiAgICAgIHRoaXMucGxheWVyX2V2ZW50KHBsYXllciwgZXZlbnQpO1xuICAgICAgdGhpcy5wbGF5ZXJfZXZlbnRzW2tleV0gPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbn07XG5cbi8qIFBsYXllciBhY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5wbGF5ZXJfZXZlbnQgPSBmdW5jdGlvbihwbGF5ZXIsIGV2ZW50KSB7XG4gIC8vIGlzIHRoZXJlIGlzbid0IGFuIGFjdGlvblxuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IHBsYXllciBvYmplY3RcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyLmlkXTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBtYXJrIG9iamVjdCBhcyBoYXZpbmcgcGVyZm9ybWVkIGFuIGFjdGlvblxuICBvYmouYWN0aW9uZWQgPSB0cnVlO1xuXG4gIC8vIG1vdmVtZW50XG4gIGlmIChldmVudC50eXBlID09PSBcIndhbGtcIikge1xuICAgIG9iai5kcyA9IHRoaXMuc2NoZW1lLmxldmVscy5zcGVlZFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLm1vdmU7XG4gIH1cblxuICAvLyBqdW1wXG4gIGlmIChldmVudC50eXBlID09PSBcImp1bXBcIikge1xuICAgIG9iai5kcyA9IHRoaXMuc2NoZW1lLmxldmVscy5qdW1wW3BsYXllci5sZXZlbF0gfHwgb2JqLmMuc3BlZWQuanVtcDtcblxuICAgIC8vIHBsYXkganVtcCBzb3VuZFxuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgIHNvdW5kOiBcImp1bXBcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHNob290aW5nXG4gIGlmIChldmVudC50eXBlID09PSBcInNob290XCIpIHtcbiAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbZXZlbnQud2VhcG9uXTtcbiAgICB2YXIgd2VhcG9uX29iaiA9IHRoaXMuYy5vYmplY3RzW3dlYXBvbi5vYmplY3RdO1xuXG4gICAgLy8gYXJlIHdlIGZpcmluZyB0aGUgd2VhcG9uXG4gICAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPSBtaW4oMjAsIHdlYXBvbi5jb29sZG93bik7XG4gICAgICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSB0aGlzLndlYXBvbl9mb2xsb3cgPyBldmVudC5vYmogOiBcIlwiO1xuXG4gICAgICAvLyBvdGhlciBwbGF5ZXJzIHNob3RzXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBzaG90X29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gICAgICBpZiAoc2hvdF9vYmopIHtcbiAgICAgICAgc2hvdF9vYmouaGlkZSA9IDA7XG4gICAgICAgIHNob3Rfb2JqLmR4ID0gb2JqLmR4O1xuICAgICAgICBzaG90X29iai5keSA9IG9iai5keTtcbiAgICAgICAgb2JqLmJhcnJlbF9hbmdsZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgICAgICAgb2JqLngsXG4gICAgICAgICAgb2JqLnksXG4gICAgICAgICAgc2hvdF9vYmoueCxcbiAgICAgICAgICBzaG90X29iai55XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgYXJlIG5vdCBhIHBsYXllciBhbmQgYXV0byBmb2xsb3cgd2VhcG9uc1xuICAgIGlmICh0aGlzLnBsYXllcl9pZCA9PT0gbnVsbCkge1xuICAgICAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHBhcnNlSW50KHRoaXMubGVhZGVyKSAmJiB3ZWFwb24uYXV0b19mb2xsb3cpIHtcbiAgICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gZXZlbnQub2JqO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHdlYXBvbiBqdXN0IGZpcmVkIHNwcml0ZVxuICAgIGlmICh3ZWFwb24uZmlyZV9zcHJpdGUpIHtcbiAgICAgIHZhciBzcHJpdGVfa2V5ID0gXCJhbnQtd2VhcG9uLVwiICsgd2VhcG9uLmZpcmVfc3ByaXRlO1xuICAgICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYy5hbmltYXRpb25zW3Nwcml0ZV9rZXkgKyBcIi1sZWZ0XCJdO1xuICAgICAgb2JqLmZpcmVfc3ByaXRlID0gc3ByaXRlX2tleTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZV9jb3VudCA9IGFuaW1hdGlvbiA/IGFuaW1hdGlvbi5sZW5ndGggKyAxIDogMTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZV9mcmFtZSA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICB9XG5cbiAgICAvLyB3ZWFwb24gYm9keSBzcHJpdGVcbiAgICBpZiAod2VhcG9uLmZpcmVfYm9keV9zcHJpdGUpIHtcbiAgICAgIHZhciBjb29sID0gd2VhcG9uX29iai50aW1lb3V0XG4gICAgICAgID8gd2VhcG9uX29iai50aW1lb3V0ICsgNVxuICAgICAgICA6IHdlYXBvbi5jb29sZG93biArIDU7XG4gICAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZSA9IFwiYW50LWJvZHktXCIgKyB3ZWFwb24uZmlyZV9ib2R5X3Nwcml0ZTtcbiAgICAgIG9iai5maXJlX2JvZHlfc3ByaXRlX2NvdW50ID0gY29vbDtcbiAgICB9XG5cbiAgICAvLyB3ZWFwb24gYW5nbGUgbG9ja1xuICAgIGlmICh3ZWFwb24uZmlyZV9hbmdsZV9sb2NrKSB7XG4gICAgICB2YXIgY29vbCA9IHdlYXBvbl9vYmoudGltZW91dFxuICAgICAgICA/IHdlYXBvbl9vYmoudGltZW91dCArIDVcbiAgICAgICAgOiB3ZWFwb24uY29vbGRvd24gKyA1O1xuICAgICAgb2JqLmZpcmVfZGlyZWN0aW9uID0gb2JqLmRpcmVjdGlvbjtcbiAgICAgIG9iai5maXJlX2FuZ2xlX2xvY2sgPSBvYmouYmFycmVsX2FuZ2xlO1xuICAgICAgb2JqLmZpcmVfYW5nbGVfbG9ja19jb3VudCA9IGNvb2w7XG4gICAgfVxuXG4gICAgLy8gcGxheSBzb3VuZCBlZmZlY3RcbiAgICB0aGlzLnBsYXlfd2VhcG9uX2F1ZGlvKHtcbiAgICAgIHg6IG9iai5keCxcbiAgICAgIHk6IG9iai5keSxcbiAgICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICAgIHdlYXBvbjogZXZlbnQud2VhcG9uXG4gICAgfSk7XG4gIH1cblxuICAvLyBjb2xsZWN0IGEgY3JhdGUgb3IgbWVkcGFja1xuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJjcmF0ZVwiIHx8IGV2ZW50LnR5cGUgPT09IFwibWVkcGFja1wiKSB7XG4gICAgLy8gcmVtb3ZlIHRoZSBvYmplY3RcbiAgICBpZiAodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbZXZlbnQub2JqXSkge1xuICAgICAgZGVsZXRlIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gICAgfVxuXG4gICAgLy8gcGxheSBzb3VuZCBlZmZlY3RcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7XG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgc291bmQ6IFwibG9ja25sb2FkXCJcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGNvbGxlY3RlZCBhIGdlbVxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJnZW1cIikge1xuICAgIC8vIHJlbW92ZSB0aGUgb2JqZWN0XG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial0pIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdO1xuICAgIH1cblxuICAgIC8vIHBsYXkgc291bmQgZWZmZWN0XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNvdW5kOiBcImJpbmdcIlxuICAgIH0pO1xuICB9XG59O1xuXG4vKiBTZXQgdGhpcyBwbGF5ZXIgcmVmZXJlbmNlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF90aGlzX3BsYXllcl9yZWZzID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldCBwbGF5ZXIgcmVmXG4gIGlmICh0aGlzLmNvcmUuc3RhdGUucGxheWVyc1t0aGlzLnBsYXllcl9pZF0pIHtcbiAgICB0aGlzLnBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXTtcbiAgfVxuXG4gIC8vIHNldCBvYmplY3QgcmVmXG4gIGlmICh0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHRoaXMucGxheWVyX2lkXSkge1xuICAgIHRoaXMucGxheWVyX29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWRdO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFNjb3Jlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIHNjb3JlIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9zY29yZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuc2NoZW1lLnNjb3JlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5kaXZfc2NvcmUgPSBlbGVtZW50KHsgY2xhc3M6IFwic2NvcmVcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9zY29yZSk7XG5cbiAgdGhpcy5kaXZfc2NvcmVfZ2VtID0gZWxlbWVudCh7IGNsYXNzOiBcImdlbVwiIH0pO1xuICB0aGlzLmRpdl9zY29yZV90ZXh0ID0gZWxlbWVudCh7IGNsYXNzOiBcInRleHRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2X3Njb3JlLCB0aGlzLmRpdl9zY29yZV9nZW0pO1xuICBhcHBlbmQodGhpcy5kaXZfc2NvcmUsIHRoaXMuZGl2X3Njb3JlX3RleHQpO1xuXG4gIC8vIGFyZSB3ZSBkb2luZyBsZXZlbHNcbiAgaWYgKHRoaXMuc2NoZW1lLmxldmVscykge1xuICAgIHRoaXMuZGl2X3Njb3JlX2JhciA9IGVsZW1lbnQoeyBjbGFzczogXCJiYXJcIiB9KTtcbiAgICB0aGlzLmRpdl9zY29yZV9iYXJfaW4gPSBlbGVtZW50KHsgY2xhc3M6IFwiYmFyLWlubmVyXCIgfSk7XG4gICAgdGhpcy5kaXZfc2NvcmVfbGV2ZWwgPSBlbGVtZW50KHsgY2xhc3M6IFwibGV2ZWwgaGV4LWJ1dHRvblwiLCB0ZXh0OiBcIiBMVkxcIiB9KTtcbiAgICB0aGlzLmRpdl9zY29yZV9sZXZlbF9udW0gPSBlbGVtZW50KHsgY2xhc3M6IFwibGV2ZWwtbnVtXCIsIHRleHQ6IFwiMVwiIH0pO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfYmFyKTtcbiAgICBhcHBlbmQodGhpcy5kaXZfc2NvcmVfYmFyLCB0aGlzLmRpdl9zY29yZV9iYXJfaW4pO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfbGV2ZWwpO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZV9sZXZlbCwgdGhpcy5kaXZfc2NvcmVfbGV2ZWxfbnVtKTtcbiAgfVxufTtcblxuLyogU2V0IHNjb3JlIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X3Njb3JlID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2NvcmUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLnBsYXllcikge1xuICAgIGhpZGUodGhpcy5kaXZfc2NvcmUpO1xuICAgIHJldHVybjtcbiAgfSBlbHNlIHtcbiAgICBzaG93KHRoaXMuZGl2X3Njb3JlKTtcbiAgfVxuXG4gIHRoaXMuZGl2X3Njb3JlX3RleHQuaW5uZXJIVE1MID0gdGhpcy5wbGF5ZXIuc2NvcmU7XG4gIGlmICh0aGlzLnNjaGVtZS5sZXZlbHMpIHtcbiAgICB0aGlzLmRpdl9zY29yZV9sZXZlbF9udW0uaW5uZXJIVE1MID0gdGhpcy5wbGF5ZXIubGV2ZWwgKyAxO1xuXG4gICAgLy8gZG8gZXhwIGJhclxuICAgIHZhciB3aWR0aCA9IDA7XG4gICAgdmFyIHRoaXNfbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuc2NvcmVbdGhpcy5wbGF5ZXIubGV2ZWxdO1xuICAgIHZhciBuZXh0X2xldmVsID0gdGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlW3RoaXMucGxheWVyLmxldmVsICsgMV07XG4gICAgaWYgKHRoaXNfbGV2ZWwgJiYgbmV4dF9sZXZlbCkge1xuICAgICAgd2lkdGggPSAoXG4gICAgICAgICgodGhpcy5wbGF5ZXIuc2NvcmUgLSB0aGlzX2xldmVsKSAvIChuZXh0X2xldmVsIC0gdGhpc19sZXZlbCkpICpcbiAgICAgICAgOTRcbiAgICAgICkuZml4ZWQoKTtcbiAgICB9XG4gICAgdGhpcy5kaXZfc2NvcmVfYmFyX2luLnN0eWxlLndpZHRoID0gd2lkdGggKyBcIiVcIjtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBUaW1lclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIHRpbWUgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X3RpbWUgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLnNjaGVtZS5zaG93X3RpbWUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB0aW1lIGRpdnNcbiAgdGhpcy5kaXZfdGltZSA9IGVsZW1lbnQoeyBjbGFzczogXCJ0aW1lXCIgfSk7XG4gIHRoaXMuZGl2X3RpbWVvdXQgPSBlbGVtZW50KHsgY2xhc3M6IFwidGltZW91dFwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3RpbWUpO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3RpbWVvdXQpO1xuICBoaWRlKHRoaXMuZGl2X3RpbWVvdXQpO1xuXG4gIHRoaXMuZGlzcGxheV90aW1lID0gXCJcIjtcbn07XG5cbi8qIFJ1biB0aGUgdGltZSBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl90aW1lID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2hvd190aW1lKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNlY3M7XG5cbiAgLy8gY291bnRpbmcgdXBcbiAgaWYgKHRoaXMuc2NoZW1lLnRpbWVfbGltaXQgPT09IDApIHtcbiAgICBzZWNzID0gZmxvb3IodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC8gMjQpO1xuXG4gICAgLy8gY291bnRpbmcgZG93blxuICB9IGVsc2Uge1xuICAgIHZhciBkaWYgPSB0aGlzLnNjaGVtZS50aW1lX2xpbWl0IC0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHNlY3MgPSBjZWlsKGRpZiAvIDI0KTtcblxuICAgIC8vIHRpbWVvdXRcbiAgICBpZiAoZGlmID09PSAyNDApIHtcbiAgICAgIHNob3codGhpcy5kaXZfdGltZW91dCk7XG4gICAgfVxuICAgIGlmIChkaWYgPD0gMjQwICYmIGRpZiAlIDI0ID09PSAwICYmIGRpZiA+IDEpIHtcbiAgICAgIHRoaXMuYXVkaW8ucGxheShcImJsb29wMlwiLCAwLjUpO1xuICAgIH1cbiAgICBpZiAoZGlmID09PSAxKSB7XG4gICAgICBoaWRlKHRoaXMuZGl2X3RpbWVvdXQpO1xuICAgIH1cbiAgICBpZiAoc2VjcyA8PSAxMCkge1xuICAgICAgaWYgKGRpZiAlIDI0ID09PSAwICYmIHNlY3MgPj0gMSkge1xuICAgICAgICB0aGlzLmRpdl90aW1lb3V0LmlubmVySFRNTCA9IHNlY3M7XG4gICAgICB9XG4gICAgICBpZiAoZGlmID09PSA5Nikge1xuICAgICAgICB0aGlzLmF1ZGlvLnBsYXkoXCJ0aW1lb3V0XCIsIDAuOCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGltZVxuICB2YXIgbmV3X3RpbWUgPSBcIjA6MDBcIjtcbiAgaWYgKHNlY3MgPiAwKSB7XG4gICAgdmFyIG1pbnV0ZXMgPSBmbG9vcihzZWNzIC8gNjApLFxuICAgICAgc2Vjb25kcyA9IChzZWNzIC0gbWludXRlcyAqIDYwKS50b1N0cmluZygpO1xuICAgIHNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA8IDIgPyBcIjBcIiArIHNlY29uZHMgOiBzZWNvbmRzO1xuICAgIG5ld190aW1lID0gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcbiAgfVxuICBpZiAodGhpcy5kaXNwbGF5X3RpbWUgIT09IG5ld190aW1lKSB7XG4gICAgdGhpcy5kaXNwbGF5X3RpbWUgPSBuZXdfdGltZTtcbiAgICB0aGlzLmRpdl90aW1lLmlubmVySFRNTCA9IG5ld190aW1lO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTXVsdGlwbGF5ZXJcbiAgICBQbGF5ZXIgRGVhdGhzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ2hlY2sgaWYgd2UncmUgZGVhZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmZyYW1lX2RlYWQgPSBmdW5jdGlvbigpIHtcbiAgLy8gbm90IHJlYWR5IGZvciBhbnkgZGVhdGggc3R1ZmZcbiAgaWYgKCF0aGlzLmdhbWUgfHwgIXRoaXMuZ2FtZS5jb3JlIHx8ICF0aGlzLmdhbWUucGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY291bnQgdXAgdG8gZGVhZG5lc3NcbiAgaWYgKHRoaXMuZ2FtZS5wbGF5ZXIuZGVhZCkge1xuICAgIGlmICghdGhpcy5kZWFkKSB7XG4gICAgICBpZiAodGhpcy53YWl0X2Zvcl9kZWFkIDwgNDgpIHtcbiAgICAgICAgdGhpcy53YWl0X2Zvcl9kZWFkKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRlYXRoKCk7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRoaXMud2FpdF9mb3JfZGVhZCA9IDA7XG4gICAgaWYgKHRoaXMuZGVhZCkge1xuICAgICAgdGhpcy5yZXNwYXduKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gZGVhZG5lc3NcbiAgaWYgKHRoaXMuZGVhZCkge1xuICAgIGlmICh0aGlzLndhaXRfZm9yX3Jlc3Bhd24gPiAwKSB7XG4gICAgICB0aGlzLndhaXRfZm9yX3Jlc3Bhd24tLTtcbiAgICAgIGlmICh0aGlzLndhaXRfZm9yX3Jlc3Bhd24gPT09IDApIHtcbiAgICAgICAgdGhpcy5kaXZfZGVhZF9jb3VudGRvd24uaW5uZXJIVE1MID0gXCJDbGljayB0byByZXNwYXduXCI7XG4gICAgICAgIHJlbW92ZV9jbGFzcyh0aGlzLmJ1dHRvbl9yZXNwYXduLCBcImRpc2FibGVkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kaXZfZGVhZF9jb3VudGRvd24uaW5uZXJIVE1MID1cbiAgICAgICAgICBcIlJlc3Bhd24gaW4gXCIgKyBjZWlsKHRoaXMud2FpdF9mb3JfcmVzcGF3biAvIDI0KSArIFwiIHNlY29uZHNcIjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFdlIGhhdmUgZGllZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmRlYXRoID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZGVhZCA9IHRydWU7XG4gIHRoaXMud2FpdF9mb3JfZGVhZCA9IDA7XG4gIHRoaXMud2FpdF9mb3JfcmVzcGF3biA9IDk2O1xuXG4gIGhpZGUodGhpcy5kaXZfZGVhZF90ZXh0KTtcbiAgYWRkX2NsYXNzKHRoaXMuYnV0dG9uX3Jlc3Bhd24sIFwiZGlzYWJsZWRcIik7XG4gIHNob3codGhpcy5kaXZfZGVhZCk7XG59O1xuXG4vKiBSZXNwYXduIHRyaWdnZXJlZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc3Bhd24gPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5kZWFkID0gZmFsc2U7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTXVsdGlwbGF5ZXJcbiAgICBFdmVudHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gZXZlbnRzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKCFldmVudCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGhhbmRsZSBhcnJheXMgb2YgZXZlbnRzXG4gIGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnQubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMucnVuX2V2ZW50KGV2ZW50W2ldKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcnVuIGV2ZW50c1xuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJmdWxsXCIpIHtcbiAgICB0aGlzLmdhbWVfZnVsbCgpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiY29ubmVjdGVkXCIpIHtcbiAgICB0aGlzLmNvbm5lY3RlZChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3YWl0X2Zvcl9jb25uZWN0aW9uXCIpIHtcbiAgICB0aGlzLndhaXRfZm9yX2Nvbm5lY3Rpb24oKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9qb2luXCIpIHtcbiAgICB0aGlzLnBsYXllcl9qb2luKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9sZWF2ZVwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfbGVhdmUoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2FtZV93YWl0XCIpIHtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdhbWVfc3RhcnRcIikge1xuICAgIHRoaXMuZ2FtZV9zdGFydChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJnYW1lX2VuZFwiKSB7XG4gICAgdGhpcy5nYW1lX2VuZChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJnYW1lX3N0YXRlXCIpIHtcbiAgICB0aGlzLmdhbWVfc3RhdGVfcmVjZWl2ZWQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiY29sbGVjdFwiKSB7XG4gICAgdGhpcy5ldmVudF9jb2xsZWN0KGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdyb3VuZF9kYW1hZ2VcIikge1xuICAgIHRoaXMuZXZlbnRfZ3JvdW5kX2RhbWFnZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJwbGF5ZXJfZGVhdGhcIikge1xuICAgIHRoaXMuZXZlbnRfcGxheWVyX2RlYXRoKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcIndlYXBvbl9zZWxlY3RlZFwiKSB7XG4gICAgdGhpcy5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcIndlYXBvbl9zZWxlY3RlZFwiLCBbZXZlbnQud2VhcG9uXSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJwaW5nXCIpIHtcbiAgICB0aGlzLmV2ZW50X3BpbmcoZXZlbnQpO1xuICB9XG5cbiAgLy8gc2VuZCBldmVudCBkb3duIGEgbGV2ZWxcbiAgZWxzZSBpZiAodGhpcy5nYW1lKSB7XG4gICAgdGhpcy5nYW1lLnJ1bl9ldmVudChldmVudCk7XG4gIH1cbn07XG5cbi8qIENvbGxlY3RlZCBpdGVtXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZXZlbnRfY29sbGVjdCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmICh0aGlzLmluaXRpYWxpc2VkKSB7XG4gICAgLy8gd2FpdCB0byByZWNyZWF0ZVxuICAgIHRoaXMud2FpdF90b19jcmVhdGVbZXZlbnQub2JqXSA9IHRoaXMuZ2FtZS5jb3JlLnN0YXRlLmZyYW1lO1xuXG4gICAgLy8gcnVuIGNsaWVudCBjb2xsZWN0aW9uIGV2ZW50c1xuICAgIHRoaXMuZ2FtZS5ydW5fZXZlbnQoZXZlbnQpO1xuXG4gICAgLy8gcnVuIHBsYXllcnMgaW50ZXJmYWNlXG4gICAgdGhpcy5wbGF5ZXJzX2ludGVyZmFjZSgpO1xuICB9XG59O1xuXG4vKiBQbGF5ZXIgZGVhdGhcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ldmVudF9wbGF5ZXJfZGVhdGggPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBvbmx5IHVzZSBzZXJ2ZXIgZXZlbnRzXG4gIGlmICghZXZlbnQuZnJvbV9zZXJ2ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBydW4gaXRcbiAgaWYgKHRoaXMuaW5pdGlhbGlzZWQpIHtcbiAgICB0aGlzLnBsYXllcl9kZWF0aChldmVudCk7XG4gIH1cbn07XG5cbi8qIFBpbmdcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ldmVudF9waW5nID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gZGlkIHdlIHJlcXVlc3QgdGhpc1xuICBpZiAoIXRoaXMucGluZ3NbZXZlbnQuZnJhbWVdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gIC8vIHJlY29yZCBlbmQgdGltZSBmb3IgcGluZ1xuICB0aGlzLnBpbmdzW2V2ZW50LmZyYW1lXS5lbmQgPSBub3c7XG5cbiAgLy8gZ28gdGhyb3VnaCBhbGwgcGluZ3NcbiAgdmFyIHBpbmdfY291bnQgPSAwO1xuICB2YXIgcGluZ190b3RhbCA9IDA7XG4gIGZvciAodmFyIGZyYW1lIGluIHRoaXMucGluZ3MpIHtcbiAgICB2YXIgcGluZyA9IHRoaXMucGluZ3NbZnJhbWVdO1xuXG4gICAgLy8gcmVtb3ZlIG9sZCBvbmVzXG4gICAgaWYgKHBpbmcuZW5kICYmIHBpbmcuZW5kICsgMTAwMDAgPCBub3cpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLnBpbmdzW2ZyYW1lXTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGNhbGN1bGF0ZSBhdmVyYWdlXG4gICAgcGluZ190b3RhbCArPSBwaW5nLmVuZCAtIHBpbmcuc3RhcnQ7XG4gICAgcGluZ19jb3VudCsrO1xuICB9XG5cbiAgLy8gc2hvdyBwaW5nXG4gIHRoaXMuZGl2X3BpbmcuaW5uZXJIVE1MID0gcm91bmQocGluZ190b3RhbCAvIHBpbmdfY291bnQpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bGl0cGxheWVyXG4gICAgRnJhbWVzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQvc3RvcCBsb29wXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUubG9vcF9zdGFydCA9IGZ1bmN0aW9uKHN0YXJ0X2ZyYW1lKSB7XG4gIC8vIGNsb3NlIGFueSBvcGVuIGxvb3BzXG4gIHRoaXMubG9vcF9zdG9wKCk7XG5cbiAgLy8gc2V0IGxvb3AgdmFyc1xuICB0aGlzLnN0YXJ0X2ZyYW1lID0gc3RhcnRfZnJhbWUgfHwgMDtcbiAgdGhpcy5mcmFtZXMgPSB0aGlzLnN0YXJ0X2ZyYW1lO1xuICB0aGlzLnN0YXJ0X3RpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICBzZWxmLnJ1bl90aWNrKCk7XG4gIH0sIDEwKTtcbn07XG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5sb29wX3N0b3AgPSBmdW5jdGlvbigpIHtcbiAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbn07XG5cbi8qIFJ1biB0aWNrXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucnVuX3RpY2sgPSBmdW5jdGlvbigpIHtcbiAgLy8gY2FsY3VsYXRlIG51bWJlciBvZiBmcmFtZXMgc2luY2UgZ2FtZSBzdGFydFxuICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gIHZhciBmcmFtZXMgPVxuICAgIHRoaXMuc3RhcnRfZnJhbWUgKyBNYXRoLmZsb29yKChub3cgLSB0aGlzLnN0YXJ0X3RpbWUpIC8gdGhpcy5tc19sb29wKTtcblxuICAvLyBnZXQgbnVtYmVyIG9mIHJlbWFpbmluZyBzdGVwc1xuICB2YXIgZnJhbWVfZGlmZmVyZW5jZSA9IGZyYW1lcyAtIHRoaXMuZnJhbWVzO1xuXG4gIC8vIHdhaXRpbmdcbiAgaWYgKGZyYW1lX2RpZmZlcmVuY2UgPCAxKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gdG9vIG11Y2ggbGFnXG4gIGlmIChmcmFtZV9kaWZmZXJlbmNlID4gMTApIHtcbiAgICB0aGlzLmxvb3Bfc3RhcnQoKTtcbiAgICAvLyBjb25zb2xlLmxvZyhcInRpY2sgbGFnIHwgXCIgKyBmcmFtZV9kaWZmZXJlbmNlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGZyYW1lcyB0byBwcm9jZXNzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZnJhbWVfZGlmZmVyZW5jZTsgaSsrKSB7XG4gICAgdGhpcy5mcmFtZSgpO1xuICB9XG5cbiAgLy8gcnVuIGRpc3BsYXkgbG9vcFxuICB0aGlzLmdhbWUuZnJhbWVfZGlzcGxheSgpO1xuXG4gIC8vIHJlY29yZCB0aW1lIHRoaXMgd2FzIGRvbmVcbiAgdGhpcy5mcHNlcy5wdXNoKG5ldyBEYXRlKCkuZ2V0VGltZSgpKTtcbiAgaWYgKHRoaXMuZnBzZXMubGVuZ3RoID4gNzIpIHtcbiAgICB0aGlzLmRpdl9mcHMuaW5uZXJIVE1MID0gcm91bmQoXG4gICAgICAoMzAwMCAvICh0aGlzLmZwc2VzWzcyXSAtIHRoaXMuZnBzZXNbMF0pKSAqIHRoaXMuZnBzXG4gICAgKTtcbiAgICB0aGlzLmZwc2VzLnNwbGljZSgwLCAxKTtcbiAgfVxufTtcblxuLyogRnJhbWUgcHJvY2Vzc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmZyYW1lID0gZnVuY3Rpb24oKSB7XG4gIC8vIGluY3JlbWVudCBmcmFtZSBjb3VudFxuICB0aGlzLmZyYW1lcysrO1xuXG4gIC8vIHN0b3JlIGlucHV0XG4gIGlmICh0aGlzLmdhbWUucGxheWVyKSB7XG4gICAgdmFyIGFjdGlvbiA9IHRoaXMuZ2FtZS5nZXRfaW5wdXQoKTtcbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICB0aGlzLnN0b3JlX2lucHV0W3RoaXMuZnJhbWVzXSA9IGFjdGlvbjtcbiAgICAgIHRoaXMuc2VuZF9pbnB1dChhY3Rpb24pO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJ1biBmcmFtZVxuICB0aGlzLmZyYW1lX3J1bih0aGlzLmZyYW1lcyk7XG5cbiAgLy8gcmVtb3ZlIG9sZCBzdGF0ZXNcbiAgdGhpcy5yZW1vdmVfb2xkX3N0YXRlcygpO1xuXG4gIC8vIHJ1biBncm91bmQgZGFtYWdlIGNoZWNrc1xuICB0aGlzLmZyYW1lX2dyb3VuZCgpO1xuXG4gIC8vIHJ1biBkZWF0aCBmcmFtZXNcbiAgdGhpcy5mcmFtZV9kZWFkKCk7XG5cbiAgLy8gcnVuIHBsYXllcnMgaW50ZXJmYWNlXG4gIGlmICh0aGlzLmZyYW1lcyAlIDQ4ID09PSAwKSB7XG4gICAgdGhpcy5wbGF5ZXJzX2ludGVyZmFjZSgpO1xuICB9XG5cbiAgLy8gcnVuIHBpbmdcbiAgaWYgKHRoaXMuZnJhbWVzICUgMTIgPT09IDApIHtcbiAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwicGluZ1wiLCBbdGhpcy5mcmFtZXNdKTtcbiAgICB0aGlzLnBpbmdzW3RoaXMuZnJhbWVzXSA9IHsgc3RhcnQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpIH07XG4gIH1cbn07XG5cbi8qIEZyYW1lIHJ1blxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmZyYW1lX3J1biA9IGZ1bmN0aW9uKGZyYW1lKSB7XG4gIC8vIHJ1biBjb3JlIGFuZCBzdG9yZSByZXNwb25zZVxuICB2YXIgcmVzcG9uc2UgPSB0aGlzLmdhbWUuZnJhbWVfY29yZShmcmFtZSwgdGhpcy5zdG9yZV9pbnB1dFtmcmFtZV0pO1xuICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgIHRoaXMuc3RvcmVfcmVzcG9uc2VzLnB1c2gocmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gZXZlbnRzXG4gIHRoaXMucnVuX2V2ZW50KHRoaXMuZ2FtZS5jb3JlLnN0YXRlLmV2ZW50cyk7XG5cbiAgLy8gdW5wYWNrIGFueSBzdG9yZWQgc2VydmVyIHN0YXRlIGZvciB0aGlzIGZyYW1lXG4gIGlmICh0aGlzLnN0b3JlX3BhY2tldFtmcmFtZV0pIHtcbiAgICB0aGlzLnNldF9nYW1lX3N0YXRlKHRoaXMuc3RvcmVfcGFja2V0W2ZyYW1lXSk7XG4gICAgZGVsZXRlIHRoaXMuc3RvcmVfcGFja2V0W2ZyYW1lXTtcbiAgfVxuXG4gIC8vIHJlY29yZCBnYW1lIHN0YXRlXG4gIHRoaXMuc3RvcmVfc3RhdGVbZnJhbWVdID0ge1xuICAgIGZyYW1lczogZnJhbWUsXG4gICAgc3RhdGU6IHRoaXMuZ2FtZS5jb3JlLnBhY2tfc3RhdGUodGhpcy5nYW1lLmNvcmUuc3RhdGUpXG4gIH07XG59O1xuXG4vKiBSZW1vdmUgb2xkIHN0YXRlc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlbW92ZV9vbGRfc3RhdGVzID0gZnVuY3Rpb24oKSB7XG4gIGZvciAodmFyIGZyYW1lIGluIHRoaXMuc3RvcmVfcGFja2V0KSB7XG4gICAgaWYgKHBhcnNlSW50KGZyYW1lKSArIDUwIDwgdGhpcy5mcmFtZXMpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLnN0b3JlX3BhY2tldFtmcmFtZV07XG4gICAgfVxuICB9XG4gIGZvciAodmFyIGZyYW1lIGluIHRoaXMuc3RvcmVfc3RhdGUpIHtcbiAgICBpZiAocGFyc2VJbnQoZnJhbWUpICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgZGVsZXRlIHRoaXMuc3RvcmVfc3RhdGVbZnJhbWVdO1xuICAgIH1cbiAgfVxuICBmb3IgKHZhciBmcmFtZSBpbiB0aGlzLnN0b3JlX2lucHV0KSB7XG4gICAgaWYgKHBhcnNlSW50KGZyYW1lKSArIDUwIDwgdGhpcy5mcmFtZXMpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLnN0b3JlX2lucHV0W2ZyYW1lXTtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN0b3JlX3Jlc3BvbnNlcy5sZW5ndGg7IGkrKykge1xuICAgIGlmICh0aGlzLnN0b3JlX3Jlc3BvbnNlc1tpXS5mcmFtZSArIDUwIDwgdGhpcy5mcmFtZXMpIHtcbiAgICAgIHRoaXMuc3RvcmVfcmVzcG9uc2VzLnNwbGljZShpLCAxKTtcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWxpdHBsYXllclxuICAgIEdyb3VuZCBEYW1hZ2VcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBEYW1hZ2UgdGhlIGdyb3VuZCBldmVudFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmV2ZW50X2dyb3VuZF9kYW1hZ2UgPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIga2V5ID0gZXZlbnQuZnJhbWUgKyBcIi1cIiArIGV2ZW50LnggKyBcIi1cIiArIGV2ZW50LnkgKyBcIi1cIiArIGV2ZW50LnJhZGl1cztcblxuICAvLyBkaWQgd2UgYWxyZWFkeSBoYXZlIHRoaXMgaGFwcGVuXG4gIGlmICh0aGlzLmdyb3VuZF9ldmVudHNba2V5XSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCBib3VuZGFyaWVzXG4gIHZhciB4MSA9IG1heChyb3VuZChldmVudC54IC0gZXZlbnQucmFkaXVzKSwgMCk7XG4gIHZhciB4MiA9IG1pbihyb3VuZChldmVudC54ICsgZXZlbnQucmFkaXVzKSwgdGhpcy5nYW1lLmNvcmUubWFwLncgLSAxKTtcbiAgdmFyIHkxID0gbWF4KHJvdW5kKGV2ZW50LnkgLSBldmVudC5yYWRpdXMpLCAwKTtcbiAgdmFyIHkyID0gbWluKHJvdW5kKGV2ZW50LnkgKyBldmVudC5yYWRpdXMpLCB0aGlzLmdhbWUuY29yZS5tYXAuaCAtIDEpO1xuICB2YXIgdyA9IHgyIC0geDE7XG4gIHZhciBoID0geTIgLSB5MTtcblxuICAvLyBnZXQgYXJyYXkgZnJvbSB0aGUgbWFwXG4gIHZhciBhcnIgPSB0aGlzLmdhbWUuY29yZS5tYXAuZ2V0X2Jsb2NrKHgxLCB5MSwgdywgaCk7XG5cbiAgLy8gZ2V0IHBpZWNlIG9mIHRoZSBtYXBcbiAgdmFyIGNhbnYgPSB0aGlzLmdhbWUuZ2V0X2xhbmRfYmxvY2soeDEsIHkxLCB3LCBoKTtcblxuICAvLyBzdG9yZSBiYWNrZWQgdXAgZGFtYWdlXG4gIHRoaXMuZ3JvdW5kX3RlbXBba2V5XSA9IHtcbiAgICBmcmFtZTogZXZlbnQuZnJhbWUsXG4gICAgeDogeDEsXG4gICAgeTogeTEsXG4gICAgYXJyOiBhcnIsXG4gICAgY2FudjogY2FudlxuICB9O1xuXG4gIC8vIHN0b3JlIHRoZSBldmVudCBpdHNlbGZcbiAgdGhpcy5ncm91bmRfZXZlbnRzW2tleV0gPSBkdXBsaWNhdGVfb2JqKGV2ZW50KTtcbiAgdGhpcy5ncm91bmRfZXZlbnRzW2tleV0uZG9uZSA9IHRydWU7XG5cbiAgLy8gcnVuIHRoZSBldmVudFxuICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcbn07XG5cbi8qIENoZWNrIGdyb3VuZCBkYW1hZ2UgZXZlbnRzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWVfZ3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gIC8vIGdvIHRocm91Z2ggYWxsIGNoZWNrc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5ncm91bmRfdGVtcCkge1xuICAgIGlmICh0aGlzLmZyYW1lcyA+IHRoaXMuZ3JvdW5kX3RlbXBba2V5XS5mcmFtZSArIDQwKSB7XG4gICAgICBjbG9nKFwiZGFtYWdlIG5vdCBjb25maXJtZWRcIik7XG4gICAgICB0aGlzLnVuZG9fZ3JvdW5kX2RhbWFnZSh0aGlzLmdyb3VuZF90ZW1wW2tleV0sIGtleSk7XG4gICAgICBkZWxldGUgdGhpcy5ncm91bmRfdGVtcFtrZXldO1xuICAgICAgZGVsZXRlIHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldO1xuICAgIH1cbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggYWxsIGV2ZW50c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5ncm91bmRfZXZlbnRzKSB7XG4gICAgdmFyIGV2ZW50ID0gdGhpcy5ncm91bmRfZXZlbnRzW2tleV07XG4gICAgaWYgKHRoaXMuZnJhbWVzID49IGV2ZW50LmZyYW1lKSB7XG4gICAgICBpZiAoIWV2ZW50LmRvbmUpIHtcbiAgICAgICAgdGhpcy5nYW1lLnJ1bl9ldmVudChldmVudCk7XG4gICAgICAgIHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldLmRvbmUgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5mcmFtZXMgPiB0aGlzLmdyb3VuZF9ldmVudHNba2V5XS5mcmFtZSArIDUwKSB7XG4gICAgICBkZWxldGUgdGhpcy5ncm91bmRfZXZlbnRzW2tleV07XG4gICAgfVxuICB9XG59O1xuXG4vKiBVbmRvIGdyb3VuZCBkYW1hZ2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS51bmRvX2dyb3VuZF9kYW1hZ2UgPSBmdW5jdGlvbihkYW1hZ2UsIGRfa2V5KSB7XG4gIC8vIHJlc3RvcmUgaXRcbiAgdGhpcy5nYW1lLmNvcmUubWFwLnNldF9ibG9ja19mcm9tX2FycihkYW1hZ2UueCwgZGFtYWdlLnksIGRhbWFnZS5hcnIpO1xuICB0aGlzLmdhbWUuZHJhd19sYW5kX2Jsb2NrKGRhbWFnZS54LCBkYW1hZ2UueSwgZGFtYWdlLmNhbnYpO1xuXG4gIC8vIHJlZG8gYW55IG90aGVyIGV2ZW50cyB0aGF0IGhhcHBlbmVkIHNpbmNlXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdyb3VuZF9ldmVudHMpIHtcbiAgICBpZiAoZF9rZXkgPT09IGtleSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHRoaXMuZ2FtZS5ydW5fZXZlbnQodGhpcy5ncm91bmRfZXZlbnRzW2tleV0pO1xuICB9XG59O1xuXG4vKiBTZXJ2ZXIgcmVzcG9uc2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX2dyb3VuZCA9IGZ1bmN0aW9uKHN0cikge1xuICBpZiAoIXN0cikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHVucGFjayBkYW1hZ2VzXG4gIHZhciBzcGxpdCA9IHN0ci5zcGxpdChcIiRcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc3BsaXQyID0gc3BsaXRbaV0uc3BsaXQoXCJ+XCIpO1xuICAgIHZhciBldmVudCA9IHtcbiAgICAgIHR5cGU6IFwiZ3JvdW5kX2RhbWFnZVwiLFxuICAgICAgZnJhbWU6IHBhcnNlSW50KHNwbGl0MlswXSksXG4gICAgICB4OiBwYXJzZUZsb2F0KHNwbGl0MlsxXSksXG4gICAgICB5OiBwYXJzZUZsb2F0KHNwbGl0MlsyXSksXG4gICAgICByYWRpdXM6IHBhcnNlRmxvYXQoc3BsaXQyWzNdKSxcbiAgICAgIGRpZzogc3BsaXQyWzRdID09PSBcIjFcIlxuICAgIH07XG4gICAgdmFyIGtleSA9IGV2ZW50LmZyYW1lICsgXCItXCIgKyBldmVudC54ICsgXCItXCIgKyBldmVudC55ICsgXCItXCIgKyBldmVudC5yYWRpdXM7XG5cbiAgICAvLyBjb25maXJtIGFscmVhZHkgZG9uZSBkYW1hZ2VcbiAgICBpZiAodGhpcy5ncm91bmRfdGVtcFtrZXldKSB7XG4gICAgICBkZWxldGUgdGhpcy5ncm91bmRfdGVtcFtrZXldO1xuXG4gICAgICAvLyB3YWl0IHRvIHBlcmZvcm0gaXRcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ncm91bmRfZXZlbnRzW2tleV0gPSBldmVudDtcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWx0aXBsYXllclxuICAgIEludGVyZmFjZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEluaXQgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuaW5pdF9pbnRlcmZhY2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gbG9hZGluZyBzY3JlZW5cbiAgdGhpcy5sb2FkaW5nID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OiBcIkxvYWRpbmcuLi48YnI+PGJyPjxkaXYgY2xhc3M9J2xvYWRlcic+PC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5sb2FkaW5nKTtcbiAgaGlkZSh0aGlzLmxvYWRpbmcpO1xuXG4gIC8vIGJldHdlZW4gZ2FtZXMgc2NyZWVuXG4gIHRoaXMuYmV0d2Vlbl9nYW1lcyA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJEaW1lbnNpb24ganVtcCBpbiBwcm9ncmVzcyE8YnI+PGJyPjxkaXYgY2xhc3M9J2xvYWRlcic+PC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5iZXR3ZWVuX2dhbWVzKTtcbiAgaGlkZSh0aGlzLmJldHdlZW5fZ2FtZXMpO1xuXG4gIC8vIHBlcmZvcm1hbmNlXG4gIHRoaXMuZGl2X3BpbmcgPSBlbGVtZW50KHsgY2xhc3M6IFwicGluZ1wiIH0pO1xuICB0aGlzLmRpdl9mcHMgPSBlbGVtZW50KHsgY2xhc3M6IFwiZnBzXCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfcGluZyk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfZnBzKTtcblxuICAvLyBkZWFkIGRpdlxuICB0aGlzLmRpdl9kZWFkID0gZWxlbWVudCh7IGNsYXNzOiBcImZ1bGwgZnVsbF9iZ1wiIH0pO1xuICB0aGlzLmRpdl9kZWFkX2NvbnQgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlciByZWRcIixcbiAgICB0ZXh0OiBcIjxoMz5Zb3UgaGF2ZSBkaWVkITwvaDM+XCJcbiAgfSk7XG4gIHRoaXMuZGl2X2RlYWRfdGV4dCA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwicFwiLFxuICAgIHRleHQ6IFwiWW91IHdlcmUga2lsbGVkIGluIGFjdGlvbi5cIlxuICB9KTtcbiAgdGhpcy5kaXZfZGVhZF9jb3VudGRvd24gPSBlbGVtZW50KHsgdHlwZTogXCJwXCIsIGNsYXNzOiBcImdyZXlcIiB9KTtcbiAgdGhpcy5kaXZfZGVhZF9idXR0b25zID0gZWxlbWVudCh7IGNsYXNzOiBcImJ1dHRvbnNcIiB9KTtcbiAgdGhpcy5idXR0b25fcmVzcGF3biA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnV0dG9uIHJlZCBkaXNhYmxlZFwiLFxuICAgIHRleHQ6IFwiUmVzcGF3blwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X2RlYWQpO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZCwgdGhpcy5kaXZfZGVhZF9jb250KTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWRfY29udCwgdGhpcy5kaXZfZGVhZF90ZXh0KTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWRfY29udCwgdGhpcy5kaXZfZGVhZF9jb3VudGRvd24pO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZF9jb250LCB0aGlzLmRpdl9kZWFkX2J1dHRvbnMpO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZF9idXR0b25zLCB0aGlzLmJ1dHRvbl9yZXNwYXduKTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcblxuICAvLyBnYW1lIGZ1bGwgc2NyZWVuXG4gIHRoaXMuZnVsbCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDpcbiAgICAgIFwiR2FtZSBzZXJ2ZXIgZnVsbC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmZ1bGwpO1xuICBoaWRlKHRoaXMuZnVsbCk7XG5cbiAgLy8gcmVzcGF3biBvbiBjbGlja1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuYnV0dG9uX3Jlc3Bhd24ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChzZWxmLndhaXRfZm9yX3Jlc3Bhd24gPT09IDApIHtcbiAgICAgIHNlbGYuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJyZXNwYXduXCIsIFtdKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gcGxheWVyc1xuICB0aGlzLmRpdl9wbGF5ZXJzID0gZWxlbWVudCh7IGNsYXNzOiBcInBsYXllcnNcIiB9KTtcbiAgdGhpcy50YWJsZV9wbGF5ZXJzID0gZWxlbWVudCh7IHR5cGU6IFwidGFibGVcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9wbGF5ZXJzKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3BsYXllcnMsIHRoaXMudGFibGVfcGxheWVycyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gbXVsdGlwbGF5ZXIoXG4gIGFzc2V0cyxcbiAgYXNzZXRzX3VybCxcbiAgYXVkaW8sXG4gIGlucHV0LFxuICBuYW1lLFxuICB3YXRjaGVyLFxuICBydW5fZXZlbnQsXG4gIHNvY2tldHMsXG4gIG9uYm9hcmRpbmdcbikge1xuICAvLyBzZXR1cFxuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hc3NldHNfdXJsID0gYXNzZXRzX3VybDtcbiAgdGhpcy5hdWRpbyA9IGF1ZGlvO1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMud2F0Y2hlciA9IHdhdGNoZXI7XG4gIHRoaXMudG9wX2V2ZW50ID0gcnVuX2V2ZW50O1xuICB0aGlzLnNvY2tldHMgPSBzb2NrZXRzO1xuICB0aGlzLnNjaGVtZSA9IG51bGw7XG4gIHRoaXMubGFnID0gMDtcbiAgdGhpcy5vbmJvYXJkaW5nID0gb25ib2FyZGluZztcblxuICAvLyBsb29wXG4gIHRoaXMuZnBzID0gMjQ7XG4gIHRoaXMubXNfbG9vcCA9IE1hdGguZmxvb3IoMTAwMCAvIHRoaXMuZnBzKTtcbiAgdGhpcy5tc190aWNrID0gMTA7XG4gIHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cbiAgLy8gbWFpbiBkaXZzXG4gIHRoaXMuZGl2ID0gZWxlbWVudCh7IGNsYXNzOiBcImZ1bGxcIiB9KTtcbiAgdGhpcy5jb25uZWN0aW5nID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OiBcIldhaXRpbmcgZm9yIGNvbm5lY3Rpb24uLi48YnI+PGJyPjxkaXYgY2xhc3M9J2xvYWRlcic+PC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5jb25uZWN0aW5nKTtcblxuICAvLyBzZXQgdXAgaW50ZXJmYWNlXG4gIHRoaXMuaW5pdF9pbnRlcmZhY2UoKTtcblxuICAvLyB3aGVuIGpvaW5pbmcgYSBnYW1lIHJlY29yZCBhbnkgaW5jb21pbmcgZXZlbnRzIGZvciBsYXRlciB1c2VcbiAgdGhpcy5pbml0aWFsX2dhbWVfZXZlbnRzID0gW107XG59XG5cbi8qIFdhaXQgZm9yIGNvbm5lY3Rpb25cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS53YWl0X2Zvcl9jb25uZWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5sb29wX3N0b3AoKTtcbiAgaGlkZSh0aGlzLmJldHdlZW5fZ2FtZXMpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG4gIHNob3codGhpcy5jb25uZWN0aW5nKTtcbn07XG5cbi8qIENvbm5lY3RlZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmNvbm5lY3RlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIHNldCB1cCBzY2hlbWVcbiAgdGhpcy5zY2hlbWUgPSBkZWVwbWVyZ2Uoc2NoZW1lcy5kZWZhdWx0LCBzY2hlbWVzW2V2ZW50LnNjaGVtZV0pO1xuXG4gIC8vIGFjdGl2ZSB2YWx1ZXNcbiAgdGhpcy5uYW1lID0gZXZlbnQubmFtZTtcbiAgdGhpcy5wbGF5ZXJfaWQgPSBldmVudC5wbGF5ZXJfaWQ7XG4gIHRoaXMucGxheWVyX2NvdW50ID0gMDtcbiAgdGhpcy5wbGF5ZXJzID0ge307XG4gIHRoaXMucGxheWVyc19yZWYgPSB7fTtcblxuICAvLyBnbyB0aHJvdWdoIHN0cmluZyBvZiBwbGF5ZXJzXG4gIHZhciBzcGxpdCA9IGV2ZW50LnBsYXllcnMuc3BsaXQoXCIrXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwbGl0MiA9IHNwbGl0W2ldLnNwbGl0KFwiL1wiKTtcbiAgICB0aGlzLmluaXRfcGxheWVyKHtcbiAgICAgIHVzZXJfaWQ6IHNwbGl0MlswXSxcbiAgICAgIG5hbWU6IHNwbGl0MlsxXSxcbiAgICAgIHBsYXllcl9pZDogcGFyc2VJbnQoc3BsaXQyWzJdKVxuICAgIH0pO1xuICB9XG5cbiAgLy8gcnVuIHRoZSBwbGF5ZXIgaW50ZXJmYWNlXG4gIHRoaXMucGxheWVyc19pbnRlcmZhY2UoKTtcbn07XG5cbi8qIFN0YXJ0IGdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX3N0YXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5sb2FkaW5nX3N0YXJ0ID0gdHJ1ZTtcbiAgdGhpcy5pbml0aWFsaXNlZCA9IGZhbHNlO1xuICB0aGlzLmdyYXZpdHlfbWFwID0gZXZlbnQuZ3Jhdml0eV9tYXA7XG5cbiAgdGhpcy5nYW1lX2Nsb3NlKCk7XG5cbiAgLy8gcmVzZXQgc2NvcmVzXG4gIGlmIChldmVudC5yZXNldF9wbGF5ZXJzKSB7XG4gICAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzKSB7XG4gICAgICB0aGlzLnBsYXllcnNbaWRdLmxldmVsID0gMDtcbiAgICAgIHRoaXMucGxheWVyc1tpZF0uc2NvcmUgPSAwO1xuICAgIH1cbiAgICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG4gIH1cblxuICAvLyBzdG9yZWQgZ2FtZSBzdGF0ZXMgYW5kIGFjdGlvbnNcbiAgdGhpcy5zdG9yZV9wYWNrZXQgPSB7fTtcbiAgdGhpcy5zdG9yZV9zdGF0ZSA9IHt9O1xuICB0aGlzLnN0b3JlX2lucHV0ID0ge307XG4gIHRoaXMuc3RvcmVfcmVzcG9uc2VzID0gW107XG5cbiAgLy8gZ3JvdW5kIGRhbWFnZVxuICB0aGlzLmdyb3VuZF90ZW1wID0ge307XG4gIHRoaXMuZ3JvdW5kX2V2ZW50cyA9IHt9O1xuXG4gIC8vIG9iamVjdHMgdGhhdCB3ZSBhcmUgd2FpdGluZyBvbiBmb3Igc2VydmVyIGNvbmZpcm1hdGlvblxuICB0aGlzLndhaXRfdG9fZGVzdHJveSA9IHt9O1xuICB0aGlzLndhaXRfdG9fY3JlYXRlID0ge307XG5cbiAgLy8gcGVyZm9ybWFuY2VcbiAgdGhpcy5waW5ncyA9IHt9O1xuICB0aGlzLmZwc2VzID0gW107XG5cbiAgLy8gbG9hZCB0aGUgbWFwIGZyb20gZGF0YSB1cmxcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBuZXcgbG9hZGVyKFxuICAgIFwiXCIsXG4gICAge1xuICAgICAgaW1nOiB7XG4gICAgICAgIGJnOiBldmVudC5iZ19zdHIsXG4gICAgICAgIGZnOiBldmVudC5mZ19zdHJcbiAgICAgIH1cbiAgICB9LFxuICAgIGZ1bmN0aW9uKGFzc2V0cykge1xuICAgICAgc2VsZi5nYW1lX3N0YXJ0X2xvYWRlZChhc3NldHMuaW1nKTtcbiAgICB9XG4gICk7XG59O1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9zdGFydF9sb2FkZWQgPSBmdW5jdGlvbihtYXApIHtcbiAgLy8gc2V0IHVwIG1hcFxuICB2YXIgbmV3X21hcCA9IHtcbiAgICBmZzogbWFwZ2VuX2NhbnZhcyhtYXAuZmcud2lkdGgsIG1hcC5mZy5oZWlnaHQpLFxuICAgIGJnOiBtYXBnZW5fY2FudmFzKG1hcC5iZy53aWR0aCwgbWFwLmJnLmhlaWdodCksXG4gICAgZ3Jhdml0eV9tYXA6IHRoaXMuZ3Jhdml0eV9tYXBcbiAgfTtcbiAgbmV3X21hcC5mZy5jb250LmRyYXdJbWFnZShtYXAuZmcsIDAsIDApO1xuICBuZXdfbWFwLmJnLmNvbnQuZHJhd0ltYWdlKG1hcC5iZywgMCwgMCk7XG5cbiAgLy8gc3RhcnQgdXAgZ2FtZSBvYmplY3RcbiAgdGhpcy5nYW1lID0gbmV3IGdhbWUoXG4gICAgdGhpcy5hc3NldHMsXG4gICAgdGhpcy5hdWRpbyxcbiAgICB0aGlzLmlucHV0LFxuICAgIHRoaXMuc2NoZW1lLFxuICAgIG5ld19tYXAsXG4gICAgdGhpcy5wbGF5ZXJzX3JlZixcbiAgICB0aGlzLnBsYXllcl9pZCxcbiAgICB0aGlzLnRvcF9ldmVudCxcbiAgICB0aGlzLm9uYm9hcmRpbmdcbiAgKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWUuZGl2KTtcblxuICAvLyBmaW5pc2hlZCBsb2FkaW5nXG4gIHRoaXMubG9hZGluZ19zdGFydCA9IGZhbHNlO1xufTtcblxuLyogSW5pdCBnYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuaW5pdF9nYW1lID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKCF0aGlzLmdhbWUgfHwgIXRoaXMuZ2FtZS5jb3JlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2hvdyBpbnRlcmZhY2VcbiAgaGlkZSh0aGlzLmJldHdlZW5fZ2FtZXMpO1xuICBoaWRlKHRoaXMuZGl2X2RlYWQpO1xuICBoaWRlKHRoaXMuY29ubmVjdGluZyk7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcblxuICAvLyBzdG9wIGdhbWVcbiAgdGhpcy5sb29wX3N0b3AoKTtcblxuICAvLyBwcmVwYXJlIHN0YXRlXG4gIHRoaXMuc2V0X2dhbWVfc3RhdGUoZXZlbnQsIHRydWUpO1xuXG4gIC8vIHN0YXJ0IGdhbWVcbiAgdGhpcy5nYW1lLnN0YXJ0KGV2ZW50LmZyYW1lcyk7XG4gIHRoaXMuc3RhdHVzID0gXCJhY3RpdmVcIjtcblxuICAvLyBsYXN0IGZyYW1lIGEgc2VydmVyIHBhY2tldCB3YXMgcmVjZWl2ZWRcbiAgdGhpcy5sYXN0X3BhY2tldCA9IGV2ZW50LmZyYW1lcztcbiAgdGhpcy5kaXNjb25uZWN0ZWQgPSBmYWxzZTtcblxuICAvLyBydW4gaW5pdGlhbCBldmVudHNcbiAgdGhpcy5ydW5fZXZlbnQodGhpcy5pbml0aWFsX2dhbWVfZXZlbnRzKTtcbiAgdGhpcy5pbml0aWFsX2dhbWVfZXZlbnRzID0gW107XG4gIHRoaXMuaW5pdGlhbGlzZWQgPSB0cnVlO1xuXG4gIC8vIHN0YXJ0IGxvb3BcbiAgdGhpcy5sb29wX3N0YXJ0KGV2ZW50LmZyYW1lcyk7XG59O1xuXG4vKiBDbG9zZSBnYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9jbG9zZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMubG9vcF9zdG9wKCk7XG4gIGlmICh0aGlzLmdhbWUpIHtcbiAgICByZW1vdmUodGhpcy5nYW1lLmRpdik7XG4gICAgZGVsZXRlIHRoaXMuZ2FtZTtcbiAgfVxufTtcblxuLyogRW5kIEdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX2VuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIHN0b3AgZ2FtZVxuICB0aGlzLmxvb3Bfc3RvcCgpO1xuXG4gIC8vIHN0b3AgYXVkaW9cbiAgdGhpcy5hdWRpby5zdG9wKCk7XG5cbiAgLy8gc2hvdyBsb2FkaW5nIHNjcmVlblxuICBoaWRlKHRoaXMubG9hZGluZyk7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG4gIGhpZGUodGhpcy5jb25uZWN0aW5nKTtcbiAgc2hvdyh0aGlzLmJldHdlZW5fZ2FtZXMpO1xufTtcblxuLyogU2VuZCBpbnB1dCB0byBzZXJ2ZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5zZW5kX2lucHV0ID0gZnVuY3Rpb24oYWN0aW9uKSB7XG4gIHZhciBhcnIgPSBbdGhpcy5mcmFtZXMsIGFjdGlvbi5hY3Rpb24sIGFjdGlvbi5hbmdsZV07XG4gIGlmIChhY3Rpb24uYWN0aW9uID09PSBcInNob290XCIpIHtcbiAgICBhcnIucHVzaChhY3Rpb24ud2VhcG9uKTtcbiAgfVxuICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwicGxheWVyX2lucHV0XCIsIGFycik7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgUm9vbSBQbGF5ZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ3JlYXRlIHBsYXllciBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuaW5pdF9wbGF5ZXIgPSBmdW5jdGlvbihwcm9wcykge1xuICAvLyBhZGQgcGxheWVyIHRvIGFycmF5XG4gIHRoaXMucGxheWVyX2NvdW50Kys7XG4gIHRoaXMucGxheWVyc1twcm9wcy51c2VyX2lkXSA9IHtcbiAgICBuYW1lOiBwcm9wcy5uYW1lLFxuICAgIGlkOiBwcm9wcy5wbGF5ZXJfaWRcbiAgfTtcblxuICAvLyBzZXQgcGxheWVycyByZWZlcmVuY2VcbiAgdGhpcy5wbGF5ZXJzX3JlZltwcm9wcy5wbGF5ZXJfaWRdID0ge1xuICAgIHVzZXJfaWQ6IHByb3BzLnVzZXJfaWQsXG4gICAgbmFtZTogcHJvcHMubmFtZSxcbiAgICBsZXZlbDogMFxuICB9O1xufTtcblxuLyogRHJhdyBwbGF5ZXJzIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnBsYXllcnNfaW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gIC8vIGFyZSB3ZSBnb29kIGFuZCBhY3RpdmVcbiAgaWYgKCF0aGlzLmluaXRpYWxpc2VkIHx8ICF0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2hvdyBwbGF5ZXJzXG4gIHZhciBzdHIgPSBcIlwiO1xuICB2YXIgc29ydGFibGUgPSB0aGlzLnBsYXllcnNfc29ydCgpO1xuICBpZiAoIXNvcnRhYmxlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2V0IGxlYWRlciBpZFxuICB0aGlzLmdhbWUubGVhZGVyID0gcGFyc2VJbnQoc29ydGFibGVbMF0uaWQpO1xuXG4gIHN0ciA9IFwiPHRoZWFkPjx0aD48L3RoPjx0aD5sdmw8L3RoPjx0aD5zY29yZTwvdGg+PC90aGVhZD5cIjtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0YWJsZS5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwbGF5ZXIgPSBzb3J0YWJsZVtpXTtcbiAgICB2YXIgdHJfY2xhc3MgPSBcIlwiO1xuICAgIGlmIChwbGF5ZXIuaWQgPT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgIHRyX2NsYXNzICs9IFwiaGlnaGxpZ2h0IFwiO1xuICAgIH1cbiAgICBpZiAocGxheWVyLmRlYWQpIHtcbiAgICAgIHRyX2NsYXNzICs9IFwiZGVhZCBcIjtcbiAgICB9XG4gICAgc3RyICs9XG4gICAgICBcIjx0ciBjbGFzcz0nXCIgK1xuICAgICAgdHJfY2xhc3MgK1xuICAgICAgXCInJz48dGQ+XCIgK1xuICAgICAgcGxheWVyLm5hbWUgK1xuICAgICAgXCI8L3RkPjx0ZCBjbGFzcz0ncmVkJz5cIiArXG4gICAgICAocGxheWVyLmxldmVsICsgMSkgK1xuICAgICAgXCI8L3RkPjx0ZCBjbGFzcz0nZ3JlZW4nPlwiICtcbiAgICAgIHBsYXllci5zY29yZSArXG4gICAgICBcIjwvdGQ+PC90cj5cIjtcbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBsZXZlbCB1cHNcbiAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzX3JlZikge1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNfcmVmW2lkXTtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzW2lkXTtcbiAgICBpZiAoIWNvcmVfcGxheWVyKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHBsYXllci5sZXZlbCAhPT0gY29yZV9wbGF5ZXIubGV2ZWwpIHtcbiAgICAgIHRoaXMucnVuX2V2ZW50KHtcbiAgICAgICAgdHlwZTogXCJwbGF5ZXJfbGV2ZWxcIixcbiAgICAgICAgaWQ6IHBhcnNlSW50KGlkKSxcbiAgICAgICAgcHJldjogcGxheWVyLmxldmVsLFxuICAgICAgICBuZXc6IGNvcmVfcGxheWVyLmxldmVsXG4gICAgICB9KTtcbiAgICAgIHRoaXMucGxheWVyc19yZWZbaWRdLmxldmVsID0gY29yZV9wbGF5ZXIubGV2ZWw7XG4gICAgfVxuICB9XG5cbiAgLy8gc2V0IGNvbnRlbnRcbiAgdGhpcy50YWJsZV9wbGF5ZXJzLmlubmVySFRNTCA9IHN0cjtcbn07XG5cbi8qIFNvcnQgcGxheWVycyBieSBzY29yZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnBsYXllcnNfc29ydCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc29ydGFibGUgPSBbXTtcbiAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzX3JlZikge1xuICAgIHZhciBjb3JlX3BsYXllciA9IHRoaXMuZ2FtZS5jb3JlLnN0YXRlLnBsYXllcnNbaWRdO1xuICAgIGlmICghY29yZV9wbGF5ZXIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBzb3J0YWJsZS5wdXNoKHtcbiAgICAgIGlkOiBpZCxcbiAgICAgIG5hbWU6IHRoaXMucGxheWVyc19yZWZbaWRdLm5hbWUsXG4gICAgICBsZXZlbDogY29yZV9wbGF5ZXIubGV2ZWwsXG4gICAgICBzY29yZTogY29yZV9wbGF5ZXIuc2NvcmUsXG4gICAgICBkZWFkOiBjb3JlX3BsYXllci5kZWFkXG4gICAgfSk7XG4gIH1cbiAgc29ydGFibGUuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICB9KTtcbiAgcmV0dXJuIHNvcnRhYmxlO1xufTtcblxuLyogUGxheWVyIGhhcyBqb2luZWRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5wbGF5ZXJfam9pbiA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuaW5pdF9wbGF5ZXIoZXZlbnQsIHRydWUpO1xuICB0aGlzLmF1ZGlvLnBsYXkoXCJqb2luXCIsIDEpO1xufTtcblxuLyogUGxheWVyIGxlZnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5wbGF5ZXJfbGVhdmUgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoIXRoaXMucGxheWVyc1tldmVudC51c2VyX2lkXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpZCA9IHRoaXMucGxheWVyc1tldmVudC51c2VyX2lkXS5wbGF5ZXJfaWQ7XG4gIGRlbGV0ZSB0aGlzLnBsYXllcnNfcmVmW2lkXTtcbiAgZGVsZXRlIHRoaXMucGxheWVyc1tldmVudC51c2VyX2lkXTtcbiAgdGhpcy5wbGF5ZXJfY291bnQtLTtcblxuICAvLyByZW1vdmUgZnJvbSBnYW1lXG4gIGlmICh0aGlzLmdhbWUgJiYgdGhpcy5nYW1lLmNvcmUpIHtcbiAgICB0aGlzLmdhbWUuY29yZS5yZW1vdmVfcGxheWVyKGlkKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWUgU3RhdGVzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUmVjZWl2ZSBnYW1lIHN0YXRlIGZyb20gc2VydmVyXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9zdGF0ZV9yZWNlaXZlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGlmIHdlIGFyZSBsb2FkaW5nXG4gIGlmICh0aGlzLmxvYWRpbmdfc3RhcnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzdGFydCB0aGUgZ2FtZVxuICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQgfHwgdGhpcy5kaXNjb25uZWN0ZWQpIHtcbiAgICB0aGlzLmluaXRpYWxpc2VkID0gdHJ1ZTtcbiAgICB0aGlzLmluaXRfZ2FtZShldmVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGRpZmYgPSBldmVudC5mcmFtZXMgLSB0aGlzLmZyYW1lcztcblxuICAvLyBpZiB3ZSBhcmUgdG9vIHF1aWNrXG4gIGlmIChkaWZmIDwgMCkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwiY2xpZW50IHRvbyBmYXN0XCIpO1xuICAgIHRoaXMuaW5pdF9nYW1lKGV2ZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpZiBpdCdzIHRvbyBmYXIgYmVoaW5kIHJlc3luY1xuICBpZiAoZGlmZiA+IDkpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlc3luY1wiKTtcbiAgICB0aGlzLmluaXRfZ2FtZShldmVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYXBwbHkgdGhlIHN0YXRlXG4gIGlmIChldmVudC5mcmFtZXMgPT09IHRoaXMuZnJhbWVzKSB7XG4gICAgdGhpcy5zZXRfZ2FtZV9zdGF0ZShldmVudCk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5zdG9yZV9wYWNrZXRbZXZlbnQuZnJhbWVzXSA9IGR1cGxpY2F0ZV9vYmooZXZlbnQpO1xuICB9XG59O1xuXG4vKiBTZXQgZ2FtZSBzdGF0ZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnNldF9nYW1lX3N0YXRlID0gZnVuY3Rpb24oZXZlbnQsIGlnbm9yZV9yZXMpIHtcbiAgLy8gcnVuIGRhbWFnZXNcbiAgdGhpcy5yZXNvbHZlX2dyb3VuZChldmVudC5kYW1hZ2VzKTtcblxuICAvLyB1bnBhY2sgdGhlIHN0YXRlXG4gIHZhciBzdGF0ZSA9IHRoaXMuZ2FtZS5jb3JlLnVucGFja19zdGF0ZShldmVudC5zdGF0ZSk7XG5cbiAgLy8gc2V0IHBsYXllcnNcbiAgdGhpcy5yZXNvbHZlX3BsYXllcnMoc3RhdGUsIGlnbm9yZV9yZXMpO1xuXG4gIC8vIHNldCB0aGlzIHBsYXllclxuICBpZiAoIWlnbm9yZV9yZXMpIHtcbiAgICB0aGlzLnJlc29sdmVfdGhpc19wbGF5ZXIoc3RhdGUsIGV2ZW50LnJlc3BvbnNlcyk7XG4gIH1cblxuICAvLyBzZXQgb2JqZWN0c1xuICB0aGlzLnJlc29sdmVfb2JqZWN0cyhzdGF0ZS5vYmplY3RzLCBldmVudC5mcmFtZXMpO1xuXG4gIC8vIHNldCBleHBsb3Npb25zXG4gIHRoaXMucmVzb2x2ZV9leHBsb3Npb25zKHN0YXRlLmV4cGxvc2lvbnMsIGV2ZW50LmZyYW1lcyk7XG5cbiAgLy8gc2V0IGdhbWUgcGxheWVyIHJlZmVyZW5jZXNcbiAgdGhpcy5nYW1lLnNldF90aGlzX3BsYXllcl9yZWZzKCk7XG59O1xuXG4vKiBSZXNvbHZlIHBsYXllcnNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX3BsYXllcnMgPSBmdW5jdGlvbihzdGF0ZSwgaWdub3JlX3Jlcykge1xuICAvLyBzZXQgYWxsIG90aGVyIHBsYXllcnNcbiAgZm9yICh2YXIga2V5IGluIHN0YXRlLnBsYXllcnMpIHtcbiAgICBpZiAocGFyc2VJbnQoa2V5KSAhPT0gdGhpcy5wbGF5ZXJfaWQgfHwgaWdub3JlX3Jlcykge1xuICAgICAgdGhpcy5nYW1lLmluaXRfcGxheWVyKHN0YXRlLnBsYXllcnNba2V5XSwgdHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gcmVtb3ZlIHBsYXllcnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLnBsYXllcnMpIHtcbiAgICBpZiAoIXN0YXRlLnBsYXllcnNba2V5XSkge1xuICAgICAgdGhpcy5nYW1lLmNvcmUucmVtb3ZlX3BsYXllcihrZXkpO1xuICAgIH1cbiAgfVxufTtcblxuLyogUmVzb2x2ZSB0aGlzIHBsYXllclxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfdGhpc19wbGF5ZXIgPSBmdW5jdGlvbihzdGF0ZSwgcmVzcG9uc2VzKSB7XG4gIC8vIHByZXAgc2VydmVyIHN0YXRlIG9iamVjdHNcbiAgdmFyIHNlcnZlcl9wbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXTtcbiAgdmFyIHNlcnZlcl9vYmogPSBzdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWRdO1xuICBpZiAoIXNlcnZlcl9wbGF5ZXIgfHwgIXNlcnZlcl9vYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBwcmVwIHNlcnZlciByZXNwb25zZXNcbiAgdmFyIHNlcnZlcl9yZXNwb25zZXMgPSBbXTtcbiAgdmFyIHNwbGl0ID0gcmVzcG9uc2VzLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcGxpdDIgPSBzcGxpdFtpXS5zcGxpdChcIn5cIik7XG4gICAgc2VydmVyX3Jlc3BvbnNlcy5wdXNoKHtcbiAgICAgIGZyYW1lOiBwYXJzZUludChzcGxpdDJbMF0pLFxuICAgICAgc3VjY2Vzczogc3BsaXQyWzFdID09PSBcIjFcIixcbiAgICAgIHg6IHBhcnNlRmxvYXQoc3BsaXQyWzJdKSxcbiAgICAgIHk6IHBhcnNlRmxvYXQoc3BsaXQyWzNdKSxcbiAgICAgIHNwZWVkX3g6IHBhcnNlRmxvYXQoc3BsaXQyWzRdKSxcbiAgICAgIHNwZWVkX3k6IHBhcnNlRmxvYXQoc3BsaXQyWzVdKSxcbiAgICAgIHR5cGU6IHNwbGl0Mls2XVxuICAgIH0pO1xuICB9XG5cbiAgLy8gY2hlY2sgcGxheWVyIHdlYXBvblxuICBpZiAoc2VydmVyX3BsYXllci53ZWFwb24gIT09IHRoaXMuZ2FtZS5jdXJyZW50X3dlYXBvbikge1xuICAgIHRoaXMuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJ3ZWFwb25fc2VsZWN0ZWRcIiwgW3RoaXMuZ2FtZS5jdXJyZW50X3dlYXBvbl0pO1xuICB9XG5cbiAgLy8gaWYgd2UgaGF2ZSBubyBtb3JlIGFjdGlvbnNcbiAgaWYgKHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIubGV2ZWwgPSBzZXJ2ZXJfcGxheWVyLmxldmVsO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuc2NvcmUgPSBzZXJ2ZXJfcGxheWVyLnNjb3JlO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuZGVhZCA9IHNlcnZlcl9wbGF5ZXIuZGVhZDtcbiAgICB0aGlzLmdhbWUucGxheWVyLmhlYWx0aCA9IHNlcnZlcl9wbGF5ZXIuaGVhbHRoO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuY29vbGRvd24gPSBzZXJ2ZXJfcGxheWVyLmNvb2xkb3duO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuYXJtb3VyeSA9IGR1cGxpY2F0ZV9vYmooc2VydmVyX3BsYXllci5hcm1vdXJ5KTtcbiAgICB0aGlzLmdhbWUuc2V0X2FybW91cnkoKTtcbiAgfVxuXG4gIC8vIHJlc29sdmUgb3VyIHBsYXllclxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGNsaWVudF9yZXNwb25zZSA9IHRoaXMuc3RvcmVfcmVzcG9uc2VzW2ldO1xuXG4gICAgLy8gZ28gdGhyb3VnaCBhY3Rpb24gcmVzcG9uc2VzXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZXJ2ZXJfcmVzcG9uc2VzLmxlbmd0aDsgaisrKSB7XG4gICAgICB2YXIgc2VydmVyX3Jlc3BvbnNlID0gc2VydmVyX3Jlc3BvbnNlc1tqXTtcblxuICAgICAgLy8gY29ycmVjdCBmcmFtZVxuICAgICAgaWYgKGNsaWVudF9yZXNwb25zZS5mcmFtZSA9PT0gc2VydmVyX3Jlc3BvbnNlLmZyYW1lKSB7XG4gICAgICAgIC8vIGNvbXBhcmUgdGhlIHJlc3BvbnNlXG4gICAgICAgIGlmIChcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2Uuc3VjY2VzcyA9PT0gc2VydmVyX3Jlc3BvbnNlLnN1Y2Nlc3MgJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueCA9PT0gc2VydmVyX3Jlc3BvbnNlLnggJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueSA9PT0gc2VydmVyX3Jlc3BvbnNlLnkgJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2Uuc3BlZWRfeCA9PT0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3ggJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2Uuc3BlZWRfeSA9PT0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3lcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gY2xvZyhcImFjdCBzdWNjZXNzXCIsIHNlcnZlcl9yZXNwb25zZS5mcmFtZSwgdGhpcy5mcmFtZXMsIHNlcnZlcl9yZXNwb25zZS50eXBlLCBjbGllbnRfcmVzcG9uc2UueCwgc2VydmVyX3Jlc3BvbnNlLngsIGNsaWVudF9yZXNwb25zZS55LCBzZXJ2ZXJfcmVzcG9uc2UueSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVzeW5jIHRoZSBwbGF5ZXJcbiAgICAgICAgICBjbG9nKFxuICAgICAgICAgICAgXCJhY3QgZmFpbFwiLFxuICAgICAgICAgICAgc2VydmVyX3Jlc3BvbnNlLmZyYW1lLFxuICAgICAgICAgICAgdGhpcy5mcmFtZXMsXG4gICAgICAgICAgICBzZXJ2ZXJfcmVzcG9uc2UudHlwZSxcbiAgICAgICAgICAgIGNsaWVudF9yZXNwb25zZS54LFxuICAgICAgICAgICAgc2VydmVyX3Jlc3BvbnNlLngsXG4gICAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueSxcbiAgICAgICAgICAgIHNlcnZlcl9yZXNwb25zZS55XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXRoaXMucmVzeW5jX3RoaXNfcGxheWVyKHNlcnZlcl9yZXNwb25zZSkpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5pbml0X3BsYXllcihzZXJ2ZXJfcGxheWVyLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuY3JlYXRlX29iamVjdChzZXJ2ZXJfb2JqKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2VydmVyX3Jlc3BvbnNlcy5zcGxpY2UoaiwgMSk7XG4gICAgICAgIHRoaXMuc3RvcmVfcmVzcG9uc2VzLnNwbGljZShpLCAxKTtcbiAgICAgICAgaS0tO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFN5bmMgdGhpcyBwbGF5ZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXN5bmNfdGhpc19wbGF5ZXIgPSBmdW5jdGlvbihzZXJ2ZXJfcmVzcG9uc2UpIHtcbiAgLy8gaG93IGZhciBiYWNrIGlzIHRoaXNcbiAgdmFyIGZyYW1lID0gc2VydmVyX3Jlc3BvbnNlLmZyYW1lO1xuICB2YXIgZnJhbWVfZGlmZmVyZW5jZSA9IHRoaXMuZnJhbWVzIC0gZnJhbWU7XG5cbiAgLy8gaWYgaXQncyB0b28gZmFyIGJhY2tcbiAgLy8gaWYgd2UgaGF2ZSBubyBzdGF0ZSB0byByb2xsIGJhY2sgdG9cbiAgaWYgKGZyYW1lX2RpZmZlcmVuY2UgPiAyMCB8fCAhdGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV0pIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInN5bmMgdG9vIGZhciBiYWNrIHwgXCIgKyBmcmFtZV9kaWZmZXJlbmNlKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyByZXNldCBnYW1lIHN0YXRlXG4gIHRoaXMuc2V0X2dhbWVfc3RhdGUodGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV0sIHRydWUpO1xuXG4gIC8vIHJlc2V0IHBsYXllclxuICB0aGlzLnN0b3JlX3Jlc3BvbnNlcyA9IFtdO1xuICB0aGlzLmdhbWUucGxheWVyX29iai54ID0gc2VydmVyX3Jlc3BvbnNlLng7XG4gIHRoaXMuZ2FtZS5wbGF5ZXJfb2JqLnkgPSBzZXJ2ZXJfcmVzcG9uc2UueTtcbiAgdGhpcy5nYW1lLnBsYXllcl9vYmouc3BlZWRfeCA9IHNlcnZlcl9yZXNwb25zZS5zcGVlZF94O1xuICB0aGlzLmdhbWUucGxheWVyX29iai5zcGVlZF95ID0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3k7XG5cbiAgLy8gcnVuIGFsbCBmcmFtZXMgdXAgdG8gdGhpcyBwb2ludFxuICBmb3IgKHZhciBpID0gMTsgaSA8PSBmcmFtZV9kaWZmZXJlbmNlOyBpKyspIHtcbiAgICB0aGlzLmZyYW1lX3J1bihmcmFtZSArIGkpO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBSZXNvbHZlIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX29iamVjdHMgPSBmdW5jdGlvbihvYmplY3RzLCBmcmFtZSkge1xuICAvLyBjaGVjayBmb3IgdW5jcmVhdGVkIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIG9iamVjdHMpIHtcbiAgICBpZiAoIXRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHNba2V5XSkge1xuICAgICAgaWYgKCF0aGlzLndhaXRfdG9fY3JlYXRlW2tleV0gfHwgdGhpcy53YWl0X3RvX2NyZWF0ZVtrZXldICsgNDAgPCBmcmFtZSkge1xuICAgICAgICBkZWxldGUgdGhpcy53YWl0X3RvX2NyZWF0ZVtrZXldO1xuICAgICAgICB0aGlzLmdhbWUuY3JlYXRlX29iamVjdChvYmplY3RzW2tleV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGlmIHRoZXJlJ3Mgbm8gY29ycmVzcG9uZGluZyBzZXJ2ZXIgb2JqZWN0XG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgaWYgKCFvYmplY3RzW2tleV0pIHtcbiAgICAgIC8vIGdpdmUgdGhlbSBhIGRlbGF5XG4gICAgICBpZiAoIXRoaXMud2FpdF90b19kZXN0cm95W2tleV0pIHtcbiAgICAgICAgdGhpcy53YWl0X3RvX2Rlc3Ryb3lba2V5XSA9IGZyYW1lICsgNDA7XG4gICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgIC8vIHJlbW92ZSB3aGVuIGRlbGF5IGhhcyBleHBpcmVkXG4gICAgICB9IGVsc2UgaWYgKHRoaXMud2FpdF90b19kZXN0cm95W2tleV0gPCBmcmFtZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgICAgICBkZWxldGUgdGhpcy53YWl0X3RvX2Rlc3Ryb3lba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBtYXRjaCB1cCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgLy8gaWYgb3VyIHBsYXllciBhbmQgd2FpdGluZyBmb3IgYWN0aW9uIHJlc3BvbnNlc1xuICAgIGlmIChrZXkgPT09IFwicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgIGlmICh0aGlzLnN0b3JlX3Jlc3BvbnNlcy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIG9iaiA9IHRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICB2YXIgcmVzX29iaiA9IG9iamVjdHNba2V5XTtcblxuICAgIC8vIGlnbm9yZSBhbnkgb2JqZWN0cyB3aXRoIG5vIHJlZmVyZW5jZVxuICAgIGlmICghcmVzX29iaikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gbWF0Y2ggdmFsdWVzXG4gICAgaWYgKG9iai50eXBlICE9PSByZXNfb2JqLnR5cGUpIHtcbiAgICAgIG9iai50eXBlID0gcmVzX29iai50eXBlO1xuICAgICAgb2JqLmMgPSB0aGlzLmdhbWUuYy5vYmplY3RzW29iai50eXBlXTtcbiAgICB9XG4gICAgb2JqLmdyb3VuZGVkID0gcmVzX29iai5ncm91bmRlZDtcblxuICAgIC8vIGlmIGdyb3VuZGVkIG9yIHVzXG4gICAgaWYgKG9iai5ncm91bmRlZCB8fCBvYmoucGxheWVyX2lkID09PSB0aGlzLnBsYXllcl9pZCkge1xuICAgICAgb2JqLnggPSByZXNfb2JqLng7XG4gICAgICBvYmoueSA9IHJlc19vYmoueTtcbiAgICAgIG9iai5zcGVlZF94ID0gcmVzX29iai5zcGVlZF94O1xuICAgICAgb2JqLnNwZWVkX3kgPSByZXNfb2JqLnNwZWVkX3k7XG5cbiAgICAgIC8vIHNldCBpbnRlcnBvbGF0aW9uIHBvc2l0aW9uXG4gICAgfSBlbHNlIGlmICghb2JqLmFjdGlvbmVkKSB7XG4gICAgICBvYmouZ2hvc3QgPSBmcmFtZTtcbiAgICAgIG9iai5neCA9IG9iai54O1xuICAgICAgb2JqLmd5ID0gb2JqLnk7XG4gICAgICBvYmoueCA9IHJlc19vYmoueDtcbiAgICAgIG9iai55ID0gcmVzX29iai55O1xuICAgICAgb2JqLnNwZWVkX3ggPSByZXNfb2JqLnNwZWVkX3g7XG4gICAgICBvYmouc3BlZWRfeSA9IHJlc19vYmouc3BlZWRfeTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFJlc29sdmUgb2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfZXhwbG9zaW9ucyA9IGZ1bmN0aW9uKGV4cGxvc2lvbnMsIGZyYW1lKSB7XG4gIC8vIGNoZWNrIGZvciB1bmNyZWF0ZWQgZXhwbG9zaW9uc1xuICBmb3IgKHZhciBrZXkgaW4gZXhwbG9zaW9ucykge1xuICAgIGlmICghdGhpcy5nYW1lLmNvcmUuc3RhdGUuZXhwbG9zaW9uc1trZXldKSB7XG4gICAgICB0aGlzLmdhbWUuY29yZS5jcmVhdGVfZXhwbG9zaW9uKGV4cGxvc2lvbnNba2V5XSk7XG5cbiAgICAgIC8vIGVuc3VyZSBjb3JyZWN0IHBvc2l0aW9uXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLmV4cGxvc2lvbnNba2V5XS54ID0gZXhwbG9zaW9uc1trZXldLng7XG4gICAgICB0aGlzLmdhbWUuY29yZS5zdGF0ZS5leHBsb3Npb25zW2tleV0ueSA9IGV4cGxvc2lvbnNba2V5XS55O1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBUcmFja2VyIEFycm93c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biB0aGUgYXJyb3dzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fYXJyb3dzID0gZnVuY3Rpb24oKSB7XG4gIGZvciAodmFyIHR5cGUgaW4gdGhpcy5zY2hlbWUuYXJyb3dzKSB7XG4gICAgdmFyIGFycm93ID0gdGhpcy5zY2hlbWUuYXJyb3dzW3R5cGVdO1xuICAgIGlmICghYXJyb3cpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGZpbmQgY2xvc2VzdCB0aGluZ1xuICAgIHZhciBsb3dlc3QgPSA5OTk5OTtcbiAgICB2YXIgY2xvc2VzdF9vYmogPSBudWxsO1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiYgb2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAob2JqLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgdmFyIGRpc3QgPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZShcbiAgICAgICAgICBvYmoueCxcbiAgICAgICAgICBvYmoueSxcbiAgICAgICAgICB0aGlzLmNhbWVyYS54LFxuICAgICAgICAgIHRoaXMuY2FtZXJhLnlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGRpc3QgPCBsb3dlc3QpIHtcbiAgICAgICAgICBsb3dlc3QgPSBkaXN0O1xuICAgICAgICAgIGNsb3Nlc3Rfb2JqID0gb2JqO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghY2xvc2VzdF9vYmopIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBzY3JlZW4gcG9zaXRpb25cbiAgICB2YXIgcG9zID0gdGhpcy5zY3JlZW5fcG9zaXRpb24oY2xvc2VzdF9vYmoueCwgY2xvc2VzdF9vYmoueSwgODApO1xuICAgIGlmIChwb3Mub25fc2NyZWVuKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBzaG93IGFuIGFycm93XG4gICAgdmFyIGFuZ2xlID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhcbiAgICAgIHRoaXMuY2FtZXJhLngsXG4gICAgICB0aGlzLmNhbWVyYS55LFxuICAgICAgY2xvc2VzdF9vYmoueCxcbiAgICAgIGNsb3Nlc3Rfb2JqLnlcbiAgICApO1xuICAgIHZhciBkaXN0ID0gbWluKGxvd2VzdCwgbWluKHRoaXMuY2FudmFzLmN4LCB0aGlzLmNhbnZhcy5jeSkpIC0gMjI7XG4gICAgdmFyIHh5ID0geHlfc3BlZWQoYW5nbGUsIGRpc3QpO1xuICAgIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiYXJyb3ctXCIgKyBhcnJvdyxcbiAgICAgIHg6IHJvdW5kKHRoaXMuY2FtZXJhLnggKyB4eS54KSxcbiAgICAgIHk6IHJvdW5kKHRoaXMuY2FtZXJhLnkgKyB4eS55KSxcbiAgICAgIGFuZ2xlOiBhbmdsZV9hZGQoYW5nbGUsIDI3MClcbiAgICB9KTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBCYWNrZ3JvdW5kIExheWVyXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGJhY2tncm91bmRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfYmFja2dyb3VuZCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmJnID0ge307XG4gIHRoaXMuYmcucGFyYWxsYXggPSAwLjU7XG4gIHRoaXMuYmcueCA9IDA7XG4gIHRoaXMuYmcueSA9IDA7XG4gIHRoaXMuYmcudyA9IHRoaXMuaW1nLmJnLndpZHRoO1xuICB0aGlzLmJnLmggPSB0aGlzLmltZy5iZy5oZWlnaHQ7XG4gIHRoaXMuYmcucGF0dGVybiA9IHRoaXMuY2FudmFzLmNvbnQuY3JlYXRlUGF0dGVybih0aGlzLmltZy5iZywgXCJyZXBlYXRcIik7XG59O1xuXG4vKiBEcmF3IHRoZSBiYWNrZ3JvdW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19iYWNrZ3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gIC8vIGhvdyBtdWNoIGhhdmUgd2UgbW92ZWQgYnlcbiAgdmFyIGR4ID1cbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3godGhpcy5jYW1lcmEueCwgdGhpcy5jYW1lcmEucHgpICpcbiAgICAgIHRoaXMuYmcucGFyYWxsYXgsXG4gICAgZHkgPVxuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeSh0aGlzLmNhbWVyYS55LCB0aGlzLmNhbWVyYS5weSkgKlxuICAgICAgdGhpcy5iZy5wYXJhbGxheDtcblxuICAvLyBhZGQgbW92ZW1lbnQgbXVsdGlwbGllZCBieSBwYXJhbGxheCBkZWdyZWVcbiAgdGhpcy5iZy54ID0gbl9sb29wKHRoaXMuYmcueCArIGR4LCAwLCB0aGlzLmJnLncpO1xuICB0aGlzLmJnLnkgPSBuX2xvb3AodGhpcy5iZy55ICsgZHksIDAsIHRoaXMuYmcuaCk7XG5cbiAgLy8gZHJhdyBpdFxuICB2YXIgc2l6ZSA9IG1heCh0aGlzLmNhbnZhcy5oLCB0aGlzLmNhbnZhcy53KTtcbiAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoXG4gICAgdGhpcy5iZy54ICsgdGhpcy5jYW1lcmEuc3gsXG4gICAgdGhpcy5iZy55ICsgdGhpcy5jYW1lcmEuc3lcbiAgKTtcbiAgdGhpcy5jYW52YXMuY29udC5maWxsU3R5bGUgPSB0aGlzLmJnLnBhdHRlcm47XG4gIHRoaXMuY2FudmFzLmNvbnQuZmlsbFJlY3QoLXNpemUsIC1zaXplLCBzaXplICogMywgc2l6ZSAqIDMpO1xuICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZShcbiAgICAtKHRoaXMuYmcueCArIHRoaXMuY2FtZXJhLnN4KSxcbiAgICAtKHRoaXMuYmcueSArIHRoaXMuY2FtZXJhLnN5KVxuICApO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBDYW1lcmEgUG9zaXRpb25cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgY2FtZXJhIHBvc2l0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9jYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jYW1lcmEgPSB7fTtcbiAgdGhpcy5jYW1lcmEueCA9IHJvdW5kKHRoaXMubWFwLmZnLmNhbnYud2lkdGggLyAyKTtcbiAgdGhpcy5jYW1lcmEueSA9IHJvdW5kKHRoaXMubWFwLmZnLmNhbnYuaGVpZ2h0IC8gMik7XG4gIHRoaXMuY2FtZXJhLnB4ID0gdGhpcy5jYW1lcmEueDtcbiAgdGhpcy5jYW1lcmEucHkgPSB0aGlzLmNhbWVyYS55O1xuXG4gIC8vIHdhdGNoZXIgZm9sbG93IHBsYXllclxuICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPSBcImxlYWRlclwiO1xuICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyID0gXCJcIjtcblxuICAvLyBjYW1lcmEgd2VhcG9uXG4gIHRoaXMuY2FtZXJhX3dlYXBvbl9rZXkgPSBudWxsO1xuXG4gIC8vIGNhbWVyYSBzaGFrZSBvbiBoaXRcbiAgdGhpcy5jYW1lcmEuc2hha2VfZnJhbWUgPSBudWxsO1xuICB0aGlzLmNhbWVyYS5zeCA9IDA7XG4gIHRoaXMuY2FtZXJhLnN5ID0gMDtcblxuICAvLyBjYW1lcmEgZm9jdXMgZXZlbnRcbiAgdGhpcy5jYW1lcmEuZm9jdXMgPSBudWxsO1xuICB0aGlzLmNhbWVyYS5mb2N1c190aW1lID0gMDtcbiAgdGhpcy5jYW1lcmEuZnggPSAwO1xuICB0aGlzLmNhbWVyYS5meSA9IDA7XG5cbiAgLy8gY3Vyc29yXG4gIHRoaXMuY3Vyc29yID0geyB4OiAwLCB5OiAwIH07XG5cbiAgLy8gd2VhcG9uIGZvbGxvd2luZ1xuICB0aGlzLndlYXBvbl9mb2xsb3cgPSBmYWxzZTtcbiAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcbn07XG5cbi8qIFN3aXRjaCB3YXRjaGVyIGNhbWVyYVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnN3aXRjaF93YXRjaGVyX2NhbWVyYSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXdhdGNoKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXModGhpcy5wbGF5ZXJzKTtcbiAgdmFyIGluZGV4ID0ga2V5cy5pbmRleE9mKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIpO1xuICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgaWYgKGluZGV4ID09PSBrZXlzLmxlbmd0aCAtIDEpIHtcbiAgICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBudWxsO1xuICAgICAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93ID0gXCJsZWFkZXJcIjtcbiAgICAgIHRoaXMuc2V0X2FsZXJ0KFwiRm9sbG93aW5nIHRoZSBMZWFkZXJcIiwgXCIjY2NmZmNjXCIsIDEwMCk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBrZXlzW2luZGV4ICsgMV07XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBrZXlzWzBdO1xuICB9XG4gIGNvbnNvbGUubG9nKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIpO1xuICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW3RoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXJdO1xuICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPSBcInBsYXllclwiO1xuICB0aGlzLnNldF9hbGVydChcIkZvbGxvd2luZyBcIiArIHBsYXllci5uYW1lLCBcIiNlZWVlZWVcIiwgMTAwKTtcbn07XG5cbi8qIENhbGN1bGF0ZSBjdXJyZW50IGNhbWVyYSBwb3NpdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9jYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgLy8gc3RvcCBmb2xsb3dpbmcgaWYgaGl0XG4gIGlmICh0aGlzLndlYXBvbl9mb2xsb3dpbmcgJiYgdGhpcy5wbGF5ZXIgJiYgdGhpcy5wbGF5ZXIuaGl0ID4gMCkge1xuICAgIHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9IFwiXCI7XG4gIH1cblxuICAvLyBzZXQgcHJldmlvdXMgcG9zaXRpb25cbiAgdGhpcy5jYW1lcmEucHggPSB0aGlzLmNhbWVyYS54O1xuICB0aGlzLmNhbWVyYS5weSA9IHRoaXMuY2FtZXJhLnk7XG5cbiAgdmFyIHgsIHksIG1vdmU7XG5cbiAgLy8gc2V0IGZhbGxiYWNrIGNhbWVyYVxuICB2YXIgd2F0Y2hfcGxheWVyX2lkID0gMDtcbiAgaWYgKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9PT0gXCJsZWFkZXJcIikge1xuICAgIHdhdGNoX3BsYXllcl9pZCA9IHRoaXMubGVhZGVyO1xuICB9IGVsc2UgaWYgKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9PT0gXCJwbGF5ZXJcIikge1xuICAgIHdhdGNoX3BsYXllcl9pZCA9IHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXI7XG4gIH1cblxuICAvLyBmaW5kIG9iamVjdCB0byBmb2xsb3dcbiAgdmFyIGZvbGxvd19vYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1t0aGlzLndlYXBvbl9mb2xsb3dpbmddO1xuICB2YXIgd2F0Y2hfb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyB3YXRjaF9wbGF5ZXJfaWRdO1xuICBpZiAoZm9sbG93X29iaikge1xuICAgIHggPSBmb2xsb3dfb2JqLmR4O1xuICAgIHkgPSBmb2xsb3dfb2JqLmR5O1xuICAgIG1vdmUgPSAzMDtcbiAgfSBlbHNlIGlmICh0aGlzLnBsYXllcl9vYmopIHtcbiAgICB4ID0gdGhpcy5wbGF5ZXJfb2JqLmR4O1xuICAgIHkgPSB0aGlzLnBsYXllcl9vYmouZHk7XG4gICAgbW92ZSA9IDYwO1xuICB9IGVsc2UgaWYgKHdhdGNoX29iaikge1xuICAgIHggPSB3YXRjaF9vYmouZHg7XG4gICAgeSA9IHdhdGNoX29iai5keTtcbiAgICBtb3ZlID0gMzA7XG4gIH1cblxuICAvLyBnbyB0byBmb2N1cyBldmVudFxuICBpZiAoXG4gICAgdGhpcy5jYW1lcmEuZm9jdXMgIT0gbnVsbCAmJlxuICAgIHRoaXMuY2FtZXJhLmZvY3VzIDwgdGhpcy5jb3JlLnN0YXRlLmZyYW1lICYmXG4gICAgdGhpcy5jYW1lcmEuZm9jdXMgKyB0aGlzLmNhbWVyYS5mb2N1c190aW1lID4gdGhpcy5jb3JlLnN0YXRlLmZyYW1lXG4gICkge1xuICAgIHggPSB0aGlzLmNhbWVyYS5meDtcbiAgICB5ID0gdGhpcy5jYW1lcmEuZnk7XG4gICAgbW92ZSA9IDEwMDtcblxuICAgIC8vIGZvbGxvdyBjdXJzb3JcbiAgfSBlbHNlIGlmICh0aGlzLm1vdXNlX2ZvbGxvdyB8fCAhbW92ZSkge1xuICAgIHggPSB0aGlzLmN1cnNvci54O1xuICAgIHkgPSB0aGlzLmN1cnNvci55O1xuICAgIG1vdmUgPVxuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2UodGhpcy5jYW1lcmEueCwgdGhpcy5jYW1lcmEueSwgeCwgeSkgKiAwLjA1O1xuICB9XG5cbiAgLy8gbW92ZSB0b3dhcmRzIG5ldyBwb3NpdGlvblxuICBpZiAobW92ZSkge1xuICAgIHZhciBkeCA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3godGhpcy5jYW1lcmEueCwgeCk7XG4gICAgdmFyIGR5ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeSh0aGlzLmNhbWVyYS55LCB5KTtcbiAgICB2YXIgbGltaXQgPSBjaGVja19zcGVlZChkeCwgZHksIG1vdmUpO1xuICAgIHRoaXMuY2FtZXJhLnggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChyb3VuZCh0aGlzLmNhbWVyYS54ICsgbGltaXQueCkpO1xuICAgIHRoaXMuY2FtZXJhLnkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShyb3VuZCh0aGlzLmNhbWVyYS55ICsgbGltaXQueSkpO1xuICB9XG5cbiAgLy8gYWRkIHNjcmVlbiBzaGFrZVxuICB0aGlzLmNhbWVyYS5zeCA9IDA7XG4gIHRoaXMuY2FtZXJhLnN5ID0gMDtcbiAgdmFyIGRpZmYgPSB0aGlzLmNhbWVyYS5zaGFrZV9mcmFtZVxuICAgID8gdGhpcy5jb3JlLnN0YXRlLmZyYW1lIC0gdGhpcy5jYW1lcmEuc2hha2VfZnJhbWVcbiAgICA6IDA7XG4gIGlmIChkaWZmIDwgMTUgJiYgZGlmZiA+IDApIHtcbiAgICB0aGlzLmNhbWVyYS5zeCA9IGNvcygoZGlmZiAvIDIuNSAtIDEuNSkgKiBwaSkgKiB0aGlzLmNhbWVyYS5zaGFrZV9zaXplO1xuICAgIHRoaXMuY2FtZXJhLnN5ID0gc2luKChkaWZmIC8gMyAtIDEpICogcGkpICogdGhpcy5jYW1lcmEuc2hha2Vfc2l6ZTtcbiAgfVxuXG4gIC8vIGZpeCBjdXJzb3IgaW5wdXRcbiAgdGhpcy5jdXJzb3JfbWFwKCk7XG59O1xuXG4vKiBUb2dnbGUgd2VhcG9uIGZvbGxvd2luZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnRvZ2dsZV93ZWFwb25fZm9sbG93ID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICB0aGlzLndlYXBvbl9mb2xsb3cgPSAhdGhpcy53ZWFwb25fZm9sbG93O1xuXG4gIGlmIChtZXNzYWdlKSB7XG4gICAgdmFyIHRleHQgPSBcIm9uXCI7XG4gICAgaWYgKCF0aGlzLndlYXBvbl9mb2xsb3cpIHtcbiAgICAgIHRleHQgPSBcIm9mZlwiO1xuICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcbiAgICB9XG4gICAgdGV4dCA9IFwiRm9sbG93IHdlYXBvbnMgXCIgKyB0ZXh0O1xuICAgIHRoaXMuc2V0X2FsZXJ0KHRleHQsIFwiI2VlZVwiKTtcbiAgfVxufTtcblxuLyogVG9nZ2xlIG1vdXNlIGZvbGxvd2luZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnRvZ2dsZV9tb3VzZV9mb2xsb3cgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5tb3VzZV9mb2xsb3cgPSAhdGhpcy5tb3VzZV9mb2xsb3c7XG4gIHZhciB0ZXh0ID0gdGhpcy5tb3VzZV9mb2xsb3cgPyBcIm9uXCIgOiBcIm9mZlwiO1xuICB0ZXh0ID0gXCJGcmVlIGNhbSBcIiArIHRleHQ7XG4gIHRoaXMuc2V0X2FsZXJ0KHRleHQsIFwiI2VlZVwiKTtcbn07XG5cbmdhbWUucHJvdG90eXBlLmNhbmNlbF9tb3VzZV9mb2xsb3cgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMubW91c2VfZm9sbG93KSB7XG4gICAgdGhpcy50b2dnbGVfbW91c2VfZm9sbG93KCk7XG4gIH1cbn07XG5cbi8qIENhbGN1bGF0ZSBjdXJzb3IgcG9zaXRpb24gb24gbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3Vyc29yX21hcCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2NhbGVfeCA9IHRoaXMuY2FudmFzLmNhbnYub2Zmc2V0V2lkdGggLyB0aGlzLmNhbnZhcy53O1xuICB2YXIgc2NhbGVfeSA9IHRoaXMuY2FudmFzLmNhbnYub2Zmc2V0SGVpZ2h0IC8gdGhpcy5jYW52YXMuaDtcbiAgdmFyIHgxID1cbiAgICB0aGlzLmNhbWVyYS54ICtcbiAgICByb3VuZCgodGhpcy5pbnB1dC5jdXJzb3IueCAtIHJvdW5kKGlubmVyV2lkdGggLyAyKSkgKiBzY2FsZV94KTtcbiAgdmFyIHkxID1cbiAgICB0aGlzLmNhbWVyYS55ICtcbiAgICByb3VuZCgodGhpcy5pbnB1dC5jdXJzb3IueSAtIHJvdW5kKGlubmVySGVpZ2h0IC8gMikpICogc2NhbGVfeSk7XG4gIHRoaXMuY3Vyc29yLnggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChyb3VuZCh4MSkpO1xuICB0aGlzLmN1cnNvci55ID0gdGhpcy5jb3JlLm1hcC5sb29wX3kocm91bmQoeTEpKTtcbn07XG5cbi8qIFNjcmVlbiBwb3NpdGlvbiBvZiBhIGNvLW9yZGluYXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2NyZWVuX3Bvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgc2l6ZSkge1xuICB2YXIgeDEgPVxuICAgICAgdGhpcy5jYW52YXMuY3ggK1xuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeCh0aGlzLmNhbWVyYS54IC0gdGhpcy5jYW1lcmEuc3gsIHgpLFxuICAgIHkxID1cbiAgICAgIHRoaXMuY2FudmFzLmN5ICtcbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kodGhpcy5jYW1lcmEueSAtIHRoaXMuY2FtZXJhLnN5LCB5KSxcbiAgICBvbl9zY3JlZW4gPVxuICAgICAgeDEgPiAtc2l6ZSAmJlxuICAgICAgeDEgPCB0aGlzLmNhbnZhcy53ICsgc2l6ZSAmJlxuICAgICAgeTEgPiAtc2l6ZSAmJlxuICAgICAgeTEgPCB0aGlzLmNhbnZhcy5oICsgc2l6ZTtcblxuICByZXR1cm4ge1xuICAgIHg6IHgxLFxuICAgIHk6IHkxLFxuICAgIG9uX3NjcmVlbjogb25fc2NyZWVuXG4gIH07XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIE1haW4gQ2FudmFzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGNhbnZhc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9jYW52YXMgPSBmdW5jdGlvbigpIHtcbiAgLy8gc2V0IHVwIG1haW4gY2FudmFzIGRpbWVuc2lvbnMgYW5kIHBvc2l0aW9uXG4gIHZhciBkID0gc2VsZWN0KFwicHJvamVjdGFudHNcIik7XG4gIHRoaXMuY2FudmFzID0ge307XG5cbiAgLy8gbGltaXQgZ2FtZSBzaXplXG4gIHRoaXMuY2FudmFzLncgPSBkLm9mZnNldFdpZHRoO1xuICB0aGlzLmNhbnZhcy5oID0gZC5vZmZzZXRIZWlnaHQ7XG4gIGlmICh0aGlzLmNhbnZhcy5oIDwgODAwKSB7XG4gICAgdGhpcy5jYW52YXMudyA9IHJvdW5kKHRoaXMuY2FudmFzLncgKiAoODAwIC8gdGhpcy5jYW52YXMuaCkpO1xuICAgIHRoaXMuY2FudmFzLmggPSByb3VuZCh0aGlzLmNhbnZhcy5oICogKDgwMCAvIHRoaXMuY2FudmFzLmgpKTtcbiAgfVxuICBpZiAodGhpcy5jYW52YXMuaCA+IDEwMDApIHtcbiAgICB0aGlzLmNhbnZhcy53ID0gcm91bmQodGhpcy5jYW52YXMudyAqICgxMDAwIC8gdGhpcy5jYW52YXMuaCkpO1xuICAgIHRoaXMuY2FudmFzLmggPSByb3VuZCh0aGlzLmNhbnZhcy5oICogKDEwMDAgLyB0aGlzLmNhbnZhcy5oKSk7XG4gIH1cbiAgdGhpcy5jYW52YXMuY3ggPSByb3VuZCh0aGlzLmNhbnZhcy53IC8gMik7XG4gIHRoaXMuY2FudmFzLmN5ID0gcm91bmQodGhpcy5jYW52YXMuaCAvIDIpO1xuXG4gIC8vIGluaXRpYWxpc2UgbWFpbiBjYW52YXNcbiAgdGhpcy5jYW52YXMuY2FudiA9IGVsZW1lbnQoeyB0eXBlOiBcImNhbnZhc1wiIH0pO1xuICB0aGlzLmNhbnZhcy5jYW52LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICB0aGlzLmNhbnZhcy5jb250ID0gdGhpcy5jYW52YXMuY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIHRoaXMuY2FudmFzLmNhbnYud2lkdGggPSB0aGlzLmNhbnZhcy53O1xuICB0aGlzLmNhbnZhcy5jYW52LmhlaWdodCA9IHRoaXMuY2FudmFzLmg7XG5cbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmNhbnZhcy5jYW52KTtcbn07XG5cbi8qIEZyYW1lIHJlbmRlcmluZ1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2NhbnZhcyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjbGVhciB0aGUgY2FudmFzXG4gIHRoaXMuY2FudmFzLmNvbnQuY2xlYXJSZWN0KDAsIDAsIHRoaXMudywgdGhpcy5oKTtcblxuICAvLyBkbyB0aGUgZHJhd2luZ1xuICB0aGlzLmRyYXdfYmFja2dyb3VuZCgpO1xuICB0aGlzLmRyYXdfbWFwKCk7XG4gIHRoaXMuZHJhd19zcHJpdGVzKCk7XG4gIHRoaXMuZHJhd19sYWJlbHMoKTtcbiAgdGhpcy5kcmF3X21lc3NhZ2VzKCk7XG5cbiAgLy8gY2xlYXIgc3ByaXRlc1xuICB0aGlzLnNwcml0ZXMgPSBbXTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgT2JqZWN0IExhYmVsc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIE1hbmFnZSBsYWJlbHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fbGFiZWxzID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNyZWF0ZSBsYWJlbHNcbiAgZm9yIChrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAob2JqLmMubGFiZWxzICYmICF0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICB0aGlzLmxhYmVsc1trZXldID0ge307XG4gICAgICBmb3IgKHR5cGUgaW4gb2JqLmMubGFiZWxzKSB7XG4gICAgICAgIGlmIChvYmouYy5sYWJlbHNbdHlwZV0pIHtcbiAgICAgICAgICB0aGlzLmNyZWF0ZV9sYWJlbCh0aGlzLmxhYmVsc1trZXldLCB0eXBlLCBrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIHRocm91Z2ggbGFiZWxzXG4gIGZvciAoa2V5IGluIHRoaXMubGFiZWxzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKCFvYmopIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmxhYmVsc1trZXldO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGZvciAodHlwZSBpbiB0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICB0aGlzLnNldF9sYWJlbCh0aGlzLmxhYmVsc1trZXldW3R5cGVdLCBvYmopO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ3JlYXRlIGxhYmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3JlYXRlX2xhYmVsID0gZnVuY3Rpb24ocmVmLCB0eXBlLCBrZXkpIHtcbiAgLy8gY2hlY2sgaGVhbHRoIGlzIGFjdGl2ZVxuICBpZiAodHlwZSA9PT0gXCJwbGF5ZXJfaGVhbHRoXCIgJiYgIXRoaXMuc2NoZW1lLmhlYWx0aCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNyZWF0ZSBhbmQgYWRkIHRvIHJlZiBvYmplY3RcbiAgdmFyIGNhbnYgPSBlbGVtZW50KHsgdHlwZTogXCJjYW52YXNcIiB9KTtcbiAgdmFyIGNvbnQgPSBjYW52LmdldENvbnRleHQoXCIyZFwiKTtcbiAgcmVmW3R5cGVdID0geyBjYW52OiBjYW52LCBjb250OiBjb250LCB0ZXh0OiBcIlwiLCBrZXk6IGtleSwgdHlwZTogdHlwZSB9O1xufTtcblxuLyogU2V0IGxhYmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2xhYmVsID0gZnVuY3Rpb24obGFiZWwsIG9iaikge1xuICAvLyBwb3NpdGlvblxuICBpZiAobGFiZWwudHlwZSA9PT0gXCJwb3NpdGlvblwiKSB7XG4gICAgdGhpcy5zZXRfbGFiZWxfdGV4dChsYWJlbCwgb2JqLnggKyBcIiB8IFwiICsgb2JqLnkpO1xuICB9XG5cbiAgLy8gcGxheWVyIG5hbWVcbiAgZWxzZSBpZiAobGFiZWwudHlwZSA9PT0gXCJwbGF5ZXJfbmFtZVwiKSB7XG4gICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICBpZiAocGxheWVyKSB7XG4gICAgICB0aGlzLnNldF9sYWJlbF90ZXh0KGxhYmVsLCBwbGF5ZXIubmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmxhYmVsc1tsYWJlbC5rZXldW2xhYmVsLnR5cGVdO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIC8vIGhlYWx0aCBiYXJcbiAgZWxzZSBpZiAobGFiZWwudHlwZSA9PT0gXCJwbGF5ZXJfaGVhbHRoXCIpIHtcbiAgICB0aGlzLnNldF9sYWJlbF9oZWFsdGgobGFiZWwsIG9iai5wbGF5ZXJfaWQpO1xuICB9XG5cbiAgLy8gdGltZW91dFxuICBlbHNlIGlmIChsYWJlbC50eXBlID09PSBcInRpbWVvdXRcIikge1xuICAgIHRoaXMuc2V0X2xhYmVsX3RleHQoXG4gICAgICBsYWJlbCxcbiAgICAgIGNlaWwoKG9iai5jLnRpbWVvdXQgLSAodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC0gb2JqLmZyYW1lKSkgLyAyNClcbiAgICApO1xuICB9XG59O1xuXG4vKiBTZXQgdGV4dCBsYWJlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9sYWJlbF90ZXh0ID0gZnVuY3Rpb24obGFiZWwsIHRleHQpIHtcbiAgLy8gcHJlcCB0ZXh0XG4gIHRleHQgPSBTdHJpbmcodGV4dCk7XG4gIHRleHQgPSBzdHJfc3BhY2UodGV4dCk7XG5cbiAgLy8gaWYgdGhlcmUncyBubyBjaGFuZ2UgdG8gdGV4dFxuICBpZiAobGFiZWwudGV4dCA9PT0gdGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGRyYXcgdGV4dFxuICBsYWJlbC53ID0gbGFiZWwuY29udC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aCArIDk7XG4gIGxhYmVsLmggPSAxODtcbiAgbGFiZWwuY2Fudi53aWR0aCA9IGxhYmVsLnc7XG4gIGxhYmVsLmNhbnYuaGVpZ2h0ID0gbGFiZWwuaDtcbiAgbGFiZWwuY29udC5yZXN0b3JlKCk7XG4gIGxhYmVsLmNvbnQuY2xlYXJSZWN0KDAsIDAsIGxhYmVsLmNhbnYud2lkdGgsIGxhYmVsLmNhbnYuaGVpZ2h0KTtcbiAgbGFiZWwuY29udC5mb250ID0gXCIxMnB4ICdPcmJpdHJvbidcIjtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcIiMwMDBcIjtcbiAgbGFiZWwuY29udC5maWx0ZXIgPSBcImRyb3Atc2hhZG93KDAgMnB4IDRweCAjMDAwKVwiO1xuICBsYWJlbC5jb250LmZpbGxUZXh0KHRleHQsIDQsIDE0ICsgMC41KTtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcIiNkZGRcIjtcbiAgbGFiZWwuY29udC5maWxsVGV4dCh0ZXh0LCA0LCAxMiArIDAuNSk7XG4gIGxhYmVsLmNvbnQuc2F2ZSgpO1xufTtcblxuLyogU2V0IGhlYWx0aCBsYWJlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9sYWJlbF9oZWFsdGggPSBmdW5jdGlvbihsYWJlbCwgcGxheWVyX2lkKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuaGVhbHRoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgZGVsZXRlIHRoaXMubGFiZWxzW2xhYmVsLmtleV1bbGFiZWwudHlwZV07XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYXJlIHdlIGRvaW5nIGFueXRoaW5nIGF0IGFsbFxuICB2YXIgbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoW3BsYXllci5sZXZlbF07XG4gIGlmICghbGV2ZWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpcyBpdCB0aGUgc2FtZVxuICB2YXIgdGV4dCA9IHBsYXllci5oZWFsdGggKyBcIiAvIFwiICsgbGV2ZWw7XG4gIGlmICh0ZXh0ID09PSBsYWJlbC50ZXh0KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxhYmVsLnRleHQgPSB0ZXh0O1xuXG4gIC8vIGRyYXcgbGFiZWxcbiAgbGFiZWwudyA9IHJvdW5kKGxldmVsIC8gMikgKyA2O1xuICBsYWJlbC5oID0gODtcbiAgbGFiZWwuY2Fudi53aWR0aCA9IGxhYmVsLnc7XG4gIGxhYmVsLmNhbnYuaGVpZ2h0ID0gbGFiZWwuaDtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcInJnYmEoMjU1LDI1NSwyNTUsMC4xKVwiO1xuICBsYWJlbC5jb250LmZpbGxSZWN0KDAsIDAsIGxhYmVsLncsIGxhYmVsLmgpO1xuICBsYWJlbC5jb250LmZpbGxTdHlsZSA9IFwicmdiYSgwLDAsMCwwLjgpXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFJlY3QoMSwgMSwgbGFiZWwudyAtIDIsIGxhYmVsLmggLSAyKTtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcIiNlNDFhMWFcIjtcbiAgbGFiZWwuY29udC5maWxsUmVjdCgzLCAzLCByb3VuZChwbGF5ZXIuaGVhbHRoIC8gMiksIDIpO1xuXG4gIC8vIGFyZSB3ZSBoaWRpbmcgaXRcbiAgbGFiZWwuaGlkZSA9IHBsYXllci5kZWFkO1xufTtcblxuLyogRHJhdyBsYWJlbHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X2xhYmVscyA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIGFsbCBsYWJlbHNcbiAgZm9yIChrZXkgaW4gdGhpcy5sYWJlbHMpIHtcbiAgICAvLyBpZ25vcmUgZW1wdGllcyBvciBoaWRkZW5zXG4gICAgaWYgKCF0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgc2NyZWVuIHBvc2l0aW9uIG9mIG9iamVjdFxuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIHZhciBwb3NpdGlvbiA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKG9iai5keCwgb2JqLmR5LCA1MCk7XG5cbiAgICAvLyBpZ25vcmUgdG9vIGZhciBhd2F5IG9iamVjdHNcbiAgICBpZiAoIXBvc2l0aW9uLm9uX3NjcmVlbikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ28gdGhyb3VnaCBsYWJlbHNcbiAgICB2YXIgbiA9IDA7XG4gICAgZm9yICh0eXBlIGluIHRoaXMubGFiZWxzW2tleV0pIHtcbiAgICAgIHZhciBsYWJlbCA9IHRoaXMubGFiZWxzW2tleV1bdHlwZV07XG4gICAgICBpZiAobGFiZWwuaGlkZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciB4ID0gcm91bmQocG9zaXRpb24ueCAtIGxhYmVsLncgLyAyKSArIDA7XG4gICAgICB2YXIgeSA9XG4gICAgICAgIHJvdW5kKHBvc2l0aW9uLnkgLSBsYWJlbC5oIC8gMiAtIG9iai5jLnNpemUgKiAyIC0gKGxhYmVsLmggLSA1KSAqIG4pIC1cbiAgICAgICAgMjA7XG4gICAgICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShsYWJlbC5jYW52LCB4LCB5KTtcbiAgICAgIG4rKztcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgTWFwIEdyYXBoaWNzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIHRoZSBtYXAgY2FudmFzZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X21hcCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24tb3V0XCI7XG59O1xuXG4vKiBEcmF3IHRoZSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X21hcCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgeCA9IHRoaXMuY2FudmFzLmN4IC0gdGhpcy5jYW1lcmEueCArIHRoaXMuY2FtZXJhLnN4O1xuICB2YXIgeSA9IHRoaXMuY2FudmFzLmN5IC0gdGhpcy5jYW1lcmEueSArIHRoaXMuY2FtZXJhLnN5O1xuXG4gIC8vIGRyYXcgbGF5ZXJzXG4gIHRoaXMuZHJhd19yZXBlYXRpbmdfbGF5ZXIodGhpcy5tYXAuYmcuY2FudiwgeCwgeSk7XG4gIHRoaXMuZHJhd19yZXBlYXRpbmdfbGF5ZXIodGhpcy5tYXAuZmcuY2FudiwgeCwgeSk7XG59O1xuXG4vKiBEcmF3IGxheWVyIGNhbnZhcyByZXBlYXRpbmcgb24gYWxsIHNpZGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19yZXBlYXRpbmdfbGF5ZXIgPSBmdW5jdGlvbihjYW52LCB4LCB5KSB7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggLSBjYW52LndpZHRoLCB5IC0gY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4LCB5IC0gY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4ICsgY2Fudi53aWR0aCwgeSAtIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCAtIGNhbnYud2lkdGgsIHkpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4ICsgY2Fudi53aWR0aCwgeSk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggLSBjYW52LndpZHRoLCB5ICsgY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4LCB5ICsgY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4ICsgY2Fudi53aWR0aCwgeSArIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCwgeSk7XG59O1xuXG4vKiBEZXN0cm95IGxhbmQgb24gdGhlIG1hcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRlc3Ryb3lfbGFuZCA9IGZ1bmN0aW9uKHgsIHksIHNpemUpIHtcbiAgdGhpcy5tYXAuZmcuY29udC5iZWdpblBhdGgoKTtcbiAgdGhpcy5tYXAuZmcuY29udC5hcmMoeCwgeSwgc2l6ZSwgMCwgMiAqIHBpKTtcbiAgdGhpcy5tYXAuZmcuY29udC5maWxsKCk7XG59O1xuXG4vKiBHZXQgYSBwaWVjZSBvZiBsYW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZ2V0X2xhbmRfYmxvY2sgPSBmdW5jdGlvbih4LCB5LCB3LCBoKSB7XG4gIHZhciBjYW52ID0gZWxlbWVudCh7IHR5cGU6IFwiY2FudmFzXCIgfSk7XG4gIHZhciBjb250ID0gY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGNhbnYud2lkdGggPSB3O1xuICBjYW52LmhlaWdodCA9IGg7XG4gIGNvbnQuZHJhd0ltYWdlKHRoaXMubWFwLmZnLmNhbnYsIHgsIHksIHcsIGgsIDAsIDAsIHcsIGgpO1xuXG4gIHJldHVybiBjYW52O1xufTtcblxuLyogRHJhdyBwaWVjZSBvZiBsYW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19sYW5kX2Jsb2NrID0gZnVuY3Rpb24oeCwgeSwgY2Fudikge1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwibm9ybWFsXCI7XG4gIHRoaXMubWFwLmZnLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHgsIHkpO1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24tb3V0XCI7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIE9iamVjdCBNZXNzYWdlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIERyYXcgdGhlIG1lc3NhZ2VzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19tZXNzYWdlcyA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIG1lc3NhZ2VzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBtZXNzYWdlID0gdGhpcy5tZXNzYWdlc1tpXTtcblxuICAgIC8vIGluY3JlbWVudCB0aW1lXG4gICAgbWVzc2FnZS50aW1lKys7XG4gICAgaWYgKG1lc3NhZ2UudGltZSA+IDQwKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VzLnNwbGljZShpLCAxKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBzY3JlZW4gcG9zaXRpb24gb2YgbWVzc2FnZVxuICAgIHZhciBwb3NpdGlvbiA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKG1lc3NhZ2UueCwgbWVzc2FnZS55LCA1MCk7XG5cbiAgICAvLyBpZ25vcmUgdG9vIGZhciBhd2F5IG1lc3NhZ2VzXG4gICAgaWYgKCFwb3NpdGlvbi5vbl9zY3JlZW4pIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdvIHRocm91Z2ggbGFiZWxzXG4gICAgdmFyIHggPSByb3VuZChwb3NpdGlvbi54IC0gbWVzc2FnZS53IC8gMikgKyAwLjU7XG4gICAgdmFyIHkgPSByb3VuZChwb3NpdGlvbi55IC0gbWVzc2FnZS5oIC8gMikgLSAzMC41IC0gbWVzc2FnZS50aW1lO1xuXG4gICAgdGhpcy5jYW52YXMuY29udC5zYXZlKCk7XG4gICAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoMCwgMCk7XG4gICAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UobWVzc2FnZS5jYW52LCB4LCB5KTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnJlc3RvcmUoKTtcbiAgfVxufTtcblxuLyogTG9vayBmb3IgY2hhbmdlcyBpbiBoZWFsdGhcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfbWVzc2FnZSA9IGZ1bmN0aW9uKG9iaiwgY29sLCB0ZXh0LCBzaXplLCB5X29mZnNldCkge1xuICAvLyBzZXQgdXAgY2FudmFzXG4gIHZhciBtZXNzYWdlID0ge307XG4gIG1lc3NhZ2UuY2FudiA9IGVsZW1lbnQoeyB0eXBlOiBcImNhbnZhc1wiIH0pO1xuICBtZXNzYWdlLmNvbnQgPSBtZXNzYWdlLmNhbnYuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gIC8vIGRyYXcgdGV4dFxuICB0ZXh0ID0gc3RyX3NwYWNlKHRleHQpO1xuICBtZXNzYWdlLmNvbnQuZm9udCA9IHNpemUgKyBcInB4IE9yYml0cm9uXCI7XG4gIG1lc3NhZ2UudyA9IHJvdW5kKG1lc3NhZ2UuY29udC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aCkgKyA4O1xuICBtZXNzYWdlLmggPSBzaXplICsgNDtcbiAgbWVzc2FnZS5jYW52LndpZHRoID0gbWVzc2FnZS53O1xuICBtZXNzYWdlLmNhbnYuaGVpZ2h0ID0gbWVzc2FnZS5oO1xuICBtZXNzYWdlLmNvbnQuZm9udCA9IHNpemUgKyBcInB4IE9yYml0cm9uXCI7XG4gIC8vIG1lc3NhZ2UuY29udC5maWxsU3R5bGUgPSBcIiMwMDBcIjtcbiAgLy8gbWVzc2FnZS5jb250LmZpbGxUZXh0KHRleHQsIDMuNSwgc2l6ZSArIDAuNSk7XG4gIG1lc3NhZ2UuY29udC5maWxsU3R5bGUgPSBjb2w7XG4gIG1lc3NhZ2UuY29udC5maWxsVGV4dCh0ZXh0LCAzLjUsIHNpemUgKyAwLjUpO1xuXG4gIC8vIHNldCBwb3NpdGlvblxuICB2YXIgeV9vZmZzZXQgPSB5X29mZnNldCB8fCAwO1xuICBtZXNzYWdlLnggPSBvYmoueDtcbiAgbWVzc2FnZS55ID0gb2JqLnkgKyB5X29mZnNldDtcbiAgbWVzc2FnZS50aW1lID0gMDtcblxuICAvLyBhZGQgdG8gYXJyYXlcbiAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBTcHJpdGVzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIHNwcml0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X3Nwcml0ZXMgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5zcHJpdGVzID0gW107XG5cbiAgLy8gb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAob2JqLmhpZGUgPiAwKSB7XG4gICAgICBvYmouaGlkZS0tO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChvYmoudHlwZSA9PT0gXCJwbGF5ZXJcIikge1xuICAgICAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICAgICAgaWYgKHBsYXllcikge1xuICAgICAgICBpZiAocGxheWVyLmhpdCA+IDApIHtcbiAgICAgICAgICB0aGlzLmRyYXdfcGxheWVyX2hpdF9zcHJpdGVzKG9iaiwgcGxheWVyLmhpdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kcmF3X3BsYXllcl9zcHJpdGVzKG9iaiwgcGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHZhciBhcmdzID0ge1xuICAgICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICAgIHR5cGU6IG9iai5zcHJpdGVfa2V5LFxuICAgICAgeDogb2JqLmR4LFxuICAgICAgeTogb2JqLmR5LFxuICAgICAgYW5nbGU6IG9iai5kaXNwbGF5X2FuZ2xlLFxuICAgICAgYW5pbWF0ZTogb2JqLmFuaW1hdGUsXG4gICAgICBmbG9hdDogb2JqLmMuYW5pbWF0aW9uLmFpcl9mbG9hdCxcbiAgICAgIHJlcGVhdDogdHJ1ZVxuICAgIH07XG4gICAgdGhpcy5zcHJpdGVzLnVuc2hpZnQoYXJncyk7XG4gIH1cblxuICAvLyBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmV4cGxvc2lvbnMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5leHBsb3Npb25zW2tleV07XG4gICAgdmFyIGFyZ3MgPSB7XG4gICAgICBmcmFtZTogb2JqLmZyYW1lLFxuICAgICAgdHlwZTogb2JqLnNwcml0ZSxcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBhbmltYXRlOiB0cnVlXG4gICAgfTtcbiAgICB0aGlzLnNwcml0ZXMucHVzaChhcmdzKTtcbiAgfVxuXG4gIC8vIGRlY29yYXRpb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmRlY29yYXRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuZGVjb3JhdGlvbnNba2V5XTtcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgIGZyYW1lOiBvYmouZnJhbWUsXG4gICAgICB0eXBlOiBvYmouc3ByaXRlLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIGFuZ2xlOiBvYmouYW5nbGUsXG4gICAgICBhbmltYXRlOiB0cnVlLFxuICAgICAgcmVwZWF0OiBvYmoucmVwZWF0XG4gICAgfTtcbiAgICB0aGlzLnNwcml0ZXMudW5zaGlmdChhcmdzKTtcbiAgfVxuXG4gIC8vIGdldCBhcnJvd3NcbiAgdGhpcy5ydW5fYXJyb3dzKCk7XG5cbiAgLy8gZHJhdyB0aGVtXG4gIHRoaXMuZHJhd19zcHJpdGVzX2NhbnYoKTtcbn07XG5cbi8qIFBsYXllciBzcHJpdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19wbGF5ZXJfc3ByaXRlcyA9IGZ1bmN0aW9uKG9iaiwgcGxheWVyKSB7XG4gIHZhciB3ID1cbiAgICB0aGlzLnBsYXllcl9pZCA9PT0gb2JqLnBsYXllcl9pZCA/IHRoaXMuY3VycmVudF93ZWFwb24gOiBwbGF5ZXIud2VhcG9uO1xuICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbd107XG5cbiAgLy8gYm9keVxuICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICB0eXBlOiBvYmouc3ByaXRlX2tleSxcbiAgICB4OiBvYmouZHgsXG4gICAgeTogb2JqLmR5LFxuICAgIGFuZ2xlOiBvYmouZGlzcGxheV9hbmdsZSxcbiAgICBhbmltYXRlOiBvYmouYW5pbWF0ZSxcbiAgICByZXBlYXQ6IHRydWVcbiAgfSk7XG5cbiAgLy8gZ2V0IGhlYWQgZGlyZWN0aW9uIGFuZCBhbmdsZVxuICB2YXIgaGVhZF9kaXIgPSBvYmouZGlyZWN0aW9uO1xuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgdmFyIGRpZmYgPSBuX2RpZmYoXG4gICAgICBvYmouYmFycmVsX2FuZ2xlLFxuICAgICAgYW5nbGVfYWRkKG9iai5kaXNwbGF5X2FuZ2xlLCA5MCksXG4gICAgICAwLFxuICAgICAgMzYwXG4gICAgKTtcbiAgICBoZWFkX2RpciA9IGRpZmYgPj0gLTE4MCAmJiBkaWZmIDwgMCA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICB9XG4gIHZhciBoZWFkX2FuZ2xlID1cbiAgICBoZWFkX2RpciA9PT0gXCJyaWdodFwiID8gYW5nbGVfYWRkKG9iai5iYXJyZWxfYW5nbGUsIDE4MCkgOiBvYmouYmFycmVsX2FuZ2xlO1xuXG4gIC8vIHdlYXBvbnNcbiAgdmFyIHdlYXBvbl9zcHJpdGUgPSBcIlwiO1xuICBpZiAod2VhcG9uICYmIHdlYXBvbi5zcHJpdGUpIHtcbiAgICB2YXIgd2VhcG9uX3Nwcml0ZSA9IHdlYXBvbi5zcHJpdGU7XG4gICAgdmFyIHdlYXBvbl9mcmFtZSA9IDA7XG4gICAgdmFyIHRocm93aW5nID0gd2VhcG9uLnNwcml0ZSA9PT0gXCJ0aHJvd1wiO1xuXG4gICAgLy8ganVzdCBmaXJlZCBzcHJpdGVzXG4gICAgaWYgKG9iai5maXJlX3Nwcml0ZV9jb3VudCkge1xuICAgICAgd2VhcG9uX3Nwcml0ZSA9IHdlYXBvbi5maXJlX3Nwcml0ZTtcbiAgICAgIHdlYXBvbl9mcmFtZSA9IG9iai5maXJlX3Nwcml0ZV9mcmFtZTtcbiAgICAgIHRocm93aW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gYWRkIHRoZSB3ZWFwb24gc3ByaXRlXG4gICAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgICAgdHlwZTogXCJhbnQtd2VhcG9uLVwiICsgd2VhcG9uX3Nwcml0ZSArIFwiLVwiICsgaGVhZF9kaXIsXG4gICAgICB4OiB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHgpLFxuICAgICAgeTogdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5KSxcbiAgICAgIGZyYW1lOiB3ZWFwb25fZnJhbWUsXG4gICAgICBhbmltYXRlOiB0cnVlLFxuICAgICAgcmVwZWF0OiB0cnVlLFxuICAgICAgYW5nbGU6IGhlYWRfYW5nbGVcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGhlYWRcbiAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgIHR5cGU6IFwiYW50LWhlYWQtXCIgKyBoZWFkX2RpcixcbiAgICB4OiB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHgpLFxuICAgIHk6IHRoaXMuY29yZS5tYXAubG9vcF95KG9iai5keSksXG4gICAgYW5pbWF0ZTogdHJ1ZSxcbiAgICByZXBlYXQ6IHRydWUsXG4gICAgYW5nbGU6IGhlYWRfYW5nbGVcbiAgfSk7XG5cbiAgLy8gYWRkIGEgdGhyb3cgd2VhcG9uXG4gIGlmICh0aHJvd2luZykge1xuICAgIHZhciB0b2JqID0gdGhpcy5jLm9iamVjdHNbd2VhcG9uLm9iamVjdF07XG4gICAgdmFyIHRzcHJpdGUgPSB0b2JqLmFuaW1hdGlvbi5zcHJpdGU7XG4gICAgdmFyIHRvZmZfeCA9IHh5X3NwZWVkKG9iai5iYXJyZWxfYW5nbGUsIC0xNik7XG4gICAgdmFyIHRvZmZfeSA9IHh5X3NwZWVkKGFuZ2xlX2FkZChoZWFkX2FuZ2xlLCA5MCksIDE0KTtcbiAgICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgICB0eXBlOiB0c3ByaXRlLFxuICAgICAgeDogdGhpcy5jb3JlLm1hcC5sb29wX3gob2JqLmR4ICsgdG9mZl94LnggKyB0b2ZmX3kueCksXG4gICAgICB5OiB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkgKyB0b2ZmX3gueSArIHRvZmZfeS55KSxcbiAgICAgIGFuaW1hdGU6IGZhbHNlLFxuICAgICAgYW5nbGU6IGFuZ2xlX2FkZChvYmouYmFycmVsX2FuZ2xlLCA5MClcbiAgICB9KTtcbiAgfVxuXG4gIC8vIC8vIHNldCBjcm9zc2hhaXJcbiAgLy8gaWYgKHRoaXMucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkKSB7XG4gIC8vIFx0dmFyIG9mZnggPSB4eV9zcGVlZChhbmdsZSwgNTAgKyB3ZWFwb24ub2Zmc2V0X3gpO1xuICAvLyBcdHZhciBvZmZ5ID0geHlfc3BlZWQob2Zmc2V0X2FuZ2xlLCA3KTtcbiAgLy8gXHR0aGlzLnNwcml0ZXMucHVzaCh7XG4gIC8vIFx0XHR0eXBlOiBcImNyb3NzaGFpclwiLFxuICAvLyBcdFx0eDogcm91bmQob2JqLmR4ICsgb2ZmeC54ICsgb2ZmeS54KSxcbiAgLy8gXHRcdHk6IHJvdW5kKG9iai5keSArIG9mZngueSArIG9mZnkueSksXG4gIC8vIFx0XHRhbmdsZTogYW5nbGVfYWRkKHRoaXMuY3Jvc3NoYWlyLCAxODApXG4gIC8vIFx0fSk7XG4gIC8vIH1cbn07XG5cbi8qIFBsYXllciBoaXQgc3ByaXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfcGxheWVyX2hpdF9zcHJpdGVzID0gZnVuY3Rpb24ob2JqLCBoaXQpIHtcbiAgLy8gYm9keVxuICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICB0eXBlOiBoaXQgPCAxNSA/IFwiYW50LWJvZHktYWlyLWxlZnRcIiA6IFwiYW50LWJvZHktaGl0XCIsXG4gICAgeDogb2JqLmR4LFxuICAgIHk6IG9iai5keSxcbiAgICBhbmdsZTogb2JqLmRpc3BsYXlfYW5nbGUsXG4gICAgYW5pbWF0ZTogb2JqLmFuaW1hdGUsXG4gICAgcmVwZWF0OiB0cnVlXG4gIH0pO1xuXG4gIC8vIGhlYWRcbiAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgIHR5cGU6IGhpdCA8IDE1ID8gXCJhbnQtaGVhZC1sZWZ0XCIgOiBcImFudC1oZWFkLWhpdFwiLFxuICAgIHg6IHRoaXMuY29yZS5tYXAubG9vcF94KG9iai5keCksXG4gICAgeTogdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5KSxcbiAgICBhbmltYXRlOiB0cnVlLFxuICAgIHJlcGVhdDogdHJ1ZSxcbiAgICBhbmdsZTogb2JqLmRpc3BsYXlfYW5nbGVcbiAgfSk7XG59O1xuXG4vKiBEcmF3IHNwcml0ZXMgb24gdGhlIGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfc3ByaXRlc19jYW52ID0gZnVuY3Rpb24oKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zcHJpdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwcml0ZSA9IHRoaXMuc3ByaXRlc1tpXTtcblxuICAgIC8vIGdldCBwb3NpdGlvbiBvbiBzY3JlZW5cbiAgICB2YXIgc2NyZWVuX3Bvc2l0aW9uID0gdGhpcy5zY3JlZW5fcG9zaXRpb24oc3ByaXRlLngsIHNwcml0ZS55LCA0OCk7XG4gICAgaWYgKCFzY3JlZW5fcG9zaXRpb24ub25fc2NyZWVuKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgc3ByaXRlIGtleVxuICAgIHZhciBzcHJpdGVfa2V5ID0gc3ByaXRlLnR5cGU7XG4gICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYy5hbmltYXRpb25zW3Nwcml0ZV9rZXldO1xuICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgIHNwcml0ZV9rZXkgPSBhbmltYXRpb25bMF07XG4gICAgICBpZiAoc3ByaXRlLmFuaW1hdGUpIHtcbiAgICAgICAgdmFyIGZyYW1lID0gc3ByaXRlLmZyYW1lIHx8IDA7XG4gICAgICAgIGZyYW1lID0gZmxvb3IoKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAtIGZyYW1lKSAvIDIpO1xuICAgICAgICBpZiAoc3ByaXRlLnJlcGVhdCkge1xuICAgICAgICAgIGZyYW1lID0gZnJhbWUgJSBhbmltYXRpb24ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHNwcml0ZV9rZXkgPSBhbmltYXRpb25bZnJhbWVdO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGdldCBzcHJpdGUgcmVmZXJlbmNlIHBvc2l0aW9uc1xuICAgIHZhciBzcHJpdGVfcmVmID0gdGhpcy5jLnNwcml0ZXNbc3ByaXRlX2tleV07XG4gICAgaWYgKCFzcHJpdGVfcmVmKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgbmV3IHBvc2l0aW9uIHRvIGRyYXcgb25cbiAgICB2YXIgc2l6ZSA9IHNwcml0ZV9yZWYuc2l6ZTtcbiAgICB2YXIgcG9zID0gLShzaXplIC8gMik7XG5cbiAgICAvLyBmbG9hdCBlZmZlY3RcbiAgICB2YXIgeV9hZGQgPSAwO1xuICAgIGlmIChzcHJpdGUuZmxvYXQpIHtcbiAgICAgIHlfYWRkID0gY29zKCh0aGlzLmNvcmUuc3RhdGUuZnJhbWUgLSBzcHJpdGUuZnJhbWUpIC8gNCkgKiAyO1xuICAgIH1cblxuICAgIC8vIGRyYXcgaXRcbiAgICB0aGlzLmNhbnZhcy5jb250LnNhdmUoKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZShzY3JlZW5fcG9zaXRpb24ueCwgc2NyZWVuX3Bvc2l0aW9uLnkgKyB5X2FkZCk7XG4gICAgaWYgKHNwcml0ZS5hbmdsZSAhPT0gMCkge1xuICAgICAgdGhpcy5jYW52YXMuY29udC5yb3RhdGUoKHNwcml0ZS5hbmdsZSAqIE1hdGguUEkpIC8gMTgwKTtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoXG4gICAgICB0aGlzLmltZy5zcHJpdGVzLFxuICAgICAgc3ByaXRlX3JlZi54LFxuICAgICAgc3ByaXRlX3JlZi55LFxuICAgICAgc2l6ZSxcbiAgICAgIHNpemUsXG4gICAgICBwb3MsXG4gICAgICBwb3MsXG4gICAgICBzaXplLFxuICAgICAgc2l6ZVxuICAgICk7XG4gICAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoXG4gICAgICAtc2NyZWVuX3Bvc2l0aW9uLngsXG4gICAgICAtKHNjcmVlbl9wb3NpdGlvbi55ICsgeV9hZGQpXG4gICAgKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnJlc3RvcmUoKTtcbiAgfVxufTtcbiJdfQ==

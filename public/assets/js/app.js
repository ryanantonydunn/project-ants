var config = config || {};
config.animations = {
  "ant-body-hit": [
    "ant-body-hit-1",
    "ant-body-hit-2",
    "ant-body-hit-1",
    "ant-body-hit-3"
  ],
  "ant-body-still-left": ["ant-body-walk-left-1"],
  "ant-body-still-right": ["ant-body-walk-right-1"],
  "ant-body-walk-left": [
    "ant-body-walk-left-2",
    "ant-body-walk-left-3",
    "ant-body-walk-left-4",
    "ant-body-walk-left-5"
  ],
  "ant-body-walk-right": [
    "ant-body-walk-right-2",
    "ant-body-walk-right-3",
    "ant-body-walk-right-4",
    "ant-body-walk-right-5"
  ],
  "ant-head-left": [
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-2",
    "ant-head-left-3",
    "ant-head-left-2"
  ],
  "ant-head-right": [
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-2",
    "ant-head-right-3",
    "ant-head-right-2"
  ],
  "ant-head-hit": ["ant-head-hit-1", "ant-head-hit-2", "ant-head-hit-3"],
  "ant-weapon-bazooka-left": ["ant-weapon-bazooka-left"],
  "ant-weapon-bazooka-right": ["ant-weapon-bazooka-right"],
  "ant-weapon-laser-left": ["ant-weapon-laser-left"],
  "ant-weapon-laser-right": ["ant-weapon-laser-right"],
  "ant-weapon-throw-left": ["ant-weapon-throw-left-1"],
  "ant-weapon-throw-fire-left": [
    "ant-weapon-throw-left-2",
    "ant-weapon-throw-left-3",
    "ant-weapon-throw-left-4",
    "ant-weapon-throw-left-5",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1"
  ],
  "ant-weapon-throw-right": ["ant-weapon-throw-right-1"],
  "ant-weapon-throw-fire-right": [
    "ant-weapon-throw-right-2",
    "ant-weapon-throw-right-3",
    "ant-weapon-throw-right-4",
    "ant-weapon-throw-right-5",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1"
  ],
  "ant-weapon-dig-left": ["ant-weapon-dig-left-1"],
  "ant-weapon-dig-fire-left": [
    "ant-weapon-dig-left-2",
    "ant-weapon-dig-left-3",
    "ant-weapon-dig-left-4"
  ],
  "ant-weapon-dig-right": ["ant-weapon-dig-right-1"],
  "ant-weapon-dig-fire-right": [
    "ant-weapon-dig-right-2",
    "ant-weapon-dig-right-3",
    "ant-weapon-dig-right-4"
  ],
  "ant-ghost": [
    "ant-ghost-1",
    "ant-ghost-1",
    "ant-ghost-2",
    "ant-ghost-2",
    "ant-ghost-3",
    "ant-ghost-3",
    "ant-ghost-2",
    "ant-ghost-2"
  ],
  "bubble-blue": [
    "ball-blue-1",
    "ball-blue-2",
    "ball-blue-3",
    "ball-blue-4",
    "ball-blue-5"
  ],
  "explosion-l": [
    "explosion-l-1",
    "explosion-l-2",
    "explosion-l-3",
    "explosion-l-4",
    "explosion-l-5",
    "explosion-l-6",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion2-l": [
    "explosion2-l-1",
    "explosion2-l-2",
    "explosion2-l-3",
    "explosion2-l-4",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion-green-l": [
    "explosion-green-l-1",
    "explosion-green-l-2",
    "explosion-green-l-3",
    "explosion-green-l-4",
    "explosion-green-l-5",
    "explosion-green-l-6",
    "explosion-green-l-7",
    "explosion-green-l-8"
  ],
  "explosion-laser-blue": [
    "explosion-laser-blue-1",
    "explosion-laser-blue-2",
    "explosion-laser-blue-3",
    "explosion-laser-blue-4",
    "explosion-laser-blue-5"
  ],
  flame: ["flame-1", "flame-2", "flame-3", "flame-4", "flame-5"],
  "flame-large": [
    "flame-large-1",
    "flame-large-2",
    "flame-large-3",
    "flame-large-4",
    "flame-large-5",
    "flame-large-6"
  ],
  focus: [
    "focus-1",
    "focus-2",
    "focus-3",
    "focus-4",
    "focus-5",
    "focus-6",
    "focus-7",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8"
  ],
  "gem-green": [
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-2",
    "gem-green-3",
    "gem-green-4"
  ],
  "gem-blue": [
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-2",
    "gem-blue-3",
    "gem-blue-4"
  ],
  "gem-red": [
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-2",
    "gem-red-3",
    "gem-red-4"
  ],
  "gem-purple": [
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-2",
    "gem-purple-3",
    "gem-purple-4"
  ],
  "gem-silver": [
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-2",
    "gem-silver-3",
    "gem-silver-4"
  ],
  "grenade-armed": [
    "grenade-green",
    "grenade-red",
    "grenade-red",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green"
  ],
  "mine-active": [
    "mine-red",
    "mine-red",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey"
  ],
  "smoke-green": [
    "smoke-green-1",
    "smoke-green-2",
    "smoke-green-3",
    "smoke-green-4",
    "smoke-green-5",
    "smoke-green-6",
    "smoke-green-7",
    "smoke-green-8"
  ],
  teleport: [
    "teleport-1",
    "teleport-2",
    "teleport-3",
    "teleport-4",
    "teleport-5",
    "teleport-6",
    "teleport-7"
  ],
  vortex: [
    "vortex-1",
    "vortex-2",
    "vortex-3",
    "vortex-4",
    "vortex-5",
    "vortex-6",
    "vortex-7",
    "vortex-8",
    "vortex-10",
    "vortex-11"
  ]
};

var config = config || {};
config.mapgen = {
  land_type: [
    {
      edge: 1,
      bg: "dirt",
      fg: "rock",
      decorations: {
        "1": [
          {
            x: 432,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 468,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 504,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 540,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 576,
            y: 0,
            w: 36,
            h: 72
          }
        ],
        "2": [
          {
            x: 0,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 72,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 144,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 216,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 288,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 360,
            y: 0,
            w: 72,
            h: 72
          }
        ]
      }
    }
  ]
};

var config = config || {};
config.names = [
  "Dave Lister",
  "Ace Rimmer",
  "Queeg 500",
  "Abradolf Lincler",
  "Beardless Riker",
  "The Ant With No Name",
  "Al Capone",
  "The Queen",
  "Mickey Eyes"
];

var config = config || {};
config.objects = {
  default: {
    size: 1,
    weight: 0,
    bounce: 0.4,
    timeout: 0,
    damage: 30,
    knock: 1,
    spawn: false,
    player_lock: false,
    launch_distance: 2,
    destroy_ground: true,
    stop: 0,
    ignore_level_damage: false,
    events: {
      frame: "",
      ground: "",
      object: "",
      explosion: "",
      die: ""
    },
    object_events: {},
    speed: {
      max_gravity: 30,
      max: 40,
      move: 4,
      jump: 10
    },
    cluster: {
      circle: true,
      object: "grenade",
      speed: 2,
      count: 6
    },
    animation: {
      explosion: "explosion-l",
      sprite: "",
      air_spin: false,
      air_float: false,
      static_angle: false,
      ground: false
    },
    audio: {
      explosion: "explosion",
      bounce: "donk",
      hit: "",
      air: "",
      walk: "walk"
    },
    labels: {
      player_health: false,
      player_name: false,
      timeout: false
    },
    trails: {
      count: 0,
      speed: 0.6,
      offset_x: 0,
      offset_y: 0,
      timeout: 0,
      rotate: false,
      move: true,
      sprite: ""
    }
  },
  player: {
    size: 12,
    weight: 0.7,
    bounce: 0.7,
    events: {
      ground: "player_bounce",
      explosion: "hit_receive"
    },
    object_events: {
      crate: "collect",
      medpack: "collect",
      "gem-1": "collect",
      "gem-5": "collect",
      "gem-20": "collect",
      "gem-50": "collect",
      "gem-200": "collect",
      vortex: "collect"
    },
    animation: {
      sprite: "ant-body",
      air_spin: false,
      ground: false
    },
    audio: {
      bounce: "doink",
      explosion: "pop"
    },
    labels: {
      player_health: true,
      player_name: true
    }
  },
  player_missile: {
    size: 12,
    weight: 0.7,
    damage: 50,
    events: {
      ground: ["bounce_explode", "spawn_ghost"],
      explosion: ["bounce_explode", "spawn_ghost"]
    },
    object_events: {
      player: ["bounce_explode", "spawn_ghost"]
    },
    animation: {
      sprite: "ant-bomb",
      air_spin: true
    },
    labels: {
      player_name: true
    },
    trails: {
      count: 2,
      speed: 0.6,
      timeout: 10,
      sprite: "ball-red"
    }
  },
  player_ghost: {
    size: 12,
    weight: 0,
    damage: 1,
    knock: 0,
    events: {
      object: "hit_receive",
      explosion: "hit_receive"
    },
    object_events: {
      player: "hit_give"
    },
    speed: {
      max: 2.5,
      move: 0.3
    },
    animation: {
      sprite: "ant-ghost",
      air_float: true
    },
    labels: {
      player_name: true
    }
  },
  crate: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-weapon",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-blue"
    }
  },
  medpack: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-health",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-red"
    }
  },
  "gem-1": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-green",
      static_angle: true,
      air_float: true
    }
  },
  "gem-5": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-blue",
      static_angle: true,
      air_float: true
    }
  },
  "gem-20": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-red",
      static_angle: true,
      air_float: true
    }
  },
  "gem-50": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-purple",
      static_angle: true,
      air_float: true
    }
  },
  "gem-200": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-silver",
      static_angle: true,
      air_float: true
    }
  },
  vortex: {
    size: 22,
    animation: {
      sprite: "vortex"
    }
  },
  target: {
    size: 22,
    damage: 0,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion-laser-blue",
      sprite: "target",
      air_float: true
    },
    audio: {
      explosion: "pop",
      air: "none"
    }
  },
  nuclear: {
    size: 22,
    damage: 100,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    animation: {
      explosion: "explosion-green-l",
      sprite: "nuclear",
      air_float: true
    },
    audio: {
      explosion: "explosion_gas",
      air: "none"
    }
  },
  mine: {
    size: 58,
    damage: 80,
    events: {
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "mine",
      air_float: true
    }
  },
  "asteroid-small": {
    size: 15,
    weight: 1,
    damage: 40,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-small",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 10,
      sprite: "flame"
    }
  },
  "asteroid-large": {
    size: 34,
    weight: 1,
    damage: 80,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    cluster: {
      circle: true,
      object: "asteroid-small",
      speed: 16,
      count: 3
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-large",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 20,
      sprite: "flame"
    }
  },
  dig: {
    size: 2,
    weight: 0,
    damage: 16,
    timeout: 6,
    ignore_level_damage: true,
    events: {
      ground: ["destroy", "drag_player", "die"]
    }
  },
  punch: {
    size: 20,
    weight: 0,
    damage: 16,
    timeout: 8,
    player_lock: true,
    stop: 6,
    events: {
      ground: "slide"
    },
    object_events: {
      player: "hit_give"
    },
    animation: {
      sprite: "flame-large"
    },
    audio: {
      air: "fly",
      bounce: "doink",
      hit: "punch"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  laser: {
    size: 24,
    weight: 0,
    timeout: 20,
    damage: 30,
    destroy_ground: false,
    events: {
      ground: "die",
      object: "none",
      die: "none"
    },
    object_events: {
      player: ["explode", "die"],
      player_ghost: ["hit_give", "die"]
    },
    animation: {
      sprite: "laser-blue",
      explosion: "explosion-laser-blue"
    },
    audio: {
      explosion: "explosion_laser"
    },
    trails: {
      count: 1,
      speed: 0,
      timeout: 10,
      rotate: false,
      move: false,
      sprite: "bubble-blue"
    }
  },
  bazooka: {
    size: 6,
    weight: 0.7,
    timeout: 300,
    damage: 70,
    events: {
      ground: "die",
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "bazooka-shell"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  grenade: {
    size: 4,
    weight: 0.7,
    timeout: 72,
    damage: 50,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "explode"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "grenade-armed"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "countdown"
    },
    trails: {
      count: 1,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-green"
    }
  },
  pumpkin: {
    size: 10,
    weight: 1,
    timeout: 120,
    damage: 70,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "cluster"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "spooky"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      rotate: true,
      sprite: "bat"
    },
    cluster: {
      circle: false,
      object: "pumpkin_slice",
      speed: 15,
      count: 3
    }
  },
  pumpkin_slice: {
    size: 6,
    weight: 1,
    timeout: 200,
    damage: 30,
    events: {
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin-slice"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-orange"
    }
  },
  paingiver: {
    size: 20,
    weight: 1,
    damage: 50,
    cluster: {
      circle: false,
      object: "grenade",
      speed: 15,
      count: 3
    },
    events: {
      ground: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "rocket"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  }
};

// prep objects
config.object_refs = [];
for (key in config.objects) {
  config.object_refs.push(key);
  config.objects[key] = deepmerge(config.objects.default, config.objects[key], {
    arrayMerge: dont_merge
  });
}

var config = config || {};
config.sprites = {
  "ball-blue": {
    size: 48,
    x: 192,
    y: 1056
  },
  "ball-green": {
    size: 48,
    x: 240,
    y: 1056
  },
  "ball-orange": {
    size: 48,
    x: 288,
    y: 1056
  },
  "ball-red": {
    size: 48,
    x: 336,
    y: 1056
  },
  "ball-silver": {
    size: 48,
    x: 384,
    y: 1056
  },
  "bat": {
    size: 48,
    x: 432,
    y: 1056
  },
  "flame-1": {
    size: 48,
    x: 480,
    y: 1056
  },
  "flame-2": {
    size: 48,
    x: 528,
    y: 1056
  },
  "flame-3": {
    size: 48,
    x: 576,
    y: 1056
  },
  "flame-4": {
    size: 48,
    x: 624,
    y: 1056
  },
  "flame-5": {
    size: 48,
    x: 672,
    y: 1056
  },
  "mine-grey": {
    size: 48,
    x: 720,
    y: 1056
  },
  "mine-red": {
    size: 48,
    x: 768,
    y: 1056
  },
  "pumpkin-slice": {
    size: 48,
    x: 816,
    y: 1056
  },
  "pumpkin": {
    size: 48,
    x: 864,
    y: 1056
  },
  "star-blue": {
    size: 48,
    x: 912,
    y: 1056
  },
  "ant-body-air-left": {
    size: 48,
    x: 960,
    y: 1056
  },
  "ant-body-air-right": {
    size: 48,
    x: 1008,
    y: 1056
  },
  "ant-body-hit-1": {
    size: 48,
    x: 1056,
    y: 1056
  },
  "ant-body-hit-2": {
    size: 48,
    x: 1120,
    y: 0
  },
  "ant-body-hit-3": {
    size: 48,
    x: 1120,
    y: 48
  },
  "ant-body-superman-left": {
    size: 48,
    x: 1120,
    y: 96
  },
  "ant-body-superman-right": {
    size: 48,
    x: 1120,
    y: 144
  },
  "ant-body-walk-left-1": {
    size: 48,
    x: 1120,
    y: 192
  },
  "ant-body-walk-left-2": {
    size: 48,
    x: 1120,
    y: 240
  },
  "ant-body-walk-left-3": {
    size: 48,
    x: 1120,
    y: 288
  },
  "ant-body-walk-left-4": {
    size: 48,
    x: 1120,
    y: 336
  },
  "ant-body-walk-left-5": {
    size: 48,
    x: 1120,
    y: 384
  },
  "ant-body-walk-right-1": {
    size: 48,
    x: 1120,
    y: 432
  },
  "ant-body-walk-right-2": {
    size: 48,
    x: 1120,
    y: 480
  },
  "ant-body-walk-right-3": {
    size: 48,
    x: 1120,
    y: 528
  },
  "ant-body-walk-right-4": {
    size: 48,
    x: 1120,
    y: 576
  },
  "ant-body-walk-right-5": {
    size: 48,
    x: 1120,
    y: 624
  },
  "ant-bomb": {
    size: 48,
    x: 1120,
    y: 672
  },
  "ant-ghost-1": {
    size: 64,
    x: 576,
    y: 960
  },
  "ant-ghost-2": {
    size: 64,
    x: 640,
    y: 960
  },
  "ant-ghost-3": {
    size: 64,
    x: 704,
    y: 960
  },
  "ant-head-hit-1": {
    size: 64,
    x: 768,
    y: 960
  },
  "ant-head-hit-2": {
    size: 64,
    x: 832,
    y: 960
  },
  "ant-head-hit-3": {
    size: 64,
    x: 896,
    y: 960
  },
  "ant-head-left-1": {
    size: 64,
    x: 960,
    y: 960
  },
  "ant-head-left-2": {
    size: 64,
    x: 1056,
    y: 0
  },
  "ant-head-left-3": {
    size: 64,
    x: 1056,
    y: 64
  },
  "ant-head-right-1": {
    size: 64,
    x: 1056,
    y: 128
  },
  "ant-head-right-2": {
    size: 64,
    x: 1056,
    y: 192
  },
  "ant-head-right-3": {
    size: 64,
    x: 1056,
    y: 256
  },
  "ant-weapon-bazooka-left": {
    size: 64,
    x: 1056,
    y: 320
  },
  "ant-weapon-bazooka-right": {
    size: 64,
    x: 1056,
    y: 384
  },
  "ant-weapon-dig-left-1": {
    size: 64,
    x: 1056,
    y: 448
  },
  "ant-weapon-dig-left-2": {
    size: 64,
    x: 1056,
    y: 512
  },
  "ant-weapon-dig-left-3": {
    size: 64,
    x: 1056,
    y: 576
  },
  "ant-weapon-dig-left-4": {
    size: 64,
    x: 1056,
    y: 640
  },
  "ant-weapon-dig-right-1": {
    size: 64,
    x: 1056,
    y: 704
  },
  "ant-weapon-dig-right-2": {
    size: 64,
    x: 1056,
    y: 768
  },
  "ant-weapon-dig-right-3": {
    size: 64,
    x: 1056,
    y: 832
  },
  "ant-weapon-dig-right-4": {
    size: 64,
    x: 1056,
    y: 896
  },
  "ant-weapon-laser-left": {
    size: 64,
    x: 1056,
    y: 960
  },
  "ant-weapon-laser-right": {
    size: 64,
    x: 0,
    y: 1056
  },
  "ant-weapon-punch-left": {
    size: 64,
    x: 64,
    y: 1056
  },
  "ant-weapon-punch-right": {
    size: 64,
    x: 128,
    y: 1056
  },
  "ant-weapon-throw-left-1": {
    size: 48,
    x: 1120,
    y: 720
  },
  "ant-weapon-throw-left-2": {
    size: 48,
    x: 1120,
    y: 768
  },
  "ant-weapon-throw-left-3": {
    size: 48,
    x: 1120,
    y: 816
  },
  "ant-weapon-throw-left-4": {
    size: 48,
    x: 1120,
    y: 864
  },
  "ant-weapon-throw-left-5": {
    size: 48,
    x: 1120,
    y: 912
  },
  "ant-weapon-throw-right-1": {
    size: 48,
    x: 1120,
    y: 960
  },
  "ant-weapon-throw-right-2": {
    size: 48,
    x: 1120,
    y: 1008
  },
  "ant-weapon-throw-right-3": {
    size: 48,
    x: 1120,
    y: 1056
  },
  "ant-weapon-throw-right-4": {
    size: 48,
    x: 0,
    y: 1120
  },
  "ant-weapon-throw-right-5": {
    size: 48,
    x: 48,
    y: 1120
  },
  "armoury-dig": {
    size: 48,
    x: 96,
    y: 1120
  },
  "armoury-extinguishe": {
    size: 48,
    x: 144,
    y: 1120
  },
  "armoury-laser-blue": {
    size: 48,
    x: 192,
    y: 1120
  },
  "armoury-laser-red": {
    size: 48,
    x: 240,
    y: 1120
  },
  "armoury-punch": {
    size: 48,
    x: 288,
    y: 1120
  },
  "arrow-blue": {
    size: 48,
    x: 336,
    y: 1120
  },
  "arrow-green": {
    size: 48,
    x: 384,
    y: 1120
  },
  "arrow-grey": {
    size: 48,
    x: 432,
    y: 1120
  },
  "arrow-purple": {
    size: 48,
    x: 480,
    y: 1120
  },
  "arrow-red": {
    size: 48,
    x: 528,
    y: 1120
  },
  "asteroid-1": {
    size: 96,
    x: 0,
    y: 768
  },
  "asteroid-2": {
    size: 96,
    x: 96,
    y: 768
  },
  "ball-blue-1": {
    size: 24,
    x: 1056,
    y: 1024
  },
  "ball-blue-2": {
    size: 24,
    x: 1080,
    y: 1024
  },
  "ball-blue-3": {
    size: 24,
    x: 1024,
    y: 960
  },
  "ball-blue-4": {
    size: 24,
    x: 1024,
    y: 984
  },
  "ball-blue-5": {
    size: 24,
    x: 576,
    y: 1024
  },
  "bazooka-shell": {
    size: 48,
    x: 576,
    y: 1120
  },
  "crate-health": {
    size: 48,
    x: 624,
    y: 1120
  },
  "crate-weapon": {
    size: 48,
    x: 672,
    y: 1120
  },
  "crosshair": {
    size: 48,
    x: 720,
    y: 1120
  },
  "explosion-green-l-1": {
    size: 192,
    x: 0,
    y: 0
  },
  "explosion-green-l-2": {
    size: 192,
    x: 192,
    y: 0
  },
  "explosion-green-l-3": {
    size: 192,
    x: 0,
    y: 192
  },
  "explosion-green-l-4": {
    size: 192,
    x: 192,
    y: 192
  },
  "explosion-green-l-5": {
    size: 192,
    x: 384,
    y: 0
  },
  "explosion-green-l-6": {
    size: 192,
    x: 384,
    y: 192
  },
  "explosion-green-l-7": {
    size: 192,
    x: 0,
    y: 384
  },
  "explosion-green-l-8": {
    size: 192,
    x: 192,
    y: 384
  },
  "explosion-l-1": {
    size: 192,
    x: 384,
    y: 384
  },
  "explosion-l-2": {
    size: 192,
    x: 576,
    y: 0
  },
  "explosion-l-3": {
    size: 192,
    x: 576,
    y: 192
  },
  "explosion-l-4": {
    size: 192,
    x: 576,
    y: 384
  },
  "explosion-l-5": {
    size: 192,
    x: 0,
    y: 576
  },
  "explosion-l-6": {
    size: 192,
    x: 192,
    y: 576
  },
  "explosion-l-7": {
    size: 192,
    x: 384,
    y: 576
  },
  "explosion-laser-blue-1": {
    size: 96,
    x: 192,
    y: 768
  },
  "explosion-laser-blue-2": {
    size: 96,
    x: 288,
    y: 768
  },
  "explosion-laser-blue-3": {
    size: 96,
    x: 384,
    y: 768
  },
  "explosion-laser-blue-4": {
    size: 96,
    x: 480,
    y: 768
  },
  "explosion-laser-blue-5": {
    size: 96,
    x: 576,
    y: 768
  },
  "explosion2-l-1": {
    size: 96,
    x: 672,
    y: 768
  },
  "explosion2-l-2": {
    size: 96,
    x: 768,
    y: 768
  },
  "explosion2-l-3": {
    size: 96,
    x: 864,
    y: 768
  },
  "explosion2-l-4": {
    size: 192,
    x: 576,
    y: 576
  },
  "explosion2-l-5": {
    size: 192,
    x: 768,
    y: 0
  },
  "explosion2-l-6": {
    size: 192,
    x: 768,
    y: 192
  },
  "explosion2-l-7": {
    size: 192,
    x: 768,
    y: 384
  },
  "explosion2-l-8": {
    size: 192,
    x: 768,
    y: 576
  },
  "extinguisher": {
    size: 48,
    x: 768,
    y: 1120
  },
  "flame-large-1": {
    size: 96,
    x: 0,
    y: 864
  },
  "flame-large-2": {
    size: 96,
    x: 96,
    y: 864
  },
  "flame-large-3": {
    size: 96,
    x: 192,
    y: 864
  },
  "flame-large-4": {
    size: 96,
    x: 288,
    y: 864
  },
  "flame-large-5": {
    size: 96,
    x: 384,
    y: 864
  },
  "flame-large-6": {
    size: 96,
    x: 480,
    y: 864
  },
  "focus-1": {
    size: 96,
    x: 576,
    y: 864
  },
  "focus-2": {
    size: 96,
    x: 672,
    y: 864
  },
  "focus-3": {
    size: 96,
    x: 768,
    y: 864
  },
  "focus-4": {
    size: 96,
    x: 864,
    y: 864
  },
  "focus-5": {
    size: 96,
    x: 960,
    y: 0
  },
  "focus-6": {
    size: 96,
    x: 960,
    y: 96
  },
  "focus-7": {
    size: 96,
    x: 960,
    y: 192
  },
  "focus-8": {
    size: 96,
    x: 960,
    y: 288
  },
  "gem-blue-1": {
    size: 48,
    x: 816,
    y: 1120
  },
  "gem-blue-2": {
    size: 48,
    x: 864,
    y: 1120
  },
  "gem-blue-3": {
    size: 48,
    x: 912,
    y: 1120
  },
  "gem-blue-4": {
    size: 48,
    x: 960,
    y: 1120
  },
  "gem-green-1": {
    size: 48,
    x: 1008,
    y: 1120
  },
  "gem-green-2": {
    size: 48,
    x: 1056,
    y: 1120
  },
  "gem-green-3": {
    size: 48,
    x: 1104,
    y: 1120
  },
  "gem-green-4": {
    size: 48,
    x: 1168,
    y: 0
  },
  "gem-purple-1": {
    size: 48,
    x: 1168,
    y: 48
  },
  "gem-purple-2": {
    size: 48,
    x: 1168,
    y: 96
  },
  "gem-purple-3": {
    size: 48,
    x: 1168,
    y: 144
  },
  "gem-purple-4": {
    size: 48,
    x: 1168,
    y: 192
  },
  "gem-red-1": {
    size: 48,
    x: 1168,
    y: 240
  },
  "gem-red-2": {
    size: 48,
    x: 1168,
    y: 288
  },
  "gem-red-3": {
    size: 48,
    x: 1168,
    y: 336
  },
  "gem-red-4": {
    size: 48,
    x: 1168,
    y: 384
  },
  "gem-silver-1": {
    size: 48,
    x: 1168,
    y: 432
  },
  "gem-silver-2": {
    size: 48,
    x: 1168,
    y: 480
  },
  "gem-silver-3": {
    size: 48,
    x: 1168,
    y: 528
  },
  "gem-silver-4": {
    size: 48,
    x: 1168,
    y: 576
  },
  "grenade-green": {
    size: 48,
    x: 1168,
    y: 624
  },
  "grenade-red": {
    size: 48,
    x: 1168,
    y: 672
  },
  "laser-blue": {
    size: 48,
    x: 1168,
    y: 720
  },
  "laser-red": {
    size: 48,
    x: 1168,
    y: 768
  },
  "nuclear": {
    size: 96,
    x: 960,
    y: 384
  },
  "rocket": {
    size: 48,
    x: 1168,
    y: 816
  },
  "smoke": {
    size: 24,
    x: 600,
    y: 1024
  },
  "target": {
    size: 48,
    x: 48,
    y: 1168
  },
  "teleport-1": {
    size: 48,
    x: 1168,
    y: 864
  },
  "teleport-2": {
    size: 48,
    x: 1168,
    y: 912
  },
  "teleport-3": {
    size: 48,
    x: 1168,
    y: 960
  },
  "teleport-4": {
    size: 48,
    x: 1168,
    y: 1008
  },
  "teleport-5": {
    size: 48,
    x: 1168,
    y: 1056
  },
  "teleport-6": {
    size: 48,
    x: 1168,
    y: 1104
  },
  "teleport-7": {
    size: 48,
    x: 0,
    y: 1168
  },
  "vortex-1": {
    size: 96,
    x: 960,
    y: 480
  },
  "vortex-10": {
    size: 96,
    x: 960,
    y: 576
  },
  "vortex-11": {
    size: 96,
    x: 960,
    y: 672
  },
  "vortex-2": {
    size: 96,
    x: 960,
    y: 768
  },
  "vortex-3": {
    size: 96,
    x: 960,
    y: 864
  },
  "vortex-4": {
    size: 96,
    x: 0,
    y: 960
  },
  "vortex-5": {
    size: 96,
    x: 96,
    y: 960
  },
  "vortex-6": {
    size: 96,
    x: 192,
    y: 960
  },
  "vortex-7": {
    size: 96,
    x: 288,
    y: 960
  },
  "vortex-8": {
    size: 96,
    x: 384,
    y: 960
  },
  "vortex-9": {
    size: 96,
    x: 480,
    y: 960
  }
};
var config = config || {};
config.weapons = {
  default: {
    title: "",
    armoury_sprite: "",
    sprite: "",
    fire_audio: "",
    fire_sprite: "",
    fire_body_sprite: "",
    fire_angle_lock: false,
    auto_follow: false,
    require_walk: false,
    speed: 0,
    object: "",
    cooldown: 0,
    recoil: 0,
    inertia: 0
  },
  dig: {
    title: "Dig",
    armoury_sprite: "armoury-dig",
    sprite: "dig",
    fire_sprite: "dig-fire",
    fire_body_sprite: "walk",
    fire_angle_lock: true,
    speed: 3,
    object: "dig",
    cooldown: 10
  },
  phaser: {
    title: "Phaser",
    armoury_sprite: "armoury-laser-blue",
    sprite: "laser",
    fire_audio: "shoot_laser",
    speed: 30,
    object: "laser",
    cooldown: 6,
    recoil: 0.1,
    inertia: 0.5
  },
  bazookoid: {
    title: "Bazookoid",
    armoury_sprite: "bazooka-shell",
    sprite: "bazooka",
    fire_audio: "shoot",
    auto_follow: true,
    speed: 24,
    object: "bazooka",
    cooldown: 40,
    recoil: 0.2,
    inertia: 0.5
  },
  grenade: {
    title: "Grenade",
    armoury_sprite: "grenade-green",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 24,
    object: "grenade",
    cooldown: 30,
    recoil: 0,
    inertia: 0.5
  },
  punch: {
    title: "Fire Punch",
    armoury_sprite: "armoury-punch",
    sprite: "punch",
    fire_audio: "throw",
    fire_body_sprite: "superman",
    speed: 14,
    object: "punch",
    cooldown: 30,
    recoil: 0,
    inertia: 0.5
  },
  pumpkin: {
    title: "Pumpkin",
    armoury_sprite: "pumpkin",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 30,
    object: "pumpkin",
    cooldown: 48,
    recoil: 0,
    inertia: 0.5
  },
  paingiver: {
    title: "Paingiver 2000",
    armoury_sprite: "rocket",
    sprite: "bazooka",
    fire_audio: "shoot",
    speed: 24,
    object: "paingiver",
    cooldown: 10,
    recoil: 0.4,
    inertia: 0.5
  }
};

// prep weapons
for (key in config.weapons) {
  config.weapons[key] = deepmerge(config.weapons.default, config.weapons[key], {
    arrayMerge: dont_merge
  });
}

/* ========================================================================
    Actions
 ========================================================================== */

/* Perform action
	---------------------------------------- */

core.prototype.action = function(player_id, action) {
  var response = { success: false };
  var player = this.state.players[player_id];
  var obj = this.state.objects["player-" + player_id];
  if (!player || !action || !obj) {
    return response;
  }

  var locked_obj = this.state.objects[player.locked];

  // players can do stuff
  if (!player.dead && !locked_obj && player.hit === 0) {
    // run them
    if (action.action === "move") {
      response = this.action_move(response, player, obj, action);
    }
    if (action.action === "jump") {
      response = this.action_jump(response, player, obj, action);
    }
    if (action.action === "shoot") {
      response = this.action_shoot(response, player, obj, action);
    }
  }

  response.x = obj.x;
  response.y = obj.y;
  response.speed_x = obj.speed_x;
  response.speed_y = obj.speed_y;
  response.frame = this.state.frame;

  // return status
  return response;
};

/* Walking
	---------------------------------------- */

core.prototype.action_move = function(response, player, obj, action) {
  response.type = "walk";

  if (obj.grounded) {
    var speed = this.scheme.levels.speed[player.level] || obj.c.speed.move;
    var speed = action.speed || speed;
    var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, action.angle, speed);
    if (walk.move) {
      if (this.action_walk_move(obj, walk.path)) {
        // record player event
        player.events.push({ frame: this.state.frame, type: "walk" });

        // return success
        response.success = true;
      }
    }
  }

  return response;
};

/* Walking in a direction
	---------------------------------------- */

core.prototype.action_walk_dir = function(obj, dir, speed) {
  var speed = speed || obj.c.speed.move;

  // get initial path
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 0, speed);

  if (walk.direction != dir) {
    walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 180, speed);
    if (walk.direction != dir) {
      walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 90, speed);
      if (walk.direction != dir) {
        walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 270, speed);
        if (walk.direction != dir) {
          return;
        }
      }
    }
  }
  if (!walk.move) {
    return;
  }

  this.action_walk_move(obj, walk.path);
};

/* Walk moving
	---------------------------------------- */

core.prototype.action_walk_move = function(obj, path) {
  // go through the course
  var x1 = obj.x;
  var y1 = obj.y;
  for (var i = 1; i < path.length; i++) {
    var point = path[i];

    // check object collisions
    var col = this.collisions(obj, point.x, point.y);
    if (col) {
      return;
    }

    obj.x = point.x;
    obj.y = point.y;
    obj.moved = true;
  }

  if (obj.moved) {
    return true;
  }
};

/* Jumping
	---------------------------------------- */

core.prototype.action_jump = function(response, player, obj, action) {
  response.type = "jump";

  if (obj.grounded && player.cooldown === 0) {
    var speed = this.scheme.levels.jump[player.level] || obj.c.speed.jump;
    var xy = xy_speed(action.angle, speed);
    obj.speed_x = xy.x.fixed();
    obj.speed_y = xy.y.fixed();
    if (this.physics_move(obj)) {
      // set grounding
      obj.grounded = false;

      // set cooldown
      player.cooldown = 7;

      // record player event
      player.events.push({ frame: this.state.frame, type: "jump" });

      // return success
      response.success = true;
    }
  }

  return response;
};

/* Shooting weapon
	---------------------------------------- */

core.prototype.action_shoot = function(response, player, obj, action) {
  response.type = "shoot";

  // if waiting for cooldown
  // is not real weapon
  // do we need to walk
  // check armoury count
  var weapon = this.c.weapons[action.weapon];
  if (
    (player.cooldown === 0 && !weapon) ||
    (weapon.require_walk && !obj.grounded) ||
    player.armoury[action.weapon] === 0
  ) {
    return response;
  }

  // crate the object
  var speed = xy_speed(action.angle, weapon.speed);
  var shot_obj = this.create_object({
    type: weapon.object,
    player_id: player.id,
    x: obj.x,
    y: obj.y,
    speed_x: (speed.x + obj.speed_x * weapon.inertia).fixed(),
    speed_y: (speed.y + obj.speed_y * weapon.inertia).fixed()
  });

  // set player recoil
  if (!obj.grounded) {
    obj.speed_x += (-speed.x * weapon.recoil).fixed();
    obj.speed_y += (-speed.y * weapon.recoil).fixed();
  }

  // set armoury values
  this.update_player_armoury(player.id, action.weapon, -1);

  // set cooldown
  player.cooldown = weapon.cooldown;

  // set player lock
  if (shot_obj.c.player_lock) {
    player.locked = shot_obj.key;
  }

  // record player event
  player.events.push({
    frame: this.state.frame,
    type: "shoot",
    obj: shot_obj.key,
    weapon: action.weapon
  });

  // return success
  response.success = true;
  return response;
};

/* ========================================================================
    Collisions
 ========================================================================== */

/* Run single collision check
	---------------------------------------- */

core.prototype.collisions = function(obj, x, y) {
  // check collision with ground
  if (this.map.i(round(x), round(y))) {
    var event = this.event(obj, "ground", null);
    if (event) {
      return event;
    }
  }

  // check collisions with other objects
  for (var key in this.state.objects) {
    if (obj.key === key) {
      continue;
    }
    if (this.collision_obj(obj, x, y, this.state.objects[key])) {
      return true;
    }
  }

  return false;
};

/* Run object collision check
	---------------------------------------- */

core.prototype.collision_obj = function(obj, x, y, check_obj) {
  // if no collision
  if (
    this.collision_check(
      x,
      y,
      check_obj.x,
      check_obj.y,
      obj.c.size,
      check_obj.c.size
    )
  ) {
    return;
  }

  // prevent hits on parent players for a short time or if they're player locked
  if (
    check_obj.type === "player" &&
    check_obj.player_id === obj.player_id &&
    (this.state.frame < obj.frame + 15 || obj.c.player_lock)
  ) {
    return;
  }

  // prevent clusters hitting each other for a short time
  if (
    check_obj.frame === obj.frame &&
    check_obj.player_id === obj.player_id &&
    this.state.frame < obj.frame + 60
  ) {
    return;
  }

  // trigger basic object collision event
  if (this.event(obj, "object", check_obj)) {
    return true;
  }

  // trigger specific object collision event
  var event = obj.c.object_events[check_obj.type];
  if (event) {
    if (this.run_event(obj, event, check_obj)) {
      return true;
    }
  }
};

/* Collision Maths
	---------------------------------------- */

core.prototype.collision_check = function(x1, y1, x2, y2, s1, s2) {
  return this.map.get_distance(x1, y1, x2, y2) > s1 + s2;
};

/* ========================================================================
    Core
 ========================================================================== */

/* create core object
	---------------------------------------- */

function core(config, scheme, map, gravity_map) {
  // config
  this.c = config;
  this.scheme = scheme;
  this.map = new core_map(map, scheme, gravity_map);

  // crate chance table
  this.crate_list = [];
  for (var key in this.scheme.weapons) {
    for (var i = 0; i < this.scheme.weapons[key].crate_chance; i++) {
      this.crate_list.push(key);
    }
  }

  // armoury reference table
  this.armoury_refs = [];
  for (key in this.scheme.weapons) {
    this.armoury_refs.push(key);
  }
}

/* Set a blank state
	---------------------------------------- */

core.prototype.blank_state = function() {
  return {
    frame: 0,
    explosions: {},
    objects: {},
    players: {},
    events: []
  };
};

/* Run every frame
	---------------------------------------- */

core.prototype.frame = function() {
  this.frame_explosions();
  this.frame_players();
  this.frame_objects();
};

/* ========================================================================
    Events
 ========================================================================== */

/* Run a specific type of event
	---------------------------------------- */

core.prototype.event = function(obj, type, collided_obj) {
  var event = obj.c.events[type];
  if (!event) {
    return;
  }
  return this.run_event(obj, event, collided_obj, type);
};

/* Run a specific event
	---------------------------------------- */

core.prototype.run_event = function(obj, event, collided_obj, type) {
  // handle arrays of events
  if (Array.isArray(event)) {
    var stop = false;
    for (var i = 0; i < event.length; i++) {
      var stop2 = this.run_event(obj, event[i], collided_obj, type);
      stop = stop2 ? true : stop;
    }
    return stop;
  }

  // run event function
  if (event === "die") {
    return this.event_die(obj, collided_obj, type);
  } else if (event === "kill") {
    return this.event_kill(obj, collided_obj);
  } else if (event === "explode") {
    return this.event_explode(obj);
  } else if (event === "hit_give") {
    return this.event_hit_give(obj, collided_obj, type);
  } else if (event === "hit_receive") {
    return this.event_hit_receive(obj, collided_obj, type);
  } else if (event === "destroy") {
    return this.event_destroy(obj);
  } else if (event === "cluster") {
    return this.event_cluster(obj);
  } else if (event === "bounce") {
    return this.event_bounce(obj, collided_obj, type);
  } else if (event === "bounce_explode") {
    return this.event_bounce_explode(obj, collided_obj, type);
  } else if (event === "stick") {
    return this.event_stick(obj);
  } else if (event === "slide") {
    return this.event_slide(obj);
  } else if (event === "player_bounce") {
    return this.event_player_bounce(obj, collided_obj, type);
  } else if (event === "drag_player") {
    return this.event_drag_player(obj);
  } else if (event === "spawn_ghost") {
    return this.event_spawn_ghost(obj);
  } else if (event === "collect") {
    return this.event_collect(obj, collided_obj);
  }
};

/* Object die
	---------------------------------------- */

core.prototype.event_die = function(obj, collided_obj, type) {
  // die event
  this.event(obj, "die");

  // check for destroy events
  if (this.scheme.events.destroy) {
    if (this.scheme.events.destroy[obj.id]) {
      this.state.events.push(this.scheme.events.destroy[obj.id]);
    }
  }

  // delete the object
  delete this.state.objects[obj.key];

  return true;
};

/* Object kill
	---------------------------------------- */

core.prototype.event_kill = function(obj, collided_obj) {
  // destroy it
  this.run_event(collided_obj, "die");
};

/* Explode
	---------------------------------------- */

core.prototype.event_explode = function(obj) {
  // create explosion object
  this.create_explosion({
    player_id: obj.player_id,
    x: obj.x,
    y: obj.y,
    parent: obj.key,
    parent_type: obj.type
  });
};

/* Give a hit
	---------------------------------------- */

core.prototype.event_hit_give = function(obj, collided_obj, type) {
  return this.run_event(collided_obj, "hit_receive", obj, type);
};

/* Receive a hit
	---------------------------------------- */

core.prototype.event_hit_receive = function(obj, collided_obj, type) {
  // prevent instant hits
  if (obj.hits) {
    for (var key in obj.hits) {
      if (key === collided_obj.key) {
        return;
      }
    }
  }

  // calculate direction and distance it came from
  var angle = this.map.get_heading(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );
  var distance = this.map.get_distance(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );

  // get damage values from collided object
  var damage = this.get_damage(collided_obj);
  var knock = collided_obj.c.knock;
  if (collided_obj.type === "explosion") {
    damage *= max(0, (damage * 2 - distance) / (damage * 2));
  }

  // ignore if there's no damage
  if (damage === 0) {
    return;
  }

  // knock object
  if (knock > 0) {
    var xy = xy_speed(angle, damage);
    obj.speed_x -= xy.x.fixed();
    obj.speed_y -= xy.y.fixed();
    obj.grounded = false;
  }

  // are we hitting player
  if (obj.type === "player") {
    this.player_health_add(obj.player_id, -round(damage));
    var player = this.state.players[obj.player_id];
    if (player) {
      player.hit = damage * 2;
    }
  }

  // sound effect
  if (collided_obj.c.audio.hit) {
    this.state.events.push({
      type: "sound",
      x: obj.x,
      y: obj.y,
      sound: collided_obj.c.audio.hit
    });
  }

  // set hits
  if (!obj.hits) {
    obj.hits = {};
  }
  obj.hits[collided_obj.key] = true;
};

/* Destroy ground
	---------------------------------------- */

core.prototype.event_destroy = function(obj) {
  // limit to once per frame
  if (obj.destroyed) {
    return;
  }
  obj.destroyed = true;

  var damage = this.get_damage(obj);

  // record ground damage
  this.state.events.push({
    type: "ground_damage",
    frame: this.state.frame,
    dig: true,
    x: obj.x,
    y: obj.y,
    radius: damage
  });
};

/* Object bounce
	---------------------------------------- */

core.prototype.event_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  // check speed
  var speed = get_speed(obj.speed_x, obj.speed_y);
  var check_speed = speed * obj.c.bounce;
  if (check_speed < 1) {
    obj.speed_x = 0;
    obj.speed_y = 0;
    return true;
  }

  // get new direction angle
  var direction = get_angle(obj.speed_x, obj.speed_y);
  var surface_angle = 0;

  // get angle from ground
  if (type === "ground") {
    var walk = this.map.walk(round(obj.x), round(obj.y), 0, 0, direction, 6);
    if (walk.move) {
      surface_angle = walk.angle;
    }
  }

  // get angle from object
  else {
    var heading = this.map.get_heading(
      obj.x,
      obj.y,
      collided_obj.x,
      collided_obj.y
    );
    surface_angle = angle_add(heading, 90);
  }

  // reflect direction angle with collision angle
  var reflection = (direction - surface_angle) * 2;
  var new_angle = angle_add(direction, -reflection);

  // transform main velocity towards new angle
  var new_speed = xy_speed(new_angle, check_speed);
  obj.speed_x = new_speed.x.fixed();
  obj.speed_y = new_speed.y.fixed();

  // record bounce event
  if (speed > 2) {
    this.state.events.push({
      type: "bounce",
      x: obj.x,
      y: obj.y,
      obj: obj.key
    });
  }

  return true;
};

/* Object stick to ground
	---------------------------------------- */

core.prototype.event_stick = function(obj) {
  obj.grounded = true;
  obj.speed_x = 0;
  obj.speed_y = 0;
  return true;
};

/* Object slide
	---------------------------------------- */

core.prototype.event_slide = function(obj) {
  var angle = get_angle(obj.speed_x, obj.speed_y);
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, angle, obj.speed_left);
  if (walk.move) {
    this.action_walk_move(obj, walk.path);
  }
  return true;
};

/* Player bounce
	---------------------------------------- */

core.prototype.event_player_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }
  var speed = get_speed(obj.speed_x, obj.speed_y);

  var max_speed = this.scheme.levels.jump[player.level] || 0;
  max_speed += 10;
  if (player.hit > 0 || speed > max_speed) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "stick");
  }
};

/* Drag player
	---------------------------------------- */

core.prototype.event_drag_player = function(obj) {
  var player_obj = this.state.objects["player-" + obj.player_id];
  if (!player_obj) {
    return;
  }

  player_obj.speed_x = obj.speed_x;
  player_obj.speed_y = obj.speed_y;
  player_obj.dragged = true;
};

/* First Destroy
	---------------------------------------- */

core.prototype.event_bounce_explode = function(obj, collided_obj, type) {
  if (obj.frame + 10 > this.state.frame) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "explode");
  }
};

/* Spawn player ghost
	---------------------------------------- */

core.prototype.event_spawn_ghost = function(obj) {
  // transform object into ghost
  obj.type = "player_ghost";
  obj.c = this.c.objects["player_ghost"];
  obj.speed_x = 0;
  obj.speed_y = 0;
};

/* Clusters
	---------------------------------------- */

core.prototype.event_cluster = function(obj) {
  // set off explosions
  this.run_event(obj, "explode");

  // get cluster constants
  var cluster = obj.c.cluster;

  // get opposite angle of gravity
  var angle = this.map.get_gravity_angle(obj.x, obj.y);
  angle = angle_add(angle, 135);

  // go through clusters
  var range = cluster.circle ? 360 - 360 / cluster.count : 90;
  var angle_diff = range / (cluster.count - 1);
  for (var i = 0; i < cluster.count; i++) {
    // create cluster objects
    var launch_angle = angle_add(angle, i * angle_diff);
    var speed = xy_speed(launch_angle, cluster.speed);

    // create cluster object
    this.create_object({
      type: cluster.object,
      id: obj.id,
      data: i + 1,
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: speed.x.fixed(),
      speed_y: speed.y.fixed()
    });
  }

  return true;
};

/* Collect Crate
	---------------------------------------- */

core.prototype.event_collect = function(obj, collided_obj) {
  // prep event to send to game
  var event = {
    type: "collect",
    obj: collided_obj.key,
    player_id: obj.player_id
  };
  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // crate
  if (collided_obj.type === "crate") {
    var count = this.scheme.weapons[collided_obj.data].crate_count;
    count = count === -1 ? "infinite" : count;
    this.update_player_armoury(obj.player_id, collided_obj.data, count);
    event.collected = "crate";
    event.weapon = collided_obj.data;
    event.count = count;
    player.events.push({
      frame: this.state.frame,
      type: "crate",
      obj: collided_obj.key
    });
  }

  // medpack
  else if (collided_obj.type === "medpack") {
    this.player_health_add(obj.player_id, this.scheme.drops.medpack.add);
    event.collected = "medpack";
    player.events.push({
      frame: this.state.frame,
      type: "medpack",
      obj: collided_obj.key
    });
  }

  // gems
  else if (collided_obj.type === "gem-1") {
    this.player_score_add(obj.player_id, 1);
    event.collected = "gem";
    event.n = 1;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-5") {
    this.player_score_add(obj.player_id, 5);
    event.collected = "gem";
    event.n = 5;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-20") {
    this.player_score_add(obj.player_id, 20);
    event.collected = "gem";
    event.n = 20;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-50") {
    this.player_score_add(obj.player_id, 50);
    event.collected = "gem";
    event.n = 50;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-200") {
    this.player_score_add(obj.player_id, 200);
    event.collected = "gem";
    event.n = 200;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  }

  // record event
  this.state.events.push(event);

  // kill object
  this.run_event(collided_obj, "die", obj, "collect");

  // check for collection events
  if (this.scheme.events.collect) {
    if (this.scheme.events.collect[collided_obj.id]) {
      this.state.events.push(this.scheme.events.collect[collided_obj.id]);
    }
  }

  return false;
};

/* ========================================================================
    Explosions
 ========================================================================== */

/* Create an explosion
	---------------------------------------- */

core.prototype.create_explosion = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "explosion",
    player_id: "",
    frame: state_ref.frame,
    x: 0,
    y: 0,
    parent: "",
    parent_type: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.parent_type];

  // add to state objects
  state_ref.explosions[obj.parent] = obj;
};

/* Check all existing explosions
	---------------------------------------- */

core.prototype.frame_explosions = function() {
  // go through all explosions
  for (var key in this.state.explosions) {
    var explode = this.state.explosions[key];

    // if expired remove
    if (this.state.frame > explode.frame + 40) {
      delete this.state.explosions[key];
    }

    // if exploding this frame run
    if (this.state.frame === explode.frame + 1) {
      this.run_explosion(explode);
    }
  }
};

/* Run an explosion
	---------------------------------------- */

core.prototype.run_explosion = function(explode) {
  // if no damage
  if (!explode.c.damage) {
    return;
  }

  // calculate additional player damage
  var damage = this.get_damage(explode);

  // check collisions
  for (key in this.state.objects) {
    var obj = this.state.objects[key];

    // if object was just made
    if (this.state.frame < obj.frame + 2) {
      continue;
    }

    // run collision check
    if (
      !this.collision_check(
        obj.x,
        obj.y,
        explode.x,
        explode.y,
        obj.c.size,
        damage * 2
      )
    ) {
      this.event(obj, "explosion", explode);
    }
  }

  // record ground damage
  var ptype = this.c.objects[explode.parent_type];
  if (ptype && ptype.destroy_ground) {
    this.state.events.push({
      type: "ground_damage",
      frame: this.state.frame,
      x: explode.x,
      y: explode.y,
      radius: damage
    });
  }
};

/* ========================================================================
    Objects
 ========================================================================== */

/* Create a new game object
	---------------------------------------- */

core.prototype.create_object = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "",
    player_id: "",
    id: "",
    frame: state_ref.frame,
    grounded: false,
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    data: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.type];
  var key_type = obj.type;

  // set key
  if (
    obj.type === "player" ||
    obj.type === "player_ghost" ||
    obj.type === "player_missile"
  ) {
    obj.key = "player-" + obj.player_id;
  } else {
    obj.key =
      obj.type +
      "-" +
      obj.player_id +
      "-" +
      obj.id +
      "-" +
      obj.frame +
      "-" +
      obj.data;
  }

  // add to state objects
  state_ref.objects[obj.key] = obj;

  // return it
  return obj;
};

/* Snap object to another object
	---------------------------------------- */

core.prototype.snap_object = function(obj1, obj2) {
  obj1.grounded = obj2.grounded;
  obj1.x = obj2.x;
  obj1.y = obj2.y;
  obj1.speed_x = obj2.speed_x;
  obj1.speed_y = obj2.speed_y;
};

/* Run through object frame events
	---------------------------------------- */

core.prototype.frame_objects = function() {
  // run through all objects
  for (var key in this.state.objects) {
    this.frame_object(this.state.objects[key]);
  }

  // check for player lock
  for (var key in this.state.players) {
    this.frame_player_lock(this.state.players[key]);
  }
};

core.prototype.frame_object = function(obj) {
  if (!obj) {
    return;
  }
  obj.destroyed = false;

  // stopping
  if (obj.c.stop > 0 && this.state.frame > obj.frame + obj.c.stop) {
    obj.speed_x = 0;
    obj.speed_y = 0;
  }

  // timeout
  if (obj.c.timeout > 0 && obj.frame + obj.c.timeout <= this.state.frame) {
    this.run_event(obj, "die");
    return;
  }

  // run physics on object
  this.physics(obj);

  // events
  this.event(obj, "frame");
};

/* Spawns
	---------------------------------------- */

core.prototype.spawn = function(props) {
  // weapon crate contents
  if (props.type == "crate") {
    if (this.crate_list.length < 1) {
      return;
    }
    props.data = this.crate_list[rand(0, this.crate_list.length)];
  }

  // do we have a set position
  if (!props.x && !props.y) {
    var pos = this.map.air_find_spot();
    props.x = pos.x;
    props.y = pos.y;
  }

  return this.create_object(props);
};

/* ========================================================================
    Physics
 ========================================================================== */

/* Run air physics
	---------------------------------------- */

core.prototype.physics = function(obj) {
  // are we still grounded
  if (obj.grounded) {
    if (!this.map.ground_pixel(round(obj.x), round(obj.y))) {
      obj.grounded = false;
    }
  }

  // run the main physics
  if (!obj.grounded) {
    this.physics_gravity(obj);
    this.physics_move(obj);
  }
};

/* Calculate gravity
	---------------------------------------- */

core.prototype.physics_gravity = function(obj) {
  // if no weight
  if (obj.c.weight <= 0) {
    return;
  }

  // get gravity values
  var gravity = this.map.get_gravity(round(obj.x), round(obj.y));

  // adjust speed
  this.physics_adjust_speed(
    obj,
    gravity.x,
    gravity.y,
    obj.c.speed.max_gravity,
    obj.c.weight
  );
};

/* Adjust speed of object
	---------------------------------------- */

core.prototype.physics_adjust_speed = function(
  obj,
  new_speed_x,
  new_speed_y,
  max_speed,
  weight
) {
  var angle = get_angle(new_speed_x, new_speed_y);
  var max_speed = xy_speed(angle, max_speed);
  var speed_add_x = new_speed_x * weight;
  var speed_add_y = new_speed_y * weight;
  var diff_x = max_speed.x - obj.speed_x;
  var diff_y = max_speed.y - obj.speed_y;

  // only add speed up to the limit without bringing it down
  if (max_speed.x < 0) {
    obj.speed_x += max(speed_add_x, min(0, diff_x));
  } else {
    obj.speed_x += min(speed_add_x, max(0, diff_x));
  }
  if (max_speed.y < 0) {
    obj.speed_y += max(speed_add_y, min(0, diff_y));
  } else {
    obj.speed_y += min(speed_add_y, max(0, diff_y));
  }

  obj.speed_x = obj.speed_x.fixed();
  obj.speed_y = obj.speed_y.fixed();
};

/* Do the movement
	---------------------------------------- */

core.prototype.physics_move = function(obj) {
  // check speed
  var speed_limit = check_speed(obj.speed_x, obj.speed_y, obj.c.speed.max);
  obj.speed_x = speed_limit.x.fixed();
  obj.speed_y = speed_limit.y.fixed();

  // plot a course
  var course = plot_course(obj.x, obj.y, obj.speed_x, obj.speed_y);

  // if no course
  if (!course.move) {
    this.collisions(obj, obj.x, obj.y);
    return;
  }

  // move through course
  var moved = false;
  for (var i = 1; i < course.points.length; i++) {
    // remaining movement points left
    obj.speed_left = course.points.length - i;

    var point = course.points[i];
    var nx = this.map.loop_x(round(point.x));
    var ny = this.map.loop_y(round(point.y));

    // collisions
    var collision = this.collisions(obj, nx, ny);
    if (collision) {
      break;
    }

    // move object
    obj.x = nx;
    obj.y = ny;
    moved = true;
  }

  return moved;
};

/* ========================================================================
    Players
 ========================================================================== */

/* Create a new player
	---------------------------------------- */

core.prototype.create_player = function(props, state) {
  if (typeof props.id === "undefined") {
    return;
  }

  var state_ref = state || this.state;

  // set up object
  var obj = {
    id: "",
    level: 0,
    score: 0,
    dead: false,
    health: this.scheme.levels.health[0],
    cooldown: 0,
    hit: 0,
    weapon: "",
    locked: "",
    events: [],
    armoury: {}
  };
  obj = deepmerge(obj, props);
  obj.id = parseInt(obj.id);

  // set level
  this.player_level(obj.id);

  // add to state objects
  state_ref.players[obj.id] = obj;

  return obj;
};

/* Remove player
	---------------------------------------- */

core.prototype.remove_player = function(player_id) {
  if (!this.state.players[player_id]) {
    return;
  }

  delete this.state.objects["player-" + player_id];
  delete this.state.players[player_id];
};

/* Start the player
	---------------------------------------- */

core.prototype.init_player = function(player_id, state) {
  player_id = parseInt(player_id);
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // player values
  player.level = 0;
  player.score = 0;
  player.dead = false;
  player.health = this.scheme.levels.health[0];
  player.cooldown = 0;
  player.events = [];

  // armoury
  var armoury = {};
  for (var key in this.scheme.weapons) {
    armoury[key] = this.scheme.weapons[key].start_count;
  }
  player.armoury = armoury;

  // merge with an external state
  if (state) {
    this.state.players[player_id] = deepmerge(player, state);
  }

  // set level
  this.player_level(player_id);

  // object values
  var obj = this.state.objects["player-" + player_id];
  if (!obj) {
    return;
  }
  if (this.scheme.spawn.length > 0) {
    var pos = this.scheme.spawn[rand(0, this.scheme.spawn.length)];
  } else {
    var pos = this.map.air_find_spot();
  }
  obj.type = "player";
  obj.grounded = false;
  obj.x = pos.x;
  obj.y = pos.y;
  obj.speed_x = 0;
  obj.speed_y = 0;
  obj.c = this.c.objects["player"];
};

/* Update armoury
	---------------------------------------- */

core.prototype.update_player_armoury = function(player_id, weapon, count) {
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // if infinite or if zero and taking away
  var old_count = player.armoury[weapon];
  if (!is_numeric(old_count)) {
    return false;
  }
  if (old_count === -1) {
    return true;
  }
  if (old_count === 0 && count < 1) {
    return false;
  }

  // if infinite
  if (count === "infinite") {
    player.armoury[weapon] = -1;
  } else {
    player.armoury[weapon] += count;
  }

  // record event
  this.state.events.push({
    type: "armoury",
    player_id: player_id,
    weapon: weapon
  });

  return true;
};

/* Add health to player
	---------------------------------------- */

core.prototype.player_health_add = function(player_id, health, no_message) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // no health enabled
  if (!this.scheme.health) {
    return;
  }

  // add it
  player.health += health;
  player.health = min(player.health, this.scheme.levels.health[player.level]);

  // are we dead
  if (player.health <= 0) {
    this.player_die(player_id);
  }

  // set event
  if (!no_message) {
    this.state.events.push({
      type: "player_health",
      id: player_id,
      health: health
    });
  }
};

/* Add score to player
	---------------------------------------- */

core.prototype.player_score_add = function(player_id, score) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // add it
  player.score += score;

  // set level
  this.player_level(player_id);

  // set event
  this.state.events.push({
    type: "player_score",
    id: player_id,
    score: score
  });
};

/* Set player level
	---------------------------------------- */

core.prototype.player_level = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // go through levels
  var level = 0;
  for (var i = 0; i < this.scheme.levels.score.length; i++) {
    if (this.scheme.levels.score[i] <= player.score) {
      level = i;
    }
  }
  player.level = level;
};

/* Player die
	---------------------------------------- */

core.prototype.player_die = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  player.dead = true;

  var obj = this.state.objects["player-" + player_id];
  obj.type = "player_missile";
  obj.c = this.c.objects["player_missile"];

  // figure out gems to spawn
  var n = max(round(player.score / 2), 3);
  var gems = [];
  while (n > 200) {
    gems.push(200);
    n -= 200;
  }
  while (n > 50) {
    gems.push(50);
    n -= 50;
  }
  while (n > 20) {
    gems.push(20);
    n -= 20;
  }
  while (n > 5) {
    gems.push(5);
    n -= 5;
  }
  while (n > 1) {
    gems.push(1);
    n -= 1;
  }

  // spawn them
  var angle_inc = round(360 / gems.length);
  for (var i = 0; i < gems.length; i++) {
    var n = ((i % 3) + 1) * 2;
    var xy = xy_speed(angle_inc * i, n);
    this.create_object({
      type: "gem-" + gems[i],
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: xy.x.fixed(),
      speed_y: xy.y.fixed(),
      data: i + 1
    });
  }
};

/* Run through players
	---------------------------------------- */

core.prototype.frame_players = function(ignore) {
  // run through all objects
  for (var key in this.state.players) {
    if (parseInt(key) !== ignore) {
      this.frame_player(this.state.players[key]);
    }
  }
};

core.prototype.frame_player = function(player) {
  if (!player) {
    return;
  }

  // cooldown
  if (player.cooldown > 0) {
    player.cooldown--;
  }

  // hit
  if (player.hit > 0) {
    player.hit--;
  }

  // health regen
  if (this.state.frame % 24 === 0) {
    if (player.health < this.scheme.levels.health[player.level]) {
      this.player_health_add(player.id, 2, true);
    }
  }

  // remove old events
  for (var i = 0; i < player.events.length; i++) {
    if (this.state.frame > player.events[i].frame + 18) {
      player.events.splice(i, 1);
    }
  }
};

/* Run through player locked objects
	---------------------------------------- */

core.prototype.frame_player_lock = function(player) {
  var player_obj = this.state.objects["player-" + player.id];
  var obj = this.state.objects[player.locked];
  if (player_obj && obj) {
    player_obj.x = obj.x;
    player_obj.y = obj.y;
    player_obj.speed_x = obj.speed_x;
    player_obj.speed_y = obj.speed_y;
  } else {
    player.locked = "";
  }
};

/* Get damage modifiers from player
	---------------------------------------- */

core.prototype.get_damage = function(obj) {
  var damage = obj.c.damage;
  var player = this.state.players[obj.player_id];
  if (player && damage !== 0 && !obj.c.ignore_level_damage) {
    var level = this.scheme.levels.damage[player.level];
    if (level) {
      damage += level;
    }
  }
  return damage;
};

/* ========================================================================
    State management
 ========================================================================== */

/* Get state
	---------------------------------------- */

core.prototype.pack_state = function(state) {
  // players
  var players = [];
  for (var id in state.players) {
    players.push(this.pack_player(state.players[id]));
  }

  // go through objects
  var objects = [];
  for (var key in state.objects) {
    objects.push(this.pack_object(state.objects[key]));
  }

  // go through explosions
  var explosions = [];
  for (key in state.explosions) {
    explosions.push(this.pack_explosion(state.explosions[key]));
  }

  return (
    players.join("#") + "+" + objects.join("#") + "+" + explosions.join("#")
  );
};

/* Set state
	---------------------------------------- */

core.prototype.unpack_state = function(str) {
  // blank state
  var state = this.blank_state();

  // run through state string
  var split = str.split("+");
  for (var i = 0; i < split.length; i++) {
    if (split[i]) {
      var split2 = split[i].split("#");
      for (var j = 0; j < split2.length; j++) {
        if (i == 0) {
          this.unpack_player(state, split2[j]);
        }
        if (i == 1) {
          this.unpack_object(state, split2[j]);
        }
        if (i == 2) {
          this.unpack_explosion(state, split2[j]);
        }
      }
    }
  }

  return state;
};

/* Players
	---------------------------------------- */

core.prototype.pack_player = function(obj) {
  // prep basic values
  var dead = obj.dead ? "1" : "";
  var weapon = this.armoury_refs.indexOf(obj.weapon);

  // prep armoury
  var armoury = [];
  for (var key in obj.armoury) {
    armoury.push(obj.armoury[key]);
  }
  armoury = armoury.join("$");

  // prep events
  var events = [];
  for (var i = 0; i < obj.events.length; i++) {
    var event = obj.events[i];
    if (event.type === "walk") {
      events.push(event.frame + "~0");
    }
    if (event.type === "jump") {
      events.push(event.frame + "~1");
    }
    if (event.type === "shoot") {
      events.push(event.frame + "~2~" + event.obj + "~" + event.weapon);
    }
    if (event.type === "crate") {
      events.push(event.frame + "~3~" + event.obj);
    }
    if (event.type === "medpack") {
      events.push(event.frame + "~4~" + event.obj);
    }
    if (event.type === "gem") {
      events.push(event.frame + "~5~" + event.obj);
    }
  }
  events = events.join("$");

  // return player string
  var arr = [
    obj.id,
    obj.level,
    obj.score,
    dead,
    obj.health,
    obj.cooldown,
    obj.hit,
    obj.locked,
    armoury,
    weapon,
    events
  ];
  return arr.join("/");
};

core.prototype.unpack_player = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.id = parseInt(split[0]);
  props.level = parseInt(split[1]);
  props.score = parseInt(split[2]);
  props.dead = split[3] === "1" ? true : false;
  props.health = parseInt(split[4]);
  props.cooldown = parseInt(split[5]);
  props.hit = parseInt(split[6]);
  props.locked = split[7];

  // prep armoury
  props.armoury = {};
  var split2 = split[8].split("$");
  for (var i = 0; i < split2.length; i++) {
    var key = this.armoury_refs[i];
    props.armoury[key] = parseInt(split2[i]);
  }

  // weapon
  var wep = parseInt(split[9]);
  if (wep !== -1) {
    props.weapon = this.armoury_refs[wep];
  }

  // prep events
  props.events = [];
  var split2 = split[10].split("$");
  for (var i = 0; i < split2.length; i++) {
    var split3 = split2[i].split("~");
    var obj = { frame: parseInt(split3[0]) };
    if (split3[1] === "0") {
      obj.type = "walk";
    }
    if (split3[1] === "1") {
      obj.type = "jump";
    }
    if (split3[1] === "2") {
      obj.type = "shoot";
      obj.obj = split3[2];
      obj.weapon = split3[3];
    }
    if (split3[1] === "3") {
      obj.type = "crate";
      obj.obj = split3[2];
    }
    if (split3[1] === "4") {
      obj.type = "medpack";
      obj.obj = split3[2];
    }
    if (split3[1] === "5") {
      obj.type = "gem";
      obj.obj = split3[2];
    }
    if (obj) {
      props.events.push(obj);
    }
  }

  // make it
  this.create_player(props, state);
};

/* Objects
	---------------------------------------- */

core.prototype.pack_object = function(obj) {
  var grounded = obj.grounded ? "1" : "";
  var arr = [
    obj.type,
    obj.player_id,
    obj.id,
    obj.frame,
    grounded,
    obj.x,
    obj.y,
    obj.speed_x,
    obj.speed_y,
    obj.data
  ];
  return arr.join("/");
};

core.prototype.unpack_object = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.type = split[0];
  props.player_id = parseInt(split[1]);
  props.id = split[2];
  props.frame = parseInt(split[3]);
  props.grounded = split[4] === "1" ? true : false;
  props.x = parseFloat(split[5]);
  props.y = parseFloat(split[6]);
  props.speed_x = parseFloat(split[7]);
  props.speed_y = parseFloat(split[8]);
  props.data = split[9];

  this.create_object(props, state);
};

/* Explosions
	---------------------------------------- */

core.prototype.pack_explosion = function(obj) {
  var arr = [
    obj.player_id,
    obj.frame,
    obj.x,
    obj.y,
    obj.parent,
    obj.parent_type
  ];
  return arr.join("/");
};

core.prototype.unpack_explosion = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.player_id = parseInt(split[0]);
  props.frame = parseInt(split[1]);
  props.x = parseFloat(split[2]);
  props.y = parseFloat(split[3]);
  props.parent = split[4];
  props.parent_type = split[5];

  this.create_explosion(props, state);
};

function isMergeableObject(val) {
  var nonNullObject = val && typeof val === "object";

  return (
    nonNullObject &&
    Object.prototype.toString.call(val) !== "[object RegExp]" &&
    Object.prototype.toString.call(val) !== "[object Date]"
  );
}

function emptyTarget(val) {
  return Array.isArray(val) ? [] : {};
}

function cloneIfNecessary(value, optionsArgument) {
  var clone = optionsArgument && optionsArgument.clone === true;
  return clone && isMergeableObject(value)
    ? deepmerge(emptyTarget(value), value, optionsArgument)
    : value;
}

function defaultArrayMerge(target, source, optionsArgument) {
  var destination = target.slice();
  source.forEach(function(e, i) {
    if (typeof destination[i] === "undefined") {
      destination[i] = cloneIfNecessary(e, optionsArgument);
    } else if (isMergeableObject(e)) {
      destination[i] = deepmerge(target[i], e, optionsArgument);
    } else if (target.indexOf(e) === -1) {
      destination.push(cloneIfNecessary(e, optionsArgument));
    }
  });
  return destination;
}

function mergeObject(target, source, optionsArgument) {
  var destination = {};
  if (isMergeableObject(target)) {
    Object.keys(target).forEach(function(key) {
      destination[key] = cloneIfNecessary(target[key], optionsArgument);
    });
  }
  Object.keys(source).forEach(function(key) {
    if (!isMergeableObject(source[key]) || !target[key]) {
      destination[key] = cloneIfNecessary(source[key], optionsArgument);
    } else {
      destination[key] = deepmerge(target[key], source[key], optionsArgument);
    }
  });
  return destination;
}

function deepmerge(target, source, optionsArgument) {
  var array = Array.isArray(source);
  var options = optionsArgument || { arrayMerge: defaultArrayMerge };
  var arrayMerge = options.arrayMerge || defaultArrayMerge;

  if (array) {
    return Array.isArray(target)
      ? arrayMerge(target, source, optionsArgument)
      : cloneIfNecessary(source, optionsArgument);
  } else {
    return mergeObject(target, source, optionsArgument);
  }
}

deepmerge.all = function deepmergeAll(array, optionsArgument) {
  if (!Array.isArray(array) || array.length < 2) {
    throw new Error(
      "first argument should be an array with at least two elements"
    );
  }

  // we are sure there are at least 2 values, so it is safe to have no initial value
  return array.reduce(function(prev, next) {
    return deepmerge(prev, next, optionsArgument);
  });
};

/* ========================================================================
    Math Functions
 ========================================================================== */

/* Shorten "Math" functions
	---------------------------------------- */

function cos(n) {
  return Math.cos(n);
}
function sin(n) {
  return Math.sin(n);
}
function pow(n) {
  return Math.pow(n);
}
function abs(n) {
  return Math.abs(n);
}
function sqr(n) {
  return Math.pow(n, 2);
}
function sqrt(n) {
  return Math.sqrt(n);
}
function round(n) {
  return Math.round(n);
}
function floor(n) {
  return Math.floor(n);
}
function ceil(n) {
  return Math.ceil(n);
}
function atan2(n1, n2) {
  return Math.atan2(n1, n2);
}
function min(n1, n2) {
  return Math.min(n1, n2);
}
function max(n1, n2) {
  return Math.max(n1, n2);
}
function rand(n1, n2) {
  return floor(Math.random() * n2) + n1;
}
var pi = Math.PI;

/* Fix number to decimal places
	---------------------------------------- */

Number.prototype.fixed = function(n) {
  n = n || 2;
  return parseFloat(this.toFixed(n));
};

/* Add preceding zeroes to number
	---------------------------------------- */

function preceding_zeroes(n, length) {
  var length = length || 2;
  var n = n.toString();
  while (n.length < length) {
    n = "0" + n;
  }
  return n;
}

/* Is number
	---------------------------------------- */

function is_numeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

/* Get distance between two points
	---------------------------------------- */

function get_speed(sx, sy) {
  return round(sqrt(sqr(sx) + sqr(sy)));
}

function get_distance(x1, y1, x2, y2) {
  var dx = x2 - x1,
    dy = y2 - y1;
  return get_speed(dx, dy);
}

/* Check speed limit
	---------------------------------------- */

function check_speed(sx, sy, speed) {
  var d = get_distance(0, 0, sx, sy),
    ns = {
      x: sx,
      y: sy,
      total: d
    };
  if (speed < d) {
    var multi = speed / d;
    ns.x = sx * multi;
    ns.y = sy * multi;
    ns.total = speed;
  }
  return ns;
}

/* Get Heading Angle From X and Y Speed
	// 0 = left, 360 = left
	---------------------------------------- */

function get_angle(sx, sy) {
  return (((atan2(sy, sx) * 180) / pi) % 360) + 180;
}

function get_heading(x1, y1, x2, y2) {
  var xs = x2 - x1,
    ys = y2 - y1;
  return get_angle(xs, ys);
}

/* Get X and Y speed from heading and velocity
	---------------------------------------- */

function xy_speed(angle, speed) {
  var a = angle_add(angle, 180),
    r = (a / 180) * pi;
  return {
    x: speed * cos(r),
    y: speed * sin(r)
  };
}

/* Get X and Y offset from heading and velocity
	---------------------------------------- */

function xy_offset(angle, sx, sy) {
  var xy1 = xy_speed(angle, sx);
  var xy2 = xy_speed(angle_add(angle, 90), sy);
  return {
    x: xy1.x + xy2.x,
    y: xy1.y + xy2.y
  };
}

/* Get difference between two numbers in a loop
	---------------------------------------- */

function n_diff(current, target, bottom, top) {
  if (current == target) {
    return 0;
  }

  var scale = abs(top - bottom), // get total size of the loop
    c_current = current - bottom, // correct current for negative numbers
    c_target = target - bottom, // correct target for negative numbers
    n1 = (c_target + scale - c_current) % scale, // get difference when adding
    n2 = (c_current + scale - c_target) % scale; // get difference when subtracting

  // return smallest distance
  if (n1 < n2) {
    return n1;
  } else {
    return -n2;
  }
}

/* Auto loop a number
	---------------------------------------- */

function n_loop(n, bottom, top) {
  var difference = abs(top - bottom);
  while (n <= bottom) {
    n += difference;
  }
  while (n > top) {
    n -= difference;
  }
  return n;
}

/* Add to a number without overflowing up or down from min/max
	---------------------------------------- */

function n_add(n1, n2, t1, t2) {
  var dif = abs(t2 - t1),
    na = n1 + n2;
  while (na < t1) {
    na += dif;
  }
  while (na >= t2) {
    na -= dif;
  }
  return na;
}

/* Add to an angle without overflowing up or down from 0-360
	---------------------------------------- */

function angle_add(angle, add) {
  if (!angle) {
    angle = 0;
  }
  return n_add(angle, add, 0, 360);
}

/* Move number towards a new number with loop
	---------------------------------------- */

function increment_num(current, target, bottom, top, speed) {
  var diff = n_diff(current, target, bottom, top); // get shortest route to number
  move = min(abs(diff) / 10, 4) * speed; // calculate how much to move

  // if difference is less then movement, return target
  if (abs(diff) < move) {
    return target;
  }

  // add or subtract movement
  move = diff < 0 ? -move : move;
  return n_add(current, move, bottom, top);
}

/* Move angle towards a new angle
	---------------------------------------- */

function increment_angle(old_angle, new_angle, speed) {
  return increment_num(old_angle, new_angle, 0, 360, speed);
}

/* If a point is within a circle
	---------------------------------------- */

function in_circle(x, y, cx, cy, radius) {
  return get_distance(x, y, cx, cy) < radius;
}

/* Plot a course
	---------------------------------------- */

function plot_course(x, y, sx, sy, extend) {
  // get initial speed
  var extend = extend ? extend : 0,
    speed = get_speed(sx, sy);

  // if no distance then do nothing
  if (speed == 0) {
    return { move: false };
  }

  // calculate increments
  var increment_x = sx / speed,
    increment_y = sy / speed,
    new_x = x - increment_x * extend,
    new_y = y - increment_y * extend,
    points = [{ x: new_x, y: new_y }];

  // iterate through path and record points
  for (var i = 0; i < speed + extend * 2; i++) {
    (new_x += increment_x), (new_y += increment_y);
    points.push({
      x: new_x,
      y: new_y
    });
  }

  // return point array
  return {
    move: true,
    points: points
  };
}

/* translate co-ordinates by an angle
	---------------------------------------- */

function rotate_coords(x, y, cx, cy, angle) {
  var r = (pi / 180) * angle;
  return {
    x: cos(r) * (x - cx) + sin(r) * (y - cy) + cx,
    y: cos(r) * (y - cy) - sin(r) * (x - cx) + cy
  };
}

/* ========================================================================
    Misc Functions
 ========================================================================== */

/* Duplicate object
	---------------------------------------- */

function duplicate_obj(obj) {
  return JSON.parse(JSON.stringify(obj));
}

/* Prevent array merging
	---------------------------------------- */

function dont_merge(destination, source) {
  if (!source) {
    return destination;
  } else {
    return source;
  }
}

/* Add space to a string
	---------------------------------------- */

function str_space(str) {
  var new_str = "";
  for (var i = 0; i < str.length; i++) {
    var add = i == str.length - 1 ? "" : "\u200A";
    new_str += str[i] + add;
  }
  return new_str;
}

/* Log multiple values
	---------------------------------------- */

function clog(
  s1,
  s2,
  s3,
  s4,
  s5,
  s6,
  s7,
  s8,
  s9,
  s10,
  s11,
  s12,
  s13,
  s14,
  s15
) {
  var str = s1;
  if (s2 != undefined) {
    str += " | " + s2;
  }
  if (s3 != undefined) {
    str += " | " + s3;
  }
  if (s4 != undefined) {
    str += " | " + s4;
  }
  if (s5 != undefined) {
    str += " | " + s5;
  }
  if (s6 != undefined) {
    str += " | " + s6;
  }
  if (s7 != undefined) {
    str += " | " + s7;
  }
  if (s8 != undefined) {
    str += " | " + s8;
  }
  if (s9 != undefined) {
    str += " | " + s9;
  }
  if (s10 != undefined) {
    str += " | " + s10;
  }
  if (s11 != undefined) {
    str += " | " + s11;
  }
  if (s12 != undefined) {
    str += " | " + s12;
  }
  if (s13 != undefined) {
    str += " | " + s13;
  }
  if (s14 != undefined) {
    str += " | " + s14;
  }
  if (s15 != undefined) {
    str += " | " + s15;
  }
  console.log(str);
}

/* ========================================================================
	Map Generator
	Blobs
 ========================================================================== */

/* Draw a blob
	---------------------------------------- */

function mapgen_blob(img, config, decorations, radius, type) {
  this.size = 36;
  this.img = img;
  this.c = config;

  // get land type
  var type = type || Math.floor(Math.random() * this.c.land_type.length);
  this.ref = this.c.land_type[type];

  // set up main anchor points
  var anchors = [];
  var points = Math.floor(radius / 2) + 4;
  var spike = Math.floor(radius / 2) + 2;
  for (var p = 0; p < points; p++) {
    var new_radius =
      Math.max(radius - Math.floor(Math.random() * spike), 1) + 1;
    var x =
      radius + Math.floor(new_radius * Math.cos((2 * Math.PI * p) / points));
    var y =
      radius + Math.floor(new_radius * Math.sin((2 * Math.PI * p) / points));
    anchors.push({ x: x, y: y });
  }

  // draw shape to canvas
  var size = radius * 2 + 1;
  var shape = mapgen_canvas(size, size);
  this.draw_path(shape, anchors);

  // build array of land or not tiles
  var pixels = shape.cont.getImageData(0, 0, shape.w, shape.h);
  this.land = [];
  for (var y = 0; y < size; y++) {
    this.land[y] = [];
    for (var x = 0; x < size; x++) {
      var i = (y * size + x) * 4 + 3;
      this.land[y][x] = pixels.data[i] > 30 ? 1 : 0;
    }
  }

  // build tile array and assign corners and land
  this.tiles = [];
  for (var y = 0; y < size; y++) {
    this.tiles[y] = [];
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] = this.set_corner_tile(y, x);
    }
  }

  // assign pixels a tile value
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] =
        this.tiles[y][x] === 12 ? this.set_land_tile(y, x) : this.tiles[y][x];
    }
  }

  // draw them
  var wh = (size + 4) * this.size;
  this.alpha = mapgen_canvas(wh, wh);
  this.edge = mapgen_canvas(wh, wh);
  this.bg = mapgen_canvas(wh, wh);
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      var tile = this.tiles[y][x];
      if (tile === -1) {
        continue;
      }

      // draw it
      var x1 = (x + 2) * this.size;
      var y1 = (y + 2) * this.size;
      this.draw_to_canvas(this.alpha.cont, x1, y1, tile, 0);
      this.draw_to_canvas(this.edge.cont, x1, y1, tile, this.ref.edge);

      if (decorations) {
        this.draw_decoration(this.bg.cont, x, y, tile);
      }
    }
  }

  // draw rest of fg
  var fg = mapgen_pattern(this.alpha.canv, this.img[this.ref.fg]);
  fg.cont.drawImage(this.edge.canv, 0, 0);

  // draw dirt bg
  var fg_dirt = mapgen_pattern(fg.canv, this.img[this.ref.bg]);
  this.bg.cont.drawImage(fg_dirt.canv, 0, 0);

  // export
  return {
    fg: fg,
    bg: this.bg
  };
}

/* Draw an alpha path
	---------------------------------------- */

mapgen_blob.prototype.draw_path = function(canv, path) {
  // start paths on canvases
  canv.cont.beginPath();
  canv.cont.moveTo(path[0].x, path[0].y);

  // go through path
  for (var i = 1; i < path.length - 1; i++) {
    // get next point to curve around
    var point1 = path[i],
      point2 = path[i + 1],
      qx,
      qy;

    // get curve values
    if (i < path.length - 1) {
      qx = (point1.x + point2.x) / 2;
      qy = (point1.y + point2.y) / 2;
    } else {
      qx = point2.x;
      qy = point2.y;
    }

    // draw curve to path
    canv.cont.quadraticCurveTo(point1.x, point1.y, qx, qy);
  }

  // rejoin the beginning of the path and fill
  canv.cont.lineTo(path[0].x, path[0].y);
  canv.cont.fill();
};

/* Draw a decoration
	---------------------------------------- */

mapgen_blob.prototype.draw_decoration = function(cont, x, y, tile) {
  // are we drawing one
  if (tile > 7 || Math.floor(Math.random() * 2) !== 0) {
    return;
  }

  // can we do doubles
  var double = false;
  if (tile === 0 && this.is_type(y, x + 1, 0)) {
    double = true;
  }
  if (tile === 1 && this.is_type(y, x - 1, 1)) {
    double = true;
  }
  if (tile === 2 && this.is_type(y - 1, x, 2)) {
    double = true;
  }
  if (tile === 3 && this.is_type(y + 1, x, 3)) {
    double = true;
  }
  if (tile === 4 && this.is_type(y - 1, x + 1, 4)) {
    double = true;
  }
  if (tile === 5 && this.is_type(y + 1, x + 1, 5)) {
    double = true;
  }
  if (tile === 6 && this.is_type(y - 1, x - 1, 6)) {
    double = true;
  }
  if (tile === 7 && this.is_type(y + 1, x - 1, 7)) {
    double = true;
  }

  // choose source
  var source = this.ref.decorations[1];
  if (double && Math.floor(Math.random() * 2) === 0) {
    source = this.ref.decorations[2];
  } else {
    double = false;
  }

  // choose decoration
  var i = Math.floor(Math.random() * source.length);
  var ref = source[i];

  // get position to draw it
  var half = this.size / 2;
  var x1 = (x + 2) * this.size;
  var y1 = (y + 2) * this.size;
  var angle = 0;
  if (tile === 1) {
    x1 += this.size;
    y1 += this.size;
    angle = 180;
  }
  if (tile === 2) {
    y1 += this.size;
    angle = 270;
  }
  if (tile === 3) {
    x1 += this.size;
    angle = 90;
  }
  if (tile === 4) {
    y1 += this.size;
    angle = 315;
  }
  if (tile === 5) {
    angle = 45;
  }
  if (tile === 6) {
    x1 += this.size;
    y1 += this.size;
    angle = 225;
  }
  if (tile === 7) {
    x1 += this.size;
    angle = 135;
  }

  // draw that shit
  var x_add = double ? this.size : 0;
  cont.save();
  cont.translate(x1, y1);
  cont.rotate((angle * Math.PI) / 180);
  cont.drawImage(
    this.img.decorations,
    ref.x,
    ref.y,
    ref.w,
    ref.h,
    0,
    -ref.h + 5,
    ref.w,
    ref.h
  );
  cont.translate(-x1, -y1);
  cont.restore();
};

/* Draw a tile to a canvas
	---------------------------------------- */

mapgen_blob.prototype.draw_to_canvas = function(cont, x, y, tile, key) {
  var ts = this.size;
  cont.save();
  cont.translate(x, y);
  cont.drawImage(this.img.edge, tile * ts, key * ts, ts, ts, 0, 0, ts, ts);
  cont.translate(-y, -y);
  cont.restore();
};

/* Get corner and land tiles
	---------------------------------------- */

mapgen_blob.prototype.set_corner_tile = function(y, x) {
  var tile = -1;

  //land
  if (this.is_land(y, x)) {
    tile = 12;

    // not land
  } else {
    // corners
    if (
      !this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 4;
    } else if (
      !this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 5;
    } else if (
      this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 6;
    } else if (
      this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 7;
    }
  }

  return tile;
};

/* Set land tile types
	---------------------------------------- */

mapgen_blob.prototype.set_land_tile = function(y, x) {
  var tile = 12;

  // corners
  if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 4;
  } else if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 5;
  } else if (
    !this.is_land(y, x - 1) &&
    !this.is_land(y + 1, x) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 6;
  } else if (
    !this.is_land(y + 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x - 1) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 7;

    // flat edges
  } else if (
    !this.is_land(y - 1, x) &&
    this.is_land(y + 1, x) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 0;
  } else if (
    !this.is_land(y + 1, x) &&
    this.is_land(y - 1, x) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 1;
  } else if (
    !this.is_land(y, x - 1) &&
    this.is_land(y, x + 1) &&
    !this.is_corner(y, x - 1)
  ) {
    tile = 2;
  } else if (
    !this.is_land(y, x + 1) &&
    this.is_land(y, x - 1) &&
    !this.is_corner(y, x + 1)
  ) {
    tile = 3;

    // inside corners
  } else if (this.is_type(y + 1, x, 7) || this.is_type(y, x + 1, 7)) {
    tile = 8;
  } else if (this.is_type(y + 1, x, 6) || this.is_type(y, x - 1, 6)) {
    tile = 9;
  } else if (this.is_type(y - 1, x, 5) || this.is_type(y, x + 1, 5)) {
    tile = 10;
  } else if (this.is_type(y - 1, x, 4) || this.is_type(y, x - 1, 4)) {
    tile = 11;
  }

  return tile;
};

/* Check arrays for values
	---------------------------------------- */

mapgen_blob.prototype.is_land_or_corner = function(y, x) {
  if (this.is_corner(y, x) || this.is_land(y, x)) {
    return true;
  }
};

mapgen_blob.prototype.is_corner = function(y, x) {
  return this.check_arr(this.tiles, y, x, [4, 5, 6, 7]);
};

mapgen_blob.prototype.is_type = function(y, x, type) {
  return this.check_arr(this.tiles, y, x, [type]);
};

mapgen_blob.prototype.is_land = function(y, x) {
  return this.check_arr(this.land, y, x, [1]);
};

mapgen_blob.prototype.check_arr = function(arr, y, x, checks) {
  if (y < 0 || y >= arr.length || x < 0 || x >= arr[0].length) {
    return false;
  }
  for (var i = 0; i < checks.length; i++) {
    if (arr[y][x] == checks[i]) {
      return true;
    }
  }
};

/* ========================================================================
	Map Generator
	Make Canvas
 ========================================================================== */

/* Set up a new canvas
	---------------------------------------- */

function mapgen_canvas(w, h) {
  var obj = {};
  if ("undefined" != typeof global) {
    obj.canv = new canvas();
  } else {
    obj.canv = document.createElement("canvas");
  }
  obj.cont = obj.canv.getContext("2d");
  obj.canv.width = w;
  obj.canv.height = h;
  obj.cont.fillStyle = "#fff";
  obj.w = w;
  obj.h = h;
  return obj;
}

/* Draw a pattern to a canvas
	---------------------------------------- */

function mapgen_pattern(alpha, pattern) {
  var canv = mapgen_canvas(alpha.width, alpha.height);
  if (typeof pattern !== "string") {
    pattern = canv.cont.createPattern(pattern, "repeat");
  }
  canv.cont.fillStyle = pattern;
  canv.cont.fillRect(0, 0, alpha.width, alpha.height);
  canv.cont.globalCompositeOperation = "destination-in";
  canv.cont.drawImage(alpha, 0, 0);
  canv.cont.globalCompositeOperation = "normal";

  return canv;
}

/* ========================================================================
	Map Generator
	------------
	Config:
	w           // width of map
	h           // height of map
	crust       // thickness of outer crust on land
	blobs       // initial blobs
	center_blob // size of center blob of land, 0 for none
	small_blobs // number of random small circles of land
	large_blobs // number of random large circles of land
	-----------
 ========================================================================== */

/* Server side only
	---------------------------------------- */

if ("undefined" != typeof global) {
  var fs = require("fs");
}

/* New Map Generation
	---------------------------------------- */

function mapgen(img, config, scheme, map_img) {
  this.size = 36;
  this.img = img;
  this.c = config;
  this.scheme = scheme;

  // choose type
  if (this.scheme.type == "random") {
    return this.draw_random();
  }
  if (this.scheme.type == "image") {
    return this.draw_image(map_img);
  }
}

/* Draw image
	---------------------------------------- */

mapgen.prototype.draw_image = function(map_img) {
  var fg = mapgen_canvas(
    map_img.width + this.scheme.gap * 2,
    map_img.height + this.scheme.gap * 2
  );
  fg.cont.drawImage(map_img, this.scheme.gap, this.scheme.gap);
  var bg = mapgen_pattern(fg.canv, this.img.dirt);
  return { fg: fg, bg: bg };
};

/* Draw random
	---------------------------------------- */

mapgen.prototype.draw_random = function() {
  // setup
  this.blobs = JSON.parse(JSON.stringify(this.scheme.blobs));
  this.bg = mapgen_canvas(this.scheme.w, this.scheme.h);
  this.fg = mapgen_canvas(this.scheme.w, this.scheme.h);

  // generate some random large circles
  for (var i = 0; i < this.scheme.large_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 4, 6);
  }

  // generate some random small circles
  for (var i = 0; i < this.scheme.small_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 1, 3);
  }

  // go through each blob
  for (var i = 0; i < this.blobs.length; i++) {
    var blob = this.blobs[i];

    // create the blobs
    var bg = new mapgen_blob(this.img, this.c, false, blob.r + 4, blob.type);
    var fg = new mapgen_blob(
      this.img,
      this.c,
      this.scheme.decorations,
      blob.r,
      blob.type
    );

    // combine the backgrounds
    var wh = fg.fg.canv.width;
    var new_bg = mapgen_canvas(wh, wh);
    new_bg.cont.drawImage(bg.fg.canv, wh * 0.1, wh * 0.1, wh * 0.8, wh * 0.8);
    new_bg.cont.globalCompositeOperation = "source-atop";
    new_bg.cont.fillStyle = "rgba(0,0,0,0.8)";
    new_bg.cont.fillRect(0, 0, wh, wh);
    new_bg.cont.globalCompositeOperation = "normal";
    new_bg.cont.drawImage(fg.bg.canv, 0, 0);

    // draw it to main canvas
    this.bg.cont.drawImage(new_bg.canv, blob.x - wh / 2, blob.y - wh / 2);
    this.fg.cont.drawImage(fg.fg.canv, blob.x - wh / 2, blob.y - wh / 2);
  }

  // return it
  return {
    bg: this.bg,
    fg: this.fg
  };
};

/* Get a far away circle
	---------------------------------------- */

mapgen.prototype.get_circle = function(arr, min_radius, max_radius) {
  // generate many circles and find furthest away
  var distance = 0;
  var circle = null;

  for (var i = 0; i < 20; i++) {
    // make new circle
    var test_circle = this.circle(min_radius, max_radius);
    var smallest_distance = 999999;

    // find shortest distance from all other circles
    for (var j = 0; j < arr.length; j++) {
      var dx = arr[j].x - test_circle.x;
      var dy = arr[j].y - test_circle.y;
      var test_distance = Math.round(
        Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))
      );
      smallest_distance =
        test_distance < smallest_distance ? test_distance : smallest_distance;
    }

    // if is the largest distance record this as furthest
    if (distance < smallest_distance) {
      distance = smallest_distance;
      circle = test_circle;
    }
  }

  // add furthest away circle to new array
  arr.push(circle);
  return arr;
};

/* Generate a random circle
	---------------------------------------- */

mapgen.prototype.circle = function(min_radius, max_radius) {
  var r = Math.floor(Math.random() * max_radius) + min_radius;
  var gap = (r + 2) * this.size + this.scheme.gap;
  var x = Math.floor(Math.random() * (this.scheme.w - gap * 2)) + gap;
  var y = Math.floor(Math.random() * (this.scheme.h - gap * 2)) + gap;
  return {
    r: r,
    x: x,
    y: y
  };
};

var schemes = schemes || {};
schemes.deathmatch = {
  title: "Deathmatch",
  time_limit: 5800,
  destroy_land: true,
  gravity: 2,
  score: true,
  drops: {
    crate: {
      time: 100,
      max: 1
    },
    medpack: {
      time: 100,
      add: 30,
      max: 1
    },
    "gem-1": {
      time: 100,
      max: 5
    },
    "gem-5": {
      time: 150,
      max: 1
    },
    "gem-20": {
      time: 500,
      max: 1
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 0,
      crate_chance: 1,
      crate_count: 5
    },
    paingiver: {
      start_count: 0,
      crate_chance: 1,
      crate_count: 5
    }
  },
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1900,
    h: 1400,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

var schemes = schemes || {};
schemes.default = {
  title: "",
  description: "",
  time_limit: 0,
  show_time: true,
  destroy_land: true,
  gravity_type: "land",
  gravity: 1,
  stars: {},
  score: false,
  health: true,
  levels: {
    score: [
      0,
      10,
      25,
      40,
      60,
      90,
      120,
      150,
      200,
      250,
      300,
      360,
      420,
      490,
      570,
      650,
      720,
      810,
      900,
      1000
    ],
    health: [
      100,
      120,
      120,
      120,
      140,
      140,
      140,
      140,
      160,
      180,
      200,
      200,
      200,
      200,
      220,
      220,
      220,
      220,
      240,
      300
    ],
    damage: [
      0,
      10,
      10,
      15,
      15,
      15,
      15,
      20,
      20,
      25,
      25,
      25,
      30,
      30,
      30,
      30,
      35,
      35,
      35,
      50
    ],
    speed: [
      4,
      6,
      8,
      8,
      8,
      8,
      10,
      10,
      10,
      12,
      12,
      12,
      12,
      14,
      14,
      14,
      14,
      16,
      16,
      20
    ],
    jump: [
      10,
      12,
      12,
      12,
      12,
      15,
      15,
      15,
      15,
      18,
      18,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      25
    ]
  },
  drops: {
    crate: {
      time: 0,
      max: 20
    },
    medpack: {
      time: 0,
      add: 30,
      max: 50
    },
    nuclear: {
      time: 0,
      max: 20
    },
    target: {
      time: 0,
      max: 100
    },
    asteroid_center: {
      time: 0,
      increase_frequency: false,
      max: 30
    },
    "gem-1": {
      time: 0,
      max: 20
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 1
    },
    paingiver: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 10
    }
  },
  armoury: [
    "dig",
    "phaser",
    "bazookoid",
    "grenade",
    "punch",
    "pumpkin",
    "paingiver"
  ],
  arrows: {
    nuclear: "green",
    player: "red",
    target: "blue",
    "asteroid-small": "grey",
    "asteroid-large": "grey",
    vortex: "purple",
    crate: "blue"
  },
  spawn: [],
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1000,
    h: 1000,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

/* ========================================================================
	Map Gravity
 ========================================================================== */

/* Set up gravity
	----------------------------------------- */

core_map.prototype.init_gravity = function(gravity_map) {
  this.weight = this.scheme.gravity || 1;
  this.gravity_type = this.scheme.gravity_type || "land";

  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // set values
  this.gravity = {
    w: 0,
    h: 0,
    map: [],
    scale: 24,
    reach: 18
  };

  if (gravity_map) {
    this.gravity.map = JSON.parse(gravity_map);
    this.gravity.w = this.gravity.map[0].length;
    this.gravity.h = this.gravity.map.length;
  } else {
    this.init_gravity_map();
  }
};

/* Generate gravity map
	---------------------------------------- */

core_map.prototype.init_gravity_map = function() {
  // set size of new gravity grid
  this.gravity.w = ceil(this.w / this.gravity.scale);
  this.gravity.h = ceil(this.h / this.gravity.scale);

  // generate map array
  var new_arr = [];
  for (var y = 0; y < this.gravity.h; y++) {
    this.gravity.map[y] = [];
    for (var x = 0; x < this.gravity.w; x++) {
      this.gravity.map[y].push([0, 0, 0]);
    }
  }

  // do the calculating
  this.action_gravity_generate(0, 0, this.w, this.h);
};

/* Apply new gravity calculations to a set of pixels
	---------------------------------------- */

core_map.prototype.action_gravity_generate = function(x, y, w, h) {
  // calculate which tiles are affected
  var x1 = max(0, min(floor(x / this.gravity.scale), this.gravity.w));
  var y1 = max(0, min(floor(y / this.gravity.scale), this.gravity.h));
  var x2 = max(0, min(floor((x + w) / this.gravity.scale), this.gravity.w));
  var y2 = max(0, min(floor((y + h) / this.gravity.scale), this.gravity.h));

  // get the weight of all affected tiles
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      this.gravity.map[y3][x3][0] = this.get_tile_weight(x3, y3);
    }
  }

  // calculate surrounding tiles
  var x1 = max(0, min(x1 - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y1 - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x2 + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y2 + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var xy = this.get_tile_gravity(x3, y3);
      this.gravity.map[y3][x3][1] = xy.x;
      this.gravity.map[y3][x3][2] = xy.y;
    }
  }
};

/* Get weight of a tile in the gravity map
	---------------------------------------- */

core_map.prototype.get_tile_weight = function(x, y) {
  // limit x and y to within the area
  var y1 = max(0, min(y * this.gravity.scale, this.h));
  var x1 = max(0, min(x * this.gravity.scale, this.w));
  var y2 = max(0, min(y * this.gravity.scale + this.gravity.scale, this.h));
  var x2 = max(0, min(x * this.gravity.scale + this.gravity.scale, this.w));

  // go through the grid of pixels
  var c = 0;
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var id = this.i(x3, y3);
      if (id == 1 || id == 2) {
        c += 1;
      }
      if (id == 3) {
        c += 3;
      }
    }
  }
  return c;
};

/* Get gravity of a tile from the weight of surrounding tiles
	---------------------------------------- */

core_map.prototype.get_tile_gravity = function(x, y) {
  // calculate surrounding tiles
  var wx = 0;
  var wy = 0;
  var x1 = max(0, min(x - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      wx += (x3 - x) * this.gravity.map[y3][x3][0];
      wy += (y3 - y) * this.gravity.map[y3][x3][0];
    }
  }

  wx = round(wx / 5000 / this.gravity.reach) / 60;
  wy = round(wy / 5000 / this.gravity.reach) / 60;

  return {
    x: wx,
    y: wy
  };
};

/* Reset gravity from destruction event
	---------------------------------------- */

core_map.prototype.gravity_event_recalculate = function(x, y, radius) {
  // if we are not using land gravity
  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // recalculate gravity
  var x1 = round(x - radius);
  var y1 = round(y - radius);
  var size = round(radius * 2 + 1);
  this.action_gravity_generate(x1, y1, size, size);
};

/* Return gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity = function(x, y) {
  // flat
  if (this.scheme.gravity_type === "flat") {
    return { x: 0, y: this.weight };
  }

  // map
  if (this.scheme.gravity_type === "land") {
    var x1 = max(0, min(round(x / this.gravity.scale), this.gravity.w - 1));
    var y1 = max(0, min(round(y / this.gravity.scale), this.gravity.h - 1));
    var obj = this.gravity.map[y1][x1];
    return {
      x: min(obj[1], 1) * this.weight,
      y: min(obj[2], 1) * this.weight
    };
  }
};

/* Return the angle of gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity_angle = function(x, y) {
  var grav = this.get_gravity(x, y);
  var a1 = get_angle(grav.x, grav.y);
  return a1;
};

/* ========================================================================
	Map Ground Checkers
 ========================================================================== */

/* Get array of offsets to check in an angles direction
	---------------------------------------- */

core_map.prototype.get_angle_offsets = function(a) {
  if (a > 22 && a <= 67) {
    return [[-1, -1], [0, -1], [-1, 0], [1, -1], [-1, 1], [1, 0], [0, 1]];
  } // up left
  if (a > 67 && a <= 112) {
    return [[0, -1], [-1, -1], [1, -1], [-1, 0], [1, 0], [-1, 1], [1, 1]];
  } // up
  if (a > 112 && a <= 157) {
    return [[1, -1], [0, -1], [1, 0], [-1, -1], [1, 1], [-1, 0], [0, 1]];
  } // up right
  if (a > 157 && a <= 202) {
    return [[1, 0], [1, -1], [1, 1], [0, -1], [0, 1], [-1, -1], [-1, 1]];
  } // right
  if (a > 202 && a <= 247) {
    return [[1, 1], [1, 0], [0, 1], [1, -1], [-1, 1], [0, -1], [-1, 0]];
  } // down right
  if (a > 247 && a <= 292) {
    return [[0, 1], [-1, 1], [1, 1], [-1, 0], [1, 0], [-1, -1], [1, -1]];
  } // down
  if (a > 292 && a <= 337) {
    return [[-1, 1], [-1, 0], [0, 1], [-1, -1], [1, 1], [0, -1], [1, 0]];
  } // down left
  if (a > 337 || a <= 22) {
    return [[-1, 0], [-1, -1], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 1]];
  } // left
};

/* Calculate walk path by angle
	---------------------------------------- */

core_map.prototype.walk = function(x, y, px, py, angle, speed) {
  // get neighboring pixels
  var offsets = this.get_angle_offsets(angle);

  // record old position
  var ox = x;
  var oy = y;

  // record result
  var result = {
    move: false, // we are moving
    angle: 0, // actual angle of movement
    path: [] // recorded coordinates
  };

  // go through number of movements per frame
  for (var i = 0; i < speed; i++) {
    var moved = false;

    // go through directional pixels to check based on angle of path
    for (var j = 0; j < offsets.length; j++) {
      // co-ordinates we're checking
      var x1 = x + offsets[j][0];
      var y1 = y + offsets[j][1];

      // if is previous location, land or not an edge
      if ((x1 == px && y1 == py) || !this.ground_pixel(x1, y1)) {
        continue;
      }

      // set new position
      px = x;
      py = y;
      x = x1;
      y = y1;
      result.move = true;
      result.angle = get_heading(ox, oy, x, y);
      result.path.push({ x: x1, y: y1 });

      var moved = true;
      break;
    }

    // if movement failed
    if (!moved) {
      break;
    }
  }

  // set direction left or right
  result.direction = this.ground_dir(ox, oy, x, y);

  return result;
};

/* Check a pixel is next to ground
	---------------------------------------- */

core_map.prototype.ground_pixel = function(x, y) {
  // if we have hit ground
  if (this.i(x, y)) {
    return false;
  }

  var trigger = false,
    off = [
      [0, -1],
      [-1, 0],
      [1, 0],
      [0, 1],
      [-1, -1],
      [-1, 1],
      [1, 1],
      [1, -1]
    ];

  for (var i = 0; i < off.length; i++) {
    // go through offsets
    var x1 = x + off[i][0]; // new x coordinate
    var y1 = y + off[i][1]; // new y coordinate
    if (this.i(x1, y1)) {
      // if pixel is land
      trigger = true; // we did it
      break;
    }
  }

  return trigger;
};

/* Calculate left or right movement
	//
	// calculates direction of land from a line of movement
	// 1. rotate line coords 90 degrees
	// 2. if the top part of the new line has more land then we are moving right
	// 3. if the bottom part we are moving left
	// 4. bananas, all of it
	---------------------------------------- */

core_map.prototype.ground_dir = function(x1, y1, x2, y2) {
  // rotate co-ordinated 90 degrees to point into the ground we're on
  var center_x = x1 + (x2 - x1) / 2;
  var center_y = y1 + (y2 - y1) / 2;
  var rotated_1 = rotate_coords(x1, y1, center_x, center_y, 90);
  var rotated_2 = rotate_coords(x2, y2, center_x, center_y, 90);

  // plot a course of co-ordinates to check
  var speed_x = this.get_distance_x(rotated_1.x, rotated_2.x);
  var speed_y = this.get_distance_y(rotated_1.y, rotated_2.y);
  var plotted = plot_course(rotated_1.x, rotated_1.y, speed_x, speed_y, 8);
  if (!plotted.move) {
    return "right";
  }

  // go through course and count which side has more land on it
  var count_left = 0,
    count_right = 0;
  for (var i = 0; i < plotted.points.length; i++) {
    var point = plotted.points[i];
    if (this.i(round(point.x), round(point.y))) {
      if (i < plotted.points.length / 2) {
        count_right++;
      } else {
        count_left++;
      }
    }
  }
  return count_left > count_right ? "left" : "right";
};

/* Set values in a circle in the ground array
	---------------------------------------- */

core_map.prototype.set_circle = function(x, y, radius, type) {
  // get boundaries
  var x1 = max(round(x - radius), 0);
  var x2 = min(round(x + radius), this.w - 1);
  var y1 = max(round(y - radius), 0);
  var y2 = min(round(y + radius), this.h - 1);

  // loop through co-ordinates
  for (var ly = y1; ly <= y2; ly++) {
    for (var lx = x1; lx <= x2; lx++) {
      if (in_circle(lx, ly, x, y, radius)) {
        this.i_set(lx, ly, type);
      }
    }
  }
};

/* Set block of cells from arr
	---------------------------------------- */

core_map.prototype.set_block_from_arr = function(x, y, arr) {
  for (var ly = 0; ly < arr.length; ly++) {
    for (var lx = 0; lx < arr[ly].length; lx++) {
      this.i_set(x + lx, y + ly, arr[ly][lx]);
    }
  }
};

/* Get block of cells
	---------------------------------------- */

core_map.prototype.get_block = function(x, y, w, h) {
  var response = [];

  // loop through co-ordinates
  for (var ly = 0; ly < h; ly++) {
    response[ly] = [];
    for (var lx = 0; lx < w; lx++) {
      response[ly][lx] = this.i(lx + x, ly + y);
    }
  }

  return response;
};

/* Find nearby ground spot
	---------------------------------------- */

core_map.prototype.find_ground_nearby = function(x, y) {
  var x1 = round(x);
  var y1 = round(y);

  // already on ground
  if (this.ground_pixel(x1, y1)) {
    return { x: x1, y: y1 };
  }

  var spiral_1 = 0;
  var spiral_2 = 1;
  var inc = 1;
  var dir = true;

  for (var i = 0; i < 450; i++) {
    x1 += dir ? inc : 0;
    y1 += !dir ? inc : 0;
    spiral_1++;
    if (spiral_1 == spiral_2) {
      spiral_1 = 0;
      if ((dir = !dir)) {
        inc = inc == 1 ? -1 : 1;
        spiral_2++;
      }
    }

    // check point for ground pixels
    if (this.ground_pixel(x1, y1)) {
      return { x: x1, y: y1 };
    }
  }
  return false;
};

/* Get random empty spot
	---------------------------------------- */

core_map.prototype.air_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if air pixel
    if (id == 0) {
      return { x: x, y: y };
    }

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* Get random ground spot
	---------------------------------------- */

core_map.prototype.ground_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if not land pixel
    if (id !== 1 && id !== 2) {
      continue;
    }

    // plot course to random angle
    var angle = rand(0, 360);
    for (var i = 0; i < 100; i++) {}

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* ========================================================================
    Map
 ========================================================================== */

// create map object
function core_map(canv, scheme, gravity_map) {
  // Server side only
  if ("undefined" != typeof global) {
    var canvas = require("canvas");
  }

  this.scheme = scheme;

  // set dimensions
  this.w = canv.canv.width;
  this.h = canv.canv.height;

  // get pixels
  var pixels = canv.cont.getImageData(0, 0, this.w, this.h);
  var length = Math.floor(pixels.data.length / 4);

  // create 8 bit alpha array
  // 0. air
  // 1. destructible land
  // 2. indestructible land
  // 3. sun
  this.arr = new Int8Array(length);
  for (var i = 0; i < length; i++) {
    if (pixels.data[i * 4 + 3] > 30) {
      this.arr[i] = 1;
    }
  }

  // set up gravity
  this.init_gravity(gravity_map);
}

/* Get and set array co-ordinate values
	---------------------------------------- */

core_map.prototype.i_get = function(x, y) {
  var x2 = this.loop_x(x);
  var y2 = this.loop_y(y);
  return y2 * this.w + x2;
};

core_map.prototype.i = function(x, y) {
  var i = this.i_get(x, y);
  if (i == null) {
    return 0;
  } else {
    return this.arr[i];
  }
};

core_map.prototype.i_set = function(x, y, val) {
  var i = this.i_get(x, y);
  if (i) {
    this.arr[i] = val;
  }
};

/* Get distance between two points in looping area
	---------------------------------------- */

core_map.prototype.get_distance = function(x1, y1, x2, y2) {
  var x = this.get_distance_x(x1, x2);
  var y = this.get_distance_y(y1, y2);
  return get_speed(x, y);
};

core_map.prototype.get_distance_x = function(x1, x2) {
  return n_diff(x1, x2, 0, this.w);
};
core_map.prototype.get_distance_y = function(y1, y2) {
  return n_diff(y1, y2, 0, this.h);
};

/* Get heading between two points in looping area
	---------------------------------------- */

core_map.prototype.get_heading = function(x1, y1, x2, y2) {
  var x = n_diff(x1, x2, 0, this.w);
  var y = n_diff(y1, y2, 0, this.h);
  return get_angle(x, y);
};

/* Get looping co-ordinate
	---------------------------------------- */

core_map.prototype.loop_x = function(x) {
  return n_loop(x, 0, this.w - 1);
};

core_map.prototype.loop_y = function(y) {
  return n_loop(y, 0, this.h - 1);
};

/* ========================================================================
    App
 ========================================================================== */

const shareLinksText =
  "<div class='links'><a target='_blank' class='fb ball' href='https://www.facebook.com/sharer/sharer.php?u=http://projectants.com' title='Share on Facebook'><img src='" +
  ASSETS +
  "/images/facebook.png' alt=''></a><a target='_blank' class='twitter ball' href='https://twitter.com/intent/tweet?status=Come%20and%20play%20http%3A%2F%2Fprojectants.com%20%23projectants' title='Share on Twitter'><img src='" +
  ASSETS +
  "/images/twitter.png' alt=''></a><br/><a target='_blank' href='mailto:projectantsgame@gmail.com'>Contact</a> | <a target='_blank' href='https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=projectantsgame@gmail.com&lc=UK&item_name=Keeping+the+ants+at+bay!&no_note=0&no_shipping=2&curency_code=GBP&bn=PP-DonationsBF:btn_donateCC_LG.gif:NonHosted'>Donate</a></div>";

const url = new URL(window.location);
const watch = !!url.searchParams.get("watch");

function app() {
  var self = this;
  this.assets_url = ASSETS;
  this.assets = {};
  this.started = false;
  this.watch = watch;
  this.nickname = "the watcher";

  this.sockets = new SocketConnection(function(event) {
    self.run_event(event);
  });
  this.init_interface();

  this.input = new input(function(event) {
    self.run_event(event);
  });
  this.audio = new audio();

  this.init_settings();

  if (this.watch) {
    this.load_room();
  } else {
    this.init_start();
  }
}

/* Load room
    ---------------------------------------- */

app.prototype.load_room = function() {
  if (this.start) {
    hide(this.start);
  }
  show(this.loading);

  // load assets
  var self = this;
  new loader(
    this.assets_url,
    {
      img: {
        sprites: "/images/sprites/sprites.png",
        bg: "/images/textures/space.jpg"
      },
      audio: {
        bleep1: "/audio/bleep1.mp3",
        bloop1: "/audio/bloop1.mp3",
        bloop2: "/audio/bloop2.mp3",
        bing: "/audio/bing.mp3",
        dig: "/audio/dig.mp3",
        doink: "/audio/doink.mp3",
        donk: "/audio/donk.mp3",
        explosion: "/audio/explosion.mp3",
        explosion_gas: "/audio/explosion_gas.mp3",
        explosion_laser: "/audio/explosion_laser.mp3",
        homing: "/audio/homing.mp3",
        fly: "/audio/fly.mp3",
        countdown: "/audio/countdown.mp3",
        jump: "/audio/jump.mp3",
        levelup: "/audio/levelup.mp3",
        locknload: "/audio/locknload.mp3",
        phase: "/audio/phase.mp3",
        pop: "/audio/pop.mp3",
        punch: "/audio/punch.mp3",
        shoot: "/audio/shoot.mp3",
        shoot_laser: "/audio/shoot_laser.mp3",
        throw: "/audio/throw.mp3",
        spooky: "/audio/spooky.mp3",
        walk: "/audio/walk.mp3"
      }
    },
    function(assets) {
      self.init_room(assets);
    }
  );
};

/* Start the app
    ---------------------------------------- */

app.prototype.init_room = function(assets) {
  hide(this.loading);

  this.started = true;
  this.assets = assets;
  this.audio.add_buffers(assets.audio);

  this.room = new multiplayer(
    this.assets,
    this.assets_url,
    this.audio,
    this.input,
    this.nickname,
    this.watch,
    this.run_event,
    this.sockets,
    new onboarding()
  );
  append(this.div, this.room.div);

  if (this.watch) {
    this.sockets.message_send("watcher", []);
  } else {
    this.nickname = this.check_name(this.nickname);
    this.sockets.message_send("send_name", [this.nickname]);
  }
};

window.onload = function() {
  new app();
};

/* ========================================================================
    App
    Events
 ========================================================================== */

/* Events
    ---------------------------------------- */

app.prototype.run_event = function(event) {
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // show and hide menu
  if (event.type == "show_menu") {
    show(this.menu);
  } else if (event.type == "hide_menu") {
    hide(this.menu);

    // if game is full
  } else if (event.type === "full") {
    hide(this.loading);
    show(this.game_full);
    if (this.room && this.room.connecting) {
      hide(this.room.connecting);
    }

    // show the controls screen
  } else if (event.type == "show_settings") {
    this.toggle_settings_screen();

    // send event down a level
  } else {
    if (this.room) {
      this.room.run_event(event);
    }
  }
};

/* ========================================================================
    App Interface
 ========================================================================== */

app.prototype.init_interface = function() {
  this.div = element({ id: "projectants", class: "app" });
  append(document.body, this.div);

  // game full
  this.game_full = element({
    class: "cont_center",
    text: "Oh dear, this room is very full!<br><br><br></div>"
  });
  this.button_new_game = element({
    type: "button",
    class: "button red",
    text: "Find A New One"
  });
  append(this.div, this.game_full);
  append(this.game_full, this.button_new_game);
  hide(this.game_full);

  // find new room
  this.button_new_game.onclick = function() {
    window.location = "/";
  };

  // limit game aspect ratio
  var ratio = this.div.offsetWidth / this.div.offsetHeight;
  this.div.style.width =
    ratio > 1.8
      ? round(this.div.offsetHeight * 1.8) + "px"
      : this.div.offsetWidth + "px";
  this.div.style.height =
    ratio < 1 ? this.div.offsetWidth + "px" : this.div.offsetHeight + "px";

  // loading
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);
};

/* ========================================================================
    App
    Settings
 ========================================================================== */

/* Start settings screen
    ---------------------------------------- */

app.prototype.init_settings = function() {
  var self = this;

  // corner button
  this.icon_settings = element({ class: "settings" });
  this.icon_settings_img = element({
    type: "img",
    src: this.assets_url + "/images/cog.png"
  });
  append(this.div, this.icon_settings);
  append(this.icon_settings, this.icon_settings_img);

  this.settings_visible = false;
  this.icon_settings.onclick = function() {
    self.toggle_settings_screen();
  };

  // box
  this.div_settings = element({ class: "full full_bg" });
  this.div_settings_cont = element({
    class: "cont_center div_controls",
    text: "<div class='top_message'>Settings</div>" + shareLinksText
  });
  append(this.div, this.div_settings);
  append(this.div_settings, this.div_settings_cont);
  hide(this.div_settings);

  // volume
  this.div_volume = element({ text: "<h2>Volume</h2>" });
  this.input_volume = element({ type: "input" });
  this.input_volume.type = "range";
  this.input_volume.setAttribute("min", 0);
  this.input_volume.setAttribute("max", 1);
  this.input_volume.setAttribute("step", 0.1);
  this.input_volume.value = this.audio.volume;
  append(this.div_settings_cont, this.div_volume);
  append(this.div_volume, this.input_volume);

  this.input_volume.onchange = function(e) {
    self.audio.set_global_volume(this.value);
  };

  // controls
  var ctext = "<h2>Controls</h2>";
  ctext += "<dl>";
  ctext += "<dt>Move</dt><dd>WASD / Arrow Keys / Right Click</dd>";
  ctext += "<dt>Jump</dt><dd>Spacebar</dd>";
  ctext += "<dt>Shoot</dt><dd>Left Click / Shift</dd>";
  ctext += "<dt>Select Weapon</dt><dd>1-9 / Scroll Wheel</dd>";
  ctext += "<dt>Follow Weapons</dt><dd>F</dd>";
  ctext += "<dt>Free Cam</dt><dd>Middle Click</dd>";
  ctext += "</dl>";
  this.div_controls = element({ text: ctext });
  append(this.div_settings_cont, this.div_controls);

  // server
  this.div_server = element({
    text:
      "<h2>Server</h2><p><a href='http://uk.projectants.com/'>UK</a> | <a href='http://us.projectants.com/'>US</a></p>"
  });
  append(this.div_settings_cont, this.div_server);

  // close button
  this.div_settings_buttons = element({ class: "buttons" });
  this.button_close_settings = element({ type: "button", text: "Close" });
  append(this.div_settings_cont, this.div_settings_buttons);
  append(this.div_settings_buttons, this.button_close_settings);

  this.button_close_settings.onclick = function() {
    self.settings_visible = false;
    hide(self.div_settings);
  };
};

app.prototype.toggle_settings_screen = function() {
  if ((this.settings_visible = !this.settings_visible)) {
    this.audio.play("bleep1", 0.8);
    show(this.div_settings);
  } else {
    hide(this.div_settings);
  }
};

/* ========================================================================
    App
    Start Screen
 ========================================================================== */

app.prototype.init_start = function() {
  var self = this;

  // get a new or stored nickname
  this.nickname = config.names[rand(0, config.names.length - 1)];
  if (typeof Storage !== "undefined") {
    var lsname = localStorage.getItem("pants_nn");
    if (config.names.indexOf(lsname) === -1) {
      this.nickname = lsname || this.nickname;
    }
  }

  this.start = element({ class: "start" });
  var logo = element({
    type: "img",
    class: "logo",
    src: this.assets_url + "/images/logo.png"
  });
  var instructions = element({
    type: "ul",
    class: "fade",
    text:
      "<li>Collect gems to get stronger</li><li>Destroy the enemy to get their gems!</li><li>WASD or Right Click to Move</li><li>Left Click or Shift to Shoot</li>"
  });
  this.input_name = element({
    type: "input",
    intype: "text",
    value: this.nickname,
    maxlength: 20
  });
  this.button_start = element({
    type: "button",
    class: "break",
    text: "Play Now"
  });

  append(this.div, this.start);
  append(this.start, logo);
  append(this.start, instructions);
  append(this.start, this.input_name);
  append(this.start, this.button_start);
  append(this.start, element({ text: shareLinksText }));

  // start up the app
  this.button_start.onclick = function() {
    self.load_room();
  };
};

/* Check name
    ---------------------------------------- */

app.prototype.check_name = function() {
  var new_name = this.nickname;
  if (this.input_name) {
    new_name = this.input_name.value;
  }
  new_name = new_name.length > 20 ? new_name.substring(0, 20) : new_name;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_nn", new_name);
  }
  return new_name;
};

/* ========================================================================
    Game
    Alert Messages
 ========================================================================== */

/* Set up alert div
    ---------------------------------------- */

game.prototype.init_alert = function() {
  this.div_alert = element({ class: "alert" });
  append(this.div, this.div_alert);
  this.alert_text = "";
  this.alert_count = 0;
};

/* Set alert
    ---------------------------------------- */

game.prototype.set_alert = function(text, col, count) {
  this.alert_count = count || 60;
  this.div_alert.className = "alert";
  this.div_alert.innerHTML = text;
  if (col) {
    add_class(this.div_alert, col);
  }
  show(this.div_alert);
};

/* Run alert
    ---------------------------------------- */

game.prototype.run_alert = function() {
  // do countdowns
  if (this.alert_count > 0) {
    this.alert_count--;
    if (this.alert_count == 0) {
      this.div_alert.innerHTML = "";
      hide(this.div_alert);
    }
  }
};

/* ========================================================================
    Game
    Armoury
 ========================================================================== */

/* Build armoury interface
    ---------------------------------------- */

game.prototype.init_armoury = function() {
  // selected weapon
  this.current_weapon = "";

  // detonation cooldown
  this.detonation_cooldown = 0;

  // create divs
  this.armoury = {
    div: element({ class: "armoury box" }),
    title: element({ class: "title" }),
    player: element({ class: "player_weapon hex-button" }),
    weapons: {},
    show_icon: false,
    show_icon_frame: null
  };
  append(this.div, this.armoury.div);
  append(this.div, this.armoury.player);
  hide(this.armoury.player);

  // go through armoury layout
  var self = this;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var type = this.scheme.armoury[i];

    // create elements
    this.armoury.weapons[type] = {
      box: element({ class: "hex-button weapon", data: type }),
      sprite: element({ class: "sprite" }),
      count: element({ class: "count" }),
      player_icon: element({ class: "icon sprite" }),
      i: i,
      active: false
    };
    append(this.armoury.div, this.armoury.weapons[type].box);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].sprite);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].count);
    append(this.armoury.player, this.armoury.weapons[type].player_icon);
    hide(this.armoury.weapons[type].player_icon);

    // set sprite background position
    var weapon = this.c.weapons[type];
    var sprite = this.c.sprites[weapon.armoury_sprite];
    if (!sprite) {
      continue;
    }
    var offset = ceil((sprite.size - 48) / 2);
    var x = -sprite.x - offset;
    var y = -sprite.y - offset;
    var pos = x - 1 + "px " + y + "px, 0 0";
    this.armoury.weapons[type].sprite.style.backgroundPosition = pos;
    this.armoury.weapons[type].player_icon.style.backgroundPosition = pos;

    // set element events
    this.armoury.weapons[type].box.onclick = function() {
      self.weapon_select(this.dataset.data);
    };
  }

  append(this.armoury.div, this.armoury.title);
  hide(this.armoury.div);
};

/* Initialise armoury with core data
	---------------------------------------- */

game.prototype.set_armoury = function() {
  // set display for all weapons
  for (type in this.armoury.weapons) {
    this.set_weapon(type);
  }

  // select weapon
  if (
    !this.current_weapon ||
    !this.armoury.weapons[this.current_weapon].active
  ) {
    this.weapon_select_n(0);
  }
};

/* Select weapon
	---------------------------------------- */

game.prototype.weapon_select = function(type, no_highlight) {
  // if same weapon or none left
  if (
    !this.player ||
    this.current_weapon === type ||
    this.player.armoury[type] === 0
  ) {
    return;
  }

  // do the change
  for (var key in this.armoury.weapons) {
    remove_class(this.armoury.weapons[key].box, "selected");
    hide(this.armoury.weapons[key].player_icon);
  }
  add_class(this.armoury.weapons[type].box, "selected");
  this.current_weapon = type;
  this.armoury.title.innerHTML = this.c.weapons[type].title;

  // auto following weapon
  var wep = this.c.weapons[type];
  if (
    (wep.auto_follow && !this.weapon_follow) ||
    (!wep.auto_follow && this.weapon_follow)
  ) {
    this.toggle_weapon_follow();
  }

  if (!no_highlight) {
    // play noise
    this.audio.play("bleep1", 0.8);

    // show icon
    this.armoury.show_icon = true;
    this.armoury.show_icon_frame = this.core.state.frame;
    show(this.armoury.weapons[type].player_icon);
    show(this.armoury.player);
  }

  return type;
};

/* Select weapon by position in armoury
	---------------------------------------- */

game.prototype.weapon_select_n = function(n) {
  // if is too big
  if (n >= this.scheme.armoury.length) {
    return;
  }

  // go through columns
  var n2 = 0;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var weapon = this.scheme.armoury[i];
    var active = false;
    if (this.armoury.weapons[weapon].active) {
      active = true;
      if (n2 === n && weapon !== this.current_weapon) {
        return this.weapon_select(weapon);
      }
    }

    // increase count of actual columns
    n2 = active ? n2 + 1 : n2;
  }

  return false;
};

/* Select weapon by scrolling
	---------------------------------------- */

game.prototype.weapon_scroll = function(down) {
  // if we don't have a selected weapon
  var current = this.armoury.weapons[this.current_weapon];
  if (!current) {
    return;
  }

  for (var i = 1; i < this.scheme.armoury.length; i++) {
    var i_down = down ? this.scheme.armoury.length - i : i;
    var new_i = n_loop(current.i + i_down, -1, this.scheme.armoury.length - 1);
    var weapon = this.scheme.armoury[new_i];
    if (this.armoury.weapons[weapon].active) {
      this.weapon_select(weapon);
      return weapon;
    }
  }
};

/* Change to weapon
	---------------------------------------- */

game.prototype.set_weapon = function(type) {
  if (!this.player) {
    return;
  }

  var count = this.player.armoury[type];
  this.armoury.weapons[type].count.innerHTML = count;

  if (count == -1) {
    this.armoury.weapons[type].active = true;
    show(this.armoury.weapons[type].box);
    hide(this.armoury.weapons[type].count);
  } else {
    if (count < 1) {
      this.armoury.weapons[type].active = false;
      hide(this.armoury.weapons[type].box);
      if (type == this.current_weapon) {
        this.weapon_select_n(0);
      }
    } else {
      this.armoury.weapons[type].active = true;
      show(this.armoury.weapons[type].box);
    }
  }

  if (!this.current_weapon) {
    this.weapon_select_n(0);
  }
  this.display_armoury();
};

/* Show armoury or not
	---------------------------------------- */

game.prototype.display_armoury = function() {
  var show_it = false;
  var even = false;
  if (this.player) {
    for (key in this.player.armoury) {
      if (this.player.armoury[key] > 0 || this.player.armoury[key] == -1) {
        show_it = true;
        even = !even;
      }
      this.armoury.weapons[key].box.style.marginTop = even ? "26px" : "0px";
    }
  }
  if (show_it) {
    show(this.armoury.div);
  } else {
    hide(this.armoury.div);
  }
};

/* Run every frame
	---------------------------------------- */

game.prototype.run_armoury = function() {
  // turn off icon
  if (
    this.armoury.show_icon &&
    this.core.state.frame > this.armoury.show_icon_frame + 30
  ) {
    this.armoury.show_icon = false;
    hide(this.armoury.player);
  }
};

/* ========================================================================
    Game
    Audio
 ========================================================================== */

/* Set up audio objects
    ---------------------------------------- */

game.prototype.init_audio = function() {
  // objects with repeating sounds
  this.audio_objs = {};

  // weapon loops
  this.audio_weapons = {};

  // set up power up sound
  this.power_up_audio_on = false;
};

/* Check all game objects with audio objects
    ---------------------------------------- */

game.prototype.run_audio = function() {
  // remove old audio objects
  for (key in this.audio_objs) {
    if (!this.core.state.objects[key]) {
      if (this.audio_objs[key]) {
        this.audio_objs[key].gain.disconnect();
        this.audio_objs[key] = null;
      }
    }
  }

  // objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];

    // what noise should be playing
    var audio_key = null;
    if (obj.grounded && obj.animate && obj.actioned) {
      audio_key = obj.c.audio.walk;
    } else {
      audio_key = obj.c.audio.air;
    }

    var volume = this.get_dist_volume(obj.x, obj.y);
    var audio_obj = this.audio_objs[key];

    // if there is an audio file playing
    if (audio_obj) {
      // change its volume
      this.audio.set_volume(audio_obj, volume);

      // disconnect it
      if (volume <= 0 || audio_obj.audio_key != audio_key || !audio_key) {
        audio_obj.gain.disconnect();
        this.audio_objs[key] = null;
      }

      // if there is not an audio file playing
    } else {
      if (audio_key) {
        this.audio_objs[key] = this.audio.play(audio_key, volume, true);
      }
    }
  }
};

/* Set a weapon shot sound effect
    ---------------------------------------- */

game.prototype.play_weapon_audio = function(props) {
  var weapon = this.c.weapons[props.weapon];
  if (!weapon) {
    return;
  }
  if (!this.audio.buffers[weapon.fire_audio]) {
    return;
  }

  // get volume
  var volume = this.get_dist_volume(props.x, props.y);
  this.audio.play(weapon.fire_audio, volume);
};

/* Get distance volume
    ---------------------------------------- */

game.prototype.get_dist_volume = function(x, y) {
  var distance = this.core.map.get_distance(x, y, this.camera.x, this.camera.y);
  var volume = (1200 - distance) / 1200;
  volume *= volume;
  return volume;
};

/* ========================================================================
    Game
    Crosshair
 ========================================================================== */

/* Set up crosshair
	---------------------------------------- */

game.prototype.init_crosshair = function() {
  this.crosshair = 0;
  this.crosshair_source = "button";
};

/* Calculate crosshair from cursor position
	---------------------------------------- */

game.prototype.run_crosshair = function() {
  if (!this.player || this.player.dead || !this.player_obj) {
    return;
  }
  var obj = this.core.state.objects[this.player_obj.key];
  if (!obj) {
    return;
  }

  this.crosshair = this.core.map.get_heading(
    obj.x,
    obj.y,
    this.cursor.x,
    this.cursor.y
  );

  // // calculate from cursor
  // if (this.crosshair_source == "cursor") {
  // 	this.crosshair = this.core.map.get_heading(obj.x, obj.y, this.cursor.x, this.cursor.y);

  // // calculate from buttons
  // } else
  // if (this.crosshair_source == "button") {

  // 	// calculate angle of crosshair
  // 	var angle = -1;
  // 	if (this.input.actions.move_up) {
  // 		angle = 90;
  // 		if (this.input.actions.move_right) { angle = 135; }
  // 		if (this.input.actions.move_left) { angle = 45; }
  // 	} else
  // 	if (this.input.actions.move_down) {
  // 		angle = 270;
  // 		if (this.input.actions.move_right) { angle = 225; }
  // 		if (this.input.actions.move_left) { angle = 305; }
  // 	} else {
  // 		if (this.input.actions.move_right) { angle = 180; }
  // 		if (this.input.actions.move_left) { angle = 0; }
  // 	}
  // 	if (angle !== -1) {
  // 		this.crosshair = increment_angle(this.crosshair, angle, 4);
  // 	}
  // }
};

/* ========================================================================
    Game
    Decorations
 ========================================================================== */

/* Create decoration
    ---------------------------------------- */

game.prototype.create_decoration = function(props) {
  var obj = {
    frame: this.core.state.frame,
    type: "",
    id: "",
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    timeout: 0,
    angle: 0,
    repeat: true,
    sprite: ""
  };
  obj = deepmerge(obj, props);
  obj.key =
    obj.frame + "-" + obj.x + "-" + obj.y + "-" + obj.sprite + "-" + obj.id;
  this.decorations[obj.key] = obj;
};

/* Run decorations
    ---------------------------------------- */

game.prototype.run_decorations = function() {
  // create trails from objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.trails.count === 0) {
      continue;
    }
    this.create_trail(obj, obj.c.trails);
  }

  // go through all decorations
  for (var key in this.decorations) {
    var dec = this.decorations[key];

    // do timeout
    dec.timeout--;
    if (dec.timeout < 1) {
      delete this.decorations[key];
      continue;
    }

    // move
    dec.x = this.core.map.loop_x(dec.x + dec.speed_x).fixed();
    dec.y = this.core.map.loop_y(dec.y + dec.speed_y).fixed();
  }
};

/* Create trails
	---------------------------------------- */

game.prototype.create_trail = function(obj, trails) {
  // create the trails
  for (var i = 0; i < trails.count; i++) {
    var args = {
      id: i,
      sprite: trails.sprite,
      timeout: trails.timeout,
      x: obj.dx,
      y: obj.dy
    };
    if (trails.rotate) {
      args.angle = rand(0, 360);
    } else {
      args.angle = angle_add(get_angle(-obj.speed_x, -obj.speed_y), 90);
      args.x -= obj.speed_x;
      args.y -= obj.speed_y;
      if (trails.offset_x || trails.offset_y) {
        var xyx = xy_speed(angle_add(args.angle, 90), trails.offset_x);
        var xyy = xy_speed(angle_add(args.angle, 180), trails.offset_y);
        args.x += xyx.x + xyy.x;
        args.y += xyx.y + xyy.y;
      }
    }
    if (trails.move) {
      var move_angle = rand(0, 360);
      var xy = xy_speed(move_angle, trails.speed);
      args.speed_x = -xy.x;
      args.speed_y = -xy.y;
    }
    this.create_decoration(args);
  }
};

/* ========================================================================
    Game
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

game.prototype.run_events = function(events) {
  // events from scheme
  var f_event = this.scheme.events.frame[this.core.current_frame];
  if (f_event) {
    this.run_event(f_event);
  }
};

game.prototype.run_event = function(event) {
  // handle array of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
  }

  // run event
  if (event.type === "weapon_select") {
    this.weapon_select_n(event.n);
  } else if (event.type === "weapon_scroll") {
    this.weapon_scroll(event.down);
  } else if (event.type === "switch_watcher_camera") {
    this.switch_watcher_camera();
  } else if (event.type === "follow_weapon") {
    this.toggle_weapon_follow(true);
  } else if (event.type === "follow_mouse") {
    this.toggle_mouse_follow();
  } else if (event.type === "ground_damage") {
    this.run_event_ground_damage(event);
  } else if (event.type === "screen_shake") {
    this.run_event_screen_shake(event);
  } else if (event.type === "player_health") {
    this.run_event_player_health(event);
  } else if (event.type === "player_level") {
    this.run_event_player_level(event);
  } else if (event.type === "explosion") {
    this.run_event_explosion(event);
  } else if (event.type === "armoury") {
    this.run_event_armoury(event);
  } else if (event.type === "bounce") {
    this.run_event_bounce(event);
  } else if (event.type === "sound") {
    this.run_event_sound(event);
  } else if (event.type === "target") {
    this.run_event_target(event);
  } else if (event.type === "spawn") {
    this.run_event_spawn(event);
  } else if (event.type === "focus") {
    this.run_event_focus(event);
  } else if (event.type === "alert") {
    this.run_event_alert(event);
  } else if (event.type === "collect") {
    this.run_event_collect(event);
  }
};

/* Ground Damage
    ---------------------------------------- */

game.prototype.run_event_ground_damage = function(event) {
  // are we destroying land
  if (!this.scheme.destroy_land) {
    return;
  }

  // damage the ground
  this.core.map.set_circle(event.x, event.y, event.radius, 0);
  this.destroy_land(event.x, event.y, event.radius);
  // this.core.map.gravity_event_recalculate(event.x, event.y, event.radius);

  // do the dig noise and smoke trails
  if (event.dig) {
    this.run_event_sound({ x: event.x, y: event.y, sound: "dig" });
    this.create_trail(
      { dx: event.x, dy: event.y },
      {
        count: 7,
        sprite: "smoke",
        timeout: 20,
        rotate: true,
        move: true,
        speed: 1
      }
    );
  }
};

/* Screen Shake
    ---------------------------------------- */

game.prototype.run_event_screen_shake = function(event) {
  var distance = this.core.map.get_distance(
    event.x,
    event.y,
    this.camera.x,
    this.camera.y
  );
  if (distance < event.radius * 2) {
    this.camera.shake_frame = this.core.state.frame;
    this.camera.shake_size = (distance - event.radius) / 4;
  }
};

/* Health
    ---------------------------------------- */

game.prototype.run_event_player_health = function(event) {
  var obj = this.core.state.objects["player-" + event.id];
  if (obj) {
    var text = String.fromCharCode(9829) + " " + event.health;
    this.create_message(obj, "#ff9999", text, 22);
  }
};

/* Level
    ---------------------------------------- */

game.prototype.run_event_player_level = function(event) {
  var obj = this.core.state.objects["player-" + event.id];

  // is this us
  if (this.player_id === event.id) {
    this.set_score();

    // set alert
    if (event.new > event.prev) {
      var lv = this.scheme.levels;
      var n1 = event.new;
      var n2 = event.prev;
      var benefits = "";
      if (lv.health[n1] > lv.health[n2]) {
        benefits += "<br>+" + (lv.health[n1] - lv.health[n2]) + " max health";
      }
      if (lv.damage[n1] > lv.damage[n2]) {
        benefits += "<br>+" + (lv.damage[n1] - lv.damage[n2]) + " damage";
      }
      if (lv.speed[n1] > lv.speed[n2]) {
        benefits += "<br>+" + (lv.speed[n1] - lv.speed[n2]) + " speed";
      }
      if (lv.jump[n1] > lv.jump[n2]) {
        benefits += "<br>+" + (lv.jump[n1] - lv.jump[n2]) + " jump power";
      }
      var text =
        "<small>You have reached</small><br><span class='large'>Level " +
        (event.new + 1) +
        "</span><small class='blue'>" +
        benefits +
        "</small>";
      this.set_alert(text, "#eeeeee", 150);
    }
  }

  // do the flourish
  if (event.new > event.prev) {
    this.create_message(obj, "#eee", "lvl " + (event.new + 1), 30, -30);
    this.run_event_sound({ x: obj.x, y: obj.y, sound: "levelup" });
    this.create_trail(obj, {
      count: 7,
      sprite: "star-blue",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 1.5
    });
    this.create_trail(obj, {
      count: 7,
      sprite: "ball-red",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 2
    });
  }
};

/* Explosion
    ---------------------------------------- */

game.prototype.run_event_explosion = function(event) {
  // focus camera if we were following it
  if (this.weapon_following === event.key) {
    this.camera.focus = this.core.state.frame;
    this.camera.focus_time = 30;
    this.camera.fx = event.x;
    this.camera.fy = event.y;
  }
};

/* Armoury
    ---------------------------------------- */

game.prototype.run_event_armoury = function(event) {
  if (event.player_id == this.player_id) {
    this.set_weapon(event.weapon);
  }
};

/* Bounce
    ---------------------------------------- */

game.prototype.run_event_bounce = function(event) {
  var obj = this.core.state.objects[event.obj];
  if (!obj) {
    return;
  }
  var sound = obj.c.audio.bounce;
  if (sound) {
    this.run_event_sound({ x: event.x, y: event.y, sound: sound });
  }
};

/* Sound
    ---------------------------------------- */

game.prototype.run_event_sound = function(event) {
  var volume = this.get_dist_volume(event.x, event.y);
  if (volume > 0) {
    this.audio.play(event.sound, volume);
  }
};

/* Set a target on the map
    ---------------------------------------- */

game.prototype.run_event_target = function(event) {
  this.create_decoration({
    sprite: "focus",
    timeout: event.time,
    x: event.x,
    y: event.y,
    repeat: false
  });
  this.audio.play("homing", 1);
};

/* Spawn Objects
    ---------------------------------------- */

game.prototype.run_event_spawn = function(event) {
  this.create_object(event.args, true);

  event.args.time = 30;
  if (event.target) {
    this.run_event_target(event.args);
  }
  if (event.focus) {
    this.run_event_focus(event.args);
  }
};

/* Focus Camera
    ---------------------------------------- */

game.prototype.run_event_focus = function(event) {
  this.camera.focus = this.core.state.frame;
  this.camera.focus_time = event.time;
  this.camera.fx = event.x;
  this.camera.fy = event.y;
  if (event.target) {
    this.run_event_target(event);
  }
};

/* Show alert
    ---------------------------------------- */

game.prototype.run_event_alert = function(event) {
  this.set_alert(event.text, "#eeeeee", event.time);
};

/* Crate Grab
    ---------------------------------------- */

game.prototype.run_event_collect = function(event) {
  // is this not us
  if (event.player_id !== this.player_id) {
    return;
  }

  // get our object
  var obj = this.core.state.objects["player-" + event.player_id];
  if (!obj) {
    return;
  }

  // crates
  if (event.collected === "crate") {
    var weapon = this.c.weapons[event.weapon];
    this.create_message(
      obj,
      "#eeeeee",
      "+" + event.count + " " + weapon.title,
      18
    );
  }

  // gems
  if (event.collected === "gem") {
    this.set_score();
    this.create_message(obj, "#aaff99", "+" + event.n, 22);
  }
};

/* ========================================================================
    Game
    Explosions
 ========================================================================== */

/* Check for explosions
    ---------------------------------------- */

game.prototype.run_explosions = function() {
  // run through all explosions
  for (var key in this.core.state.explosions) {
    var explode_state = this.core.state.explosions[key];
    var explode_sprite = this.explosions[key];

    // if it's not started
    if (!explode_sprite) {
      var type = this.c.objects[explode_state.parent_type];
      if (!type) {
        continue;
      }

      // create sprite reference
      this.explosions[key] = {
        sprite: type.animation.explosion,
        frame: this.core.state.frame,
        x: explode_state.x,
        y: explode_state.y
      };

      // run sound effect
      if (type.audio.explosion) {
        this.run_event_sound({
          sound: type.audio.explosion,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      // run screen shake
      if (type.damage > 0) {
        this.run_event_screen_shake({
          radius: type.damage,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      continue;
    }

    // match position
    explode_sprite.x = explode_sprite.x;
    explode_sprite.y = explode_sprite.y;
  }

  // remove explosions
  for (var key in this.explosions) {
    if (this.core.state.frame > this.explosions[key].frame + 60) {
      delete this.explosions[key];
    }
  }
};

/* ========================================================================
    Game
 ========================================================================== */

function game(
  assets,
  audio,
  input,
  scheme,
  map,
  players,
  player_id,
  top_event,
  onboarding
) {
  // args
  this.c = config;
  this.img = assets.img;
  this.audio = audio;
  this.input = input;
  this.scheme = scheme;
  this.map = map;
  this.players = players;
  this.player_id = player_id;
  this.leader = null;
  this.top_event = top_event;
  this.onboarding = onboarding;

  // game running
  this.active = false;
  this.last_frame = 0;

  // main div
  this.div = element({ class: "game full" });
  this.game_area = element({ id: "game_input" });
  append(this.div, this.game_area);

  // set up game modules
  this.init_crosshair();
  this.init_canvas();
  this.init_armoury();
  this.init_map();
  this.init_camera();
  this.init_background();
  this.init_time();
  this.init_score();
  this.init_alert();
  this.init_audio();

  // things to display
  this.objects = {};
  this.explosions = {};
  this.decorations = {};
  this.actions = {};
  this.sprites = [];
  this.messages = [];
  this.labels = {};

  // wait period before on fired weapon immediately after
  this.detonation_cooldown = 0;

  // create core
  this.core = new core(this.c, this.scheme, this.map.fg, this.map.gravity_map);
  this.core.state = this.core.blank_state();
  this.core.state = this.core.state;
}

/* Init game
    ---------------------------------------- */

game.prototype.start = function(frame) {
  // mark player events
  this.player_events = {};

  // set game status to active
  this.active = true;

  // set player obj
  this.set_this_player_refs();
  this.set_score();

  // set initial camera
  if (this.player) {
    this.camera.x = this.player_obj.x;
    this.camera.y = this.player_obj.y;
  }
};

/* Run core
    ---------------------------------------- */

game.prototype.frame_core = function(frame, actions) {
  // set up this state
  this.core.state.frame = frame;
  this.core.state.events = [];
  var response = this.core.action(this.player_id, actions);

  // run player actions
  this.run_players_events();

  // run this state
  this.core.frame();

  // return the input response
  return response;
};

/* Run display
    ---------------------------------------- */

game.prototype.frame_display = function() {
  this.run_objects();
  this.run_crosshair();
  this.run_camera();
  this.run_explosions();
  this.run_decorations();
  this.run_labels();
  this.run_canvas();
  this.run_audio();
  this.run_time();
  this.run_alert();
  this.run_armoury();

  // detonation cooldown
  this.detonation_cooldown -= this.detonation_cooldown > 0 ? 1 : 0;
};

/* ========================================================================
	Game
	Input
 ========================================================================== */

/* Get current core action input
	---------------------------------------- */

game.prototype.get_input = function() {
  // is the game active and does it have a player
  if (!this.active || !this.player || this.player.dead) {
    return;
  }

  // set source of crosshair movement
  if (
    this.input.active("move_up") ||
    this.input.active("move_down") ||
    this.input.active("move_left") ||
    this.input.active("move_right")
  ) {
    this.crosshair_source = "button";
  } else {
    if (this.input.cursor_moved) {
      this.crosshair_source = "cursor";
    }
  }
  this.input.cursor_moved = false;

  // get player actions
  var active = false;
  var response = {
    action: "none",
    angle: round(this.crosshair)
  };

  // weapon keys
  var shoot_key = false;
  var fire_weapon = false;
  var weapon = this.c.weapons[this.current_weapon];
  if (weapon && this.detonation_cooldown === 0 && this.input.active("shoot")) {
    // abandon a followed weapon
    if (this.core.state.objects[this.weapon_following]) {
      this.detonation_cooldown = 15;
      this.weapon_following = "";

      // normal firing
    } else {
      // on screen
      var pos = this.screen_position(
        this.player_obj.x,
        this.player_obj.y,
        this.player_obj.c.size
      );
      if (!pos.on_screen) {
        return;
      }

      // cooldown
      if (this.player.cooldown > 0) {
        return;
      }

      var weapon = this.c.weapons[this.current_weapon];
      if (!weapon) {
        return;
      }
      if (weapon.power_up && this.power_up < 60) {
        this.power_up++;
      } else {
        fire_weapon = true;
      }
    }
  } else {
    this.powered = false;
    if (this.power_up > 0) {
      fire_weapon = true;
    } else {
      this.power_up = 0;
    }
  }

  // fire weapon
  if (fire_weapon) {
    this.powered = true;
    response.action = "shoot";
    response.power = this.power_up;
    response.weapon = this.current_weapon;
    active = true;
    this.power_up = 0;
  }

  // walking restricted actions
  if (this.player_obj.grounded && !active) {
    // arrow key movement
    var arrow_angle = -1;
    if (this.input.active("move_up")) {
      arrow_angle = 90;
      if (this.input.active("move_right")) {
        arrow_angle = 135;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 45;
      }
    } else if (this.input.active("move_down")) {
      arrow_angle = 270;
      if (this.input.active("move_right")) {
        arrow_angle = 225;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 305;
      }
    } else {
      if (this.input.active("move_right")) {
        arrow_angle = 180;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 0;
      }
    }
    if (arrow_angle !== -1) {
      response.action = "move";
      response.angle = arrow_angle;
      active = true;
    }

    // move crosshair key
    if (this.input.active("move")) {
      response.action = "move";
      active = true;
    }

    // jumping
    if (this.input.active("jump")) {
      response.action = "jump";
      active = true;
    }
  }

  // cancel mouse follow if doing stuff
  if (active) {
    this.cancel_mouse_follow();
  }

  if (!active) {
    return false;
  }

  // set the onboarding
  this.onboarding.set(response.action);

  return response;
};

/* ========================================================================
    Game
    Run Objects
 ========================================================================== */

/* Start objects
	---------------------------------------- */

game.prototype.create_object = function(props, spawn) {
  // use existing props to make new core object
  var obj = this.core.create_object(props);

  // previous position
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = false;
  obj.px2 = obj.x;
  obj.py2 = obj.y;

  // display values
  obj.heading = 0;
  obj.hide = 0;
  obj.barrel_angle = 0;
  obj.actioned = false;
  obj.player_locked = false;

  // display position
  obj.dx = obj.x;
  obj.dy = obj.y;
  obj.ds = 0;

  // check for shoot events
  this.set_shot_object(obj);

  // previous display position
  obj.pdx = obj.x;
  obj.pdy = obj.y;

  // spawn
  if (obj.c.spawn || spawn) {
    // hide new object for x frames
    obj.hide = 9;

    // add a spawn decoration over top
    this.create_decoration({
      x: obj.x,
      y: obj.y,
      timeout: 16,
      repeat: false,
      type: "spawn",
      sprite: "teleport"
    });

    // play spawn sound
    this.run_event_sound({
      sound: "phase",
      x: obj.x,
      y: obj.y
    });
  }

  return obj;
};

/* Set a shot items new location
	---------------------------------------- */

game.prototype.set_shot_object = function(obj) {
  // check for a player
  var player = this.core.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // check for an action
  for (var i = 0; i < player.events.length; i++) {
    var act = player.events[i];
    if (act.obj === obj.key) {
      obj.hide = 100;
    }
  }
};

/* Run objects
	---------------------------------------- */

game.prototype.run_objects = function() {
  // check for player locked objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.player_lock) {
      var player = this.core.state.objects["player-" + obj.player_id];
      if (player) {
        player.player_locked = true;
      }
    }
  }

  for (var key in this.core.state.objects) {
    this.run_object(this.core.state.objects[key]);
  }
};

game.prototype.run_object = function(obj) {
  // snap immediately if us
  if (obj.player_id === this.player_id) {
    obj.dx = obj.x;
    obj.dy = obj.y;

    // prevent bobbling
    if (obj.x === obj.px2 && obj.y === obj.py2) {
      obj.dx = obj.pdx;
      obj.dy = obj.pdy;
    }

    // interpolate others
  } else {
    // get max speed of movement
    if (!obj.actioned) {
      obj.ds = get_speed(obj.speed_x, obj.speed_y);
    }

    // interpolate
    var dist_x = this.core.map.get_distance_x(obj.dx, obj.x);
    var dist_y = this.core.map.get_distance_y(obj.dy, obj.y);
    var max_speed = this.core.map.get_distance(obj.dx, obj.dy, obj.x, obj.y);
    var speed = max(max_speed / 4, min(max_speed, obj.ds));
    var move = check_speed(dist_x, dist_y, speed);
    obj.dx = this.core.map.loop_x(obj.dx + round(move.x));
    obj.dy = this.core.map.loop_y(obj.dy + round(move.y));
  }

  // have we moved
  var moved = obj.pdx !== obj.dx || obj.pdy !== obj.dy;

  // set heading and barrel angle
  if (moved) {
    obj.heading = this.core.map.get_heading(obj.pdx, obj.pdy, obj.dx, obj.dy);
    obj.barrel_angle = increment_angle(obj.barrel_angle, obj.heading, 3);
  }

  // is us
  if (obj.player_id === this.player_id) {
    obj.barrel_angle = obj.player_locked ? obj.heading : this.crosshair;
  }

  // if we have just landed set initial angle
  if (obj.grounded && !obj.pg) {
    var angle = get_angle(obj.speed_x, obj.speed_y);
    var walk = this.core.map.walk(obj.x, obj.y, obj.px, obj.py, angle, 6);
    if (walk.move) {
      obj.angle = walk.angle;
      obj.direction = walk.direction;
      obj.px = obj.x;
      obj.py = obj.y;
      obj.animate = false;
    }
  }

  // if walking
  else if (obj.grounded) {
    // set the display values
    var dist_x = this.core.map.get_distance_x(obj.pdx, obj.dx);
    var dist_y = this.core.map.get_distance_y(obj.pdy, obj.dy);
    var amount_moved = get_speed(dist_x, dist_y);
    if (amount_moved > 3) {
      obj.animate = true;
      obj.direction = this.core.map.ground_dir(
        obj.pdx,
        obj.pdy,
        obj.dx,
        obj.dy
      );
      obj.angle = obj.heading;
    } else {
      obj.animate = obj.c.animation.ground;
    }

    // set sprites
    var suffix = obj.animate ? "-walk-" : "-still-";
    obj.sprite_key = obj.c.animation.sprite + suffix + obj.direction;
    obj.display_angle =
      obj.direction === "left" ? obj.angle : angle_add(obj.angle, 180);

    // not walking
  } else {
    obj.sprite_key = obj.c.animation.sprite;
    obj.animate = true;

    // players
    var player = this.core.state.players[obj.player_id];
    if (obj.type === "player" && player.hit === 0) {
      obj.direction =
        obj.barrel_angle >= 90 && obj.barrel_angle < 270 ? "right" : "left";
      obj.sprite_key += "-air-" + obj.direction;
      obj.display_angle =
        obj.direction === "left"
          ? obj.barrel_angle
          : angle_add(obj.barrel_angle, 180);
    }

    // spinning in the air
    else if (obj.c.animation.air_spin) {
      var ground = this.core.map.ground_pixel(round(obj.dx), round(obj.dy));
      var speed = get_speed(obj.speed_x, obj.speed_y);
      var n = ground ? 0 : 1;
      var angle_adding = moved ? speed * 2 : n;
      obj.display_angle = angle_add(obj.display_angle, angle_adding);

      // pointing towards trajectory
    } else {
      if (round(abs(obj.speed_x) === 0) && round(abs(obj.speed_y) === 0)) {
        if (obj.c.animation.air_spin) {
          obj.display_angle = angle_add(obj.display_angle, 2);
        }
      } else {
        obj.display_angle = angle_add(
          get_angle(-obj.speed_x, -obj.speed_y),
          90
        );
      }
    }
  }

  // static angle flag
  if (obj.c.animation.static_angle) {
    obj.display_angle = 0;
  }

  // weapon just fired flags
  if (obj.fire_sprite_count) {
    obj.fire_sprite_count--;
  }
  if (obj.fire_angle_lock_count) {
    obj.direction = obj.fire_direction;
    obj.display_angle =
      obj.direction === "left"
        ? obj.fire_angle_lock
        : angle_add(obj.fire_angle_lock, 180);
    obj.fire_angle_lock_count--;
  }
  if (obj.fire_body_sprite_count) {
    obj.sprite_key = obj.fire_body_sprite + "-" + obj.direction;
    obj.animate = true;
    obj.fire_body_sprite_count--;
  }

  // previous position
  obj.px2 = obj.px;
  obj.py2 = obj.py;
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = obj.grounded;
  obj.pdx = obj.dx;
  obj.pdy = obj.dy;
  obj.player_locked = false;
};

/* ========================================================================
    Game
    Run Players
 ========================================================================== */

/* Start this player
	---------------------------------------- */

game.prototype.init_player = function(player, preserve_events, remove_events) {
  var new_player;

  // use sources
  if (player) {
    var core_player = this.core.state.players[player.id];
    if (preserve_events && core_player) {
      player.events = core_player.events.concat(player.events);
    }
    new_player = this.core.create_player(player);
    if (remove_events) {
      new_player.events = [];
    }

    // create new
  } else {
    new_player = this.core.create_player({ id: this.player_id });
    this.create_object({ type: "player", player_id: this.player_id });
    this.core.init_player(this.player_id);
  }

  // set this player
  if (new_player.id === this.player_id) {
    this.player = new_player;
    this.set_armoury();
  }
};

/* Resolve players from other states
	---------------------------------------- */

game.prototype.run_players_events = function(players) {
  // clear object actioned events
  for (var key in this.core.state.objects) {
    this.core.state.objects[key].actioned = false;
  }

  // run player events
  for (var key in this.core.state.players) {
    this.run_player_events(this.core.state.players[key]);
  }

  // remove old events
  for (var id in this.player_events) {
    for (var key in this.player_events[id]) {
      if (this.core.state.frame > this.player_events[id][key] + 30) {
        delete this.player_events[id][key];
      }
    }
  }
};

game.prototype.run_player_events = function(player) {
  // init player events
  if (!this.player_events[player.id]) {
    this.player_events[player.id] = {};
  }

  // go through events
  for (var i = 0; i < player.events.length; i++) {
    var event = player.events[i];
    var key = event.frame + "-" + event.type;
    if (!this.player_events[key]) {
      this.player_event(player, event);
      this.player_events[key] = this.core.state.frame;
      break;
    }
  }
};

/* Player action
	---------------------------------------- */

game.prototype.player_event = function(player, event) {
  // is there isn't an action
  if (!event) {
    return;
  }

  // get player object
  var obj = this.core.state.objects["player-" + player.id];
  if (!obj) {
    return;
  }

  // mark object as having performed an action
  obj.actioned = true;

  // movement
  if (event.type === "walk") {
    obj.ds = this.scheme.levels.speed[player.level] || obj.c.speed.move;
  }

  // jump
  if (event.type === "jump") {
    obj.ds = this.scheme.levels.jump[player.level] || obj.c.speed.jump;

    // play jump sound
    this.run_event_sound({
      sound: "jump",
      x: obj.x,
      y: obj.y
    });
  }

  // shooting
  if (event.type === "shoot") {
    var weapon = this.c.weapons[event.weapon];
    var weapon_obj = this.c.objects[weapon.object];

    // are we firing the weapon
    if (obj.player_id === this.player_id) {
      this.detonation_cooldown = min(20, weapon.cooldown);
      this.weapon_following = this.weapon_follow ? event.obj : "";

      // other players shots
    } else {
      var shot_obj = this.core.state.objects[event.obj];
      if (shot_obj) {
        shot_obj.hide = 0;
        shot_obj.dx = obj.dx;
        shot_obj.dy = obj.dy;
        obj.barrel_angle = this.core.map.get_heading(
          obj.x,
          obj.y,
          shot_obj.x,
          shot_obj.y
        );
      }
    }

    // if we are not a player and auto follow weapons
    if (this.player_id === null) {
      if (obj.player_id === parseInt(this.leader) && weapon.auto_follow) {
        this.weapon_following = event.obj;
      }
    }

    // weapon just fired sprite
    if (weapon.fire_sprite) {
      var sprite_key = "ant-weapon-" + weapon.fire_sprite;
      var animation = this.c.animations[sprite_key + "-left"];
      obj.fire_sprite = sprite_key;
      obj.fire_sprite_count = animation ? animation.length + 1 : 1;
      obj.fire_sprite_frame = this.core.state.frame;
    }

    // weapon body sprite
    if (weapon.fire_body_sprite) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_body_sprite = "ant-body-" + weapon.fire_body_sprite;
      obj.fire_body_sprite_count = cool;
    }

    // weapon angle lock
    if (weapon.fire_angle_lock) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_direction = obj.direction;
      obj.fire_angle_lock = obj.barrel_angle;
      obj.fire_angle_lock_count = cool;
    }

    // play sound effect
    this.play_weapon_audio({
      x: obj.dx,
      y: obj.dy,
      player_id: obj.player_id,
      weapon: event.weapon
    });
  }

  // collect a crate or medpack
  if (event.type === "crate" || event.type === "medpack") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "locknload"
    });
  }

  // collected a gem
  if (event.type === "gem") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "bing"
    });
  }
};

/* Set this player references
	---------------------------------------- */

game.prototype.set_this_player_refs = function() {
  // set player ref
  if (this.core.state.players[this.player_id]) {
    this.player = this.core.state.players[this.player_id];
  }

  // set object ref
  if (this.core.state.objects["player-" + this.player_id]) {
    this.player_obj = this.core.state.objects["player-" + this.player_id];
  }
};

/* ========================================================================
    Game
    Scores
 ========================================================================== */

/* Build score interface
    ---------------------------------------- */

game.prototype.init_score = function() {
  if (!this.scheme.score) {
    return;
  }

  this.div_score = element({ class: "score" });
  append(this.div, this.div_score);

  this.div_score_gem = element({ class: "gem" });
  this.div_score_text = element({ class: "text" });
  append(this.div_score, this.div_score_gem);
  append(this.div_score, this.div_score_text);

  // are we doing levels
  if (this.scheme.levels) {
    this.div_score_bar = element({ class: "bar" });
    this.div_score_bar_in = element({ class: "bar-inner" });
    this.div_score_level = element({ class: "level hex-button", text: " LVL" });
    this.div_score_level_num = element({ class: "level-num", text: "1" });
    append(this.div_score, this.div_score_bar);
    append(this.div_score_bar, this.div_score_bar_in);
    append(this.div_score, this.div_score_level);
    append(this.div_score_level, this.div_score_level_num);
  }
};

/* Set score interface
    ---------------------------------------- */

game.prototype.set_score = function() {
  if (!this.scheme.score) {
    return;
  }
  if (!this.player) {
    hide(this.div_score);
    return;
  } else {
    show(this.div_score);
  }

  this.div_score_text.innerHTML = this.player.score;
  if (this.scheme.levels) {
    this.div_score_level_num.innerHTML = this.player.level + 1;

    // do exp bar
    var width = 0;
    var this_level = this.scheme.levels.score[this.player.level];
    var next_level = this.scheme.levels.score[this.player.level + 1];
    if (this_level && next_level) {
      width = (
        ((this.player.score - this_level) / (next_level - this_level)) *
        94
      ).fixed();
    }
    this.div_score_bar_in.style.width = width + "%";
  }
};

/* ========================================================================
    Game
    Timer
 ========================================================================== */

/* Build time interface
    ---------------------------------------- */

game.prototype.init_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  // time divs
  this.div_time = element({ class: "time" });
  this.div_timeout = element({ class: "timeout" });
  append(this.div, this.div_time);
  append(this.div, this.div_timeout);
  hide(this.div_timeout);

  this.display_time = "";
};

/* Run the time interface
    ---------------------------------------- */

game.prototype.run_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  var secs;

  // counting up
  if (this.scheme.time_limit === 0) {
    secs = floor(this.core.state.frame / 24);

    // counting down
  } else {
    var dif = this.scheme.time_limit - this.core.state.frame;
    secs = ceil(dif / 24);

    // timeout
    if (dif === 240) {
      show(this.div_timeout);
    }
    if (dif <= 240 && dif % 24 === 0 && dif > 1) {
      this.audio.play("bloop2", 0.5);
    }
    if (dif === 1) {
      hide(this.div_timeout);
    }
    if (secs <= 10) {
      if (dif % 24 === 0 && secs >= 1) {
        this.div_timeout.innerHTML = secs;
      }
      if (dif === 96) {
        this.audio.play("timeout", 0.8);
      }
    }
  }

  // do time
  var new_time = "0:00";
  if (secs > 0) {
    var minutes = floor(secs / 60),
      seconds = (secs - minutes * 60).toString();
    seconds = seconds.length < 2 ? "0" + seconds : seconds;
    new_time = minutes + ":" + seconds;
  }
  if (this.display_time !== new_time) {
    this.display_time = new_time;
    this.div_time.innerHTML = new_time;
  }
};

/* ========================================================================
	Audio
 ========================================================================== */

window.AudioContext = window.AudioContext || window.webkitAudioContext;

function audio(assets_url) {
  var self = this;

  this.cont = new AudioContext();
  this.buffers = {};
  this.repeaters = {};
  this.volume = 0.1;
  this.stored_volume = 0.1;

  // button hover swish events
  this.button_hover = null;
  document.onmousemove = function(e) {
    if (self.volume == 0) {
      return;
    }
    if (
      e.target.classList.contains("button") ||
      e.target.tagName.toLowerCase() == "button"
    ) {
      if (
        e.target != self.button_hover &&
        !e.target.classList.contains("disabled")
      ) {
        self.button_hover = e.target;
        self.play("bloop1", 1);
      }
    } else {
      self.button_hover = null;
    }
  };
}

/* Set volume
	---------------------------------------- */

audio.prototype.set_global_volume = function(vol) {
  this.volume = vol;
};

/* Add buffers
	---------------------------------------- */

audio.prototype.add_buffers = function(buffers) {
  this.buffers = Object.assign(this.buffers, buffers);
};

/* Play a file
	---------------------------------------- */

audio.prototype.play = function(key, volume, repeat) {
  // if no sound effect
  if (!this.buffers[key]) {
    return;
  }

  // if we're not active
  if (!document.hasFocus() && key !== "join") {
    return;
  }

  var obj = {};
  obj.audio_key = key;
  obj.gain = this.cont.createGain();
  obj.source = this.cont.createBufferSource();
  obj.source.buffer = this.buffers[key];
  obj.source.connect(obj.gain);
  obj.gain.connect(this.cont.destination);
  obj.source.loop = repeat;
  obj.source.start(0);

  this.set_volume(obj, volume);

  return obj;
};

/* Set volume
	---------------------------------------- */

audio.prototype.set_volume = function(obj, volume) {
  if (!obj) {
    return;
  }
  volume = !volume ? 0 : min(volume, 1);
  obj.gain.gain.value = (volume * this.volume).fixed();
};

/* Stop playing audio
	---------------------------------------- */

audio.prototype.stop = function(obj) {
  this.cont.close();
  this.cont = new AudioContext();
};

/* ========================================================================
	Element Functions
 ========================================================================== */

function element(props) {
  // create the element
  var type = props.type ? props.type : "div",
    el = document.createElement(type);

  // set properties
  if (props.id) {
    el.id = props.id;
  }
  if (props.src) {
    el.src = props.src;
  }
  if (props.intype) {
    el.type = props.intype;
  }
  if (props.class) {
    el.className = props.class;
  }
  if (props.text) {
    el.innerHTML = props.text;
  }
  if (props.value) {
    el.value = props.value;
  }
  if (props.data) {
    el.dataset.data = props.data;
  }
  if (props.placeholder) {
    el.placeholder = props.placeholder;
  }
  if (props.maxlength) {
    el.maxLength = props.maxlength;
  }
  if (props.href) {
    el.href = props.href;
  }

  return el;
}

function select(id) {
  return document.getElementById(id);
}

function hide(el) {
  el.style.display = "none";
}

function show(el) {
  el.style.display = "block";
}

function remove(el) {
  el.parentNode.removeChild(el);
}

function empty(el) {
  while (el.firstChild) {
    el.removeChild(el.firstChild);
  }
}

function append(parent, child) {
  parent.appendChild(child);
}

function add_class(el, class_name) {
  var split = el.className.split(" ");
  if (!split.includes(class_name)) {
    split.push(class_name);
  }
  el.className = split.join(" ");
}

function remove_class(el, class_name) {
  var split = el.className.split(" "),
    i = split.indexOf(class_name);
  if (i != -1) {
    split.splice(i, 1);
  }
  el.className = split.join(" ");
}

function display_time(frames) {
  var secs = floor(frames / 30);
  var minutes = floor(secs / 60);
  var seconds = (secs - minutes * 60).toString();
  seconds = seconds.length < 2 ? "0" + seconds : seconds;
  return minutes + ":" + seconds;
}

function debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, br) {
  var e = select("debug");
  if (br) {
    e.innerHTML += "<br>";
  } else {
    e.innerHTML = "";
  }
  if (s1 != undefined) {
    e.innerHTML += s1;
  }
  if (s2 != undefined) {
    e.innerHTML += " | " + s2;
  }
  if (s3 != undefined) {
    e.innerHTML += " | " + s3;
  }
  if (s4 != undefined) {
    e.innerHTML += " | " + s4;
  }
  if (s5 != undefined) {
    e.innerHTML += " | " + s5;
  }
  if (s6 != undefined) {
    e.innerHTML += " | " + s6;
  }
  if (s7 != undefined) {
    e.innerHTML += " | " + s7;
  }
  if (s8 != undefined) {
    e.innerHTML += " | " + s8;
  }
  if (s9 != undefined) {
    e.innerHTML += " | " + s9;
  }
}

function debugbr(s1, s2, s3, s4, s5, s6, s7, s8, s9) {
  debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, true);
}

/* ========================================================================
	Input
 ========================================================================== */

function input(callback) {
  var self = this;
  this.callback = callback;

  // default action keys
  this.action_keys = {
    move: ["0"], // click
    shoot: ["2", ["0", "17"], ["0", "18"], ["0", "91"]], // click, ctrl, alt, cmd
    jump: ["32"], // space
    switch_watcher_camera: ["80"], // p
    follow_weapon: ["70"], // f
    follow_mouse: ["1"], // middle click
    // move_left: ["37", "65"], // left, a
    // move_up: ["38", "87"], // up, w
    // move_right: ["39", "68"], // right, d
    // move_down: ["40", "83"], // down, s
    show_settings: ["27", "13"], // esc, enter
    weapon_select_1: ["49"], // 1
    weapon_select_2: ["50"], // 2
    weapon_select_3: ["51"], // 3
    weapon_select_4: ["52"], // 4
    weapon_select_5: ["53"], // 5
    weapon_select_6: ["54"], // 6
    weapon_select_7: ["55"], // 7
    weapon_select_8: ["56"], // 8
    weapon_select_9: ["57"] // 9
  };

  // set up reference for pressed key codes
  this.key_codes = {};

  // cursor
  this.cursor_moved = false;
  this.cursor = { x: 0, y: 0 };

  // set cursor points
  document.body.onmousemove = function(e) {
    if (e.target.id === "game_input") {
      self.input_cursor(e.clientX, e.clientY);
    }
  };

  // prevent default right click behaviour
  document.body.oncontextmenu = function(e) {
    e.preventDefault();
    return false;
  };

  // manage click events
  document.body.onmousedown = function(e) {
    if (e.target.id === "game_input") {
      self.input_button(e.button, "down");
    }
    if (e.button == 1) {
      e.preventDefault();
      return false;
    }
  };
  document.body.onmouseup = function(e) {
    self.input_button(e.button, "up");
  };

  // mouse wheel
  if ("onmousewheel" in document.body) {
    document.body.onmousewheel = function(e) {
      e.preventDefault ? e.preventDefault() : (e.returnValue = false);
      e = e || window.event;
      self.scroll_wheel(e);
      return false;
    };
  } else {
    document.body.addEventListener("DOMMouseScroll", function(e) {
      self.scroll_wheel(e);
    });
  }

  // manage keyboard events
  document.body.onkeydown = function(e) {
    self.input_button(e.keyCode, "down");
  };
  document.body.onkeyup = function(e) {
    self.input_button(e.keyCode, "up");
  };

  // turn off input when window is not focused
  window.onblur = function() {
    self.input_reset();
  };
}

/* Is an action active
	---------------------------------------- */

input.prototype.active = function(type) {
  const action = this.action_keys[type];
  if (!action) {
    return;
  }
  for (let i = 0; i < action.length; i++) {
    const codes = action[i];
    if (Array.isArray(codes)) {
      let trigger = true;
      for (let i2 = 0; i2 < codes.length; i2++) {
        const code = codes[i2];
        if (!this.key_codes[code]) {
          trigger = false;
        }
      }
      if (trigger) {
        return true;
      }
    } else {
      if (this.key_codes[codes]) {
        return true;
      }
    }
  }
};

/* Find the action of a code
	---------------------------------------- */

input.prototype.find_action = function(code) {
  const actions = [];
  for (let key in this.action_keys) {
    for (let i = 0; i < this.action_keys[key].length; i++) {
      const codes = this.action_keys[key][i];
      if (!Array.isArray(codes) && String(codes) === String(code)) {
        const obj = { type: key };
        // if (key == "show_settings") {
        //   if (this.actions.shoot) {
        //     return [];
        //   }
        // }

        // please don't tell anybody I did this
        if (key == "weapon_select_1") {
          obj.type = "weapon_select";
          obj.n = 0;
        }
        if (key == "weapon_select_2") {
          obj.type = "weapon_select";
          obj.n = 1;
        }
        if (key == "weapon_select_3") {
          obj.type = "weapon_select";
          obj.n = 2;
        }
        if (key == "weapon_select_4") {
          obj.type = "weapon_select";
          obj.n = 3;
        }
        if (key == "weapon_select_5") {
          obj.type = "weapon_select";
          obj.n = 4;
        }
        if (key == "weapon_select_6") {
          obj.type = "weapon_select";
          obj.n = 5;
        }
        if (key == "weapon_select_7") {
          obj.type = "weapon_select";
          obj.n = 6;
        }
        if (key == "weapon_select_8") {
          obj.type = "weapon_select";
          obj.n = 7;
        }
        if (key == "weapon_select_9") {
          obj.type = "weapon_select";
          obj.n = 8;
        }
        actions.push(obj);
      }
    }
  }
  return actions;
};

/* Process input events
	---------------------------------------- */

input.prototype.input_button = function(code, type) {
  // ignore input on a text box
  if (document.activeElement.tagName.toLowerCase() === "input") {
    return;
  }

  if (type == "up") {
    this.key_codes[code] = false;
  }
  if (type == "down") {
    this.key_codes[code] = true;
    const actions = this.find_action(code);
    for (let i = 0; i < actions.length; i++) {
      this.callback(actions[i]);
    }
  }
};

/* Cursor move
    ---------------------------------------- */

input.prototype.input_cursor = function(x, y) {
  this.cursor_moved = true;
  this.cursor.x = x;
  this.cursor.y = y;
};

/* Scroll wheel
    ---------------------------------------- */

input.prototype.scroll_wheel = function(e) {
  // normalize delta for cross browser
  var d = e.detail,
    w = e.wheelDelta,
    d = d ? (w && (f = w / d) ? d / f : -d / 1.35) : w / 120;

  // up or down
  var down = d < 0 ? true : false;

  // event
  this.callback({ type: "weapon_scroll", down: down });
};

/* Reset actions
    ---------------------------------------- */

input.prototype.input_reset = function() {
  for (key in this.key_codes) {
    this.key_codes[key] = false;
  }
};

/* ========================================================================
	Asset Loader
 ========================================================================== */

function loader(assets_url, assets, onload) {
  var self = this;

  // set up loading values
  this.onload = onload;
  this.output = {};
  this.loaded = 0;
  this.count = 0;
  for (var type in assets) {
    this.count += Object.keys(assets[type]).length;
    this.output[type] = {};
  }

  // set up audio
  if (assets.audio) {
    if (Object.keys(assets.audio).length > 0) {
      this.audio_context = new AudioContext();
    }
  }

  // do the loading
  for (var type in assets) {
    for (var key in assets[type]) {
      var url = assets_url + assets[type][key];
      if (type == "json") {
        this.json(url, type, key);
      }
      if (type == "img") {
        this.image(url, type, key);
      }
      if (type == "audio") {
        this.audio(url, type, key);
      }
    }
  }
}

/* Load JSON
	---------------------------------------- */

loader.prototype.json = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.overrideMimeType("application/json");
  request.open("GET", url, true);
  request.onreadystatechange = function() {
    if (request.readyState == 4 && request.status == "200") {
      var response = JSON.parse(request.responseText);
      self.output[type][key] = response;
      self.check_loaded();
    }
  };
  request.send(null);
};

/* Load Image
	---------------------------------------- */

loader.prototype.image = function(url, type, key) {
  var self = this;

  this.output[type][key] = new Image();
  this.output[type][key].src = url;

  // when image is loaded
  this.output[type][key].onload = function() {
    self.check_loaded();
  };
};

/* Load Audio
	---------------------------------------- */

loader.prototype.audio = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.responseType = "arraybuffer";
  request.onload = function() {
    self.audio_context.decodeAudioData(request.response, function(buffer) {
      if (buffer) {
        var file = self.audio_context.createBufferSource();
        file.buffer = buffer;
        file.connect(self.audio_context.destination);

        var gain = self.audio_context.createGain();
        file.connect(gain);
        gain.connect(self.audio_context.destination);

        file.loop = true;

        // gain.gain.value = 1;
        // file.start(0);

        // this.files[key] = this.cont.createBufferSource();
        // this.files[key].buffer = files[key];
        // this.files[key].connect(this.cont.destination);

        // // set up gain node
        // this.gain[key] = this.cont.createGain();
        // this.files[key].connect(this.gain[key]);
        // this.gain[key].connect(this.cont.destination);

        self.output.audio[key] = buffer;
        self.check_loaded();
      }
    });
  };
  request.send(null);
};

/* Check Assets Are Loaded
	---------------------------------------- */

loader.prototype.check_loaded = function() {
  this.loaded++;

  // if we are not ready yet
  if (this.count <= this.loaded) {
    this.onload(this.output);
  }
};

/* ========================================================================
    Onboarding
 ========================================================================== */

function onboarding() {
  this.count = 0;
  this.done = false;
  this.action = {
    move: false,
    jump: false,
    shoot: false
  };

  if (typeof Storage !== "undefined") {
    this.count = localStorage.getItem("pants_onboarding") || 0;
    this.done = this.count > 1;
  }
}

/* Trigger onboardingness
	---------------------------------------- */

onboarding.prototype.set = function(type) {
  if (this.done) {
    return;
  }
  this.action[type] = true;
  for (let key in this.action) {
    if (!this.action[key]) {
      return;
    }
  }
  this.done = true;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_onboarding", this.count + 1);
  }
};

/* ========================================================================
    Socket Messages
    handle connection and message data to and from the server
 ========================================================================== */

function SocketConnection(callback) {
  var self = this;

  // socket connection
  this.io = io(DOMAIN + ":" + PORT);
  this.io.on("message", function(message) {
    self.message_receive(message);
  });
  this.io.on("disconnect", function() {
    callback({ type: "wait_for_connection" });
  });

  this.callback = callback;

  // ids
  this.message_receive_ids = [
    "full",
    "connected",
    "player_join",
    "player_leave",
    "game_wait",
    "game_start",
    "game_end",
    "game_state",
    "ping"
  ];

  this.message_send_ids = [
    "watcher",
    "send_name",
    "player_input",
    "weapon_selected",
    "respawn",
    "ping"
  ];

  // string separator
  this.message_separator = "|";
}

/* Send messages to server
	---------------------------------------- */

SocketConnection.prototype.message_send = function(type, props) {
  var i = this.message_send_ids.indexOf(type);

  // if not a valid message
  if (i === "undefined") {
    return;
  }

  // send message
  var self = this;
  var message = i + this.message_separator + props.join(this.message_separator);
  if (this.lag) {
    setTimeout(function() {
      self.io.send(message);
    }, this.lag);
  } else {
    this.io.send(message);
  }
};

/* Receive messages from server
	---------------------------------------- */

SocketConnection.prototype.message_receive = function(message) {
  // get type of message from id
  var split = message.split(this.message_separator);
  var id = parseInt(split[0]);

  // if not valid id
  if (!this.message_receive_ids[id]) {
    return;
  }
  var type = this.message_receive_ids[id];
  var event = { type: type };

  // prepare information for event handler
  if (type === "full") {
  } else if (type === "connected") {
    event.player_id = split[1] === "null" ? null : parseInt(split[1]);
    event.name = split[2];
    event.players = split[3];
    event.scheme = split[4];
  } else if (type === "player_join") {
    event.user_id = split[1];
    event.name = split[2];
    event.player_id = parseInt(split[3]);
  } else if (type === "player_leave") {
    event.user_id = split[1];
  } else if (type === "game_wait") {
  } else if (type === "game_start") {
    event.reset_players = parseInt(split[1]);
    event.bg_str = split[2];
    event.fg_str = split[3];
    event.gravity_map = split[4];
  } else if (type === "game_end") {
  } else if (type === "game_state") {
    event.frames = parseInt(split[1]);
    event.state = split[2];
    event.responses = split[3];
    event.damages = split[4];
  } else if (type === "ping") {
    event.frame = parseInt(split[1]);
  }

  // run event
  this.callback(event);
};

/* ========================================================================
    Multiplayer
    Player Deaths
 ========================================================================== */

/* Check if we're dead
    ---------------------------------------- */

multiplayer.prototype.frame_dead = function() {
  // not ready for any death stuff
  if (!this.game || !this.game.core || !this.game.player) {
    return;
  }

  // count up to deadness
  if (this.game.player.dead) {
    if (!this.dead) {
      if (this.wait_for_dead < 48) {
        this.wait_for_dead++;
      } else {
        this.death();
      }
    }
  } else {
    this.wait_for_dead = 0;
    if (this.dead) {
      this.respawn();
    }
  }

  // deadness
  if (this.dead) {
    if (this.wait_for_respawn > 0) {
      this.wait_for_respawn--;
      if (this.wait_for_respawn === 0) {
        this.div_dead_countdown.innerHTML = "Click to respawn";
        remove_class(this.button_respawn, "disabled");
      } else {
        this.div_dead_countdown.innerHTML =
          "Respawn in " + ceil(this.wait_for_respawn / 24) + " seconds";
      }
    }
  }
};

/* We have died
    ---------------------------------------- */

multiplayer.prototype.death = function() {
  this.dead = true;
  this.wait_for_dead = 0;
  this.wait_for_respawn = 96;

  hide(this.div_dead_text);
  add_class(this.button_respawn, "disabled");
  show(this.div_dead);
};

/* Respawn triggered
    ---------------------------------------- */

multiplayer.prototype.respawn = function() {
  this.dead = false;
  hide(this.div_dead);
};

/* ========================================================================
    Multiplayer
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

multiplayer.prototype.run_event = function(event) {
  if (!event) {
    return;
  }

  // handle arrays of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // run events
  if (event.type === "full") {
    this.game_full();
  } else if (event.type === "connected") {
    this.connected(event);
  } else if (event.type === "wait_for_connection") {
    this.wait_for_connection();
  } else if (event.type === "player_join") {
    this.player_join(event);
  } else if (event.type === "player_leave") {
    this.player_leave(event);
  } else if (event.type === "game_wait") {
  } else if (event.type === "game_start") {
    this.game_start(event);
  } else if (event.type === "game_end") {
    this.game_end(event);
  } else if (event.type === "game_state") {
    this.game_state_received(event);
  } else if (event.type === "collect") {
    this.event_collect(event);
  } else if (event.type === "ground_damage") {
    this.event_ground_damage(event);
  } else if (event.type === "player_death") {
    this.event_player_death(event);
  } else if (event.type === "weapon_selected") {
    this.sockets.message_send("weapon_selected", [event.weapon]);
  } else if (event.type === "ping") {
    this.event_ping(event);
  }

  // send event down a level
  else if (this.game) {
    this.game.run_event(event);
  }
};

/* Collected item
    ---------------------------------------- */

multiplayer.prototype.event_collect = function(event) {
  if (this.initialised) {
    // wait to recreate
    this.wait_to_create[event.obj] = this.game.core.state.frame;

    // run client collection events
    this.game.run_event(event);

    // run players interface
    this.players_interface();
  }
};

/* Player death
    ---------------------------------------- */

multiplayer.prototype.event_player_death = function(event) {
  // only use server events
  if (!event.from_server) {
    return;
  }

  // run it
  if (this.initialised) {
    this.player_death(event);
  }
};

/* Ping
    ---------------------------------------- */

multiplayer.prototype.event_ping = function(event) {
  // did we request this
  if (!this.pings[event.frame]) {
    return;
  }

  var now = new Date().getTime();

  // record end time for ping
  this.pings[event.frame].end = now;

  // go through all pings
  var ping_count = 0;
  var ping_total = 0;
  for (var frame in this.pings) {
    var ping = this.pings[frame];

    // remove old ones
    if (ping.end && ping.end + 10000 < now) {
      delete this.pings[frame];
      continue;
    }

    // calculate average
    ping_total += ping.end - ping.start;
    ping_count++;
  }

  // show ping
  this.div_ping.innerHTML = round(ping_total / ping_count);
};

/* ========================================================================
    Mulitplayer
    Frames
 ========================================================================== */

/* Start/stop loop
    ---------------------------------------- */

multiplayer.prototype.loop_start = function(start_frame) {
  // close any open loops
  this.loop_stop();

  // set loop vars
  this.start_frame = start_frame || 0;
  this.frames = this.start_frame;
  this.start_time = new Date().getTime();

  var self = this;
  this.interval = setInterval(function() {
    self.run_tick();
  }, 10);
};

multiplayer.prototype.loop_stop = function() {
  clearInterval(this.interval);
};

/* Run tick
    ---------------------------------------- */

multiplayer.prototype.run_tick = function() {
  // calculate number of frames since game start
  var now = new Date().getTime();
  var frames =
    this.start_frame + Math.floor((now - this.start_time) / this.ms_loop);

  // get number of remaining steps
  var frame_difference = frames - this.frames;

  // waiting
  if (frame_difference < 1) {
    return;
  }

  // too much lag
  if (frame_difference > 10) {
    this.loop_start();
    // console.log("tick lag | " + frame_difference);
    return;
  }

  // go through frames to process
  for (var i = 0; i < frame_difference; i++) {
    this.frame();
  }

  // run display loop
  this.game.frame_display();

  // record time this was done
  this.fpses.push(new Date().getTime());
  if (this.fpses.length > 72) {
    this.div_fps.innerHTML = round(
      (3000 / (this.fpses[72] - this.fpses[0])) * this.fps
    );
    this.fpses.splice(0, 1);
  }
};

/* Frame process
    ---------------------------------------- */

multiplayer.prototype.frame = function() {
  // increment frame count
  this.frames++;

  // store input
  if (this.game.player) {
    var action = this.game.get_input();
    if (action) {
      this.store_input[this.frames] = action;
      this.send_input(action);
    }
  }

  // run frame
  this.frame_run(this.frames);

  // remove old states
  this.remove_old_states();

  // run ground damage checks
  this.frame_ground();

  // run death frames
  this.frame_dead();

  // run players interface
  if (this.frames % 48 === 0) {
    this.players_interface();
  }

  // run ping
  if (this.frames % 12 === 0) {
    this.sockets.message_send("ping", [this.frames]);
    this.pings[this.frames] = { start: new Date().getTime() };
  }
};

/* Frame run
    ---------------------------------------- */

multiplayer.prototype.frame_run = function(frame) {
  // run core and store response
  var response = this.game.frame_core(frame, this.store_input[frame]);
  if (response.success) {
    this.store_responses.push(response);
  }

  // events
  this.run_event(this.game.core.state.events);

  // unpack any stored server state for this frame
  if (this.store_packet[frame]) {
    this.set_game_state(this.store_packet[frame]);
    delete this.store_packet[frame];
  }

  // record game state
  this.store_state[frame] = {
    frames: frame,
    state: this.game.core.pack_state(this.game.core.state)
  };
};

/* Remove old states
    ---------------------------------------- */

multiplayer.prototype.remove_old_states = function() {
  for (var frame in this.store_packet) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_packet[frame];
    }
  }
  for (var frame in this.store_state) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_state[frame];
    }
  }
  for (var frame in this.store_input) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_input[frame];
    }
  }
  for (var i = 0; i < this.store_responses.length; i++) {
    if (this.store_responses[i].frame + 50 < this.frames) {
      this.store_responses.splice(i, 1);
    }
  }
};

/* ========================================================================
    Mulitplayer
    Ground Damage
 ========================================================================== */

/* Damage the ground event
    ---------------------------------------- */

multiplayer.prototype.event_ground_damage = function(event) {
  var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

  // did we already have this happen
  if (this.ground_events[key]) {
    return;
  }

  // get boundaries
  var x1 = max(round(event.x - event.radius), 0);
  var x2 = min(round(event.x + event.radius), this.game.core.map.w - 1);
  var y1 = max(round(event.y - event.radius), 0);
  var y2 = min(round(event.y + event.radius), this.game.core.map.h - 1);
  var w = x2 - x1;
  var h = y2 - y1;

  // get array from the map
  var arr = this.game.core.map.get_block(x1, y1, w, h);

  // get piece of the map
  var canv = this.game.get_land_block(x1, y1, w, h);

  // store backed up damage
  this.ground_temp[key] = {
    frame: event.frame,
    x: x1,
    y: y1,
    arr: arr,
    canv: canv
  };

  // store the event itself
  this.ground_events[key] = duplicate_obj(event);
  this.ground_events[key].done = true;

  // run the event
  this.game.run_event(event);
};

/* Check ground damage events
    ---------------------------------------- */

multiplayer.prototype.frame_ground = function() {
  // go through all checks
  for (var key in this.ground_temp) {
    if (this.frames > this.ground_temp[key].frame + 40) {
      clog("damage not confirmed");
      this.undo_ground_damage(this.ground_temp[key], key);
      delete this.ground_temp[key];
      delete this.ground_events[key];
    }
  }

  // go through all events
  for (var key in this.ground_events) {
    var event = this.ground_events[key];
    if (this.frames >= event.frame) {
      if (!event.done) {
        this.game.run_event(event);
        this.ground_events[key].done = true;
      }
    }
    if (this.frames > this.ground_events[key].frame + 50) {
      delete this.ground_events[key];
    }
  }
};

/* Undo ground damage
    ---------------------------------------- */

multiplayer.prototype.undo_ground_damage = function(damage, d_key) {
  // restore it
  this.game.core.map.set_block_from_arr(damage.x, damage.y, damage.arr);
  this.game.draw_land_block(damage.x, damage.y, damage.canv);

  // redo any other events that happened since
  for (var key in this.ground_events) {
    if (d_key === key) {
      continue;
    }
    this.game.run_event(this.ground_events[key]);
  }
};

/* Server response
    ---------------------------------------- */

multiplayer.prototype.resolve_ground = function(str) {
  if (!str) {
    return;
  }

  // unpack damages
  var split = str.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    var event = {
      type: "ground_damage",
      frame: parseInt(split2[0]),
      x: parseFloat(split2[1]),
      y: parseFloat(split2[2]),
      radius: parseFloat(split2[3]),
      dig: split2[4] === "1"
    };
    var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

    // confirm already done damage
    if (this.ground_temp[key]) {
      delete this.ground_temp[key];

      // wait to perform it
    } else {
      this.ground_events[key] = event;
    }
  }
};

/* ========================================================================
    Multiplayer
    Interface
 ========================================================================== */

/* Init interface
    ---------------------------------------- */

multiplayer.prototype.init_interface = function() {
  // loading screen
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);

  // between games screen
  this.between_games = element({
    class: "cont_center",
    text: "Dimension jump in progress!<br><br><div class='loader'></div>"
  });
  append(this.div, this.between_games);
  hide(this.between_games);

  // performance
  this.div_ping = element({ class: "ping" });
  this.div_fps = element({ class: "fps" });
  append(this.div, this.div_ping);
  append(this.div, this.div_fps);

  // dead div
  this.div_dead = element({ class: "full full_bg" });
  this.div_dead_cont = element({
    class: "cont_center red",
    text: "<h3>You have died!</h3>" + shareLinksText
  });
  this.div_dead_text = element({
    type: "p",
    text: "You were killed in action."
  });
  this.div_dead_countdown = element({ type: "p", class: "grey" });
  this.div_dead_buttons = element({ class: "buttons" });
  this.button_respawn = element({
    type: "button",
    class: "button red disabled",
    text: "Respawn"
  });
  append(this.div, this.div_dead);
  append(this.div_dead, this.div_dead_cont);
  append(this.div_dead_cont, this.div_dead_text);
  append(this.div_dead_cont, this.div_dead_countdown);
  append(this.div_dead_cont, this.div_dead_buttons);
  append(this.div_dead_buttons, this.button_respawn);
  hide(this.div_dead);

  // game full screen
  this.full = element({
    class: "cont_center",
    text:
      "Game server full. Please try again later...<br><br><div class='loader'></div>"
  });
  append(this.div, this.full);
  hide(this.full);

  // respawn on click
  var self = this;
  this.button_respawn.onclick = function() {
    if (self.wait_for_respawn === 0) {
      self.sockets.message_send("respawn", []);
    }
  };

  // players
  this.div_players = element({ class: "players" });
  this.table_players = element({ type: "table" });
  append(this.div, this.div_players);
  append(this.div_players, this.table_players);
};

/* ========================================================================
    App
 ========================================================================== */

function multiplayer(
  assets,
  assets_url,
  audio,
  input,
  name,
  watcher,
  run_event,
  sockets,
  onboarding
) {
  // setup
  this.assets = assets;
  this.assets_url = assets_url;
  this.audio = audio;
  this.input = input;
  this.name = name;
  this.watcher = watcher;
  this.top_event = run_event;
  this.sockets = sockets;
  this.scheme = null;
  this.lag = 0;
  this.onboarding = onboarding;

  // loop
  this.fps = 24;
  this.ms_loop = Math.floor(1000 / this.fps);
  this.ms_tick = 10;
  this.active = false;

  // main divs
  this.div = element({ class: "full" });
  this.connecting = element({
    class: "cont_center",
    text: "Waiting for connection...<br><br><div class='loader'></div>"
  });
  append(this.div, this.connecting);

  // set up interface
  this.init_interface();

  // when joining a game record any incoming events for later use
  this.initial_game_events = [];
}

/* Wait for connection
    ---------------------------------------- */

multiplayer.prototype.wait_for_connection = function(event) {
  this.loop_stop();
  hide(this.between_games);
  hide(this.loading);
  hide(this.div_dead);
  show(this.connecting);
};

/* Connected
    ---------------------------------------- */

multiplayer.prototype.connected = function(event) {
  // set up scheme
  this.scheme = deepmerge(schemes.default, schemes[event.scheme]);

  // active values
  this.name = event.name;
  this.player_id = event.player_id;
  this.player_count = 0;
  this.players = {};
  this.players_ref = {};

  // go through string of players
  var split = event.players.split("+");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("/");
    this.init_player({
      user_id: split2[0],
      name: split2[1],
      player_id: parseInt(split2[2])
    });
  }

  // run the player interface
  this.players_interface();
};

/* Start game
    ---------------------------------------- */

multiplayer.prototype.game_start = function(event) {
  this.loading_start = true;
  this.initialised = false;
  this.gravity_map = event.gravity_map;

  this.game_close();

  // reset scores
  if (event.reset_players) {
    for (var id in this.players) {
      this.players[id].level = 0;
      this.players[id].score = 0;
    }
    this.players_interface();
  }

  // stored game states and actions
  this.store_packet = {};
  this.store_state = {};
  this.store_input = {};
  this.store_responses = [];

  // ground damage
  this.ground_temp = {};
  this.ground_events = {};

  // objects that we are waiting on for server confirmation
  this.wait_to_destroy = {};
  this.wait_to_create = {};

  // performance
  this.pings = {};
  this.fpses = [];

  // load the map from data url
  var self = this;
  new loader(
    "",
    {
      img: {
        bg: event.bg_str,
        fg: event.fg_str
      }
    },
    function(assets) {
      self.game_start_loaded(assets.img);
    }
  );
};

multiplayer.prototype.game_start_loaded = function(map) {
  // set up map
  var new_map = {
    fg: mapgen_canvas(map.fg.width, map.fg.height),
    bg: mapgen_canvas(map.bg.width, map.bg.height),
    gravity_map: this.gravity_map
  };
  new_map.fg.cont.drawImage(map.fg, 0, 0);
  new_map.bg.cont.drawImage(map.bg, 0, 0);

  // start up game object
  this.game = new game(
    this.assets,
    this.audio,
    this.input,
    this.scheme,
    new_map,
    this.players_ref,
    this.player_id,
    this.top_event,
    this.onboarding
  );
  append(this.div, this.game.div);

  // finished loading
  this.loading_start = false;
};

/* Init game
    ---------------------------------------- */

multiplayer.prototype.init_game = function(event) {
  if (!this.game || !this.game.core) {
    return;
  }

  // show interface
  hide(this.between_games);
  hide(this.div_dead);
  hide(this.connecting);
  hide(this.loading);

  // stop game
  this.loop_stop();

  // prepare state
  this.set_game_state(event, true);

  // start game
  this.game.start(event.frames);
  this.status = "active";

  // last frame a server packet was received
  this.last_packet = event.frames;
  this.disconnected = false;

  // run initial events
  this.run_event(this.initial_game_events);
  this.initial_game_events = [];
  this.initialised = true;

  // start loop
  this.loop_start(event.frames);
};

/* Close game
    ---------------------------------------- */

multiplayer.prototype.game_close = function(event) {
  this.loop_stop();
  if (this.game) {
    remove(this.game.div);
    delete this.game;
  }
};

/* End Game
    ---------------------------------------- */

multiplayer.prototype.game_end = function(event) {
  // stop game
  this.loop_stop();

  // stop audio
  this.audio.stop();

  // show loading screen
  hide(this.loading);
  hide(this.div_dead);
  hide(this.connecting);
  show(this.between_games);
};

/* Send input to server
    ---------------------------------------- */

multiplayer.prototype.send_input = function(action) {
  var arr = [this.frames, action.action, action.angle];
  if (action.action === "shoot") {
    arr.push(action.weapon);
  }
  this.sockets.message_send("player_input", arr);
};

/* ========================================================================
    Room Players
 ========================================================================== */

/* Create player objects
    ---------------------------------------- */

multiplayer.prototype.init_player = function(props) {
  // add player to array
  this.player_count++;
  this.players[props.user_id] = {
    name: props.name,
    id: props.player_id
  };

  // set players reference
  this.players_ref[props.player_id] = {
    user_id: props.user_id,
    name: props.name,
    level: 0
  };
};

/* Draw players interface
    ---------------------------------------- */

multiplayer.prototype.players_interface = function() {
  // are we good and active
  if (!this.initialised || !this.game.core.state.players) {
    return;
  }

  // show players
  var str = "";
  var sortable = this.players_sort();
  if (!sortable) {
    return;
  }

  // set leader id
  this.game.leader = parseInt(sortable[0].id);

  str = "<thead><th></th><th>lvl</th><th>score</th></thead>";
  for (var i = 0; i < sortable.length; i++) {
    var player = sortable[i];
    var tr_class = "";
    if (player.id == this.player_id) {
      tr_class += "highlight ";
    }
    if (player.dead) {
      tr_class += "dead ";
    }
    str +=
      "<tr class='" +
      tr_class +
      "''><td>" +
      player.name +
      "</td><td class='red'>" +
      (player.level + 1) +
      "</td><td class='green'>" +
      player.score +
      "</td></tr>";
  }

  // check for level ups
  for (var id in this.players_ref) {
    var player = this.players_ref[id];
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    if (player.level !== core_player.level) {
      this.run_event({
        type: "player_level",
        id: parseInt(id),
        prev: player.level,
        new: core_player.level
      });
      this.players_ref[id].level = core_player.level;
    }
  }

  // set content
  this.table_players.innerHTML = str;
};

/* Sort players by score
    ---------------------------------------- */

multiplayer.prototype.players_sort = function() {
  var sortable = [];
  for (var id in this.players_ref) {
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    sortable.push({
      id: id,
      name: this.players_ref[id].name,
      level: core_player.level,
      score: core_player.score,
      dead: core_player.dead
    });
  }
  sortable.sort(function(a, b) {
    return b.score - a.score;
  });
  return sortable;
};

/* Player has joined
    ---------------------------------------- */

multiplayer.prototype.player_join = function(event) {
  this.init_player(event, true);
  this.audio.play("join", 1);
};

/* Player left
    ---------------------------------------- */

multiplayer.prototype.player_leave = function(event) {
  if (!this.players[event.user_id]) {
    return;
  }

  var id = this.players[event.user_id].player_id;
  delete this.players_ref[id];
  delete this.players[event.user_id];
  this.player_count--;

  // remove from game
  if (this.game && this.game.core) {
    this.game.core.remove_player(id);
  }
};

/* ========================================================================
    Game States
 ========================================================================== */

/* Receive game state from server
    ---------------------------------------- */

multiplayer.prototype.game_state_received = function(event) {
  // if we are loading
  if (this.loading_start) {
    return;
  }

  // start the game
  if (!this.initialised || this.disconnected) {
    this.initialised = true;
    this.init_game(event);
    return;
  }

  var diff = event.frames - this.frames;

  // if we are too quick
  if (diff < 0) {
    // console.log("client too fast");
    this.init_game(event);
    return;
  }

  // if it's too far behind resync
  if (diff > 9) {
    // console.log("resync");
    this.init_game(event);
    return;
  }

  // apply the state
  if (event.frames === this.frames) {
    this.set_game_state(event);
  } else {
    this.store_packet[event.frames] = duplicate_obj(event);
  }
};

/* Set game state
    ---------------------------------------- */

multiplayer.prototype.set_game_state = function(event, ignore_res) {
  // run damages
  this.resolve_ground(event.damages);

  // unpack the state
  var state = this.game.core.unpack_state(event.state);

  // set players
  this.resolve_players(state, ignore_res);

  // set this player
  if (!ignore_res) {
    this.resolve_this_player(state, event.responses);
  }

  // set objects
  this.resolve_objects(state.objects, event.frames);

  // set explosions
  this.resolve_explosions(state.explosions, event.frames);

  // set game player references
  this.game.set_this_player_refs();
};

/* Resolve players
    ---------------------------------------- */

multiplayer.prototype.resolve_players = function(state, ignore_res) {
  // set all other players
  for (var key in state.players) {
    if (parseInt(key) !== this.player_id || ignore_res) {
      this.game.init_player(state.players[key], true);
    }
  }

  // remove players
  for (var key in this.game.core.state.players) {
    if (!state.players[key]) {
      this.game.core.remove_player(key);
    }
  }
};

/* Resolve this player
    ---------------------------------------- */

multiplayer.prototype.resolve_this_player = function(state, responses) {
  // prep server state objects
  var server_player = state.players[this.player_id];
  var server_obj = state.objects["player-" + this.player_id];
  if (!server_player || !server_obj) {
    return;
  }

  // prep server responses
  var server_responses = [];
  var split = responses.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    server_responses.push({
      frame: parseInt(split2[0]),
      success: split2[1] === "1",
      x: parseFloat(split2[2]),
      y: parseFloat(split2[3]),
      speed_x: parseFloat(split2[4]),
      speed_y: parseFloat(split2[5]),
      type: split2[6]
    });
  }

  // check player weapon
  if (server_player.weapon !== this.game.current_weapon) {
    this.sockets.message_send("weapon_selected", [this.game.current_weapon]);
  }

  // if we have no more actions
  if (this.store_responses.length === 0) {
    this.game.player.level = server_player.level;
    this.game.player.score = server_player.score;
    this.game.player.dead = server_player.dead;
    this.game.player.health = server_player.health;
    this.game.player.cooldown = server_player.cooldown;
    this.game.player.armoury = duplicate_obj(server_player.armoury);
    this.game.set_armoury();
  }

  // resolve our player
  for (var i = 0; i < this.store_responses.length; i++) {
    var client_response = this.store_responses[i];

    // go through action responses
    for (var j = 0; j < server_responses.length; j++) {
      var server_response = server_responses[j];

      // correct frame
      if (client_response.frame === server_response.frame) {
        // compare the response
        if (
          client_response.success === server_response.success &&
          client_response.x === server_response.x &&
          client_response.y === server_response.y &&
          client_response.speed_x === server_response.speed_x &&
          client_response.speed_y === server_response.speed_y
        ) {
          // clog("act success", server_response.frame, this.frames, server_response.type, client_response.x, server_response.x, client_response.y, server_response.y);
        } else {
          // resync the player
          clog(
            "act fail",
            server_response.frame,
            this.frames,
            server_response.type,
            client_response.x,
            server_response.x,
            client_response.y,
            server_response.y
          );
          if (!this.resync_this_player(server_response)) {
            this.game.init_player(server_player, false, true);
            this.game.create_object(server_obj);
            return;
          }
        }
        server_responses.splice(j, 1);
        this.store_responses.splice(i, 1);
        i--;
        break;
      }
    }
  }
};

/* Sync this player
    ---------------------------------------- */

multiplayer.prototype.resync_this_player = function(server_response) {
  // how far back is this
  var frame = server_response.frame;
  var frame_difference = this.frames - frame;

  // if it's too far back
  // if we have no state to roll back to
  if (frame_difference > 20 || !this.store_state[frame]) {
    // console.log("sync too far back | " + frame_difference);
    return false;
  }

  // reset game state
  this.set_game_state(this.store_state[frame], true);

  // reset player
  this.store_responses = [];
  this.game.player_obj.x = server_response.x;
  this.game.player_obj.y = server_response.y;
  this.game.player_obj.speed_x = server_response.speed_x;
  this.game.player_obj.speed_y = server_response.speed_y;

  // run all frames up to this point
  for (var i = 1; i <= frame_difference; i++) {
    this.frame_run(frame + i);
  }

  return true;
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_objects = function(objects, frame) {
  // check for uncreated objects
  for (var key in objects) {
    if (!this.game.core.state.objects[key]) {
      if (!this.wait_to_create[key] || this.wait_to_create[key] + 40 < frame) {
        delete this.wait_to_create[key];
        this.game.create_object(objects[key]);
      }
    }
  }

  // if there's no corresponding server object
  for (var key in this.game.core.state.objects) {
    if (!objects[key]) {
      // give them a delay
      if (!this.wait_to_destroy[key]) {
        this.wait_to_destroy[key] = frame + 40;
        continue;

        // remove when delay has expired
      } else if (this.wait_to_destroy[key] < frame) {
        delete this.game.core.state.objects[key];
        delete this.wait_to_destroy[key];
      }
    }
  }

  // match up objects
  for (var key in this.game.core.state.objects) {
    // if our player and waiting for action responses
    if (key === "player-" + this.player_id) {
      if (this.store_responses.length !== 0) {
        continue;
      }
    }

    var obj = this.game.core.state.objects[key];
    var res_obj = objects[key];

    // ignore any objects with no reference
    if (!res_obj) {
      continue;
    }

    // match values
    if (obj.type !== res_obj.type) {
      obj.type = res_obj.type;
      obj.c = this.game.c.objects[obj.type];
    }
    obj.grounded = res_obj.grounded;

    // if grounded or us
    if (obj.grounded || obj.player_id === this.player_id) {
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;

      // set interpolation position
    } else if (!obj.actioned) {
      obj.ghost = frame;
      obj.gx = obj.x;
      obj.gy = obj.y;
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;
    }
  }
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_explosions = function(explosions, frame) {
  // check for uncreated explosions
  for (var key in explosions) {
    if (!this.game.core.state.explosions[key]) {
      this.game.core.create_explosion(explosions[key]);

      // ensure correct position
    } else {
      this.game.core.state.explosions[key].x = explosions[key].x;
      this.game.core.state.explosions[key].y = explosions[key].y;
    }
  }
};

/* ========================================================================
    Game
    Tracker Arrows
 ========================================================================== */

/* Run the arrows
    ---------------------------------------- */

game.prototype.run_arrows = function() {
  for (var type in this.scheme.arrows) {
    var arrow = this.scheme.arrows[type];
    if (!arrow) {
      continue;
    }

    // find closest thing
    var lowest = 99999;
    var closest_obj = null;
    for (var key in this.core.state.objects) {
      var obj = this.core.state.objects[key];
      if (obj.type === "player" && obj.player_id === this.player_id) {
        continue;
      }
      if (obj.type === type) {
        var dist = this.core.map.get_distance(
          obj.x,
          obj.y,
          this.camera.x,
          this.camera.y
        );
        if (dist < lowest) {
          lowest = dist;
          closest_obj = obj;
        }
      }
    }
    if (!closest_obj) {
      continue;
    }

    // get screen position
    var pos = this.screen_position(closest_obj.x, closest_obj.y, 80);
    if (pos.on_screen) {
      continue;
    }

    // show an arrow
    var angle = this.core.map.get_heading(
      this.camera.x,
      this.camera.y,
      closest_obj.x,
      closest_obj.y
    );
    var dist = min(lowest, min(this.canvas.cx, this.canvas.cy)) - 22;
    var xy = xy_speed(angle, dist);
    this.sprites.push({
      type: "arrow-" + arrow,
      x: round(this.camera.x + xy.x),
      y: round(this.camera.y + xy.y),
      angle: angle_add(angle, 270)
    });
  }
};

/* ========================================================================
    Game
    Background Layer
 ========================================================================== */

/* Set up background
    ---------------------------------------- */

game.prototype.init_background = function() {
  this.bg = {};
  this.bg.parallax = 0.5;
  this.bg.x = 0;
  this.bg.y = 0;
  this.bg.w = this.img.bg.width;
  this.bg.h = this.img.bg.height;
  this.bg.pattern = this.canvas.cont.createPattern(this.img.bg, "repeat");
};

/* Draw the background
	---------------------------------------- */

game.prototype.draw_background = function() {
  // how much have we moved by
  var dx =
      this.core.map.get_distance_x(this.camera.x, this.camera.px) *
      this.bg.parallax,
    dy =
      this.core.map.get_distance_y(this.camera.y, this.camera.py) *
      this.bg.parallax;

  // add movement multiplied by parallax degree
  this.bg.x = n_loop(this.bg.x + dx, 0, this.bg.w);
  this.bg.y = n_loop(this.bg.y + dy, 0, this.bg.h);

  // draw it
  var size = max(this.canvas.h, this.canvas.w);
  this.canvas.cont.translate(
    this.bg.x + this.camera.sx,
    this.bg.y + this.camera.sy
  );
  this.canvas.cont.fillStyle = this.bg.pattern;
  this.canvas.cont.fillRect(-size, -size, size * 3, size * 3);
  this.canvas.cont.translate(
    -(this.bg.x + this.camera.sx),
    -(this.bg.y + this.camera.sy)
  );
};

/* ========================================================================
    Game
    Camera Position
 ========================================================================== */

/* Set up camera position
	---------------------------------------- */

game.prototype.init_camera = function() {
  this.camera = {};
  this.camera.x = round(this.map.fg.canv.width / 2);
  this.camera.y = round(this.map.fg.canv.height / 2);
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  // watcher follow player
  this.camera.watch_follow = "leader";
  this.camera.watch_follow_player = "";

  // camera weapon
  this.camera_weapon_key = null;

  // camera shake on hit
  this.camera.shake_frame = null;
  this.camera.sx = 0;
  this.camera.sy = 0;

  // camera focus event
  this.camera.focus = null;
  this.camera.focus_time = 0;
  this.camera.fx = 0;
  this.camera.fy = 0;

  // cursor
  this.cursor = { x: 0, y: 0 };

  // weapon following
  this.weapon_follow = false;
  this.weapon_following = "";
};

/* Switch watcher camera
	---------------------------------------- */

game.prototype.switch_watcher_camera = function() {
  if (!watch) {
    return;
  }
  var keys = Object.keys(this.players);
  var index = keys.indexOf(this.camera.watch_follow_player);
  if (index !== -1) {
    if (index === keys.length - 1) {
      this.camera.watch_follow_player = null;
      this.camera.watch_follow = "leader";
      this.set_alert("Following the Leader", "#ccffcc", 100);
      return;
    } else {
      this.camera.watch_follow_player = keys[index + 1];
    }
  } else {
    this.camera.watch_follow_player = keys[0];
  }
  console.log(this.camera.watch_follow_player);
  var player = this.players[this.camera.watch_follow_player];
  this.camera.watch_follow = "player";
  this.set_alert("Following " + player.name, "#eeeeee", 100);
};

/* Calculate current camera position
	---------------------------------------- */

game.prototype.run_camera = function() {
  // stop following if hit
  if (this.weapon_following && this.player && this.player.hit > 0) {
    this.weapon_following = "";
  }

  // set previous position
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  var x, y, move;

  // set fallback camera
  var watch_player_id = 0;
  if (this.camera.watch_follow === "leader") {
    watch_player_id = this.leader;
  } else if (this.camera.watch_follow === "player") {
    watch_player_id = this.camera.watch_follow_player;
  }

  // find object to follow
  var follow_obj = this.core.state.objects[this.weapon_following];
  var watch_obj = this.core.state.objects["player-" + watch_player_id];
  if (follow_obj) {
    x = follow_obj.dx;
    y = follow_obj.dy;
    move = 30;
  } else if (this.player_obj) {
    x = this.player_obj.dx;
    y = this.player_obj.dy;
    move = 60;
  } else if (watch_obj) {
    x = watch_obj.dx;
    y = watch_obj.dy;
    move = 30;
  }

  // go to focus event
  if (
    this.camera.focus != null &&
    this.camera.focus < this.core.state.frame &&
    this.camera.focus + this.camera.focus_time > this.core.state.frame
  ) {
    x = this.camera.fx;
    y = this.camera.fy;
    move = 100;

    // follow cursor
  } else if (this.mouse_follow || !move) {
    x = this.cursor.x;
    y = this.cursor.y;
    move =
      this.core.map.get_distance(this.camera.x, this.camera.y, x, y) * 0.05;
  }

  // move towards new position
  if (move) {
    var dx = this.core.map.get_distance_x(this.camera.x, x);
    var dy = this.core.map.get_distance_y(this.camera.y, y);
    var limit = check_speed(dx, dy, move);
    this.camera.x = this.core.map.loop_x(round(this.camera.x + limit.x));
    this.camera.y = this.core.map.loop_y(round(this.camera.y + limit.y));
  }

  // add screen shake
  this.camera.sx = 0;
  this.camera.sy = 0;
  var diff = this.camera.shake_frame
    ? this.core.state.frame - this.camera.shake_frame
    : 0;
  if (diff < 15 && diff > 0) {
    this.camera.sx = cos((diff / 2.5 - 1.5) * pi) * this.camera.shake_size;
    this.camera.sy = sin((diff / 3 - 1) * pi) * this.camera.shake_size;
  }

  // fix cursor input
  this.cursor_map();
};

/* Toggle weapon following
	---------------------------------------- */

game.prototype.toggle_weapon_follow = function(message) {
  this.weapon_follow = !this.weapon_follow;

  if (message) {
    var text = "on";
    if (!this.weapon_follow) {
      text = "off";
      this.weapon_following = "";
    }
    text = "Follow weapons " + text;
    this.set_alert(text, "#eee");
  }
};

/* Toggle mouse following
	---------------------------------------- */

game.prototype.toggle_mouse_follow = function() {
  this.mouse_follow = !this.mouse_follow;
  var text = this.mouse_follow ? "on" : "off";
  text = "Free cam " + text;
  this.set_alert(text, "#eee");
};

game.prototype.cancel_mouse_follow = function() {
  if (this.mouse_follow) {
    this.toggle_mouse_follow();
  }
};

/* Calculate cursor position on map
	---------------------------------------- */

game.prototype.cursor_map = function() {
  var scale_x = this.canvas.canv.offsetWidth / this.canvas.w;
  var scale_y = this.canvas.canv.offsetHeight / this.canvas.h;
  var x1 =
    this.camera.x +
    round((this.input.cursor.x - round(innerWidth / 2)) * scale_x);
  var y1 =
    this.camera.y +
    round((this.input.cursor.y - round(innerHeight / 2)) * scale_y);
  this.cursor.x = this.core.map.loop_x(round(x1));
  this.cursor.y = this.core.map.loop_y(round(y1));
};

/* Screen position of a co-ordinate
	---------------------------------------- */

game.prototype.screen_position = function(x, y, size) {
  var x1 =
      this.canvas.cx +
      this.core.map.get_distance_x(this.camera.x - this.camera.sx, x),
    y1 =
      this.canvas.cy +
      this.core.map.get_distance_y(this.camera.y - this.camera.sy, y),
    on_screen =
      x1 > -size &&
      x1 < this.canvas.w + size &&
      y1 > -size &&
      y1 < this.canvas.h + size;

  return {
    x: x1,
    y: y1,
    on_screen: on_screen
  };
};

/* ========================================================================
    Game
    Main Canvas
 ========================================================================== */

/* Set up canvas
    ---------------------------------------- */

game.prototype.init_canvas = function() {
  // set up main canvas dimensions and position
  var d = select("projectants");
  this.canvas = {};

  // limit game size
  this.canvas.w = d.offsetWidth;
  this.canvas.h = d.offsetHeight;
  if (this.canvas.h < 800) {
    this.canvas.w = round(this.canvas.w * (800 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (800 / this.canvas.h));
  }
  if (this.canvas.h > 1000) {
    this.canvas.w = round(this.canvas.w * (1000 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (1000 / this.canvas.h));
  }
  this.canvas.cx = round(this.canvas.w / 2);
  this.canvas.cy = round(this.canvas.h / 2);

  // initialise main canvas
  this.canvas.canv = element({ type: "canvas" });
  this.canvas.canv.style.position = "relative";
  this.canvas.cont = this.canvas.canv.getContext("2d");
  this.canvas.canv.width = this.canvas.w;
  this.canvas.canv.height = this.canvas.h;

  append(this.div, this.canvas.canv);
};

/* Frame rendering
    ---------------------------------------- */

game.prototype.run_canvas = function() {
  // clear the canvas
  this.canvas.cont.clearRect(0, 0, this.w, this.h);

  // do the drawing
  this.draw_background();
  this.draw_map();
  this.draw_sprites();
  this.draw_labels();
  this.draw_messages();

  // clear sprites
  this.sprites = [];
};

/* ========================================================================
    Game
    Object Labels
 ========================================================================== */

/* Manage labels
	---------------------------------------- */

game.prototype.run_labels = function() {
  // create labels
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.labels && !this.labels[key]) {
      this.labels[key] = {};
      for (type in obj.c.labels) {
        if (obj.c.labels[type]) {
          this.create_label(this.labels[key], type, key);
        }
      }
    }
  }

  // run through labels
  for (key in this.labels) {
    var obj = this.core.state.objects[key];
    if (!obj) {
      delete this.labels[key];
      continue;
    }
    for (type in this.labels[key]) {
      this.set_label(this.labels[key][type], obj);
    }
  }
};

/* Create label
	---------------------------------------- */

game.prototype.create_label = function(ref, type, key) {
  // check health is active
  if (type === "player_health" && !this.scheme.health) {
    return;
  }

  // create and add to ref object
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  ref[type] = { canv: canv, cont: cont, text: "", key: key, type: type };
};

/* Set label
	---------------------------------------- */

game.prototype.set_label = function(label, obj) {
  // position
  if (label.type === "position") {
    this.set_label_text(label, obj.x + " | " + obj.y);
  }

  // player name
  else if (label.type === "player_name") {
    var player = this.players[obj.player_id];
    if (player) {
      this.set_label_text(label, player.name);
    } else {
      delete this.labels[label.key][label.type];
      return;
    }
  }

  // health bar
  else if (label.type === "player_health") {
    this.set_label_health(label, obj.player_id);
  }

  // timeout
  else if (label.type === "timeout") {
    this.set_label_text(
      label,
      ceil((obj.c.timeout - (this.core.state.frame - obj.frame)) / 24)
    );
  }
};

/* Set text label
	---------------------------------------- */

game.prototype.set_label_text = function(label, text) {
  // prep text
  text = String(text);
  text = str_space(text);

  // if there's no change to text
  if (label.text === text) {
    return;
  }

  // draw text
  label.w = label.cont.measureText(text).width + 9;
  label.h = 18;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.restore();
  label.cont.clearRect(0, 0, label.canv.width, label.canv.height);
  label.cont.font = "12px 'Orbitron'";
  label.cont.fillStyle = "#000";
  label.cont.filter = "drop-shadow(0 2px 4px #000)";
  label.cont.fillText(text, 4, 14 + 0.5);
  label.cont.fillStyle = "#ddd";
  label.cont.fillText(text, 4, 12 + 0.5);
  label.cont.save();
};

/* Set health label
	---------------------------------------- */

game.prototype.set_label_health = function(label, player_id) {
  if (!this.scheme.health) {
    return;
  }

  var player = this.core.state.players[player_id];
  if (!player) {
    delete this.labels[label.key][label.type];
    return;
  }

  // are we doing anything at all
  var level = this.scheme.levels.health[player.level];
  if (!level) {
    return;
  }

  // is it the same
  var text = player.health + " / " + level;
  if (text === label.text) {
    return;
  }
  label.text = text;

  // draw label
  label.w = round(level / 2) + 6;
  label.h = 8;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.fillStyle = "rgba(255,255,255,0.1)";
  label.cont.fillRect(0, 0, label.w, label.h);
  label.cont.fillStyle = "rgba(0,0,0,0.8)";
  label.cont.fillRect(1, 1, label.w - 2, label.h - 2);
  label.cont.fillStyle = "#e41a1a";
  label.cont.fillRect(3, 3, round(player.health / 2), 2);

  // are we hiding it
  label.hide = player.dead;
};

/* Draw labels
	---------------------------------------- */

game.prototype.draw_labels = function() {
  // go through all labels
  for (key in this.labels) {
    // ignore empties or hiddens
    if (!this.labels[key]) {
      continue;
    }

    // get screen position of object
    var obj = this.core.state.objects[key];
    var position = this.screen_position(obj.dx, obj.dy, 50);

    // ignore too far away objects
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var n = 0;
    for (type in this.labels[key]) {
      var label = this.labels[key][type];
      if (label.hide) {
        continue;
      }
      var x = round(position.x - label.w / 2) + 0;
      var y =
        round(position.y - label.h / 2 - obj.c.size * 2 - (label.h - 5) * n) -
        20;
      this.canvas.cont.drawImage(label.canv, x, y);
      n++;
    }
  }
};

/* ========================================================================
    Game
    Map Graphics
 ========================================================================== */

/* Set up the map canvases
	---------------------------------------- */

game.prototype.init_map = function() {
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* Draw the map
	---------------------------------------- */

game.prototype.draw_map = function() {
  var x = this.canvas.cx - this.camera.x + this.camera.sx;
  var y = this.canvas.cy - this.camera.y + this.camera.sy;

  // draw layers
  this.draw_repeating_layer(this.map.bg.canv, x, y);
  this.draw_repeating_layer(this.map.fg.canv, x, y);
};

/* Draw layer canvas repeating on all sides
	---------------------------------------- */

game.prototype.draw_repeating_layer = function(canv, x, y) {
  this.canvas.cont.drawImage(canv, x - canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x, y - canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x - canv.width, y);
  this.canvas.cont.drawImage(canv, x + canv.width, y);
  this.canvas.cont.drawImage(canv, x - canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y + canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y);
};

/* Destroy land on the map
	---------------------------------------- */

game.prototype.destroy_land = function(x, y, size) {
  this.map.fg.cont.beginPath();
  this.map.fg.cont.arc(x, y, size, 0, 2 * pi);
  this.map.fg.cont.fill();
};

/* Get a piece of land
	---------------------------------------- */

game.prototype.get_land_block = function(x, y, w, h) {
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  canv.width = w;
  canv.height = h;
  cont.drawImage(this.map.fg.canv, x, y, w, h, 0, 0, w, h);

  return canv;
};

/* Draw piece of land
	---------------------------------------- */

game.prototype.draw_land_block = function(x, y, canv) {
  this.map.fg.cont.globalCompositeOperation = "normal";
  this.map.fg.cont.drawImage(canv, x, y);
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* ========================================================================
    Game
    Object Messages
 ========================================================================== */

/* Draw the messages
	---------------------------------------- */

game.prototype.draw_messages = function() {
  // go through messages
  for (var i = 0; i < this.messages.length; i++) {
    var message = this.messages[i];

    // increment time
    message.time++;
    if (message.time > 40) {
      this.messages.splice(i, 1);
      continue;
    }

    // get screen position of message
    var position = this.screen_position(message.x, message.y, 50);

    // ignore too far away messages
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var x = round(position.x - message.w / 2) + 0.5;
    var y = round(position.y - message.h / 2) - 30.5 - message.time;

    this.canvas.cont.save();
    this.canvas.cont.translate(0, 0);
    this.canvas.cont.drawImage(message.canv, x, y);
    this.canvas.cont.restore();
  }
};

/* Look for changes in health
	---------------------------------------- */

game.prototype.create_message = function(obj, col, text, size, y_offset) {
  // set up canvas
  var message = {};
  message.canv = element({ type: "canvas" });
  message.cont = message.canv.getContext("2d");

  // draw text
  text = str_space(text);
  message.cont.font = size + "px Orbitron";
  message.w = round(message.cont.measureText(text).width) + 8;
  message.h = size + 4;
  message.canv.width = message.w;
  message.canv.height = message.h;
  message.cont.font = size + "px Orbitron";
  // message.cont.fillStyle = "#000";
  // message.cont.fillText(text, 3.5, size + 0.5);
  message.cont.fillStyle = col;
  message.cont.fillText(text, 3.5, size + 0.5);

  // set position
  var y_offset = y_offset || 0;
  message.x = obj.x;
  message.y = obj.y + y_offset;
  message.time = 0;

  // add to array
  this.messages.push(message);
};

/* ========================================================================
    Game
    Sprites
 ========================================================================== */

/* Run sprites
	---------------------------------------- */

game.prototype.draw_sprites = function() {
  this.sprites = [];

  // objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.hide > 0) {
      obj.hide--;
      continue;
    }
    if (obj.type === "player") {
      var player = this.core.state.players[obj.player_id];
      if (player) {
        if (player.hit > 0) {
          this.draw_player_hit_sprites(obj, player.hit);
        } else {
          this.draw_player_sprites(obj, player);
        }
      }
      continue;
    }
    var args = {
      frame: obj.frame,
      type: obj.sprite_key,
      x: obj.dx,
      y: obj.dy,
      angle: obj.display_angle,
      animate: obj.animate,
      float: obj.c.animation.air_float,
      repeat: true
    };
    this.sprites.unshift(args);
  }

  // explosions
  for (var key in this.explosions) {
    var obj = this.explosions[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      animate: true
    };
    this.sprites.push(args);
  }

  // decorations
  for (var key in this.decorations) {
    var obj = this.decorations[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      angle: obj.angle,
      animate: true,
      repeat: obj.repeat
    };
    this.sprites.unshift(args);
  }

  // get arrows
  this.run_arrows();

  // draw them
  this.draw_sprites_canv();
};

/* Player sprites
	---------------------------------------- */

game.prototype.draw_player_sprites = function(obj, player) {
  var w =
    this.player_id === obj.player_id ? this.current_weapon : player.weapon;
  var weapon = this.c.weapons[w];

  // body
  this.sprites.push({
    frame: obj.frame,
    type: obj.sprite_key,
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // get head direction and angle
  var head_dir = obj.direction;
  if (obj.grounded) {
    var diff = n_diff(
      obj.barrel_angle,
      angle_add(obj.display_angle, 90),
      0,
      360
    );
    head_dir = diff >= -180 && diff < 0 ? "right" : "left";
  }
  var head_angle =
    head_dir === "right" ? angle_add(obj.barrel_angle, 180) : obj.barrel_angle;

  // weapons
  var weapon_sprite = "";
  if (weapon && weapon.sprite) {
    var weapon_sprite = weapon.sprite;
    var weapon_frame = 0;
    var throwing = weapon.sprite === "throw";

    // just fired sprites
    if (obj.fire_sprite_count) {
      weapon_sprite = weapon.fire_sprite;
      weapon_frame = obj.fire_sprite_frame;
      throwing = false;
    }

    // add the weapon sprite
    this.sprites.push({
      type: "ant-weapon-" + weapon_sprite + "-" + head_dir,
      x: this.core.map.loop_x(obj.dx),
      y: this.core.map.loop_y(obj.dy),
      frame: weapon_frame,
      animate: true,
      repeat: true,
      angle: head_angle
    });
  }

  // head
  this.sprites.push({
    type: "ant-head-" + head_dir,
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: head_angle
  });

  // add a throw weapon
  if (throwing) {
    var tobj = this.c.objects[weapon.object];
    var tsprite = tobj.animation.sprite;
    var toff_x = xy_speed(obj.barrel_angle, -16);
    var toff_y = xy_speed(angle_add(head_angle, 90), 14);
    this.sprites.push({
      type: tsprite,
      x: this.core.map.loop_x(obj.dx + toff_x.x + toff_y.x),
      y: this.core.map.loop_y(obj.dy + toff_x.y + toff_y.y),
      animate: false,
      angle: angle_add(obj.barrel_angle, 90)
    });
  }

  // // set crosshair
  // if (this.player_id === obj.player_id) {
  // 	var offx = xy_speed(angle, 50 + weapon.offset_x);
  // 	var offy = xy_speed(offset_angle, 7);
  // 	this.sprites.push({
  // 		type: "crosshair",
  // 		x: round(obj.dx + offx.x + offy.x),
  // 		y: round(obj.dy + offx.y + offy.y),
  // 		angle: angle_add(this.crosshair, 180)
  // 	});
  // }
};

/* Player hit sprites
	---------------------------------------- */

game.prototype.draw_player_hit_sprites = function(obj, hit) {
  // body
  this.sprites.push({
    frame: obj.frame,
    type: hit < 15 ? "ant-body-air-left" : "ant-body-hit",
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // head
  this.sprites.push({
    type: hit < 15 ? "ant-head-left" : "ant-head-hit",
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: obj.display_angle
  });
};

/* Draw sprites on the canvas
	---------------------------------------- */

game.prototype.draw_sprites_canv = function() {
  for (var i = 0; i < this.sprites.length; i++) {
    var sprite = this.sprites[i];

    // get position on screen
    var screen_position = this.screen_position(sprite.x, sprite.y, 48);
    if (!screen_position.on_screen) {
      continue;
    }

    // get sprite key
    var sprite_key = sprite.type;
    var animation = this.c.animations[sprite_key];
    if (animation) {
      sprite_key = animation[0];
      if (sprite.animate) {
        var frame = sprite.frame || 0;
        frame = floor((this.core.state.frame - frame) / 2);
        if (sprite.repeat) {
          frame = frame % animation.length;
        }
        sprite_key = animation[frame];
      }
    }

    // get sprite reference positions
    var sprite_ref = this.c.sprites[sprite_key];
    if (!sprite_ref) {
      continue;
    }

    // get new position to draw on
    var size = sprite_ref.size;
    var pos = -(size / 2);

    // float effect
    var y_add = 0;
    if (sprite.float) {
      y_add = cos((this.core.state.frame - sprite.frame) / 4) * 2;
    }

    // draw it
    this.canvas.cont.save();
    this.canvas.cont.translate(screen_position.x, screen_position.y + y_add);
    if (sprite.angle !== 0) {
      this.canvas.cont.rotate((sprite.angle * Math.PI) / 180);
    }
    this.canvas.cont.drawImage(
      this.img.sprites,
      sprite_ref.x,
      sprite_ref.y,
      size,
      size,
      pos,
      pos,
      size,
      size
    );
    this.canvas.cont.translate(
      -screen_position.x,
      -(screen_position.y + y_add)
    );
    this.canvas.cont.restore();
  }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9hbmltYXRpb25zLmpzIiwiY29uZmlnL21hcGdlbi5qcyIsImNvbmZpZy9uYW1lcy5qcyIsImNvbmZpZy9vYmplY3RzLmpzIiwiY29uZmlnL3Nwcml0ZXMuanMiLCJjb25maWcvd2VhcG9ucy5qcyIsImVuZ2luZS9hY3Rpb25zLmpzIiwiZW5naW5lL2NvbGxpc2lvbnMuanMiLCJlbmdpbmUvY29yZS5qcyIsImVuZ2luZS9ldmVudHMuanMiLCJlbmdpbmUvZXhwbG9zaW9ucy5qcyIsImVuZ2luZS9vYmplY3RzLmpzIiwiZW5naW5lL3BoeXNpY3MuanMiLCJlbmdpbmUvcGxheWVycy5qcyIsImVuZ2luZS9zdGF0ZXMuanMiLCJoZWxwZXJzL2RlZXBtZXJnZS5qcyIsImhlbHBlcnMvbWF0aC5qcyIsImhlbHBlcnMvbWlzYy5qcyIsIm1hcGdlbi9ibG9icy5qcyIsIm1hcGdlbi9jYW52YXMuanMiLCJtYXBnZW4vbWFwZ2VuLmpzIiwic2NoZW1lcy9kZWF0aG1hdGNoLmpzIiwic2NoZW1lcy9kZWZhdWx0LmpzIiwiZW5naW5lL21hcC9ncmF2aXR5LmpzIiwiZW5naW5lL21hcC9ncm91bmQuanMiLCJlbmdpbmUvbWFwL21hcC5qcyIsImFwcC5qcyIsImV2ZW50cy5qcyIsImludGVyZmFjZS5qcyIsInNldHRpbmdzLmpzIiwic3RhcnQuanMiLCJnYW1lL2FsZXJ0LmpzIiwiZ2FtZS9hcm1vdXJ5LmpzIiwiZ2FtZS9hdWRpby5qcyIsImdhbWUvY3Jvc3NoYWlyLmpzIiwiZ2FtZS9kZWNvcmF0aW9ucy5qcyIsImdhbWUvZXZlbnRzLmpzIiwiZ2FtZS9leHBsb3Npb25zLmpzIiwiZ2FtZS9nYW1lLmpzIiwiZ2FtZS9pbnB1dC5qcyIsImdhbWUvb2JqZWN0cy5qcyIsImdhbWUvcGxheWVycy5qcyIsImdhbWUvc2NvcmUuanMiLCJnYW1lL3RpbWUuanMiLCJtb2R1bGVzL2F1ZGlvLmpzIiwibW9kdWxlcy9lbGVtZW50cy5qcyIsIm1vZHVsZXMvaW5wdXQuanMiLCJtb2R1bGVzL2xvYWRlci5qcyIsIm1vZHVsZXMvb25ib2FyZGluZy5qcyIsIm1vZHVsZXMvc29ja2V0cy5qcyIsIm11bHRpcGxheWVyL2RlYXRocy5qcyIsIm11bHRpcGxheWVyL2V2ZW50cy5qcyIsIm11bHRpcGxheWVyL2ZyYW1lcy5qcyIsIm11bHRpcGxheWVyL2dyb3VuZC5qcyIsIm11bHRpcGxheWVyL2ludGVyZmFjZS5qcyIsIm11bHRpcGxheWVyL211bHRpcGxheWVyLmpzIiwibXVsdGlwbGF5ZXIvcGxheWVycy5qcyIsIm11bHRpcGxheWVyL3N0YXRlcy5qcyIsImdhbWUvY2FudmFzL2Fycm93cy5qcyIsImdhbWUvY2FudmFzL2JhY2tncm91bmQuanMiLCJnYW1lL2NhbnZhcy9jYW1lcmEuanMiLCJnYW1lL2NhbnZhcy9jYW52YXMuanMiLCJnYW1lL2NhbnZhcy9sYWJlbHMuanMiLCJnYW1lL2NhbnZhcy9tYXAuanMiLCJnYW1lL2NhbnZhcy9tZXNzYWdlcy5qcyIsImdhbWUvY2FudmFzL3Nwcml0ZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdDRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9lQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5WkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDalRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDalFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbmNvbmZpZy5hbmltYXRpb25zID0ge1xuICBcImFudC1ib2R5LWhpdFwiOiBbXG4gICAgXCJhbnQtYm9keS1oaXQtMVwiLFxuICAgIFwiYW50LWJvZHktaGl0LTJcIixcbiAgICBcImFudC1ib2R5LWhpdC0xXCIsXG4gICAgXCJhbnQtYm9keS1oaXQtM1wiXG4gIF0sXG4gIFwiYW50LWJvZHktc3RpbGwtbGVmdFwiOiBbXCJhbnQtYm9keS13YWxrLWxlZnQtMVwiXSxcbiAgXCJhbnQtYm9keS1zdGlsbC1yaWdodFwiOiBbXCJhbnQtYm9keS13YWxrLXJpZ2h0LTFcIl0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0XCI6IFtcbiAgICBcImFudC1ib2R5LXdhbGstbGVmdC0yXCIsXG4gICAgXCJhbnQtYm9keS13YWxrLWxlZnQtM1wiLFxuICAgIFwiYW50LWJvZHktd2Fsay1sZWZ0LTRcIixcbiAgICBcImFudC1ib2R5LXdhbGstbGVmdC01XCJcbiAgXSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0XCI6IFtcbiAgICBcImFudC1ib2R5LXdhbGstcmlnaHQtMlwiLFxuICAgIFwiYW50LWJvZHktd2Fsay1yaWdodC0zXCIsXG4gICAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTRcIixcbiAgICBcImFudC1ib2R5LXdhbGstcmlnaHQtNVwiXG4gIF0sXG4gIFwiYW50LWhlYWQtbGVmdFwiOiBbXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTJcIixcbiAgICBcImFudC1oZWFkLWxlZnQtM1wiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0yXCJcbiAgXSxcbiAgXCJhbnQtaGVhZC1yaWdodFwiOiBbXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0xXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0yXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0zXCIsXG4gICAgXCJhbnQtaGVhZC1yaWdodC0yXCJcbiAgXSxcbiAgXCJhbnQtaGVhZC1oaXRcIjogW1wiYW50LWhlYWQtaGl0LTFcIiwgXCJhbnQtaGVhZC1oaXQtMlwiLCBcImFudC1oZWFkLWhpdC0zXCJdLFxuICBcImFudC13ZWFwb24tYmF6b29rYS1sZWZ0XCI6IFtcImFudC13ZWFwb24tYmF6b29rYS1sZWZ0XCJdLFxuICBcImFudC13ZWFwb24tYmF6b29rYS1yaWdodFwiOiBbXCJhbnQtd2VhcG9uLWJhem9va2EtcmlnaHRcIl0sXG4gIFwiYW50LXdlYXBvbi1sYXNlci1sZWZ0XCI6IFtcImFudC13ZWFwb24tbGFzZXItbGVmdFwiXSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLXJpZ2h0XCI6IFtcImFudC13ZWFwb24tbGFzZXItcmlnaHRcIl0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0XCI6IFtcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCJdLFxuICBcImFudC13ZWFwb24tdGhyb3ctZmlyZS1sZWZ0XCI6IFtcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0yXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtM1wiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTRcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC01XCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIlxuICBdLFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHRcIjogW1wiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCJdLFxuICBcImFudC13ZWFwb24tdGhyb3ctZmlyZS1yaWdodFwiOiBbXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTJcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtM1wiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC00XCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTVcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCJcbiAgXSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0XCI6IFtcImFudC13ZWFwb24tZGlnLWxlZnQtMVwiXSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1maXJlLWxlZnRcIjogW1xuICAgIFwiYW50LXdlYXBvbi1kaWctbGVmdC0yXCIsXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTNcIixcbiAgICBcImFudC13ZWFwb24tZGlnLWxlZnQtNFwiXG4gIF0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHRcIjogW1wiYW50LXdlYXBvbi1kaWctcmlnaHQtMVwiXSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1maXJlLXJpZ2h0XCI6IFtcbiAgICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTJcIixcbiAgICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTNcIixcbiAgICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTRcIlxuICBdLFxuICBcImFudC1naG9zdFwiOiBbXG4gICAgXCJhbnQtZ2hvc3QtMVwiLFxuICAgIFwiYW50LWdob3N0LTFcIixcbiAgICBcImFudC1naG9zdC0yXCIsXG4gICAgXCJhbnQtZ2hvc3QtMlwiLFxuICAgIFwiYW50LWdob3N0LTNcIixcbiAgICBcImFudC1naG9zdC0zXCIsXG4gICAgXCJhbnQtZ2hvc3QtMlwiLFxuICAgIFwiYW50LWdob3N0LTJcIlxuICBdLFxuICBcImJ1YmJsZS1ibHVlXCI6IFtcbiAgICBcImJhbGwtYmx1ZS0xXCIsXG4gICAgXCJiYWxsLWJsdWUtMlwiLFxuICAgIFwiYmFsbC1ibHVlLTNcIixcbiAgICBcImJhbGwtYmx1ZS00XCIsXG4gICAgXCJiYWxsLWJsdWUtNVwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uLWxcIjogW1xuICAgIFwiZXhwbG9zaW9uLWwtMVwiLFxuICAgIFwiZXhwbG9zaW9uLWwtMlwiLFxuICAgIFwiZXhwbG9zaW9uLWwtM1wiLFxuICAgIFwiZXhwbG9zaW9uLWwtNFwiLFxuICAgIFwiZXhwbG9zaW9uLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uLWwtNlwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTVcIixcbiAgICBcImV4cGxvc2lvbjItbC02XCIsXG4gICAgXCJleHBsb3Npb24yLWwtN1wiLFxuICAgIFwiZXhwbG9zaW9uMi1sLThcIlxuICBdLFxuICBcImV4cGxvc2lvbjItbFwiOiBbXG4gICAgXCJleHBsb3Npb24yLWwtMVwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTJcIixcbiAgICBcImV4cGxvc2lvbjItbC0zXCIsXG4gICAgXCJleHBsb3Npb24yLWwtNFwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTVcIixcbiAgICBcImV4cGxvc2lvbjItbC02XCIsXG4gICAgXCJleHBsb3Npb24yLWwtN1wiLFxuICAgIFwiZXhwbG9zaW9uMi1sLThcIlxuICBdLFxuICBcImV4cGxvc2lvbi1ncmVlbi1sXCI6IFtcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTFcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTJcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTNcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTRcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTVcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTZcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLTdcIixcbiAgICBcImV4cGxvc2lvbi1ncmVlbi1sLThcIlxuICBdLFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlXCI6IFtcbiAgICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTFcIixcbiAgICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTJcIixcbiAgICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTNcIixcbiAgICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTRcIixcbiAgICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTVcIlxuICBdLFxuICBmbGFtZTogW1wiZmxhbWUtMVwiLCBcImZsYW1lLTJcIiwgXCJmbGFtZS0zXCIsIFwiZmxhbWUtNFwiLCBcImZsYW1lLTVcIl0sXG4gIFwiZmxhbWUtbGFyZ2VcIjogW1xuICAgIFwiZmxhbWUtbGFyZ2UtMVwiLFxuICAgIFwiZmxhbWUtbGFyZ2UtMlwiLFxuICAgIFwiZmxhbWUtbGFyZ2UtM1wiLFxuICAgIFwiZmxhbWUtbGFyZ2UtNFwiLFxuICAgIFwiZmxhbWUtbGFyZ2UtNVwiLFxuICAgIFwiZmxhbWUtbGFyZ2UtNlwiXG4gIF0sXG4gIGZvY3VzOiBbXG4gICAgXCJmb2N1cy0xXCIsXG4gICAgXCJmb2N1cy0yXCIsXG4gICAgXCJmb2N1cy0zXCIsXG4gICAgXCJmb2N1cy00XCIsXG4gICAgXCJmb2N1cy01XCIsXG4gICAgXCJmb2N1cy02XCIsXG4gICAgXCJmb2N1cy03XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCIsXG4gICAgXCJmb2N1cy04XCJcbiAgXSxcbiAgXCJnZW0tZ3JlZW5cIjogW1xuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTJcIixcbiAgICBcImdlbS1ncmVlbi0zXCIsXG4gICAgXCJnZW0tZ3JlZW4tNFwiXG4gIF0sXG4gIFwiZ2VtLWJsdWVcIjogW1xuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMVwiLFxuICAgIFwiZ2VtLWJsdWUtMlwiLFxuICAgIFwiZ2VtLWJsdWUtM1wiLFxuICAgIFwiZ2VtLWJsdWUtNFwiXG4gIF0sXG4gIFwiZ2VtLXJlZFwiOiBbXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTJcIixcbiAgICBcImdlbS1yZWQtM1wiLFxuICAgIFwiZ2VtLXJlZC00XCJcbiAgXSxcbiAgXCJnZW0tcHVycGxlXCI6IFtcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMlwiLFxuICAgIFwiZ2VtLXB1cnBsZS0zXCIsXG4gICAgXCJnZW0tcHVycGxlLTRcIlxuICBdLFxuICBcImdlbS1zaWx2ZXJcIjogW1xuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0yXCIsXG4gICAgXCJnZW0tc2lsdmVyLTNcIixcbiAgICBcImdlbS1zaWx2ZXItNFwiXG4gIF0sXG4gIFwiZ3JlbmFkZS1hcm1lZFwiOiBbXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLXJlZFwiLFxuICAgIFwiZ3JlbmFkZS1yZWRcIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtZ3JlZW5cIlxuICBdLFxuICBcIm1pbmUtYWN0aXZlXCI6IFtcbiAgICBcIm1pbmUtcmVkXCIsXG4gICAgXCJtaW5lLXJlZFwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCJcbiAgXSxcbiAgXCJzbW9rZS1ncmVlblwiOiBbXG4gICAgXCJzbW9rZS1ncmVlbi0xXCIsXG4gICAgXCJzbW9rZS1ncmVlbi0yXCIsXG4gICAgXCJzbW9rZS1ncmVlbi0zXCIsXG4gICAgXCJzbW9rZS1ncmVlbi00XCIsXG4gICAgXCJzbW9rZS1ncmVlbi01XCIsXG4gICAgXCJzbW9rZS1ncmVlbi02XCIsXG4gICAgXCJzbW9rZS1ncmVlbi03XCIsXG4gICAgXCJzbW9rZS1ncmVlbi04XCJcbiAgXSxcbiAgdGVsZXBvcnQ6IFtcbiAgICBcInRlbGVwb3J0LTFcIixcbiAgICBcInRlbGVwb3J0LTJcIixcbiAgICBcInRlbGVwb3J0LTNcIixcbiAgICBcInRlbGVwb3J0LTRcIixcbiAgICBcInRlbGVwb3J0LTVcIixcbiAgICBcInRlbGVwb3J0LTZcIixcbiAgICBcInRlbGVwb3J0LTdcIlxuICBdLFxuICB2b3J0ZXg6IFtcbiAgICBcInZvcnRleC0xXCIsXG4gICAgXCJ2b3J0ZXgtMlwiLFxuICAgIFwidm9ydGV4LTNcIixcbiAgICBcInZvcnRleC00XCIsXG4gICAgXCJ2b3J0ZXgtNVwiLFxuICAgIFwidm9ydGV4LTZcIixcbiAgICBcInZvcnRleC03XCIsXG4gICAgXCJ2b3J0ZXgtOFwiLFxuICAgIFwidm9ydGV4LTEwXCIsXG4gICAgXCJ2b3J0ZXgtMTFcIlxuICBdXG59O1xuIiwidmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbmNvbmZpZy5tYXBnZW4gPSB7XG4gIGxhbmRfdHlwZTogW1xuICAgIHtcbiAgICAgIGVkZ2U6IDEsXG4gICAgICBiZzogXCJkaXJ0XCIsXG4gICAgICBmZzogXCJyb2NrXCIsXG4gICAgICBkZWNvcmF0aW9uczoge1xuICAgICAgICBcIjFcIjogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDQzMixcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA0NjgsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogMzYsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNTA0LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDU0MCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA1NzYsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogMzYsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCIyXCI6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDcyLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDE0NCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiAyMTYsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMjg4LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDM2MCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9XG4gICAgfVxuICBdXG59O1xuIiwidmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbmNvbmZpZy5uYW1lcyA9IFtcbiAgXCJEYXZlIExpc3RlclwiLFxuICBcIkFjZSBSaW1tZXJcIixcbiAgXCJRdWVlZyA1MDBcIixcbiAgXCJBYnJhZG9sZiBMaW5jbGVyXCIsXG4gIFwiQmVhcmRsZXNzIFJpa2VyXCIsXG4gIFwiVGhlIEFudCBXaXRoIE5vIE5hbWVcIixcbiAgXCJBbCBDYXBvbmVcIixcbiAgXCJUaGUgUXVlZW5cIixcbiAgXCJNaWNrZXkgRXllc1wiXG5dO1xuIiwidmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbmNvbmZpZy5vYmplY3RzID0ge1xuICBkZWZhdWx0OiB7XG4gICAgc2l6ZTogMSxcbiAgICB3ZWlnaHQ6IDAsXG4gICAgYm91bmNlOiAwLjQsXG4gICAgdGltZW91dDogMCxcbiAgICBkYW1hZ2U6IDMwLFxuICAgIGtub2NrOiAxLFxuICAgIHNwYXduOiBmYWxzZSxcbiAgICBwbGF5ZXJfbG9jazogZmFsc2UsXG4gICAgbGF1bmNoX2Rpc3RhbmNlOiAyLFxuICAgIGRlc3Ryb3lfZ3JvdW5kOiB0cnVlLFxuICAgIHN0b3A6IDAsXG4gICAgaWdub3JlX2xldmVsX2RhbWFnZTogZmFsc2UsXG4gICAgZXZlbnRzOiB7XG4gICAgICBmcmFtZTogXCJcIixcbiAgICAgIGdyb3VuZDogXCJcIixcbiAgICAgIG9iamVjdDogXCJcIixcbiAgICAgIGV4cGxvc2lvbjogXCJcIixcbiAgICAgIGRpZTogXCJcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge30sXG4gICAgc3BlZWQ6IHtcbiAgICAgIG1heF9ncmF2aXR5OiAzMCxcbiAgICAgIG1heDogNDAsXG4gICAgICBtb3ZlOiA0LFxuICAgICAganVtcDogMTBcbiAgICB9LFxuICAgIGNsdXN0ZXI6IHtcbiAgICAgIGNpcmNsZTogdHJ1ZSxcbiAgICAgIG9iamVjdDogXCJncmVuYWRlXCIsXG4gICAgICBzcGVlZDogMixcbiAgICAgIGNvdW50OiA2XG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24tbFwiLFxuICAgICAgc3ByaXRlOiBcIlwiLFxuICAgICAgYWlyX3NwaW46IGZhbHNlLFxuICAgICAgYWlyX2Zsb2F0OiBmYWxzZSxcbiAgICAgIHN0YXRpY19hbmdsZTogZmFsc2UsXG4gICAgICBncm91bmQ6IGZhbHNlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvblwiLFxuICAgICAgYm91bmNlOiBcImRvbmtcIixcbiAgICAgIGhpdDogXCJcIixcbiAgICAgIGFpcjogXCJcIixcbiAgICAgIHdhbGs6IFwid2Fsa1wiXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHBsYXllcl9oZWFsdGg6IGZhbHNlLFxuICAgICAgcGxheWVyX25hbWU6IGZhbHNlLFxuICAgICAgdGltZW91dDogZmFsc2VcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDAsXG4gICAgICBzcGVlZDogMC42LFxuICAgICAgb2Zmc2V0X3g6IDAsXG4gICAgICBvZmZzZXRfeTogMCxcbiAgICAgIHRpbWVvdXQ6IDAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJcIlxuICAgIH1cbiAgfSxcbiAgcGxheWVyOiB7XG4gICAgc2l6ZTogMTIsXG4gICAgd2VpZ2h0OiAwLjcsXG4gICAgYm91bmNlOiAwLjcsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwicGxheWVyX2JvdW5jZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImhpdF9yZWNlaXZlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIGNyYXRlOiBcImNvbGxlY3RcIixcbiAgICAgIG1lZHBhY2s6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tMVwiOiBcImNvbGxlY3RcIixcbiAgICAgIFwiZ2VtLTVcIjogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS0yMFwiOiBcImNvbGxlY3RcIixcbiAgICAgIFwiZ2VtLTUwXCI6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tMjAwXCI6IFwiY29sbGVjdFwiLFxuICAgICAgdm9ydGV4OiBcImNvbGxlY3RcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiYW50LWJvZHlcIixcbiAgICAgIGFpcl9zcGluOiBmYWxzZSxcbiAgICAgIGdyb3VuZDogZmFsc2VcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBib3VuY2U6IFwiZG9pbmtcIixcbiAgICAgIGV4cGxvc2lvbjogXCJwb3BcIlxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICBwbGF5ZXJfaGVhbHRoOiB0cnVlLFxuICAgICAgcGxheWVyX25hbWU6IHRydWVcbiAgICB9XG4gIH0sXG4gIHBsYXllcl9taXNzaWxlOiB7XG4gICAgc2l6ZTogMTIsXG4gICAgd2VpZ2h0OiAwLjcsXG4gICAgZGFtYWdlOiA1MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogW1wiYm91bmNlX2V4cGxvZGVcIiwgXCJzcGF3bl9naG9zdFwiXSxcbiAgICAgIGV4cGxvc2lvbjogW1wiYm91bmNlX2V4cGxvZGVcIiwgXCJzcGF3bl9naG9zdFwiXVxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBbXCJib3VuY2VfZXhwbG9kZVwiLCBcInNwYXduX2dob3N0XCJdXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJhbnQtYm9tYlwiLFxuICAgICAgYWlyX3NwaW46IHRydWVcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgcGxheWVyX25hbWU6IHRydWVcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMC42LFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1yZWRcIlxuICAgIH1cbiAgfSxcbiAgcGxheWVyX2dob3N0OiB7XG4gICAgc2l6ZTogMTIsXG4gICAgd2VpZ2h0OiAwLFxuICAgIGRhbWFnZTogMSxcbiAgICBrbm9jazogMCxcbiAgICBldmVudHM6IHtcbiAgICAgIG9iamVjdDogXCJoaXRfcmVjZWl2ZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImhpdF9yZWNlaXZlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJoaXRfZ2l2ZVwiXG4gICAgfSxcbiAgICBzcGVlZDoge1xuICAgICAgbWF4OiAyLjUsXG4gICAgICBtb3ZlOiAwLjNcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImFudC1naG9zdFwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHBsYXllcl9uYW1lOiB0cnVlXG4gICAgfVxuICB9LFxuICBjcmF0ZToge1xuICAgIHNpemU6IDE2LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImNyYXRlLXdlYXBvblwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgc3BlZWQ6IDEsXG4gICAgICB0aW1lb3V0OiAzMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImJhbGwtYmx1ZVwiXG4gICAgfVxuICB9LFxuICBtZWRwYWNrOiB7XG4gICAgc2l6ZTogMTYsXG4gICAgc3Bhd246IHRydWUsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiY3JhdGUtaGVhbHRoXCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMSxcbiAgICAgIHRpbWVvdXQ6IDMwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1yZWRcIlxuICAgIH1cbiAgfSxcbiAgXCJnZW0tMVwiOiB7XG4gICAgc2l6ZTogMTgsXG4gICAgc3Bhd246IHRydWUsXG4gICAgc3RvcDogMTAsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZ2VtLWdyZWVuXCIsXG4gICAgICBzdGF0aWNfYW5nbGU6IHRydWUsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIFwiZ2VtLTVcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1ibHVlXCIsXG4gICAgICBzdGF0aWNfYW5nbGU6IHRydWUsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIFwiZ2VtLTIwXCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tcmVkXCIsXG4gICAgICBzdGF0aWNfYW5nbGU6IHRydWUsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIFwiZ2VtLTUwXCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tcHVycGxlXCIsXG4gICAgICBzdGF0aWNfYW5nbGU6IHRydWUsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIFwiZ2VtLTIwMFwiOiB7XG4gICAgc2l6ZTogMTgsXG4gICAgc3Bhd246IHRydWUsXG4gICAgc3RvcDogMTAsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZ2VtLXNpbHZlclwiLFxuICAgICAgc3RhdGljX2FuZ2xlOiB0cnVlLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICB2b3J0ZXg6IHtcbiAgICBzaXplOiAyMixcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJ2b3J0ZXhcIlxuICAgIH1cbiAgfSxcbiAgdGFyZ2V0OiB7XG4gICAgc2l6ZTogMjIsXG4gICAgZGFtYWdlOiAwLFxuICAgIHNwYXduOiB0cnVlLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24tbGFzZXItYmx1ZVwiLFxuICAgICAgc3ByaXRlOiBcInRhcmdldFwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgZXhwbG9zaW9uOiBcInBvcFwiLFxuICAgICAgYWlyOiBcIm5vbmVcIlxuICAgIH1cbiAgfSxcbiAgbnVjbGVhcjoge1xuICAgIHNpemU6IDIyLFxuICAgIGRhbWFnZTogMTAwLFxuICAgIHNwYXduOiB0cnVlLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uLWdyZWVuLWxcIixcbiAgICAgIHNwcml0ZTogXCJudWNsZWFyXCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uX2dhc1wiLFxuICAgICAgYWlyOiBcIm5vbmVcIlxuICAgIH1cbiAgfSxcbiAgbWluZToge1xuICAgIHNpemU6IDU4LFxuICAgIGRhbWFnZTogODAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcIm1pbmVcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJhc3Rlcm9pZC1zbWFsbFwiOiB7XG4gICAgc2l6ZTogMTUsXG4gICAgd2VpZ2h0OiAxLFxuICAgIGRhbWFnZTogNDAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbjItbFwiLFxuICAgICAgc3ByaXRlOiBcImFzdGVyb2lkLXNtYWxsXCIsXG4gICAgICBhaXJfc3BpbjogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAwLjYsXG4gICAgICBvZmZzZXRfeDogLTUsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHNwcml0ZTogXCJmbGFtZVwiXG4gICAgfVxuICB9LFxuICBcImFzdGVyb2lkLWxhcmdlXCI6IHtcbiAgICBzaXplOiAzNCxcbiAgICB3ZWlnaHQ6IDEsXG4gICAgZGFtYWdlOiA4MCxcbiAgICBldmVudHM6IHtcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJjbHVzdGVyXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiB0cnVlLFxuICAgICAgb2JqZWN0OiBcImFzdGVyb2lkLXNtYWxsXCIsXG4gICAgICBzcGVlZDogMTYsXG4gICAgICBjb3VudDogM1xuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uMi1sXCIsXG4gICAgICBzcHJpdGU6IFwiYXN0ZXJvaWQtbGFyZ2VcIixcbiAgICAgIGFpcl9zcGluOiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgc3BlZWQ6IDAuNixcbiAgICAgIG9mZnNldF94OiAtNSxcbiAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH0sXG4gIGRpZzoge1xuICAgIHNpemU6IDIsXG4gICAgd2VpZ2h0OiAwLFxuICAgIGRhbWFnZTogMTYsXG4gICAgdGltZW91dDogNixcbiAgICBpZ25vcmVfbGV2ZWxfZGFtYWdlOiB0cnVlLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBbXCJkZXN0cm95XCIsIFwiZHJhZ19wbGF5ZXJcIiwgXCJkaWVcIl1cbiAgICB9XG4gIH0sXG4gIHB1bmNoOiB7XG4gICAgc2l6ZTogMjAsXG4gICAgd2VpZ2h0OiAwLFxuICAgIGRhbWFnZTogMTYsXG4gICAgdGltZW91dDogOCxcbiAgICBwbGF5ZXJfbG9jazogdHJ1ZSxcbiAgICBzdG9wOiA2LFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcInNsaWRlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJoaXRfZ2l2ZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJmbGFtZS1sYXJnZVwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiLFxuICAgICAgYm91bmNlOiBcImRvaW5rXCIsXG4gICAgICBoaXQ6IFwicHVuY2hcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHNwZWVkOiAxLjUsXG4gICAgICBvZmZzZXRfeDogLTEwLFxuICAgICAgb2Zmc2V0X3k6IDAsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH0sXG4gIGxhc2VyOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgd2VpZ2h0OiAwLFxuICAgIHRpbWVvdXQ6IDIwLFxuICAgIGRhbWFnZTogMzAsXG4gICAgZGVzdHJveV9ncm91bmQ6IGZhbHNlLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgb2JqZWN0OiBcIm5vbmVcIixcbiAgICAgIGRpZTogXCJub25lXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogW1wiZXhwbG9kZVwiLCBcImRpZVwiXSxcbiAgICAgIHBsYXllcl9naG9zdDogW1wiaGl0X2dpdmVcIiwgXCJkaWVcIl1cbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImxhc2VyLWJsdWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24tbGFzZXItYmx1ZVwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbl9sYXNlclwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgc3BlZWQ6IDAsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiBmYWxzZSxcbiAgICAgIHNwcml0ZTogXCJidWJibGUtYmx1ZVwiXG4gICAgfVxuICB9LFxuICBiYXpvb2thOiB7XG4gICAgc2l6ZTogNixcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICB0aW1lb3V0OiAzMDAsXG4gICAgZGFtYWdlOiA3MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiYmF6b29rYS1zaGVsbFwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgc3BlZWQ6IDEuNSxcbiAgICAgIG9mZnNldF94OiAtMTAsXG4gICAgICBvZmZzZXRfeTogMCxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfSxcbiAgZ3JlbmFkZToge1xuICAgIHNpemU6IDQsXG4gICAgd2VpZ2h0OiAwLjcsXG4gICAgdGltZW91dDogNzIsXG4gICAgZGFtYWdlOiA1MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJib3VuY2VcIixcbiAgICAgIG9iamVjdDogXCJib3VuY2VcIixcbiAgICAgIGV4cGxvc2lvbjogXCJib3VuY2VcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJib3VuY2VcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBhaXJfc3BpbjogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJncmVuYWRlLWFybWVkXCJcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgdGltZW91dDogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJjb3VudGRvd25cIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1ncmVlblwiXG4gICAgfVxuICB9LFxuICBwdW1wa2luOiB7XG4gICAgc2l6ZTogMTAsXG4gICAgd2VpZ2h0OiAxLFxuICAgIHRpbWVvdXQ6IDEyMCxcbiAgICBkYW1hZ2U6IDcwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImJvdW5jZVwiLFxuICAgICAgb2JqZWN0OiBcImJvdW5jZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImJvdW5jZVwiLFxuICAgICAgZGllOiBcImNsdXN0ZXJcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImJvdW5jZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGFpcl9zcGluOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcInB1bXBraW5cIlxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICB0aW1lb3V0OiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcInNwb29reVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgdGltZW91dDogMjAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHJvdGF0ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYXRcIlxuICAgIH0sXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiBmYWxzZSxcbiAgICAgIG9iamVjdDogXCJwdW1wa2luX3NsaWNlXCIsXG4gICAgICBzcGVlZDogMTUsXG4gICAgICBjb3VudDogM1xuICAgIH1cbiAgfSxcbiAgcHVtcGtpbl9zbGljZToge1xuICAgIHNpemU6IDYsXG4gICAgd2VpZ2h0OiAxLFxuICAgIHRpbWVvdXQ6IDIwMCxcbiAgICBkYW1hZ2U6IDMwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGFpcl9zcGluOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcInB1bXBraW4tc2xpY2VcIlxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1vcmFuZ2VcIlxuICAgIH1cbiAgfSxcbiAgcGFpbmdpdmVyOiB7XG4gICAgc2l6ZTogMjAsXG4gICAgd2VpZ2h0OiAxLFxuICAgIGRhbWFnZTogNTAsXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiBmYWxzZSxcbiAgICAgIG9iamVjdDogXCJncmVuYWRlXCIsXG4gICAgICBzcGVlZDogMTUsXG4gICAgICBjb3VudDogM1xuICAgIH0sXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBkaWU6IFwiY2x1c3RlclwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcInJvY2tldFwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJmbGFtZVwiXG4gICAgfVxuICB9XG59O1xuXG4vLyBwcmVwIG9iamVjdHNcbmNvbmZpZy5vYmplY3RfcmVmcyA9IFtdO1xuZm9yIChrZXkgaW4gY29uZmlnLm9iamVjdHMpIHtcbiAgY29uZmlnLm9iamVjdF9yZWZzLnB1c2goa2V5KTtcbiAgY29uZmlnLm9iamVjdHNba2V5XSA9IGRlZXBtZXJnZShjb25maWcub2JqZWN0cy5kZWZhdWx0LCBjb25maWcub2JqZWN0c1trZXldLCB7XG4gICAgYXJyYXlNZXJnZTogZG9udF9tZXJnZVxuICB9KTtcbn1cbiIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcuc3ByaXRlcyA9IHtcbiAgXCJiYWxsLWJsdWVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDE5MixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYmFsbC1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjQwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYWxsLW9yYW5nZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjg4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYWxsLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzM2LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYWxsLXNpbHZlclwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzg0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYXRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQzMixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiZmxhbWUtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJmbGFtZS0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA1MjgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImZsYW1lLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDU3NixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiZmxhbWUtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNjI0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJmbGFtZS01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2NzIsXG4gICAgeTogMTA1NlxuICB9LFxuICBcIm1pbmUtZ3JleVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzIwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJtaW5lLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzY4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJwdW1wa2luLXNsaWNlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4MTYsXG4gICAgeTogMTA1NlxuICB9LFxuICBcInB1bXBraW5cIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDg2NCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwic3Rhci1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5MTIsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC1ib2R5LWFpci1sZWZ0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5NjAsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC1ib2R5LWFpci1yaWdodFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTAwOCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LWJvZHktaGl0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC1ib2R5LWhpdC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDBcbiAgfSxcbiAgXCJhbnQtYm9keS1oaXQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA0OFxuICB9LFxuICBcImFudC1ib2R5LXN1cGVybWFuLWxlZnRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogOTZcbiAgfSxcbiAgXCJhbnQtYm9keS1zdXBlcm1hbi1yaWdodFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAxNDRcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAyNDBcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAyODhcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAzMzZcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNDMyXG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDQ4MFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA1MjhcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodC01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDYyNFxuICB9LFxuICBcImFudC1ib21iXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDY3MlxuICB9LFxuICBcImFudC1naG9zdC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA1NzYsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWdob3N0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDY0MCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtZ2hvc3QtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNzA0LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1oZWFkLWhpdC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA3NjgsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWhlYWQtaGl0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDgzMixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtaGVhZC1oaXQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogODk2LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1oZWFkLWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogOTYwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1oZWFkLWxlZnQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAwXG4gIH0sXG4gIFwiYW50LWhlYWQtbGVmdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDY0XG4gIH0sXG4gIFwiYW50LWhlYWQtcmlnaHQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMjhcbiAgfSxcbiAgXCJhbnQtaGVhZC1yaWdodC0yXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDE5MlxuICB9LFxuICBcImFudC1oZWFkLXJpZ2h0LTNcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMjU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1iYXpvb2thLWxlZnRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMzIwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1iYXpvb2thLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA0NDhcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNTEyXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctbGVmdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDU3NlxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLWxlZnQtNFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA2NDBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDcwNFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA4MzJcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC00XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDg5NlxuICB9LFxuICBcImFudC13ZWFwb24tbGFzZXItbGVmdFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXB1bmNoLWxlZnRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDY0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXB1bmNoLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMjgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDcyMFxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDc2OFxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDgxNlxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDg2NFxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDkxMlxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMTAwOFxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQ4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcm1vdXJ5LWRpZ1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFybW91cnktZXh0aW5ndWlzaGVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDE0NCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJtb3VyeS1sYXNlci1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxOTIsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFybW91cnktbGFzZXItcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAyNDAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFybW91cnktcHVuY2hcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDI4OCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJyb3ctYmx1ZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzM2LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcnJvdy1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzg0LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcnJvdy1ncmV5XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA0MzIsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFycm93LXB1cnBsZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcnJvdy1yZWRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDUyOCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXN0ZXJvaWQtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJhc3Rlcm9pZC0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NixcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJiYWxsLWJsdWUtMVwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMDI0XG4gIH0sXG4gIFwiYmFsbC1ibHVlLTJcIjoge1xuICAgIHNpemU6IDI0LFxuICAgIHg6IDEwODAsXG4gICAgeTogMTAyNFxuICB9LFxuICBcImJhbGwtYmx1ZS0zXCI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiAxMDI0LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImJhbGwtYmx1ZS00XCI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiAxMDI0LFxuICAgIHk6IDk4NFxuICB9LFxuICBcImJhbGwtYmx1ZS01XCI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiA1NzYsXG4gICAgeTogMTAyNFxuICB9LFxuICBcImJhem9va2Etc2hlbGxcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDU3NixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiY3JhdGUtaGVhbHRoXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2MjQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImNyYXRlLXdlYXBvblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNjcyLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJjcm9zc2hhaXJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDcyMCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtMVwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDAsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTJcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTNcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTRcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtNVwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtNlwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC03XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC04XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMTkyLFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTFcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAzODQsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtMlwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDU3NixcbiAgICB5OiAwXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtM1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDU3NixcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24tbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTVcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAxOTIsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMjg4LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDM4NCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS00XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA0ODAsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNTc2LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbjItbC0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA2NzIsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDc2OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtM1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogODY0LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbjItbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbjItbC01XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNzY4LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtNlwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtOFwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHRpbmd1aXNoZXJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDc2OCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NixcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAxOTIsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMjg4LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDM4NCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS02XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA0ODAsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZm9jdXMtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNTc2LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZvY3VzLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDY3MixcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmb2N1cy0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA3NjgsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZm9jdXMtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogODY0LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZvY3VzLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZm9jdXMtNlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDk2XG4gIH0sXG4gIFwiZm9jdXMtN1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImZvY3VzLThcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAyODhcbiAgfSxcbiAgXCJnZW0tYmx1ZS0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4MTYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ibHVlLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDg2NCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWJsdWUtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTEyLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tYmx1ZS00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5NjAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ncmVlbi0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMDA4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWdyZWVuLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMDQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ncmVlbi00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDhcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogOTZcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTQ0XG4gIH0sXG4gIFwiZ2VtLXB1cnBsZS00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDE5MlxuICB9LFxuICBcImdlbS1yZWQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAyNDBcbiAgfSxcbiAgXCJnZW0tcmVkLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMjg4XG4gIH0sXG4gIFwiZ2VtLXJlZC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDMzNlxuICB9LFxuICBcImdlbS1yZWQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJnZW0tc2lsdmVyLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDMyXG4gIH0sXG4gIFwiZ2VtLXNpbHZlci0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDQ4MFxuICB9LFxuICBcImdlbS1zaWx2ZXItM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA1MjhcbiAgfSxcbiAgXCJnZW0tc2lsdmVyLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZ3JlbmFkZS1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA2MjRcbiAgfSxcbiAgXCJncmVuYWRlLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA2NzJcbiAgfSxcbiAgXCJsYXNlci1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDcyMFxuICB9LFxuICBcImxhc2VyLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJudWNsZWFyXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwicm9ja2V0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDgxNlxuICB9LFxuICBcInNtb2tlXCI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiA2MDAsXG4gICAgeTogMTAyNFxuICB9LFxuICBcInRhcmdldFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgsXG4gICAgeTogMTE2OFxuICB9LFxuICBcInRlbGVwb3J0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogODY0XG4gIH0sXG4gIFwidGVsZXBvcnQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA5MTJcbiAgfSxcbiAgXCJ0ZWxlcG9ydC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDk2MFxuICB9LFxuICBcInRlbGVwb3J0LTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTAwOFxuICB9LFxuICBcInRlbGVwb3J0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcInRlbGVwb3J0LTZcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTEwNFxuICB9LFxuICBcInRlbGVwb3J0LTdcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDAsXG4gICAgeTogMTE2OFxuICB9LFxuICBcInZvcnRleC0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNDgwXG4gIH0sXG4gIFwidm9ydGV4LTEwXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwidm9ydGV4LTExXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNjcyXG4gIH0sXG4gIFwidm9ydGV4LTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJ2b3J0ZXgtM1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDg2NFxuICB9LFxuICBcInZvcnRleC00XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcInZvcnRleC01XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJ2b3J0ZXgtNlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMTkyLFxuICAgIHk6IDk2MFxuICB9LFxuICBcInZvcnRleC03XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAyODgsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwidm9ydGV4LThcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDM4NCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJ2b3J0ZXgtOVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNDgwLFxuICAgIHk6IDk2MFxuICB9XG59OyIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcud2VhcG9ucyA9IHtcbiAgZGVmYXVsdDoge1xuICAgIHRpdGxlOiBcIlwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcIlwiLFxuICAgIHNwcml0ZTogXCJcIixcbiAgICBmaXJlX2F1ZGlvOiBcIlwiLFxuICAgIGZpcmVfc3ByaXRlOiBcIlwiLFxuICAgIGZpcmVfYm9keV9zcHJpdGU6IFwiXCIsXG4gICAgZmlyZV9hbmdsZV9sb2NrOiBmYWxzZSxcbiAgICBhdXRvX2ZvbGxvdzogZmFsc2UsXG4gICAgcmVxdWlyZV93YWxrOiBmYWxzZSxcbiAgICBzcGVlZDogMCxcbiAgICBvYmplY3Q6IFwiXCIsXG4gICAgY29vbGRvd246IDAsXG4gICAgcmVjb2lsOiAwLFxuICAgIGluZXJ0aWE6IDBcbiAgfSxcbiAgZGlnOiB7XG4gICAgdGl0bGU6IFwiRGlnXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiYXJtb3VyeS1kaWdcIixcbiAgICBzcHJpdGU6IFwiZGlnXCIsXG4gICAgZmlyZV9zcHJpdGU6IFwiZGlnLWZpcmVcIixcbiAgICBmaXJlX2JvZHlfc3ByaXRlOiBcIndhbGtcIixcbiAgICBmaXJlX2FuZ2xlX2xvY2s6IHRydWUsXG4gICAgc3BlZWQ6IDMsXG4gICAgb2JqZWN0OiBcImRpZ1wiLFxuICAgIGNvb2xkb3duOiAxMFxuICB9LFxuICBwaGFzZXI6IHtcbiAgICB0aXRsZTogXCJQaGFzZXJcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJhcm1vdXJ5LWxhc2VyLWJsdWVcIixcbiAgICBzcHJpdGU6IFwibGFzZXJcIixcbiAgICBmaXJlX2F1ZGlvOiBcInNob290X2xhc2VyXCIsXG4gICAgc3BlZWQ6IDMwLFxuICAgIG9iamVjdDogXCJsYXNlclwiLFxuICAgIGNvb2xkb3duOiA2LFxuICAgIHJlY29pbDogMC4xLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBiYXpvb2tvaWQ6IHtcbiAgICB0aXRsZTogXCJCYXpvb2tvaWRcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJiYXpvb2thLXNoZWxsXCIsXG4gICAgc3ByaXRlOiBcImJhem9va2FcIixcbiAgICBmaXJlX2F1ZGlvOiBcInNob290XCIsXG4gICAgYXV0b19mb2xsb3c6IHRydWUsXG4gICAgc3BlZWQ6IDI0LFxuICAgIG9iamVjdDogXCJiYXpvb2thXCIsXG4gICAgY29vbGRvd246IDQwLFxuICAgIHJlY29pbDogMC4yLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBncmVuYWRlOiB7XG4gICAgdGl0bGU6IFwiR3JlbmFkZVwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBzcHJpdGU6IFwidGhyb3dcIixcbiAgICBmaXJlX2F1ZGlvOiBcInRocm93XCIsXG4gICAgZmlyZV9zcHJpdGU6IFwidGhyb3ctZmlyZVwiLFxuICAgIGF1dG9fZm9sbG93OiB0cnVlLFxuICAgIHNwZWVkOiAyNCxcbiAgICBvYmplY3Q6IFwiZ3JlbmFkZVwiLFxuICAgIGNvb2xkb3duOiAzMCxcbiAgICByZWNvaWw6IDAsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIHB1bmNoOiB7XG4gICAgdGl0bGU6IFwiRmlyZSBQdW5jaFwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImFybW91cnktcHVuY2hcIixcbiAgICBzcHJpdGU6IFwicHVuY2hcIixcbiAgICBmaXJlX2F1ZGlvOiBcInRocm93XCIsXG4gICAgZmlyZV9ib2R5X3Nwcml0ZTogXCJzdXBlcm1hblwiLFxuICAgIHNwZWVkOiAxNCxcbiAgICBvYmplY3Q6IFwicHVuY2hcIixcbiAgICBjb29sZG93bjogMzAsXG4gICAgcmVjb2lsOiAwLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBwdW1wa2luOiB7XG4gICAgdGl0bGU6IFwiUHVtcGtpblwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcInB1bXBraW5cIixcbiAgICBzcHJpdGU6IFwidGhyb3dcIixcbiAgICBmaXJlX2F1ZGlvOiBcInRocm93XCIsXG4gICAgZmlyZV9zcHJpdGU6IFwidGhyb3ctZmlyZVwiLFxuICAgIGF1dG9fZm9sbG93OiB0cnVlLFxuICAgIHNwZWVkOiAzMCxcbiAgICBvYmplY3Q6IFwicHVtcGtpblwiLFxuICAgIGNvb2xkb3duOiA0OCxcbiAgICByZWNvaWw6IDAsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIHBhaW5naXZlcjoge1xuICAgIHRpdGxlOiBcIlBhaW5naXZlciAyMDAwXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwicm9ja2V0XCIsXG4gICAgc3ByaXRlOiBcImJhem9va2FcIixcbiAgICBmaXJlX2F1ZGlvOiBcInNob290XCIsXG4gICAgc3BlZWQ6IDI0LFxuICAgIG9iamVjdDogXCJwYWluZ2l2ZXJcIixcbiAgICBjb29sZG93bjogMTAsXG4gICAgcmVjb2lsOiAwLjQsXG4gICAgaW5lcnRpYTogMC41XG4gIH1cbn07XG5cbi8vIHByZXAgd2VhcG9uc1xuZm9yIChrZXkgaW4gY29uZmlnLndlYXBvbnMpIHtcbiAgY29uZmlnLndlYXBvbnNba2V5XSA9IGRlZXBtZXJnZShjb25maWcud2VhcG9ucy5kZWZhdWx0LCBjb25maWcud2VhcG9uc1trZXldLCB7XG4gICAgYXJyYXlNZXJnZTogZG9udF9tZXJnZVxuICB9KTtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFjdGlvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBQZXJmb3JtIGFjdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbiA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgYWN0aW9uKSB7XG4gIHZhciByZXNwb25zZSA9IHsgc3VjY2VzczogZmFsc2UgfTtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICB2YXIgb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIgfHwgIWFjdGlvbiB8fCAhb2JqKSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgdmFyIGxvY2tlZF9vYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbcGxheWVyLmxvY2tlZF07XG5cbiAgLy8gcGxheWVycyBjYW4gZG8gc3R1ZmZcbiAgaWYgKCFwbGF5ZXIuZGVhZCAmJiAhbG9ja2VkX29iaiAmJiBwbGF5ZXIuaGl0ID09PSAwKSB7XG4gICAgLy8gcnVuIHRoZW1cbiAgICBpZiAoYWN0aW9uLmFjdGlvbiA9PT0gXCJtb3ZlXCIpIHtcbiAgICAgIHJlc3BvbnNlID0gdGhpcy5hY3Rpb25fbW92ZShyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbik7XG4gICAgfVxuICAgIGlmIChhY3Rpb24uYWN0aW9uID09PSBcImp1bXBcIikge1xuICAgICAgcmVzcG9uc2UgPSB0aGlzLmFjdGlvbl9qdW1wKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKTtcbiAgICB9XG4gICAgaWYgKGFjdGlvbi5hY3Rpb24gPT09IFwic2hvb3RcIikge1xuICAgICAgcmVzcG9uc2UgPSB0aGlzLmFjdGlvbl9zaG9vdChyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgcmVzcG9uc2UueCA9IG9iai54O1xuICByZXNwb25zZS55ID0gb2JqLnk7XG4gIHJlc3BvbnNlLnNwZWVkX3ggPSBvYmouc3BlZWRfeDtcbiAgcmVzcG9uc2Uuc3BlZWRfeSA9IG9iai5zcGVlZF95O1xuICByZXNwb25zZS5mcmFtZSA9IHRoaXMuc3RhdGUuZnJhbWU7XG5cbiAgLy8gcmV0dXJuIHN0YXR1c1xuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKiBXYWxraW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX21vdmUgPSBmdW5jdGlvbihyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbikge1xuICByZXNwb25zZS50eXBlID0gXCJ3YWxrXCI7XG5cbiAgaWYgKG9iai5ncm91bmRlZCkge1xuICAgIHZhciBzcGVlZCA9IHRoaXMuc2NoZW1lLmxldmVscy5zcGVlZFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLm1vdmU7XG4gICAgdmFyIHNwZWVkID0gYWN0aW9uLnNwZWVkIHx8IHNwZWVkO1xuICAgIHZhciB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgYWN0aW9uLmFuZ2xlLCBzcGVlZCk7XG4gICAgaWYgKHdhbGsubW92ZSkge1xuICAgICAgaWYgKHRoaXMuYWN0aW9uX3dhbGtfbW92ZShvYmosIHdhbGsucGF0aCkpIHtcbiAgICAgICAgLy8gcmVjb3JkIHBsYXllciBldmVudFxuICAgICAgICBwbGF5ZXIuZXZlbnRzLnB1c2goeyBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSwgdHlwZTogXCJ3YWxrXCIgfSk7XG5cbiAgICAgICAgLy8gcmV0dXJuIHN1Y2Nlc3NcbiAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogV2Fsa2luZyBpbiBhIGRpcmVjdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbl93YWxrX2RpciA9IGZ1bmN0aW9uKG9iaiwgZGlyLCBzcGVlZCkge1xuICB2YXIgc3BlZWQgPSBzcGVlZCB8fCBvYmouYy5zcGVlZC5tb3ZlO1xuXG4gIC8vIGdldCBpbml0aWFsIHBhdGhcbiAgdmFyIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCAwLCBzcGVlZCk7XG5cbiAgaWYgKHdhbGsuZGlyZWN0aW9uICE9IGRpcikge1xuICAgIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCAxODAsIHNwZWVkKTtcbiAgICBpZiAod2Fsay5kaXJlY3Rpb24gIT0gZGlyKSB7XG4gICAgICB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgOTAsIHNwZWVkKTtcbiAgICAgIGlmICh3YWxrLmRpcmVjdGlvbiAhPSBkaXIpIHtcbiAgICAgICAgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIDI3MCwgc3BlZWQpO1xuICAgICAgICBpZiAod2Fsay5kaXJlY3Rpb24gIT0gZGlyKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmICghd2Fsay5tb3ZlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5hY3Rpb25fd2Fsa19tb3ZlKG9iaiwgd2Fsay5wYXRoKTtcbn07XG5cbi8qIFdhbGsgbW92aW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX3dhbGtfbW92ZSA9IGZ1bmN0aW9uKG9iaiwgcGF0aCkge1xuICAvLyBnbyB0aHJvdWdoIHRoZSBjb3Vyc2VcbiAgdmFyIHgxID0gb2JqLng7XG4gIHZhciB5MSA9IG9iai55O1xuICBmb3IgKHZhciBpID0gMTsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcG9pbnQgPSBwYXRoW2ldO1xuXG4gICAgLy8gY2hlY2sgb2JqZWN0IGNvbGxpc2lvbnNcbiAgICB2YXIgY29sID0gdGhpcy5jb2xsaXNpb25zKG9iaiwgcG9pbnQueCwgcG9pbnQueSk7XG4gICAgaWYgKGNvbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIG9iai54ID0gcG9pbnQueDtcbiAgICBvYmoueSA9IHBvaW50Lnk7XG4gICAgb2JqLm1vdmVkID0gdHJ1ZTtcbiAgfVxuXG4gIGlmIChvYmoubW92ZWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufTtcblxuLyogSnVtcGluZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbl9qdW1wID0gZnVuY3Rpb24ocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pIHtcbiAgcmVzcG9uc2UudHlwZSA9IFwianVtcFwiO1xuXG4gIGlmIChvYmouZ3JvdW5kZWQgJiYgcGxheWVyLmNvb2xkb3duID09PSAwKSB7XG4gICAgdmFyIHNwZWVkID0gdGhpcy5zY2hlbWUubGV2ZWxzLmp1bXBbcGxheWVyLmxldmVsXSB8fCBvYmouYy5zcGVlZC5qdW1wO1xuICAgIHZhciB4eSA9IHh5X3NwZWVkKGFjdGlvbi5hbmdsZSwgc3BlZWQpO1xuICAgIG9iai5zcGVlZF94ID0geHkueC5maXhlZCgpO1xuICAgIG9iai5zcGVlZF95ID0geHkueS5maXhlZCgpO1xuICAgIGlmICh0aGlzLnBoeXNpY3NfbW92ZShvYmopKSB7XG4gICAgICAvLyBzZXQgZ3JvdW5kaW5nXG4gICAgICBvYmouZ3JvdW5kZWQgPSBmYWxzZTtcblxuICAgICAgLy8gc2V0IGNvb2xkb3duXG4gICAgICBwbGF5ZXIuY29vbGRvd24gPSA3O1xuXG4gICAgICAvLyByZWNvcmQgcGxheWVyIGV2ZW50XG4gICAgICBwbGF5ZXIuZXZlbnRzLnB1c2goeyBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSwgdHlwZTogXCJqdW1wXCIgfSk7XG5cbiAgICAgIC8vIHJldHVybiBzdWNjZXNzXG4gICAgICByZXNwb25zZS5zdWNjZXNzID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKiBTaG9vdGluZyB3ZWFwb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fc2hvb3QgPSBmdW5jdGlvbihyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbikge1xuICByZXNwb25zZS50eXBlID0gXCJzaG9vdFwiO1xuXG4gIC8vIGlmIHdhaXRpbmcgZm9yIGNvb2xkb3duXG4gIC8vIGlzIG5vdCByZWFsIHdlYXBvblxuICAvLyBkbyB3ZSBuZWVkIHRvIHdhbGtcbiAgLy8gY2hlY2sgYXJtb3VyeSBjb3VudFxuICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbYWN0aW9uLndlYXBvbl07XG4gIGlmIChcbiAgICAocGxheWVyLmNvb2xkb3duID09PSAwICYmICF3ZWFwb24pIHx8XG4gICAgKHdlYXBvbi5yZXF1aXJlX3dhbGsgJiYgIW9iai5ncm91bmRlZCkgfHxcbiAgICBwbGF5ZXIuYXJtb3VyeVthY3Rpb24ud2VhcG9uXSA9PT0gMFxuICApIHtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICAvLyBjcmF0ZSB0aGUgb2JqZWN0XG4gIHZhciBzcGVlZCA9IHh5X3NwZWVkKGFjdGlvbi5hbmdsZSwgd2VhcG9uLnNwZWVkKTtcbiAgdmFyIHNob3Rfb2JqID0gdGhpcy5jcmVhdGVfb2JqZWN0KHtcbiAgICB0eXBlOiB3ZWFwb24ub2JqZWN0LFxuICAgIHBsYXllcl9pZDogcGxheWVyLmlkLFxuICAgIHg6IG9iai54LFxuICAgIHk6IG9iai55LFxuICAgIHNwZWVkX3g6IChzcGVlZC54ICsgb2JqLnNwZWVkX3ggKiB3ZWFwb24uaW5lcnRpYSkuZml4ZWQoKSxcbiAgICBzcGVlZF95OiAoc3BlZWQueSArIG9iai5zcGVlZF95ICogd2VhcG9uLmluZXJ0aWEpLmZpeGVkKClcbiAgfSk7XG5cbiAgLy8gc2V0IHBsYXllciByZWNvaWxcbiAgaWYgKCFvYmouZ3JvdW5kZWQpIHtcbiAgICBvYmouc3BlZWRfeCArPSAoLXNwZWVkLnggKiB3ZWFwb24ucmVjb2lsKS5maXhlZCgpO1xuICAgIG9iai5zcGVlZF95ICs9ICgtc3BlZWQueSAqIHdlYXBvbi5yZWNvaWwpLmZpeGVkKCk7XG4gIH1cblxuICAvLyBzZXQgYXJtb3VyeSB2YWx1ZXNcbiAgdGhpcy51cGRhdGVfcGxheWVyX2FybW91cnkocGxheWVyLmlkLCBhY3Rpb24ud2VhcG9uLCAtMSk7XG5cbiAgLy8gc2V0IGNvb2xkb3duXG4gIHBsYXllci5jb29sZG93biA9IHdlYXBvbi5jb29sZG93bjtcblxuICAvLyBzZXQgcGxheWVyIGxvY2tcbiAgaWYgKHNob3Rfb2JqLmMucGxheWVyX2xvY2spIHtcbiAgICBwbGF5ZXIubG9ja2VkID0gc2hvdF9vYmoua2V5O1xuICB9XG5cbiAgLy8gcmVjb3JkIHBsYXllciBldmVudFxuICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgIHR5cGU6IFwic2hvb3RcIixcbiAgICBvYmo6IHNob3Rfb2JqLmtleSxcbiAgICB3ZWFwb246IGFjdGlvbi53ZWFwb25cbiAgfSk7XG5cbiAgLy8gcmV0dXJuIHN1Y2Nlc3NcbiAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gIHJldHVybiByZXNwb25zZTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBDb2xsaXNpb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIHNpbmdsZSBjb2xsaXNpb24gY2hlY2tcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jb2xsaXNpb25zID0gZnVuY3Rpb24ob2JqLCB4LCB5KSB7XG4gIC8vIGNoZWNrIGNvbGxpc2lvbiB3aXRoIGdyb3VuZFxuICBpZiAodGhpcy5tYXAuaShyb3VuZCh4KSwgcm91bmQoeSkpKSB7XG4gICAgdmFyIGV2ZW50ID0gdGhpcy5ldmVudChvYmosIFwiZ3JvdW5kXCIsIG51bGwpO1xuICAgIGlmIChldmVudCkge1xuICAgICAgcmV0dXJuIGV2ZW50O1xuICAgIH1cbiAgfVxuXG4gIC8vIGNoZWNrIGNvbGxpc2lvbnMgd2l0aCBvdGhlciBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLm9iamVjdHMpIHtcbiAgICBpZiAob2JqLmtleSA9PT0ga2V5KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29sbGlzaW9uX29iaihvYmosIHgsIHksIHRoaXMuc3RhdGUub2JqZWN0c1trZXldKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyogUnVuIG9iamVjdCBjb2xsaXNpb24gY2hlY2tcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jb2xsaXNpb25fb2JqID0gZnVuY3Rpb24ob2JqLCB4LCB5LCBjaGVja19vYmopIHtcbiAgLy8gaWYgbm8gY29sbGlzaW9uXG4gIGlmIChcbiAgICB0aGlzLmNvbGxpc2lvbl9jaGVjayhcbiAgICAgIHgsXG4gICAgICB5LFxuICAgICAgY2hlY2tfb2JqLngsXG4gICAgICBjaGVja19vYmoueSxcbiAgICAgIG9iai5jLnNpemUsXG4gICAgICBjaGVja19vYmouYy5zaXplXG4gICAgKVxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBwcmV2ZW50IGhpdHMgb24gcGFyZW50IHBsYXllcnMgZm9yIGEgc2hvcnQgdGltZSBvciBpZiB0aGV5J3JlIHBsYXllciBsb2NrZWRcbiAgaWYgKFxuICAgIGNoZWNrX29iai50eXBlID09PSBcInBsYXllclwiICYmXG4gICAgY2hlY2tfb2JqLnBsYXllcl9pZCA9PT0gb2JqLnBsYXllcl9pZCAmJlxuICAgICh0aGlzLnN0YXRlLmZyYW1lIDwgb2JqLmZyYW1lICsgMTUgfHwgb2JqLmMucGxheWVyX2xvY2spXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHByZXZlbnQgY2x1c3RlcnMgaGl0dGluZyBlYWNoIG90aGVyIGZvciBhIHNob3J0IHRpbWVcbiAgaWYgKFxuICAgIGNoZWNrX29iai5mcmFtZSA9PT0gb2JqLmZyYW1lICYmXG4gICAgY2hlY2tfb2JqLnBsYXllcl9pZCA9PT0gb2JqLnBsYXllcl9pZCAmJlxuICAgIHRoaXMuc3RhdGUuZnJhbWUgPCBvYmouZnJhbWUgKyA2MFxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB0cmlnZ2VyIGJhc2ljIG9iamVjdCBjb2xsaXNpb24gZXZlbnRcbiAgaWYgKHRoaXMuZXZlbnQob2JqLCBcIm9iamVjdFwiLCBjaGVja19vYmopKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyB0cmlnZ2VyIHNwZWNpZmljIG9iamVjdCBjb2xsaXNpb24gZXZlbnRcbiAgdmFyIGV2ZW50ID0gb2JqLmMub2JqZWN0X2V2ZW50c1tjaGVja19vYmoudHlwZV07XG4gIGlmIChldmVudCkge1xuICAgIGlmICh0aGlzLnJ1bl9ldmVudChvYmosIGV2ZW50LCBjaGVja19vYmopKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIENvbGxpc2lvbiBNYXRoc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNvbGxpc2lvbl9jaGVjayA9IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBzMSwgczIpIHtcbiAgcmV0dXJuIHRoaXMubWFwLmdldF9kaXN0YW5jZSh4MSwgeTEsIHgyLCB5MikgPiBzMSArIHMyO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIENvcmVcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBjcmVhdGUgY29yZSBvYmplY3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBjb3JlKGNvbmZpZywgc2NoZW1lLCBtYXAsIGdyYXZpdHlfbWFwKSB7XG4gIC8vIGNvbmZpZ1xuICB0aGlzLmMgPSBjb25maWc7XG4gIHRoaXMuc2NoZW1lID0gc2NoZW1lO1xuICB0aGlzLm1hcCA9IG5ldyBjb3JlX21hcChtYXAsIHNjaGVtZSwgZ3Jhdml0eV9tYXApO1xuXG4gIC8vIGNyYXRlIGNoYW5jZSB0YWJsZVxuICB0aGlzLmNyYXRlX2xpc3QgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc2NoZW1lLndlYXBvbnMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2NoZW1lLndlYXBvbnNba2V5XS5jcmF0ZV9jaGFuY2U7IGkrKykge1xuICAgICAgdGhpcy5jcmF0ZV9saXN0LnB1c2goa2V5KTtcbiAgICB9XG4gIH1cblxuICAvLyBhcm1vdXJ5IHJlZmVyZW5jZSB0YWJsZVxuICB0aGlzLmFybW91cnlfcmVmcyA9IFtdO1xuICBmb3IgKGtleSBpbiB0aGlzLnNjaGVtZS53ZWFwb25zKSB7XG4gICAgdGhpcy5hcm1vdXJ5X3JlZnMucHVzaChrZXkpO1xuICB9XG59XG5cbi8qIFNldCBhIGJsYW5rIHN0YXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYmxhbmtfc3RhdGUgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHtcbiAgICBmcmFtZTogMCxcbiAgICBleHBsb3Npb25zOiB7fSxcbiAgICBvYmplY3RzOiB7fSxcbiAgICBwbGF5ZXJzOiB7fSxcbiAgICBldmVudHM6IFtdXG4gIH07XG59O1xuXG4vKiBSdW4gZXZlcnkgZnJhbWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmZyYW1lX2V4cGxvc2lvbnMoKTtcbiAgdGhpcy5mcmFtZV9wbGF5ZXJzKCk7XG4gIHRoaXMuZnJhbWVfb2JqZWN0cygpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBhIHNwZWNpZmljIHR5cGUgb2YgZXZlbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudCA9IGZ1bmN0aW9uKG9iaiwgdHlwZSwgY29sbGlkZWRfb2JqKSB7XG4gIHZhciBldmVudCA9IG9iai5jLmV2ZW50c1t0eXBlXTtcbiAgaWYgKCFldmVudCkge1xuICAgIHJldHVybjtcbiAgfVxuICByZXR1cm4gdGhpcy5ydW5fZXZlbnQob2JqLCBldmVudCwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbn07XG5cbi8qIFJ1biBhIHNwZWNpZmljIGV2ZW50XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24ob2JqLCBldmVudCwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIC8vIGhhbmRsZSBhcnJheXMgb2YgZXZlbnRzXG4gIGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkge1xuICAgIHZhciBzdG9wID0gZmFsc2U7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHN0b3AyID0gdGhpcy5ydW5fZXZlbnQob2JqLCBldmVudFtpXSwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgICAgIHN0b3AgPSBzdG9wMiA/IHRydWUgOiBzdG9wO1xuICAgIH1cbiAgICByZXR1cm4gc3RvcDtcbiAgfVxuXG4gIC8vIHJ1biBldmVudCBmdW5jdGlvblxuICBpZiAoZXZlbnQgPT09IFwiZGllXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9kaWUob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImtpbGxcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2tpbGwob2JqLCBjb2xsaWRlZF9vYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImV4cGxvZGVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2V4cGxvZGUob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJoaXRfZ2l2ZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfaGl0X2dpdmUob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImhpdF9yZWNlaXZlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9oaXRfcmVjZWl2ZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiZGVzdHJveVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfZGVzdHJveShvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImNsdXN0ZXJcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2NsdXN0ZXIob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJib3VuY2VcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2JvdW5jZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiYm91bmNlX2V4cGxvZGVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2JvdW5jZV9leHBsb2RlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJzdGlja1wiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfc3RpY2sob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJzbGlkZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfc2xpZGUob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJwbGF5ZXJfYm91bmNlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9wbGF5ZXJfYm91bmNlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJkcmFnX3BsYXllclwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfZHJhZ19wbGF5ZXIob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJzcGF3bl9naG9zdFwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfc3Bhd25fZ2hvc3Qob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJjb2xsZWN0XCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9jb2xsZWN0KG9iaiwgY29sbGlkZWRfb2JqKTtcbiAgfVxufTtcblxuLyogT2JqZWN0IGRpZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2RpZSA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIC8vIGRpZSBldmVudFxuICB0aGlzLmV2ZW50KG9iaiwgXCJkaWVcIik7XG5cbiAgLy8gY2hlY2sgZm9yIGRlc3Ryb3kgZXZlbnRzXG4gIGlmICh0aGlzLnNjaGVtZS5ldmVudHMuZGVzdHJveSkge1xuICAgIGlmICh0aGlzLnNjaGVtZS5ldmVudHMuZGVzdHJveVtvYmouaWRdKSB7XG4gICAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHRoaXMuc2NoZW1lLmV2ZW50cy5kZXN0cm95W29iai5pZF0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIGRlbGV0ZSB0aGUgb2JqZWN0XG4gIGRlbGV0ZSB0aGlzLnN0YXRlLm9iamVjdHNbb2JqLmtleV07XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBPYmplY3Qga2lsbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2tpbGwgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaikge1xuICAvLyBkZXN0cm95IGl0XG4gIHRoaXMucnVuX2V2ZW50KGNvbGxpZGVkX29iaiwgXCJkaWVcIik7XG59O1xuXG4vKiBFeHBsb2RlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfZXhwbG9kZSA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBjcmVhdGUgZXhwbG9zaW9uIG9iamVjdFxuICB0aGlzLmNyZWF0ZV9leHBsb3Npb24oe1xuICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICB4OiBvYmoueCxcbiAgICB5OiBvYmoueSxcbiAgICBwYXJlbnQ6IG9iai5rZXksXG4gICAgcGFyZW50X3R5cGU6IG9iai50eXBlXG4gIH0pO1xufTtcblxuLyogR2l2ZSBhIGhpdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2hpdF9naXZlID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KGNvbGxpZGVkX29iaiwgXCJoaXRfcmVjZWl2ZVwiLCBvYmosIHR5cGUpO1xufTtcblxuLyogUmVjZWl2ZSBhIGhpdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2hpdF9yZWNlaXZlID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gcHJldmVudCBpbnN0YW50IGhpdHNcbiAgaWYgKG9iai5oaXRzKSB7XG4gICAgZm9yICh2YXIga2V5IGluIG9iai5oaXRzKSB7XG4gICAgICBpZiAoa2V5ID09PSBjb2xsaWRlZF9vYmoua2V5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgZGlyZWN0aW9uIGFuZCBkaXN0YW5jZSBpdCBjYW1lIGZyb21cbiAgdmFyIGFuZ2xlID0gdGhpcy5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgY29sbGlkZWRfb2JqLngsXG4gICAgY29sbGlkZWRfb2JqLnlcbiAgKTtcbiAgdmFyIGRpc3RhbmNlID0gdGhpcy5tYXAuZ2V0X2Rpc3RhbmNlKFxuICAgIG9iai54LFxuICAgIG9iai55LFxuICAgIGNvbGxpZGVkX29iai54LFxuICAgIGNvbGxpZGVkX29iai55XG4gICk7XG5cbiAgLy8gZ2V0IGRhbWFnZSB2YWx1ZXMgZnJvbSBjb2xsaWRlZCBvYmplY3RcbiAgdmFyIGRhbWFnZSA9IHRoaXMuZ2V0X2RhbWFnZShjb2xsaWRlZF9vYmopO1xuICB2YXIga25vY2sgPSBjb2xsaWRlZF9vYmouYy5rbm9jaztcbiAgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImV4cGxvc2lvblwiKSB7XG4gICAgZGFtYWdlICo9IG1heCgwLCAoZGFtYWdlICogMiAtIGRpc3RhbmNlKSAvIChkYW1hZ2UgKiAyKSk7XG4gIH1cblxuICAvLyBpZ25vcmUgaWYgdGhlcmUncyBubyBkYW1hZ2VcbiAgaWYgKGRhbWFnZSA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGtub2NrIG9iamVjdFxuICBpZiAoa25vY2sgPiAwKSB7XG4gICAgdmFyIHh5ID0geHlfc3BlZWQoYW5nbGUsIGRhbWFnZSk7XG4gICAgb2JqLnNwZWVkX3ggLT0geHkueC5maXhlZCgpO1xuICAgIG9iai5zcGVlZF95IC09IHh5LnkuZml4ZWQoKTtcbiAgICBvYmouZ3JvdW5kZWQgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIGFyZSB3ZSBoaXR0aW5nIHBsYXllclxuICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIpIHtcbiAgICB0aGlzLnBsYXllcl9oZWFsdGhfYWRkKG9iai5wbGF5ZXJfaWQsIC1yb3VuZChkYW1hZ2UpKTtcbiAgICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICAgIGlmIChwbGF5ZXIpIHtcbiAgICAgIHBsYXllci5oaXQgPSBkYW1hZ2UgKiAyO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNvdW5kIGVmZmVjdFxuICBpZiAoY29sbGlkZWRfb2JqLmMuYXVkaW8uaGl0KSB7XG4gICAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgICB0eXBlOiBcInNvdW5kXCIsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgc291bmQ6IGNvbGxpZGVkX29iai5jLmF1ZGlvLmhpdFxuICAgIH0pO1xuICB9XG5cbiAgLy8gc2V0IGhpdHNcbiAgaWYgKCFvYmouaGl0cykge1xuICAgIG9iai5oaXRzID0ge307XG4gIH1cbiAgb2JqLmhpdHNbY29sbGlkZWRfb2JqLmtleV0gPSB0cnVlO1xufTtcblxuLyogRGVzdHJveSBncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9kZXN0cm95ID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGxpbWl0IHRvIG9uY2UgcGVyIGZyYW1lXG4gIGlmIChvYmouZGVzdHJveWVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIG9iai5kZXN0cm95ZWQgPSB0cnVlO1xuXG4gIHZhciBkYW1hZ2UgPSB0aGlzLmdldF9kYW1hZ2Uob2JqKTtcblxuICAvLyByZWNvcmQgZ3JvdW5kIGRhbWFnZVxuICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICB0eXBlOiBcImdyb3VuZF9kYW1hZ2VcIixcbiAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICBkaWc6IHRydWUsXG4gICAgeDogb2JqLngsXG4gICAgeTogb2JqLnksXG4gICAgcmFkaXVzOiBkYW1hZ2VcbiAgfSk7XG59O1xuXG4vKiBPYmplY3QgYm91bmNlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfYm91bmNlID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gaWYgZ3JvdW5kZWQgZG9udCBkbyBhbnl0aGluZ1xuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBjaGVjayBzcGVlZFxuICB2YXIgc3BlZWQgPSBnZXRfc3BlZWQob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgdmFyIGNoZWNrX3NwZWVkID0gc3BlZWQgKiBvYmouYy5ib3VuY2U7XG4gIGlmIChjaGVja19zcGVlZCA8IDEpIHtcbiAgICBvYmouc3BlZWRfeCA9IDA7XG4gICAgb2JqLnNwZWVkX3kgPSAwO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gZ2V0IG5ldyBkaXJlY3Rpb24gYW5nbGVcbiAgdmFyIGRpcmVjdGlvbiA9IGdldF9hbmdsZShvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICB2YXIgc3VyZmFjZV9hbmdsZSA9IDA7XG5cbiAgLy8gZ2V0IGFuZ2xlIGZyb20gZ3JvdW5kXG4gIGlmICh0eXBlID09PSBcImdyb3VuZFwiKSB7XG4gICAgdmFyIHdhbGsgPSB0aGlzLm1hcC53YWxrKHJvdW5kKG9iai54KSwgcm91bmQob2JqLnkpLCAwLCAwLCBkaXJlY3Rpb24sIDYpO1xuICAgIGlmICh3YWxrLm1vdmUpIHtcbiAgICAgIHN1cmZhY2VfYW5nbGUgPSB3YWxrLmFuZ2xlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGdldCBhbmdsZSBmcm9tIG9iamVjdFxuICBlbHNlIHtcbiAgICB2YXIgaGVhZGluZyA9IHRoaXMubWFwLmdldF9oZWFkaW5nKFxuICAgICAgb2JqLngsXG4gICAgICBvYmoueSxcbiAgICAgIGNvbGxpZGVkX29iai54LFxuICAgICAgY29sbGlkZWRfb2JqLnlcbiAgICApO1xuICAgIHN1cmZhY2VfYW5nbGUgPSBhbmdsZV9hZGQoaGVhZGluZywgOTApO1xuICB9XG5cbiAgLy8gcmVmbGVjdCBkaXJlY3Rpb24gYW5nbGUgd2l0aCBjb2xsaXNpb24gYW5nbGVcbiAgdmFyIHJlZmxlY3Rpb24gPSAoZGlyZWN0aW9uIC0gc3VyZmFjZV9hbmdsZSkgKiAyO1xuICB2YXIgbmV3X2FuZ2xlID0gYW5nbGVfYWRkKGRpcmVjdGlvbiwgLXJlZmxlY3Rpb24pO1xuXG4gIC8vIHRyYW5zZm9ybSBtYWluIHZlbG9jaXR5IHRvd2FyZHMgbmV3IGFuZ2xlXG4gIHZhciBuZXdfc3BlZWQgPSB4eV9zcGVlZChuZXdfYW5nbGUsIGNoZWNrX3NwZWVkKTtcbiAgb2JqLnNwZWVkX3ggPSBuZXdfc3BlZWQueC5maXhlZCgpO1xuICBvYmouc3BlZWRfeSA9IG5ld19zcGVlZC55LmZpeGVkKCk7XG5cbiAgLy8gcmVjb3JkIGJvdW5jZSBldmVudFxuICBpZiAoc3BlZWQgPiAyKSB7XG4gICAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgICB0eXBlOiBcImJvdW5jZVwiLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIG9iajogb2JqLmtleVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBPYmplY3Qgc3RpY2sgdG8gZ3JvdW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfc3RpY2sgPSBmdW5jdGlvbihvYmopIHtcbiAgb2JqLmdyb3VuZGVkID0gdHJ1ZTtcbiAgb2JqLnNwZWVkX3ggPSAwO1xuICBvYmouc3BlZWRfeSA9IDA7XG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogT2JqZWN0IHNsaWRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfc2xpZGUgPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIGFuZ2xlID0gZ2V0X2FuZ2xlKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gIHZhciB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgYW5nbGUsIG9iai5zcGVlZF9sZWZ0KTtcbiAgaWYgKHdhbGsubW92ZSkge1xuICAgIHRoaXMuYWN0aW9uX3dhbGtfbW92ZShvYmosIHdhbGsucGF0aCk7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBQbGF5ZXIgYm91bmNlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfcGxheWVyX2JvdW5jZSA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIC8vIGlmIGdyb3VuZGVkIGRvbnQgZG8gYW55dGhpbmdcbiAgaWYgKG9iai5ncm91bmRlZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHNwZWVkID0gZ2V0X3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG5cbiAgdmFyIG1heF9zcGVlZCA9IHRoaXMuc2NoZW1lLmxldmVscy5qdW1wW3BsYXllci5sZXZlbF0gfHwgMDtcbiAgbWF4X3NwZWVkICs9IDEwO1xuICBpZiAocGxheWVyLmhpdCA+IDAgfHwgc3BlZWQgPiBtYXhfc3BlZWQpIHtcbiAgICByZXR1cm4gdGhpcy5ydW5fZXZlbnQob2JqLCBcImJvdW5jZVwiLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIFwic3RpY2tcIik7XG4gIH1cbn07XG5cbi8qIERyYWcgcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfZHJhZ19wbGF5ZXIgPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIHBsYXllcl9vYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBvYmoucGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXJfb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcGxheWVyX29iai5zcGVlZF94ID0gb2JqLnNwZWVkX3g7XG4gIHBsYXllcl9vYmouc3BlZWRfeSA9IG9iai5zcGVlZF95O1xuICBwbGF5ZXJfb2JqLmRyYWdnZWQgPSB0cnVlO1xufTtcblxuLyogRmlyc3QgRGVzdHJveVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2JvdW5jZV9leHBsb2RlID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgaWYgKG9iai5mcmFtZSArIDEwID4gdGhpcy5zdGF0ZS5mcmFtZSkge1xuICAgIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIFwiYm91bmNlXCIsIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJleHBsb2RlXCIpO1xuICB9XG59O1xuXG4vKiBTcGF3biBwbGF5ZXIgZ2hvc3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9zcGF3bl9naG9zdCA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyB0cmFuc2Zvcm0gb2JqZWN0IGludG8gZ2hvc3RcbiAgb2JqLnR5cGUgPSBcInBsYXllcl9naG9zdFwiO1xuICBvYmouYyA9IHRoaXMuYy5vYmplY3RzW1wicGxheWVyX2dob3N0XCJdO1xuICBvYmouc3BlZWRfeCA9IDA7XG4gIG9iai5zcGVlZF95ID0gMDtcbn07XG5cbi8qIENsdXN0ZXJzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfY2x1c3RlciA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBzZXQgb2ZmIGV4cGxvc2lvbnNcbiAgdGhpcy5ydW5fZXZlbnQob2JqLCBcImV4cGxvZGVcIik7XG5cbiAgLy8gZ2V0IGNsdXN0ZXIgY29uc3RhbnRzXG4gIHZhciBjbHVzdGVyID0gb2JqLmMuY2x1c3RlcjtcblxuICAvLyBnZXQgb3Bwb3NpdGUgYW5nbGUgb2YgZ3Jhdml0eVxuICB2YXIgYW5nbGUgPSB0aGlzLm1hcC5nZXRfZ3Jhdml0eV9hbmdsZShvYmoueCwgb2JqLnkpO1xuICBhbmdsZSA9IGFuZ2xlX2FkZChhbmdsZSwgMTM1KTtcblxuICAvLyBnbyB0aHJvdWdoIGNsdXN0ZXJzXG4gIHZhciByYW5nZSA9IGNsdXN0ZXIuY2lyY2xlID8gMzYwIC0gMzYwIC8gY2x1c3Rlci5jb3VudCA6IDkwO1xuICB2YXIgYW5nbGVfZGlmZiA9IHJhbmdlIC8gKGNsdXN0ZXIuY291bnQgLSAxKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbHVzdGVyLmNvdW50OyBpKyspIHtcbiAgICAvLyBjcmVhdGUgY2x1c3RlciBvYmplY3RzXG4gICAgdmFyIGxhdW5jaF9hbmdsZSA9IGFuZ2xlX2FkZChhbmdsZSwgaSAqIGFuZ2xlX2RpZmYpO1xuICAgIHZhciBzcGVlZCA9IHh5X3NwZWVkKGxhdW5jaF9hbmdsZSwgY2x1c3Rlci5zcGVlZCk7XG5cbiAgICAvLyBjcmVhdGUgY2x1c3RlciBvYmplY3RcbiAgICB0aGlzLmNyZWF0ZV9vYmplY3Qoe1xuICAgICAgdHlwZTogY2x1c3Rlci5vYmplY3QsXG4gICAgICBpZDogb2JqLmlkLFxuICAgICAgZGF0YTogaSArIDEsXG4gICAgICBwbGF5ZXJfaWQ6IG9iai5wbGF5ZXJfaWQsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgc3BlZWRfeDogc3BlZWQueC5maXhlZCgpLFxuICAgICAgc3BlZWRfeTogc3BlZWQueS5maXhlZCgpXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIENvbGxlY3QgQ3JhdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9jb2xsZWN0ID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmopIHtcbiAgLy8gcHJlcCBldmVudCB0byBzZW5kIHRvIGdhbWVcbiAgdmFyIGV2ZW50ID0ge1xuICAgIHR5cGU6IFwiY29sbGVjdFwiLFxuICAgIG9iajogY29sbGlkZWRfb2JqLmtleSxcbiAgICBwbGF5ZXJfaWQ6IG9iai5wbGF5ZXJfaWRcbiAgfTtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjcmF0ZVxuICBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiY3JhdGVcIikge1xuICAgIHZhciBjb3VudCA9IHRoaXMuc2NoZW1lLndlYXBvbnNbY29sbGlkZWRfb2JqLmRhdGFdLmNyYXRlX2NvdW50O1xuICAgIGNvdW50ID0gY291bnQgPT09IC0xID8gXCJpbmZpbml0ZVwiIDogY291bnQ7XG4gICAgdGhpcy51cGRhdGVfcGxheWVyX2FybW91cnkob2JqLnBsYXllcl9pZCwgY29sbGlkZWRfb2JqLmRhdGEsIGNvdW50KTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcImNyYXRlXCI7XG4gICAgZXZlbnQud2VhcG9uID0gY29sbGlkZWRfb2JqLmRhdGE7XG4gICAgZXZlbnQuY291bnQgPSBjb3VudDtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImNyYXRlXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIG1lZHBhY2tcbiAgZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwibWVkcGFja1wiKSB7XG4gICAgdGhpcy5wbGF5ZXJfaGVhbHRoX2FkZChvYmoucGxheWVyX2lkLCB0aGlzLnNjaGVtZS5kcm9wcy5tZWRwYWNrLmFkZCk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJtZWRwYWNrXCI7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJtZWRwYWNrXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGdlbXNcbiAgZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZ2VtLTFcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCAxKTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcImdlbVwiO1xuICAgIGV2ZW50Lm4gPSAxO1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiZ2VtXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tNVwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfc2NvcmVfYWRkKG9iai5wbGF5ZXJfaWQsIDUpO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDU7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS0yMFwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfc2NvcmVfYWRkKG9iai5wbGF5ZXJfaWQsIDIwKTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcImdlbVwiO1xuICAgIGV2ZW50Lm4gPSAyMDtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZ2VtLTUwXCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgNTApO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDUwO1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiZ2VtXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tMjAwXCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgMjAwKTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcImdlbVwiO1xuICAgIGV2ZW50Lm4gPSAyMDA7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9XG5cbiAgLy8gcmVjb3JkIGV2ZW50XG4gIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goZXZlbnQpO1xuXG4gIC8vIGtpbGwgb2JqZWN0XG4gIHRoaXMucnVuX2V2ZW50KGNvbGxpZGVkX29iaiwgXCJkaWVcIiwgb2JqLCBcImNvbGxlY3RcIik7XG5cbiAgLy8gY2hlY2sgZm9yIGNvbGxlY3Rpb24gZXZlbnRzXG4gIGlmICh0aGlzLnNjaGVtZS5ldmVudHMuY29sbGVjdCkge1xuICAgIGlmICh0aGlzLnNjaGVtZS5ldmVudHMuY29sbGVjdFtjb2xsaWRlZF9vYmouaWRdKSB7XG4gICAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHRoaXMuc2NoZW1lLmV2ZW50cy5jb2xsZWN0W2NvbGxpZGVkX29iai5pZF0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBFeHBsb3Npb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ3JlYXRlIGFuIGV4cGxvc2lvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNyZWF0ZV9leHBsb3Npb24gPSBmdW5jdGlvbihwcm9wcywgc3RhdGUpIHtcbiAgdmFyIHN0YXRlX3JlZiA9IHN0YXRlIHx8IHRoaXMuc3RhdGU7XG5cbiAgdmFyIG9iaiA9IHtcbiAgICB0eXBlOiBcImV4cGxvc2lvblwiLFxuICAgIHBsYXllcl9pZDogXCJcIixcbiAgICBmcmFtZTogc3RhdGVfcmVmLmZyYW1lLFxuICAgIHg6IDAsXG4gICAgeTogMCxcbiAgICBwYXJlbnQ6IFwiXCIsXG4gICAgcGFyZW50X3R5cGU6IFwiXCJcbiAgfTtcbiAgb2JqID0gZGVlcG1lcmdlKG9iaiwgcHJvcHMpO1xuICBvYmouYyA9IHRoaXMuYy5vYmplY3RzW29iai5wYXJlbnRfdHlwZV07XG5cbiAgLy8gYWRkIHRvIHN0YXRlIG9iamVjdHNcbiAgc3RhdGVfcmVmLmV4cGxvc2lvbnNbb2JqLnBhcmVudF0gPSBvYmo7XG59O1xuXG4vKiBDaGVjayBhbGwgZXhpc3RpbmcgZXhwbG9zaW9uc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmZyYW1lX2V4cGxvc2lvbnMgPSBmdW5jdGlvbigpIHtcbiAgLy8gZ28gdGhyb3VnaCBhbGwgZXhwbG9zaW9uc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zdGF0ZS5leHBsb3Npb25zKSB7XG4gICAgdmFyIGV4cGxvZGUgPSB0aGlzLnN0YXRlLmV4cGxvc2lvbnNba2V5XTtcblxuICAgIC8vIGlmIGV4cGlyZWQgcmVtb3ZlXG4gICAgaWYgKHRoaXMuc3RhdGUuZnJhbWUgPiBleHBsb2RlLmZyYW1lICsgNDApIHtcbiAgICAgIGRlbGV0ZSB0aGlzLnN0YXRlLmV4cGxvc2lvbnNba2V5XTtcbiAgICB9XG5cbiAgICAvLyBpZiBleHBsb2RpbmcgdGhpcyBmcmFtZSBydW5cbiAgICBpZiAodGhpcy5zdGF0ZS5mcmFtZSA9PT0gZXhwbG9kZS5mcmFtZSArIDEpIHtcbiAgICAgIHRoaXMucnVuX2V4cGxvc2lvbihleHBsb2RlKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFJ1biBhbiBleHBsb3Npb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ydW5fZXhwbG9zaW9uID0gZnVuY3Rpb24oZXhwbG9kZSkge1xuICAvLyBpZiBubyBkYW1hZ2VcbiAgaWYgKCFleHBsb2RlLmMuZGFtYWdlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY2FsY3VsYXRlIGFkZGl0aW9uYWwgcGxheWVyIGRhbWFnZVxuICB2YXIgZGFtYWdlID0gdGhpcy5nZXRfZGFtYWdlKGV4cGxvZGUpO1xuXG4gIC8vIGNoZWNrIGNvbGxpc2lvbnNcbiAgZm9yIChrZXkgaW4gdGhpcy5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1trZXldO1xuXG4gICAgLy8gaWYgb2JqZWN0IHdhcyBqdXN0IG1hZGVcbiAgICBpZiAodGhpcy5zdGF0ZS5mcmFtZSA8IG9iai5mcmFtZSArIDIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIHJ1biBjb2xsaXNpb24gY2hlY2tcbiAgICBpZiAoXG4gICAgICAhdGhpcy5jb2xsaXNpb25fY2hlY2soXG4gICAgICAgIG9iai54LFxuICAgICAgICBvYmoueSxcbiAgICAgICAgZXhwbG9kZS54LFxuICAgICAgICBleHBsb2RlLnksXG4gICAgICAgIG9iai5jLnNpemUsXG4gICAgICAgIGRhbWFnZSAqIDJcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHRoaXMuZXZlbnQob2JqLCBcImV4cGxvc2lvblwiLCBleHBsb2RlKTtcbiAgICB9XG4gIH1cblxuICAvLyByZWNvcmQgZ3JvdW5kIGRhbWFnZVxuICB2YXIgcHR5cGUgPSB0aGlzLmMub2JqZWN0c1tleHBsb2RlLnBhcmVudF90eXBlXTtcbiAgaWYgKHB0eXBlICYmIHB0eXBlLmRlc3Ryb3lfZ3JvdW5kKSB7XG4gICAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgICB0eXBlOiBcImdyb3VuZF9kYW1hZ2VcIixcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgeDogZXhwbG9kZS54LFxuICAgICAgeTogZXhwbG9kZS55LFxuICAgICAgcmFkaXVzOiBkYW1hZ2VcbiAgICB9KTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE9iamVjdHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDcmVhdGUgYSBuZXcgZ2FtZSBvYmplY3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jcmVhdGVfb2JqZWN0ID0gZnVuY3Rpb24ocHJvcHMsIHN0YXRlKSB7XG4gIHZhciBzdGF0ZV9yZWYgPSBzdGF0ZSB8fCB0aGlzLnN0YXRlO1xuXG4gIHZhciBvYmogPSB7XG4gICAgdHlwZTogXCJcIixcbiAgICBwbGF5ZXJfaWQ6IFwiXCIsXG4gICAgaWQ6IFwiXCIsXG4gICAgZnJhbWU6IHN0YXRlX3JlZi5mcmFtZSxcbiAgICBncm91bmRlZDogZmFsc2UsXG4gICAgeDogMCxcbiAgICB5OiAwLFxuICAgIHNwZWVkX3g6IDAsXG4gICAgc3BlZWRfeTogMCxcbiAgICBkYXRhOiBcIlwiXG4gIH07XG4gIG9iaiA9IGRlZXBtZXJnZShvYmosIHByb3BzKTtcbiAgb2JqLmMgPSB0aGlzLmMub2JqZWN0c1tvYmoudHlwZV07XG4gIHZhciBrZXlfdHlwZSA9IG9iai50eXBlO1xuXG4gIC8vIHNldCBrZXlcbiAgaWYgKFxuICAgIG9iai50eXBlID09PSBcInBsYXllclwiIHx8XG4gICAgb2JqLnR5cGUgPT09IFwicGxheWVyX2dob3N0XCIgfHxcbiAgICBvYmoudHlwZSA9PT0gXCJwbGF5ZXJfbWlzc2lsZVwiXG4gICkge1xuICAgIG9iai5rZXkgPSBcInBsYXllci1cIiArIG9iai5wbGF5ZXJfaWQ7XG4gIH0gZWxzZSB7XG4gICAgb2JqLmtleSA9XG4gICAgICBvYmoudHlwZSArXG4gICAgICBcIi1cIiArXG4gICAgICBvYmoucGxheWVyX2lkICtcbiAgICAgIFwiLVwiICtcbiAgICAgIG9iai5pZCArXG4gICAgICBcIi1cIiArXG4gICAgICBvYmouZnJhbWUgK1xuICAgICAgXCItXCIgK1xuICAgICAgb2JqLmRhdGE7XG4gIH1cblxuICAvLyBhZGQgdG8gc3RhdGUgb2JqZWN0c1xuICBzdGF0ZV9yZWYub2JqZWN0c1tvYmoua2V5XSA9IG9iajtcblxuICAvLyByZXR1cm4gaXRcbiAgcmV0dXJuIG9iajtcbn07XG5cbi8qIFNuYXAgb2JqZWN0IHRvIGFub3RoZXIgb2JqZWN0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuc25hcF9vYmplY3QgPSBmdW5jdGlvbihvYmoxLCBvYmoyKSB7XG4gIG9iajEuZ3JvdW5kZWQgPSBvYmoyLmdyb3VuZGVkO1xuICBvYmoxLnggPSBvYmoyLng7XG4gIG9iajEueSA9IG9iajIueTtcbiAgb2JqMS5zcGVlZF94ID0gb2JqMi5zcGVlZF94O1xuICBvYmoxLnNwZWVkX3kgPSBvYmoyLnNwZWVkX3k7XG59O1xuXG4vKiBSdW4gdGhyb3VnaCBvYmplY3QgZnJhbWUgZXZlbnRzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZnJhbWVfb2JqZWN0cyA9IGZ1bmN0aW9uKCkge1xuICAvLyBydW4gdGhyb3VnaCBhbGwgb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdGhpcy5mcmFtZV9vYmplY3QodGhpcy5zdGF0ZS5vYmplY3RzW2tleV0pO1xuICB9XG5cbiAgLy8gY2hlY2sgZm9yIHBsYXllciBsb2NrXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLnBsYXllcnMpIHtcbiAgICB0aGlzLmZyYW1lX3BsYXllcl9sb2NrKHRoaXMuc3RhdGUucGxheWVyc1trZXldKTtcbiAgfVxufTtcblxuY29yZS5wcm90b3R5cGUuZnJhbWVfb2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIG9iai5kZXN0cm95ZWQgPSBmYWxzZTtcblxuICAvLyBzdG9wcGluZ1xuICBpZiAob2JqLmMuc3RvcCA+IDAgJiYgdGhpcy5zdGF0ZS5mcmFtZSA+IG9iai5mcmFtZSArIG9iai5jLnN0b3ApIHtcbiAgICBvYmouc3BlZWRfeCA9IDA7XG4gICAgb2JqLnNwZWVkX3kgPSAwO1xuICB9XG5cbiAgLy8gdGltZW91dFxuICBpZiAob2JqLmMudGltZW91dCA+IDAgJiYgb2JqLmZyYW1lICsgb2JqLmMudGltZW91dCA8PSB0aGlzLnN0YXRlLmZyYW1lKSB7XG4gICAgdGhpcy5ydW5fZXZlbnQob2JqLCBcImRpZVwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBydW4gcGh5c2ljcyBvbiBvYmplY3RcbiAgdGhpcy5waHlzaWNzKG9iaik7XG5cbiAgLy8gZXZlbnRzXG4gIHRoaXMuZXZlbnQob2JqLCBcImZyYW1lXCIpO1xufTtcblxuLyogU3Bhd25zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuc3Bhd24gPSBmdW5jdGlvbihwcm9wcykge1xuICAvLyB3ZWFwb24gY3JhdGUgY29udGVudHNcbiAgaWYgKHByb3BzLnR5cGUgPT0gXCJjcmF0ZVwiKSB7XG4gICAgaWYgKHRoaXMuY3JhdGVfbGlzdC5sZW5ndGggPCAxKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHByb3BzLmRhdGEgPSB0aGlzLmNyYXRlX2xpc3RbcmFuZCgwLCB0aGlzLmNyYXRlX2xpc3QubGVuZ3RoKV07XG4gIH1cblxuICAvLyBkbyB3ZSBoYXZlIGEgc2V0IHBvc2l0aW9uXG4gIGlmICghcHJvcHMueCAmJiAhcHJvcHMueSkge1xuICAgIHZhciBwb3MgPSB0aGlzLm1hcC5haXJfZmluZF9zcG90KCk7XG4gICAgcHJvcHMueCA9IHBvcy54O1xuICAgIHByb3BzLnkgPSBwb3MueTtcbiAgfVxuXG4gIHJldHVybiB0aGlzLmNyZWF0ZV9vYmplY3QocHJvcHMpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFBoeXNpY3NcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gYWlyIHBoeXNpY3Ncblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5waHlzaWNzID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGFyZSB3ZSBzdGlsbCBncm91bmRlZFxuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgaWYgKCF0aGlzLm1hcC5ncm91bmRfcGl4ZWwocm91bmQob2JqLngpLCByb3VuZChvYmoueSkpKSB7XG4gICAgICBvYmouZ3JvdW5kZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBydW4gdGhlIG1haW4gcGh5c2ljc1xuICBpZiAoIW9iai5ncm91bmRlZCkge1xuICAgIHRoaXMucGh5c2ljc19ncmF2aXR5KG9iaik7XG4gICAgdGhpcy5waHlzaWNzX21vdmUob2JqKTtcbiAgfVxufTtcblxuLyogQ2FsY3VsYXRlIGdyYXZpdHlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5waHlzaWNzX2dyYXZpdHkgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gaWYgbm8gd2VpZ2h0XG4gIGlmIChvYmouYy53ZWlnaHQgPD0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCBncmF2aXR5IHZhbHVlc1xuICB2YXIgZ3Jhdml0eSA9IHRoaXMubWFwLmdldF9ncmF2aXR5KHJvdW5kKG9iai54KSwgcm91bmQob2JqLnkpKTtcblxuICAvLyBhZGp1c3Qgc3BlZWRcbiAgdGhpcy5waHlzaWNzX2FkanVzdF9zcGVlZChcbiAgICBvYmosXG4gICAgZ3Jhdml0eS54LFxuICAgIGdyYXZpdHkueSxcbiAgICBvYmouYy5zcGVlZC5tYXhfZ3Jhdml0eSxcbiAgICBvYmouYy53ZWlnaHRcbiAgKTtcbn07XG5cbi8qIEFkanVzdCBzcGVlZCBvZiBvYmplY3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5waHlzaWNzX2FkanVzdF9zcGVlZCA9IGZ1bmN0aW9uKFxuICBvYmosXG4gIG5ld19zcGVlZF94LFxuICBuZXdfc3BlZWRfeSxcbiAgbWF4X3NwZWVkLFxuICB3ZWlnaHRcbikge1xuICB2YXIgYW5nbGUgPSBnZXRfYW5nbGUobmV3X3NwZWVkX3gsIG5ld19zcGVlZF95KTtcbiAgdmFyIG1heF9zcGVlZCA9IHh5X3NwZWVkKGFuZ2xlLCBtYXhfc3BlZWQpO1xuICB2YXIgc3BlZWRfYWRkX3ggPSBuZXdfc3BlZWRfeCAqIHdlaWdodDtcbiAgdmFyIHNwZWVkX2FkZF95ID0gbmV3X3NwZWVkX3kgKiB3ZWlnaHQ7XG4gIHZhciBkaWZmX3ggPSBtYXhfc3BlZWQueCAtIG9iai5zcGVlZF94O1xuICB2YXIgZGlmZl95ID0gbWF4X3NwZWVkLnkgLSBvYmouc3BlZWRfeTtcblxuICAvLyBvbmx5IGFkZCBzcGVlZCB1cCB0byB0aGUgbGltaXQgd2l0aG91dCBicmluZ2luZyBpdCBkb3duXG4gIGlmIChtYXhfc3BlZWQueCA8IDApIHtcbiAgICBvYmouc3BlZWRfeCArPSBtYXgoc3BlZWRfYWRkX3gsIG1pbigwLCBkaWZmX3gpKTtcbiAgfSBlbHNlIHtcbiAgICBvYmouc3BlZWRfeCArPSBtaW4oc3BlZWRfYWRkX3gsIG1heCgwLCBkaWZmX3gpKTtcbiAgfVxuICBpZiAobWF4X3NwZWVkLnkgPCAwKSB7XG4gICAgb2JqLnNwZWVkX3kgKz0gbWF4KHNwZWVkX2FkZF95LCBtaW4oMCwgZGlmZl95KSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqLnNwZWVkX3kgKz0gbWluKHNwZWVkX2FkZF95LCBtYXgoMCwgZGlmZl95KSk7XG4gIH1cblxuICBvYmouc3BlZWRfeCA9IG9iai5zcGVlZF94LmZpeGVkKCk7XG4gIG9iai5zcGVlZF95ID0gb2JqLnNwZWVkX3kuZml4ZWQoKTtcbn07XG5cbi8qIERvIHRoZSBtb3ZlbWVudFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3NfbW92ZSA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBjaGVjayBzcGVlZFxuICB2YXIgc3BlZWRfbGltaXQgPSBjaGVja19zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3ksIG9iai5jLnNwZWVkLm1heCk7XG4gIG9iai5zcGVlZF94ID0gc3BlZWRfbGltaXQueC5maXhlZCgpO1xuICBvYmouc3BlZWRfeSA9IHNwZWVkX2xpbWl0LnkuZml4ZWQoKTtcblxuICAvLyBwbG90IGEgY291cnNlXG4gIHZhciBjb3Vyc2UgPSBwbG90X2NvdXJzZShvYmoueCwgb2JqLnksIG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG5cbiAgLy8gaWYgbm8gY291cnNlXG4gIGlmICghY291cnNlLm1vdmUpIHtcbiAgICB0aGlzLmNvbGxpc2lvbnMob2JqLCBvYmoueCwgb2JqLnkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIG1vdmUgdGhyb3VnaCBjb3Vyc2VcbiAgdmFyIG1vdmVkID0gZmFsc2U7XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgY291cnNlLnBvaW50cy5sZW5ndGg7IGkrKykge1xuICAgIC8vIHJlbWFpbmluZyBtb3ZlbWVudCBwb2ludHMgbGVmdFxuICAgIG9iai5zcGVlZF9sZWZ0ID0gY291cnNlLnBvaW50cy5sZW5ndGggLSBpO1xuXG4gICAgdmFyIHBvaW50ID0gY291cnNlLnBvaW50c1tpXTtcbiAgICB2YXIgbnggPSB0aGlzLm1hcC5sb29wX3gocm91bmQocG9pbnQueCkpO1xuICAgIHZhciBueSA9IHRoaXMubWFwLmxvb3BfeShyb3VuZChwb2ludC55KSk7XG5cbiAgICAvLyBjb2xsaXNpb25zXG4gICAgdmFyIGNvbGxpc2lvbiA9IHRoaXMuY29sbGlzaW9ucyhvYmosIG54LCBueSk7XG4gICAgaWYgKGNvbGxpc2lvbikge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gbW92ZSBvYmplY3RcbiAgICBvYmoueCA9IG54O1xuICAgIG9iai55ID0gbnk7XG4gICAgbW92ZWQgPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIG1vdmVkO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFBsYXllcnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDcmVhdGUgYSBuZXcgcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY3JlYXRlX3BsYXllciA9IGZ1bmN0aW9uKHByb3BzLCBzdGF0ZSkge1xuICBpZiAodHlwZW9mIHByb3BzLmlkID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHN0YXRlX3JlZiA9IHN0YXRlIHx8IHRoaXMuc3RhdGU7XG5cbiAgLy8gc2V0IHVwIG9iamVjdFxuICB2YXIgb2JqID0ge1xuICAgIGlkOiBcIlwiLFxuICAgIGxldmVsOiAwLFxuICAgIHNjb3JlOiAwLFxuICAgIGRlYWQ6IGZhbHNlLFxuICAgIGhlYWx0aDogdGhpcy5zY2hlbWUubGV2ZWxzLmhlYWx0aFswXSxcbiAgICBjb29sZG93bjogMCxcbiAgICBoaXQ6IDAsXG4gICAgd2VhcG9uOiBcIlwiLFxuICAgIGxvY2tlZDogXCJcIixcbiAgICBldmVudHM6IFtdLFxuICAgIGFybW91cnk6IHt9XG4gIH07XG4gIG9iaiA9IGRlZXBtZXJnZShvYmosIHByb3BzKTtcbiAgb2JqLmlkID0gcGFyc2VJbnQob2JqLmlkKTtcblxuICAvLyBzZXQgbGV2ZWxcbiAgdGhpcy5wbGF5ZXJfbGV2ZWwob2JqLmlkKTtcblxuICAvLyBhZGQgdG8gc3RhdGUgb2JqZWN0c1xuICBzdGF0ZV9yZWYucGxheWVyc1tvYmouaWRdID0gb2JqO1xuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBSZW1vdmUgcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucmVtb3ZlX3BsYXllciA9IGZ1bmN0aW9uKHBsYXllcl9pZCkge1xuICBpZiAoIXRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZGVsZXRlIHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllcl9pZF07XG4gIGRlbGV0ZSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbn07XG5cbi8qIFN0YXJ0IHRoZSBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5pbml0X3BsYXllciA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgc3RhdGUpIHtcbiAgcGxheWVyX2lkID0gcGFyc2VJbnQocGxheWVyX2lkKTtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHBsYXllciB2YWx1ZXNcbiAgcGxheWVyLmxldmVsID0gMDtcbiAgcGxheWVyLnNjb3JlID0gMDtcbiAgcGxheWVyLmRlYWQgPSBmYWxzZTtcbiAgcGxheWVyLmhlYWx0aCA9IHRoaXMuc2NoZW1lLmxldmVscy5oZWFsdGhbMF07XG4gIHBsYXllci5jb29sZG93biA9IDA7XG4gIHBsYXllci5ldmVudHMgPSBbXTtcblxuICAvLyBhcm1vdXJ5XG4gIHZhciBhcm1vdXJ5ID0ge307XG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnNjaGVtZS53ZWFwb25zKSB7XG4gICAgYXJtb3VyeVtrZXldID0gdGhpcy5zY2hlbWUud2VhcG9uc1trZXldLnN0YXJ0X2NvdW50O1xuICB9XG4gIHBsYXllci5hcm1vdXJ5ID0gYXJtb3VyeTtcblxuICAvLyBtZXJnZSB3aXRoIGFuIGV4dGVybmFsIHN0YXRlXG4gIGlmIChzdGF0ZSkge1xuICAgIHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdID0gZGVlcG1lcmdlKHBsYXllciwgc3RhdGUpO1xuICB9XG5cbiAgLy8gc2V0IGxldmVsXG4gIHRoaXMucGxheWVyX2xldmVsKHBsYXllcl9pZCk7XG5cbiAgLy8gb2JqZWN0IHZhbHVlc1xuICB2YXIgb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyX2lkXTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKHRoaXMuc2NoZW1lLnNwYXduLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgcG9zID0gdGhpcy5zY2hlbWUuc3Bhd25bcmFuZCgwLCB0aGlzLnNjaGVtZS5zcGF3bi5sZW5ndGgpXTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgcG9zID0gdGhpcy5tYXAuYWlyX2ZpbmRfc3BvdCgpO1xuICB9XG4gIG9iai50eXBlID0gXCJwbGF5ZXJcIjtcbiAgb2JqLmdyb3VuZGVkID0gZmFsc2U7XG4gIG9iai54ID0gcG9zLng7XG4gIG9iai55ID0gcG9zLnk7XG4gIG9iai5zcGVlZF94ID0gMDtcbiAgb2JqLnNwZWVkX3kgPSAwO1xuICBvYmouYyA9IHRoaXMuYy5vYmplY3RzW1wicGxheWVyXCJdO1xufTtcblxuLyogVXBkYXRlIGFybW91cnlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS51cGRhdGVfcGxheWVyX2FybW91cnkgPSBmdW5jdGlvbihwbGF5ZXJfaWQsIHdlYXBvbiwgY291bnQpIHtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGlmIGluZmluaXRlIG9yIGlmIHplcm8gYW5kIHRha2luZyBhd2F5XG4gIHZhciBvbGRfY291bnQgPSBwbGF5ZXIuYXJtb3VyeVt3ZWFwb25dO1xuICBpZiAoIWlzX251bWVyaWMob2xkX2NvdW50KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAob2xkX2NvdW50ID09PSAtMSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChvbGRfY291bnQgPT09IDAgJiYgY291bnQgPCAxKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gaWYgaW5maW5pdGVcbiAgaWYgKGNvdW50ID09PSBcImluZmluaXRlXCIpIHtcbiAgICBwbGF5ZXIuYXJtb3VyeVt3ZWFwb25dID0gLTE7XG4gIH0gZWxzZSB7XG4gICAgcGxheWVyLmFybW91cnlbd2VhcG9uXSArPSBjb3VudDtcbiAgfVxuXG4gIC8vIHJlY29yZCBldmVudFxuICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICB0eXBlOiBcImFybW91cnlcIixcbiAgICBwbGF5ZXJfaWQ6IHBsYXllcl9pZCxcbiAgICB3ZWFwb246IHdlYXBvblxuICB9KTtcblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIEFkZCBoZWFsdGggdG8gcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGxheWVyX2hlYWx0aF9hZGQgPSBmdW5jdGlvbihwbGF5ZXJfaWQsIGhlYWx0aCwgbm9fbWVzc2FnZSkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8IHBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gbm8gaGVhbHRoIGVuYWJsZWRcbiAgaWYgKCF0aGlzLnNjaGVtZS5oZWFsdGgpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBhZGQgaXRcbiAgcGxheWVyLmhlYWx0aCArPSBoZWFsdGg7XG4gIHBsYXllci5oZWFsdGggPSBtaW4ocGxheWVyLmhlYWx0aCwgdGhpcy5zY2hlbWUubGV2ZWxzLmhlYWx0aFtwbGF5ZXIubGV2ZWxdKTtcblxuICAvLyBhcmUgd2UgZGVhZFxuICBpZiAocGxheWVyLmhlYWx0aCA8PSAwKSB7XG4gICAgdGhpcy5wbGF5ZXJfZGllKHBsYXllcl9pZCk7XG4gIH1cblxuICAvLyBzZXQgZXZlbnRcbiAgaWYgKCFub19tZXNzYWdlKSB7XG4gICAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgICB0eXBlOiBcInBsYXllcl9oZWFsdGhcIixcbiAgICAgIGlkOiBwbGF5ZXJfaWQsXG4gICAgICBoZWFsdGg6IGhlYWx0aFxuICAgIH0pO1xuICB9XG59O1xuXG4vKiBBZGQgc2NvcmUgdG8gcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGxheWVyX3Njb3JlX2FkZCA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgc2NvcmUpIHtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCBwbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGFkZCBpdFxuICBwbGF5ZXIuc2NvcmUgKz0gc2NvcmU7XG5cbiAgLy8gc2V0IGxldmVsXG4gIHRoaXMucGxheWVyX2xldmVsKHBsYXllcl9pZCk7XG5cbiAgLy8gc2V0IGV2ZW50XG4gIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgIHR5cGU6IFwicGxheWVyX3Njb3JlXCIsXG4gICAgaWQ6IHBsYXllcl9pZCxcbiAgICBzY29yZTogc2NvcmVcbiAgfSk7XG59O1xuXG4vKiBTZXQgcGxheWVyIGxldmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGxheWVyX2xldmVsID0gZnVuY3Rpb24ocGxheWVyX2lkKSB7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIgfHwgcGxheWVyLmRlYWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGxldmVsc1xuICB2YXIgbGV2ZWwgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2NoZW1lLmxldmVscy5zY29yZS5sZW5ndGg7IGkrKykge1xuICAgIGlmICh0aGlzLnNjaGVtZS5sZXZlbHMuc2NvcmVbaV0gPD0gcGxheWVyLnNjb3JlKSB7XG4gICAgICBsZXZlbCA9IGk7XG4gICAgfVxuICB9XG4gIHBsYXllci5sZXZlbCA9IGxldmVsO1xufTtcblxuLyogUGxheWVyIGRpZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBsYXllcl9kaWUgPSBmdW5jdGlvbihwbGF5ZXJfaWQpIHtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCBwbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHBsYXllci5kZWFkID0gdHJ1ZTtcblxuICB2YXIgb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyX2lkXTtcbiAgb2JqLnR5cGUgPSBcInBsYXllcl9taXNzaWxlXCI7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbXCJwbGF5ZXJfbWlzc2lsZVwiXTtcblxuICAvLyBmaWd1cmUgb3V0IGdlbXMgdG8gc3Bhd25cbiAgdmFyIG4gPSBtYXgocm91bmQocGxheWVyLnNjb3JlIC8gMiksIDMpO1xuICB2YXIgZ2VtcyA9IFtdO1xuICB3aGlsZSAobiA+IDIwMCkge1xuICAgIGdlbXMucHVzaCgyMDApO1xuICAgIG4gLT0gMjAwO1xuICB9XG4gIHdoaWxlIChuID4gNTApIHtcbiAgICBnZW1zLnB1c2goNTApO1xuICAgIG4gLT0gNTA7XG4gIH1cbiAgd2hpbGUgKG4gPiAyMCkge1xuICAgIGdlbXMucHVzaCgyMCk7XG4gICAgbiAtPSAyMDtcbiAgfVxuICB3aGlsZSAobiA+IDUpIHtcbiAgICBnZW1zLnB1c2goNSk7XG4gICAgbiAtPSA1O1xuICB9XG4gIHdoaWxlIChuID4gMSkge1xuICAgIGdlbXMucHVzaCgxKTtcbiAgICBuIC09IDE7XG4gIH1cblxuICAvLyBzcGF3biB0aGVtXG4gIHZhciBhbmdsZV9pbmMgPSByb3VuZCgzNjAgLyBnZW1zLmxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZ2Vtcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBuID0gKChpICUgMykgKyAxKSAqIDI7XG4gICAgdmFyIHh5ID0geHlfc3BlZWQoYW5nbGVfaW5jICogaSwgbik7XG4gICAgdGhpcy5jcmVhdGVfb2JqZWN0KHtcbiAgICAgIHR5cGU6IFwiZ2VtLVwiICsgZ2Vtc1tpXSxcbiAgICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBzcGVlZF94OiB4eS54LmZpeGVkKCksXG4gICAgICBzcGVlZF95OiB4eS55LmZpeGVkKCksXG4gICAgICBkYXRhOiBpICsgMVxuICAgIH0pO1xuICB9XG59O1xuXG4vKiBSdW4gdGhyb3VnaCBwbGF5ZXJzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZnJhbWVfcGxheWVycyA9IGZ1bmN0aW9uKGlnbm9yZSkge1xuICAvLyBydW4gdGhyb3VnaCBhbGwgb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgaWYgKHBhcnNlSW50KGtleSkgIT09IGlnbm9yZSkge1xuICAgICAgdGhpcy5mcmFtZV9wbGF5ZXIodGhpcy5zdGF0ZS5wbGF5ZXJzW2tleV0pO1xuICAgIH1cbiAgfVxufTtcblxuY29yZS5wcm90b3R5cGUuZnJhbWVfcGxheWVyID0gZnVuY3Rpb24ocGxheWVyKSB7XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY29vbGRvd25cbiAgaWYgKHBsYXllci5jb29sZG93biA+IDApIHtcbiAgICBwbGF5ZXIuY29vbGRvd24tLTtcbiAgfVxuXG4gIC8vIGhpdFxuICBpZiAocGxheWVyLmhpdCA+IDApIHtcbiAgICBwbGF5ZXIuaGl0LS07XG4gIH1cblxuICAvLyBoZWFsdGggcmVnZW5cbiAgaWYgKHRoaXMuc3RhdGUuZnJhbWUgJSAyNCA9PT0gMCkge1xuICAgIGlmIChwbGF5ZXIuaGVhbHRoIDwgdGhpcy5zY2hlbWUubGV2ZWxzLmhlYWx0aFtwbGF5ZXIubGV2ZWxdKSB7XG4gICAgICB0aGlzLnBsYXllcl9oZWFsdGhfYWRkKHBsYXllci5pZCwgMiwgdHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gcmVtb3ZlIG9sZCBldmVudHNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbGF5ZXIuZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHRoaXMuc3RhdGUuZnJhbWUgPiBwbGF5ZXIuZXZlbnRzW2ldLmZyYW1lICsgMTgpIHtcbiAgICAgIHBsYXllci5ldmVudHMuc3BsaWNlKGksIDEpO1xuICAgIH1cbiAgfVxufTtcblxuLyogUnVuIHRocm91Z2ggcGxheWVyIGxvY2tlZCBvYmplY3RzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZnJhbWVfcGxheWVyX2xvY2sgPSBmdW5jdGlvbihwbGF5ZXIpIHtcbiAgdmFyIHBsYXllcl9vYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXIuaWRdO1xuICB2YXIgb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW3BsYXllci5sb2NrZWRdO1xuICBpZiAocGxheWVyX29iaiAmJiBvYmopIHtcbiAgICBwbGF5ZXJfb2JqLnggPSBvYmoueDtcbiAgICBwbGF5ZXJfb2JqLnkgPSBvYmoueTtcbiAgICBwbGF5ZXJfb2JqLnNwZWVkX3ggPSBvYmouc3BlZWRfeDtcbiAgICBwbGF5ZXJfb2JqLnNwZWVkX3kgPSBvYmouc3BlZWRfeTtcbiAgfSBlbHNlIHtcbiAgICBwbGF5ZXIubG9ja2VkID0gXCJcIjtcbiAgfVxufTtcblxuLyogR2V0IGRhbWFnZSBtb2RpZmllcnMgZnJvbSBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5nZXRfZGFtYWdlID0gZnVuY3Rpb24ob2JqKSB7XG4gIHZhciBkYW1hZ2UgPSBvYmouYy5kYW1hZ2U7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gIGlmIChwbGF5ZXIgJiYgZGFtYWdlICE9PSAwICYmICFvYmouYy5pZ25vcmVfbGV2ZWxfZGFtYWdlKSB7XG4gICAgdmFyIGxldmVsID0gdGhpcy5zY2hlbWUubGV2ZWxzLmRhbWFnZVtwbGF5ZXIubGV2ZWxdO1xuICAgIGlmIChsZXZlbCkge1xuICAgICAgZGFtYWdlICs9IGxldmVsO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGFtYWdlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFN0YXRlIG1hbmFnZW1lbnRcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBHZXQgc3RhdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wYWNrX3N0YXRlID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgLy8gcGxheWVyc1xuICB2YXIgcGxheWVycyA9IFtdO1xuICBmb3IgKHZhciBpZCBpbiBzdGF0ZS5wbGF5ZXJzKSB7XG4gICAgcGxheWVycy5wdXNoKHRoaXMucGFja19wbGF5ZXIoc3RhdGUucGxheWVyc1tpZF0pKTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggb2JqZWN0c1xuICB2YXIgb2JqZWN0cyA9IFtdO1xuICBmb3IgKHZhciBrZXkgaW4gc3RhdGUub2JqZWN0cykge1xuICAgIG9iamVjdHMucHVzaCh0aGlzLnBhY2tfb2JqZWN0KHN0YXRlLm9iamVjdHNba2V5XSkpO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBleHBsb3Npb25zXG4gIHZhciBleHBsb3Npb25zID0gW107XG4gIGZvciAoa2V5IGluIHN0YXRlLmV4cGxvc2lvbnMpIHtcbiAgICBleHBsb3Npb25zLnB1c2godGhpcy5wYWNrX2V4cGxvc2lvbihzdGF0ZS5leHBsb3Npb25zW2tleV0pKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgcGxheWVycy5qb2luKFwiI1wiKSArIFwiK1wiICsgb2JqZWN0cy5qb2luKFwiI1wiKSArIFwiK1wiICsgZXhwbG9zaW9ucy5qb2luKFwiI1wiKVxuICApO1xufTtcblxuLyogU2V0IHN0YXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUudW5wYWNrX3N0YXRlID0gZnVuY3Rpb24oc3RyKSB7XG4gIC8vIGJsYW5rIHN0YXRlXG4gIHZhciBzdGF0ZSA9IHRoaXMuYmxhbmtfc3RhdGUoKTtcblxuICAvLyBydW4gdGhyb3VnaCBzdGF0ZSBzdHJpbmdcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiK1wiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdC5sZW5ndGg7IGkrKykge1xuICAgIGlmIChzcGxpdFtpXSkge1xuICAgICAgdmFyIHNwbGl0MiA9IHNwbGl0W2ldLnNwbGl0KFwiI1wiKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3BsaXQyLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmIChpID09IDApIHtcbiAgICAgICAgICB0aGlzLnVucGFja19wbGF5ZXIoc3RhdGUsIHNwbGl0MltqXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkgPT0gMSkge1xuICAgICAgICAgIHRoaXMudW5wYWNrX29iamVjdChzdGF0ZSwgc3BsaXQyW2pdKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA9PSAyKSB7XG4gICAgICAgICAgdGhpcy51bnBhY2tfZXhwbG9zaW9uKHN0YXRlLCBzcGxpdDJbal0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHN0YXRlO1xufTtcblxuLyogUGxheWVyc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBhY2tfcGxheWVyID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIHByZXAgYmFzaWMgdmFsdWVzXG4gIHZhciBkZWFkID0gb2JqLmRlYWQgPyBcIjFcIiA6IFwiXCI7XG4gIHZhciB3ZWFwb24gPSB0aGlzLmFybW91cnlfcmVmcy5pbmRleE9mKG9iai53ZWFwb24pO1xuXG4gIC8vIHByZXAgYXJtb3VyeVxuICB2YXIgYXJtb3VyeSA9IFtdO1xuICBmb3IgKHZhciBrZXkgaW4gb2JqLmFybW91cnkpIHtcbiAgICBhcm1vdXJ5LnB1c2gob2JqLmFybW91cnlba2V5XSk7XG4gIH1cbiAgYXJtb3VyeSA9IGFybW91cnkuam9pbihcIiRcIik7XG5cbiAgLy8gcHJlcCBldmVudHNcbiAgdmFyIGV2ZW50cyA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5ldmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZXZlbnQgPSBvYmouZXZlbnRzW2ldO1xuICAgIGlmIChldmVudC50eXBlID09PSBcIndhbGtcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn4wXCIpO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJqdW1wXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+MVwiKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwic2hvb3RcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn4yflwiICsgZXZlbnQub2JqICsgXCJ+XCIgKyBldmVudC53ZWFwb24pO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJjcmF0ZVwiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjN+XCIgKyBldmVudC5vYmopO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJtZWRwYWNrXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+NH5cIiArIGV2ZW50Lm9iaik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcImdlbVwiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjV+XCIgKyBldmVudC5vYmopO1xuICAgIH1cbiAgfVxuICBldmVudHMgPSBldmVudHMuam9pbihcIiRcIik7XG5cbiAgLy8gcmV0dXJuIHBsYXllciBzdHJpbmdcbiAgdmFyIGFyciA9IFtcbiAgICBvYmouaWQsXG4gICAgb2JqLmxldmVsLFxuICAgIG9iai5zY29yZSxcbiAgICBkZWFkLFxuICAgIG9iai5oZWFsdGgsXG4gICAgb2JqLmNvb2xkb3duLFxuICAgIG9iai5oaXQsXG4gICAgb2JqLmxvY2tlZCxcbiAgICBhcm1vdXJ5LFxuICAgIHdlYXBvbixcbiAgICBldmVudHNcbiAgXTtcbiAgcmV0dXJuIGFyci5qb2luKFwiL1wiKTtcbn07XG5cbmNvcmUucHJvdG90eXBlLnVucGFja19wbGF5ZXIgPSBmdW5jdGlvbihzdGF0ZSwgc3RyKSB7XG4gIHZhciBzcGxpdCA9IHN0ci5zcGxpdChcIi9cIik7XG4gIHZhciBwcm9wcyA9IHt9O1xuICBwcm9wcy5pZCA9IHBhcnNlSW50KHNwbGl0WzBdKTtcbiAgcHJvcHMubGV2ZWwgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gIHByb3BzLnNjb3JlID0gcGFyc2VJbnQoc3BsaXRbMl0pO1xuICBwcm9wcy5kZWFkID0gc3BsaXRbM10gPT09IFwiMVwiID8gdHJ1ZSA6IGZhbHNlO1xuICBwcm9wcy5oZWFsdGggPSBwYXJzZUludChzcGxpdFs0XSk7XG4gIHByb3BzLmNvb2xkb3duID0gcGFyc2VJbnQoc3BsaXRbNV0pO1xuICBwcm9wcy5oaXQgPSBwYXJzZUludChzcGxpdFs2XSk7XG4gIHByb3BzLmxvY2tlZCA9IHNwbGl0WzddO1xuXG4gIC8vIHByZXAgYXJtb3VyeVxuICBwcm9wcy5hcm1vdXJ5ID0ge307XG4gIHZhciBzcGxpdDIgPSBzcGxpdFs4XS5zcGxpdChcIiRcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQyLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGtleSA9IHRoaXMuYXJtb3VyeV9yZWZzW2ldO1xuICAgIHByb3BzLmFybW91cnlba2V5XSA9IHBhcnNlSW50KHNwbGl0MltpXSk7XG4gIH1cblxuICAvLyB3ZWFwb25cbiAgdmFyIHdlcCA9IHBhcnNlSW50KHNwbGl0WzldKTtcbiAgaWYgKHdlcCAhPT0gLTEpIHtcbiAgICBwcm9wcy53ZWFwb24gPSB0aGlzLmFybW91cnlfcmVmc1t3ZXBdO1xuICB9XG5cbiAgLy8gcHJlcCBldmVudHNcbiAgcHJvcHMuZXZlbnRzID0gW107XG4gIHZhciBzcGxpdDIgPSBzcGxpdFsxMF0uc3BsaXQoXCIkXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Mi5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcGxpdDMgPSBzcGxpdDJbaV0uc3BsaXQoXCJ+XCIpO1xuICAgIHZhciBvYmogPSB7IGZyYW1lOiBwYXJzZUludChzcGxpdDNbMF0pIH07XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCIwXCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJ3YWxrXCI7XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiMVwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwianVtcFwiO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjJcIikge1xuICAgICAgb2JqLnR5cGUgPSBcInNob290XCI7XG4gICAgICBvYmoub2JqID0gc3BsaXQzWzJdO1xuICAgICAgb2JqLndlYXBvbiA9IHNwbGl0M1szXTtcbiAgICB9XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCIzXCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJjcmF0ZVwiO1xuICAgICAgb2JqLm9iaiA9IHNwbGl0M1syXTtcbiAgICB9XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCI0XCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJtZWRwYWNrXCI7XG4gICAgICBvYmoub2JqID0gc3BsaXQzWzJdO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjVcIikge1xuICAgICAgb2JqLnR5cGUgPSBcImdlbVwiO1xuICAgICAgb2JqLm9iaiA9IHNwbGl0M1syXTtcbiAgICB9XG4gICAgaWYgKG9iaikge1xuICAgICAgcHJvcHMuZXZlbnRzLnB1c2gob2JqKTtcbiAgICB9XG4gIH1cblxuICAvLyBtYWtlIGl0XG4gIHRoaXMuY3JlYXRlX3BsYXllcihwcm9wcywgc3RhdGUpO1xufTtcblxuLyogT2JqZWN0c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBhY2tfb2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7XG4gIHZhciBncm91bmRlZCA9IG9iai5ncm91bmRlZCA/IFwiMVwiIDogXCJcIjtcbiAgdmFyIGFyciA9IFtcbiAgICBvYmoudHlwZSxcbiAgICBvYmoucGxheWVyX2lkLFxuICAgIG9iai5pZCxcbiAgICBvYmouZnJhbWUsXG4gICAgZ3JvdW5kZWQsXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgb2JqLnNwZWVkX3gsXG4gICAgb2JqLnNwZWVkX3ksXG4gICAgb2JqLmRhdGFcbiAgXTtcbiAgcmV0dXJuIGFyci5qb2luKFwiL1wiKTtcbn07XG5cbmNvcmUucHJvdG90eXBlLnVucGFja19vYmplY3QgPSBmdW5jdGlvbihzdGF0ZSwgc3RyKSB7XG4gIHZhciBzcGxpdCA9IHN0ci5zcGxpdChcIi9cIik7XG4gIHZhciBwcm9wcyA9IHt9O1xuICBwcm9wcy50eXBlID0gc3BsaXRbMF07XG4gIHByb3BzLnBsYXllcl9pZCA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgcHJvcHMuaWQgPSBzcGxpdFsyXTtcbiAgcHJvcHMuZnJhbWUgPSBwYXJzZUludChzcGxpdFszXSk7XG4gIHByb3BzLmdyb3VuZGVkID0gc3BsaXRbNF0gPT09IFwiMVwiID8gdHJ1ZSA6IGZhbHNlO1xuICBwcm9wcy54ID0gcGFyc2VGbG9hdChzcGxpdFs1XSk7XG4gIHByb3BzLnkgPSBwYXJzZUZsb2F0KHNwbGl0WzZdKTtcbiAgcHJvcHMuc3BlZWRfeCA9IHBhcnNlRmxvYXQoc3BsaXRbN10pO1xuICBwcm9wcy5zcGVlZF95ID0gcGFyc2VGbG9hdChzcGxpdFs4XSk7XG4gIHByb3BzLmRhdGEgPSBzcGxpdFs5XTtcblxuICB0aGlzLmNyZWF0ZV9vYmplY3QocHJvcHMsIHN0YXRlKTtcbn07XG5cbi8qIEV4cGxvc2lvbnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wYWNrX2V4cGxvc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgYXJyID0gW1xuICAgIG9iai5wbGF5ZXJfaWQsXG4gICAgb2JqLmZyYW1lLFxuICAgIG9iai54LFxuICAgIG9iai55LFxuICAgIG9iai5wYXJlbnQsXG4gICAgb2JqLnBhcmVudF90eXBlXG4gIF07XG4gIHJldHVybiBhcnIuam9pbihcIi9cIik7XG59O1xuXG5jb3JlLnByb3RvdHlwZS51bnBhY2tfZXhwbG9zaW9uID0gZnVuY3Rpb24oc3RhdGUsIHN0cikge1xuICB2YXIgc3BsaXQgPSBzdHIuc3BsaXQoXCIvXCIpO1xuICB2YXIgcHJvcHMgPSB7fTtcbiAgcHJvcHMucGxheWVyX2lkID0gcGFyc2VJbnQoc3BsaXRbMF0pO1xuICBwcm9wcy5mcmFtZSA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgcHJvcHMueCA9IHBhcnNlRmxvYXQoc3BsaXRbMl0pO1xuICBwcm9wcy55ID0gcGFyc2VGbG9hdChzcGxpdFszXSk7XG4gIHByb3BzLnBhcmVudCA9IHNwbGl0WzRdO1xuICBwcm9wcy5wYXJlbnRfdHlwZSA9IHNwbGl0WzVdO1xuXG4gIHRoaXMuY3JlYXRlX2V4cGxvc2lvbihwcm9wcywgc3RhdGUpO1xufTtcbiIsImZ1bmN0aW9uIGlzTWVyZ2VhYmxlT2JqZWN0KHZhbCkge1xuICB2YXIgbm9uTnVsbE9iamVjdCA9IHZhbCAmJiB0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiO1xuXG4gIHJldHVybiAoXG4gICAgbm9uTnVsbE9iamVjdCAmJlxuICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWwpICE9PSBcIltvYmplY3QgUmVnRXhwXVwiICYmXG4gICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbCkgIT09IFwiW29iamVjdCBEYXRlXVwiXG4gICk7XG59XG5cbmZ1bmN0aW9uIGVtcHR5VGFyZ2V0KHZhbCkge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWwpID8gW10gOiB7fTtcbn1cblxuZnVuY3Rpb24gY2xvbmVJZk5lY2Vzc2FyeSh2YWx1ZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBjbG9uZSA9IG9wdGlvbnNBcmd1bWVudCAmJiBvcHRpb25zQXJndW1lbnQuY2xvbmUgPT09IHRydWU7XG4gIHJldHVybiBjbG9uZSAmJiBpc01lcmdlYWJsZU9iamVjdCh2YWx1ZSlcbiAgICA/IGRlZXBtZXJnZShlbXB0eVRhcmdldCh2YWx1ZSksIHZhbHVlLCBvcHRpb25zQXJndW1lbnQpXG4gICAgOiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gZGVmYXVsdEFycmF5TWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnNBcmd1bWVudCkge1xuICB2YXIgZGVzdGluYXRpb24gPSB0YXJnZXQuc2xpY2UoKTtcbiAgc291cmNlLmZvckVhY2goZnVuY3Rpb24oZSwgaSkge1xuICAgIGlmICh0eXBlb2YgZGVzdGluYXRpb25baV0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGRlc3RpbmF0aW9uW2ldID0gY2xvbmVJZk5lY2Vzc2FyeShlLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0gZWxzZSBpZiAoaXNNZXJnZWFibGVPYmplY3QoZSkpIHtcbiAgICAgIGRlc3RpbmF0aW9uW2ldID0gZGVlcG1lcmdlKHRhcmdldFtpXSwgZSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgICB9IGVsc2UgaWYgKHRhcmdldC5pbmRleE9mKGUpID09PSAtMSkge1xuICAgICAgZGVzdGluYXRpb24ucHVzaChjbG9uZUlmTmVjZXNzYXJ5KGUsIG9wdGlvbnNBcmd1bWVudCkpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBkZXN0aW5hdGlvbjtcbn1cblxuZnVuY3Rpb24gbWVyZ2VPYmplY3QodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnNBcmd1bWVudCkge1xuICB2YXIgZGVzdGluYXRpb24gPSB7fTtcbiAgaWYgKGlzTWVyZ2VhYmxlT2JqZWN0KHRhcmdldCkpIHtcbiAgICBPYmplY3Qua2V5cyh0YXJnZXQpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICBkZXN0aW5hdGlvbltrZXldID0gY2xvbmVJZk5lY2Vzc2FyeSh0YXJnZXRba2V5XSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgICB9KTtcbiAgfVxuICBPYmplY3Qua2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgaWYgKCFpc01lcmdlYWJsZU9iamVjdChzb3VyY2Vba2V5XSkgfHwgIXRhcmdldFtrZXldKSB7XG4gICAgICBkZXN0aW5hdGlvbltrZXldID0gY2xvbmVJZk5lY2Vzc2FyeShzb3VyY2Vba2V5XSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVzdGluYXRpb25ba2V5XSA9IGRlZXBtZXJnZSh0YXJnZXRba2V5XSwgc291cmNlW2tleV0sIG9wdGlvbnNBcmd1bWVudCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRlc3RpbmF0aW9uO1xufVxuXG5mdW5jdGlvbiBkZWVwbWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnNBcmd1bWVudCkge1xuICB2YXIgYXJyYXkgPSBBcnJheS5pc0FycmF5KHNvdXJjZSk7XG4gIHZhciBvcHRpb25zID0gb3B0aW9uc0FyZ3VtZW50IHx8IHsgYXJyYXlNZXJnZTogZGVmYXVsdEFycmF5TWVyZ2UgfTtcbiAgdmFyIGFycmF5TWVyZ2UgPSBvcHRpb25zLmFycmF5TWVyZ2UgfHwgZGVmYXVsdEFycmF5TWVyZ2U7XG5cbiAgaWYgKGFycmF5KSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodGFyZ2V0KVxuICAgICAgPyBhcnJheU1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zQXJndW1lbnQpXG4gICAgICA6IGNsb25lSWZOZWNlc3Nhcnkoc291cmNlLCBvcHRpb25zQXJndW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBtZXJnZU9iamVjdCh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgfVxufVxuXG5kZWVwbWVyZ2UuYWxsID0gZnVuY3Rpb24gZGVlcG1lcmdlQWxsKGFycmF5LCBvcHRpb25zQXJndW1lbnQpIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGFycmF5KSB8fCBhcnJheS5sZW5ndGggPCAyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJmaXJzdCBhcmd1bWVudCBzaG91bGQgYmUgYW4gYXJyYXkgd2l0aCBhdCBsZWFzdCB0d28gZWxlbWVudHNcIlxuICAgICk7XG4gIH1cblxuICAvLyB3ZSBhcmUgc3VyZSB0aGVyZSBhcmUgYXQgbGVhc3QgMiB2YWx1ZXMsIHNvIGl0IGlzIHNhZmUgdG8gaGF2ZSBubyBpbml0aWFsIHZhbHVlXG4gIHJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgbmV4dCkge1xuICAgIHJldHVybiBkZWVwbWVyZ2UocHJldiwgbmV4dCwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgfSk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTWF0aCBGdW5jdGlvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTaG9ydGVuIFwiTWF0aFwiIGZ1bmN0aW9uc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGNvcyhuKSB7XG4gIHJldHVybiBNYXRoLmNvcyhuKTtcbn1cbmZ1bmN0aW9uIHNpbihuKSB7XG4gIHJldHVybiBNYXRoLnNpbihuKTtcbn1cbmZ1bmN0aW9uIHBvdyhuKSB7XG4gIHJldHVybiBNYXRoLnBvdyhuKTtcbn1cbmZ1bmN0aW9uIGFicyhuKSB7XG4gIHJldHVybiBNYXRoLmFicyhuKTtcbn1cbmZ1bmN0aW9uIHNxcihuKSB7XG4gIHJldHVybiBNYXRoLnBvdyhuLCAyKTtcbn1cbmZ1bmN0aW9uIHNxcnQobikge1xuICByZXR1cm4gTWF0aC5zcXJ0KG4pO1xufVxuZnVuY3Rpb24gcm91bmQobikge1xuICByZXR1cm4gTWF0aC5yb3VuZChuKTtcbn1cbmZ1bmN0aW9uIGZsb29yKG4pIHtcbiAgcmV0dXJuIE1hdGguZmxvb3Iobik7XG59XG5mdW5jdGlvbiBjZWlsKG4pIHtcbiAgcmV0dXJuIE1hdGguY2VpbChuKTtcbn1cbmZ1bmN0aW9uIGF0YW4yKG4xLCBuMikge1xuICByZXR1cm4gTWF0aC5hdGFuMihuMSwgbjIpO1xufVxuZnVuY3Rpb24gbWluKG4xLCBuMikge1xuICByZXR1cm4gTWF0aC5taW4objEsIG4yKTtcbn1cbmZ1bmN0aW9uIG1heChuMSwgbjIpIHtcbiAgcmV0dXJuIE1hdGgubWF4KG4xLCBuMik7XG59XG5mdW5jdGlvbiByYW5kKG4xLCBuMikge1xuICByZXR1cm4gZmxvb3IoTWF0aC5yYW5kb20oKSAqIG4yKSArIG4xO1xufVxudmFyIHBpID0gTWF0aC5QSTtcblxuLyogRml4IG51bWJlciB0byBkZWNpbWFsIHBsYWNlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbk51bWJlci5wcm90b3R5cGUuZml4ZWQgPSBmdW5jdGlvbihuKSB7XG4gIG4gPSBuIHx8IDI7XG4gIHJldHVybiBwYXJzZUZsb2F0KHRoaXMudG9GaXhlZChuKSk7XG59O1xuXG4vKiBBZGQgcHJlY2VkaW5nIHplcm9lcyB0byBudW1iZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBwcmVjZWRpbmdfemVyb2VzKG4sIGxlbmd0aCkge1xuICB2YXIgbGVuZ3RoID0gbGVuZ3RoIHx8IDI7XG4gIHZhciBuID0gbi50b1N0cmluZygpO1xuICB3aGlsZSAobi5sZW5ndGggPCBsZW5ndGgpIHtcbiAgICBuID0gXCIwXCIgKyBuO1xuICB9XG4gIHJldHVybiBuO1xufVxuXG4vKiBJcyBudW1iZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBpc19udW1lcmljKG4pIHtcbiAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG4pKSAmJiBpc0Zpbml0ZShuKTtcbn1cblxuLyogR2V0IGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGdldF9zcGVlZChzeCwgc3kpIHtcbiAgcmV0dXJuIHJvdW5kKHNxcnQoc3FyKHN4KSArIHNxcihzeSkpKTtcbn1cblxuZnVuY3Rpb24gZ2V0X2Rpc3RhbmNlKHgxLCB5MSwgeDIsIHkyKSB7XG4gIHZhciBkeCA9IHgyIC0geDEsXG4gICAgZHkgPSB5MiAtIHkxO1xuICByZXR1cm4gZ2V0X3NwZWVkKGR4LCBkeSk7XG59XG5cbi8qIENoZWNrIHNwZWVkIGxpbWl0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gY2hlY2tfc3BlZWQoc3gsIHN5LCBzcGVlZCkge1xuICB2YXIgZCA9IGdldF9kaXN0YW5jZSgwLCAwLCBzeCwgc3kpLFxuICAgIG5zID0ge1xuICAgICAgeDogc3gsXG4gICAgICB5OiBzeSxcbiAgICAgIHRvdGFsOiBkXG4gICAgfTtcbiAgaWYgKHNwZWVkIDwgZCkge1xuICAgIHZhciBtdWx0aSA9IHNwZWVkIC8gZDtcbiAgICBucy54ID0gc3ggKiBtdWx0aTtcbiAgICBucy55ID0gc3kgKiBtdWx0aTtcbiAgICBucy50b3RhbCA9IHNwZWVkO1xuICB9XG4gIHJldHVybiBucztcbn1cblxuLyogR2V0IEhlYWRpbmcgQW5nbGUgRnJvbSBYIGFuZCBZIFNwZWVkXG5cdC8vIDAgPSBsZWZ0LCAzNjAgPSBsZWZ0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gZ2V0X2FuZ2xlKHN4LCBzeSkge1xuICByZXR1cm4gKCgoYXRhbjIoc3ksIHN4KSAqIDE4MCkgLyBwaSkgJSAzNjApICsgMTgwO1xufVxuXG5mdW5jdGlvbiBnZXRfaGVhZGluZyh4MSwgeTEsIHgyLCB5Mikge1xuICB2YXIgeHMgPSB4MiAtIHgxLFxuICAgIHlzID0geTIgLSB5MTtcbiAgcmV0dXJuIGdldF9hbmdsZSh4cywgeXMpO1xufVxuXG4vKiBHZXQgWCBhbmQgWSBzcGVlZCBmcm9tIGhlYWRpbmcgYW5kIHZlbG9jaXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24geHlfc3BlZWQoYW5nbGUsIHNwZWVkKSB7XG4gIHZhciBhID0gYW5nbGVfYWRkKGFuZ2xlLCAxODApLFxuICAgIHIgPSAoYSAvIDE4MCkgKiBwaTtcbiAgcmV0dXJuIHtcbiAgICB4OiBzcGVlZCAqIGNvcyhyKSxcbiAgICB5OiBzcGVlZCAqIHNpbihyKVxuICB9O1xufVxuXG4vKiBHZXQgWCBhbmQgWSBvZmZzZXQgZnJvbSBoZWFkaW5nIGFuZCB2ZWxvY2l0eVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHh5X29mZnNldChhbmdsZSwgc3gsIHN5KSB7XG4gIHZhciB4eTEgPSB4eV9zcGVlZChhbmdsZSwgc3gpO1xuICB2YXIgeHkyID0geHlfc3BlZWQoYW5nbGVfYWRkKGFuZ2xlLCA5MCksIHN5KTtcbiAgcmV0dXJuIHtcbiAgICB4OiB4eTEueCArIHh5Mi54LFxuICAgIHk6IHh5MS55ICsgeHkyLnlcbiAgfTtcbn1cblxuLyogR2V0IGRpZmZlcmVuY2UgYmV0d2VlbiB0d28gbnVtYmVycyBpbiBhIGxvb3Bcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBuX2RpZmYoY3VycmVudCwgdGFyZ2V0LCBib3R0b20sIHRvcCkge1xuICBpZiAoY3VycmVudCA9PSB0YXJnZXQpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIHZhciBzY2FsZSA9IGFicyh0b3AgLSBib3R0b20pLCAvLyBnZXQgdG90YWwgc2l6ZSBvZiB0aGUgbG9vcFxuICAgIGNfY3VycmVudCA9IGN1cnJlbnQgLSBib3R0b20sIC8vIGNvcnJlY3QgY3VycmVudCBmb3IgbmVnYXRpdmUgbnVtYmVyc1xuICAgIGNfdGFyZ2V0ID0gdGFyZ2V0IC0gYm90dG9tLCAvLyBjb3JyZWN0IHRhcmdldCBmb3IgbmVnYXRpdmUgbnVtYmVyc1xuICAgIG4xID0gKGNfdGFyZ2V0ICsgc2NhbGUgLSBjX2N1cnJlbnQpICUgc2NhbGUsIC8vIGdldCBkaWZmZXJlbmNlIHdoZW4gYWRkaW5nXG4gICAgbjIgPSAoY19jdXJyZW50ICsgc2NhbGUgLSBjX3RhcmdldCkgJSBzY2FsZTsgLy8gZ2V0IGRpZmZlcmVuY2Ugd2hlbiBzdWJ0cmFjdGluZ1xuXG4gIC8vIHJldHVybiBzbWFsbGVzdCBkaXN0YW5jZVxuICBpZiAobjEgPCBuMikge1xuICAgIHJldHVybiBuMTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gLW4yO1xuICB9XG59XG5cbi8qIEF1dG8gbG9vcCBhIG51bWJlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG5fbG9vcChuLCBib3R0b20sIHRvcCkge1xuICB2YXIgZGlmZmVyZW5jZSA9IGFicyh0b3AgLSBib3R0b20pO1xuICB3aGlsZSAobiA8PSBib3R0b20pIHtcbiAgICBuICs9IGRpZmZlcmVuY2U7XG4gIH1cbiAgd2hpbGUgKG4gPiB0b3ApIHtcbiAgICBuIC09IGRpZmZlcmVuY2U7XG4gIH1cbiAgcmV0dXJuIG47XG59XG5cbi8qIEFkZCB0byBhIG51bWJlciB3aXRob3V0IG92ZXJmbG93aW5nIHVwIG9yIGRvd24gZnJvbSBtaW4vbWF4XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbl9hZGQobjEsIG4yLCB0MSwgdDIpIHtcbiAgdmFyIGRpZiA9IGFicyh0MiAtIHQxKSxcbiAgICBuYSA9IG4xICsgbjI7XG4gIHdoaWxlIChuYSA8IHQxKSB7XG4gICAgbmEgKz0gZGlmO1xuICB9XG4gIHdoaWxlIChuYSA+PSB0Mikge1xuICAgIG5hIC09IGRpZjtcbiAgfVxuICByZXR1cm4gbmE7XG59XG5cbi8qIEFkZCB0byBhbiBhbmdsZSB3aXRob3V0IG92ZXJmbG93aW5nIHVwIG9yIGRvd24gZnJvbSAwLTM2MFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGFuZ2xlX2FkZChhbmdsZSwgYWRkKSB7XG4gIGlmICghYW5nbGUpIHtcbiAgICBhbmdsZSA9IDA7XG4gIH1cbiAgcmV0dXJuIG5fYWRkKGFuZ2xlLCBhZGQsIDAsIDM2MCk7XG59XG5cbi8qIE1vdmUgbnVtYmVyIHRvd2FyZHMgYSBuZXcgbnVtYmVyIHdpdGggbG9vcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGluY3JlbWVudF9udW0oY3VycmVudCwgdGFyZ2V0LCBib3R0b20sIHRvcCwgc3BlZWQpIHtcbiAgdmFyIGRpZmYgPSBuX2RpZmYoY3VycmVudCwgdGFyZ2V0LCBib3R0b20sIHRvcCk7IC8vIGdldCBzaG9ydGVzdCByb3V0ZSB0byBudW1iZXJcbiAgbW92ZSA9IG1pbihhYnMoZGlmZikgLyAxMCwgNCkgKiBzcGVlZDsgLy8gY2FsY3VsYXRlIGhvdyBtdWNoIHRvIG1vdmVcblxuICAvLyBpZiBkaWZmZXJlbmNlIGlzIGxlc3MgdGhlbiBtb3ZlbWVudCwgcmV0dXJuIHRhcmdldFxuICBpZiAoYWJzKGRpZmYpIDwgbW92ZSkge1xuICAgIHJldHVybiB0YXJnZXQ7XG4gIH1cblxuICAvLyBhZGQgb3Igc3VidHJhY3QgbW92ZW1lbnRcbiAgbW92ZSA9IGRpZmYgPCAwID8gLW1vdmUgOiBtb3ZlO1xuICByZXR1cm4gbl9hZGQoY3VycmVudCwgbW92ZSwgYm90dG9tLCB0b3ApO1xufVxuXG4vKiBNb3ZlIGFuZ2xlIHRvd2FyZHMgYSBuZXcgYW5nbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBpbmNyZW1lbnRfYW5nbGUob2xkX2FuZ2xlLCBuZXdfYW5nbGUsIHNwZWVkKSB7XG4gIHJldHVybiBpbmNyZW1lbnRfbnVtKG9sZF9hbmdsZSwgbmV3X2FuZ2xlLCAwLCAzNjAsIHNwZWVkKTtcbn1cblxuLyogSWYgYSBwb2ludCBpcyB3aXRoaW4gYSBjaXJjbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBpbl9jaXJjbGUoeCwgeSwgY3gsIGN5LCByYWRpdXMpIHtcbiAgcmV0dXJuIGdldF9kaXN0YW5jZSh4LCB5LCBjeCwgY3kpIDwgcmFkaXVzO1xufVxuXG4vKiBQbG90IGEgY291cnNlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gcGxvdF9jb3Vyc2UoeCwgeSwgc3gsIHN5LCBleHRlbmQpIHtcbiAgLy8gZ2V0IGluaXRpYWwgc3BlZWRcbiAgdmFyIGV4dGVuZCA9IGV4dGVuZCA/IGV4dGVuZCA6IDAsXG4gICAgc3BlZWQgPSBnZXRfc3BlZWQoc3gsIHN5KTtcblxuICAvLyBpZiBubyBkaXN0YW5jZSB0aGVuIGRvIG5vdGhpbmdcbiAgaWYgKHNwZWVkID09IDApIHtcbiAgICByZXR1cm4geyBtb3ZlOiBmYWxzZSB9O1xuICB9XG5cbiAgLy8gY2FsY3VsYXRlIGluY3JlbWVudHNcbiAgdmFyIGluY3JlbWVudF94ID0gc3ggLyBzcGVlZCxcbiAgICBpbmNyZW1lbnRfeSA9IHN5IC8gc3BlZWQsXG4gICAgbmV3X3ggPSB4IC0gaW5jcmVtZW50X3ggKiBleHRlbmQsXG4gICAgbmV3X3kgPSB5IC0gaW5jcmVtZW50X3kgKiBleHRlbmQsXG4gICAgcG9pbnRzID0gW3sgeDogbmV3X3gsIHk6IG5ld195IH1dO1xuXG4gIC8vIGl0ZXJhdGUgdGhyb3VnaCBwYXRoIGFuZCByZWNvcmQgcG9pbnRzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlZWQgKyBleHRlbmQgKiAyOyBpKyspIHtcbiAgICAobmV3X3ggKz0gaW5jcmVtZW50X3gpLCAobmV3X3kgKz0gaW5jcmVtZW50X3kpO1xuICAgIHBvaW50cy5wdXNoKHtcbiAgICAgIHg6IG5ld194LFxuICAgICAgeTogbmV3X3lcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHJldHVybiBwb2ludCBhcnJheVxuICByZXR1cm4ge1xuICAgIG1vdmU6IHRydWUsXG4gICAgcG9pbnRzOiBwb2ludHNcbiAgfTtcbn1cblxuLyogdHJhbnNsYXRlIGNvLW9yZGluYXRlcyBieSBhbiBhbmdsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHJvdGF0ZV9jb29yZHMoeCwgeSwgY3gsIGN5LCBhbmdsZSkge1xuICB2YXIgciA9IChwaSAvIDE4MCkgKiBhbmdsZTtcbiAgcmV0dXJuIHtcbiAgICB4OiBjb3MocikgKiAoeCAtIGN4KSArIHNpbihyKSAqICh5IC0gY3kpICsgY3gsXG4gICAgeTogY29zKHIpICogKHkgLSBjeSkgLSBzaW4ocikgKiAoeCAtIGN4KSArIGN5XG4gIH07XG59XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNaXNjIEZ1bmN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIER1cGxpY2F0ZSBvYmplY3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBkdXBsaWNhdGVfb2JqKG9iaikge1xuICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcbn1cblxuLyogUHJldmVudCBhcnJheSBtZXJnaW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gZG9udF9tZXJnZShkZXN0aW5hdGlvbiwgc291cmNlKSB7XG4gIGlmICghc291cmNlKSB7XG4gICAgcmV0dXJuIGRlc3RpbmF0aW9uO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBzb3VyY2U7XG4gIH1cbn1cblxuLyogQWRkIHNwYWNlIHRvIGEgc3RyaW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gc3RyX3NwYWNlKHN0cikge1xuICB2YXIgbmV3X3N0ciA9IFwiXCI7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGFkZCA9IGkgPT0gc3RyLmxlbmd0aCAtIDEgPyBcIlwiIDogXCJcXHUyMDBBXCI7XG4gICAgbmV3X3N0ciArPSBzdHJbaV0gKyBhZGQ7XG4gIH1cbiAgcmV0dXJuIG5ld19zdHI7XG59XG5cbi8qIExvZyBtdWx0aXBsZSB2YWx1ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBjbG9nKFxuICBzMSxcbiAgczIsXG4gIHMzLFxuICBzNCxcbiAgczUsXG4gIHM2LFxuICBzNyxcbiAgczgsXG4gIHM5LFxuICBzMTAsXG4gIHMxMSxcbiAgczEyLFxuICBzMTMsXG4gIHMxNCxcbiAgczE1XG4pIHtcbiAgdmFyIHN0ciA9IHMxO1xuICBpZiAoczIgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMjtcbiAgfVxuICBpZiAoczMgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMztcbiAgfVxuICBpZiAoczQgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzNDtcbiAgfVxuICBpZiAoczUgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzNTtcbiAgfVxuICBpZiAoczYgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzNjtcbiAgfVxuICBpZiAoczcgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzNztcbiAgfVxuICBpZiAoczggIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzODtcbiAgfVxuICBpZiAoczkgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzOTtcbiAgfVxuICBpZiAoczEwICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczEwO1xuICB9XG4gIGlmIChzMTEgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTE7XG4gIH1cbiAgaWYgKHMxMiAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxMjtcbiAgfVxuICBpZiAoczEzICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczEzO1xuICB9XG4gIGlmIChzMTQgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTQ7XG4gIH1cbiAgaWYgKHMxNSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxNTtcbiAgfVxuICBjb25zb2xlLmxvZyhzdHIpO1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHZW5lcmF0b3Jcblx0QmxvYnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBEcmF3IGEgYmxvYlxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbl9ibG9iKGltZywgY29uZmlnLCBkZWNvcmF0aW9ucywgcmFkaXVzLCB0eXBlKSB7XG4gIHRoaXMuc2l6ZSA9IDM2O1xuICB0aGlzLmltZyA9IGltZztcbiAgdGhpcy5jID0gY29uZmlnO1xuXG4gIC8vIGdldCBsYW5kIHR5cGVcbiAgdmFyIHR5cGUgPSB0eXBlIHx8IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuYy5sYW5kX3R5cGUubGVuZ3RoKTtcbiAgdGhpcy5yZWYgPSB0aGlzLmMubGFuZF90eXBlW3R5cGVdO1xuXG4gIC8vIHNldCB1cCBtYWluIGFuY2hvciBwb2ludHNcbiAgdmFyIGFuY2hvcnMgPSBbXTtcbiAgdmFyIHBvaW50cyA9IE1hdGguZmxvb3IocmFkaXVzIC8gMikgKyA0O1xuICB2YXIgc3Bpa2UgPSBNYXRoLmZsb29yKHJhZGl1cyAvIDIpICsgMjtcbiAgZm9yICh2YXIgcCA9IDA7IHAgPCBwb2ludHM7IHArKykge1xuICAgIHZhciBuZXdfcmFkaXVzID1cbiAgICAgIE1hdGgubWF4KHJhZGl1cyAtIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNwaWtlKSwgMSkgKyAxO1xuICAgIHZhciB4ID1cbiAgICAgIHJhZGl1cyArIE1hdGguZmxvb3IobmV3X3JhZGl1cyAqIE1hdGguY29zKCgyICogTWF0aC5QSSAqIHApIC8gcG9pbnRzKSk7XG4gICAgdmFyIHkgPVxuICAgICAgcmFkaXVzICsgTWF0aC5mbG9vcihuZXdfcmFkaXVzICogTWF0aC5zaW4oKDIgKiBNYXRoLlBJICogcCkgLyBwb2ludHMpKTtcbiAgICBhbmNob3JzLnB1c2goeyB4OiB4LCB5OiB5IH0pO1xuICB9XG5cbiAgLy8gZHJhdyBzaGFwZSB0byBjYW52YXNcbiAgdmFyIHNpemUgPSByYWRpdXMgKiAyICsgMTtcbiAgdmFyIHNoYXBlID0gbWFwZ2VuX2NhbnZhcyhzaXplLCBzaXplKTtcbiAgdGhpcy5kcmF3X3BhdGgoc2hhcGUsIGFuY2hvcnMpO1xuXG4gIC8vIGJ1aWxkIGFycmF5IG9mIGxhbmQgb3Igbm90IHRpbGVzXG4gIHZhciBwaXhlbHMgPSBzaGFwZS5jb250LmdldEltYWdlRGF0YSgwLCAwLCBzaGFwZS53LCBzaGFwZS5oKTtcbiAgdGhpcy5sYW5kID0gW107XG4gIGZvciAodmFyIHkgPSAwOyB5IDwgc2l6ZTsgeSsrKSB7XG4gICAgdGhpcy5sYW5kW3ldID0gW107XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzaXplOyB4KyspIHtcbiAgICAgIHZhciBpID0gKHkgKiBzaXplICsgeCkgKiA0ICsgMztcbiAgICAgIHRoaXMubGFuZFt5XVt4XSA9IHBpeGVscy5kYXRhW2ldID4gMzAgPyAxIDogMDtcbiAgICB9XG4gIH1cblxuICAvLyBidWlsZCB0aWxlIGFycmF5IGFuZCBhc3NpZ24gY29ybmVycyBhbmQgbGFuZFxuICB0aGlzLnRpbGVzID0gW107XG4gIGZvciAodmFyIHkgPSAwOyB5IDwgc2l6ZTsgeSsrKSB7XG4gICAgdGhpcy50aWxlc1t5XSA9IFtdO1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCsrKSB7XG4gICAgICB0aGlzLnRpbGVzW3ldW3hdID0gdGhpcy5zZXRfY29ybmVyX3RpbGUoeSwgeCk7XG4gICAgfVxuICB9XG5cbiAgLy8gYXNzaWduIHBpeGVscyBhIHRpbGUgdmFsdWVcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCBzaXplOyB5KyspIHtcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNpemU7IHgrKykge1xuICAgICAgdGhpcy50aWxlc1t5XVt4XSA9XG4gICAgICAgIHRoaXMudGlsZXNbeV1beF0gPT09IDEyID8gdGhpcy5zZXRfbGFuZF90aWxlKHksIHgpIDogdGhpcy50aWxlc1t5XVt4XTtcbiAgICB9XG4gIH1cblxuICAvLyBkcmF3IHRoZW1cbiAgdmFyIHdoID0gKHNpemUgKyA0KSAqIHRoaXMuc2l6ZTtcbiAgdGhpcy5hbHBoYSA9IG1hcGdlbl9jYW52YXMod2gsIHdoKTtcbiAgdGhpcy5lZGdlID0gbWFwZ2VuX2NhbnZhcyh3aCwgd2gpO1xuICB0aGlzLmJnID0gbWFwZ2VuX2NhbnZhcyh3aCwgd2gpO1xuICBmb3IgKHZhciB5ID0gMDsgeSA8IHNpemU7IHkrKykge1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCsrKSB7XG4gICAgICB2YXIgdGlsZSA9IHRoaXMudGlsZXNbeV1beF07XG4gICAgICBpZiAodGlsZSA9PT0gLTEpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIGRyYXcgaXRcbiAgICAgIHZhciB4MSA9ICh4ICsgMikgKiB0aGlzLnNpemU7XG4gICAgICB2YXIgeTEgPSAoeSArIDIpICogdGhpcy5zaXplO1xuICAgICAgdGhpcy5kcmF3X3RvX2NhbnZhcyh0aGlzLmFscGhhLmNvbnQsIHgxLCB5MSwgdGlsZSwgMCk7XG4gICAgICB0aGlzLmRyYXdfdG9fY2FudmFzKHRoaXMuZWRnZS5jb250LCB4MSwgeTEsIHRpbGUsIHRoaXMucmVmLmVkZ2UpO1xuXG4gICAgICBpZiAoZGVjb3JhdGlvbnMpIHtcbiAgICAgICAgdGhpcy5kcmF3X2RlY29yYXRpb24odGhpcy5iZy5jb250LCB4LCB5LCB0aWxlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBkcmF3IHJlc3Qgb2YgZmdcbiAgdmFyIGZnID0gbWFwZ2VuX3BhdHRlcm4odGhpcy5hbHBoYS5jYW52LCB0aGlzLmltZ1t0aGlzLnJlZi5mZ10pO1xuICBmZy5jb250LmRyYXdJbWFnZSh0aGlzLmVkZ2UuY2FudiwgMCwgMCk7XG5cbiAgLy8gZHJhdyBkaXJ0IGJnXG4gIHZhciBmZ19kaXJ0ID0gbWFwZ2VuX3BhdHRlcm4oZmcuY2FudiwgdGhpcy5pbWdbdGhpcy5yZWYuYmddKTtcbiAgdGhpcy5iZy5jb250LmRyYXdJbWFnZShmZ19kaXJ0LmNhbnYsIDAsIDApO1xuXG4gIC8vIGV4cG9ydFxuICByZXR1cm4ge1xuICAgIGZnOiBmZyxcbiAgICBiZzogdGhpcy5iZ1xuICB9O1xufVxuXG4vKiBEcmF3IGFuIGFscGhhIHBhdGhcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuZHJhd19wYXRoID0gZnVuY3Rpb24oY2FudiwgcGF0aCkge1xuICAvLyBzdGFydCBwYXRocyBvbiBjYW52YXNlc1xuICBjYW52LmNvbnQuYmVnaW5QYXRoKCk7XG4gIGNhbnYuY29udC5tb3ZlVG8ocGF0aFswXS54LCBwYXRoWzBdLnkpO1xuXG4gIC8vIGdvIHRocm91Z2ggcGF0aFxuICBmb3IgKHZhciBpID0gMTsgaSA8IHBhdGgubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgLy8gZ2V0IG5leHQgcG9pbnQgdG8gY3VydmUgYXJvdW5kXG4gICAgdmFyIHBvaW50MSA9IHBhdGhbaV0sXG4gICAgICBwb2ludDIgPSBwYXRoW2kgKyAxXSxcbiAgICAgIHF4LFxuICAgICAgcXk7XG5cbiAgICAvLyBnZXQgY3VydmUgdmFsdWVzXG4gICAgaWYgKGkgPCBwYXRoLmxlbmd0aCAtIDEpIHtcbiAgICAgIHF4ID0gKHBvaW50MS54ICsgcG9pbnQyLngpIC8gMjtcbiAgICAgIHF5ID0gKHBvaW50MS55ICsgcG9pbnQyLnkpIC8gMjtcbiAgICB9IGVsc2Uge1xuICAgICAgcXggPSBwb2ludDIueDtcbiAgICAgIHF5ID0gcG9pbnQyLnk7XG4gICAgfVxuXG4gICAgLy8gZHJhdyBjdXJ2ZSB0byBwYXRoXG4gICAgY2Fudi5jb250LnF1YWRyYXRpY0N1cnZlVG8ocG9pbnQxLngsIHBvaW50MS55LCBxeCwgcXkpO1xuICB9XG5cbiAgLy8gcmVqb2luIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHBhdGggYW5kIGZpbGxcbiAgY2Fudi5jb250LmxpbmVUbyhwYXRoWzBdLngsIHBhdGhbMF0ueSk7XG4gIGNhbnYuY29udC5maWxsKCk7XG59O1xuXG4vKiBEcmF3IGEgZGVjb3JhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5kcmF3X2RlY29yYXRpb24gPSBmdW5jdGlvbihjb250LCB4LCB5LCB0aWxlKSB7XG4gIC8vIGFyZSB3ZSBkcmF3aW5nIG9uZVxuICBpZiAodGlsZSA+IDcgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgIT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjYW4gd2UgZG8gZG91Ymxlc1xuICB2YXIgZG91YmxlID0gZmFsc2U7XG4gIGlmICh0aWxlID09PSAwICYmIHRoaXMuaXNfdHlwZSh5LCB4ICsgMSwgMCkpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSAxICYmIHRoaXMuaXNfdHlwZSh5LCB4IC0gMSwgMSkpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSAyICYmIHRoaXMuaXNfdHlwZSh5IC0gMSwgeCwgMikpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSAzICYmIHRoaXMuaXNfdHlwZSh5ICsgMSwgeCwgMykpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSA0ICYmIHRoaXMuaXNfdHlwZSh5IC0gMSwgeCArIDEsIDQpKSB7XG4gICAgZG91YmxlID0gdHJ1ZTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNSAmJiB0aGlzLmlzX3R5cGUoeSArIDEsIHggKyAxLCA1KSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDYgJiYgdGhpcy5pc190eXBlKHkgLSAxLCB4IC0gMSwgNikpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSA3ICYmIHRoaXMuaXNfdHlwZSh5ICsgMSwgeCAtIDEsIDcpKSB7XG4gICAgZG91YmxlID0gdHJ1ZTtcbiAgfVxuXG4gIC8vIGNob29zZSBzb3VyY2VcbiAgdmFyIHNvdXJjZSA9IHRoaXMucmVmLmRlY29yYXRpb25zWzFdO1xuICBpZiAoZG91YmxlICYmIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpID09PSAwKSB7XG4gICAgc291cmNlID0gdGhpcy5yZWYuZGVjb3JhdGlvbnNbMl07XG4gIH0gZWxzZSB7XG4gICAgZG91YmxlID0gZmFsc2U7XG4gIH1cblxuICAvLyBjaG9vc2UgZGVjb3JhdGlvblxuICB2YXIgaSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNvdXJjZS5sZW5ndGgpO1xuICB2YXIgcmVmID0gc291cmNlW2ldO1xuXG4gIC8vIGdldCBwb3NpdGlvbiB0byBkcmF3IGl0XG4gIHZhciBoYWxmID0gdGhpcy5zaXplIC8gMjtcbiAgdmFyIHgxID0gKHggKyAyKSAqIHRoaXMuc2l6ZTtcbiAgdmFyIHkxID0gKHkgKyAyKSAqIHRoaXMuc2l6ZTtcbiAgdmFyIGFuZ2xlID0gMDtcbiAgaWYgKHRpbGUgPT09IDEpIHtcbiAgICB4MSArPSB0aGlzLnNpemU7XG4gICAgeTEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMTgwO1xuICB9XG4gIGlmICh0aWxlID09PSAyKSB7XG4gICAgeTEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMjcwO1xuICB9XG4gIGlmICh0aWxlID09PSAzKSB7XG4gICAgeDEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gOTA7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDQpIHtcbiAgICB5MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSAzMTU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDUpIHtcbiAgICBhbmdsZSA9IDQ1O1xuICB9XG4gIGlmICh0aWxlID09PSA2KSB7XG4gICAgeDEgKz0gdGhpcy5zaXplO1xuICAgIHkxICs9IHRoaXMuc2l6ZTtcbiAgICBhbmdsZSA9IDIyNTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNykge1xuICAgIHgxICs9IHRoaXMuc2l6ZTtcbiAgICBhbmdsZSA9IDEzNTtcbiAgfVxuXG4gIC8vIGRyYXcgdGhhdCBzaGl0XG4gIHZhciB4X2FkZCA9IGRvdWJsZSA/IHRoaXMuc2l6ZSA6IDA7XG4gIGNvbnQuc2F2ZSgpO1xuICBjb250LnRyYW5zbGF0ZSh4MSwgeTEpO1xuICBjb250LnJvdGF0ZSgoYW5nbGUgKiBNYXRoLlBJKSAvIDE4MCk7XG4gIGNvbnQuZHJhd0ltYWdlKFxuICAgIHRoaXMuaW1nLmRlY29yYXRpb25zLFxuICAgIHJlZi54LFxuICAgIHJlZi55LFxuICAgIHJlZi53LFxuICAgIHJlZi5oLFxuICAgIDAsXG4gICAgLXJlZi5oICsgNSxcbiAgICByZWYudyxcbiAgICByZWYuaFxuICApO1xuICBjb250LnRyYW5zbGF0ZSgteDEsIC15MSk7XG4gIGNvbnQucmVzdG9yZSgpO1xufTtcblxuLyogRHJhdyBhIHRpbGUgdG8gYSBjYW52YXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuZHJhd190b19jYW52YXMgPSBmdW5jdGlvbihjb250LCB4LCB5LCB0aWxlLCBrZXkpIHtcbiAgdmFyIHRzID0gdGhpcy5zaXplO1xuICBjb250LnNhdmUoKTtcbiAgY29udC50cmFuc2xhdGUoeCwgeSk7XG4gIGNvbnQuZHJhd0ltYWdlKHRoaXMuaW1nLmVkZ2UsIHRpbGUgKiB0cywga2V5ICogdHMsIHRzLCB0cywgMCwgMCwgdHMsIHRzKTtcbiAgY29udC50cmFuc2xhdGUoLXksIC15KTtcbiAgY29udC5yZXN0b3JlKCk7XG59O1xuXG4vKiBHZXQgY29ybmVyIGFuZCBsYW5kIHRpbGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLnNldF9jb3JuZXJfdGlsZSA9IGZ1bmN0aW9uKHksIHgpIHtcbiAgdmFyIHRpbGUgPSAtMTtcblxuICAvL2xhbmRcbiAgaWYgKHRoaXMuaXNfbGFuZCh5LCB4KSkge1xuICAgIHRpbGUgPSAxMjtcblxuICAgIC8vIG5vdCBsYW5kXG4gIH0gZWxzZSB7XG4gICAgLy8gY29ybmVyc1xuICAgIGlmIChcbiAgICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDQ7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDU7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDY7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgIHRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDc7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRpbGU7XG59O1xuXG4vKiBTZXQgbGFuZCB0aWxlIHR5cGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLnNldF9sYW5kX3RpbGUgPSBmdW5jdGlvbih5LCB4KSB7XG4gIHZhciB0aWxlID0gMTI7XG5cbiAgLy8gY29ybmVyc1xuICBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAhdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSArIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCAtIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgLSAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gNDtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4IC0gMSkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHkgKyAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSAtIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSA1O1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHkgLSAxLCB4KSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSwgeCArIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHksIHggLSAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5ICsgMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDY7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSAtIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCArIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgKyAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gNztcblxuICAgIC8vIGZsYXQgZWRnZXNcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgIHRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSAtIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSAwO1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5ICsgMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDE7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICB0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHksIHggLSAxKVxuICApIHtcbiAgICB0aWxlID0gMjtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCArIDEpXG4gICkge1xuICAgIHRpbGUgPSAzO1xuXG4gICAgLy8gaW5zaWRlIGNvcm5lcnNcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSArIDEsIHgsIDcpIHx8IHRoaXMuaXNfdHlwZSh5LCB4ICsgMSwgNykpIHtcbiAgICB0aWxlID0gODtcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSArIDEsIHgsIDYpIHx8IHRoaXMuaXNfdHlwZSh5LCB4IC0gMSwgNikpIHtcbiAgICB0aWxlID0gOTtcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSAtIDEsIHgsIDUpIHx8IHRoaXMuaXNfdHlwZSh5LCB4ICsgMSwgNSkpIHtcbiAgICB0aWxlID0gMTA7XG4gIH0gZWxzZSBpZiAodGhpcy5pc190eXBlKHkgLSAxLCB4LCA0KSB8fCB0aGlzLmlzX3R5cGUoeSwgeCAtIDEsIDQpKSB7XG4gICAgdGlsZSA9IDExO1xuICB9XG5cbiAgcmV0dXJuIHRpbGU7XG59O1xuXG4vKiBDaGVjayBhcnJheXMgZm9yIHZhbHVlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc19sYW5kX29yX2Nvcm5lciA9IGZ1bmN0aW9uKHksIHgpIHtcbiAgaWYgKHRoaXMuaXNfY29ybmVyKHksIHgpIHx8IHRoaXMuaXNfbGFuZCh5LCB4KSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuaXNfY29ybmVyID0gZnVuY3Rpb24oeSwgeCkge1xuICByZXR1cm4gdGhpcy5jaGVja19hcnIodGhpcy50aWxlcywgeSwgeCwgWzQsIDUsIDYsIDddKTtcbn07XG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc190eXBlID0gZnVuY3Rpb24oeSwgeCwgdHlwZSkge1xuICByZXR1cm4gdGhpcy5jaGVja19hcnIodGhpcy50aWxlcywgeSwgeCwgW3R5cGVdKTtcbn07XG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc19sYW5kID0gZnVuY3Rpb24oeSwgeCkge1xuICByZXR1cm4gdGhpcy5jaGVja19hcnIodGhpcy5sYW5kLCB5LCB4LCBbMV0pO1xufTtcblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmNoZWNrX2FyciA9IGZ1bmN0aW9uKGFyciwgeSwgeCwgY2hlY2tzKSB7XG4gIGlmICh5IDwgMCB8fCB5ID49IGFyci5sZW5ndGggfHwgeCA8IDAgfHwgeCA+PSBhcnJbMF0ubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2hlY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGFyclt5XVt4XSA9PSBjaGVja3NbaV0pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR2VuZXJhdG9yXG5cdE1ha2UgQ2FudmFzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGEgbmV3IGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbl9jYW52YXModywgaCkge1xuICB2YXIgb2JqID0ge307XG4gIGlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBnbG9iYWwpIHtcbiAgICBvYmouY2FudiA9IG5ldyBjYW52YXMoKTtcbiAgfSBlbHNlIHtcbiAgICBvYmouY2FudiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIH1cbiAgb2JqLmNvbnQgPSBvYmouY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIG9iai5jYW52LndpZHRoID0gdztcbiAgb2JqLmNhbnYuaGVpZ2h0ID0gaDtcbiAgb2JqLmNvbnQuZmlsbFN0eWxlID0gXCIjZmZmXCI7XG4gIG9iai53ID0gdztcbiAgb2JqLmggPSBoO1xuICByZXR1cm4gb2JqO1xufVxuXG4vKiBEcmF3IGEgcGF0dGVybiB0byBhIGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbl9wYXR0ZXJuKGFscGhhLCBwYXR0ZXJuKSB7XG4gIHZhciBjYW52ID0gbWFwZ2VuX2NhbnZhcyhhbHBoYS53aWR0aCwgYWxwaGEuaGVpZ2h0KTtcbiAgaWYgKHR5cGVvZiBwYXR0ZXJuICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcGF0dGVybiA9IGNhbnYuY29udC5jcmVhdGVQYXR0ZXJuKHBhdHRlcm4sIFwicmVwZWF0XCIpO1xuICB9XG4gIGNhbnYuY29udC5maWxsU3R5bGUgPSBwYXR0ZXJuO1xuICBjYW52LmNvbnQuZmlsbFJlY3QoMCwgMCwgYWxwaGEud2lkdGgsIGFscGhhLmhlaWdodCk7XG4gIGNhbnYuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcImRlc3RpbmF0aW9uLWluXCI7XG4gIGNhbnYuY29udC5kcmF3SW1hZ2UoYWxwaGEsIDAsIDApO1xuICBjYW52LmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJub3JtYWxcIjtcblxuICByZXR1cm4gY2Fudjtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR2VuZXJhdG9yXG5cdC0tLS0tLS0tLS0tLVxuXHRDb25maWc6XG5cdHcgICAgICAgICAgIC8vIHdpZHRoIG9mIG1hcFxuXHRoICAgICAgICAgICAvLyBoZWlnaHQgb2YgbWFwXG5cdGNydXN0ICAgICAgIC8vIHRoaWNrbmVzcyBvZiBvdXRlciBjcnVzdCBvbiBsYW5kXG5cdGJsb2JzICAgICAgIC8vIGluaXRpYWwgYmxvYnNcblx0Y2VudGVyX2Jsb2IgLy8gc2l6ZSBvZiBjZW50ZXIgYmxvYiBvZiBsYW5kLCAwIGZvciBub25lXG5cdHNtYWxsX2Jsb2JzIC8vIG51bWJlciBvZiByYW5kb20gc21hbGwgY2lyY2xlcyBvZiBsYW5kXG5cdGxhcmdlX2Jsb2JzIC8vIG51bWJlciBvZiByYW5kb20gbGFyZ2UgY2lyY2xlcyBvZiBsYW5kXG5cdC0tLS0tLS0tLS0tXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2VydmVyIHNpZGUgb25seVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBnbG9iYWwpIHtcbiAgdmFyIGZzID0gcmVxdWlyZShcImZzXCIpO1xufVxuXG4vKiBOZXcgTWFwIEdlbmVyYXRpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBtYXBnZW4oaW1nLCBjb25maWcsIHNjaGVtZSwgbWFwX2ltZykge1xuICB0aGlzLnNpemUgPSAzNjtcbiAgdGhpcy5pbWcgPSBpbWc7XG4gIHRoaXMuYyA9IGNvbmZpZztcbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG5cbiAgLy8gY2hvb3NlIHR5cGVcbiAgaWYgKHRoaXMuc2NoZW1lLnR5cGUgPT0gXCJyYW5kb21cIikge1xuICAgIHJldHVybiB0aGlzLmRyYXdfcmFuZG9tKCk7XG4gIH1cbiAgaWYgKHRoaXMuc2NoZW1lLnR5cGUgPT0gXCJpbWFnZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZHJhd19pbWFnZShtYXBfaW1nKTtcbiAgfVxufVxuXG4vKiBEcmF3IGltYWdlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuLnByb3RvdHlwZS5kcmF3X2ltYWdlID0gZnVuY3Rpb24obWFwX2ltZykge1xuICB2YXIgZmcgPSBtYXBnZW5fY2FudmFzKFxuICAgIG1hcF9pbWcud2lkdGggKyB0aGlzLnNjaGVtZS5nYXAgKiAyLFxuICAgIG1hcF9pbWcuaGVpZ2h0ICsgdGhpcy5zY2hlbWUuZ2FwICogMlxuICApO1xuICBmZy5jb250LmRyYXdJbWFnZShtYXBfaW1nLCB0aGlzLnNjaGVtZS5nYXAsIHRoaXMuc2NoZW1lLmdhcCk7XG4gIHZhciBiZyA9IG1hcGdlbl9wYXR0ZXJuKGZnLmNhbnYsIHRoaXMuaW1nLmRpcnQpO1xuICByZXR1cm4geyBmZzogZmcsIGJnOiBiZyB9O1xufTtcblxuLyogRHJhdyByYW5kb21cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmRyYXdfcmFuZG9tID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldHVwXG4gIHRoaXMuYmxvYnMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuc2NoZW1lLmJsb2JzKSk7XG4gIHRoaXMuYmcgPSBtYXBnZW5fY2FudmFzKHRoaXMuc2NoZW1lLncsIHRoaXMuc2NoZW1lLmgpO1xuICB0aGlzLmZnID0gbWFwZ2VuX2NhbnZhcyh0aGlzLnNjaGVtZS53LCB0aGlzLnNjaGVtZS5oKTtcblxuICAvLyBnZW5lcmF0ZSBzb21lIHJhbmRvbSBsYXJnZSBjaXJjbGVzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUubGFyZ2VfYmxvYnM7IGkrKykge1xuICAgIHRoaXMuYmxvYnMgPSB0aGlzLmdldF9jaXJjbGUodGhpcy5ibG9icywgNCwgNik7XG4gIH1cblxuICAvLyBnZW5lcmF0ZSBzb21lIHJhbmRvbSBzbWFsbCBjaXJjbGVzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUuc21hbGxfYmxvYnM7IGkrKykge1xuICAgIHRoaXMuYmxvYnMgPSB0aGlzLmdldF9jaXJjbGUodGhpcy5ibG9icywgMSwgMyk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGVhY2ggYmxvYlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmxvYnMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgYmxvYiA9IHRoaXMuYmxvYnNbaV07XG5cbiAgICAvLyBjcmVhdGUgdGhlIGJsb2JzXG4gICAgdmFyIGJnID0gbmV3IG1hcGdlbl9ibG9iKHRoaXMuaW1nLCB0aGlzLmMsIGZhbHNlLCBibG9iLnIgKyA0LCBibG9iLnR5cGUpO1xuICAgIHZhciBmZyA9IG5ldyBtYXBnZW5fYmxvYihcbiAgICAgIHRoaXMuaW1nLFxuICAgICAgdGhpcy5jLFxuICAgICAgdGhpcy5zY2hlbWUuZGVjb3JhdGlvbnMsXG4gICAgICBibG9iLnIsXG4gICAgICBibG9iLnR5cGVcbiAgICApO1xuXG4gICAgLy8gY29tYmluZSB0aGUgYmFja2dyb3VuZHNcbiAgICB2YXIgd2ggPSBmZy5mZy5jYW52LndpZHRoO1xuICAgIHZhciBuZXdfYmcgPSBtYXBnZW5fY2FudmFzKHdoLCB3aCk7XG4gICAgbmV3X2JnLmNvbnQuZHJhd0ltYWdlKGJnLmZnLmNhbnYsIHdoICogMC4xLCB3aCAqIDAuMSwgd2ggKiAwLjgsIHdoICogMC44KTtcbiAgICBuZXdfYmcuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1hdG9wXCI7XG4gICAgbmV3X2JnLmNvbnQuZmlsbFN0eWxlID0gXCJyZ2JhKDAsMCwwLDAuOClcIjtcbiAgICBuZXdfYmcuY29udC5maWxsUmVjdCgwLCAwLCB3aCwgd2gpO1xuICAgIG5ld19iZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwibm9ybWFsXCI7XG4gICAgbmV3X2JnLmNvbnQuZHJhd0ltYWdlKGZnLmJnLmNhbnYsIDAsIDApO1xuXG4gICAgLy8gZHJhdyBpdCB0byBtYWluIGNhbnZhc1xuICAgIHRoaXMuYmcuY29udC5kcmF3SW1hZ2UobmV3X2JnLmNhbnYsIGJsb2IueCAtIHdoIC8gMiwgYmxvYi55IC0gd2ggLyAyKTtcbiAgICB0aGlzLmZnLmNvbnQuZHJhd0ltYWdlKGZnLmZnLmNhbnYsIGJsb2IueCAtIHdoIC8gMiwgYmxvYi55IC0gd2ggLyAyKTtcbiAgfVxuXG4gIC8vIHJldHVybiBpdFxuICByZXR1cm4ge1xuICAgIGJnOiB0aGlzLmJnLFxuICAgIGZnOiB0aGlzLmZnXG4gIH07XG59O1xuXG4vKiBHZXQgYSBmYXIgYXdheSBjaXJjbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmdldF9jaXJjbGUgPSBmdW5jdGlvbihhcnIsIG1pbl9yYWRpdXMsIG1heF9yYWRpdXMpIHtcbiAgLy8gZ2VuZXJhdGUgbWFueSBjaXJjbGVzIGFuZCBmaW5kIGZ1cnRoZXN0IGF3YXlcbiAgdmFyIGRpc3RhbmNlID0gMDtcbiAgdmFyIGNpcmNsZSA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAyMDsgaSsrKSB7XG4gICAgLy8gbWFrZSBuZXcgY2lyY2xlXG4gICAgdmFyIHRlc3RfY2lyY2xlID0gdGhpcy5jaXJjbGUobWluX3JhZGl1cywgbWF4X3JhZGl1cyk7XG4gICAgdmFyIHNtYWxsZXN0X2Rpc3RhbmNlID0gOTk5OTk5O1xuXG4gICAgLy8gZmluZCBzaG9ydGVzdCBkaXN0YW5jZSBmcm9tIGFsbCBvdGhlciBjaXJjbGVzXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBhcnIubGVuZ3RoOyBqKyspIHtcbiAgICAgIHZhciBkeCA9IGFycltqXS54IC0gdGVzdF9jaXJjbGUueDtcbiAgICAgIHZhciBkeSA9IGFycltqXS55IC0gdGVzdF9jaXJjbGUueTtcbiAgICAgIHZhciB0ZXN0X2Rpc3RhbmNlID0gTWF0aC5yb3VuZChcbiAgICAgICAgTWF0aC5zcXJ0KE1hdGgucG93KGR4LCAyKSArIE1hdGgucG93KGR5LCAyKSlcbiAgICAgICk7XG4gICAgICBzbWFsbGVzdF9kaXN0YW5jZSA9XG4gICAgICAgIHRlc3RfZGlzdGFuY2UgPCBzbWFsbGVzdF9kaXN0YW5jZSA/IHRlc3RfZGlzdGFuY2UgOiBzbWFsbGVzdF9kaXN0YW5jZTtcbiAgICB9XG5cbiAgICAvLyBpZiBpcyB0aGUgbGFyZ2VzdCBkaXN0YW5jZSByZWNvcmQgdGhpcyBhcyBmdXJ0aGVzdFxuICAgIGlmIChkaXN0YW5jZSA8IHNtYWxsZXN0X2Rpc3RhbmNlKSB7XG4gICAgICBkaXN0YW5jZSA9IHNtYWxsZXN0X2Rpc3RhbmNlO1xuICAgICAgY2lyY2xlID0gdGVzdF9jaXJjbGU7XG4gICAgfVxuICB9XG5cbiAgLy8gYWRkIGZ1cnRoZXN0IGF3YXkgY2lyY2xlIHRvIG5ldyBhcnJheVxuICBhcnIucHVzaChjaXJjbGUpO1xuICByZXR1cm4gYXJyO1xufTtcblxuLyogR2VuZXJhdGUgYSByYW5kb20gY2lyY2xlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuLnByb3RvdHlwZS5jaXJjbGUgPSBmdW5jdGlvbihtaW5fcmFkaXVzLCBtYXhfcmFkaXVzKSB7XG4gIHZhciByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4X3JhZGl1cykgKyBtaW5fcmFkaXVzO1xuICB2YXIgZ2FwID0gKHIgKyAyKSAqIHRoaXMuc2l6ZSArIHRoaXMuc2NoZW1lLmdhcDtcbiAgdmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5zY2hlbWUudyAtIGdhcCAqIDIpKSArIGdhcDtcbiAgdmFyIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5zY2hlbWUuaCAtIGdhcCAqIDIpKSArIGdhcDtcbiAgcmV0dXJuIHtcbiAgICByOiByLFxuICAgIHg6IHgsXG4gICAgeTogeVxuICB9O1xufTtcbiIsInZhciBzY2hlbWVzID0gc2NoZW1lcyB8fCB7fTtcbnNjaGVtZXMuZGVhdGhtYXRjaCA9IHtcbiAgdGl0bGU6IFwiRGVhdGhtYXRjaFwiLFxuICB0aW1lX2xpbWl0OiA1ODAwLFxuICBkZXN0cm95X2xhbmQ6IHRydWUsXG4gIGdyYXZpdHk6IDIsXG4gIHNjb3JlOiB0cnVlLFxuICBkcm9wczoge1xuICAgIGNyYXRlOiB7XG4gICAgICB0aW1lOiAxMDAsXG4gICAgICBtYXg6IDFcbiAgICB9LFxuICAgIG1lZHBhY2s6IHtcbiAgICAgIHRpbWU6IDEwMCxcbiAgICAgIGFkZDogMzAsXG4gICAgICBtYXg6IDFcbiAgICB9LFxuICAgIFwiZ2VtLTFcIjoge1xuICAgICAgdGltZTogMTAwLFxuICAgICAgbWF4OiA1XG4gICAgfSxcbiAgICBcImdlbS01XCI6IHtcbiAgICAgIHRpbWU6IDE1MCxcbiAgICAgIG1heDogMVxuICAgIH0sXG4gICAgXCJnZW0tMjBcIjoge1xuICAgICAgdGltZTogNTAwLFxuICAgICAgbWF4OiAxXG4gICAgfVxuICB9LFxuICB3ZWFwb25zOiB7XG4gICAgZGlnOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHBoYXNlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBiYXpvb2tvaWQ6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAtMSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgZ3JlbmFkZToge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBwdW5jaDoge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBwdW1wa2luOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMSxcbiAgICAgIGNyYXRlX2NvdW50OiA1XG4gICAgfSxcbiAgICBwYWluZ2l2ZXI6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAxLFxuICAgICAgY3JhdGVfY291bnQ6IDVcbiAgICB9XG4gIH0sXG4gIG1hcGdlbjoge1xuICAgIHR5cGU6IFwicmFuZG9tXCIsXG4gICAgc3JjOiBcIlwiLFxuICAgIGdhcDogMjAsXG4gICAgdzogMTkwMCxcbiAgICBoOiAxNDAwLFxuICAgIGJsb2JzOiBbXSxcbiAgICBkZWNvcmF0aW9uczogdHJ1ZSxcbiAgICBzbWFsbF9ibG9iczogNSxcbiAgICBsYXJnZV9ibG9iczogM1xuICB9LFxuICBldmVudHM6IHtcbiAgICBmcmFtZToge30sXG4gICAgY29sbGVjdDoge30sXG4gICAgZGVzdHJveToge30sXG4gICAgdGltZW91dDoge30sXG4gICAgZGVzdHJveV9vYmpfdHlwZToge30sXG4gICAgZGVzdHJveV9vYmpfcGxheWVyOiB7fVxuICB9XG59O1xuIiwidmFyIHNjaGVtZXMgPSBzY2hlbWVzIHx8IHt9O1xuc2NoZW1lcy5kZWZhdWx0ID0ge1xuICB0aXRsZTogXCJcIixcbiAgZGVzY3JpcHRpb246IFwiXCIsXG4gIHRpbWVfbGltaXQ6IDAsXG4gIHNob3dfdGltZTogdHJ1ZSxcbiAgZGVzdHJveV9sYW5kOiB0cnVlLFxuICBncmF2aXR5X3R5cGU6IFwibGFuZFwiLFxuICBncmF2aXR5OiAxLFxuICBzdGFyczoge30sXG4gIHNjb3JlOiBmYWxzZSxcbiAgaGVhbHRoOiB0cnVlLFxuICBsZXZlbHM6IHtcbiAgICBzY29yZTogW1xuICAgICAgMCxcbiAgICAgIDEwLFxuICAgICAgMjUsXG4gICAgICA0MCxcbiAgICAgIDYwLFxuICAgICAgOTAsXG4gICAgICAxMjAsXG4gICAgICAxNTAsXG4gICAgICAyMDAsXG4gICAgICAyNTAsXG4gICAgICAzMDAsXG4gICAgICAzNjAsXG4gICAgICA0MjAsXG4gICAgICA0OTAsXG4gICAgICA1NzAsXG4gICAgICA2NTAsXG4gICAgICA3MjAsXG4gICAgICA4MTAsXG4gICAgICA5MDAsXG4gICAgICAxMDAwXG4gICAgXSxcbiAgICBoZWFsdGg6IFtcbiAgICAgIDEwMCxcbiAgICAgIDEyMCxcbiAgICAgIDEyMCxcbiAgICAgIDEyMCxcbiAgICAgIDE0MCxcbiAgICAgIDE0MCxcbiAgICAgIDE0MCxcbiAgICAgIDE0MCxcbiAgICAgIDE2MCxcbiAgICAgIDE4MCxcbiAgICAgIDIwMCxcbiAgICAgIDIwMCxcbiAgICAgIDIwMCxcbiAgICAgIDIwMCxcbiAgICAgIDIyMCxcbiAgICAgIDIyMCxcbiAgICAgIDIyMCxcbiAgICAgIDIyMCxcbiAgICAgIDI0MCxcbiAgICAgIDMwMFxuICAgIF0sXG4gICAgZGFtYWdlOiBbXG4gICAgICAwLFxuICAgICAgMTAsXG4gICAgICAxMCxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDI1LFxuICAgICAgMjUsXG4gICAgICAyNSxcbiAgICAgIDMwLFxuICAgICAgMzAsXG4gICAgICAzMCxcbiAgICAgIDMwLFxuICAgICAgMzUsXG4gICAgICAzNSxcbiAgICAgIDM1LFxuICAgICAgNTBcbiAgICBdLFxuICAgIHNwZWVkOiBbXG4gICAgICA0LFxuICAgICAgNixcbiAgICAgIDgsXG4gICAgICA4LFxuICAgICAgOCxcbiAgICAgIDgsXG4gICAgICAxMCxcbiAgICAgIDEwLFxuICAgICAgMTAsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDE0LFxuICAgICAgMTQsXG4gICAgICAxNCxcbiAgICAgIDE0LFxuICAgICAgMTYsXG4gICAgICAxNixcbiAgICAgIDIwXG4gICAgXSxcbiAgICBqdW1wOiBbXG4gICAgICAxMCxcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAxOCxcbiAgICAgIDE4LFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDI1XG4gICAgXVxuICB9LFxuICBkcm9wczoge1xuICAgIGNyYXRlOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgbWF4OiAyMFxuICAgIH0sXG4gICAgbWVkcGFjazoge1xuICAgICAgdGltZTogMCxcbiAgICAgIGFkZDogMzAsXG4gICAgICBtYXg6IDUwXG4gICAgfSxcbiAgICBudWNsZWFyOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgbWF4OiAyMFxuICAgIH0sXG4gICAgdGFyZ2V0OiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgbWF4OiAxMDBcbiAgICB9LFxuICAgIGFzdGVyb2lkX2NlbnRlcjoge1xuICAgICAgdGltZTogMCxcbiAgICAgIGluY3JlYXNlX2ZyZXF1ZW5jeTogZmFsc2UsXG4gICAgICBtYXg6IDMwXG4gICAgfSxcbiAgICBcImdlbS0xXCI6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDIwXG4gICAgfVxuICB9LFxuICB3ZWFwb25zOiB7XG4gICAgZGlnOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHBoYXNlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIGJhem9va29pZDoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIGdyZW5hZGU6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBwdW5jaDoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bXBraW46IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IDFcbiAgICB9LFxuICAgIHBhaW5naXZlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogMTBcbiAgICB9XG4gIH0sXG4gIGFybW91cnk6IFtcbiAgICBcImRpZ1wiLFxuICAgIFwicGhhc2VyXCIsXG4gICAgXCJiYXpvb2tvaWRcIixcbiAgICBcImdyZW5hZGVcIixcbiAgICBcInB1bmNoXCIsXG4gICAgXCJwdW1wa2luXCIsXG4gICAgXCJwYWluZ2l2ZXJcIlxuICBdLFxuICBhcnJvd3M6IHtcbiAgICBudWNsZWFyOiBcImdyZWVuXCIsXG4gICAgcGxheWVyOiBcInJlZFwiLFxuICAgIHRhcmdldDogXCJibHVlXCIsXG4gICAgXCJhc3Rlcm9pZC1zbWFsbFwiOiBcImdyZXlcIixcbiAgICBcImFzdGVyb2lkLWxhcmdlXCI6IFwiZ3JleVwiLFxuICAgIHZvcnRleDogXCJwdXJwbGVcIixcbiAgICBjcmF0ZTogXCJibHVlXCJcbiAgfSxcbiAgc3Bhd246IFtdLFxuICBtYXBnZW46IHtcbiAgICB0eXBlOiBcInJhbmRvbVwiLFxuICAgIHNyYzogXCJcIixcbiAgICBnYXA6IDIwLFxuICAgIHc6IDEwMDAsXG4gICAgaDogMTAwMCxcbiAgICBibG9iczogW10sXG4gICAgZGVjb3JhdGlvbnM6IHRydWUsXG4gICAgc21hbGxfYmxvYnM6IDUsXG4gICAgbGFyZ2VfYmxvYnM6IDNcbiAgfSxcbiAgZXZlbnRzOiB7XG4gICAgZnJhbWU6IHt9LFxuICAgIGNvbGxlY3Q6IHt9LFxuICAgIGRlc3Ryb3k6IHt9LFxuICAgIHRpbWVvdXQ6IHt9LFxuICAgIGRlc3Ryb3lfb2JqX3R5cGU6IHt9LFxuICAgIGRlc3Ryb3lfb2JqX3BsYXllcjoge31cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR3Jhdml0eVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBncmF2aXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5pbml0X2dyYXZpdHkgPSBmdW5jdGlvbihncmF2aXR5X21hcCkge1xuICB0aGlzLndlaWdodCA9IHRoaXMuc2NoZW1lLmdyYXZpdHkgfHwgMTtcbiAgdGhpcy5ncmF2aXR5X3R5cGUgPSB0aGlzLnNjaGVtZS5ncmF2aXR5X3R5cGUgfHwgXCJsYW5kXCI7XG5cbiAgaWYgKHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSAhPT0gXCJsYW5kXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZXQgdmFsdWVzXG4gIHRoaXMuZ3Jhdml0eSA9IHtcbiAgICB3OiAwLFxuICAgIGg6IDAsXG4gICAgbWFwOiBbXSxcbiAgICBzY2FsZTogMjQsXG4gICAgcmVhY2g6IDE4XG4gIH07XG5cbiAgaWYgKGdyYXZpdHlfbWFwKSB7XG4gICAgdGhpcy5ncmF2aXR5Lm1hcCA9IEpTT04ucGFyc2UoZ3Jhdml0eV9tYXApO1xuICAgIHRoaXMuZ3Jhdml0eS53ID0gdGhpcy5ncmF2aXR5Lm1hcFswXS5sZW5ndGg7XG4gICAgdGhpcy5ncmF2aXR5LmggPSB0aGlzLmdyYXZpdHkubWFwLmxlbmd0aDtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmluaXRfZ3Jhdml0eV9tYXAoKTtcbiAgfVxufTtcblxuLyogR2VuZXJhdGUgZ3Jhdml0eSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuaW5pdF9ncmF2aXR5X21hcCA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZXQgc2l6ZSBvZiBuZXcgZ3Jhdml0eSBncmlkXG4gIHRoaXMuZ3Jhdml0eS53ID0gY2VpbCh0aGlzLncgLyB0aGlzLmdyYXZpdHkuc2NhbGUpO1xuICB0aGlzLmdyYXZpdHkuaCA9IGNlaWwodGhpcy5oIC8gdGhpcy5ncmF2aXR5LnNjYWxlKTtcblxuICAvLyBnZW5lcmF0ZSBtYXAgYXJyYXlcbiAgdmFyIG5ld19hcnIgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmdyYXZpdHkuaDsgeSsrKSB7XG4gICAgdGhpcy5ncmF2aXR5Lm1hcFt5XSA9IFtdO1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5ncmF2aXR5Lnc7IHgrKykge1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5XS5wdXNoKFswLCAwLCAwXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGhlIGNhbGN1bGF0aW5nXG4gIHRoaXMuYWN0aW9uX2dyYXZpdHlfZ2VuZXJhdGUoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xufTtcblxuLyogQXBwbHkgbmV3IGdyYXZpdHkgY2FsY3VsYXRpb25zIHRvIGEgc2V0IG9mIHBpeGVsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSA9IGZ1bmN0aW9uKHgsIHksIHcsIGgpIHtcbiAgLy8gY2FsY3VsYXRlIHdoaWNoIHRpbGVzIGFyZSBhZmZlY3RlZFxuICB2YXIgeDEgPSBtYXgoMCwgbWluKGZsb29yKHggLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTEgPSBtYXgoMCwgbWluKGZsb29yKHkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKGZsb29yKCh4ICsgdykgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTIgPSBtYXgoMCwgbWluKGZsb29yKCh5ICsgaCkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCkpO1xuXG4gIC8vIGdldCB0aGUgd2VpZ2h0IG9mIGFsbCBhZmZlY3RlZCB0aWxlc1xuICBmb3IgKHZhciB5MyA9IHkxOyB5MyA8IHkyOyB5MysrKSB7XG4gICAgZm9yICh2YXIgeDMgPSB4MTsgeDMgPCB4MjsgeDMrKykge1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdID0gdGhpcy5nZXRfdGlsZV93ZWlnaHQoeDMsIHkzKTtcbiAgICB9XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgc3Vycm91bmRpbmcgdGlsZXNcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4MSAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5MSAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcbiAgdmFyIHgyID0gbWF4KDAsIG1pbih4MiArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5MiArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcblxuICAvLyBnbyB0aHJvdWdoIHN1cnJvdW5kaW5nIHRpbGVzIHRvIGdldCBncmF2aXR5XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB2YXIgeHkgPSB0aGlzLmdldF90aWxlX2dyYXZpdHkoeDMsIHkzKTtcbiAgICAgIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVsxXSA9IHh5Lng7XG4gICAgICB0aGlzLmdyYXZpdHkubWFwW3kzXVt4M11bMl0gPSB4eS55O1xuICAgIH1cbiAgfVxufTtcblxuLyogR2V0IHdlaWdodCBvZiBhIHRpbGUgaW4gdGhlIGdyYXZpdHkgbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF90aWxlX3dlaWdodCA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gbGltaXQgeCBhbmQgeSB0byB3aXRoaW4gdGhlIGFyZWFcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5ICogdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLmgpKTtcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4ICogdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5ICogdGhpcy5ncmF2aXR5LnNjYWxlICsgdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLmgpKTtcbiAgdmFyIHgyID0gbWF4KDAsIG1pbih4ICogdGhpcy5ncmF2aXR5LnNjYWxlICsgdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLncpKTtcblxuICAvLyBnbyB0aHJvdWdoIHRoZSBncmlkIG9mIHBpeGVsc1xuICB2YXIgYyA9IDA7XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB2YXIgaWQgPSB0aGlzLmkoeDMsIHkzKTtcbiAgICAgIGlmIChpZCA9PSAxIHx8IGlkID09IDIpIHtcbiAgICAgICAgYyArPSAxO1xuICAgICAgfVxuICAgICAgaWYgKGlkID09IDMpIHtcbiAgICAgICAgYyArPSAzO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYztcbn07XG5cbi8qIEdldCBncmF2aXR5IG9mIGEgdGlsZSBmcm9tIHRoZSB3ZWlnaHQgb2Ygc3Vycm91bmRpbmcgdGlsZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X3RpbGVfZ3Jhdml0eSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gY2FsY3VsYXRlIHN1cnJvdW5kaW5nIHRpbGVzXG4gIHZhciB3eCA9IDA7XG4gIHZhciB3eSA9IDA7XG4gIHZhciB4MSA9IG1heCgwLCBtaW4oeCAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5IC0gdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKHggKyB0aGlzLmdyYXZpdHkucmVhY2gsIHRoaXMuZ3Jhdml0eS53KSk7XG4gIHZhciB5MiA9IG1heCgwLCBtaW4oeSArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcblxuICAvLyBnbyB0aHJvdWdoIHN1cnJvdW5kaW5nIHRpbGVzIHRvIGdldCBncmF2aXR5XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB3eCArPSAoeDMgLSB4KSAqIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVswXTtcbiAgICAgIHd5ICs9ICh5MyAtIHkpICogdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdO1xuICAgIH1cbiAgfVxuXG4gIHd4ID0gcm91bmQod3ggLyA1MDAwIC8gdGhpcy5ncmF2aXR5LnJlYWNoKSAvIDYwO1xuICB3eSA9IHJvdW5kKHd5IC8gNTAwMCAvIHRoaXMuZ3Jhdml0eS5yZWFjaCkgLyA2MDtcblxuICByZXR1cm4ge1xuICAgIHg6IHd4LFxuICAgIHk6IHd5XG4gIH07XG59O1xuXG4vKiBSZXNldCBncmF2aXR5IGZyb20gZGVzdHJ1Y3Rpb24gZXZlbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3Jhdml0eV9ldmVudF9yZWNhbGN1bGF0ZSA9IGZ1bmN0aW9uKHgsIHksIHJhZGl1cykge1xuICAvLyBpZiB3ZSBhcmUgbm90IHVzaW5nIGxhbmQgZ3Jhdml0eVxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlICE9PSBcImxhbmRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJlY2FsY3VsYXRlIGdyYXZpdHlcbiAgdmFyIHgxID0gcm91bmQoeCAtIHJhZGl1cyk7XG4gIHZhciB5MSA9IHJvdW5kKHkgLSByYWRpdXMpO1xuICB2YXIgc2l6ZSA9IHJvdW5kKHJhZGl1cyAqIDIgKyAxKTtcbiAgdGhpcy5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSh4MSwgeTEsIHNpemUsIHNpemUpO1xufTtcblxuLyogUmV0dXJuIGdyYXZpdHkgZm9yIGNvLW9yZGluYXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZ3Jhdml0eSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gZmxhdFxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlID09PSBcImZsYXRcIikge1xuICAgIHJldHVybiB7IHg6IDAsIHk6IHRoaXMud2VpZ2h0IH07XG4gIH1cblxuICAvLyBtYXBcbiAgaWYgKHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSA9PT0gXCJsYW5kXCIpIHtcbiAgICB2YXIgeDEgPSBtYXgoMCwgbWluKHJvdW5kKHggLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudyAtIDEpKTtcbiAgICB2YXIgeTEgPSBtYXgoMCwgbWluKHJvdW5kKHkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCAtIDEpKTtcbiAgICB2YXIgb2JqID0gdGhpcy5ncmF2aXR5Lm1hcFt5MV1beDFdO1xuICAgIHJldHVybiB7XG4gICAgICB4OiBtaW4ob2JqWzFdLCAxKSAqIHRoaXMud2VpZ2h0LFxuICAgICAgeTogbWluKG9ialsyXSwgMSkgKiB0aGlzLndlaWdodFxuICAgIH07XG4gIH1cbn07XG5cbi8qIFJldHVybiB0aGUgYW5nbGUgb2YgZ3Jhdml0eSBmb3IgY28tb3JkaW5hdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9ncmF2aXR5X2FuZ2xlID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgZ3JhdiA9IHRoaXMuZ2V0X2dyYXZpdHkoeCwgeSk7XG4gIHZhciBhMSA9IGdldF9hbmdsZShncmF2LngsIGdyYXYueSk7XG4gIHJldHVybiBhMTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0TWFwIEdyb3VuZCBDaGVja2Vyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEdldCBhcnJheSBvZiBvZmZzZXRzIHRvIGNoZWNrIGluIGFuIGFuZ2xlcyBkaXJlY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2FuZ2xlX29mZnNldHMgPSBmdW5jdGlvbihhKSB7XG4gIGlmIChhID4gMjIgJiYgYSA8PSA2Nykge1xuICAgIHJldHVybiBbWy0xLCAtMV0sIFswLCAtMV0sIFstMSwgMF0sIFsxLCAtMV0sIFstMSwgMV0sIFsxLCAwXSwgWzAsIDFdXTtcbiAgfSAvLyB1cCBsZWZ0XG4gIGlmIChhID4gNjcgJiYgYSA8PSAxMTIpIHtcbiAgICByZXR1cm4gW1swLCAtMV0sIFstMSwgLTFdLCBbMSwgLTFdLCBbLTEsIDBdLCBbMSwgMF0sIFstMSwgMV0sIFsxLCAxXV07XG4gIH0gLy8gdXBcbiAgaWYgKGEgPiAxMTIgJiYgYSA8PSAxNTcpIHtcbiAgICByZXR1cm4gW1sxLCAtMV0sIFswLCAtMV0sIFsxLCAwXSwgWy0xLCAtMV0sIFsxLCAxXSwgWy0xLCAwXSwgWzAsIDFdXTtcbiAgfSAvLyB1cCByaWdodFxuICBpZiAoYSA+IDE1NyAmJiBhIDw9IDIwMikge1xuICAgIHJldHVybiBbWzEsIDBdLCBbMSwgLTFdLCBbMSwgMV0sIFswLCAtMV0sIFswLCAxXSwgWy0xLCAtMV0sIFstMSwgMV1dO1xuICB9IC8vIHJpZ2h0XG4gIGlmIChhID4gMjAyICYmIGEgPD0gMjQ3KSB7XG4gICAgcmV0dXJuIFtbMSwgMV0sIFsxLCAwXSwgWzAsIDFdLCBbMSwgLTFdLCBbLTEsIDFdLCBbMCwgLTFdLCBbLTEsIDBdXTtcbiAgfSAvLyBkb3duIHJpZ2h0XG4gIGlmIChhID4gMjQ3ICYmIGEgPD0gMjkyKSB7XG4gICAgcmV0dXJuIFtbMCwgMV0sIFstMSwgMV0sIFsxLCAxXSwgWy0xLCAwXSwgWzEsIDBdLCBbLTEsIC0xXSwgWzEsIC0xXV07XG4gIH0gLy8gZG93blxuICBpZiAoYSA+IDI5MiAmJiBhIDw9IDMzNykge1xuICAgIHJldHVybiBbWy0xLCAxXSwgWy0xLCAwXSwgWzAsIDFdLCBbLTEsIC0xXSwgWzEsIDFdLCBbMCwgLTFdLCBbMSwgMF1dO1xuICB9IC8vIGRvd24gbGVmdFxuICBpZiAoYSA+IDMzNyB8fCBhIDw9IDIyKSB7XG4gICAgcmV0dXJuIFtbLTEsIDBdLCBbLTEsIC0xXSwgWy0xLCAxXSwgWzAsIC0xXSwgWzAsIDFdLCBbMSwgLTFdLCBbMSwgMV1dO1xuICB9IC8vIGxlZnRcbn07XG5cbi8qIENhbGN1bGF0ZSB3YWxrIHBhdGggYnkgYW5nbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUud2FsayA9IGZ1bmN0aW9uKHgsIHksIHB4LCBweSwgYW5nbGUsIHNwZWVkKSB7XG4gIC8vIGdldCBuZWlnaGJvcmluZyBwaXhlbHNcbiAgdmFyIG9mZnNldHMgPSB0aGlzLmdldF9hbmdsZV9vZmZzZXRzKGFuZ2xlKTtcblxuICAvLyByZWNvcmQgb2xkIHBvc2l0aW9uXG4gIHZhciBveCA9IHg7XG4gIHZhciBveSA9IHk7XG5cbiAgLy8gcmVjb3JkIHJlc3VsdFxuICB2YXIgcmVzdWx0ID0ge1xuICAgIG1vdmU6IGZhbHNlLCAvLyB3ZSBhcmUgbW92aW5nXG4gICAgYW5nbGU6IDAsIC8vIGFjdHVhbCBhbmdsZSBvZiBtb3ZlbWVudFxuICAgIHBhdGg6IFtdIC8vIHJlY29yZGVkIGNvb3JkaW5hdGVzXG4gIH07XG5cbiAgLy8gZ28gdGhyb3VnaCBudW1iZXIgb2YgbW92ZW1lbnRzIHBlciBmcmFtZVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWVkOyBpKyspIHtcbiAgICB2YXIgbW92ZWQgPSBmYWxzZTtcblxuICAgIC8vIGdvIHRocm91Z2ggZGlyZWN0aW9uYWwgcGl4ZWxzIHRvIGNoZWNrIGJhc2VkIG9uIGFuZ2xlIG9mIHBhdGhcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9mZnNldHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIC8vIGNvLW9yZGluYXRlcyB3ZSdyZSBjaGVja2luZ1xuICAgICAgdmFyIHgxID0geCArIG9mZnNldHNbal1bMF07XG4gICAgICB2YXIgeTEgPSB5ICsgb2Zmc2V0c1tqXVsxXTtcblxuICAgICAgLy8gaWYgaXMgcHJldmlvdXMgbG9jYXRpb24sIGxhbmQgb3Igbm90IGFuIGVkZ2VcbiAgICAgIGlmICgoeDEgPT0gcHggJiYgeTEgPT0gcHkpIHx8ICF0aGlzLmdyb3VuZF9waXhlbCh4MSwgeTEpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBzZXQgbmV3IHBvc2l0aW9uXG4gICAgICBweCA9IHg7XG4gICAgICBweSA9IHk7XG4gICAgICB4ID0geDE7XG4gICAgICB5ID0geTE7XG4gICAgICByZXN1bHQubW92ZSA9IHRydWU7XG4gICAgICByZXN1bHQuYW5nbGUgPSBnZXRfaGVhZGluZyhveCwgb3ksIHgsIHkpO1xuICAgICAgcmVzdWx0LnBhdGgucHVzaCh7IHg6IHgxLCB5OiB5MSB9KTtcblxuICAgICAgdmFyIG1vdmVkID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIGlmIG1vdmVtZW50IGZhaWxlZFxuICAgIGlmICghbW92ZWQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCBkaXJlY3Rpb24gbGVmdCBvciByaWdodFxuICByZXN1bHQuZGlyZWN0aW9uID0gdGhpcy5ncm91bmRfZGlyKG94LCBveSwgeCwgeSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8qIENoZWNrIGEgcGl4ZWwgaXMgbmV4dCB0byBncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3JvdW5kX3BpeGVsID0gZnVuY3Rpb24oeCwgeSkge1xuICAvLyBpZiB3ZSBoYXZlIGhpdCBncm91bmRcbiAgaWYgKHRoaXMuaSh4LCB5KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciB0cmlnZ2VyID0gZmFsc2UsXG4gICAgb2ZmID0gW1xuICAgICAgWzAsIC0xXSxcbiAgICAgIFstMSwgMF0sXG4gICAgICBbMSwgMF0sXG4gICAgICBbMCwgMV0sXG4gICAgICBbLTEsIC0xXSxcbiAgICAgIFstMSwgMV0sXG4gICAgICBbMSwgMV0sXG4gICAgICBbMSwgLTFdXG4gICAgXTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IG9mZi5sZW5ndGg7IGkrKykge1xuICAgIC8vIGdvIHRocm91Z2ggb2Zmc2V0c1xuICAgIHZhciB4MSA9IHggKyBvZmZbaV1bMF07IC8vIG5ldyB4IGNvb3JkaW5hdGVcbiAgICB2YXIgeTEgPSB5ICsgb2ZmW2ldWzFdOyAvLyBuZXcgeSBjb29yZGluYXRlXG4gICAgaWYgKHRoaXMuaSh4MSwgeTEpKSB7XG4gICAgICAvLyBpZiBwaXhlbCBpcyBsYW5kXG4gICAgICB0cmlnZ2VyID0gdHJ1ZTsgLy8gd2UgZGlkIGl0XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJpZ2dlcjtcbn07XG5cbi8qIENhbGN1bGF0ZSBsZWZ0IG9yIHJpZ2h0IG1vdmVtZW50XG5cdC8vXG5cdC8vIGNhbGN1bGF0ZXMgZGlyZWN0aW9uIG9mIGxhbmQgZnJvbSBhIGxpbmUgb2YgbW92ZW1lbnRcblx0Ly8gMS4gcm90YXRlIGxpbmUgY29vcmRzIDkwIGRlZ3JlZXNcblx0Ly8gMi4gaWYgdGhlIHRvcCBwYXJ0IG9mIHRoZSBuZXcgbGluZSBoYXMgbW9yZSBsYW5kIHRoZW4gd2UgYXJlIG1vdmluZyByaWdodFxuXHQvLyAzLiBpZiB0aGUgYm90dG9tIHBhcnQgd2UgYXJlIG1vdmluZyBsZWZ0XG5cdC8vIDQuIGJhbmFuYXMsIGFsbCBvZiBpdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5ncm91bmRfZGlyID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcbiAgLy8gcm90YXRlIGNvLW9yZGluYXRlZCA5MCBkZWdyZWVzIHRvIHBvaW50IGludG8gdGhlIGdyb3VuZCB3ZSdyZSBvblxuICB2YXIgY2VudGVyX3ggPSB4MSArICh4MiAtIHgxKSAvIDI7XG4gIHZhciBjZW50ZXJfeSA9IHkxICsgKHkyIC0geTEpIC8gMjtcbiAgdmFyIHJvdGF0ZWRfMSA9IHJvdGF0ZV9jb29yZHMoeDEsIHkxLCBjZW50ZXJfeCwgY2VudGVyX3ksIDkwKTtcbiAgdmFyIHJvdGF0ZWRfMiA9IHJvdGF0ZV9jb29yZHMoeDIsIHkyLCBjZW50ZXJfeCwgY2VudGVyX3ksIDkwKTtcblxuICAvLyBwbG90IGEgY291cnNlIG9mIGNvLW9yZGluYXRlcyB0byBjaGVja1xuICB2YXIgc3BlZWRfeCA9IHRoaXMuZ2V0X2Rpc3RhbmNlX3gocm90YXRlZF8xLngsIHJvdGF0ZWRfMi54KTtcbiAgdmFyIHNwZWVkX3kgPSB0aGlzLmdldF9kaXN0YW5jZV95KHJvdGF0ZWRfMS55LCByb3RhdGVkXzIueSk7XG4gIHZhciBwbG90dGVkID0gcGxvdF9jb3Vyc2Uocm90YXRlZF8xLngsIHJvdGF0ZWRfMS55LCBzcGVlZF94LCBzcGVlZF95LCA4KTtcbiAgaWYgKCFwbG90dGVkLm1vdmUpIHtcbiAgICByZXR1cm4gXCJyaWdodFwiO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBjb3Vyc2UgYW5kIGNvdW50IHdoaWNoIHNpZGUgaGFzIG1vcmUgbGFuZCBvbiBpdFxuICB2YXIgY291bnRfbGVmdCA9IDAsXG4gICAgY291bnRfcmlnaHQgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsb3R0ZWQucG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHBvaW50ID0gcGxvdHRlZC5wb2ludHNbaV07XG4gICAgaWYgKHRoaXMuaShyb3VuZChwb2ludC54KSwgcm91bmQocG9pbnQueSkpKSB7XG4gICAgICBpZiAoaSA8IHBsb3R0ZWQucG9pbnRzLmxlbmd0aCAvIDIpIHtcbiAgICAgICAgY291bnRfcmlnaHQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvdW50X2xlZnQrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvdW50X2xlZnQgPiBjb3VudF9yaWdodCA/IFwibGVmdFwiIDogXCJyaWdodFwiO1xufTtcblxuLyogU2V0IHZhbHVlcyBpbiBhIGNpcmNsZSBpbiB0aGUgZ3JvdW5kIGFycmF5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLnNldF9jaXJjbGUgPSBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHR5cGUpIHtcbiAgLy8gZ2V0IGJvdW5kYXJpZXNcbiAgdmFyIHgxID0gbWF4KHJvdW5kKHggLSByYWRpdXMpLCAwKTtcbiAgdmFyIHgyID0gbWluKHJvdW5kKHggKyByYWRpdXMpLCB0aGlzLncgLSAxKTtcbiAgdmFyIHkxID0gbWF4KHJvdW5kKHkgLSByYWRpdXMpLCAwKTtcbiAgdmFyIHkyID0gbWluKHJvdW5kKHkgKyByYWRpdXMpLCB0aGlzLmggLSAxKTtcblxuICAvLyBsb29wIHRocm91Z2ggY28tb3JkaW5hdGVzXG4gIGZvciAodmFyIGx5ID0geTE7IGx5IDw9IHkyOyBseSsrKSB7XG4gICAgZm9yICh2YXIgbHggPSB4MTsgbHggPD0geDI7IGx4KyspIHtcbiAgICAgIGlmIChpbl9jaXJjbGUobHgsIGx5LCB4LCB5LCByYWRpdXMpKSB7XG4gICAgICAgIHRoaXMuaV9zZXQobHgsIGx5LCB0eXBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFNldCBibG9jayBvZiBjZWxscyBmcm9tIGFyclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5zZXRfYmxvY2tfZnJvbV9hcnIgPSBmdW5jdGlvbih4LCB5LCBhcnIpIHtcbiAgZm9yICh2YXIgbHkgPSAwOyBseSA8IGFyci5sZW5ndGg7IGx5KyspIHtcbiAgICBmb3IgKHZhciBseCA9IDA7IGx4IDwgYXJyW2x5XS5sZW5ndGg7IGx4KyspIHtcbiAgICAgIHRoaXMuaV9zZXQoeCArIGx4LCB5ICsgbHksIGFycltseV1bbHhdKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIEdldCBibG9jayBvZiBjZWxsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfYmxvY2sgPSBmdW5jdGlvbih4LCB5LCB3LCBoKSB7XG4gIHZhciByZXNwb25zZSA9IFtdO1xuXG4gIC8vIGxvb3AgdGhyb3VnaCBjby1vcmRpbmF0ZXNcbiAgZm9yICh2YXIgbHkgPSAwOyBseSA8IGg7IGx5KyspIHtcbiAgICByZXNwb25zZVtseV0gPSBbXTtcbiAgICBmb3IgKHZhciBseCA9IDA7IGx4IDwgdzsgbHgrKykge1xuICAgICAgcmVzcG9uc2VbbHldW2x4XSA9IHRoaXMuaShseCArIHgsIGx5ICsgeSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogRmluZCBuZWFyYnkgZ3JvdW5kIHNwb3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZmluZF9ncm91bmRfbmVhcmJ5ID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgeDEgPSByb3VuZCh4KTtcbiAgdmFyIHkxID0gcm91bmQoeSk7XG5cbiAgLy8gYWxyZWFkeSBvbiBncm91bmRcbiAgaWYgKHRoaXMuZ3JvdW5kX3BpeGVsKHgxLCB5MSkpIHtcbiAgICByZXR1cm4geyB4OiB4MSwgeTogeTEgfTtcbiAgfVxuXG4gIHZhciBzcGlyYWxfMSA9IDA7XG4gIHZhciBzcGlyYWxfMiA9IDE7XG4gIHZhciBpbmMgPSAxO1xuICB2YXIgZGlyID0gdHJ1ZTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IDQ1MDsgaSsrKSB7XG4gICAgeDEgKz0gZGlyID8gaW5jIDogMDtcbiAgICB5MSArPSAhZGlyID8gaW5jIDogMDtcbiAgICBzcGlyYWxfMSsrO1xuICAgIGlmIChzcGlyYWxfMSA9PSBzcGlyYWxfMikge1xuICAgICAgc3BpcmFsXzEgPSAwO1xuICAgICAgaWYgKChkaXIgPSAhZGlyKSkge1xuICAgICAgICBpbmMgPSBpbmMgPT0gMSA/IC0xIDogMTtcbiAgICAgICAgc3BpcmFsXzIrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjaGVjayBwb2ludCBmb3IgZ3JvdW5kIHBpeGVsc1xuICAgIGlmICh0aGlzLmdyb3VuZF9waXhlbCh4MSwgeTEpKSB7XG4gICAgICByZXR1cm4geyB4OiB4MSwgeTogeTEgfTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyogR2V0IHJhbmRvbSBlbXB0eSBzcG90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmFpcl9maW5kX3Nwb3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGxpbWl0ID0gNTAwO1xuICB2YXIgbiA9IDA7XG5cbiAgd2hpbGUgKG4gPCBsaW1pdCkge1xuICAgIHZhciB4ID0gcmFuZCgwLCB0aGlzLncpLFxuICAgICAgeSA9IHJhbmQoMCwgdGhpcy5oKSxcbiAgICAgIGlkID0gdGhpcy5pKHgsIHkpO1xuXG4gICAgLy8gaWYgYWlyIHBpeGVsXG4gICAgaWYgKGlkID09IDApIHtcbiAgICAgIHJldHVybiB7IHg6IHgsIHk6IHkgfTtcbiAgICB9XG5cbiAgICAvLyBjb3VudCB1cFxuICAgIG4rKztcbiAgfVxuXG4gIC8vIGZhaWxlZCB0byBmaW5kIGEgc3BvdFxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBHZXQgcmFuZG9tIGdyb3VuZCBzcG90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdyb3VuZF9maW5kX3Nwb3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGxpbWl0ID0gNTAwO1xuICB2YXIgbiA9IDA7XG5cbiAgd2hpbGUgKG4gPCBsaW1pdCkge1xuICAgIHZhciB4ID0gcmFuZCgwLCB0aGlzLncpLFxuICAgICAgeSA9IHJhbmQoMCwgdGhpcy5oKSxcbiAgICAgIGlkID0gdGhpcy5pKHgsIHkpO1xuXG4gICAgLy8gaWYgbm90IGxhbmQgcGl4ZWxcbiAgICBpZiAoaWQgIT09IDEgJiYgaWQgIT09IDIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIHBsb3QgY291cnNlIHRvIHJhbmRvbSBhbmdsZVxuICAgIHZhciBhbmdsZSA9IHJhbmQoMCwgMzYwKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7fVxuXG4gICAgLy8gY291bnQgdXBcbiAgICBuKys7XG4gIH1cblxuICAvLyBmYWlsZWQgdG8gZmluZCBhIHNwb3RcbiAgcmV0dXJuIGZhbHNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1hcFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8vIGNyZWF0ZSBtYXAgb2JqZWN0XG5mdW5jdGlvbiBjb3JlX21hcChjYW52LCBzY2hlbWUsIGdyYXZpdHlfbWFwKSB7XG4gIC8vIFNlcnZlciBzaWRlIG9ubHlcbiAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICAgIHZhciBjYW52YXMgPSByZXF1aXJlKFwiY2FudmFzXCIpO1xuICB9XG5cbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG5cbiAgLy8gc2V0IGRpbWVuc2lvbnNcbiAgdGhpcy53ID0gY2Fudi5jYW52LndpZHRoO1xuICB0aGlzLmggPSBjYW52LmNhbnYuaGVpZ2h0O1xuXG4gIC8vIGdldCBwaXhlbHNcbiAgdmFyIHBpeGVscyA9IGNhbnYuY29udC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xuICB2YXIgbGVuZ3RoID0gTWF0aC5mbG9vcihwaXhlbHMuZGF0YS5sZW5ndGggLyA0KTtcblxuICAvLyBjcmVhdGUgOCBiaXQgYWxwaGEgYXJyYXlcbiAgLy8gMC4gYWlyXG4gIC8vIDEuIGRlc3RydWN0aWJsZSBsYW5kXG4gIC8vIDIuIGluZGVzdHJ1Y3RpYmxlIGxhbmRcbiAgLy8gMy4gc3VuXG4gIHRoaXMuYXJyID0gbmV3IEludDhBcnJheShsZW5ndGgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHBpeGVscy5kYXRhW2kgKiA0ICsgM10gPiAzMCkge1xuICAgICAgdGhpcy5hcnJbaV0gPSAxO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCB1cCBncmF2aXR5XG4gIHRoaXMuaW5pdF9ncmF2aXR5KGdyYXZpdHlfbWFwKTtcbn1cblxuLyogR2V0IGFuZCBzZXQgYXJyYXkgY28tb3JkaW5hdGUgdmFsdWVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmlfZ2V0ID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgeDIgPSB0aGlzLmxvb3BfeCh4KTtcbiAgdmFyIHkyID0gdGhpcy5sb29wX3koeSk7XG4gIHJldHVybiB5MiAqIHRoaXMudyArIHgyO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmkgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciBpID0gdGhpcy5pX2dldCh4LCB5KTtcbiAgaWYgKGkgPT0gbnVsbCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLmFycltpXTtcbiAgfVxufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmlfc2V0ID0gZnVuY3Rpb24oeCwgeSwgdmFsKSB7XG4gIHZhciBpID0gdGhpcy5pX2dldCh4LCB5KTtcbiAgaWYgKGkpIHtcbiAgICB0aGlzLmFycltpXSA9IHZhbDtcbiAgfVxufTtcblxuLyogR2V0IGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cyBpbiBsb29waW5nIGFyZWFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2Rpc3RhbmNlID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcbiAgdmFyIHggPSB0aGlzLmdldF9kaXN0YW5jZV94KHgxLCB4Mik7XG4gIHZhciB5ID0gdGhpcy5nZXRfZGlzdGFuY2VfeSh5MSwgeTIpO1xuICByZXR1cm4gZ2V0X3NwZWVkKHgsIHkpO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9kaXN0YW5jZV94ID0gZnVuY3Rpb24oeDEsIHgyKSB7XG4gIHJldHVybiBuX2RpZmYoeDEsIHgyLCAwLCB0aGlzLncpO1xufTtcbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZGlzdGFuY2VfeSA9IGZ1bmN0aW9uKHkxLCB5Mikge1xuICByZXR1cm4gbl9kaWZmKHkxLCB5MiwgMCwgdGhpcy5oKTtcbn07XG5cbi8qIEdldCBoZWFkaW5nIGJldHdlZW4gdHdvIHBvaW50cyBpbiBsb29waW5nIGFyZWFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2hlYWRpbmcgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5Mikge1xuICB2YXIgeCA9IG5fZGlmZih4MSwgeDIsIDAsIHRoaXMudyk7XG4gIHZhciB5ID0gbl9kaWZmKHkxLCB5MiwgMCwgdGhpcy5oKTtcbiAgcmV0dXJuIGdldF9hbmdsZSh4LCB5KTtcbn07XG5cbi8qIEdldCBsb29waW5nIGNvLW9yZGluYXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmxvb3BfeCA9IGZ1bmN0aW9uKHgpIHtcbiAgcmV0dXJuIG5fbG9vcCh4LCAwLCB0aGlzLncgLSAxKTtcbn07XG5cbmNvcmVfbWFwLnByb3RvdHlwZS5sb29wX3kgPSBmdW5jdGlvbih5KSB7XG4gIHJldHVybiBuX2xvb3AoeSwgMCwgdGhpcy5oIC0gMSk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuY29uc3Qgc2hhcmVMaW5rc1RleHQgPVxuICBcIjxkaXYgY2xhc3M9J2xpbmtzJz48YSB0YXJnZXQ9J19ibGFuaycgY2xhc3M9J2ZiIGJhbGwnIGhyZWY9J2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9zaGFyZXIvc2hhcmVyLnBocD91PWh0dHA6Ly9wcm9qZWN0YW50cy5jb20nIHRpdGxlPSdTaGFyZSBvbiBGYWNlYm9vayc+PGltZyBzcmM9J1wiICtcbiAgQVNTRVRTICtcbiAgXCIvaW1hZ2VzL2ZhY2Vib29rLnBuZycgYWx0PScnPjwvYT48YSB0YXJnZXQ9J19ibGFuaycgY2xhc3M9J3R3aXR0ZXIgYmFsbCcgaHJlZj0naHR0cHM6Ly90d2l0dGVyLmNvbS9pbnRlbnQvdHdlZXQ/c3RhdHVzPUNvbWUlMjBhbmQlMjBwbGF5JTIwaHR0cCUzQSUyRiUyRnByb2plY3RhbnRzLmNvbSUyMCUyM3Byb2plY3RhbnRzJyB0aXRsZT0nU2hhcmUgb24gVHdpdHRlcic+PGltZyBzcmM9J1wiICtcbiAgQVNTRVRTICtcbiAgXCIvaW1hZ2VzL3R3aXR0ZXIucG5nJyBhbHQ9Jyc+PC9hPjxici8+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J21haWx0bzpwcm9qZWN0YW50c2dhbWVAZ21haWwuY29tJz5Db250YWN0PC9hPiB8IDxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL3d3dy5wYXlwYWwuY29tL2NnaS1iaW4vd2Vic2NyP2NtZD1fZG9uYXRpb25zJmJ1c2luZXNzPXByb2plY3RhbnRzZ2FtZUBnbWFpbC5jb20mbGM9VUsmaXRlbV9uYW1lPUtlZXBpbmcrdGhlK2FudHMrYXQrYmF5ISZub19ub3RlPTAmbm9fc2hpcHBpbmc9MiZjdXJlbmN5X2NvZGU9R0JQJmJuPVBQLURvbmF0aW9uc0JGOmJ0bl9kb25hdGVDQ19MRy5naWY6Tm9uSG9zdGVkJz5Eb25hdGU8L2E+PC9kaXY+XCI7XG5cbmNvbnN0IHVybCA9IG5ldyBVUkwod2luZG93LmxvY2F0aW9uKTtcbmNvbnN0IHdhdGNoID0gISF1cmwuc2VhcmNoUGFyYW1zLmdldChcIndhdGNoXCIpO1xuXG5mdW5jdGlvbiBhcHAoKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5hc3NldHNfdXJsID0gQVNTRVRTO1xuICB0aGlzLmFzc2V0cyA9IHt9O1xuICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTtcbiAgdGhpcy53YXRjaCA9IHdhdGNoO1xuICB0aGlzLm5pY2tuYW1lID0gXCJ0aGUgd2F0Y2hlclwiO1xuXG4gIHRoaXMuc29ja2V0cyA9IG5ldyBTb2NrZXRDb25uZWN0aW9uKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgc2VsZi5ydW5fZXZlbnQoZXZlbnQpO1xuICB9KTtcbiAgdGhpcy5pbml0X2ludGVyZmFjZSgpO1xuXG4gIHRoaXMuaW5wdXQgPSBuZXcgaW5wdXQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBzZWxmLnJ1bl9ldmVudChldmVudCk7XG4gIH0pO1xuICB0aGlzLmF1ZGlvID0gbmV3IGF1ZGlvKCk7XG5cbiAgdGhpcy5pbml0X3NldHRpbmdzKCk7XG5cbiAgaWYgKHRoaXMud2F0Y2gpIHtcbiAgICB0aGlzLmxvYWRfcm9vbSgpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuaW5pdF9zdGFydCgpO1xuICB9XG59XG5cbi8qIExvYWQgcm9vbVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXBwLnByb3RvdHlwZS5sb2FkX3Jvb20gPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuc3RhcnQpIHtcbiAgICBoaWRlKHRoaXMuc3RhcnQpO1xuICB9XG4gIHNob3codGhpcy5sb2FkaW5nKTtcblxuICAvLyBsb2FkIGFzc2V0c1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIG5ldyBsb2FkZXIoXG4gICAgdGhpcy5hc3NldHNfdXJsLFxuICAgIHtcbiAgICAgIGltZzoge1xuICAgICAgICBzcHJpdGVzOiBcIi9pbWFnZXMvc3ByaXRlcy9zcHJpdGVzLnBuZ1wiLFxuICAgICAgICBiZzogXCIvaW1hZ2VzL3RleHR1cmVzL3NwYWNlLmpwZ1wiXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgYmxlZXAxOiBcIi9hdWRpby9ibGVlcDEubXAzXCIsXG4gICAgICAgIGJsb29wMTogXCIvYXVkaW8vYmxvb3AxLm1wM1wiLFxuICAgICAgICBibG9vcDI6IFwiL2F1ZGlvL2Jsb29wMi5tcDNcIixcbiAgICAgICAgYmluZzogXCIvYXVkaW8vYmluZy5tcDNcIixcbiAgICAgICAgZGlnOiBcIi9hdWRpby9kaWcubXAzXCIsXG4gICAgICAgIGRvaW5rOiBcIi9hdWRpby9kb2luay5tcDNcIixcbiAgICAgICAgZG9uazogXCIvYXVkaW8vZG9uay5tcDNcIixcbiAgICAgICAgZXhwbG9zaW9uOiBcIi9hdWRpby9leHBsb3Npb24ubXAzXCIsXG4gICAgICAgIGV4cGxvc2lvbl9nYXM6IFwiL2F1ZGlvL2V4cGxvc2lvbl9nYXMubXAzXCIsXG4gICAgICAgIGV4cGxvc2lvbl9sYXNlcjogXCIvYXVkaW8vZXhwbG9zaW9uX2xhc2VyLm1wM1wiLFxuICAgICAgICBob21pbmc6IFwiL2F1ZGlvL2hvbWluZy5tcDNcIixcbiAgICAgICAgZmx5OiBcIi9hdWRpby9mbHkubXAzXCIsXG4gICAgICAgIGNvdW50ZG93bjogXCIvYXVkaW8vY291bnRkb3duLm1wM1wiLFxuICAgICAgICBqdW1wOiBcIi9hdWRpby9qdW1wLm1wM1wiLFxuICAgICAgICBsZXZlbHVwOiBcIi9hdWRpby9sZXZlbHVwLm1wM1wiLFxuICAgICAgICBsb2NrbmxvYWQ6IFwiL2F1ZGlvL2xvY2tubG9hZC5tcDNcIixcbiAgICAgICAgcGhhc2U6IFwiL2F1ZGlvL3BoYXNlLm1wM1wiLFxuICAgICAgICBwb3A6IFwiL2F1ZGlvL3BvcC5tcDNcIixcbiAgICAgICAgcHVuY2g6IFwiL2F1ZGlvL3B1bmNoLm1wM1wiLFxuICAgICAgICBzaG9vdDogXCIvYXVkaW8vc2hvb3QubXAzXCIsXG4gICAgICAgIHNob290X2xhc2VyOiBcIi9hdWRpby9zaG9vdF9sYXNlci5tcDNcIixcbiAgICAgICAgdGhyb3c6IFwiL2F1ZGlvL3Rocm93Lm1wM1wiLFxuICAgICAgICBzcG9va3k6IFwiL2F1ZGlvL3Nwb29reS5tcDNcIixcbiAgICAgICAgd2FsazogXCIvYXVkaW8vd2Fsay5tcDNcIlxuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24oYXNzZXRzKSB7XG4gICAgICBzZWxmLmluaXRfcm9vbShhc3NldHMpO1xuICAgIH1cbiAgKTtcbn07XG5cbi8qIFN0YXJ0IHRoZSBhcHBcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9yb29tID0gZnVuY3Rpb24oYXNzZXRzKSB7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcblxuICB0aGlzLnN0YXJ0ZWQgPSB0cnVlO1xuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hdWRpby5hZGRfYnVmZmVycyhhc3NldHMuYXVkaW8pO1xuXG4gIHRoaXMucm9vbSA9IG5ldyBtdWx0aXBsYXllcihcbiAgICB0aGlzLmFzc2V0cyxcbiAgICB0aGlzLmFzc2V0c191cmwsXG4gICAgdGhpcy5hdWRpbyxcbiAgICB0aGlzLmlucHV0LFxuICAgIHRoaXMubmlja25hbWUsXG4gICAgdGhpcy53YXRjaCxcbiAgICB0aGlzLnJ1bl9ldmVudCxcbiAgICB0aGlzLnNvY2tldHMsXG4gICAgbmV3IG9uYm9hcmRpbmcoKVxuICApO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMucm9vbS5kaXYpO1xuXG4gIGlmICh0aGlzLndhdGNoKSB7XG4gICAgdGhpcy5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcIndhdGNoZXJcIiwgW10pO1xuICB9IGVsc2Uge1xuICAgIHRoaXMubmlja25hbWUgPSB0aGlzLmNoZWNrX25hbWUodGhpcy5uaWNrbmFtZSk7XG4gICAgdGhpcy5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcInNlbmRfbmFtZVwiLCBbdGhpcy5uaWNrbmFtZV0pO1xuICB9XG59O1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gIG5ldyBhcHAoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiAgICBFdmVudHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBFdmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoZXZlbnRbaV0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzaG93IGFuZCBoaWRlIG1lbnVcbiAgaWYgKGV2ZW50LnR5cGUgPT0gXCJzaG93X21lbnVcIikge1xuICAgIHNob3codGhpcy5tZW51KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09IFwiaGlkZV9tZW51XCIpIHtcbiAgICBoaWRlKHRoaXMubWVudSk7XG5cbiAgICAvLyBpZiBnYW1lIGlzIGZ1bGxcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZ1bGxcIikge1xuICAgIGhpZGUodGhpcy5sb2FkaW5nKTtcbiAgICBzaG93KHRoaXMuZ2FtZV9mdWxsKTtcbiAgICBpZiAodGhpcy5yb29tICYmIHRoaXMucm9vbS5jb25uZWN0aW5nKSB7XG4gICAgICBoaWRlKHRoaXMucm9vbS5jb25uZWN0aW5nKTtcbiAgICB9XG5cbiAgICAvLyBzaG93IHRoZSBjb250cm9scyBzY3JlZW5cbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09IFwic2hvd19zZXR0aW5nc1wiKSB7XG4gICAgdGhpcy50b2dnbGVfc2V0dGluZ3Nfc2NyZWVuKCk7XG5cbiAgICAvLyBzZW5kIGV2ZW50IGRvd24gYSBsZXZlbFxuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLnJvb20pIHtcbiAgICAgIHRoaXMucm9vbS5ydW5fZXZlbnQoZXZlbnQpO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFwcCBJbnRlcmZhY2VcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5hcHAucHJvdG90eXBlLmluaXRfaW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZGl2ID0gZWxlbWVudCh7IGlkOiBcInByb2plY3RhbnRzXCIsIGNsYXNzOiBcImFwcFwiIH0pO1xuICBhcHBlbmQoZG9jdW1lbnQuYm9keSwgdGhpcy5kaXYpO1xuXG4gIC8vIGdhbWUgZnVsbFxuICB0aGlzLmdhbWVfZnVsbCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJPaCBkZWFyLCB0aGlzIHJvb20gaXMgdmVyeSBmdWxsITxicj48YnI+PGJyPjwvZGl2PlwiXG4gIH0pO1xuICB0aGlzLmJ1dHRvbl9uZXdfZ2FtZSA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnV0dG9uIHJlZFwiLFxuICAgIHRleHQ6IFwiRmluZCBBIE5ldyBPbmVcIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWVfZnVsbCk7XG4gIGFwcGVuZCh0aGlzLmdhbWVfZnVsbCwgdGhpcy5idXR0b25fbmV3X2dhbWUpO1xuICBoaWRlKHRoaXMuZ2FtZV9mdWxsKTtcblxuICAvLyBmaW5kIG5ldyByb29tXG4gIHRoaXMuYnV0dG9uX25ld19nYW1lLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB3aW5kb3cubG9jYXRpb24gPSBcIi9cIjtcbiAgfTtcblxuICAvLyBsaW1pdCBnYW1lIGFzcGVjdCByYXRpb1xuICB2YXIgcmF0aW8gPSB0aGlzLmRpdi5vZmZzZXRXaWR0aCAvIHRoaXMuZGl2Lm9mZnNldEhlaWdodDtcbiAgdGhpcy5kaXYuc3R5bGUud2lkdGggPVxuICAgIHJhdGlvID4gMS44XG4gICAgICA/IHJvdW5kKHRoaXMuZGl2Lm9mZnNldEhlaWdodCAqIDEuOCkgKyBcInB4XCJcbiAgICAgIDogdGhpcy5kaXYub2Zmc2V0V2lkdGggKyBcInB4XCI7XG4gIHRoaXMuZGl2LnN0eWxlLmhlaWdodCA9XG4gICAgcmF0aW8gPCAxID8gdGhpcy5kaXYub2Zmc2V0V2lkdGggKyBcInB4XCIgOiB0aGlzLmRpdi5vZmZzZXRIZWlnaHQgKyBcInB4XCI7XG5cbiAgLy8gbG9hZGluZ1xuICB0aGlzLmxvYWRpbmcgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiTG9hZGluZy4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gICAgU2V0dGluZ3NcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTdGFydCBzZXR0aW5ncyBzY3JlZW5cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9zZXR0aW5ncyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgLy8gY29ybmVyIGJ1dHRvblxuICB0aGlzLmljb25fc2V0dGluZ3MgPSBlbGVtZW50KHsgY2xhc3M6IFwic2V0dGluZ3NcIiB9KTtcbiAgdGhpcy5pY29uX3NldHRpbmdzX2ltZyA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiaW1nXCIsXG4gICAgc3JjOiB0aGlzLmFzc2V0c191cmwgKyBcIi9pbWFnZXMvY29nLnBuZ1wiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuaWNvbl9zZXR0aW5ncyk7XG4gIGFwcGVuZCh0aGlzLmljb25fc2V0dGluZ3MsIHRoaXMuaWNvbl9zZXR0aW5nc19pbWcpO1xuXG4gIHRoaXMuc2V0dGluZ3NfdmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLmljb25fc2V0dGluZ3Mub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYudG9nZ2xlX3NldHRpbmdzX3NjcmVlbigpO1xuICB9O1xuXG4gIC8vIGJveFxuICB0aGlzLmRpdl9zZXR0aW5ncyA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsIGZ1bGxfYmdcIiB9KTtcbiAgdGhpcy5kaXZfc2V0dGluZ3NfY29udCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyIGRpdl9jb250cm9sc1wiLFxuICAgIHRleHQ6IFwiPGRpdiBjbGFzcz0ndG9wX21lc3NhZ2UnPlNldHRpbmdzPC9kaXY+XCIgKyBzaGFyZUxpbmtzVGV4dFxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9zZXR0aW5ncyk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5ncywgdGhpcy5kaXZfc2V0dGluZ3NfY29udCk7XG4gIGhpZGUodGhpcy5kaXZfc2V0dGluZ3MpO1xuXG4gIC8vIHZvbHVtZVxuICB0aGlzLmRpdl92b2x1bWUgPSBlbGVtZW50KHsgdGV4dDogXCI8aDI+Vm9sdW1lPC9oMj5cIiB9KTtcbiAgdGhpcy5pbnB1dF92b2x1bWUgPSBlbGVtZW50KHsgdHlwZTogXCJpbnB1dFwiIH0pO1xuICB0aGlzLmlucHV0X3ZvbHVtZS50eXBlID0gXCJyYW5nZVwiO1xuICB0aGlzLmlucHV0X3ZvbHVtZS5zZXRBdHRyaWJ1dGUoXCJtaW5cIiwgMCk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lLnNldEF0dHJpYnV0ZShcIm1heFwiLCAxKTtcbiAgdGhpcy5pbnB1dF92b2x1bWUuc2V0QXR0cmlidXRlKFwic3RlcFwiLCAwLjEpO1xuICB0aGlzLmlucHV0X3ZvbHVtZS52YWx1ZSA9IHRoaXMuYXVkaW8udm9sdW1lO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3NfY29udCwgdGhpcy5kaXZfdm9sdW1lKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3ZvbHVtZSwgdGhpcy5pbnB1dF92b2x1bWUpO1xuXG4gIHRoaXMuaW5wdXRfdm9sdW1lLm9uY2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAgIHNlbGYuYXVkaW8uc2V0X2dsb2JhbF92b2x1bWUodGhpcy52YWx1ZSk7XG4gIH07XG5cbiAgLy8gY29udHJvbHNcbiAgdmFyIGN0ZXh0ID0gXCI8aDI+Q29udHJvbHM8L2gyPlwiO1xuICBjdGV4dCArPSBcIjxkbD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+TW92ZTwvZHQ+PGRkPldBU0QgLyBBcnJvdyBLZXlzIC8gUmlnaHQgQ2xpY2s8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5KdW1wPC9kdD48ZGQ+U3BhY2ViYXI8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5TaG9vdDwvZHQ+PGRkPkxlZnQgQ2xpY2sgLyBTaGlmdDwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PlNlbGVjdCBXZWFwb248L2R0PjxkZD4xLTkgLyBTY3JvbGwgV2hlZWw8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5Gb2xsb3cgV2VhcG9uczwvZHQ+PGRkPkY8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5GcmVlIENhbTwvZHQ+PGRkPk1pZGRsZSBDbGljazwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPC9kbD5cIjtcbiAgdGhpcy5kaXZfY29udHJvbHMgPSBlbGVtZW50KHsgdGV4dDogY3RleHQgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19jb250LCB0aGlzLmRpdl9jb250cm9scyk7XG5cbiAgLy8gc2VydmVyXG4gIHRoaXMuZGl2X3NlcnZlciA9IGVsZW1lbnQoe1xuICAgIHRleHQ6XG4gICAgICBcIjxoMj5TZXJ2ZXI8L2gyPjxwPjxhIGhyZWY9J2h0dHA6Ly91ay5wcm9qZWN0YW50cy5jb20vJz5VSzwvYT4gfCA8YSBocmVmPSdodHRwOi8vdXMucHJvamVjdGFudHMuY29tLyc+VVM8L2E+PC9wPlwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3NfY29udCwgdGhpcy5kaXZfc2VydmVyKTtcblxuICAvLyBjbG9zZSBidXR0b25cbiAgdGhpcy5kaXZfc2V0dGluZ3NfYnV0dG9ucyA9IGVsZW1lbnQoeyBjbGFzczogXCJidXR0b25zXCIgfSk7XG4gIHRoaXMuYnV0dG9uX2Nsb3NlX3NldHRpbmdzID0gZWxlbWVudCh7IHR5cGU6IFwiYnV0dG9uXCIsIHRleHQ6IFwiQ2xvc2VcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2NvbnQsIHRoaXMuZGl2X3NldHRpbmdzX2J1dHRvbnMpO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3NfYnV0dG9ucywgdGhpcy5idXR0b25fY2xvc2Vfc2V0dGluZ3MpO1xuXG4gIHRoaXMuYnV0dG9uX2Nsb3NlX3NldHRpbmdzLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBzZWxmLnNldHRpbmdzX3Zpc2libGUgPSBmYWxzZTtcbiAgICBoaWRlKHNlbGYuZGl2X3NldHRpbmdzKTtcbiAgfTtcbn07XG5cbmFwcC5wcm90b3R5cGUudG9nZ2xlX3NldHRpbmdzX3NjcmVlbiA9IGZ1bmN0aW9uKCkge1xuICBpZiAoKHRoaXMuc2V0dGluZ3NfdmlzaWJsZSA9ICF0aGlzLnNldHRpbmdzX3Zpc2libGUpKSB7XG4gICAgdGhpcy5hdWRpby5wbGF5KFwiYmxlZXAxXCIsIDAuOCk7XG4gICAgc2hvdyh0aGlzLmRpdl9zZXR0aW5ncyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZSh0aGlzLmRpdl9zZXR0aW5ncyk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiAgICBTdGFydCBTY3JlZW5cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5hcHAucHJvdG90eXBlLmluaXRfc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIC8vIGdldCBhIG5ldyBvciBzdG9yZWQgbmlja25hbWVcbiAgdGhpcy5uaWNrbmFtZSA9IGNvbmZpZy5uYW1lc1tyYW5kKDAsIGNvbmZpZy5uYW1lcy5sZW5ndGggLSAxKV07XG4gIGlmICh0eXBlb2YgU3RvcmFnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHZhciBsc25hbWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInBhbnRzX25uXCIpO1xuICAgIGlmIChjb25maWcubmFtZXMuaW5kZXhPZihsc25hbWUpID09PSAtMSkge1xuICAgICAgdGhpcy5uaWNrbmFtZSA9IGxzbmFtZSB8fCB0aGlzLm5pY2tuYW1lO1xuICAgIH1cbiAgfVxuXG4gIHRoaXMuc3RhcnQgPSBlbGVtZW50KHsgY2xhc3M6IFwic3RhcnRcIiB9KTtcbiAgdmFyIGxvZ28gPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcImltZ1wiLFxuICAgIGNsYXNzOiBcImxvZ29cIixcbiAgICBzcmM6IHRoaXMuYXNzZXRzX3VybCArIFwiL2ltYWdlcy9sb2dvLnBuZ1wiXG4gIH0pO1xuICB2YXIgaW5zdHJ1Y3Rpb25zID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJ1bFwiLFxuICAgIGNsYXNzOiBcImZhZGVcIixcbiAgICB0ZXh0OlxuICAgICAgXCI8bGk+Q29sbGVjdCBnZW1zIHRvIGdldCBzdHJvbmdlcjwvbGk+PGxpPkRlc3Ryb3kgdGhlIGVuZW15IHRvIGdldCB0aGVpciBnZW1zITwvbGk+PGxpPldBU0Qgb3IgUmlnaHQgQ2xpY2sgdG8gTW92ZTwvbGk+PGxpPkxlZnQgQ2xpY2sgb3IgU2hpZnQgdG8gU2hvb3Q8L2xpPlwiXG4gIH0pO1xuICB0aGlzLmlucHV0X25hbWUgPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcImlucHV0XCIsXG4gICAgaW50eXBlOiBcInRleHRcIixcbiAgICB2YWx1ZTogdGhpcy5uaWNrbmFtZSxcbiAgICBtYXhsZW5ndGg6IDIwXG4gIH0pO1xuICB0aGlzLmJ1dHRvbl9zdGFydCA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnJlYWtcIixcbiAgICB0ZXh0OiBcIlBsYXkgTm93XCJcbiAgfSk7XG5cbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLnN0YXJ0KTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIGxvZ28pO1xuICBhcHBlbmQodGhpcy5zdGFydCwgaW5zdHJ1Y3Rpb25zKTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIHRoaXMuaW5wdXRfbmFtZSk7XG4gIGFwcGVuZCh0aGlzLnN0YXJ0LCB0aGlzLmJ1dHRvbl9zdGFydCk7XG4gIGFwcGVuZCh0aGlzLnN0YXJ0LCBlbGVtZW50KHsgdGV4dDogc2hhcmVMaW5rc1RleHQgfSkpO1xuXG4gIC8vIHN0YXJ0IHVwIHRoZSBhcHBcbiAgdGhpcy5idXR0b25fc3RhcnQub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYubG9hZF9yb29tKCk7XG4gIH07XG59O1xuXG4vKiBDaGVjayBuYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hcHAucHJvdG90eXBlLmNoZWNrX25hbWUgPSBmdW5jdGlvbigpIHtcbiAgdmFyIG5ld19uYW1lID0gdGhpcy5uaWNrbmFtZTtcbiAgaWYgKHRoaXMuaW5wdXRfbmFtZSkge1xuICAgIG5ld19uYW1lID0gdGhpcy5pbnB1dF9uYW1lLnZhbHVlO1xuICB9XG4gIG5ld19uYW1lID0gbmV3X25hbWUubGVuZ3RoID4gMjAgPyBuZXdfbmFtZS5zdWJzdHJpbmcoMCwgMjApIDogbmV3X25hbWU7XG4gIGlmICh0eXBlb2YgU3RvcmFnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwicGFudHNfbm5cIiwgbmV3X25hbWUpO1xuICB9XG4gIHJldHVybiBuZXdfbmFtZTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgQWxlcnQgTWVzc2FnZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgYWxlcnQgZGl2XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2FsZXJ0ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZGl2X2FsZXJ0ID0gZWxlbWVudCh7IGNsYXNzOiBcImFsZXJ0XCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfYWxlcnQpO1xuICB0aGlzLmFsZXJ0X3RleHQgPSBcIlwiO1xuICB0aGlzLmFsZXJ0X2NvdW50ID0gMDtcbn07XG5cbi8qIFNldCBhbGVydFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2FsZXJ0ID0gZnVuY3Rpb24odGV4dCwgY29sLCBjb3VudCkge1xuICB0aGlzLmFsZXJ0X2NvdW50ID0gY291bnQgfHwgNjA7XG4gIHRoaXMuZGl2X2FsZXJ0LmNsYXNzTmFtZSA9IFwiYWxlcnRcIjtcbiAgdGhpcy5kaXZfYWxlcnQuaW5uZXJIVE1MID0gdGV4dDtcbiAgaWYgKGNvbCkge1xuICAgIGFkZF9jbGFzcyh0aGlzLmRpdl9hbGVydCwgY29sKTtcbiAgfVxuICBzaG93KHRoaXMuZGl2X2FsZXJ0KTtcbn07XG5cbi8qIFJ1biBhbGVydFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2FsZXJ0ID0gZnVuY3Rpb24oKSB7XG4gIC8vIGRvIGNvdW50ZG93bnNcbiAgaWYgKHRoaXMuYWxlcnRfY291bnQgPiAwKSB7XG4gICAgdGhpcy5hbGVydF9jb3VudC0tO1xuICAgIGlmICh0aGlzLmFsZXJ0X2NvdW50ID09IDApIHtcbiAgICAgIHRoaXMuZGl2X2FsZXJ0LmlubmVySFRNTCA9IFwiXCI7XG4gICAgICBoaWRlKHRoaXMuZGl2X2FsZXJ0KTtcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgQXJtb3VyeVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIGFybW91cnkgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgLy8gc2VsZWN0ZWQgd2VhcG9uXG4gIHRoaXMuY3VycmVudF93ZWFwb24gPSBcIlwiO1xuXG4gIC8vIGRldG9uYXRpb24gY29vbGRvd25cbiAgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID0gMDtcblxuICAvLyBjcmVhdGUgZGl2c1xuICB0aGlzLmFybW91cnkgPSB7XG4gICAgZGl2OiBlbGVtZW50KHsgY2xhc3M6IFwiYXJtb3VyeSBib3hcIiB9KSxcbiAgICB0aXRsZTogZWxlbWVudCh7IGNsYXNzOiBcInRpdGxlXCIgfSksXG4gICAgcGxheWVyOiBlbGVtZW50KHsgY2xhc3M6IFwicGxheWVyX3dlYXBvbiBoZXgtYnV0dG9uXCIgfSksXG4gICAgd2VhcG9uczoge30sXG4gICAgc2hvd19pY29uOiBmYWxzZSxcbiAgICBzaG93X2ljb25fZnJhbWU6IG51bGxcbiAgfTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmFybW91cnkuZGl2KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmFybW91cnkucGxheWVyKTtcbiAgaGlkZSh0aGlzLmFybW91cnkucGxheWVyKTtcblxuICAvLyBnbyB0aHJvdWdoIGFybW91cnkgbGF5b3V0XG4gIHZhciBzZWxmID0gdGhpcztcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHR5cGUgPSB0aGlzLnNjaGVtZS5hcm1vdXJ5W2ldO1xuXG4gICAgLy8gY3JlYXRlIGVsZW1lbnRzXG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0gPSB7XG4gICAgICBib3g6IGVsZW1lbnQoeyBjbGFzczogXCJoZXgtYnV0dG9uIHdlYXBvblwiLCBkYXRhOiB0eXBlIH0pLFxuICAgICAgc3ByaXRlOiBlbGVtZW50KHsgY2xhc3M6IFwic3ByaXRlXCIgfSksXG4gICAgICBjb3VudDogZWxlbWVudCh7IGNsYXNzOiBcImNvdW50XCIgfSksXG4gICAgICBwbGF5ZXJfaWNvbjogZWxlbWVudCh7IGNsYXNzOiBcImljb24gc3ByaXRlXCIgfSksXG4gICAgICBpOiBpLFxuICAgICAgYWN0aXZlOiBmYWxzZVxuICAgIH07XG4gICAgYXBwZW5kKHRoaXMuYXJtb3VyeS5kaXYsIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCk7XG4gICAgYXBwZW5kKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCwgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uc3ByaXRlKTtcbiAgICBhcHBlbmQodGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94LCB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5jb3VudCk7XG4gICAgYXBwZW5kKHRoaXMuYXJtb3VyeS5wbGF5ZXIsIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnBsYXllcl9pY29uKTtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnBsYXllcl9pY29uKTtcblxuICAgIC8vIHNldCBzcHJpdGUgYmFja2dyb3VuZCBwb3NpdGlvblxuICAgIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1t0eXBlXTtcbiAgICB2YXIgc3ByaXRlID0gdGhpcy5jLnNwcml0ZXNbd2VhcG9uLmFybW91cnlfc3ByaXRlXTtcbiAgICBpZiAoIXNwcml0ZSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHZhciBvZmZzZXQgPSBjZWlsKChzcHJpdGUuc2l6ZSAtIDQ4KSAvIDIpO1xuICAgIHZhciB4ID0gLXNwcml0ZS54IC0gb2Zmc2V0O1xuICAgIHZhciB5ID0gLXNwcml0ZS55IC0gb2Zmc2V0O1xuICAgIHZhciBwb3MgPSB4IC0gMSArIFwicHggXCIgKyB5ICsgXCJweCwgMCAwXCI7XG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uc3ByaXRlLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbiA9IHBvcztcbiAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5wbGF5ZXJfaWNvbi5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb24gPSBwb3M7XG5cbiAgICAvLyBzZXQgZWxlbWVudCBldmVudHNcbiAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi53ZWFwb25fc2VsZWN0KHRoaXMuZGF0YXNldC5kYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgYXBwZW5kKHRoaXMuYXJtb3VyeS5kaXYsIHRoaXMuYXJtb3VyeS50aXRsZSk7XG4gIGhpZGUodGhpcy5hcm1vdXJ5LmRpdik7XG59O1xuXG4vKiBJbml0aWFsaXNlIGFybW91cnkgd2l0aCBjb3JlIGRhdGFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfYXJtb3VyeSA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZXQgZGlzcGxheSBmb3IgYWxsIHdlYXBvbnNcbiAgZm9yICh0eXBlIGluIHRoaXMuYXJtb3VyeS53ZWFwb25zKSB7XG4gICAgdGhpcy5zZXRfd2VhcG9uKHR5cGUpO1xuICB9XG5cbiAgLy8gc2VsZWN0IHdlYXBvblxuICBpZiAoXG4gICAgIXRoaXMuY3VycmVudF93ZWFwb24gfHxcbiAgICAhdGhpcy5hcm1vdXJ5LndlYXBvbnNbdGhpcy5jdXJyZW50X3dlYXBvbl0uYWN0aXZlXG4gICkge1xuICAgIHRoaXMud2VhcG9uX3NlbGVjdF9uKDApO1xuICB9XG59O1xuXG4vKiBTZWxlY3Qgd2VhcG9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUud2VhcG9uX3NlbGVjdCA9IGZ1bmN0aW9uKHR5cGUsIG5vX2hpZ2hsaWdodCkge1xuICAvLyBpZiBzYW1lIHdlYXBvbiBvciBub25lIGxlZnRcbiAgaWYgKFxuICAgICF0aGlzLnBsYXllciB8fFxuICAgIHRoaXMuY3VycmVudF93ZWFwb24gPT09IHR5cGUgfHxcbiAgICB0aGlzLnBsYXllci5hcm1vdXJ5W3R5cGVdID09PSAwXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGRvIHRoZSBjaGFuZ2VcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuYXJtb3VyeS53ZWFwb25zKSB7XG4gICAgcmVtb3ZlX2NsYXNzKHRoaXMuYXJtb3VyeS53ZWFwb25zW2tleV0uYm94LCBcInNlbGVjdGVkXCIpO1xuICAgIGhpZGUodGhpcy5hcm1vdXJ5LndlYXBvbnNba2V5XS5wbGF5ZXJfaWNvbik7XG4gIH1cbiAgYWRkX2NsYXNzKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCwgXCJzZWxlY3RlZFwiKTtcbiAgdGhpcy5jdXJyZW50X3dlYXBvbiA9IHR5cGU7XG4gIHRoaXMuYXJtb3VyeS50aXRsZS5pbm5lckhUTUwgPSB0aGlzLmMud2VhcG9uc1t0eXBlXS50aXRsZTtcblxuICAvLyBhdXRvIGZvbGxvd2luZyB3ZWFwb25cbiAgdmFyIHdlcCA9IHRoaXMuYy53ZWFwb25zW3R5cGVdO1xuICBpZiAoXG4gICAgKHdlcC5hdXRvX2ZvbGxvdyAmJiAhdGhpcy53ZWFwb25fZm9sbG93KSB8fFxuICAgICghd2VwLmF1dG9fZm9sbG93ICYmIHRoaXMud2VhcG9uX2ZvbGxvdylcbiAgKSB7XG4gICAgdGhpcy50b2dnbGVfd2VhcG9uX2ZvbGxvdygpO1xuICB9XG5cbiAgaWYgKCFub19oaWdobGlnaHQpIHtcbiAgICAvLyBwbGF5IG5vaXNlXG4gICAgdGhpcy5hdWRpby5wbGF5KFwiYmxlZXAxXCIsIDAuOCk7XG5cbiAgICAvLyBzaG93IGljb25cbiAgICB0aGlzLmFybW91cnkuc2hvd19pY29uID0gdHJ1ZTtcbiAgICB0aGlzLmFybW91cnkuc2hvd19pY29uX2ZyYW1lID0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHNob3codGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0ucGxheWVyX2ljb24pO1xuICAgIHNob3codGhpcy5hcm1vdXJ5LnBsYXllcik7XG4gIH1cblxuICByZXR1cm4gdHlwZTtcbn07XG5cbi8qIFNlbGVjdCB3ZWFwb24gYnkgcG9zaXRpb24gaW4gYXJtb3VyeVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLndlYXBvbl9zZWxlY3RfbiA9IGZ1bmN0aW9uKG4pIHtcbiAgLy8gaWYgaXMgdG9vIGJpZ1xuICBpZiAobiA+PSB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggY29sdW1uc1xuICB2YXIgbjIgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgd2VhcG9uID0gdGhpcy5zY2hlbWUuYXJtb3VyeVtpXTtcbiAgICB2YXIgYWN0aXZlID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuYXJtb3VyeS53ZWFwb25zW3dlYXBvbl0uYWN0aXZlKSB7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgICAgaWYgKG4yID09PSBuICYmIHdlYXBvbiAhPT0gdGhpcy5jdXJyZW50X3dlYXBvbikge1xuICAgICAgICByZXR1cm4gdGhpcy53ZWFwb25fc2VsZWN0KHdlYXBvbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gaW5jcmVhc2UgY291bnQgb2YgYWN0dWFsIGNvbHVtbnNcbiAgICBuMiA9IGFjdGl2ZSA/IG4yICsgMSA6IG4yO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyogU2VsZWN0IHdlYXBvbiBieSBzY3JvbGxpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS53ZWFwb25fc2Nyb2xsID0gZnVuY3Rpb24oZG93bikge1xuICAvLyBpZiB3ZSBkb24ndCBoYXZlIGEgc2VsZWN0ZWQgd2VhcG9uXG4gIHZhciBjdXJyZW50ID0gdGhpcy5hcm1vdXJ5LndlYXBvbnNbdGhpcy5jdXJyZW50X3dlYXBvbl07XG4gIGlmICghY3VycmVudCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGg7IGkrKykge1xuICAgIHZhciBpX2Rvd24gPSBkb3duID8gdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGggLSBpIDogaTtcbiAgICB2YXIgbmV3X2kgPSBuX2xvb3AoY3VycmVudC5pICsgaV9kb3duLCAtMSwgdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGggLSAxKTtcbiAgICB2YXIgd2VhcG9uID0gdGhpcy5zY2hlbWUuYXJtb3VyeVtuZXdfaV07XG4gICAgaWYgKHRoaXMuYXJtb3VyeS53ZWFwb25zW3dlYXBvbl0uYWN0aXZlKSB7XG4gICAgICB0aGlzLndlYXBvbl9zZWxlY3Qod2VhcG9uKTtcbiAgICAgIHJldHVybiB3ZWFwb247XG4gICAgfVxuICB9XG59O1xuXG4vKiBDaGFuZ2UgdG8gd2VhcG9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X3dlYXBvbiA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgaWYgKCF0aGlzLnBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBjb3VudCA9IHRoaXMucGxheWVyLmFybW91cnlbdHlwZV07XG4gIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmNvdW50LmlubmVySFRNTCA9IGNvdW50O1xuXG4gIGlmIChjb3VudCA9PSAtMSkge1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmFjdGl2ZSA9IHRydWU7XG4gICAgc2hvdyh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gpO1xuICAgIGhpZGUodGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uY291bnQpO1xuICB9IGVsc2Uge1xuICAgIGlmIChjb3VudCA8IDEpIHtcbiAgICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgaGlkZSh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gpO1xuICAgICAgaWYgKHR5cGUgPT0gdGhpcy5jdXJyZW50X3dlYXBvbikge1xuICAgICAgICB0aGlzLndlYXBvbl9zZWxlY3RfbigwKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYWN0aXZlID0gdHJ1ZTtcbiAgICAgIHNob3codGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94KTtcbiAgICB9XG4gIH1cblxuICBpZiAoIXRoaXMuY3VycmVudF93ZWFwb24pIHtcbiAgICB0aGlzLndlYXBvbl9zZWxlY3RfbigwKTtcbiAgfVxuICB0aGlzLmRpc3BsYXlfYXJtb3VyeSgpO1xufTtcblxuLyogU2hvdyBhcm1vdXJ5IG9yIG5vdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRpc3BsYXlfYXJtb3VyeSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2hvd19pdCA9IGZhbHNlO1xuICB2YXIgZXZlbiA9IGZhbHNlO1xuICBpZiAodGhpcy5wbGF5ZXIpIHtcbiAgICBmb3IgKGtleSBpbiB0aGlzLnBsYXllci5hcm1vdXJ5KSB7XG4gICAgICBpZiAodGhpcy5wbGF5ZXIuYXJtb3VyeVtrZXldID4gMCB8fCB0aGlzLnBsYXllci5hcm1vdXJ5W2tleV0gPT0gLTEpIHtcbiAgICAgICAgc2hvd19pdCA9IHRydWU7XG4gICAgICAgIGV2ZW4gPSAhZXZlbjtcbiAgICAgIH1cbiAgICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW2tleV0uYm94LnN0eWxlLm1hcmdpblRvcCA9IGV2ZW4gPyBcIjI2cHhcIiA6IFwiMHB4XCI7XG4gICAgfVxuICB9XG4gIGlmIChzaG93X2l0KSB7XG4gICAgc2hvdyh0aGlzLmFybW91cnkuZGl2KTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS5kaXYpO1xuICB9XG59O1xuXG4vKiBSdW4gZXZlcnkgZnJhbWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fYXJtb3VyeSA9IGZ1bmN0aW9uKCkge1xuICAvLyB0dXJuIG9mZiBpY29uXG4gIGlmIChcbiAgICB0aGlzLmFybW91cnkuc2hvd19pY29uICYmXG4gICAgdGhpcy5jb3JlLnN0YXRlLmZyYW1lID4gdGhpcy5hcm1vdXJ5LnNob3dfaWNvbl9mcmFtZSArIDMwXG4gICkge1xuICAgIHRoaXMuYXJtb3VyeS5zaG93X2ljb24gPSBmYWxzZTtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS5wbGF5ZXIpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEF1ZGlvXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGF1ZGlvIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfYXVkaW8gPSBmdW5jdGlvbigpIHtcbiAgLy8gb2JqZWN0cyB3aXRoIHJlcGVhdGluZyBzb3VuZHNcbiAgdGhpcy5hdWRpb19vYmpzID0ge307XG5cbiAgLy8gd2VhcG9uIGxvb3BzXG4gIHRoaXMuYXVkaW9fd2VhcG9ucyA9IHt9O1xuXG4gIC8vIHNldCB1cCBwb3dlciB1cCBzb3VuZFxuICB0aGlzLnBvd2VyX3VwX2F1ZGlvX29uID0gZmFsc2U7XG59O1xuXG4vKiBDaGVjayBhbGwgZ2FtZSBvYmplY3RzIHdpdGggYXVkaW8gb2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2F1ZGlvID0gZnVuY3Rpb24oKSB7XG4gIC8vIHJlbW92ZSBvbGQgYXVkaW8gb2JqZWN0c1xuICBmb3IgKGtleSBpbiB0aGlzLmF1ZGlvX29ianMpIHtcbiAgICBpZiAoIXRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV0pIHtcbiAgICAgIGlmICh0aGlzLmF1ZGlvX29ianNba2V5XSkge1xuICAgICAgICB0aGlzLmF1ZGlvX29ianNba2V5XS5nYWluLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgdGhpcy5hdWRpb19vYmpzW2tleV0gPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIG9iamVjdHNcbiAgZm9yIChrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcblxuICAgIC8vIHdoYXQgbm9pc2Ugc2hvdWxkIGJlIHBsYXlpbmdcbiAgICB2YXIgYXVkaW9fa2V5ID0gbnVsbDtcbiAgICBpZiAob2JqLmdyb3VuZGVkICYmIG9iai5hbmltYXRlICYmIG9iai5hY3Rpb25lZCkge1xuICAgICAgYXVkaW9fa2V5ID0gb2JqLmMuYXVkaW8ud2FsaztcbiAgICB9IGVsc2Uge1xuICAgICAgYXVkaW9fa2V5ID0gb2JqLmMuYXVkaW8uYWlyO1xuICAgIH1cblxuICAgIHZhciB2b2x1bWUgPSB0aGlzLmdldF9kaXN0X3ZvbHVtZShvYmoueCwgb2JqLnkpO1xuICAgIHZhciBhdWRpb19vYmogPSB0aGlzLmF1ZGlvX29ianNba2V5XTtcblxuICAgIC8vIGlmIHRoZXJlIGlzIGFuIGF1ZGlvIGZpbGUgcGxheWluZ1xuICAgIGlmIChhdWRpb19vYmopIHtcbiAgICAgIC8vIGNoYW5nZSBpdHMgdm9sdW1lXG4gICAgICB0aGlzLmF1ZGlvLnNldF92b2x1bWUoYXVkaW9fb2JqLCB2b2x1bWUpO1xuXG4gICAgICAvLyBkaXNjb25uZWN0IGl0XG4gICAgICBpZiAodm9sdW1lIDw9IDAgfHwgYXVkaW9fb2JqLmF1ZGlvX2tleSAhPSBhdWRpb19rZXkgfHwgIWF1ZGlvX2tleSkge1xuICAgICAgICBhdWRpb19vYmouZ2Fpbi5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRoaXMuYXVkaW9fb2Jqc1trZXldID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgdGhlcmUgaXMgbm90IGFuIGF1ZGlvIGZpbGUgcGxheWluZ1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoYXVkaW9fa2V5KSB7XG4gICAgICAgIHRoaXMuYXVkaW9fb2Jqc1trZXldID0gdGhpcy5hdWRpby5wbGF5KGF1ZGlvX2tleSwgdm9sdW1lLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFNldCBhIHdlYXBvbiBzaG90IHNvdW5kIGVmZmVjdFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucGxheV93ZWFwb25fYXVkaW8gPSBmdW5jdGlvbihwcm9wcykge1xuICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbcHJvcHMud2VhcG9uXTtcbiAgaWYgKCF3ZWFwb24pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLmF1ZGlvLmJ1ZmZlcnNbd2VhcG9uLmZpcmVfYXVkaW9dKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IHZvbHVtZVxuICB2YXIgdm9sdW1lID0gdGhpcy5nZXRfZGlzdF92b2x1bWUocHJvcHMueCwgcHJvcHMueSk7XG4gIHRoaXMuYXVkaW8ucGxheSh3ZWFwb24uZmlyZV9hdWRpbywgdm9sdW1lKTtcbn07XG5cbi8qIEdldCBkaXN0YW5jZSB2b2x1bWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmdldF9kaXN0X3ZvbHVtZSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgdmFyIGRpc3RhbmNlID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2UoeCwgeSwgdGhpcy5jYW1lcmEueCwgdGhpcy5jYW1lcmEueSk7XG4gIHZhciB2b2x1bWUgPSAoMTIwMCAtIGRpc3RhbmNlKSAvIDEyMDA7XG4gIHZvbHVtZSAqPSB2b2x1bWU7XG4gIHJldHVybiB2b2x1bWU7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIENyb3NzaGFpclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBjcm9zc2hhaXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2Nyb3NzaGFpciA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmNyb3NzaGFpciA9IDA7XG4gIHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9IFwiYnV0dG9uXCI7XG59O1xuXG4vKiBDYWxjdWxhdGUgY3Jvc3NoYWlyIGZyb20gY3Vyc29yIHBvc2l0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2Nyb3NzaGFpciA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMucGxheWVyIHx8IHRoaXMucGxheWVyLmRlYWQgfHwgIXRoaXMucGxheWVyX29iaikge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbdGhpcy5wbGF5ZXJfb2JqLmtleV07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5jcm9zc2hhaXIgPSB0aGlzLmNvcmUubWFwLmdldF9oZWFkaW5nKFxuICAgIG9iai54LFxuICAgIG9iai55LFxuICAgIHRoaXMuY3Vyc29yLngsXG4gICAgdGhpcy5jdXJzb3IueVxuICApO1xuXG4gIC8vIC8vIGNhbGN1bGF0ZSBmcm9tIGN1cnNvclxuICAvLyBpZiAodGhpcy5jcm9zc2hhaXJfc291cmNlID09IFwiY3Vyc29yXCIpIHtcbiAgLy8gXHR0aGlzLmNyb3NzaGFpciA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcob2JqLngsIG9iai55LCB0aGlzLmN1cnNvci54LCB0aGlzLmN1cnNvci55KTtcblxuICAvLyAvLyBjYWxjdWxhdGUgZnJvbSBidXR0b25zXG4gIC8vIH0gZWxzZVxuICAvLyBpZiAodGhpcy5jcm9zc2hhaXJfc291cmNlID09IFwiYnV0dG9uXCIpIHtcblxuICAvLyBcdC8vIGNhbGN1bGF0ZSBhbmdsZSBvZiBjcm9zc2hhaXJcbiAgLy8gXHR2YXIgYW5nbGUgPSAtMTtcbiAgLy8gXHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfdXApIHtcbiAgLy8gXHRcdGFuZ2xlID0gOTA7XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfcmlnaHQpIHsgYW5nbGUgPSAxMzU7IH1cbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9sZWZ0KSB7IGFuZ2xlID0gNDU7IH1cbiAgLy8gXHR9IGVsc2VcbiAgLy8gXHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfZG93bikge1xuICAvLyBcdFx0YW5nbGUgPSAyNzA7XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfcmlnaHQpIHsgYW5nbGUgPSAyMjU7IH1cbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9sZWZ0KSB7IGFuZ2xlID0gMzA1OyB9XG4gIC8vIFx0fSBlbHNlIHtcbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9yaWdodCkgeyBhbmdsZSA9IDE4MDsgfVxuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX2xlZnQpIHsgYW5nbGUgPSAwOyB9XG4gIC8vIFx0fVxuICAvLyBcdGlmIChhbmdsZSAhPT0gLTEpIHtcbiAgLy8gXHRcdHRoaXMuY3Jvc3NoYWlyID0gaW5jcmVtZW50X2FuZ2xlKHRoaXMuY3Jvc3NoYWlyLCBhbmdsZSwgNCk7XG4gIC8vIFx0fVxuICAvLyB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIERlY29yYXRpb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ3JlYXRlIGRlY29yYXRpb25cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV9kZWNvcmF0aW9uID0gZnVuY3Rpb24ocHJvcHMpIHtcbiAgdmFyIG9iaiA9IHtcbiAgICBmcmFtZTogdGhpcy5jb3JlLnN0YXRlLmZyYW1lLFxuICAgIHR5cGU6IFwiXCIsXG4gICAgaWQ6IFwiXCIsXG4gICAgeDogMCxcbiAgICB5OiAwLFxuICAgIHNwZWVkX3g6IDAsXG4gICAgc3BlZWRfeTogMCxcbiAgICB0aW1lb3V0OiAwLFxuICAgIGFuZ2xlOiAwLFxuICAgIHJlcGVhdDogdHJ1ZSxcbiAgICBzcHJpdGU6IFwiXCJcbiAgfTtcbiAgb2JqID0gZGVlcG1lcmdlKG9iaiwgcHJvcHMpO1xuICBvYmoua2V5ID1cbiAgICBvYmouZnJhbWUgKyBcIi1cIiArIG9iai54ICsgXCItXCIgKyBvYmoueSArIFwiLVwiICsgb2JqLnNwcml0ZSArIFwiLVwiICsgb2JqLmlkO1xuICB0aGlzLmRlY29yYXRpb25zW29iai5rZXldID0gb2JqO1xufTtcblxuLyogUnVuIGRlY29yYXRpb25zXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZGVjb3JhdGlvbnMgPSBmdW5jdGlvbigpIHtcbiAgLy8gY3JlYXRlIHRyYWlscyBmcm9tIG9iamVjdHNcbiAgZm9yIChrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAob2JqLmMudHJhaWxzLmNvdW50ID09PSAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgdGhpcy5jcmVhdGVfdHJhaWwob2JqLCBvYmouYy50cmFpbHMpO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBhbGwgZGVjb3JhdGlvbnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZGVjb3JhdGlvbnMpIHtcbiAgICB2YXIgZGVjID0gdGhpcy5kZWNvcmF0aW9uc1trZXldO1xuXG4gICAgLy8gZG8gdGltZW91dFxuICAgIGRlYy50aW1lb3V0LS07XG4gICAgaWYgKGRlYy50aW1lb3V0IDwgMSkge1xuICAgICAgZGVsZXRlIHRoaXMuZGVjb3JhdGlvbnNba2V5XTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIG1vdmVcbiAgICBkZWMueCA9IHRoaXMuY29yZS5tYXAubG9vcF94KGRlYy54ICsgZGVjLnNwZWVkX3gpLmZpeGVkKCk7XG4gICAgZGVjLnkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShkZWMueSArIGRlYy5zcGVlZF95KS5maXhlZCgpO1xuICB9XG59O1xuXG4vKiBDcmVhdGUgdHJhaWxzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3JlYXRlX3RyYWlsID0gZnVuY3Rpb24ob2JqLCB0cmFpbHMpIHtcbiAgLy8gY3JlYXRlIHRoZSB0cmFpbHNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmFpbHMuY291bnQ7IGkrKykge1xuICAgIHZhciBhcmdzID0ge1xuICAgICAgaWQ6IGksXG4gICAgICBzcHJpdGU6IHRyYWlscy5zcHJpdGUsXG4gICAgICB0aW1lb3V0OiB0cmFpbHMudGltZW91dCxcbiAgICAgIHg6IG9iai5keCxcbiAgICAgIHk6IG9iai5keVxuICAgIH07XG4gICAgaWYgKHRyYWlscy5yb3RhdGUpIHtcbiAgICAgIGFyZ3MuYW5nbGUgPSByYW5kKDAsIDM2MCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFyZ3MuYW5nbGUgPSBhbmdsZV9hZGQoZ2V0X2FuZ2xlKC1vYmouc3BlZWRfeCwgLW9iai5zcGVlZF95KSwgOTApO1xuICAgICAgYXJncy54IC09IG9iai5zcGVlZF94O1xuICAgICAgYXJncy55IC09IG9iai5zcGVlZF95O1xuICAgICAgaWYgKHRyYWlscy5vZmZzZXRfeCB8fCB0cmFpbHMub2Zmc2V0X3kpIHtcbiAgICAgICAgdmFyIHh5eCA9IHh5X3NwZWVkKGFuZ2xlX2FkZChhcmdzLmFuZ2xlLCA5MCksIHRyYWlscy5vZmZzZXRfeCk7XG4gICAgICAgIHZhciB4eXkgPSB4eV9zcGVlZChhbmdsZV9hZGQoYXJncy5hbmdsZSwgMTgwKSwgdHJhaWxzLm9mZnNldF95KTtcbiAgICAgICAgYXJncy54ICs9IHh5eC54ICsgeHl5Lng7XG4gICAgICAgIGFyZ3MueSArPSB4eXgueSArIHh5eS55O1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodHJhaWxzLm1vdmUpIHtcbiAgICAgIHZhciBtb3ZlX2FuZ2xlID0gcmFuZCgwLCAzNjApO1xuICAgICAgdmFyIHh5ID0geHlfc3BlZWQobW92ZV9hbmdsZSwgdHJhaWxzLnNwZWVkKTtcbiAgICAgIGFyZ3Muc3BlZWRfeCA9IC14eS54O1xuICAgICAgYXJncy5zcGVlZF95ID0gLXh5Lnk7XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlX2RlY29yYXRpb24oYXJncyk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgRXZlbnRzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIGV2ZW50c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cykge1xuICAvLyBldmVudHMgZnJvbSBzY2hlbWVcbiAgdmFyIGZfZXZlbnQgPSB0aGlzLnNjaGVtZS5ldmVudHMuZnJhbWVbdGhpcy5jb3JlLmN1cnJlbnRfZnJhbWVdO1xuICBpZiAoZl9ldmVudCkge1xuICAgIHRoaXMucnVuX2V2ZW50KGZfZXZlbnQpO1xuICB9XG59O1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBoYW5kbGUgYXJyYXkgb2YgZXZlbnRzXG4gIGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnQubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMucnVuX2V2ZW50KGV2ZW50W2ldKTtcbiAgICB9XG4gIH1cblxuICAvLyBydW4gZXZlbnRcbiAgaWYgKGV2ZW50LnR5cGUgPT09IFwid2VhcG9uX3NlbGVjdFwiKSB7XG4gICAgdGhpcy53ZWFwb25fc2VsZWN0X24oZXZlbnQubik7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3ZWFwb25fc2Nyb2xsXCIpIHtcbiAgICB0aGlzLndlYXBvbl9zY3JvbGwoZXZlbnQuZG93bik7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJzd2l0Y2hfd2F0Y2hlcl9jYW1lcmFcIikge1xuICAgIHRoaXMuc3dpdGNoX3dhdGNoZXJfY2FtZXJhKCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJmb2xsb3dfd2VhcG9uXCIpIHtcbiAgICB0aGlzLnRvZ2dsZV93ZWFwb25fZm9sbG93KHRydWUpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZm9sbG93X21vdXNlXCIpIHtcbiAgICB0aGlzLnRvZ2dsZV9tb3VzZV9mb2xsb3coKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdyb3VuZF9kYW1hZ2VcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2dyb3VuZF9kYW1hZ2UoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwic2NyZWVuX3NoYWtlXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9zY3JlZW5fc2hha2UoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2hlYWx0aFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfcGxheWVyX2hlYWx0aChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJwbGF5ZXJfbGV2ZWxcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3BsYXllcl9sZXZlbChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJleHBsb3Npb25cIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2V4cGxvc2lvbihldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJhcm1vdXJ5XCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9hcm1vdXJ5KGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImJvdW5jZVwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfYm91bmNlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInNvdW5kXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJ0YXJnZXRcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3RhcmdldChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJzcGF3blwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc3Bhd24oZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZm9jdXNcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2ZvY3VzKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImFsZXJ0XCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9hbGVydChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJjb2xsZWN0XCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9jb2xsZWN0KGV2ZW50KTtcbiAgfVxufTtcblxuLyogR3JvdW5kIERhbWFnZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2dyb3VuZF9kYW1hZ2UgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBhcmUgd2UgZGVzdHJveWluZyBsYW5kXG4gIGlmICghdGhpcy5zY2hlbWUuZGVzdHJveV9sYW5kKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZGFtYWdlIHRoZSBncm91bmRcbiAgdGhpcy5jb3JlLm1hcC5zZXRfY2lyY2xlKGV2ZW50LngsIGV2ZW50LnksIGV2ZW50LnJhZGl1cywgMCk7XG4gIHRoaXMuZGVzdHJveV9sYW5kKGV2ZW50LngsIGV2ZW50LnksIGV2ZW50LnJhZGl1cyk7XG4gIC8vIHRoaXMuY29yZS5tYXAuZ3Jhdml0eV9ldmVudF9yZWNhbGN1bGF0ZShldmVudC54LCBldmVudC55LCBldmVudC5yYWRpdXMpO1xuXG4gIC8vIGRvIHRoZSBkaWcgbm9pc2UgYW5kIHNtb2tlIHRyYWlsc1xuICBpZiAoZXZlbnQuZGlnKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoeyB4OiBldmVudC54LCB5OiBldmVudC55LCBzb3VuZDogXCJkaWdcIiB9KTtcbiAgICB0aGlzLmNyZWF0ZV90cmFpbChcbiAgICAgIHsgZHg6IGV2ZW50LngsIGR5OiBldmVudC55IH0sXG4gICAgICB7XG4gICAgICAgIGNvdW50OiA3LFxuICAgICAgICBzcHJpdGU6IFwic21va2VcIixcbiAgICAgICAgdGltZW91dDogMjAsXG4gICAgICAgIHJvdGF0ZTogdHJ1ZSxcbiAgICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgICAgc3BlZWQ6IDFcbiAgICAgIH1cbiAgICApO1xuICB9XG59O1xuXG4vKiBTY3JlZW4gU2hha2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9zY3JlZW5fc2hha2UgPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgZGlzdGFuY2UgPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZShcbiAgICBldmVudC54LFxuICAgIGV2ZW50LnksXG4gICAgdGhpcy5jYW1lcmEueCxcbiAgICB0aGlzLmNhbWVyYS55XG4gICk7XG4gIGlmIChkaXN0YW5jZSA8IGV2ZW50LnJhZGl1cyAqIDIpIHtcbiAgICB0aGlzLmNhbWVyYS5zaGFrZV9mcmFtZSA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICB0aGlzLmNhbWVyYS5zaGFrZV9zaXplID0gKGRpc3RhbmNlIC0gZXZlbnQucmFkaXVzKSAvIDQ7XG4gIH1cbn07XG5cbi8qIEhlYWx0aFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3BsYXllcl9oZWFsdGggPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBldmVudC5pZF07XG4gIGlmIChvYmopIHtcbiAgICB2YXIgdGV4dCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoOTgyOSkgKyBcIiBcIiArIGV2ZW50LmhlYWx0aDtcbiAgICB0aGlzLmNyZWF0ZV9tZXNzYWdlKG9iaiwgXCIjZmY5OTk5XCIsIHRleHQsIDIyKTtcbiAgfVxufTtcblxuLyogTGV2ZWxcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9wbGF5ZXJfbGV2ZWwgPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBldmVudC5pZF07XG5cbiAgLy8gaXMgdGhpcyB1c1xuICBpZiAodGhpcy5wbGF5ZXJfaWQgPT09IGV2ZW50LmlkKSB7XG4gICAgdGhpcy5zZXRfc2NvcmUoKTtcblxuICAgIC8vIHNldCBhbGVydFxuICAgIGlmIChldmVudC5uZXcgPiBldmVudC5wcmV2KSB7XG4gICAgICB2YXIgbHYgPSB0aGlzLnNjaGVtZS5sZXZlbHM7XG4gICAgICB2YXIgbjEgPSBldmVudC5uZXc7XG4gICAgICB2YXIgbjIgPSBldmVudC5wcmV2O1xuICAgICAgdmFyIGJlbmVmaXRzID0gXCJcIjtcbiAgICAgIGlmIChsdi5oZWFsdGhbbjFdID4gbHYuaGVhbHRoW24yXSkge1xuICAgICAgICBiZW5lZml0cyArPSBcIjxicj4rXCIgKyAobHYuaGVhbHRoW24xXSAtIGx2LmhlYWx0aFtuMl0pICsgXCIgbWF4IGhlYWx0aFwiO1xuICAgICAgfVxuICAgICAgaWYgKGx2LmRhbWFnZVtuMV0gPiBsdi5kYW1hZ2VbbjJdKSB7XG4gICAgICAgIGJlbmVmaXRzICs9IFwiPGJyPitcIiArIChsdi5kYW1hZ2VbbjFdIC0gbHYuZGFtYWdlW24yXSkgKyBcIiBkYW1hZ2VcIjtcbiAgICAgIH1cbiAgICAgIGlmIChsdi5zcGVlZFtuMV0gPiBsdi5zcGVlZFtuMl0pIHtcbiAgICAgICAgYmVuZWZpdHMgKz0gXCI8YnI+K1wiICsgKGx2LnNwZWVkW24xXSAtIGx2LnNwZWVkW24yXSkgKyBcIiBzcGVlZFwiO1xuICAgICAgfVxuICAgICAgaWYgKGx2Lmp1bXBbbjFdID4gbHYuanVtcFtuMl0pIHtcbiAgICAgICAgYmVuZWZpdHMgKz0gXCI8YnI+K1wiICsgKGx2Lmp1bXBbbjFdIC0gbHYuanVtcFtuMl0pICsgXCIganVtcCBwb3dlclwiO1xuICAgICAgfVxuICAgICAgdmFyIHRleHQgPVxuICAgICAgICBcIjxzbWFsbD5Zb3UgaGF2ZSByZWFjaGVkPC9zbWFsbD48YnI+PHNwYW4gY2xhc3M9J2xhcmdlJz5MZXZlbCBcIiArXG4gICAgICAgIChldmVudC5uZXcgKyAxKSArXG4gICAgICAgIFwiPC9zcGFuPjxzbWFsbCBjbGFzcz0nYmx1ZSc+XCIgK1xuICAgICAgICBiZW5lZml0cyArXG4gICAgICAgIFwiPC9zbWFsbD5cIjtcbiAgICAgIHRoaXMuc2V0X2FsZXJ0KHRleHQsIFwiI2VlZWVlZVwiLCAxNTApO1xuICAgIH1cbiAgfVxuXG4gIC8vIGRvIHRoZSBmbG91cmlzaFxuICBpZiAoZXZlbnQubmV3ID4gZXZlbnQucHJldikge1xuICAgIHRoaXMuY3JlYXRlX21lc3NhZ2Uob2JqLCBcIiNlZWVcIiwgXCJsdmwgXCIgKyAoZXZlbnQubmV3ICsgMSksIDMwLCAtMzApO1xuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHsgeDogb2JqLngsIHk6IG9iai55LCBzb3VuZDogXCJsZXZlbHVwXCIgfSk7XG4gICAgdGhpcy5jcmVhdGVfdHJhaWwob2JqLCB7XG4gICAgICBjb3VudDogNyxcbiAgICAgIHNwcml0ZTogXCJzdGFyLWJsdWVcIixcbiAgICAgIHRpbWVvdXQ6IDMwLFxuICAgICAgcm90YXRlOiB0cnVlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwZWVkOiAxLjVcbiAgICB9KTtcbiAgICB0aGlzLmNyZWF0ZV90cmFpbChvYmosIHtcbiAgICAgIGNvdW50OiA3LFxuICAgICAgc3ByaXRlOiBcImJhbGwtcmVkXCIsXG4gICAgICB0aW1lb3V0OiAzMCxcbiAgICAgIHJvdGF0ZTogdHJ1ZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcGVlZDogMlxuICAgIH0pO1xuICB9XG59O1xuXG4vKiBFeHBsb3Npb25cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9leHBsb3Npb24gPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBmb2N1cyBjYW1lcmEgaWYgd2Ugd2VyZSBmb2xsb3dpbmcgaXRcbiAgaWYgKHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9PT0gZXZlbnQua2V5KSB7XG4gICAgdGhpcy5jYW1lcmEuZm9jdXMgPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgdGhpcy5jYW1lcmEuZm9jdXNfdGltZSA9IDMwO1xuICAgIHRoaXMuY2FtZXJhLmZ4ID0gZXZlbnQueDtcbiAgICB0aGlzLmNhbWVyYS5meSA9IGV2ZW50Lnk7XG4gIH1cbn07XG5cbi8qIEFybW91cnlcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9hcm1vdXJ5ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKGV2ZW50LnBsYXllcl9pZCA9PSB0aGlzLnBsYXllcl9pZCkge1xuICAgIHRoaXMuc2V0X3dlYXBvbihldmVudC53ZWFwb24pO1xuICB9XG59O1xuXG4vKiBCb3VuY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9ib3VuY2UgPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbZXZlbnQub2JqXTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHNvdW5kID0gb2JqLmMuYXVkaW8uYm91bmNlO1xuICBpZiAoc291bmQpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7IHg6IGV2ZW50LngsIHk6IGV2ZW50LnksIHNvdW5kOiBzb3VuZCB9KTtcbiAgfVxufTtcblxuLyogU291bmRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9zb3VuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciB2b2x1bWUgPSB0aGlzLmdldF9kaXN0X3ZvbHVtZShldmVudC54LCBldmVudC55KTtcbiAgaWYgKHZvbHVtZSA+IDApIHtcbiAgICB0aGlzLmF1ZGlvLnBsYXkoZXZlbnQuc291bmQsIHZvbHVtZSk7XG4gIH1cbn07XG5cbi8qIFNldCBhIHRhcmdldCBvbiB0aGUgbWFwXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfdGFyZ2V0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5jcmVhdGVfZGVjb3JhdGlvbih7XG4gICAgc3ByaXRlOiBcImZvY3VzXCIsXG4gICAgdGltZW91dDogZXZlbnQudGltZSxcbiAgICB4OiBldmVudC54LFxuICAgIHk6IGV2ZW50LnksXG4gICAgcmVwZWF0OiBmYWxzZVxuICB9KTtcbiAgdGhpcy5hdWRpby5wbGF5KFwiaG9taW5nXCIsIDEpO1xufTtcblxuLyogU3Bhd24gT2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3NwYXduID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5jcmVhdGVfb2JqZWN0KGV2ZW50LmFyZ3MsIHRydWUpO1xuXG4gIGV2ZW50LmFyZ3MudGltZSA9IDMwO1xuICBpZiAoZXZlbnQudGFyZ2V0KSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfdGFyZ2V0KGV2ZW50LmFyZ3MpO1xuICB9XG4gIGlmIChldmVudC5mb2N1cykge1xuICAgIHRoaXMucnVuX2V2ZW50X2ZvY3VzKGV2ZW50LmFyZ3MpO1xuICB9XG59O1xuXG4vKiBGb2N1cyBDYW1lcmFcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9mb2N1cyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuY2FtZXJhLmZvY3VzID0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICB0aGlzLmNhbWVyYS5mb2N1c190aW1lID0gZXZlbnQudGltZTtcbiAgdGhpcy5jYW1lcmEuZnggPSBldmVudC54O1xuICB0aGlzLmNhbWVyYS5meSA9IGV2ZW50Lnk7XG4gIGlmIChldmVudC50YXJnZXQpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF90YXJnZXQoZXZlbnQpO1xuICB9XG59O1xuXG4vKiBTaG93IGFsZXJ0XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfYWxlcnQgPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLnNldF9hbGVydChldmVudC50ZXh0LCBcIiNlZWVlZWVcIiwgZXZlbnQudGltZSk7XG59O1xuXG4vKiBDcmF0ZSBHcmFiXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfY29sbGVjdCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGlzIHRoaXMgbm90IHVzXG4gIGlmIChldmVudC5wbGF5ZXJfaWQgIT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IG91ciBvYmplY3RcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgZXZlbnQucGxheWVyX2lkXTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjcmF0ZXNcbiAgaWYgKGV2ZW50LmNvbGxlY3RlZCA9PT0gXCJjcmF0ZVwiKSB7XG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW2V2ZW50LndlYXBvbl07XG4gICAgdGhpcy5jcmVhdGVfbWVzc2FnZShcbiAgICAgIG9iaixcbiAgICAgIFwiI2VlZWVlZVwiLFxuICAgICAgXCIrXCIgKyBldmVudC5jb3VudCArIFwiIFwiICsgd2VhcG9uLnRpdGxlLFxuICAgICAgMThcbiAgICApO1xuICB9XG5cbiAgLy8gZ2Vtc1xuICBpZiAoZXZlbnQuY29sbGVjdGVkID09PSBcImdlbVwiKSB7XG4gICAgdGhpcy5zZXRfc2NvcmUoKTtcbiAgICB0aGlzLmNyZWF0ZV9tZXNzYWdlKG9iaiwgXCIjYWFmZjk5XCIsIFwiK1wiICsgZXZlbnQubiwgMjIpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEV4cGxvc2lvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDaGVjayBmb3IgZXhwbG9zaW9uc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V4cGxvc2lvbnMgPSBmdW5jdGlvbigpIHtcbiAgLy8gcnVuIHRocm91Z2ggYWxsIGV4cGxvc2lvbnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5leHBsb3Npb25zKSB7XG4gICAgdmFyIGV4cGxvZGVfc3RhdGUgPSB0aGlzLmNvcmUuc3RhdGUuZXhwbG9zaW9uc1trZXldO1xuICAgIHZhciBleHBsb2RlX3Nwcml0ZSA9IHRoaXMuZXhwbG9zaW9uc1trZXldO1xuXG4gICAgLy8gaWYgaXQncyBub3Qgc3RhcnRlZFxuICAgIGlmICghZXhwbG9kZV9zcHJpdGUpIHtcbiAgICAgIHZhciB0eXBlID0gdGhpcy5jLm9iamVjdHNbZXhwbG9kZV9zdGF0ZS5wYXJlbnRfdHlwZV07XG4gICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIGNyZWF0ZSBzcHJpdGUgcmVmZXJlbmNlXG4gICAgICB0aGlzLmV4cGxvc2lvbnNba2V5XSA9IHtcbiAgICAgICAgc3ByaXRlOiB0eXBlLmFuaW1hdGlvbi5leHBsb3Npb24sXG4gICAgICAgIGZyYW1lOiB0aGlzLmNvcmUuc3RhdGUuZnJhbWUsXG4gICAgICAgIHg6IGV4cGxvZGVfc3RhdGUueCxcbiAgICAgICAgeTogZXhwbG9kZV9zdGF0ZS55XG4gICAgICB9O1xuXG4gICAgICAvLyBydW4gc291bmQgZWZmZWN0XG4gICAgICBpZiAodHlwZS5hdWRpby5leHBsb3Npb24pIHtcbiAgICAgICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgICAgIHNvdW5kOiB0eXBlLmF1ZGlvLmV4cGxvc2lvbixcbiAgICAgICAgICB4OiBleHBsb2RlX3N0YXRlLngsXG4gICAgICAgICAgeTogZXhwbG9kZV9zdGF0ZS55XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBydW4gc2NyZWVuIHNoYWtlXG4gICAgICBpZiAodHlwZS5kYW1hZ2UgPiAwKSB7XG4gICAgICAgIHRoaXMucnVuX2V2ZW50X3NjcmVlbl9zaGFrZSh7XG4gICAgICAgICAgcmFkaXVzOiB0eXBlLmRhbWFnZSxcbiAgICAgICAgICB4OiBleHBsb2RlX3N0YXRlLngsXG4gICAgICAgICAgeTogZXhwbG9kZV9zdGF0ZS55XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBtYXRjaCBwb3NpdGlvblxuICAgIGV4cGxvZGVfc3ByaXRlLnggPSBleHBsb2RlX3Nwcml0ZS54O1xuICAgIGV4cGxvZGVfc3ByaXRlLnkgPSBleHBsb2RlX3Nwcml0ZS55O1xuICB9XG5cbiAgLy8gcmVtb3ZlIGV4cGxvc2lvbnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZXhwbG9zaW9ucykge1xuICAgIGlmICh0aGlzLmNvcmUuc3RhdGUuZnJhbWUgPiB0aGlzLmV4cGxvc2lvbnNba2V5XS5mcmFtZSArIDYwKSB7XG4gICAgICBkZWxldGUgdGhpcy5leHBsb3Npb25zW2tleV07XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIGdhbWUoXG4gIGFzc2V0cyxcbiAgYXVkaW8sXG4gIGlucHV0LFxuICBzY2hlbWUsXG4gIG1hcCxcbiAgcGxheWVycyxcbiAgcGxheWVyX2lkLFxuICB0b3BfZXZlbnQsXG4gIG9uYm9hcmRpbmdcbikge1xuICAvLyBhcmdzXG4gIHRoaXMuYyA9IGNvbmZpZztcbiAgdGhpcy5pbWcgPSBhc3NldHMuaW1nO1xuICB0aGlzLmF1ZGlvID0gYXVkaW87XG4gIHRoaXMuaW5wdXQgPSBpbnB1dDtcbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG4gIHRoaXMubWFwID0gbWFwO1xuICB0aGlzLnBsYXllcnMgPSBwbGF5ZXJzO1xuICB0aGlzLnBsYXllcl9pZCA9IHBsYXllcl9pZDtcbiAgdGhpcy5sZWFkZXIgPSBudWxsO1xuICB0aGlzLnRvcF9ldmVudCA9IHRvcF9ldmVudDtcbiAgdGhpcy5vbmJvYXJkaW5nID0gb25ib2FyZGluZztcblxuICAvLyBnYW1lIHJ1bm5pbmdcbiAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgdGhpcy5sYXN0X2ZyYW1lID0gMDtcblxuICAvLyBtYWluIGRpdlxuICB0aGlzLmRpdiA9IGVsZW1lbnQoeyBjbGFzczogXCJnYW1lIGZ1bGxcIiB9KTtcbiAgdGhpcy5nYW1lX2FyZWEgPSBlbGVtZW50KHsgaWQ6IFwiZ2FtZV9pbnB1dFwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZ2FtZV9hcmVhKTtcblxuICAvLyBzZXQgdXAgZ2FtZSBtb2R1bGVzXG4gIHRoaXMuaW5pdF9jcm9zc2hhaXIoKTtcbiAgdGhpcy5pbml0X2NhbnZhcygpO1xuICB0aGlzLmluaXRfYXJtb3VyeSgpO1xuICB0aGlzLmluaXRfbWFwKCk7XG4gIHRoaXMuaW5pdF9jYW1lcmEoKTtcbiAgdGhpcy5pbml0X2JhY2tncm91bmQoKTtcbiAgdGhpcy5pbml0X3RpbWUoKTtcbiAgdGhpcy5pbml0X3Njb3JlKCk7XG4gIHRoaXMuaW5pdF9hbGVydCgpO1xuICB0aGlzLmluaXRfYXVkaW8oKTtcblxuICAvLyB0aGluZ3MgdG8gZGlzcGxheVxuICB0aGlzLm9iamVjdHMgPSB7fTtcbiAgdGhpcy5leHBsb3Npb25zID0ge307XG4gIHRoaXMuZGVjb3JhdGlvbnMgPSB7fTtcbiAgdGhpcy5hY3Rpb25zID0ge307XG4gIHRoaXMuc3ByaXRlcyA9IFtdO1xuICB0aGlzLm1lc3NhZ2VzID0gW107XG4gIHRoaXMubGFiZWxzID0ge307XG5cbiAgLy8gd2FpdCBwZXJpb2QgYmVmb3JlIG9uIGZpcmVkIHdlYXBvbiBpbW1lZGlhdGVseSBhZnRlclxuICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPSAwO1xuXG4gIC8vIGNyZWF0ZSBjb3JlXG4gIHRoaXMuY29yZSA9IG5ldyBjb3JlKHRoaXMuYywgdGhpcy5zY2hlbWUsIHRoaXMubWFwLmZnLCB0aGlzLm1hcC5ncmF2aXR5X21hcCk7XG4gIHRoaXMuY29yZS5zdGF0ZSA9IHRoaXMuY29yZS5ibGFua19zdGF0ZSgpO1xuICB0aGlzLmNvcmUuc3RhdGUgPSB0aGlzLmNvcmUuc3RhdGU7XG59XG5cbi8qIEluaXQgZ2FtZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihmcmFtZSkge1xuICAvLyBtYXJrIHBsYXllciBldmVudHNcbiAgdGhpcy5wbGF5ZXJfZXZlbnRzID0ge307XG5cbiAgLy8gc2V0IGdhbWUgc3RhdHVzIHRvIGFjdGl2ZVxuICB0aGlzLmFjdGl2ZSA9IHRydWU7XG5cbiAgLy8gc2V0IHBsYXllciBvYmpcbiAgdGhpcy5zZXRfdGhpc19wbGF5ZXJfcmVmcygpO1xuICB0aGlzLnNldF9zY29yZSgpO1xuXG4gIC8vIHNldCBpbml0aWFsIGNhbWVyYVxuICBpZiAodGhpcy5wbGF5ZXIpIHtcbiAgICB0aGlzLmNhbWVyYS54ID0gdGhpcy5wbGF5ZXJfb2JqLng7XG4gICAgdGhpcy5jYW1lcmEueSA9IHRoaXMucGxheWVyX29iai55O1xuICB9XG59O1xuXG4vKiBSdW4gY29yZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZnJhbWVfY29yZSA9IGZ1bmN0aW9uKGZyYW1lLCBhY3Rpb25zKSB7XG4gIC8vIHNldCB1cCB0aGlzIHN0YXRlXG4gIHRoaXMuY29yZS5zdGF0ZS5mcmFtZSA9IGZyYW1lO1xuICB0aGlzLmNvcmUuc3RhdGUuZXZlbnRzID0gW107XG4gIHZhciByZXNwb25zZSA9IHRoaXMuY29yZS5hY3Rpb24odGhpcy5wbGF5ZXJfaWQsIGFjdGlvbnMpO1xuXG4gIC8vIHJ1biBwbGF5ZXIgYWN0aW9uc1xuICB0aGlzLnJ1bl9wbGF5ZXJzX2V2ZW50cygpO1xuXG4gIC8vIHJ1biB0aGlzIHN0YXRlXG4gIHRoaXMuY29yZS5mcmFtZSgpO1xuXG4gIC8vIHJldHVybiB0aGUgaW5wdXQgcmVzcG9uc2VcbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogUnVuIGRpc3BsYXlcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmZyYW1lX2Rpc3BsYXkgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5ydW5fb2JqZWN0cygpO1xuICB0aGlzLnJ1bl9jcm9zc2hhaXIoKTtcbiAgdGhpcy5ydW5fY2FtZXJhKCk7XG4gIHRoaXMucnVuX2V4cGxvc2lvbnMoKTtcbiAgdGhpcy5ydW5fZGVjb3JhdGlvbnMoKTtcbiAgdGhpcy5ydW5fbGFiZWxzKCk7XG4gIHRoaXMucnVuX2NhbnZhcygpO1xuICB0aGlzLnJ1bl9hdWRpbygpO1xuICB0aGlzLnJ1bl90aW1lKCk7XG4gIHRoaXMucnVuX2FsZXJ0KCk7XG4gIHRoaXMucnVuX2FybW91cnkoKTtcblxuICAvLyBkZXRvbmF0aW9uIGNvb2xkb3duXG4gIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biAtPSB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPiAwID8gMSA6IDA7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdEdhbWVcblx0SW5wdXRcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBHZXQgY3VycmVudCBjb3JlIGFjdGlvbiBpbnB1dFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmdldF9pbnB1dCA9IGZ1bmN0aW9uKCkge1xuICAvLyBpcyB0aGUgZ2FtZSBhY3RpdmUgYW5kIGRvZXMgaXQgaGF2ZSBhIHBsYXllclxuICBpZiAoIXRoaXMuYWN0aXZlIHx8ICF0aGlzLnBsYXllciB8fCB0aGlzLnBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2V0IHNvdXJjZSBvZiBjcm9zc2hhaXIgbW92ZW1lbnRcbiAgaWYgKFxuICAgIHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV91cFwiKSB8fFxuICAgIHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9kb3duXCIpIHx8XG4gICAgdGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikgfHxcbiAgICB0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIilcbiAgKSB7XG4gICAgdGhpcy5jcm9zc2hhaXJfc291cmNlID0gXCJidXR0b25cIjtcbiAgfSBlbHNlIHtcbiAgICBpZiAodGhpcy5pbnB1dC5jdXJzb3JfbW92ZWQpIHtcbiAgICAgIHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9IFwiY3Vyc29yXCI7XG4gICAgfVxuICB9XG4gIHRoaXMuaW5wdXQuY3Vyc29yX21vdmVkID0gZmFsc2U7XG5cbiAgLy8gZ2V0IHBsYXllciBhY3Rpb25zXG4gIHZhciBhY3RpdmUgPSBmYWxzZTtcbiAgdmFyIHJlc3BvbnNlID0ge1xuICAgIGFjdGlvbjogXCJub25lXCIsXG4gICAgYW5nbGU6IHJvdW5kKHRoaXMuY3Jvc3NoYWlyKVxuICB9O1xuXG4gIC8vIHdlYXBvbiBrZXlzXG4gIHZhciBzaG9vdF9rZXkgPSBmYWxzZTtcbiAgdmFyIGZpcmVfd2VhcG9uID0gZmFsc2U7XG4gIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1t0aGlzLmN1cnJlbnRfd2VhcG9uXTtcbiAgaWYgKHdlYXBvbiAmJiB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPT09IDAgJiYgdGhpcy5pbnB1dC5hY3RpdmUoXCJzaG9vdFwiKSkge1xuICAgIC8vIGFiYW5kb24gYSBmb2xsb3dlZCB3ZWFwb25cbiAgICBpZiAodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbdGhpcy53ZWFwb25fZm9sbG93aW5nXSkge1xuICAgICAgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID0gMTU7XG4gICAgICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSBcIlwiO1xuXG4gICAgICAvLyBub3JtYWwgZmlyaW5nXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG9uIHNjcmVlblxuICAgICAgdmFyIHBvcyA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKFxuICAgICAgICB0aGlzLnBsYXllcl9vYmoueCxcbiAgICAgICAgdGhpcy5wbGF5ZXJfb2JqLnksXG4gICAgICAgIHRoaXMucGxheWVyX29iai5jLnNpemVcbiAgICAgICk7XG4gICAgICBpZiAoIXBvcy5vbl9zY3JlZW4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBjb29sZG93blxuICAgICAgaWYgKHRoaXMucGxheWVyLmNvb2xkb3duID4gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1t0aGlzLmN1cnJlbnRfd2VhcG9uXTtcbiAgICAgIGlmICghd2VhcG9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICh3ZWFwb24ucG93ZXJfdXAgJiYgdGhpcy5wb3dlcl91cCA8IDYwKSB7XG4gICAgICAgIHRoaXMucG93ZXJfdXArKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpcmVfd2VhcG9uID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5wb3dlcmVkID0gZmFsc2U7XG4gICAgaWYgKHRoaXMucG93ZXJfdXAgPiAwKSB7XG4gICAgICBmaXJlX3dlYXBvbiA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucG93ZXJfdXAgPSAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIGZpcmUgd2VhcG9uXG4gIGlmIChmaXJlX3dlYXBvbikge1xuICAgIHRoaXMucG93ZXJlZCA9IHRydWU7XG4gICAgcmVzcG9uc2UuYWN0aW9uID0gXCJzaG9vdFwiO1xuICAgIHJlc3BvbnNlLnBvd2VyID0gdGhpcy5wb3dlcl91cDtcbiAgICByZXNwb25zZS53ZWFwb24gPSB0aGlzLmN1cnJlbnRfd2VhcG9uO1xuICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5wb3dlcl91cCA9IDA7XG4gIH1cblxuICAvLyB3YWxraW5nIHJlc3RyaWN0ZWQgYWN0aW9uc1xuICBpZiAodGhpcy5wbGF5ZXJfb2JqLmdyb3VuZGVkICYmICFhY3RpdmUpIHtcbiAgICAvLyBhcnJvdyBrZXkgbW92ZW1lbnRcbiAgICB2YXIgYXJyb3dfYW5nbGUgPSAtMTtcbiAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3VwXCIpKSB7XG4gICAgICBhcnJvd19hbmdsZSA9IDkwO1xuICAgICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9yaWdodFwiKSkge1xuICAgICAgICBhcnJvd19hbmdsZSA9IDEzNTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfbGVmdFwiKSkge1xuICAgICAgICBhcnJvd19hbmdsZSA9IDQ1O1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2Rvd25cIikpIHtcbiAgICAgIGFycm93X2FuZ2xlID0gMjcwO1xuICAgICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9yaWdodFwiKSkge1xuICAgICAgICBhcnJvd19hbmdsZSA9IDIyNTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfbGVmdFwiKSkge1xuICAgICAgICBhcnJvd19hbmdsZSA9IDMwNTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9yaWdodFwiKSkge1xuICAgICAgICBhcnJvd19hbmdsZSA9IDE4MDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfbGVmdFwiKSkge1xuICAgICAgICBhcnJvd19hbmdsZSA9IDA7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChhcnJvd19hbmdsZSAhPT0gLTEpIHtcbiAgICAgIHJlc3BvbnNlLmFjdGlvbiA9IFwibW92ZVwiO1xuICAgICAgcmVzcG9uc2UuYW5nbGUgPSBhcnJvd19hbmdsZTtcbiAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gbW92ZSBjcm9zc2hhaXIga2V5XG4gICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZVwiKSkge1xuICAgICAgcmVzcG9uc2UuYWN0aW9uID0gXCJtb3ZlXCI7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIGp1bXBpbmdcbiAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJqdW1wXCIpKSB7XG4gICAgICByZXNwb25zZS5hY3Rpb24gPSBcImp1bXBcIjtcbiAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLy8gY2FuY2VsIG1vdXNlIGZvbGxvdyBpZiBkb2luZyBzdHVmZlxuICBpZiAoYWN0aXZlKSB7XG4gICAgdGhpcy5jYW5jZWxfbW91c2VfZm9sbG93KCk7XG4gIH1cblxuICBpZiAoIWFjdGl2ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIHNldCB0aGUgb25ib2FyZGluZ1xuICB0aGlzLm9uYm9hcmRpbmcuc2V0KHJlc3BvbnNlLmFjdGlvbik7XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBSdW4gT2JqZWN0c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFN0YXJ0IG9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfb2JqZWN0ID0gZnVuY3Rpb24ocHJvcHMsIHNwYXduKSB7XG4gIC8vIHVzZSBleGlzdGluZyBwcm9wcyB0byBtYWtlIG5ldyBjb3JlIG9iamVjdFxuICB2YXIgb2JqID0gdGhpcy5jb3JlLmNyZWF0ZV9vYmplY3QocHJvcHMpO1xuXG4gIC8vIHByZXZpb3VzIHBvc2l0aW9uXG4gIG9iai5weCA9IG9iai54O1xuICBvYmoucHkgPSBvYmoueTtcbiAgb2JqLnBnID0gZmFsc2U7XG4gIG9iai5weDIgPSBvYmoueDtcbiAgb2JqLnB5MiA9IG9iai55O1xuXG4gIC8vIGRpc3BsYXkgdmFsdWVzXG4gIG9iai5oZWFkaW5nID0gMDtcbiAgb2JqLmhpZGUgPSAwO1xuICBvYmouYmFycmVsX2FuZ2xlID0gMDtcbiAgb2JqLmFjdGlvbmVkID0gZmFsc2U7XG4gIG9iai5wbGF5ZXJfbG9ja2VkID0gZmFsc2U7XG5cbiAgLy8gZGlzcGxheSBwb3NpdGlvblxuICBvYmouZHggPSBvYmoueDtcbiAgb2JqLmR5ID0gb2JqLnk7XG4gIG9iai5kcyA9IDA7XG5cbiAgLy8gY2hlY2sgZm9yIHNob290IGV2ZW50c1xuICB0aGlzLnNldF9zaG90X29iamVjdChvYmopO1xuXG4gIC8vIHByZXZpb3VzIGRpc3BsYXkgcG9zaXRpb25cbiAgb2JqLnBkeCA9IG9iai54O1xuICBvYmoucGR5ID0gb2JqLnk7XG5cbiAgLy8gc3Bhd25cbiAgaWYgKG9iai5jLnNwYXduIHx8IHNwYXduKSB7XG4gICAgLy8gaGlkZSBuZXcgb2JqZWN0IGZvciB4IGZyYW1lc1xuICAgIG9iai5oaWRlID0gOTtcblxuICAgIC8vIGFkZCBhIHNwYXduIGRlY29yYXRpb24gb3ZlciB0b3BcbiAgICB0aGlzLmNyZWF0ZV9kZWNvcmF0aW9uKHtcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICB0aW1lb3V0OiAxNixcbiAgICAgIHJlcGVhdDogZmFsc2UsXG4gICAgICB0eXBlOiBcInNwYXduXCIsXG4gICAgICBzcHJpdGU6IFwidGVsZXBvcnRcIlxuICAgIH0pO1xuXG4gICAgLy8gcGxheSBzcGF3biBzb3VuZFxuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgIHNvdW5kOiBcInBoYXNlXCIsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gb2JqO1xufTtcblxuLyogU2V0IGEgc2hvdCBpdGVtcyBuZXcgbG9jYXRpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfc2hvdF9vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gY2hlY2sgZm9yIGEgcGxheWVyXG4gIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjaGVjayBmb3IgYW4gYWN0aW9uXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBhY3QgPSBwbGF5ZXIuZXZlbnRzW2ldO1xuICAgIGlmIChhY3Qub2JqID09PSBvYmoua2V5KSB7XG4gICAgICBvYmouaGlkZSA9IDEwMDtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFJ1biBvYmplY3RzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX29iamVjdHMgPSBmdW5jdGlvbigpIHtcbiAgLy8gY2hlY2sgZm9yIHBsYXllciBsb2NrZWQgb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAob2JqLmMucGxheWVyX2xvY2spIHtcbiAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIG9iai5wbGF5ZXJfaWRdO1xuICAgICAgaWYgKHBsYXllcikge1xuICAgICAgICBwbGF5ZXIucGxheWVyX2xvY2tlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdGhpcy5ydW5fb2JqZWN0KHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV0pO1xuICB9XG59O1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fb2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIHNuYXAgaW1tZWRpYXRlbHkgaWYgdXNcbiAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgb2JqLmR4ID0gb2JqLng7XG4gICAgb2JqLmR5ID0gb2JqLnk7XG5cbiAgICAvLyBwcmV2ZW50IGJvYmJsaW5nXG4gICAgaWYgKG9iai54ID09PSBvYmoucHgyICYmIG9iai55ID09PSBvYmoucHkyKSB7XG4gICAgICBvYmouZHggPSBvYmoucGR4O1xuICAgICAgb2JqLmR5ID0gb2JqLnBkeTtcbiAgICB9XG5cbiAgICAvLyBpbnRlcnBvbGF0ZSBvdGhlcnNcbiAgfSBlbHNlIHtcbiAgICAvLyBnZXQgbWF4IHNwZWVkIG9mIG1vdmVtZW50XG4gICAgaWYgKCFvYmouYWN0aW9uZWQpIHtcbiAgICAgIG9iai5kcyA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICAgIH1cblxuICAgIC8vIGludGVycG9sYXRlXG4gICAgdmFyIGRpc3RfeCA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3gob2JqLmR4LCBvYmoueCk7XG4gICAgdmFyIGRpc3RfeSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kob2JqLmR5LCBvYmoueSk7XG4gICAgdmFyIG1heF9zcGVlZCA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlKG9iai5keCwgb2JqLmR5LCBvYmoueCwgb2JqLnkpO1xuICAgIHZhciBzcGVlZCA9IG1heChtYXhfc3BlZWQgLyA0LCBtaW4obWF4X3NwZWVkLCBvYmouZHMpKTtcbiAgICB2YXIgbW92ZSA9IGNoZWNrX3NwZWVkKGRpc3RfeCwgZGlzdF95LCBzcGVlZCk7XG4gICAgb2JqLmR4ID0gdGhpcy5jb3JlLm1hcC5sb29wX3gob2JqLmR4ICsgcm91bmQobW92ZS54KSk7XG4gICAgb2JqLmR5ID0gdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5ICsgcm91bmQobW92ZS55KSk7XG4gIH1cblxuICAvLyBoYXZlIHdlIG1vdmVkXG4gIHZhciBtb3ZlZCA9IG9iai5wZHggIT09IG9iai5keCB8fCBvYmoucGR5ICE9PSBvYmouZHk7XG5cbiAgLy8gc2V0IGhlYWRpbmcgYW5kIGJhcnJlbCBhbmdsZVxuICBpZiAobW92ZWQpIHtcbiAgICBvYmouaGVhZGluZyA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcob2JqLnBkeCwgb2JqLnBkeSwgb2JqLmR4LCBvYmouZHkpO1xuICAgIG9iai5iYXJyZWxfYW5nbGUgPSBpbmNyZW1lbnRfYW5nbGUob2JqLmJhcnJlbF9hbmdsZSwgb2JqLmhlYWRpbmcsIDMpO1xuICB9XG5cbiAgLy8gaXMgdXNcbiAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgb2JqLmJhcnJlbF9hbmdsZSA9IG9iai5wbGF5ZXJfbG9ja2VkID8gb2JqLmhlYWRpbmcgOiB0aGlzLmNyb3NzaGFpcjtcbiAgfVxuXG4gIC8vIGlmIHdlIGhhdmUganVzdCBsYW5kZWQgc2V0IGluaXRpYWwgYW5nbGVcbiAgaWYgKG9iai5ncm91bmRlZCAmJiAhb2JqLnBnKSB7XG4gICAgdmFyIGFuZ2xlID0gZ2V0X2FuZ2xlKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gICAgdmFyIHdhbGsgPSB0aGlzLmNvcmUubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoucHgsIG9iai5weSwgYW5nbGUsIDYpO1xuICAgIGlmICh3YWxrLm1vdmUpIHtcbiAgICAgIG9iai5hbmdsZSA9IHdhbGsuYW5nbGU7XG4gICAgICBvYmouZGlyZWN0aW9uID0gd2Fsay5kaXJlY3Rpb247XG4gICAgICBvYmoucHggPSBvYmoueDtcbiAgICAgIG9iai5weSA9IG9iai55O1xuICAgICAgb2JqLmFuaW1hdGUgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBpZiB3YWxraW5nXG4gIGVsc2UgaWYgKG9iai5ncm91bmRlZCkge1xuICAgIC8vIHNldCB0aGUgZGlzcGxheSB2YWx1ZXNcbiAgICB2YXIgZGlzdF94ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeChvYmoucGR4LCBvYmouZHgpO1xuICAgIHZhciBkaXN0X3kgPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV95KG9iai5wZHksIG9iai5keSk7XG4gICAgdmFyIGFtb3VudF9tb3ZlZCA9IGdldF9zcGVlZChkaXN0X3gsIGRpc3RfeSk7XG4gICAgaWYgKGFtb3VudF9tb3ZlZCA+IDMpIHtcbiAgICAgIG9iai5hbmltYXRlID0gdHJ1ZTtcbiAgICAgIG9iai5kaXJlY3Rpb24gPSB0aGlzLmNvcmUubWFwLmdyb3VuZF9kaXIoXG4gICAgICAgIG9iai5wZHgsXG4gICAgICAgIG9iai5wZHksXG4gICAgICAgIG9iai5keCxcbiAgICAgICAgb2JqLmR5XG4gICAgICApO1xuICAgICAgb2JqLmFuZ2xlID0gb2JqLmhlYWRpbmc7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9iai5hbmltYXRlID0gb2JqLmMuYW5pbWF0aW9uLmdyb3VuZDtcbiAgICB9XG5cbiAgICAvLyBzZXQgc3ByaXRlc1xuICAgIHZhciBzdWZmaXggPSBvYmouYW5pbWF0ZSA/IFwiLXdhbGstXCIgOiBcIi1zdGlsbC1cIjtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5jLmFuaW1hdGlvbi5zcHJpdGUgKyBzdWZmaXggKyBvYmouZGlyZWN0aW9uO1xuICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgIG9iai5kaXJlY3Rpb24gPT09IFwibGVmdFwiID8gb2JqLmFuZ2xlIDogYW5nbGVfYWRkKG9iai5hbmdsZSwgMTgwKTtcblxuICAgIC8vIG5vdCB3YWxraW5nXG4gIH0gZWxzZSB7XG4gICAgb2JqLnNwcml0ZV9rZXkgPSBvYmouYy5hbmltYXRpb24uc3ByaXRlO1xuICAgIG9iai5hbmltYXRlID0gdHJ1ZTtcblxuICAgIC8vIHBsYXllcnNcbiAgICB2YXIgcGxheWVyID0gdGhpcy5jb3JlLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gICAgaWYgKG9iai50eXBlID09PSBcInBsYXllclwiICYmIHBsYXllci5oaXQgPT09IDApIHtcbiAgICAgIG9iai5kaXJlY3Rpb24gPVxuICAgICAgICBvYmouYmFycmVsX2FuZ2xlID49IDkwICYmIG9iai5iYXJyZWxfYW5nbGUgPCAyNzAgPyBcInJpZ2h0XCIgOiBcImxlZnRcIjtcbiAgICAgIG9iai5zcHJpdGVfa2V5ICs9IFwiLWFpci1cIiArIG9iai5kaXJlY3Rpb247XG4gICAgICBvYmouZGlzcGxheV9hbmdsZSA9XG4gICAgICAgIG9iai5kaXJlY3Rpb24gPT09IFwibGVmdFwiXG4gICAgICAgICAgPyBvYmouYmFycmVsX2FuZ2xlXG4gICAgICAgICAgOiBhbmdsZV9hZGQob2JqLmJhcnJlbF9hbmdsZSwgMTgwKTtcbiAgICB9XG5cbiAgICAvLyBzcGlubmluZyBpbiB0aGUgYWlyXG4gICAgZWxzZSBpZiAob2JqLmMuYW5pbWF0aW9uLmFpcl9zcGluKSB7XG4gICAgICB2YXIgZ3JvdW5kID0gdGhpcy5jb3JlLm1hcC5ncm91bmRfcGl4ZWwocm91bmQob2JqLmR4KSwgcm91bmQob2JqLmR5KSk7XG4gICAgICB2YXIgc3BlZWQgPSBnZXRfc3BlZWQob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgICAgIHZhciBuID0gZ3JvdW5kID8gMCA6IDE7XG4gICAgICB2YXIgYW5nbGVfYWRkaW5nID0gbW92ZWQgPyBzcGVlZCAqIDIgOiBuO1xuICAgICAgb2JqLmRpc3BsYXlfYW5nbGUgPSBhbmdsZV9hZGQob2JqLmRpc3BsYXlfYW5nbGUsIGFuZ2xlX2FkZGluZyk7XG5cbiAgICAgIC8vIHBvaW50aW5nIHRvd2FyZHMgdHJhamVjdG9yeVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocm91bmQoYWJzKG9iai5zcGVlZF94KSA9PT0gMCkgJiYgcm91bmQoYWJzKG9iai5zcGVlZF95KSA9PT0gMCkpIHtcbiAgICAgICAgaWYgKG9iai5jLmFuaW1hdGlvbi5haXJfc3Bpbikge1xuICAgICAgICAgIG9iai5kaXNwbGF5X2FuZ2xlID0gYW5nbGVfYWRkKG9iai5kaXNwbGF5X2FuZ2xlLCAyKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqLmRpc3BsYXlfYW5nbGUgPSBhbmdsZV9hZGQoXG4gICAgICAgICAgZ2V0X2FuZ2xlKC1vYmouc3BlZWRfeCwgLW9iai5zcGVlZF95KSxcbiAgICAgICAgICA5MFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHN0YXRpYyBhbmdsZSBmbGFnXG4gIGlmIChvYmouYy5hbmltYXRpb24uc3RhdGljX2FuZ2xlKSB7XG4gICAgb2JqLmRpc3BsYXlfYW5nbGUgPSAwO1xuICB9XG5cbiAgLy8gd2VhcG9uIGp1c3QgZmlyZWQgZmxhZ3NcbiAgaWYgKG9iai5maXJlX3Nwcml0ZV9jb3VudCkge1xuICAgIG9iai5maXJlX3Nwcml0ZV9jb3VudC0tO1xuICB9XG4gIGlmIChvYmouZmlyZV9hbmdsZV9sb2NrX2NvdW50KSB7XG4gICAgb2JqLmRpcmVjdGlvbiA9IG9iai5maXJlX2RpcmVjdGlvbjtcbiAgICBvYmouZGlzcGxheV9hbmdsZSA9XG4gICAgICBvYmouZGlyZWN0aW9uID09PSBcImxlZnRcIlxuICAgICAgICA/IG9iai5maXJlX2FuZ2xlX2xvY2tcbiAgICAgICAgOiBhbmdsZV9hZGQob2JqLmZpcmVfYW5nbGVfbG9jaywgMTgwKTtcbiAgICBvYmouZmlyZV9hbmdsZV9sb2NrX2NvdW50LS07XG4gIH1cbiAgaWYgKG9iai5maXJlX2JvZHlfc3ByaXRlX2NvdW50KSB7XG4gICAgb2JqLnNwcml0ZV9rZXkgPSBvYmouZmlyZV9ib2R5X3Nwcml0ZSArIFwiLVwiICsgb2JqLmRpcmVjdGlvbjtcbiAgICBvYmouYW5pbWF0ZSA9IHRydWU7XG4gICAgb2JqLmZpcmVfYm9keV9zcHJpdGVfY291bnQtLTtcbiAgfVxuXG4gIC8vIHByZXZpb3VzIHBvc2l0aW9uXG4gIG9iai5weDIgPSBvYmoucHg7XG4gIG9iai5weTIgPSBvYmoucHk7XG4gIG9iai5weCA9IG9iai54O1xuICBvYmoucHkgPSBvYmoueTtcbiAgb2JqLnBnID0gb2JqLmdyb3VuZGVkO1xuICBvYmoucGR4ID0gb2JqLmR4O1xuICBvYmoucGR5ID0gb2JqLmR5O1xuICBvYmoucGxheWVyX2xvY2tlZCA9IGZhbHNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBSdW4gUGxheWVyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFN0YXJ0IHRoaXMgcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9wbGF5ZXIgPSBmdW5jdGlvbihwbGF5ZXIsIHByZXNlcnZlX2V2ZW50cywgcmVtb3ZlX2V2ZW50cykge1xuICB2YXIgbmV3X3BsYXllcjtcblxuICAvLyB1c2Ugc291cmNlc1xuICBpZiAocGxheWVyKSB7XG4gICAgdmFyIGNvcmVfcGxheWVyID0gdGhpcy5jb3JlLnN0YXRlLnBsYXllcnNbcGxheWVyLmlkXTtcbiAgICBpZiAocHJlc2VydmVfZXZlbnRzICYmIGNvcmVfcGxheWVyKSB7XG4gICAgICBwbGF5ZXIuZXZlbnRzID0gY29yZV9wbGF5ZXIuZXZlbnRzLmNvbmNhdChwbGF5ZXIuZXZlbnRzKTtcbiAgICB9XG4gICAgbmV3X3BsYXllciA9IHRoaXMuY29yZS5jcmVhdGVfcGxheWVyKHBsYXllcik7XG4gICAgaWYgKHJlbW92ZV9ldmVudHMpIHtcbiAgICAgIG5ld19wbGF5ZXIuZXZlbnRzID0gW107XG4gICAgfVxuXG4gICAgLy8gY3JlYXRlIG5ld1xuICB9IGVsc2Uge1xuICAgIG5ld19wbGF5ZXIgPSB0aGlzLmNvcmUuY3JlYXRlX3BsYXllcih7IGlkOiB0aGlzLnBsYXllcl9pZCB9KTtcbiAgICB0aGlzLmNyZWF0ZV9vYmplY3QoeyB0eXBlOiBcInBsYXllclwiLCBwbGF5ZXJfaWQ6IHRoaXMucGxheWVyX2lkIH0pO1xuICAgIHRoaXMuY29yZS5pbml0X3BsYXllcih0aGlzLnBsYXllcl9pZCk7XG4gIH1cblxuICAvLyBzZXQgdGhpcyBwbGF5ZXJcbiAgaWYgKG5ld19wbGF5ZXIuaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgdGhpcy5wbGF5ZXIgPSBuZXdfcGxheWVyO1xuICAgIHRoaXMuc2V0X2FybW91cnkoKTtcbiAgfVxufTtcblxuLyogUmVzb2x2ZSBwbGF5ZXJzIGZyb20gb3RoZXIgc3RhdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX3BsYXllcnNfZXZlbnRzID0gZnVuY3Rpb24ocGxheWVycykge1xuICAvLyBjbGVhciBvYmplY3QgYWN0aW9uZWQgZXZlbnRzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV0uYWN0aW9uZWQgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIHJ1biBwbGF5ZXIgZXZlbnRzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUucGxheWVycykge1xuICAgIHRoaXMucnVuX3BsYXllcl9ldmVudHModGhpcy5jb3JlLnN0YXRlLnBsYXllcnNba2V5XSk7XG4gIH1cblxuICAvLyByZW1vdmUgb2xkIGV2ZW50c1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLnBsYXllcl9ldmVudHMpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5wbGF5ZXJfZXZlbnRzW2lkXSkge1xuICAgICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSA+IHRoaXMucGxheWVyX2V2ZW50c1tpZF1ba2V5XSArIDMwKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnBsYXllcl9ldmVudHNbaWRdW2tleV07XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fcGxheWVyX2V2ZW50cyA9IGZ1bmN0aW9uKHBsYXllcikge1xuICAvLyBpbml0IHBsYXllciBldmVudHNcbiAgaWYgKCF0aGlzLnBsYXllcl9ldmVudHNbcGxheWVyLmlkXSkge1xuICAgIHRoaXMucGxheWVyX2V2ZW50c1twbGF5ZXIuaWRdID0ge307XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGV2ZW50c1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsYXllci5ldmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZXZlbnQgPSBwbGF5ZXIuZXZlbnRzW2ldO1xuICAgIHZhciBrZXkgPSBldmVudC5mcmFtZSArIFwiLVwiICsgZXZlbnQudHlwZTtcbiAgICBpZiAoIXRoaXMucGxheWVyX2V2ZW50c1trZXldKSB7XG4gICAgICB0aGlzLnBsYXllcl9ldmVudChwbGF5ZXIsIGV2ZW50KTtcbiAgICAgIHRoaXMucGxheWVyX2V2ZW50c1trZXldID0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59O1xuXG4vKiBQbGF5ZXIgYWN0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucGxheWVyX2V2ZW50ID0gZnVuY3Rpb24ocGxheWVyLCBldmVudCkge1xuICAvLyBpcyB0aGVyZSBpc24ndCBhbiBhY3Rpb25cbiAgaWYgKCFldmVudCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCBwbGF5ZXIgb2JqZWN0XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllci5pZF07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gbWFyayBvYmplY3QgYXMgaGF2aW5nIHBlcmZvcm1lZCBhbiBhY3Rpb25cbiAgb2JqLmFjdGlvbmVkID0gdHJ1ZTtcblxuICAvLyBtb3ZlbWVudFxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3YWxrXCIpIHtcbiAgICBvYmouZHMgPSB0aGlzLnNjaGVtZS5sZXZlbHMuc3BlZWRbcGxheWVyLmxldmVsXSB8fCBvYmouYy5zcGVlZC5tb3ZlO1xuICB9XG5cbiAgLy8ganVtcFxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJqdW1wXCIpIHtcbiAgICBvYmouZHMgPSB0aGlzLnNjaGVtZS5sZXZlbHMuanVtcFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLmp1bXA7XG5cbiAgICAvLyBwbGF5IGp1bXAgc291bmRcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7XG4gICAgICBzb3VuZDogXCJqdW1wXCIsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55XG4gICAgfSk7XG4gIH1cblxuICAvLyBzaG9vdGluZ1xuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJzaG9vdFwiKSB7XG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW2V2ZW50LndlYXBvbl07XG4gICAgdmFyIHdlYXBvbl9vYmogPSB0aGlzLmMub2JqZWN0c1t3ZWFwb24ub2JqZWN0XTtcblxuICAgIC8vIGFyZSB3ZSBmaXJpbmcgdGhlIHdlYXBvblxuICAgIGlmIChvYmoucGxheWVyX2lkID09PSB0aGlzLnBsYXllcl9pZCkge1xuICAgICAgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID0gbWluKDIwLCB3ZWFwb24uY29vbGRvd24pO1xuICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gdGhpcy53ZWFwb25fZm9sbG93ID8gZXZlbnQub2JqIDogXCJcIjtcblxuICAgICAgLy8gb3RoZXIgcGxheWVycyBzaG90c1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgc2hvdF9vYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdO1xuICAgICAgaWYgKHNob3Rfb2JqKSB7XG4gICAgICAgIHNob3Rfb2JqLmhpZGUgPSAwO1xuICAgICAgICBzaG90X29iai5keCA9IG9iai5keDtcbiAgICAgICAgc2hvdF9vYmouZHkgPSBvYmouZHk7XG4gICAgICAgIG9iai5iYXJyZWxfYW5nbGUgPSB0aGlzLmNvcmUubWFwLmdldF9oZWFkaW5nKFxuICAgICAgICAgIG9iai54LFxuICAgICAgICAgIG9iai55LFxuICAgICAgICAgIHNob3Rfb2JqLngsXG4gICAgICAgICAgc2hvdF9vYmoueVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmIHdlIGFyZSBub3QgYSBwbGF5ZXIgYW5kIGF1dG8gZm9sbG93IHdlYXBvbnNcbiAgICBpZiAodGhpcy5wbGF5ZXJfaWQgPT09IG51bGwpIHtcbiAgICAgIGlmIChvYmoucGxheWVyX2lkID09PSBwYXJzZUludCh0aGlzLmxlYWRlcikgJiYgd2VhcG9uLmF1dG9fZm9sbG93KSB7XG4gICAgICAgIHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9IGV2ZW50Lm9iajtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB3ZWFwb24ganVzdCBmaXJlZCBzcHJpdGVcbiAgICBpZiAod2VhcG9uLmZpcmVfc3ByaXRlKSB7XG4gICAgICB2YXIgc3ByaXRlX2tleSA9IFwiYW50LXdlYXBvbi1cIiArIHdlYXBvbi5maXJlX3Nwcml0ZTtcbiAgICAgIHZhciBhbmltYXRpb24gPSB0aGlzLmMuYW5pbWF0aW9uc1tzcHJpdGVfa2V5ICsgXCItbGVmdFwiXTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZSA9IHNwcml0ZV9rZXk7XG4gICAgICBvYmouZmlyZV9zcHJpdGVfY291bnQgPSBhbmltYXRpb24gPyBhbmltYXRpb24ubGVuZ3RoICsgMSA6IDE7XG4gICAgICBvYmouZmlyZV9zcHJpdGVfZnJhbWUgPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgfVxuXG4gICAgLy8gd2VhcG9uIGJvZHkgc3ByaXRlXG4gICAgaWYgKHdlYXBvbi5maXJlX2JvZHlfc3ByaXRlKSB7XG4gICAgICB2YXIgY29vbCA9IHdlYXBvbl9vYmoudGltZW91dFxuICAgICAgICA/IHdlYXBvbl9vYmoudGltZW91dCArIDVcbiAgICAgICAgOiB3ZWFwb24uY29vbGRvd24gKyA1O1xuICAgICAgb2JqLmZpcmVfYm9keV9zcHJpdGUgPSBcImFudC1ib2R5LVwiICsgd2VhcG9uLmZpcmVfYm9keV9zcHJpdGU7XG4gICAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZV9jb3VudCA9IGNvb2w7XG4gICAgfVxuXG4gICAgLy8gd2VhcG9uIGFuZ2xlIGxvY2tcbiAgICBpZiAod2VhcG9uLmZpcmVfYW5nbGVfbG9jaykge1xuICAgICAgdmFyIGNvb2wgPSB3ZWFwb25fb2JqLnRpbWVvdXRcbiAgICAgICAgPyB3ZWFwb25fb2JqLnRpbWVvdXQgKyA1XG4gICAgICAgIDogd2VhcG9uLmNvb2xkb3duICsgNTtcbiAgICAgIG9iai5maXJlX2RpcmVjdGlvbiA9IG9iai5kaXJlY3Rpb247XG4gICAgICBvYmouZmlyZV9hbmdsZV9sb2NrID0gb2JqLmJhcnJlbF9hbmdsZTtcbiAgICAgIG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQgPSBjb29sO1xuICAgIH1cblxuICAgIC8vIHBsYXkgc291bmQgZWZmZWN0XG4gICAgdGhpcy5wbGF5X3dlYXBvbl9hdWRpbyh7XG4gICAgICB4OiBvYmouZHgsXG4gICAgICB5OiBvYmouZHksXG4gICAgICBwbGF5ZXJfaWQ6IG9iai5wbGF5ZXJfaWQsXG4gICAgICB3ZWFwb246IGV2ZW50LndlYXBvblxuICAgIH0pO1xuICB9XG5cbiAgLy8gY29sbGVjdCBhIGNyYXRlIG9yIG1lZHBhY2tcbiAgaWYgKGV2ZW50LnR5cGUgPT09IFwiY3JhdGVcIiB8fCBldmVudC50eXBlID09PSBcIm1lZHBhY2tcIikge1xuICAgIC8vIHJlbW92ZSB0aGUgb2JqZWN0XG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial0pIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdO1xuICAgIH1cblxuICAgIC8vIHBsYXkgc291bmQgZWZmZWN0XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNvdW5kOiBcImxvY2tubG9hZFwiXG4gICAgfSk7XG4gIH1cblxuICAvLyBjb2xsZWN0ZWQgYSBnZW1cbiAgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2VtXCIpIHtcbiAgICAvLyByZW1vdmUgdGhlIG9iamVjdFxuICAgIGlmICh0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdKSB7XG4gICAgICBkZWxldGUgdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbZXZlbnQub2JqXTtcbiAgICB9XG5cbiAgICAvLyBwbGF5IHNvdW5kIGVmZmVjdFxuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBzb3VuZDogXCJiaW5nXCJcbiAgICB9KTtcbiAgfVxufTtcblxuLyogU2V0IHRoaXMgcGxheWVyIHJlZmVyZW5jZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfdGhpc19wbGF5ZXJfcmVmcyA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZXQgcGxheWVyIHJlZlxuICBpZiAodGhpcy5jb3JlLnN0YXRlLnBsYXllcnNbdGhpcy5wbGF5ZXJfaWRdKSB7XG4gICAgdGhpcy5wbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1t0aGlzLnBsYXllcl9pZF07XG4gIH1cblxuICAvLyBzZXQgb2JqZWN0IHJlZlxuICBpZiAodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyB0aGlzLnBsYXllcl9pZF0pIHtcbiAgICB0aGlzLnBsYXllcl9vYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHRoaXMucGxheWVyX2lkXTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBTY29yZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBCdWlsZCBzY29yZSBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfc2NvcmUgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLnNjaGVtZS5zY29yZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuZGl2X3Njb3JlID0gZWxlbWVudCh7IGNsYXNzOiBcInNjb3JlXCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfc2NvcmUpO1xuXG4gIHRoaXMuZGl2X3Njb3JlX2dlbSA9IGVsZW1lbnQoeyBjbGFzczogXCJnZW1cIiB9KTtcbiAgdGhpcy5kaXZfc2NvcmVfdGV4dCA9IGVsZW1lbnQoeyBjbGFzczogXCJ0ZXh0XCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfZ2VtKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3Njb3JlLCB0aGlzLmRpdl9zY29yZV90ZXh0KTtcblxuICAvLyBhcmUgd2UgZG9pbmcgbGV2ZWxzXG4gIGlmICh0aGlzLnNjaGVtZS5sZXZlbHMpIHtcbiAgICB0aGlzLmRpdl9zY29yZV9iYXIgPSBlbGVtZW50KHsgY2xhc3M6IFwiYmFyXCIgfSk7XG4gICAgdGhpcy5kaXZfc2NvcmVfYmFyX2luID0gZWxlbWVudCh7IGNsYXNzOiBcImJhci1pbm5lclwiIH0pO1xuICAgIHRoaXMuZGl2X3Njb3JlX2xldmVsID0gZWxlbWVudCh7IGNsYXNzOiBcImxldmVsIGhleC1idXR0b25cIiwgdGV4dDogXCIgTFZMXCIgfSk7XG4gICAgdGhpcy5kaXZfc2NvcmVfbGV2ZWxfbnVtID0gZWxlbWVudCh7IGNsYXNzOiBcImxldmVsLW51bVwiLCB0ZXh0OiBcIjFcIiB9KTtcbiAgICBhcHBlbmQodGhpcy5kaXZfc2NvcmUsIHRoaXMuZGl2X3Njb3JlX2Jhcik7XG4gICAgYXBwZW5kKHRoaXMuZGl2X3Njb3JlX2JhciwgdGhpcy5kaXZfc2NvcmVfYmFyX2luKTtcbiAgICBhcHBlbmQodGhpcy5kaXZfc2NvcmUsIHRoaXMuZGl2X3Njb3JlX2xldmVsKTtcbiAgICBhcHBlbmQodGhpcy5kaXZfc2NvcmVfbGV2ZWwsIHRoaXMuZGl2X3Njb3JlX2xldmVsX251bSk7XG4gIH1cbn07XG5cbi8qIFNldCBzY29yZSBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9zY29yZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuc2NoZW1lLnNjb3JlKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghdGhpcy5wbGF5ZXIpIHtcbiAgICBoaWRlKHRoaXMuZGl2X3Njb3JlKTtcbiAgICByZXR1cm47XG4gIH0gZWxzZSB7XG4gICAgc2hvdyh0aGlzLmRpdl9zY29yZSk7XG4gIH1cblxuICB0aGlzLmRpdl9zY29yZV90ZXh0LmlubmVySFRNTCA9IHRoaXMucGxheWVyLnNjb3JlO1xuICBpZiAodGhpcy5zY2hlbWUubGV2ZWxzKSB7XG4gICAgdGhpcy5kaXZfc2NvcmVfbGV2ZWxfbnVtLmlubmVySFRNTCA9IHRoaXMucGxheWVyLmxldmVsICsgMTtcblxuICAgIC8vIGRvIGV4cCBiYXJcbiAgICB2YXIgd2lkdGggPSAwO1xuICAgIHZhciB0aGlzX2xldmVsID0gdGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlW3RoaXMucGxheWVyLmxldmVsXTtcbiAgICB2YXIgbmV4dF9sZXZlbCA9IHRoaXMuc2NoZW1lLmxldmVscy5zY29yZVt0aGlzLnBsYXllci5sZXZlbCArIDFdO1xuICAgIGlmICh0aGlzX2xldmVsICYmIG5leHRfbGV2ZWwpIHtcbiAgICAgIHdpZHRoID0gKFxuICAgICAgICAoKHRoaXMucGxheWVyLnNjb3JlIC0gdGhpc19sZXZlbCkgLyAobmV4dF9sZXZlbCAtIHRoaXNfbGV2ZWwpKSAqXG4gICAgICAgIDk0XG4gICAgICApLmZpeGVkKCk7XG4gICAgfVxuICAgIHRoaXMuZGl2X3Njb3JlX2Jhcl9pbi5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCIlXCI7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgVGltZXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBCdWlsZCB0aW1lIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF90aW1lID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2hvd190aW1lKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gdGltZSBkaXZzXG4gIHRoaXMuZGl2X3RpbWUgPSBlbGVtZW50KHsgY2xhc3M6IFwidGltZVwiIH0pO1xuICB0aGlzLmRpdl90aW1lb3V0ID0gZWxlbWVudCh7IGNsYXNzOiBcInRpbWVvdXRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl90aW1lKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl90aW1lb3V0KTtcbiAgaGlkZSh0aGlzLmRpdl90aW1lb3V0KTtcblxuICB0aGlzLmRpc3BsYXlfdGltZSA9IFwiXCI7XG59O1xuXG4vKiBSdW4gdGhlIHRpbWUgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fdGltZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuc2NoZW1lLnNob3dfdGltZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzZWNzO1xuXG4gIC8vIGNvdW50aW5nIHVwXG4gIGlmICh0aGlzLnNjaGVtZS50aW1lX2xpbWl0ID09PSAwKSB7XG4gICAgc2VjcyA9IGZsb29yKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAvIDI0KTtcblxuICAgIC8vIGNvdW50aW5nIGRvd25cbiAgfSBlbHNlIHtcbiAgICB2YXIgZGlmID0gdGhpcy5zY2hlbWUudGltZV9saW1pdCAtIHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICBzZWNzID0gY2VpbChkaWYgLyAyNCk7XG5cbiAgICAvLyB0aW1lb3V0XG4gICAgaWYgKGRpZiA9PT0gMjQwKSB7XG4gICAgICBzaG93KHRoaXMuZGl2X3RpbWVvdXQpO1xuICAgIH1cbiAgICBpZiAoZGlmIDw9IDI0MCAmJiBkaWYgJSAyNCA9PT0gMCAmJiBkaWYgPiAxKSB7XG4gICAgICB0aGlzLmF1ZGlvLnBsYXkoXCJibG9vcDJcIiwgMC41KTtcbiAgICB9XG4gICAgaWYgKGRpZiA9PT0gMSkge1xuICAgICAgaGlkZSh0aGlzLmRpdl90aW1lb3V0KTtcbiAgICB9XG4gICAgaWYgKHNlY3MgPD0gMTApIHtcbiAgICAgIGlmIChkaWYgJSAyNCA9PT0gMCAmJiBzZWNzID49IDEpIHtcbiAgICAgICAgdGhpcy5kaXZfdGltZW91dC5pbm5lckhUTUwgPSBzZWNzO1xuICAgICAgfVxuICAgICAgaWYgKGRpZiA9PT0gOTYpIHtcbiAgICAgICAgdGhpcy5hdWRpby5wbGF5KFwidGltZW91dFwiLCAwLjgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGRvIHRpbWVcbiAgdmFyIG5ld190aW1lID0gXCIwOjAwXCI7XG4gIGlmIChzZWNzID4gMCkge1xuICAgIHZhciBtaW51dGVzID0gZmxvb3Ioc2VjcyAvIDYwKSxcbiAgICAgIHNlY29uZHMgPSAoc2VjcyAtIG1pbnV0ZXMgKiA2MCkudG9TdHJpbmcoKTtcbiAgICBzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPCAyID8gXCIwXCIgKyBzZWNvbmRzIDogc2Vjb25kcztcbiAgICBuZXdfdGltZSA9IG1pbnV0ZXMgKyBcIjpcIiArIHNlY29uZHM7XG4gIH1cbiAgaWYgKHRoaXMuZGlzcGxheV90aW1lICE9PSBuZXdfdGltZSkge1xuICAgIHRoaXMuZGlzcGxheV90aW1lID0gbmV3X3RpbWU7XG4gICAgdGhpcy5kaXZfdGltZS5pbm5lckhUTUwgPSBuZXdfdGltZTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRBdWRpb1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbndpbmRvdy5BdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7XG5cbmZ1bmN0aW9uIGF1ZGlvKGFzc2V0c191cmwpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIHRoaXMuY29udCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgdGhpcy5idWZmZXJzID0ge307XG4gIHRoaXMucmVwZWF0ZXJzID0ge307XG4gIHRoaXMudm9sdW1lID0gMC4xO1xuICB0aGlzLnN0b3JlZF92b2x1bWUgPSAwLjE7XG5cbiAgLy8gYnV0dG9uIGhvdmVyIHN3aXNoIGV2ZW50c1xuICB0aGlzLmJ1dHRvbl9ob3ZlciA9IG51bGw7XG4gIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChzZWxmLnZvbHVtZSA9PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImJ1dHRvblwiKSB8fFxuICAgICAgZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IFwiYnV0dG9uXCJcbiAgICApIHtcbiAgICAgIGlmIChcbiAgICAgICAgZS50YXJnZXQgIT0gc2VsZi5idXR0b25faG92ZXIgJiZcbiAgICAgICAgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImRpc2FibGVkXCIpXG4gICAgICApIHtcbiAgICAgICAgc2VsZi5idXR0b25faG92ZXIgPSBlLnRhcmdldDtcbiAgICAgICAgc2VsZi5wbGF5KFwiYmxvb3AxXCIsIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLmJ1dHRvbl9ob3ZlciA9IG51bGw7XG4gICAgfVxuICB9O1xufVxuXG4vKiBTZXQgdm9sdW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnNldF9nbG9iYWxfdm9sdW1lID0gZnVuY3Rpb24odm9sKSB7XG4gIHRoaXMudm9sdW1lID0gdm9sO1xufTtcblxuLyogQWRkIGJ1ZmZlcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuYWRkX2J1ZmZlcnMgPSBmdW5jdGlvbihidWZmZXJzKSB7XG4gIHRoaXMuYnVmZmVycyA9IE9iamVjdC5hc3NpZ24odGhpcy5idWZmZXJzLCBidWZmZXJzKTtcbn07XG5cbi8qIFBsYXkgYSBmaWxlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbihrZXksIHZvbHVtZSwgcmVwZWF0KSB7XG4gIC8vIGlmIG5vIHNvdW5kIGVmZmVjdFxuICBpZiAoIXRoaXMuYnVmZmVyc1trZXldKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaWYgd2UncmUgbm90IGFjdGl2ZVxuICBpZiAoIWRvY3VtZW50Lmhhc0ZvY3VzKCkgJiYga2V5ICE9PSBcImpvaW5cIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBvYmogPSB7fTtcbiAgb2JqLmF1ZGlvX2tleSA9IGtleTtcbiAgb2JqLmdhaW4gPSB0aGlzLmNvbnQuY3JlYXRlR2FpbigpO1xuICBvYmouc291cmNlID0gdGhpcy5jb250LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICBvYmouc291cmNlLmJ1ZmZlciA9IHRoaXMuYnVmZmVyc1trZXldO1xuICBvYmouc291cmNlLmNvbm5lY3Qob2JqLmdhaW4pO1xuICBvYmouZ2Fpbi5jb25uZWN0KHRoaXMuY29udC5kZXN0aW5hdGlvbik7XG4gIG9iai5zb3VyY2UubG9vcCA9IHJlcGVhdDtcbiAgb2JqLnNvdXJjZS5zdGFydCgwKTtcblxuICB0aGlzLnNldF92b2x1bWUob2JqLCB2b2x1bWUpO1xuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBTZXQgdm9sdW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnNldF92b2x1bWUgPSBmdW5jdGlvbihvYmosIHZvbHVtZSkge1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuICB2b2x1bWUgPSAhdm9sdW1lID8gMCA6IG1pbih2b2x1bWUsIDEpO1xuICBvYmouZ2Fpbi5nYWluLnZhbHVlID0gKHZvbHVtZSAqIHRoaXMudm9sdW1lKS5maXhlZCgpO1xufTtcblxuLyogU3RvcCBwbGF5aW5nIGF1ZGlvXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXVkaW8ucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbihvYmopIHtcbiAgdGhpcy5jb250LmNsb3NlKCk7XG4gIHRoaXMuY29udCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0RWxlbWVudCBGdW5jdGlvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBlbGVtZW50KHByb3BzKSB7XG4gIC8vIGNyZWF0ZSB0aGUgZWxlbWVudFxuICB2YXIgdHlwZSA9IHByb3BzLnR5cGUgPyBwcm9wcy50eXBlIDogXCJkaXZcIixcbiAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XG5cbiAgLy8gc2V0IHByb3BlcnRpZXNcbiAgaWYgKHByb3BzLmlkKSB7XG4gICAgZWwuaWQgPSBwcm9wcy5pZDtcbiAgfVxuICBpZiAocHJvcHMuc3JjKSB7XG4gICAgZWwuc3JjID0gcHJvcHMuc3JjO1xuICB9XG4gIGlmIChwcm9wcy5pbnR5cGUpIHtcbiAgICBlbC50eXBlID0gcHJvcHMuaW50eXBlO1xuICB9XG4gIGlmIChwcm9wcy5jbGFzcykge1xuICAgIGVsLmNsYXNzTmFtZSA9IHByb3BzLmNsYXNzO1xuICB9XG4gIGlmIChwcm9wcy50ZXh0KSB7XG4gICAgZWwuaW5uZXJIVE1MID0gcHJvcHMudGV4dDtcbiAgfVxuICBpZiAocHJvcHMudmFsdWUpIHtcbiAgICBlbC52YWx1ZSA9IHByb3BzLnZhbHVlO1xuICB9XG4gIGlmIChwcm9wcy5kYXRhKSB7XG4gICAgZWwuZGF0YXNldC5kYXRhID0gcHJvcHMuZGF0YTtcbiAgfVxuICBpZiAocHJvcHMucGxhY2Vob2xkZXIpIHtcbiAgICBlbC5wbGFjZWhvbGRlciA9IHByb3BzLnBsYWNlaG9sZGVyO1xuICB9XG4gIGlmIChwcm9wcy5tYXhsZW5ndGgpIHtcbiAgICBlbC5tYXhMZW5ndGggPSBwcm9wcy5tYXhsZW5ndGg7XG4gIH1cbiAgaWYgKHByb3BzLmhyZWYpIHtcbiAgICBlbC5ocmVmID0gcHJvcHMuaHJlZjtcbiAgfVxuXG4gIHJldHVybiBlbDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0KGlkKSB7XG4gIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG59XG5cbmZ1bmN0aW9uIGhpZGUoZWwpIHtcbiAgZWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xufVxuXG5mdW5jdGlvbiBzaG93KGVsKSB7XG4gIGVsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZShlbCkge1xuICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTtcbn1cblxuZnVuY3Rpb24gZW1wdHkoZWwpIHtcbiAgd2hpbGUgKGVsLmZpcnN0Q2hpbGQpIHtcbiAgICBlbC5yZW1vdmVDaGlsZChlbC5maXJzdENoaWxkKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhcHBlbmQocGFyZW50LCBjaGlsZCkge1xuICBwYXJlbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xufVxuXG5mdW5jdGlvbiBhZGRfY2xhc3MoZWwsIGNsYXNzX25hbWUpIHtcbiAgdmFyIHNwbGl0ID0gZWwuY2xhc3NOYW1lLnNwbGl0KFwiIFwiKTtcbiAgaWYgKCFzcGxpdC5pbmNsdWRlcyhjbGFzc19uYW1lKSkge1xuICAgIHNwbGl0LnB1c2goY2xhc3NfbmFtZSk7XG4gIH1cbiAgZWwuY2xhc3NOYW1lID0gc3BsaXQuam9pbihcIiBcIik7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZV9jbGFzcyhlbCwgY2xhc3NfbmFtZSkge1xuICB2YXIgc3BsaXQgPSBlbC5jbGFzc05hbWUuc3BsaXQoXCIgXCIpLFxuICAgIGkgPSBzcGxpdC5pbmRleE9mKGNsYXNzX25hbWUpO1xuICBpZiAoaSAhPSAtMSkge1xuICAgIHNwbGl0LnNwbGljZShpLCAxKTtcbiAgfVxuICBlbC5jbGFzc05hbWUgPSBzcGxpdC5qb2luKFwiIFwiKTtcbn1cblxuZnVuY3Rpb24gZGlzcGxheV90aW1lKGZyYW1lcykge1xuICB2YXIgc2VjcyA9IGZsb29yKGZyYW1lcyAvIDMwKTtcbiAgdmFyIG1pbnV0ZXMgPSBmbG9vcihzZWNzIC8gNjApO1xuICB2YXIgc2Vjb25kcyA9IChzZWNzIC0gbWludXRlcyAqIDYwKS50b1N0cmluZygpO1xuICBzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPCAyID8gXCIwXCIgKyBzZWNvbmRzIDogc2Vjb25kcztcbiAgcmV0dXJuIG1pbnV0ZXMgKyBcIjpcIiArIHNlY29uZHM7XG59XG5cbmZ1bmN0aW9uIGRlYnVnKHMxLCBzMiwgczMsIHM0LCBzNSwgczYsIHM3LCBzOCwgczksIGJyKSB7XG4gIHZhciBlID0gc2VsZWN0KFwiZGVidWdcIik7XG4gIGlmIChicikge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiPGJyPlwiO1xuICB9IGVsc2Uge1xuICAgIGUuaW5uZXJIVE1MID0gXCJcIjtcbiAgfVxuICBpZiAoczEgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gczE7XG4gIH1cbiAgaWYgKHMyICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzMjtcbiAgfVxuICBpZiAoczMgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHMzO1xuICB9XG4gIGlmIChzNCAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczQ7XG4gIH1cbiAgaWYgKHM1ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzNTtcbiAgfVxuICBpZiAoczYgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM2O1xuICB9XG4gIGlmIChzNyAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczc7XG4gIH1cbiAgaWYgKHM4ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzODtcbiAgfVxuICBpZiAoczkgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM5O1xuICB9XG59XG5cbmZ1bmN0aW9uIGRlYnVnYnIoczEsIHMyLCBzMywgczQsIHM1LCBzNiwgczcsIHM4LCBzOSkge1xuICBkZWJ1ZyhzMSwgczIsIHMzLCBzNCwgczUsIHM2LCBzNywgczgsIHM5LCB0cnVlKTtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRJbnB1dFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIGlucHV0KGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuXG4gIC8vIGRlZmF1bHQgYWN0aW9uIGtleXNcbiAgdGhpcy5hY3Rpb25fa2V5cyA9IHtcbiAgICBtb3ZlOiBbXCIwXCJdLCAvLyBjbGlja1xuICAgIHNob290OiBbXCIyXCIsIFtcIjBcIiwgXCIxN1wiXSwgW1wiMFwiLCBcIjE4XCJdLCBbXCIwXCIsIFwiOTFcIl1dLCAvLyBjbGljaywgY3RybCwgYWx0LCBjbWRcbiAgICBqdW1wOiBbXCIzMlwiXSwgLy8gc3BhY2VcbiAgICBzd2l0Y2hfd2F0Y2hlcl9jYW1lcmE6IFtcIjgwXCJdLCAvLyBwXG4gICAgZm9sbG93X3dlYXBvbjogW1wiNzBcIl0sIC8vIGZcbiAgICBmb2xsb3dfbW91c2U6IFtcIjFcIl0sIC8vIG1pZGRsZSBjbGlja1xuICAgIC8vIG1vdmVfbGVmdDogW1wiMzdcIiwgXCI2NVwiXSwgLy8gbGVmdCwgYVxuICAgIC8vIG1vdmVfdXA6IFtcIjM4XCIsIFwiODdcIl0sIC8vIHVwLCB3XG4gICAgLy8gbW92ZV9yaWdodDogW1wiMzlcIiwgXCI2OFwiXSwgLy8gcmlnaHQsIGRcbiAgICAvLyBtb3ZlX2Rvd246IFtcIjQwXCIsIFwiODNcIl0sIC8vIGRvd24sIHNcbiAgICBzaG93X3NldHRpbmdzOiBbXCIyN1wiLCBcIjEzXCJdLCAvLyBlc2MsIGVudGVyXG4gICAgd2VhcG9uX3NlbGVjdF8xOiBbXCI0OVwiXSwgLy8gMVxuICAgIHdlYXBvbl9zZWxlY3RfMjogW1wiNTBcIl0sIC8vIDJcbiAgICB3ZWFwb25fc2VsZWN0XzM6IFtcIjUxXCJdLCAvLyAzXG4gICAgd2VhcG9uX3NlbGVjdF80OiBbXCI1MlwiXSwgLy8gNFxuICAgIHdlYXBvbl9zZWxlY3RfNTogW1wiNTNcIl0sIC8vIDVcbiAgICB3ZWFwb25fc2VsZWN0XzY6IFtcIjU0XCJdLCAvLyA2XG4gICAgd2VhcG9uX3NlbGVjdF83OiBbXCI1NVwiXSwgLy8gN1xuICAgIHdlYXBvbl9zZWxlY3RfODogW1wiNTZcIl0sIC8vIDhcbiAgICB3ZWFwb25fc2VsZWN0Xzk6IFtcIjU3XCJdIC8vIDlcbiAgfTtcblxuICAvLyBzZXQgdXAgcmVmZXJlbmNlIGZvciBwcmVzc2VkIGtleSBjb2Rlc1xuICB0aGlzLmtleV9jb2RlcyA9IHt9O1xuXG4gIC8vIGN1cnNvclxuICB0aGlzLmN1cnNvcl9tb3ZlZCA9IGZhbHNlO1xuICB0aGlzLmN1cnNvciA9IHsgeDogMCwgeTogMCB9O1xuXG4gIC8vIHNldCBjdXJzb3IgcG9pbnRzXG4gIGRvY3VtZW50LmJvZHkub25tb3VzZW1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmlkID09PSBcImdhbWVfaW5wdXRcIikge1xuICAgICAgc2VsZi5pbnB1dF9jdXJzb3IoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgIH1cbiAgfTtcblxuICAvLyBwcmV2ZW50IGRlZmF1bHQgcmlnaHQgY2xpY2sgYmVoYXZpb3VyXG4gIGRvY3VtZW50LmJvZHkub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIC8vIG1hbmFnZSBjbGljayBldmVudHNcbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwiZ2FtZV9pbnB1dFwiKSB7XG4gICAgICBzZWxmLmlucHV0X2J1dHRvbihlLmJ1dHRvbiwgXCJkb3duXCIpO1xuICAgIH1cbiAgICBpZiAoZS5idXR0b24gPT0gMSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNldXAgPSBmdW5jdGlvbihlKSB7XG4gICAgc2VsZi5pbnB1dF9idXR0b24oZS5idXR0b24sIFwidXBcIik7XG4gIH07XG5cbiAgLy8gbW91c2Ugd2hlZWxcbiAgaWYgKFwib25tb3VzZXdoZWVsXCIgaW4gZG9jdW1lbnQuYm9keSkge1xuICAgIGRvY3VtZW50LmJvZHkub25tb3VzZXdoZWVsID0gZnVuY3Rpb24oZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCA/IGUucHJldmVudERlZmF1bHQoKSA6IChlLnJldHVyblZhbHVlID0gZmFsc2UpO1xuICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICAgICAgc2VsZi5zY3JvbGxfd2hlZWwoZSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Nb3VzZVNjcm9sbFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBzZWxmLnNjcm9sbF93aGVlbChlKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIG1hbmFnZSBrZXlib2FyZCBldmVudHNcbiAgZG9jdW1lbnQuYm9keS5vbmtleWRvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgc2VsZi5pbnB1dF9idXR0b24oZS5rZXlDb2RlLCBcImRvd25cIik7XG4gIH07XG4gIGRvY3VtZW50LmJvZHkub25rZXl1cCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmlucHV0X2J1dHRvbihlLmtleUNvZGUsIFwidXBcIik7XG4gIH07XG5cbiAgLy8gdHVybiBvZmYgaW5wdXQgd2hlbiB3aW5kb3cgaXMgbm90IGZvY3VzZWRcbiAgd2luZG93Lm9uYmx1ciA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuaW5wdXRfcmVzZXQoKTtcbiAgfTtcbn1cblxuLyogSXMgYW4gYWN0aW9uIGFjdGl2ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5hY3RpdmUgPSBmdW5jdGlvbih0eXBlKSB7XG4gIGNvbnN0IGFjdGlvbiA9IHRoaXMuYWN0aW9uX2tleXNbdHlwZV07XG4gIGlmICghYWN0aW9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYWN0aW9uLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY29kZXMgPSBhY3Rpb25baV07XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZXMpKSB7XG4gICAgICBsZXQgdHJpZ2dlciA9IHRydWU7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgY29kZXMubGVuZ3RoOyBpMisrKSB7XG4gICAgICAgIGNvbnN0IGNvZGUgPSBjb2Rlc1tpMl07XG4gICAgICAgIGlmICghdGhpcy5rZXlfY29kZXNbY29kZV0pIHtcbiAgICAgICAgICB0cmlnZ2VyID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0cmlnZ2VyKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5rZXlfY29kZXNbY29kZXNdKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyogRmluZCB0aGUgYWN0aW9uIG9mIGEgY29kZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5maW5kX2FjdGlvbiA9IGZ1bmN0aW9uKGNvZGUpIHtcbiAgY29uc3QgYWN0aW9ucyA9IFtdO1xuICBmb3IgKGxldCBrZXkgaW4gdGhpcy5hY3Rpb25fa2V5cykge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hY3Rpb25fa2V5c1trZXldLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjb2RlcyA9IHRoaXMuYWN0aW9uX2tleXNba2V5XVtpXTtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShjb2RlcykgJiYgU3RyaW5nKGNvZGVzKSA9PT0gU3RyaW5nKGNvZGUpKSB7XG4gICAgICAgIGNvbnN0IG9iaiA9IHsgdHlwZToga2V5IH07XG4gICAgICAgIC8vIGlmIChrZXkgPT0gXCJzaG93X3NldHRpbmdzXCIpIHtcbiAgICAgICAgLy8gICBpZiAodGhpcy5hY3Rpb25zLnNob290KSB7XG4gICAgICAgIC8vICAgICByZXR1cm4gW107XG4gICAgICAgIC8vICAgfVxuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gcGxlYXNlIGRvbid0IHRlbGwgYW55Ym9keSBJIGRpZCB0aGlzXG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzFcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzJcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzNcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSAyO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzRcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSAzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzVcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSA0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzZcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSA1O1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzdcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSA2O1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzhcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSA3O1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT0gXCJ3ZWFwb25fc2VsZWN0XzlcIikge1xuICAgICAgICAgIG9iai50eXBlID0gXCJ3ZWFwb25fc2VsZWN0XCI7XG4gICAgICAgICAgb2JqLm4gPSA4O1xuICAgICAgICB9XG4gICAgICAgIGFjdGlvbnMucHVzaChvYmopO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYWN0aW9ucztcbn07XG5cbi8qIFByb2Nlc3MgaW5wdXQgZXZlbnRzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmlucHV0X2J1dHRvbiA9IGZ1bmN0aW9uKGNvZGUsIHR5cGUpIHtcbiAgLy8gaWdub3JlIGlucHV0IG9uIGEgdGV4dCBib3hcbiAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAodHlwZSA9PSBcInVwXCIpIHtcbiAgICB0aGlzLmtleV9jb2Rlc1tjb2RlXSA9IGZhbHNlO1xuICB9XG4gIGlmICh0eXBlID09IFwiZG93blwiKSB7XG4gICAgdGhpcy5rZXlfY29kZXNbY29kZV0gPSB0cnVlO1xuICAgIGNvbnN0IGFjdGlvbnMgPSB0aGlzLmZpbmRfYWN0aW9uKGNvZGUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5jYWxsYmFjayhhY3Rpb25zW2ldKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIEN1cnNvciBtb3ZlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuaW5wdXRfY3Vyc29yID0gZnVuY3Rpb24oeCwgeSkge1xuICB0aGlzLmN1cnNvcl9tb3ZlZCA9IHRydWU7XG4gIHRoaXMuY3Vyc29yLnggPSB4O1xuICB0aGlzLmN1cnNvci55ID0geTtcbn07XG5cbi8qIFNjcm9sbCB3aGVlbFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLnNjcm9sbF93aGVlbCA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gbm9ybWFsaXplIGRlbHRhIGZvciBjcm9zcyBicm93c2VyXG4gIHZhciBkID0gZS5kZXRhaWwsXG4gICAgdyA9IGUud2hlZWxEZWx0YSxcbiAgICBkID0gZCA/ICh3ICYmIChmID0gdyAvIGQpID8gZCAvIGYgOiAtZCAvIDEuMzUpIDogdyAvIDEyMDtcblxuICAvLyB1cCBvciBkb3duXG4gIHZhciBkb3duID0gZCA8IDAgPyB0cnVlIDogZmFsc2U7XG5cbiAgLy8gZXZlbnRcbiAgdGhpcy5jYWxsYmFjayh7IHR5cGU6IFwid2VhcG9uX3Njcm9sbFwiLCBkb3duOiBkb3duIH0pO1xufTtcblxuLyogUmVzZXQgYWN0aW9uc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmlucHV0X3Jlc2V0ID0gZnVuY3Rpb24oKSB7XG4gIGZvciAoa2V5IGluIHRoaXMua2V5X2NvZGVzKSB7XG4gICAgdGhpcy5rZXlfY29kZXNba2V5XSA9IGZhbHNlO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdEFzc2V0IExvYWRlclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIGxvYWRlcihhc3NldHNfdXJsLCBhc3NldHMsIG9ubG9hZCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgLy8gc2V0IHVwIGxvYWRpbmcgdmFsdWVzXG4gIHRoaXMub25sb2FkID0gb25sb2FkO1xuICB0aGlzLm91dHB1dCA9IHt9O1xuICB0aGlzLmxvYWRlZCA9IDA7XG4gIHRoaXMuY291bnQgPSAwO1xuICBmb3IgKHZhciB0eXBlIGluIGFzc2V0cykge1xuICAgIHRoaXMuY291bnQgKz0gT2JqZWN0LmtleXMoYXNzZXRzW3R5cGVdKS5sZW5ndGg7XG4gICAgdGhpcy5vdXRwdXRbdHlwZV0gPSB7fTtcbiAgfVxuXG4gIC8vIHNldCB1cCBhdWRpb1xuICBpZiAoYXNzZXRzLmF1ZGlvKSB7XG4gICAgaWYgKE9iamVjdC5rZXlzKGFzc2V0cy5hdWRpbykubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5hdWRpb19jb250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGRvIHRoZSBsb2FkaW5nXG4gIGZvciAodmFyIHR5cGUgaW4gYXNzZXRzKSB7XG4gICAgZm9yICh2YXIga2V5IGluIGFzc2V0c1t0eXBlXSkge1xuICAgICAgdmFyIHVybCA9IGFzc2V0c191cmwgKyBhc3NldHNbdHlwZV1ba2V5XTtcbiAgICAgIGlmICh0eXBlID09IFwianNvblwiKSB7XG4gICAgICAgIHRoaXMuanNvbih1cmwsIHR5cGUsIGtleSk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PSBcImltZ1wiKSB7XG4gICAgICAgIHRoaXMuaW1hZ2UodXJsLCB0eXBlLCBrZXkpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT0gXCJhdWRpb1wiKSB7XG4gICAgICAgIHRoaXMuYXVkaW8odXJsLCB0eXBlLCBrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKiBMb2FkIEpTT05cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5sb2FkZXIucHJvdG90eXBlLmpzb24gPSBmdW5jdGlvbih1cmwsIHR5cGUsIGtleSkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgcmVxdWVzdC5vdmVycmlkZU1pbWVUeXBlKFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgcmVxdWVzdC5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG4gIHJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSA9PSA0ICYmIHJlcXVlc3Quc3RhdHVzID09IFwiMjAwXCIpIHtcbiAgICAgIHZhciByZXNwb25zZSA9IEpTT04ucGFyc2UocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgc2VsZi5vdXRwdXRbdHlwZV1ba2V5XSA9IHJlc3BvbnNlO1xuICAgICAgc2VsZi5jaGVja19sb2FkZWQoKTtcbiAgICB9XG4gIH07XG4gIHJlcXVlc3Quc2VuZChudWxsKTtcbn07XG5cbi8qIExvYWQgSW1hZ2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5sb2FkZXIucHJvdG90eXBlLmltYWdlID0gZnVuY3Rpb24odXJsLCB0eXBlLCBrZXkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIHRoaXMub3V0cHV0W3R5cGVdW2tleV0gPSBuZXcgSW1hZ2UoKTtcbiAgdGhpcy5vdXRwdXRbdHlwZV1ba2V5XS5zcmMgPSB1cmw7XG5cbiAgLy8gd2hlbiBpbWFnZSBpcyBsb2FkZWRcbiAgdGhpcy5vdXRwdXRbdHlwZV1ba2V5XS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICBzZWxmLmNoZWNrX2xvYWRlZCgpO1xuICB9O1xufTtcblxuLyogTG9hZCBBdWRpb1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmxvYWRlci5wcm90b3R5cGUuYXVkaW8gPSBmdW5jdGlvbih1cmwsIHR5cGUsIGtleSkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgcmVxdWVzdC5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG4gIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gXCJhcnJheWJ1ZmZlclwiO1xuICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuYXVkaW9fY29udGV4dC5kZWNvZGVBdWRpb0RhdGEocmVxdWVzdC5yZXNwb25zZSwgZnVuY3Rpb24oYnVmZmVyKSB7XG4gICAgICBpZiAoYnVmZmVyKSB7XG4gICAgICAgIHZhciBmaWxlID0gc2VsZi5hdWRpb19jb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICBmaWxlLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICAgICAgZmlsZS5jb25uZWN0KHNlbGYuYXVkaW9fY29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgICAgdmFyIGdhaW4gPSBzZWxmLmF1ZGlvX2NvbnRleHQuY3JlYXRlR2FpbigpO1xuICAgICAgICBmaWxlLmNvbm5lY3QoZ2Fpbik7XG4gICAgICAgIGdhaW4uY29ubmVjdChzZWxmLmF1ZGlvX2NvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgIGZpbGUubG9vcCA9IHRydWU7XG5cbiAgICAgICAgLy8gZ2Fpbi5nYWluLnZhbHVlID0gMTtcbiAgICAgICAgLy8gZmlsZS5zdGFydCgwKTtcblxuICAgICAgICAvLyB0aGlzLmZpbGVzW2tleV0gPSB0aGlzLmNvbnQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XS5idWZmZXIgPSBmaWxlc1trZXldO1xuICAgICAgICAvLyB0aGlzLmZpbGVzW2tleV0uY29ubmVjdCh0aGlzLmNvbnQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgIC8vIC8vIHNldCB1cCBnYWluIG5vZGVcbiAgICAgICAgLy8gdGhpcy5nYWluW2tleV0gPSB0aGlzLmNvbnQuY3JlYXRlR2FpbigpO1xuICAgICAgICAvLyB0aGlzLmZpbGVzW2tleV0uY29ubmVjdCh0aGlzLmdhaW5ba2V5XSk7XG4gICAgICAgIC8vIHRoaXMuZ2FpbltrZXldLmNvbm5lY3QodGhpcy5jb250LmRlc3RpbmF0aW9uKTtcblxuICAgICAgICBzZWxmLm91dHB1dC5hdWRpb1trZXldID0gYnVmZmVyO1xuICAgICAgICBzZWxmLmNoZWNrX2xvYWRlZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICByZXF1ZXN0LnNlbmQobnVsbCk7XG59O1xuXG4vKiBDaGVjayBBc3NldHMgQXJlIExvYWRlZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmxvYWRlci5wcm90b3R5cGUuY2hlY2tfbG9hZGVkID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMubG9hZGVkKys7XG5cbiAgLy8gaWYgd2UgYXJlIG5vdCByZWFkeSB5ZXRcbiAgaWYgKHRoaXMuY291bnQgPD0gdGhpcy5sb2FkZWQpIHtcbiAgICB0aGlzLm9ubG9hZCh0aGlzLm91dHB1dCk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBPbmJvYXJkaW5nXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gb25ib2FyZGluZygpIHtcbiAgdGhpcy5jb3VudCA9IDA7XG4gIHRoaXMuZG9uZSA9IGZhbHNlO1xuICB0aGlzLmFjdGlvbiA9IHtcbiAgICBtb3ZlOiBmYWxzZSxcbiAgICBqdW1wOiBmYWxzZSxcbiAgICBzaG9vdDogZmFsc2VcbiAgfTtcblxuICBpZiAodHlwZW9mIFN0b3JhZ2UgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB0aGlzLmNvdW50ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJwYW50c19vbmJvYXJkaW5nXCIpIHx8IDA7XG4gICAgdGhpcy5kb25lID0gdGhpcy5jb3VudCA+IDE7XG4gIH1cbn1cblxuLyogVHJpZ2dlciBvbmJvYXJkaW5nbmVzc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm9uYm9hcmRpbmcucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgaWYgKHRoaXMuZG9uZSkge1xuICAgIHJldHVybjtcbiAgfVxuICB0aGlzLmFjdGlvblt0eXBlXSA9IHRydWU7XG4gIGZvciAobGV0IGtleSBpbiB0aGlzLmFjdGlvbikge1xuICAgIGlmICghdGhpcy5hY3Rpb25ba2V5XSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICB0aGlzLmRvbmUgPSB0cnVlO1xuICBpZiAodHlwZW9mIFN0b3JhZ2UgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInBhbnRzX29uYm9hcmRpbmdcIiwgdGhpcy5jb3VudCArIDEpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgU29ja2V0IE1lc3NhZ2VzXG4gICAgaGFuZGxlIGNvbm5lY3Rpb24gYW5kIG1lc3NhZ2UgZGF0YSB0byBhbmQgZnJvbSB0aGUgc2VydmVyXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gU29ja2V0Q29ubmVjdGlvbihjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgLy8gc29ja2V0IGNvbm5lY3Rpb25cbiAgdGhpcy5pbyA9IGlvKERPTUFJTiArIFwiOlwiICsgUE9SVCk7XG4gIHRoaXMuaW8ub24oXCJtZXNzYWdlXCIsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICBzZWxmLm1lc3NhZ2VfcmVjZWl2ZShtZXNzYWdlKTtcbiAgfSk7XG4gIHRoaXMuaW8ub24oXCJkaXNjb25uZWN0XCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGxiYWNrKHsgdHlwZTogXCJ3YWl0X2Zvcl9jb25uZWN0aW9uXCIgfSk7XG4gIH0pO1xuXG4gIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcblxuICAvLyBpZHNcbiAgdGhpcy5tZXNzYWdlX3JlY2VpdmVfaWRzID0gW1xuICAgIFwiZnVsbFwiLFxuICAgIFwiY29ubmVjdGVkXCIsXG4gICAgXCJwbGF5ZXJfam9pblwiLFxuICAgIFwicGxheWVyX2xlYXZlXCIsXG4gICAgXCJnYW1lX3dhaXRcIixcbiAgICBcImdhbWVfc3RhcnRcIixcbiAgICBcImdhbWVfZW5kXCIsXG4gICAgXCJnYW1lX3N0YXRlXCIsXG4gICAgXCJwaW5nXCJcbiAgXTtcblxuICB0aGlzLm1lc3NhZ2Vfc2VuZF9pZHMgPSBbXG4gICAgXCJ3YXRjaGVyXCIsXG4gICAgXCJzZW5kX25hbWVcIixcbiAgICBcInBsYXllcl9pbnB1dFwiLFxuICAgIFwid2VhcG9uX3NlbGVjdGVkXCIsXG4gICAgXCJyZXNwYXduXCIsXG4gICAgXCJwaW5nXCJcbiAgXTtcblxuICAvLyBzdHJpbmcgc2VwYXJhdG9yXG4gIHRoaXMubWVzc2FnZV9zZXBhcmF0b3IgPSBcInxcIjtcbn1cblxuLyogU2VuZCBtZXNzYWdlcyB0byBzZXJ2ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5Tb2NrZXRDb25uZWN0aW9uLnByb3RvdHlwZS5tZXNzYWdlX3NlbmQgPSBmdW5jdGlvbih0eXBlLCBwcm9wcykge1xuICB2YXIgaSA9IHRoaXMubWVzc2FnZV9zZW5kX2lkcy5pbmRleE9mKHR5cGUpO1xuXG4gIC8vIGlmIG5vdCBhIHZhbGlkIG1lc3NhZ2VcbiAgaWYgKGkgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZW5kIG1lc3NhZ2VcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWVzc2FnZSA9IGkgKyB0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yICsgcHJvcHMuam9pbih0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yKTtcbiAgaWYgKHRoaXMubGFnKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuaW8uc2VuZChtZXNzYWdlKTtcbiAgICB9LCB0aGlzLmxhZyk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5pby5zZW5kKG1lc3NhZ2UpO1xuICB9XG59O1xuXG4vKiBSZWNlaXZlIG1lc3NhZ2VzIGZyb20gc2VydmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuU29ja2V0Q29ubmVjdGlvbi5wcm90b3R5cGUubWVzc2FnZV9yZWNlaXZlID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAvLyBnZXQgdHlwZSBvZiBtZXNzYWdlIGZyb20gaWRcbiAgdmFyIHNwbGl0ID0gbWVzc2FnZS5zcGxpdCh0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yKTtcbiAgdmFyIGlkID0gcGFyc2VJbnQoc3BsaXRbMF0pO1xuXG4gIC8vIGlmIG5vdCB2YWxpZCBpZFxuICBpZiAoIXRoaXMubWVzc2FnZV9yZWNlaXZlX2lkc1tpZF0pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHR5cGUgPSB0aGlzLm1lc3NhZ2VfcmVjZWl2ZV9pZHNbaWRdO1xuICB2YXIgZXZlbnQgPSB7IHR5cGU6IHR5cGUgfTtcblxuICAvLyBwcmVwYXJlIGluZm9ybWF0aW9uIGZvciBldmVudCBoYW5kbGVyXG4gIGlmICh0eXBlID09PSBcImZ1bGxcIikge1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiY29ubmVjdGVkXCIpIHtcbiAgICBldmVudC5wbGF5ZXJfaWQgPSBzcGxpdFsxXSA9PT0gXCJudWxsXCIgPyBudWxsIDogcGFyc2VJbnQoc3BsaXRbMV0pO1xuICAgIGV2ZW50Lm5hbWUgPSBzcGxpdFsyXTtcbiAgICBldmVudC5wbGF5ZXJzID0gc3BsaXRbM107XG4gICAgZXZlbnQuc2NoZW1lID0gc3BsaXRbNF07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJwbGF5ZXJfam9pblwiKSB7XG4gICAgZXZlbnQudXNlcl9pZCA9IHNwbGl0WzFdO1xuICAgIGV2ZW50Lm5hbWUgPSBzcGxpdFsyXTtcbiAgICBldmVudC5wbGF5ZXJfaWQgPSBwYXJzZUludChzcGxpdFszXSk7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJwbGF5ZXJfbGVhdmVcIikge1xuICAgIGV2ZW50LnVzZXJfaWQgPSBzcGxpdFsxXTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImdhbWVfd2FpdFwiKSB7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX3N0YXJ0XCIpIHtcbiAgICBldmVudC5yZXNldF9wbGF5ZXJzID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICAgIGV2ZW50LmJnX3N0ciA9IHNwbGl0WzJdO1xuICAgIGV2ZW50LmZnX3N0ciA9IHNwbGl0WzNdO1xuICAgIGV2ZW50LmdyYXZpdHlfbWFwID0gc3BsaXRbNF07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX2VuZFwiKSB7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX3N0YXRlXCIpIHtcbiAgICBldmVudC5mcmFtZXMgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gICAgZXZlbnQuc3RhdGUgPSBzcGxpdFsyXTtcbiAgICBldmVudC5yZXNwb25zZXMgPSBzcGxpdFszXTtcbiAgICBldmVudC5kYW1hZ2VzID0gc3BsaXRbNF07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJwaW5nXCIpIHtcbiAgICBldmVudC5mcmFtZSA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgfVxuXG4gIC8vIHJ1biBldmVudFxuICB0aGlzLmNhbGxiYWNrKGV2ZW50KTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWx0aXBsYXllclxuICAgIFBsYXllciBEZWF0aHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDaGVjayBpZiB3ZSdyZSBkZWFkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWVfZGVhZCA9IGZ1bmN0aW9uKCkge1xuICAvLyBub3QgcmVhZHkgZm9yIGFueSBkZWF0aCBzdHVmZlxuICBpZiAoIXRoaXMuZ2FtZSB8fCAhdGhpcy5nYW1lLmNvcmUgfHwgIXRoaXMuZ2FtZS5wbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb3VudCB1cCB0byBkZWFkbmVzc1xuICBpZiAodGhpcy5nYW1lLnBsYXllci5kZWFkKSB7XG4gICAgaWYgKCF0aGlzLmRlYWQpIHtcbiAgICAgIGlmICh0aGlzLndhaXRfZm9yX2RlYWQgPCA0OCkge1xuICAgICAgICB0aGlzLndhaXRfZm9yX2RlYWQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGVhdGgoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhpcy53YWl0X2Zvcl9kZWFkID0gMDtcbiAgICBpZiAodGhpcy5kZWFkKSB7XG4gICAgICB0aGlzLnJlc3Bhd24oKTtcbiAgICB9XG4gIH1cblxuICAvLyBkZWFkbmVzc1xuICBpZiAodGhpcy5kZWFkKSB7XG4gICAgaWYgKHRoaXMud2FpdF9mb3JfcmVzcGF3biA+IDApIHtcbiAgICAgIHRoaXMud2FpdF9mb3JfcmVzcGF3bi0tO1xuICAgICAgaWYgKHRoaXMud2FpdF9mb3JfcmVzcGF3biA9PT0gMCkge1xuICAgICAgICB0aGlzLmRpdl9kZWFkX2NvdW50ZG93bi5pbm5lckhUTUwgPSBcIkNsaWNrIHRvIHJlc3Bhd25cIjtcbiAgICAgICAgcmVtb3ZlX2NsYXNzKHRoaXMuYnV0dG9uX3Jlc3Bhd24sIFwiZGlzYWJsZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRpdl9kZWFkX2NvdW50ZG93bi5pbm5lckhUTUwgPVxuICAgICAgICAgIFwiUmVzcGF3biBpbiBcIiArIGNlaWwodGhpcy53YWl0X2Zvcl9yZXNwYXduIC8gMjQpICsgXCIgc2Vjb25kc1wiO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyogV2UgaGF2ZSBkaWVkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZGVhdGggPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5kZWFkID0gdHJ1ZTtcbiAgdGhpcy53YWl0X2Zvcl9kZWFkID0gMDtcbiAgdGhpcy53YWl0X2Zvcl9yZXNwYXduID0gOTY7XG5cbiAgaGlkZSh0aGlzLmRpdl9kZWFkX3RleHQpO1xuICBhZGRfY2xhc3ModGhpcy5idXR0b25fcmVzcGF3biwgXCJkaXNhYmxlZFwiKTtcbiAgc2hvdyh0aGlzLmRpdl9kZWFkKTtcbn07XG5cbi8qIFJlc3Bhd24gdHJpZ2dlcmVkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzcGF3biA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRlYWQgPSBmYWxzZTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWx0aXBsYXllclxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ydW5fZXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaGFuZGxlIGFycmF5cyBvZiBldmVudHNcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoZXZlbnRbaV0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBydW4gZXZlbnRzXG4gIGlmIChldmVudC50eXBlID09PSBcImZ1bGxcIikge1xuICAgIHRoaXMuZ2FtZV9mdWxsKCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJjb25uZWN0ZWRcIikge1xuICAgIHRoaXMuY29ubmVjdGVkKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcIndhaXRfZm9yX2Nvbm5lY3Rpb25cIikge1xuICAgIHRoaXMud2FpdF9mb3JfY29ubmVjdGlvbigpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2pvaW5cIikge1xuICAgIHRoaXMucGxheWVyX2pvaW4oZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2xlYXZlXCIpIHtcbiAgICB0aGlzLnBsYXllcl9sZWF2ZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJnYW1lX3dhaXRcIikge1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2FtZV9zdGFydFwiKSB7XG4gICAgdGhpcy5nYW1lX3N0YXJ0KGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdhbWVfZW5kXCIpIHtcbiAgICB0aGlzLmdhbWVfZW5kKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdhbWVfc3RhdGVcIikge1xuICAgIHRoaXMuZ2FtZV9zdGF0ZV9yZWNlaXZlZChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJjb2xsZWN0XCIpIHtcbiAgICB0aGlzLmV2ZW50X2NvbGxlY3QoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ3JvdW5kX2RhbWFnZVwiKSB7XG4gICAgdGhpcy5ldmVudF9ncm91bmRfZGFtYWdlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9kZWF0aFwiKSB7XG4gICAgdGhpcy5ldmVudF9wbGF5ZXJfZGVhdGgoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwid2VhcG9uX3NlbGVjdGVkXCIpIHtcbiAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwid2VhcG9uX3NlbGVjdGVkXCIsIFtldmVudC53ZWFwb25dKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBpbmdcIikge1xuICAgIHRoaXMuZXZlbnRfcGluZyhldmVudCk7XG4gIH1cblxuICAvLyBzZW5kIGV2ZW50IGRvd24gYSBsZXZlbFxuICBlbHNlIGlmICh0aGlzLmdhbWUpIHtcbiAgICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcbiAgfVxufTtcblxuLyogQ29sbGVjdGVkIGl0ZW1cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ldmVudF9jb2xsZWN0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKHRoaXMuaW5pdGlhbGlzZWQpIHtcbiAgICAvLyB3YWl0IHRvIHJlY3JlYXRlXG4gICAgdGhpcy53YWl0X3RvX2NyZWF0ZVtldmVudC5vYmpdID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUuZnJhbWU7XG5cbiAgICAvLyBydW4gY2xpZW50IGNvbGxlY3Rpb24gZXZlbnRzXG4gICAgdGhpcy5nYW1lLnJ1bl9ldmVudChldmVudCk7XG5cbiAgICAvLyBydW4gcGxheWVycyBpbnRlcmZhY2VcbiAgICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG4gIH1cbn07XG5cbi8qIFBsYXllciBkZWF0aFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmV2ZW50X3BsYXllcl9kZWF0aCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIG9ubHkgdXNlIHNlcnZlciBldmVudHNcbiAgaWYgKCFldmVudC5mcm9tX3NlcnZlcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJ1biBpdFxuICBpZiAodGhpcy5pbml0aWFsaXNlZCkge1xuICAgIHRoaXMucGxheWVyX2RlYXRoKGV2ZW50KTtcbiAgfVxufTtcblxuLyogUGluZ1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmV2ZW50X3BpbmcgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBkaWQgd2UgcmVxdWVzdCB0aGlzXG4gIGlmICghdGhpcy5waW5nc1tldmVudC5mcmFtZV0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgLy8gcmVjb3JkIGVuZCB0aW1lIGZvciBwaW5nXG4gIHRoaXMucGluZ3NbZXZlbnQuZnJhbWVdLmVuZCA9IG5vdztcblxuICAvLyBnbyB0aHJvdWdoIGFsbCBwaW5nc1xuICB2YXIgcGluZ19jb3VudCA9IDA7XG4gIHZhciBwaW5nX3RvdGFsID0gMDtcbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5waW5ncykge1xuICAgIHZhciBwaW5nID0gdGhpcy5waW5nc1tmcmFtZV07XG5cbiAgICAvLyByZW1vdmUgb2xkIG9uZXNcbiAgICBpZiAocGluZy5lbmQgJiYgcGluZy5lbmQgKyAxMDAwMCA8IG5vdykge1xuICAgICAgZGVsZXRlIHRoaXMucGluZ3NbZnJhbWVdO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gY2FsY3VsYXRlIGF2ZXJhZ2VcbiAgICBwaW5nX3RvdGFsICs9IHBpbmcuZW5kIC0gcGluZy5zdGFydDtcbiAgICBwaW5nX2NvdW50Kys7XG4gIH1cblxuICAvLyBzaG93IHBpbmdcbiAgdGhpcy5kaXZfcGluZy5pbm5lckhUTUwgPSByb3VuZChwaW5nX3RvdGFsIC8gcGluZ19jb3VudCk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTXVsaXRwbGF5ZXJcbiAgICBGcmFtZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTdGFydC9zdG9wIGxvb3BcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5sb29wX3N0YXJ0ID0gZnVuY3Rpb24oc3RhcnRfZnJhbWUpIHtcbiAgLy8gY2xvc2UgYW55IG9wZW4gbG9vcHNcbiAgdGhpcy5sb29wX3N0b3AoKTtcblxuICAvLyBzZXQgbG9vcCB2YXJzXG4gIHRoaXMuc3RhcnRfZnJhbWUgPSBzdGFydF9mcmFtZSB8fCAwO1xuICB0aGlzLmZyYW1lcyA9IHRoaXMuc3RhcnRfZnJhbWU7XG4gIHRoaXMuc3RhcnRfdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgIHNlbGYucnVuX3RpY2soKTtcbiAgfSwgMTApO1xufTtcblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmxvb3Bfc3RvcCA9IGZ1bmN0aW9uKCkge1xuICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xufTtcblxuLyogUnVuIHRpY2tcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ydW5fdGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyBjYWxjdWxhdGUgbnVtYmVyIG9mIGZyYW1lcyBzaW5jZSBnYW1lIHN0YXJ0XG4gIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgdmFyIGZyYW1lcyA9XG4gICAgdGhpcy5zdGFydF9mcmFtZSArIE1hdGguZmxvb3IoKG5vdyAtIHRoaXMuc3RhcnRfdGltZSkgLyB0aGlzLm1zX2xvb3ApO1xuXG4gIC8vIGdldCBudW1iZXIgb2YgcmVtYWluaW5nIHN0ZXBzXG4gIHZhciBmcmFtZV9kaWZmZXJlbmNlID0gZnJhbWVzIC0gdGhpcy5mcmFtZXM7XG5cbiAgLy8gd2FpdGluZ1xuICBpZiAoZnJhbWVfZGlmZmVyZW5jZSA8IDEpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB0b28gbXVjaCBsYWdcbiAgaWYgKGZyYW1lX2RpZmZlcmVuY2UgPiAxMCkge1xuICAgIHRoaXMubG9vcF9zdGFydCgpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwidGljayBsYWcgfCBcIiArIGZyYW1lX2RpZmZlcmVuY2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZnJhbWVzIHRvIHByb2Nlc3NcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBmcmFtZV9kaWZmZXJlbmNlOyBpKyspIHtcbiAgICB0aGlzLmZyYW1lKCk7XG4gIH1cblxuICAvLyBydW4gZGlzcGxheSBsb29wXG4gIHRoaXMuZ2FtZS5mcmFtZV9kaXNwbGF5KCk7XG5cbiAgLy8gcmVjb3JkIHRpbWUgdGhpcyB3YXMgZG9uZVxuICB0aGlzLmZwc2VzLnB1c2gobmV3IERhdGUoKS5nZXRUaW1lKCkpO1xuICBpZiAodGhpcy5mcHNlcy5sZW5ndGggPiA3Mikge1xuICAgIHRoaXMuZGl2X2Zwcy5pbm5lckhUTUwgPSByb3VuZChcbiAgICAgICgzMDAwIC8gKHRoaXMuZnBzZXNbNzJdIC0gdGhpcy5mcHNlc1swXSkpICogdGhpcy5mcHNcbiAgICApO1xuICAgIHRoaXMuZnBzZXMuc3BsaWNlKDAsIDEpO1xuICB9XG59O1xuXG4vKiBGcmFtZSBwcm9jZXNzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWUgPSBmdW5jdGlvbigpIHtcbiAgLy8gaW5jcmVtZW50IGZyYW1lIGNvdW50XG4gIHRoaXMuZnJhbWVzKys7XG5cbiAgLy8gc3RvcmUgaW5wdXRcbiAgaWYgKHRoaXMuZ2FtZS5wbGF5ZXIpIHtcbiAgICB2YXIgYWN0aW9uID0gdGhpcy5nYW1lLmdldF9pbnB1dCgpO1xuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgIHRoaXMuc3RvcmVfaW5wdXRbdGhpcy5mcmFtZXNdID0gYWN0aW9uO1xuICAgICAgdGhpcy5zZW5kX2lucHV0KGFjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIGZyYW1lXG4gIHRoaXMuZnJhbWVfcnVuKHRoaXMuZnJhbWVzKTtcblxuICAvLyByZW1vdmUgb2xkIHN0YXRlc1xuICB0aGlzLnJlbW92ZV9vbGRfc3RhdGVzKCk7XG5cbiAgLy8gcnVuIGdyb3VuZCBkYW1hZ2UgY2hlY2tzXG4gIHRoaXMuZnJhbWVfZ3JvdW5kKCk7XG5cbiAgLy8gcnVuIGRlYXRoIGZyYW1lc1xuICB0aGlzLmZyYW1lX2RlYWQoKTtcblxuICAvLyBydW4gcGxheWVycyBpbnRlcmZhY2VcbiAgaWYgKHRoaXMuZnJhbWVzICUgNDggPT09IDApIHtcbiAgICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG4gIH1cblxuICAvLyBydW4gcGluZ1xuICBpZiAodGhpcy5mcmFtZXMgJSAxMiA9PT0gMCkge1xuICAgIHRoaXMuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJwaW5nXCIsIFt0aGlzLmZyYW1lc10pO1xuICAgIHRoaXMucGluZ3NbdGhpcy5mcmFtZXNdID0geyBzdGFydDogbmV3IERhdGUoKS5nZXRUaW1lKCkgfTtcbiAgfVxufTtcblxuLyogRnJhbWUgcnVuXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWVfcnVuID0gZnVuY3Rpb24oZnJhbWUpIHtcbiAgLy8gcnVuIGNvcmUgYW5kIHN0b3JlIHJlc3BvbnNlXG4gIHZhciByZXNwb25zZSA9IHRoaXMuZ2FtZS5mcmFtZV9jb3JlKGZyYW1lLCB0aGlzLnN0b3JlX2lucHV0W2ZyYW1lXSk7XG4gIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgdGhpcy5zdG9yZV9yZXNwb25zZXMucHVzaChyZXNwb25zZSk7XG4gIH1cblxuICAvLyBldmVudHNcbiAgdGhpcy5ydW5fZXZlbnQodGhpcy5nYW1lLmNvcmUuc3RhdGUuZXZlbnRzKTtcblxuICAvLyB1bnBhY2sgYW55IHN0b3JlZCBzZXJ2ZXIgc3RhdGUgZm9yIHRoaXMgZnJhbWVcbiAgaWYgKHRoaXMuc3RvcmVfcGFja2V0W2ZyYW1lXSkge1xuICAgIHRoaXMuc2V0X2dhbWVfc3RhdGUodGhpcy5zdG9yZV9wYWNrZXRbZnJhbWVdKTtcbiAgICBkZWxldGUgdGhpcy5zdG9yZV9wYWNrZXRbZnJhbWVdO1xuICB9XG5cbiAgLy8gcmVjb3JkIGdhbWUgc3RhdGVcbiAgdGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV0gPSB7XG4gICAgZnJhbWVzOiBmcmFtZSxcbiAgICBzdGF0ZTogdGhpcy5nYW1lLmNvcmUucGFja19zdGF0ZSh0aGlzLmdhbWUuY29yZS5zdGF0ZSlcbiAgfTtcbn07XG5cbi8qIFJlbW92ZSBvbGQgc3RhdGVzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVtb3ZlX29sZF9zdGF0ZXMgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5zdG9yZV9wYWNrZXQpIHtcbiAgICBpZiAocGFyc2VJbnQoZnJhbWUpICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgZGVsZXRlIHRoaXMuc3RvcmVfcGFja2V0W2ZyYW1lXTtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5zdG9yZV9zdGF0ZSkge1xuICAgIGlmIChwYXJzZUludChmcmFtZSkgKyA1MCA8IHRoaXMuZnJhbWVzKSB7XG4gICAgICBkZWxldGUgdGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV07XG4gICAgfVxuICB9XG4gIGZvciAodmFyIGZyYW1lIGluIHRoaXMuc3RvcmVfaW5wdXQpIHtcbiAgICBpZiAocGFyc2VJbnQoZnJhbWUpICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgZGVsZXRlIHRoaXMuc3RvcmVfaW5wdXRbZnJhbWVdO1xuICAgIH1cbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHRoaXMuc3RvcmVfcmVzcG9uc2VzW2ldLmZyYW1lICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgdGhpcy5zdG9yZV9yZXNwb25zZXMuc3BsaWNlKGksIDEpO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bGl0cGxheWVyXG4gICAgR3JvdW5kIERhbWFnZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIERhbWFnZSB0aGUgZ3JvdW5kIGV2ZW50XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZXZlbnRfZ3JvdW5kX2RhbWFnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBrZXkgPSBldmVudC5mcmFtZSArIFwiLVwiICsgZXZlbnQueCArIFwiLVwiICsgZXZlbnQueSArIFwiLVwiICsgZXZlbnQucmFkaXVzO1xuXG4gIC8vIGRpZCB3ZSBhbHJlYWR5IGhhdmUgdGhpcyBoYXBwZW5cbiAgaWYgKHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IGJvdW5kYXJpZXNcbiAgdmFyIHgxID0gbWF4KHJvdW5kKGV2ZW50LnggLSBldmVudC5yYWRpdXMpLCAwKTtcbiAgdmFyIHgyID0gbWluKHJvdW5kKGV2ZW50LnggKyBldmVudC5yYWRpdXMpLCB0aGlzLmdhbWUuY29yZS5tYXAudyAtIDEpO1xuICB2YXIgeTEgPSBtYXgocm91bmQoZXZlbnQueSAtIGV2ZW50LnJhZGl1cyksIDApO1xuICB2YXIgeTIgPSBtaW4ocm91bmQoZXZlbnQueSArIGV2ZW50LnJhZGl1cyksIHRoaXMuZ2FtZS5jb3JlLm1hcC5oIC0gMSk7XG4gIHZhciB3ID0geDIgLSB4MTtcbiAgdmFyIGggPSB5MiAtIHkxO1xuXG4gIC8vIGdldCBhcnJheSBmcm9tIHRoZSBtYXBcbiAgdmFyIGFyciA9IHRoaXMuZ2FtZS5jb3JlLm1hcC5nZXRfYmxvY2soeDEsIHkxLCB3LCBoKTtcblxuICAvLyBnZXQgcGllY2Ugb2YgdGhlIG1hcFxuICB2YXIgY2FudiA9IHRoaXMuZ2FtZS5nZXRfbGFuZF9ibG9jayh4MSwgeTEsIHcsIGgpO1xuXG4gIC8vIHN0b3JlIGJhY2tlZCB1cCBkYW1hZ2VcbiAgdGhpcy5ncm91bmRfdGVtcFtrZXldID0ge1xuICAgIGZyYW1lOiBldmVudC5mcmFtZSxcbiAgICB4OiB4MSxcbiAgICB5OiB5MSxcbiAgICBhcnI6IGFycixcbiAgICBjYW52OiBjYW52XG4gIH07XG5cbiAgLy8gc3RvcmUgdGhlIGV2ZW50IGl0c2VsZlxuICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XSA9IGR1cGxpY2F0ZV9vYmooZXZlbnQpO1xuICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XS5kb25lID0gdHJ1ZTtcblxuICAvLyBydW4gdGhlIGV2ZW50XG4gIHRoaXMuZ2FtZS5ydW5fZXZlbnQoZXZlbnQpO1xufTtcblxuLyogQ2hlY2sgZ3JvdW5kIGRhbWFnZSBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5mcmFtZV9ncm91bmQgPSBmdW5jdGlvbigpIHtcbiAgLy8gZ28gdGhyb3VnaCBhbGwgY2hlY2tzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdyb3VuZF90ZW1wKSB7XG4gICAgaWYgKHRoaXMuZnJhbWVzID4gdGhpcy5ncm91bmRfdGVtcFtrZXldLmZyYW1lICsgNDApIHtcbiAgICAgIGNsb2coXCJkYW1hZ2Ugbm90IGNvbmZpcm1lZFwiKTtcbiAgICAgIHRoaXMudW5kb19ncm91bmRfZGFtYWdlKHRoaXMuZ3JvdW5kX3RlbXBba2V5XSwga2V5KTtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF90ZW1wW2tleV07XG4gICAgICBkZWxldGUgdGhpcy5ncm91bmRfZXZlbnRzW2tleV07XG4gICAgfVxuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBhbGwgZXZlbnRzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdyb3VuZF9ldmVudHMpIHtcbiAgICB2YXIgZXZlbnQgPSB0aGlzLmdyb3VuZF9ldmVudHNba2V5XTtcbiAgICBpZiAodGhpcy5mcmFtZXMgPj0gZXZlbnQuZnJhbWUpIHtcbiAgICAgIGlmICghZXZlbnQuZG9uZSkge1xuICAgICAgICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcbiAgICAgICAgdGhpcy5ncm91bmRfZXZlbnRzW2tleV0uZG9uZSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLmZyYW1lcyA+IHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldLmZyYW1lICsgNTApIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF9ldmVudHNba2V5XTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFVuZG8gZ3JvdW5kIGRhbWFnZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnVuZG9fZ3JvdW5kX2RhbWFnZSA9IGZ1bmN0aW9uKGRhbWFnZSwgZF9rZXkpIHtcbiAgLy8gcmVzdG9yZSBpdFxuICB0aGlzLmdhbWUuY29yZS5tYXAuc2V0X2Jsb2NrX2Zyb21fYXJyKGRhbWFnZS54LCBkYW1hZ2UueSwgZGFtYWdlLmFycik7XG4gIHRoaXMuZ2FtZS5kcmF3X2xhbmRfYmxvY2soZGFtYWdlLngsIGRhbWFnZS55LCBkYW1hZ2UuY2Fudik7XG5cbiAgLy8gcmVkbyBhbnkgb3RoZXIgZXZlbnRzIHRoYXQgaGFwcGVuZWQgc2luY2VcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ3JvdW5kX2V2ZW50cykge1xuICAgIGlmIChkX2tleSA9PT0ga2V5KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgdGhpcy5nYW1lLnJ1bl9ldmVudCh0aGlzLmdyb3VuZF9ldmVudHNba2V5XSk7XG4gIH1cbn07XG5cbi8qIFNlcnZlciByZXNwb25zZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfZ3JvdW5kID0gZnVuY3Rpb24oc3RyKSB7XG4gIGlmICghc3RyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gdW5wYWNrIGRhbWFnZXNcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcGxpdDIgPSBzcGxpdFtpXS5zcGxpdChcIn5cIik7XG4gICAgdmFyIGV2ZW50ID0ge1xuICAgICAgdHlwZTogXCJncm91bmRfZGFtYWdlXCIsXG4gICAgICBmcmFtZTogcGFyc2VJbnQoc3BsaXQyWzBdKSxcbiAgICAgIHg6IHBhcnNlRmxvYXQoc3BsaXQyWzFdKSxcbiAgICAgIHk6IHBhcnNlRmxvYXQoc3BsaXQyWzJdKSxcbiAgICAgIHJhZGl1czogcGFyc2VGbG9hdChzcGxpdDJbM10pLFxuICAgICAgZGlnOiBzcGxpdDJbNF0gPT09IFwiMVwiXG4gICAgfTtcbiAgICB2YXIga2V5ID0gZXZlbnQuZnJhbWUgKyBcIi1cIiArIGV2ZW50LnggKyBcIi1cIiArIGV2ZW50LnkgKyBcIi1cIiArIGV2ZW50LnJhZGl1cztcblxuICAgIC8vIGNvbmZpcm0gYWxyZWFkeSBkb25lIGRhbWFnZVxuICAgIGlmICh0aGlzLmdyb3VuZF90ZW1wW2tleV0pIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF90ZW1wW2tleV07XG5cbiAgICAgIC8vIHdhaXQgdG8gcGVyZm9ybSBpdFxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XSA9IGV2ZW50O1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bHRpcGxheWVyXG4gICAgSW50ZXJmYWNlXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogSW5pdCBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5pbml0X2ludGVyZmFjZSA9IGZ1bmN0aW9uKCkge1xuICAvLyBsb2FkaW5nIHNjcmVlblxuICB0aGlzLmxvYWRpbmcgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiTG9hZGluZy4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG5cbiAgLy8gYmV0d2VlbiBnYW1lcyBzY3JlZW5cbiAgdGhpcy5iZXR3ZWVuX2dhbWVzID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OiBcIkRpbWVuc2lvbiBqdW1wIGluIHByb2dyZXNzITxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmJldHdlZW5fZ2FtZXMpO1xuICBoaWRlKHRoaXMuYmV0d2Vlbl9nYW1lcyk7XG5cbiAgLy8gcGVyZm9ybWFuY2VcbiAgdGhpcy5kaXZfcGluZyA9IGVsZW1lbnQoeyBjbGFzczogXCJwaW5nXCIgfSk7XG4gIHRoaXMuZGl2X2ZwcyA9IGVsZW1lbnQoeyBjbGFzczogXCJmcHNcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9waW5nKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9mcHMpO1xuXG4gIC8vIGRlYWQgZGl2XG4gIHRoaXMuZGl2X2RlYWQgPSBlbGVtZW50KHsgY2xhc3M6IFwiZnVsbCBmdWxsX2JnXCIgfSk7XG4gIHRoaXMuZGl2X2RlYWRfY29udCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyIHJlZFwiLFxuICAgIHRleHQ6IFwiPGgzPllvdSBoYXZlIGRpZWQhPC9oMz5cIiArIHNoYXJlTGlua3NUZXh0XG4gIH0pO1xuICB0aGlzLmRpdl9kZWFkX3RleHQgPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcInBcIixcbiAgICB0ZXh0OiBcIllvdSB3ZXJlIGtpbGxlZCBpbiBhY3Rpb24uXCJcbiAgfSk7XG4gIHRoaXMuZGl2X2RlYWRfY291bnRkb3duID0gZWxlbWVudCh7IHR5cGU6IFwicFwiLCBjbGFzczogXCJncmV5XCIgfSk7XG4gIHRoaXMuZGl2X2RlYWRfYnV0dG9ucyA9IGVsZW1lbnQoeyBjbGFzczogXCJidXR0b25zXCIgfSk7XG4gIHRoaXMuYnV0dG9uX3Jlc3Bhd24gPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcImJ1dHRvblwiLFxuICAgIGNsYXNzOiBcImJ1dHRvbiByZWQgZGlzYWJsZWRcIixcbiAgICB0ZXh0OiBcIlJlc3Bhd25cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9kZWFkKTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWQsIHRoaXMuZGl2X2RlYWRfY29udCk7XG4gIGFwcGVuZCh0aGlzLmRpdl9kZWFkX2NvbnQsIHRoaXMuZGl2X2RlYWRfdGV4dCk7XG4gIGFwcGVuZCh0aGlzLmRpdl9kZWFkX2NvbnQsIHRoaXMuZGl2X2RlYWRfY291bnRkb3duKTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWRfY29udCwgdGhpcy5kaXZfZGVhZF9idXR0b25zKTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWRfYnV0dG9ucywgdGhpcy5idXR0b25fcmVzcGF3bik7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG5cbiAgLy8gZ2FtZSBmdWxsIHNjcmVlblxuICB0aGlzLmZ1bGwgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6XG4gICAgICBcIkdhbWUgc2VydmVyIGZ1bGwuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuLi48YnI+PGJyPjxkaXYgY2xhc3M9J2xvYWRlcic+PC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5mdWxsKTtcbiAgaGlkZSh0aGlzLmZ1bGwpO1xuXG4gIC8vIHJlc3Bhd24gb24gY2xpY2tcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmJ1dHRvbl9yZXNwYXduLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoc2VsZi53YWl0X2Zvcl9yZXNwYXduID09PSAwKSB7XG4gICAgICBzZWxmLnNvY2tldHMubWVzc2FnZV9zZW5kKFwicmVzcGF3blwiLCBbXSk7XG4gICAgfVxuICB9O1xuXG4gIC8vIHBsYXllcnNcbiAgdGhpcy5kaXZfcGxheWVycyA9IGVsZW1lbnQoeyBjbGFzczogXCJwbGF5ZXJzXCIgfSk7XG4gIHRoaXMudGFibGVfcGxheWVycyA9IGVsZW1lbnQoeyB0eXBlOiBcInRhYmxlXCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfcGxheWVycyk7XG4gIGFwcGVuZCh0aGlzLmRpdl9wbGF5ZXJzLCB0aGlzLnRhYmxlX3BsYXllcnMpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFwcFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIG11bHRpcGxheWVyKFxuICBhc3NldHMsXG4gIGFzc2V0c191cmwsXG4gIGF1ZGlvLFxuICBpbnB1dCxcbiAgbmFtZSxcbiAgd2F0Y2hlcixcbiAgcnVuX2V2ZW50LFxuICBzb2NrZXRzLFxuICBvbmJvYXJkaW5nXG4pIHtcbiAgLy8gc2V0dXBcbiAgdGhpcy5hc3NldHMgPSBhc3NldHM7XG4gIHRoaXMuYXNzZXRzX3VybCA9IGFzc2V0c191cmw7XG4gIHRoaXMuYXVkaW8gPSBhdWRpbztcbiAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICB0aGlzLm5hbWUgPSBuYW1lO1xuICB0aGlzLndhdGNoZXIgPSB3YXRjaGVyO1xuICB0aGlzLnRvcF9ldmVudCA9IHJ1bl9ldmVudDtcbiAgdGhpcy5zb2NrZXRzID0gc29ja2V0cztcbiAgdGhpcy5zY2hlbWUgPSBudWxsO1xuICB0aGlzLmxhZyA9IDA7XG4gIHRoaXMub25ib2FyZGluZyA9IG9uYm9hcmRpbmc7XG5cbiAgLy8gbG9vcFxuICB0aGlzLmZwcyA9IDI0O1xuICB0aGlzLm1zX2xvb3AgPSBNYXRoLmZsb29yKDEwMDAgLyB0aGlzLmZwcyk7XG4gIHRoaXMubXNfdGljayA9IDEwO1xuICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuXG4gIC8vIG1haW4gZGl2c1xuICB0aGlzLmRpdiA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsXCIgfSk7XG4gIHRoaXMuY29ubmVjdGluZyA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJXYWl0aW5nIGZvciBjb25uZWN0aW9uLi4uPGJyPjxicj48ZGl2IGNsYXNzPSdsb2FkZXInPjwvZGl2PlwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuY29ubmVjdGluZyk7XG5cbiAgLy8gc2V0IHVwIGludGVyZmFjZVxuICB0aGlzLmluaXRfaW50ZXJmYWNlKCk7XG5cbiAgLy8gd2hlbiBqb2luaW5nIGEgZ2FtZSByZWNvcmQgYW55IGluY29taW5nIGV2ZW50cyBmb3IgbGF0ZXIgdXNlXG4gIHRoaXMuaW5pdGlhbF9nYW1lX2V2ZW50cyA9IFtdO1xufVxuXG4vKiBXYWl0IGZvciBjb25uZWN0aW9uXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUud2FpdF9mb3JfY29ubmVjdGlvbiA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMubG9vcF9zdG9wKCk7XG4gIGhpZGUodGhpcy5iZXR3ZWVuX2dhbWVzKTtcbiAgaGlkZSh0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMuZGl2X2RlYWQpO1xuICBzaG93KHRoaXMuY29ubmVjdGluZyk7XG59O1xuXG4vKiBDb25uZWN0ZWRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5jb25uZWN0ZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBzZXQgdXAgc2NoZW1lXG4gIHRoaXMuc2NoZW1lID0gZGVlcG1lcmdlKHNjaGVtZXMuZGVmYXVsdCwgc2NoZW1lc1tldmVudC5zY2hlbWVdKTtcblxuICAvLyBhY3RpdmUgdmFsdWVzXG4gIHRoaXMubmFtZSA9IGV2ZW50Lm5hbWU7XG4gIHRoaXMucGxheWVyX2lkID0gZXZlbnQucGxheWVyX2lkO1xuICB0aGlzLnBsYXllcl9jb3VudCA9IDA7XG4gIHRoaXMucGxheWVycyA9IHt9O1xuICB0aGlzLnBsYXllcnNfcmVmID0ge307XG5cbiAgLy8gZ28gdGhyb3VnaCBzdHJpbmcgb2YgcGxheWVyc1xuICB2YXIgc3BsaXQgPSBldmVudC5wbGF5ZXJzLnNwbGl0KFwiK1wiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcGxpdDIgPSBzcGxpdFtpXS5zcGxpdChcIi9cIik7XG4gICAgdGhpcy5pbml0X3BsYXllcih7XG4gICAgICB1c2VyX2lkOiBzcGxpdDJbMF0sXG4gICAgICBuYW1lOiBzcGxpdDJbMV0sXG4gICAgICBwbGF5ZXJfaWQ6IHBhcnNlSW50KHNwbGl0MlsyXSlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHJ1biB0aGUgcGxheWVyIGludGVyZmFjZVxuICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG59O1xuXG4vKiBTdGFydCBnYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9zdGFydCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMubG9hZGluZ19zdGFydCA9IHRydWU7XG4gIHRoaXMuaW5pdGlhbGlzZWQgPSBmYWxzZTtcbiAgdGhpcy5ncmF2aXR5X21hcCA9IGV2ZW50LmdyYXZpdHlfbWFwO1xuXG4gIHRoaXMuZ2FtZV9jbG9zZSgpO1xuXG4gIC8vIHJlc2V0IHNjb3Jlc1xuICBpZiAoZXZlbnQucmVzZXRfcGxheWVycykge1xuICAgIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVycykge1xuICAgICAgdGhpcy5wbGF5ZXJzW2lkXS5sZXZlbCA9IDA7XG4gICAgICB0aGlzLnBsYXllcnNbaWRdLnNjb3JlID0gMDtcbiAgICB9XG4gICAgdGhpcy5wbGF5ZXJzX2ludGVyZmFjZSgpO1xuICB9XG5cbiAgLy8gc3RvcmVkIGdhbWUgc3RhdGVzIGFuZCBhY3Rpb25zXG4gIHRoaXMuc3RvcmVfcGFja2V0ID0ge307XG4gIHRoaXMuc3RvcmVfc3RhdGUgPSB7fTtcbiAgdGhpcy5zdG9yZV9pbnB1dCA9IHt9O1xuICB0aGlzLnN0b3JlX3Jlc3BvbnNlcyA9IFtdO1xuXG4gIC8vIGdyb3VuZCBkYW1hZ2VcbiAgdGhpcy5ncm91bmRfdGVtcCA9IHt9O1xuICB0aGlzLmdyb3VuZF9ldmVudHMgPSB7fTtcblxuICAvLyBvYmplY3RzIHRoYXQgd2UgYXJlIHdhaXRpbmcgb24gZm9yIHNlcnZlciBjb25maXJtYXRpb25cbiAgdGhpcy53YWl0X3RvX2Rlc3Ryb3kgPSB7fTtcbiAgdGhpcy53YWl0X3RvX2NyZWF0ZSA9IHt9O1xuXG4gIC8vIHBlcmZvcm1hbmNlXG4gIHRoaXMucGluZ3MgPSB7fTtcbiAgdGhpcy5mcHNlcyA9IFtdO1xuXG4gIC8vIGxvYWQgdGhlIG1hcCBmcm9tIGRhdGEgdXJsXG4gIHZhciBzZWxmID0gdGhpcztcbiAgbmV3IGxvYWRlcihcbiAgICBcIlwiLFxuICAgIHtcbiAgICAgIGltZzoge1xuICAgICAgICBiZzogZXZlbnQuYmdfc3RyLFxuICAgICAgICBmZzogZXZlbnQuZmdfc3RyXG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbihhc3NldHMpIHtcbiAgICAgIHNlbGYuZ2FtZV9zdGFydF9sb2FkZWQoYXNzZXRzLmltZyk7XG4gICAgfVxuICApO1xufTtcblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmdhbWVfc3RhcnRfbG9hZGVkID0gZnVuY3Rpb24obWFwKSB7XG4gIC8vIHNldCB1cCBtYXBcbiAgdmFyIG5ld19tYXAgPSB7XG4gICAgZmc6IG1hcGdlbl9jYW52YXMobWFwLmZnLndpZHRoLCBtYXAuZmcuaGVpZ2h0KSxcbiAgICBiZzogbWFwZ2VuX2NhbnZhcyhtYXAuYmcud2lkdGgsIG1hcC5iZy5oZWlnaHQpLFxuICAgIGdyYXZpdHlfbWFwOiB0aGlzLmdyYXZpdHlfbWFwXG4gIH07XG4gIG5ld19tYXAuZmcuY29udC5kcmF3SW1hZ2UobWFwLmZnLCAwLCAwKTtcbiAgbmV3X21hcC5iZy5jb250LmRyYXdJbWFnZShtYXAuYmcsIDAsIDApO1xuXG4gIC8vIHN0YXJ0IHVwIGdhbWUgb2JqZWN0XG4gIHRoaXMuZ2FtZSA9IG5ldyBnYW1lKFxuICAgIHRoaXMuYXNzZXRzLFxuICAgIHRoaXMuYXVkaW8sXG4gICAgdGhpcy5pbnB1dCxcbiAgICB0aGlzLnNjaGVtZSxcbiAgICBuZXdfbWFwLFxuICAgIHRoaXMucGxheWVyc19yZWYsXG4gICAgdGhpcy5wbGF5ZXJfaWQsXG4gICAgdGhpcy50b3BfZXZlbnQsXG4gICAgdGhpcy5vbmJvYXJkaW5nXG4gICk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5nYW1lLmRpdik7XG5cbiAgLy8gZmluaXNoZWQgbG9hZGluZ1xuICB0aGlzLmxvYWRpbmdfc3RhcnQgPSBmYWxzZTtcbn07XG5cbi8qIEluaXQgZ2FtZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmluaXRfZ2FtZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmICghdGhpcy5nYW1lIHx8ICF0aGlzLmdhbWUuY29yZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNob3cgaW50ZXJmYWNlXG4gIGhpZGUodGhpcy5iZXR3ZWVuX2dhbWVzKTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcbiAgaGlkZSh0aGlzLmNvbm5lY3RpbmcpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG5cbiAgLy8gc3RvcCBnYW1lXG4gIHRoaXMubG9vcF9zdG9wKCk7XG5cbiAgLy8gcHJlcGFyZSBzdGF0ZVxuICB0aGlzLnNldF9nYW1lX3N0YXRlKGV2ZW50LCB0cnVlKTtcblxuICAvLyBzdGFydCBnYW1lXG4gIHRoaXMuZ2FtZS5zdGFydChldmVudC5mcmFtZXMpO1xuICB0aGlzLnN0YXR1cyA9IFwiYWN0aXZlXCI7XG5cbiAgLy8gbGFzdCBmcmFtZSBhIHNlcnZlciBwYWNrZXQgd2FzIHJlY2VpdmVkXG4gIHRoaXMubGFzdF9wYWNrZXQgPSBldmVudC5mcmFtZXM7XG4gIHRoaXMuZGlzY29ubmVjdGVkID0gZmFsc2U7XG5cbiAgLy8gcnVuIGluaXRpYWwgZXZlbnRzXG4gIHRoaXMucnVuX2V2ZW50KHRoaXMuaW5pdGlhbF9nYW1lX2V2ZW50cyk7XG4gIHRoaXMuaW5pdGlhbF9nYW1lX2V2ZW50cyA9IFtdO1xuICB0aGlzLmluaXRpYWxpc2VkID0gdHJ1ZTtcblxuICAvLyBzdGFydCBsb29wXG4gIHRoaXMubG9vcF9zdGFydChldmVudC5mcmFtZXMpO1xufTtcblxuLyogQ2xvc2UgZ2FtZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmdhbWVfY2xvc2UgPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmxvb3Bfc3RvcCgpO1xuICBpZiAodGhpcy5nYW1lKSB7XG4gICAgcmVtb3ZlKHRoaXMuZ2FtZS5kaXYpO1xuICAgIGRlbGV0ZSB0aGlzLmdhbWU7XG4gIH1cbn07XG5cbi8qIEVuZCBHYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9lbmQgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBzdG9wIGdhbWVcbiAgdGhpcy5sb29wX3N0b3AoKTtcblxuICAvLyBzdG9wIGF1ZGlvXG4gIHRoaXMuYXVkaW8uc3RvcCgpO1xuXG4gIC8vIHNob3cgbG9hZGluZyBzY3JlZW5cbiAgaGlkZSh0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMuZGl2X2RlYWQpO1xuICBoaWRlKHRoaXMuY29ubmVjdGluZyk7XG4gIHNob3codGhpcy5iZXR3ZWVuX2dhbWVzKTtcbn07XG5cbi8qIFNlbmQgaW5wdXQgdG8gc2VydmVyXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuc2VuZF9pbnB1dCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICB2YXIgYXJyID0gW3RoaXMuZnJhbWVzLCBhY3Rpb24uYWN0aW9uLCBhY3Rpb24uYW5nbGVdO1xuICBpZiAoYWN0aW9uLmFjdGlvbiA9PT0gXCJzaG9vdFwiKSB7XG4gICAgYXJyLnB1c2goYWN0aW9uLndlYXBvbik7XG4gIH1cbiAgdGhpcy5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcInBsYXllcl9pbnB1dFwiLCBhcnIpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFJvb20gUGxheWVyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBwbGF5ZXIgb2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmluaXRfcGxheWVyID0gZnVuY3Rpb24ocHJvcHMpIHtcbiAgLy8gYWRkIHBsYXllciB0byBhcnJheVxuICB0aGlzLnBsYXllcl9jb3VudCsrO1xuICB0aGlzLnBsYXllcnNbcHJvcHMudXNlcl9pZF0gPSB7XG4gICAgbmFtZTogcHJvcHMubmFtZSxcbiAgICBpZDogcHJvcHMucGxheWVyX2lkXG4gIH07XG5cbiAgLy8gc2V0IHBsYXllcnMgcmVmZXJlbmNlXG4gIHRoaXMucGxheWVyc19yZWZbcHJvcHMucGxheWVyX2lkXSA9IHtcbiAgICB1c2VyX2lkOiBwcm9wcy51c2VyX2lkLFxuICAgIG5hbWU6IHByb3BzLm5hbWUsXG4gICAgbGV2ZWw6IDBcbiAgfTtcbn07XG5cbi8qIERyYXcgcGxheWVycyBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5wbGF5ZXJzX2ludGVyZmFjZSA9IGZ1bmN0aW9uKCkge1xuICAvLyBhcmUgd2UgZ29vZCBhbmQgYWN0aXZlXG4gIGlmICghdGhpcy5pbml0aWFsaXNlZCB8fCAhdGhpcy5nYW1lLmNvcmUuc3RhdGUucGxheWVycykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNob3cgcGxheWVyc1xuICB2YXIgc3RyID0gXCJcIjtcbiAgdmFyIHNvcnRhYmxlID0gdGhpcy5wbGF5ZXJzX3NvcnQoKTtcbiAgaWYgKCFzb3J0YWJsZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNldCBsZWFkZXIgaWRcbiAgdGhpcy5nYW1lLmxlYWRlciA9IHBhcnNlSW50KHNvcnRhYmxlWzBdLmlkKTtcblxuICBzdHIgPSBcIjx0aGVhZD48dGg+PC90aD48dGg+bHZsPC90aD48dGg+c2NvcmU8L3RoPjwvdGhlYWQ+XCI7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc29ydGFibGUubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcGxheWVyID0gc29ydGFibGVbaV07XG4gICAgdmFyIHRyX2NsYXNzID0gXCJcIjtcbiAgICBpZiAocGxheWVyLmlkID09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgICB0cl9jbGFzcyArPSBcImhpZ2hsaWdodCBcIjtcbiAgICB9XG4gICAgaWYgKHBsYXllci5kZWFkKSB7XG4gICAgICB0cl9jbGFzcyArPSBcImRlYWQgXCI7XG4gICAgfVxuICAgIHN0ciArPVxuICAgICAgXCI8dHIgY2xhc3M9J1wiICtcbiAgICAgIHRyX2NsYXNzICtcbiAgICAgIFwiJyc+PHRkPlwiICtcbiAgICAgIHBsYXllci5uYW1lICtcbiAgICAgIFwiPC90ZD48dGQgY2xhc3M9J3JlZCc+XCIgK1xuICAgICAgKHBsYXllci5sZXZlbCArIDEpICtcbiAgICAgIFwiPC90ZD48dGQgY2xhc3M9J2dyZWVuJz5cIiArXG4gICAgICBwbGF5ZXIuc2NvcmUgK1xuICAgICAgXCI8L3RkPjwvdHI+XCI7XG4gIH1cblxuICAvLyBjaGVjayBmb3IgbGV2ZWwgdXBzXG4gIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVyc19yZWYpIHtcbiAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzX3JlZltpZF07XG4gICAgdmFyIGNvcmVfcGxheWVyID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUucGxheWVyc1tpZF07XG4gICAgaWYgKCFjb3JlX3BsYXllcikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChwbGF5ZXIubGV2ZWwgIT09IGNvcmVfcGxheWVyLmxldmVsKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudCh7XG4gICAgICAgIHR5cGU6IFwicGxheWVyX2xldmVsXCIsXG4gICAgICAgIGlkOiBwYXJzZUludChpZCksXG4gICAgICAgIHByZXY6IHBsYXllci5sZXZlbCxcbiAgICAgICAgbmV3OiBjb3JlX3BsYXllci5sZXZlbFxuICAgICAgfSk7XG4gICAgICB0aGlzLnBsYXllcnNfcmVmW2lkXS5sZXZlbCA9IGNvcmVfcGxheWVyLmxldmVsO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCBjb250ZW50XG4gIHRoaXMudGFibGVfcGxheWVycy5pbm5lckhUTUwgPSBzdHI7XG59O1xuXG4vKiBTb3J0IHBsYXllcnMgYnkgc2NvcmVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5wbGF5ZXJzX3NvcnQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNvcnRhYmxlID0gW107XG4gIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVyc19yZWYpIHtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzW2lkXTtcbiAgICBpZiAoIWNvcmVfcGxheWVyKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgc29ydGFibGUucHVzaCh7XG4gICAgICBpZDogaWQsXG4gICAgICBuYW1lOiB0aGlzLnBsYXllcnNfcmVmW2lkXS5uYW1lLFxuICAgICAgbGV2ZWw6IGNvcmVfcGxheWVyLmxldmVsLFxuICAgICAgc2NvcmU6IGNvcmVfcGxheWVyLnNjb3JlLFxuICAgICAgZGVhZDogY29yZV9wbGF5ZXIuZGVhZFxuICAgIH0pO1xuICB9XG4gIHNvcnRhYmxlLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgIHJldHVybiBiLnNjb3JlIC0gYS5zY29yZTtcbiAgfSk7XG4gIHJldHVybiBzb3J0YWJsZTtcbn07XG5cbi8qIFBsYXllciBoYXMgam9pbmVkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucGxheWVyX2pvaW4gPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmluaXRfcGxheWVyKGV2ZW50LCB0cnVlKTtcbiAgdGhpcy5hdWRpby5wbGF5KFwiam9pblwiLCAxKTtcbn07XG5cbi8qIFBsYXllciBsZWZ0XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucGxheWVyX2xlYXZlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKCF0aGlzLnBsYXllcnNbZXZlbnQudXNlcl9pZF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgaWQgPSB0aGlzLnBsYXllcnNbZXZlbnQudXNlcl9pZF0ucGxheWVyX2lkO1xuICBkZWxldGUgdGhpcy5wbGF5ZXJzX3JlZltpZF07XG4gIGRlbGV0ZSB0aGlzLnBsYXllcnNbZXZlbnQudXNlcl9pZF07XG4gIHRoaXMucGxheWVyX2NvdW50LS07XG5cbiAgLy8gcmVtb3ZlIGZyb20gZ2FtZVxuICBpZiAodGhpcy5nYW1lICYmIHRoaXMuZ2FtZS5jb3JlKSB7XG4gICAgdGhpcy5nYW1lLmNvcmUucmVtb3ZlX3BsYXllcihpZCk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lIFN0YXRlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJlY2VpdmUgZ2FtZSBzdGF0ZSBmcm9tIHNlcnZlclxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmdhbWVfc3RhdGVfcmVjZWl2ZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBpZiB3ZSBhcmUgbG9hZGluZ1xuICBpZiAodGhpcy5sb2FkaW5nX3N0YXJ0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc3RhcnQgdGhlIGdhbWVcbiAgaWYgKCF0aGlzLmluaXRpYWxpc2VkIHx8IHRoaXMuZGlzY29ubmVjdGVkKSB7XG4gICAgdGhpcy5pbml0aWFsaXNlZCA9IHRydWU7XG4gICAgdGhpcy5pbml0X2dhbWUoZXZlbnQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBkaWZmID0gZXZlbnQuZnJhbWVzIC0gdGhpcy5mcmFtZXM7XG5cbiAgLy8gaWYgd2UgYXJlIHRvbyBxdWlja1xuICBpZiAoZGlmZiA8IDApIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcImNsaWVudCB0b28gZmFzdFwiKTtcbiAgICB0aGlzLmluaXRfZ2FtZShldmVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaWYgaXQncyB0b28gZmFyIGJlaGluZCByZXN5bmNcbiAgaWYgKGRpZmYgPiA5KSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZXN5bmNcIik7XG4gICAgdGhpcy5pbml0X2dhbWUoZXZlbnQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGFwcGx5IHRoZSBzdGF0ZVxuICBpZiAoZXZlbnQuZnJhbWVzID09PSB0aGlzLmZyYW1lcykge1xuICAgIHRoaXMuc2V0X2dhbWVfc3RhdGUoZXZlbnQpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuc3RvcmVfcGFja2V0W2V2ZW50LmZyYW1lc10gPSBkdXBsaWNhdGVfb2JqKGV2ZW50KTtcbiAgfVxufTtcblxuLyogU2V0IGdhbWUgc3RhdGVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5zZXRfZ2FtZV9zdGF0ZSA9IGZ1bmN0aW9uKGV2ZW50LCBpZ25vcmVfcmVzKSB7XG4gIC8vIHJ1biBkYW1hZ2VzXG4gIHRoaXMucmVzb2x2ZV9ncm91bmQoZXZlbnQuZGFtYWdlcyk7XG5cbiAgLy8gdW5wYWNrIHRoZSBzdGF0ZVxuICB2YXIgc3RhdGUgPSB0aGlzLmdhbWUuY29yZS51bnBhY2tfc3RhdGUoZXZlbnQuc3RhdGUpO1xuXG4gIC8vIHNldCBwbGF5ZXJzXG4gIHRoaXMucmVzb2x2ZV9wbGF5ZXJzKHN0YXRlLCBpZ25vcmVfcmVzKTtcblxuICAvLyBzZXQgdGhpcyBwbGF5ZXJcbiAgaWYgKCFpZ25vcmVfcmVzKSB7XG4gICAgdGhpcy5yZXNvbHZlX3RoaXNfcGxheWVyKHN0YXRlLCBldmVudC5yZXNwb25zZXMpO1xuICB9XG5cbiAgLy8gc2V0IG9iamVjdHNcbiAgdGhpcy5yZXNvbHZlX29iamVjdHMoc3RhdGUub2JqZWN0cywgZXZlbnQuZnJhbWVzKTtcblxuICAvLyBzZXQgZXhwbG9zaW9uc1xuICB0aGlzLnJlc29sdmVfZXhwbG9zaW9ucyhzdGF0ZS5leHBsb3Npb25zLCBldmVudC5mcmFtZXMpO1xuXG4gIC8vIHNldCBnYW1lIHBsYXllciByZWZlcmVuY2VzXG4gIHRoaXMuZ2FtZS5zZXRfdGhpc19wbGF5ZXJfcmVmcygpO1xufTtcblxuLyogUmVzb2x2ZSBwbGF5ZXJzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzb2x2ZV9wbGF5ZXJzID0gZnVuY3Rpb24oc3RhdGUsIGlnbm9yZV9yZXMpIHtcbiAgLy8gc2V0IGFsbCBvdGhlciBwbGF5ZXJzXG4gIGZvciAodmFyIGtleSBpbiBzdGF0ZS5wbGF5ZXJzKSB7XG4gICAgaWYgKHBhcnNlSW50KGtleSkgIT09IHRoaXMucGxheWVyX2lkIHx8IGlnbm9yZV9yZXMpIHtcbiAgICAgIHRoaXMuZ2FtZS5pbml0X3BsYXllcihzdGF0ZS5wbGF5ZXJzW2tleV0sIHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJlbW92ZSBwbGF5ZXJzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgaWYgKCFzdGF0ZS5wbGF5ZXJzW2tleV0pIHtcbiAgICAgIHRoaXMuZ2FtZS5jb3JlLnJlbW92ZV9wbGF5ZXIoa2V5KTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFJlc29sdmUgdGhpcyBwbGF5ZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX3RoaXNfcGxheWVyID0gZnVuY3Rpb24oc3RhdGUsIHJlc3BvbnNlcykge1xuICAvLyBwcmVwIHNlcnZlciBzdGF0ZSBvYmplY3RzXG4gIHZhciBzZXJ2ZXJfcGxheWVyID0gc3RhdGUucGxheWVyc1t0aGlzLnBsYXllcl9pZF07XG4gIHZhciBzZXJ2ZXJfb2JqID0gc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHRoaXMucGxheWVyX2lkXTtcbiAgaWYgKCFzZXJ2ZXJfcGxheWVyIHx8ICFzZXJ2ZXJfb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcHJlcCBzZXJ2ZXIgcmVzcG9uc2VzXG4gIHZhciBzZXJ2ZXJfcmVzcG9uc2VzID0gW107XG4gIHZhciBzcGxpdCA9IHJlc3BvbnNlcy5zcGxpdChcIiRcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc3BsaXQyID0gc3BsaXRbaV0uc3BsaXQoXCJ+XCIpO1xuICAgIHNlcnZlcl9yZXNwb25zZXMucHVzaCh7XG4gICAgICBmcmFtZTogcGFyc2VJbnQoc3BsaXQyWzBdKSxcbiAgICAgIHN1Y2Nlc3M6IHNwbGl0MlsxXSA9PT0gXCIxXCIsXG4gICAgICB4OiBwYXJzZUZsb2F0KHNwbGl0MlsyXSksXG4gICAgICB5OiBwYXJzZUZsb2F0KHNwbGl0MlszXSksXG4gICAgICBzcGVlZF94OiBwYXJzZUZsb2F0KHNwbGl0Mls0XSksXG4gICAgICBzcGVlZF95OiBwYXJzZUZsb2F0KHNwbGl0Mls1XSksXG4gICAgICB0eXBlOiBzcGxpdDJbNl1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIGNoZWNrIHBsYXllciB3ZWFwb25cbiAgaWYgKHNlcnZlcl9wbGF5ZXIud2VhcG9uICE9PSB0aGlzLmdhbWUuY3VycmVudF93ZWFwb24pIHtcbiAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwid2VhcG9uX3NlbGVjdGVkXCIsIFt0aGlzLmdhbWUuY3VycmVudF93ZWFwb25dKTtcbiAgfVxuXG4gIC8vIGlmIHdlIGhhdmUgbm8gbW9yZSBhY3Rpb25zXG4gIGlmICh0aGlzLnN0b3JlX3Jlc3BvbnNlcy5sZW5ndGggPT09IDApIHtcbiAgICB0aGlzLmdhbWUucGxheWVyLmxldmVsID0gc2VydmVyX3BsYXllci5sZXZlbDtcbiAgICB0aGlzLmdhbWUucGxheWVyLnNjb3JlID0gc2VydmVyX3BsYXllci5zY29yZTtcbiAgICB0aGlzLmdhbWUucGxheWVyLmRlYWQgPSBzZXJ2ZXJfcGxheWVyLmRlYWQ7XG4gICAgdGhpcy5nYW1lLnBsYXllci5oZWFsdGggPSBzZXJ2ZXJfcGxheWVyLmhlYWx0aDtcbiAgICB0aGlzLmdhbWUucGxheWVyLmNvb2xkb3duID0gc2VydmVyX3BsYXllci5jb29sZG93bjtcbiAgICB0aGlzLmdhbWUucGxheWVyLmFybW91cnkgPSBkdXBsaWNhdGVfb2JqKHNlcnZlcl9wbGF5ZXIuYXJtb3VyeSk7XG4gICAgdGhpcy5nYW1lLnNldF9hcm1vdXJ5KCk7XG4gIH1cblxuICAvLyByZXNvbHZlIG91ciBwbGF5ZXJcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN0b3JlX3Jlc3BvbnNlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBjbGllbnRfcmVzcG9uc2UgPSB0aGlzLnN0b3JlX3Jlc3BvbnNlc1tpXTtcblxuICAgIC8vIGdvIHRocm91Z2ggYWN0aW9uIHJlc3BvbnNlc1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2VydmVyX3Jlc3BvbnNlcy5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIHNlcnZlcl9yZXNwb25zZSA9IHNlcnZlcl9yZXNwb25zZXNbal07XG5cbiAgICAgIC8vIGNvcnJlY3QgZnJhbWVcbiAgICAgIGlmIChjbGllbnRfcmVzcG9uc2UuZnJhbWUgPT09IHNlcnZlcl9yZXNwb25zZS5mcmFtZSkge1xuICAgICAgICAvLyBjb21wYXJlIHRoZSByZXNwb25zZVxuICAgICAgICBpZiAoXG4gICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLnN1Y2Nlc3MgPT09IHNlcnZlcl9yZXNwb25zZS5zdWNjZXNzICYmXG4gICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLnggPT09IHNlcnZlcl9yZXNwb25zZS54ICYmXG4gICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLnkgPT09IHNlcnZlcl9yZXNwb25zZS55ICYmXG4gICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLnNwZWVkX3ggPT09IHNlcnZlcl9yZXNwb25zZS5zcGVlZF94ICYmXG4gICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLnNwZWVkX3kgPT09IHNlcnZlcl9yZXNwb25zZS5zcGVlZF95XG4gICAgICAgICkge1xuICAgICAgICAgIC8vIGNsb2coXCJhY3Qgc3VjY2Vzc1wiLCBzZXJ2ZXJfcmVzcG9uc2UuZnJhbWUsIHRoaXMuZnJhbWVzLCBzZXJ2ZXJfcmVzcG9uc2UudHlwZSwgY2xpZW50X3Jlc3BvbnNlLngsIHNlcnZlcl9yZXNwb25zZS54LCBjbGllbnRfcmVzcG9uc2UueSwgc2VydmVyX3Jlc3BvbnNlLnkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHJlc3luYyB0aGUgcGxheWVyXG4gICAgICAgICAgY2xvZyhcbiAgICAgICAgICAgIFwiYWN0IGZhaWxcIixcbiAgICAgICAgICAgIHNlcnZlcl9yZXNwb25zZS5mcmFtZSxcbiAgICAgICAgICAgIHRoaXMuZnJhbWVzLFxuICAgICAgICAgICAgc2VydmVyX3Jlc3BvbnNlLnR5cGUsXG4gICAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueCxcbiAgICAgICAgICAgIHNlcnZlcl9yZXNwb25zZS54LFxuICAgICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLnksXG4gICAgICAgICAgICBzZXJ2ZXJfcmVzcG9uc2UueVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCF0aGlzLnJlc3luY190aGlzX3BsYXllcihzZXJ2ZXJfcmVzcG9uc2UpKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWUuaW5pdF9wbGF5ZXIoc2VydmVyX3BsYXllciwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5nYW1lLmNyZWF0ZV9vYmplY3Qoc2VydmVyX29iaik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNlcnZlcl9yZXNwb25zZXMuc3BsaWNlKGosIDEpO1xuICAgICAgICB0aGlzLnN0b3JlX3Jlc3BvbnNlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGktLTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKiBTeW5jIHRoaXMgcGxheWVyXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzeW5jX3RoaXNfcGxheWVyID0gZnVuY3Rpb24oc2VydmVyX3Jlc3BvbnNlKSB7XG4gIC8vIGhvdyBmYXIgYmFjayBpcyB0aGlzXG4gIHZhciBmcmFtZSA9IHNlcnZlcl9yZXNwb25zZS5mcmFtZTtcbiAgdmFyIGZyYW1lX2RpZmZlcmVuY2UgPSB0aGlzLmZyYW1lcyAtIGZyYW1lO1xuXG4gIC8vIGlmIGl0J3MgdG9vIGZhciBiYWNrXG4gIC8vIGlmIHdlIGhhdmUgbm8gc3RhdGUgdG8gcm9sbCBiYWNrIHRvXG4gIGlmIChmcmFtZV9kaWZmZXJlbmNlID4gMjAgfHwgIXRoaXMuc3RvcmVfc3RhdGVbZnJhbWVdKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJzeW5jIHRvbyBmYXIgYmFjayB8IFwiICsgZnJhbWVfZGlmZmVyZW5jZSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gcmVzZXQgZ2FtZSBzdGF0ZVxuICB0aGlzLnNldF9nYW1lX3N0YXRlKHRoaXMuc3RvcmVfc3RhdGVbZnJhbWVdLCB0cnVlKTtcblxuICAvLyByZXNldCBwbGF5ZXJcbiAgdGhpcy5zdG9yZV9yZXNwb25zZXMgPSBbXTtcbiAgdGhpcy5nYW1lLnBsYXllcl9vYmoueCA9IHNlcnZlcl9yZXNwb25zZS54O1xuICB0aGlzLmdhbWUucGxheWVyX29iai55ID0gc2VydmVyX3Jlc3BvbnNlLnk7XG4gIHRoaXMuZ2FtZS5wbGF5ZXJfb2JqLnNwZWVkX3ggPSBzZXJ2ZXJfcmVzcG9uc2Uuc3BlZWRfeDtcbiAgdGhpcy5nYW1lLnBsYXllcl9vYmouc3BlZWRfeSA9IHNlcnZlcl9yZXNwb25zZS5zcGVlZF95O1xuXG4gIC8vIHJ1biBhbGwgZnJhbWVzIHVwIHRvIHRoaXMgcG9pbnRcbiAgZm9yICh2YXIgaSA9IDE7IGkgPD0gZnJhbWVfZGlmZmVyZW5jZTsgaSsrKSB7XG4gICAgdGhpcy5mcmFtZV9ydW4oZnJhbWUgKyBpKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogUmVzb2x2ZSBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzb2x2ZV9vYmplY3RzID0gZnVuY3Rpb24ob2JqZWN0cywgZnJhbWUpIHtcbiAgLy8gY2hlY2sgZm9yIHVuY3JlYXRlZCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiBvYmplY3RzKSB7XG4gICAgaWYgKCF0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzW2tleV0pIHtcbiAgICAgIGlmICghdGhpcy53YWl0X3RvX2NyZWF0ZVtrZXldIHx8IHRoaXMud2FpdF90b19jcmVhdGVba2V5XSArIDQwIDwgZnJhbWUpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMud2FpdF90b19jcmVhdGVba2V5XTtcbiAgICAgICAgdGhpcy5nYW1lLmNyZWF0ZV9vYmplY3Qob2JqZWN0c1trZXldKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBpZiB0aGVyZSdzIG5vIGNvcnJlc3BvbmRpbmcgc2VydmVyIG9iamVjdFxuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIGlmICghb2JqZWN0c1trZXldKSB7XG4gICAgICAvLyBnaXZlIHRoZW0gYSBkZWxheVxuICAgICAgaWYgKCF0aGlzLndhaXRfdG9fZGVzdHJveVtrZXldKSB7XG4gICAgICAgIHRoaXMud2FpdF90b19kZXN0cm95W2tleV0gPSBmcmFtZSArIDQwO1xuICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAvLyByZW1vdmUgd2hlbiBkZWxheSBoYXMgZXhwaXJlZFxuICAgICAgfSBlbHNlIGlmICh0aGlzLndhaXRfdG9fZGVzdHJveVtrZXldIDwgZnJhbWUpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICAgICAgZGVsZXRlIHRoaXMud2FpdF90b19kZXN0cm95W2tleV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gbWF0Y2ggdXAgb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIC8vIGlmIG91ciBwbGF5ZXIgYW5kIHdhaXRpbmcgZm9yIGFjdGlvbiByZXNwb25zZXNcbiAgICBpZiAoa2V5ID09PSBcInBsYXllci1cIiArIHRoaXMucGxheWVyX2lkKSB7XG4gICAgICBpZiAodGhpcy5zdG9yZV9yZXNwb25zZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBvYmogPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgdmFyIHJlc19vYmogPSBvYmplY3RzW2tleV07XG5cbiAgICAvLyBpZ25vcmUgYW55IG9iamVjdHMgd2l0aCBubyByZWZlcmVuY2VcbiAgICBpZiAoIXJlc19vYmopIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIG1hdGNoIHZhbHVlc1xuICAgIGlmIChvYmoudHlwZSAhPT0gcmVzX29iai50eXBlKSB7XG4gICAgICBvYmoudHlwZSA9IHJlc19vYmoudHlwZTtcbiAgICAgIG9iai5jID0gdGhpcy5nYW1lLmMub2JqZWN0c1tvYmoudHlwZV07XG4gICAgfVxuICAgIG9iai5ncm91bmRlZCA9IHJlc19vYmouZ3JvdW5kZWQ7XG5cbiAgICAvLyBpZiBncm91bmRlZCBvciB1c1xuICAgIGlmIChvYmouZ3JvdW5kZWQgfHwgb2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgIG9iai54ID0gcmVzX29iai54O1xuICAgICAgb2JqLnkgPSByZXNfb2JqLnk7XG4gICAgICBvYmouc3BlZWRfeCA9IHJlc19vYmouc3BlZWRfeDtcbiAgICAgIG9iai5zcGVlZF95ID0gcmVzX29iai5zcGVlZF95O1xuXG4gICAgICAvLyBzZXQgaW50ZXJwb2xhdGlvbiBwb3NpdGlvblxuICAgIH0gZWxzZSBpZiAoIW9iai5hY3Rpb25lZCkge1xuICAgICAgb2JqLmdob3N0ID0gZnJhbWU7XG4gICAgICBvYmouZ3ggPSBvYmoueDtcbiAgICAgIG9iai5neSA9IG9iai55O1xuICAgICAgb2JqLnggPSByZXNfb2JqLng7XG4gICAgICBvYmoueSA9IHJlc19vYmoueTtcbiAgICAgIG9iai5zcGVlZF94ID0gcmVzX29iai5zcGVlZF94O1xuICAgICAgb2JqLnNwZWVkX3kgPSByZXNfb2JqLnNwZWVkX3k7XG4gICAgfVxuICB9XG59O1xuXG4vKiBSZXNvbHZlIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX2V4cGxvc2lvbnMgPSBmdW5jdGlvbihleHBsb3Npb25zLCBmcmFtZSkge1xuICAvLyBjaGVjayBmb3IgdW5jcmVhdGVkIGV4cGxvc2lvbnNcbiAgZm9yICh2YXIga2V5IGluIGV4cGxvc2lvbnMpIHtcbiAgICBpZiAoIXRoaXMuZ2FtZS5jb3JlLnN0YXRlLmV4cGxvc2lvbnNba2V5XSkge1xuICAgICAgdGhpcy5nYW1lLmNvcmUuY3JlYXRlX2V4cGxvc2lvbihleHBsb3Npb25zW2tleV0pO1xuXG4gICAgICAvLyBlbnN1cmUgY29ycmVjdCBwb3NpdGlvblxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdhbWUuY29yZS5zdGF0ZS5leHBsb3Npb25zW2tleV0ueCA9IGV4cGxvc2lvbnNba2V5XS54O1xuICAgICAgdGhpcy5nYW1lLmNvcmUuc3RhdGUuZXhwbG9zaW9uc1trZXldLnkgPSBleHBsb3Npb25zW2tleV0ueTtcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgVHJhY2tlciBBcnJvd3NcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gdGhlIGFycm93c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2Fycm93cyA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKHZhciB0eXBlIGluIHRoaXMuc2NoZW1lLmFycm93cykge1xuICAgIHZhciBhcnJvdyA9IHRoaXMuc2NoZW1lLmFycm93c1t0eXBlXTtcbiAgICBpZiAoIWFycm93KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBmaW5kIGNsb3Nlc3QgdGhpbmdcbiAgICB2YXIgbG93ZXN0ID0gOTk5OTk7XG4gICAgdmFyIGNsb3Nlc3Rfb2JqID0gbnVsbDtcbiAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgICAgaWYgKG9iai50eXBlID09PSBcInBsYXllclwiICYmIG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKG9iai50eXBlID09PSB0eXBlKSB7XG4gICAgICAgIHZhciBkaXN0ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2UoXG4gICAgICAgICAgb2JqLngsXG4gICAgICAgICAgb2JqLnksXG4gICAgICAgICAgdGhpcy5jYW1lcmEueCxcbiAgICAgICAgICB0aGlzLmNhbWVyYS55XG4gICAgICAgICk7XG4gICAgICAgIGlmIChkaXN0IDwgbG93ZXN0KSB7XG4gICAgICAgICAgbG93ZXN0ID0gZGlzdDtcbiAgICAgICAgICBjbG9zZXN0X29iaiA9IG9iajtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWNsb3Nlc3Rfb2JqKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgc2NyZWVuIHBvc2l0aW9uXG4gICAgdmFyIHBvcyA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKGNsb3Nlc3Rfb2JqLngsIGNsb3Nlc3Rfb2JqLnksIDgwKTtcbiAgICBpZiAocG9zLm9uX3NjcmVlbikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gc2hvdyBhbiBhcnJvd1xuICAgIHZhciBhbmdsZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgICB0aGlzLmNhbWVyYS54LFxuICAgICAgdGhpcy5jYW1lcmEueSxcbiAgICAgIGNsb3Nlc3Rfb2JqLngsXG4gICAgICBjbG9zZXN0X29iai55XG4gICAgKTtcbiAgICB2YXIgZGlzdCA9IG1pbihsb3dlc3QsIG1pbih0aGlzLmNhbnZhcy5jeCwgdGhpcy5jYW52YXMuY3kpKSAtIDIyO1xuICAgIHZhciB4eSA9IHh5X3NwZWVkKGFuZ2xlLCBkaXN0KTtcbiAgICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgICB0eXBlOiBcImFycm93LVwiICsgYXJyb3csXG4gICAgICB4OiByb3VuZCh0aGlzLmNhbWVyYS54ICsgeHkueCksXG4gICAgICB5OiByb3VuZCh0aGlzLmNhbWVyYS55ICsgeHkueSksXG4gICAgICBhbmdsZTogYW5nbGVfYWRkKGFuZ2xlLCAyNzApXG4gICAgfSk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgQmFja2dyb3VuZCBMYXllclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBiYWNrZ3JvdW5kXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2JhY2tncm91bmQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5iZyA9IHt9O1xuICB0aGlzLmJnLnBhcmFsbGF4ID0gMC41O1xuICB0aGlzLmJnLnggPSAwO1xuICB0aGlzLmJnLnkgPSAwO1xuICB0aGlzLmJnLncgPSB0aGlzLmltZy5iZy53aWR0aDtcbiAgdGhpcy5iZy5oID0gdGhpcy5pbWcuYmcuaGVpZ2h0O1xuICB0aGlzLmJnLnBhdHRlcm4gPSB0aGlzLmNhbnZhcy5jb250LmNyZWF0ZVBhdHRlcm4odGhpcy5pbWcuYmcsIFwicmVwZWF0XCIpO1xufTtcblxuLyogRHJhdyB0aGUgYmFja2dyb3VuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfYmFja2dyb3VuZCA9IGZ1bmN0aW9uKCkge1xuICAvLyBob3cgbXVjaCBoYXZlIHdlIG1vdmVkIGJ5XG4gIHZhciBkeCA9XG4gICAgICB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV94KHRoaXMuY2FtZXJhLngsIHRoaXMuY2FtZXJhLnB4KSAqXG4gICAgICB0aGlzLmJnLnBhcmFsbGF4LFxuICAgIGR5ID1cbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kodGhpcy5jYW1lcmEueSwgdGhpcy5jYW1lcmEucHkpICpcbiAgICAgIHRoaXMuYmcucGFyYWxsYXg7XG5cbiAgLy8gYWRkIG1vdmVtZW50IG11bHRpcGxpZWQgYnkgcGFyYWxsYXggZGVncmVlXG4gIHRoaXMuYmcueCA9IG5fbG9vcCh0aGlzLmJnLnggKyBkeCwgMCwgdGhpcy5iZy53KTtcbiAgdGhpcy5iZy55ID0gbl9sb29wKHRoaXMuYmcueSArIGR5LCAwLCB0aGlzLmJnLmgpO1xuXG4gIC8vIGRyYXcgaXRcbiAgdmFyIHNpemUgPSBtYXgodGhpcy5jYW52YXMuaCwgdGhpcy5jYW52YXMudyk7XG4gIHRoaXMuY2FudmFzLmNvbnQudHJhbnNsYXRlKFxuICAgIHRoaXMuYmcueCArIHRoaXMuY2FtZXJhLnN4LFxuICAgIHRoaXMuYmcueSArIHRoaXMuY2FtZXJhLnN5XG4gICk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZmlsbFN0eWxlID0gdGhpcy5iZy5wYXR0ZXJuO1xuICB0aGlzLmNhbnZhcy5jb250LmZpbGxSZWN0KC1zaXplLCAtc2l6ZSwgc2l6ZSAqIDMsIHNpemUgKiAzKTtcbiAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoXG4gICAgLSh0aGlzLmJnLnggKyB0aGlzLmNhbWVyYS5zeCksXG4gICAgLSh0aGlzLmJnLnkgKyB0aGlzLmNhbWVyYS5zeSlcbiAgKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgQ2FtZXJhIFBvc2l0aW9uXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGNhbWVyYSBwb3NpdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfY2FtZXJhID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuY2FtZXJhID0ge307XG4gIHRoaXMuY2FtZXJhLnggPSByb3VuZCh0aGlzLm1hcC5mZy5jYW52LndpZHRoIC8gMik7XG4gIHRoaXMuY2FtZXJhLnkgPSByb3VuZCh0aGlzLm1hcC5mZy5jYW52LmhlaWdodCAvIDIpO1xuICB0aGlzLmNhbWVyYS5weCA9IHRoaXMuY2FtZXJhLng7XG4gIHRoaXMuY2FtZXJhLnB5ID0gdGhpcy5jYW1lcmEueTtcblxuICAvLyB3YXRjaGVyIGZvbGxvdyBwbGF5ZXJcbiAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93ID0gXCJsZWFkZXJcIjtcbiAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllciA9IFwiXCI7XG5cbiAgLy8gY2FtZXJhIHdlYXBvblxuICB0aGlzLmNhbWVyYV93ZWFwb25fa2V5ID0gbnVsbDtcblxuICAvLyBjYW1lcmEgc2hha2Ugb24gaGl0XG4gIHRoaXMuY2FtZXJhLnNoYWtlX2ZyYW1lID0gbnVsbDtcbiAgdGhpcy5jYW1lcmEuc3ggPSAwO1xuICB0aGlzLmNhbWVyYS5zeSA9IDA7XG5cbiAgLy8gY2FtZXJhIGZvY3VzIGV2ZW50XG4gIHRoaXMuY2FtZXJhLmZvY3VzID0gbnVsbDtcbiAgdGhpcy5jYW1lcmEuZm9jdXNfdGltZSA9IDA7XG4gIHRoaXMuY2FtZXJhLmZ4ID0gMDtcbiAgdGhpcy5jYW1lcmEuZnkgPSAwO1xuXG4gIC8vIGN1cnNvclxuICB0aGlzLmN1cnNvciA9IHsgeDogMCwgeTogMCB9O1xuXG4gIC8vIHdlYXBvbiBmb2xsb3dpbmdcbiAgdGhpcy53ZWFwb25fZm9sbG93ID0gZmFsc2U7XG4gIHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9IFwiXCI7XG59O1xuXG4vKiBTd2l0Y2ggd2F0Y2hlciBjYW1lcmFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zd2l0Y2hfd2F0Y2hlcl9jYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF3YXRjaCkge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMucGxheWVycyk7XG4gIHZhciBpbmRleCA9IGtleXMuaW5kZXhPZih0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyKTtcbiAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgIGlmIChpbmRleCA9PT0ga2V5cy5sZW5ndGggLSAxKSB7XG4gICAgICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyID0gbnVsbDtcbiAgICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9IFwibGVhZGVyXCI7XG4gICAgICB0aGlzLnNldF9hbGVydChcIkZvbGxvd2luZyB0aGUgTGVhZGVyXCIsIFwiI2NjZmZjY1wiLCAxMDApO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyID0ga2V5c1tpbmRleCArIDFdO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyID0ga2V5c1swXTtcbiAgfVxuICBjb25zb2xlLmxvZyh0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyKTtcbiAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyXTtcbiAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93ID0gXCJwbGF5ZXJcIjtcbiAgdGhpcy5zZXRfYWxlcnQoXCJGb2xsb3dpbmcgXCIgKyBwbGF5ZXIubmFtZSwgXCIjZWVlZWVlXCIsIDEwMCk7XG59O1xuXG4vKiBDYWxjdWxhdGUgY3VycmVudCBjYW1lcmEgcG9zaXRpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fY2FtZXJhID0gZnVuY3Rpb24oKSB7XG4gIC8vIHN0b3AgZm9sbG93aW5nIGlmIGhpdFxuICBpZiAodGhpcy53ZWFwb25fZm9sbG93aW5nICYmIHRoaXMucGxheWVyICYmIHRoaXMucGxheWVyLmhpdCA+IDApIHtcbiAgICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSBcIlwiO1xuICB9XG5cbiAgLy8gc2V0IHByZXZpb3VzIHBvc2l0aW9uXG4gIHRoaXMuY2FtZXJhLnB4ID0gdGhpcy5jYW1lcmEueDtcbiAgdGhpcy5jYW1lcmEucHkgPSB0aGlzLmNhbWVyYS55O1xuXG4gIHZhciB4LCB5LCBtb3ZlO1xuXG4gIC8vIHNldCBmYWxsYmFjayBjYW1lcmFcbiAgdmFyIHdhdGNoX3BsYXllcl9pZCA9IDA7XG4gIGlmICh0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPT09IFwibGVhZGVyXCIpIHtcbiAgICB3YXRjaF9wbGF5ZXJfaWQgPSB0aGlzLmxlYWRlcjtcbiAgfSBlbHNlIGlmICh0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPT09IFwicGxheWVyXCIpIHtcbiAgICB3YXRjaF9wbGF5ZXJfaWQgPSB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyO1xuICB9XG5cbiAgLy8gZmluZCBvYmplY3QgdG8gZm9sbG93XG4gIHZhciBmb2xsb3dfb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbdGhpcy53ZWFwb25fZm9sbG93aW5nXTtcbiAgdmFyIHdhdGNoX29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgd2F0Y2hfcGxheWVyX2lkXTtcbiAgaWYgKGZvbGxvd19vYmopIHtcbiAgICB4ID0gZm9sbG93X29iai5keDtcbiAgICB5ID0gZm9sbG93X29iai5keTtcbiAgICBtb3ZlID0gMzA7XG4gIH0gZWxzZSBpZiAodGhpcy5wbGF5ZXJfb2JqKSB7XG4gICAgeCA9IHRoaXMucGxheWVyX29iai5keDtcbiAgICB5ID0gdGhpcy5wbGF5ZXJfb2JqLmR5O1xuICAgIG1vdmUgPSA2MDtcbiAgfSBlbHNlIGlmICh3YXRjaF9vYmopIHtcbiAgICB4ID0gd2F0Y2hfb2JqLmR4O1xuICAgIHkgPSB3YXRjaF9vYmouZHk7XG4gICAgbW92ZSA9IDMwO1xuICB9XG5cbiAgLy8gZ28gdG8gZm9jdXMgZXZlbnRcbiAgaWYgKFxuICAgIHRoaXMuY2FtZXJhLmZvY3VzICE9IG51bGwgJiZcbiAgICB0aGlzLmNhbWVyYS5mb2N1cyA8IHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAmJlxuICAgIHRoaXMuY2FtZXJhLmZvY3VzICsgdGhpcy5jYW1lcmEuZm9jdXNfdGltZSA+IHRoaXMuY29yZS5zdGF0ZS5mcmFtZVxuICApIHtcbiAgICB4ID0gdGhpcy5jYW1lcmEuZng7XG4gICAgeSA9IHRoaXMuY2FtZXJhLmZ5O1xuICAgIG1vdmUgPSAxMDA7XG5cbiAgICAvLyBmb2xsb3cgY3Vyc29yXG4gIH0gZWxzZSBpZiAodGhpcy5tb3VzZV9mb2xsb3cgfHwgIW1vdmUpIHtcbiAgICB4ID0gdGhpcy5jdXJzb3IueDtcbiAgICB5ID0gdGhpcy5jdXJzb3IueTtcbiAgICBtb3ZlID1cbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlKHRoaXMuY2FtZXJhLngsIHRoaXMuY2FtZXJhLnksIHgsIHkpICogMC4wNTtcbiAgfVxuXG4gIC8vIG1vdmUgdG93YXJkcyBuZXcgcG9zaXRpb25cbiAgaWYgKG1vdmUpIHtcbiAgICB2YXIgZHggPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV94KHRoaXMuY2FtZXJhLngsIHgpO1xuICAgIHZhciBkeSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kodGhpcy5jYW1lcmEueSwgeSk7XG4gICAgdmFyIGxpbWl0ID0gY2hlY2tfc3BlZWQoZHgsIGR5LCBtb3ZlKTtcbiAgICB0aGlzLmNhbWVyYS54ID0gdGhpcy5jb3JlLm1hcC5sb29wX3gocm91bmQodGhpcy5jYW1lcmEueCArIGxpbWl0LngpKTtcbiAgICB0aGlzLmNhbWVyYS55ID0gdGhpcy5jb3JlLm1hcC5sb29wX3kocm91bmQodGhpcy5jYW1lcmEueSArIGxpbWl0LnkpKTtcbiAgfVxuXG4gIC8vIGFkZCBzY3JlZW4gc2hha2VcbiAgdGhpcy5jYW1lcmEuc3ggPSAwO1xuICB0aGlzLmNhbWVyYS5zeSA9IDA7XG4gIHZhciBkaWZmID0gdGhpcy5jYW1lcmEuc2hha2VfZnJhbWVcbiAgICA/IHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAtIHRoaXMuY2FtZXJhLnNoYWtlX2ZyYW1lXG4gICAgOiAwO1xuICBpZiAoZGlmZiA8IDE1ICYmIGRpZmYgPiAwKSB7XG4gICAgdGhpcy5jYW1lcmEuc3ggPSBjb3MoKGRpZmYgLyAyLjUgLSAxLjUpICogcGkpICogdGhpcy5jYW1lcmEuc2hha2Vfc2l6ZTtcbiAgICB0aGlzLmNhbWVyYS5zeSA9IHNpbigoZGlmZiAvIDMgLSAxKSAqIHBpKSAqIHRoaXMuY2FtZXJhLnNoYWtlX3NpemU7XG4gIH1cblxuICAvLyBmaXggY3Vyc29yIGlucHV0XG4gIHRoaXMuY3Vyc29yX21hcCgpO1xufTtcblxuLyogVG9nZ2xlIHdlYXBvbiBmb2xsb3dpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS50b2dnbGVfd2VhcG9uX2ZvbGxvdyA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgdGhpcy53ZWFwb25fZm9sbG93ID0gIXRoaXMud2VhcG9uX2ZvbGxvdztcblxuICBpZiAobWVzc2FnZSkge1xuICAgIHZhciB0ZXh0ID0gXCJvblwiO1xuICAgIGlmICghdGhpcy53ZWFwb25fZm9sbG93KSB7XG4gICAgICB0ZXh0ID0gXCJvZmZcIjtcbiAgICAgIHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9IFwiXCI7XG4gICAgfVxuICAgIHRleHQgPSBcIkZvbGxvdyB3ZWFwb25zIFwiICsgdGV4dDtcbiAgICB0aGlzLnNldF9hbGVydCh0ZXh0LCBcIiNlZWVcIik7XG4gIH1cbn07XG5cbi8qIFRvZ2dsZSBtb3VzZSBmb2xsb3dpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS50b2dnbGVfbW91c2VfZm9sbG93ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMubW91c2VfZm9sbG93ID0gIXRoaXMubW91c2VfZm9sbG93O1xuICB2YXIgdGV4dCA9IHRoaXMubW91c2VfZm9sbG93ID8gXCJvblwiIDogXCJvZmZcIjtcbiAgdGV4dCA9IFwiRnJlZSBjYW0gXCIgKyB0ZXh0O1xuICB0aGlzLnNldF9hbGVydCh0ZXh0LCBcIiNlZWVcIik7XG59O1xuXG5nYW1lLnByb3RvdHlwZS5jYW5jZWxfbW91c2VfZm9sbG93ID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLm1vdXNlX2ZvbGxvdykge1xuICAgIHRoaXMudG9nZ2xlX21vdXNlX2ZvbGxvdygpO1xuICB9XG59O1xuXG4vKiBDYWxjdWxhdGUgY3Vyc29yIHBvc2l0aW9uIG9uIG1hcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmN1cnNvcl9tYXAgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNjYWxlX3ggPSB0aGlzLmNhbnZhcy5jYW52Lm9mZnNldFdpZHRoIC8gdGhpcy5jYW52YXMudztcbiAgdmFyIHNjYWxlX3kgPSB0aGlzLmNhbnZhcy5jYW52Lm9mZnNldEhlaWdodCAvIHRoaXMuY2FudmFzLmg7XG4gIHZhciB4MSA9XG4gICAgdGhpcy5jYW1lcmEueCArXG4gICAgcm91bmQoKHRoaXMuaW5wdXQuY3Vyc29yLnggLSByb3VuZChpbm5lcldpZHRoIC8gMikpICogc2NhbGVfeCk7XG4gIHZhciB5MSA9XG4gICAgdGhpcy5jYW1lcmEueSArXG4gICAgcm91bmQoKHRoaXMuaW5wdXQuY3Vyc29yLnkgLSByb3VuZChpbm5lckhlaWdodCAvIDIpKSAqIHNjYWxlX3kpO1xuICB0aGlzLmN1cnNvci54ID0gdGhpcy5jb3JlLm1hcC5sb29wX3gocm91bmQoeDEpKTtcbiAgdGhpcy5jdXJzb3IueSA9IHRoaXMuY29yZS5tYXAubG9vcF95KHJvdW5kKHkxKSk7XG59O1xuXG4vKiBTY3JlZW4gcG9zaXRpb24gb2YgYSBjby1vcmRpbmF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNjcmVlbl9wb3NpdGlvbiA9IGZ1bmN0aW9uKHgsIHksIHNpemUpIHtcbiAgdmFyIHgxID1cbiAgICAgIHRoaXMuY2FudmFzLmN4ICtcbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3godGhpcy5jYW1lcmEueCAtIHRoaXMuY2FtZXJhLnN4LCB4KSxcbiAgICB5MSA9XG4gICAgICB0aGlzLmNhbnZhcy5jeSArXG4gICAgICB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV95KHRoaXMuY2FtZXJhLnkgLSB0aGlzLmNhbWVyYS5zeSwgeSksXG4gICAgb25fc2NyZWVuID1cbiAgICAgIHgxID4gLXNpemUgJiZcbiAgICAgIHgxIDwgdGhpcy5jYW52YXMudyArIHNpemUgJiZcbiAgICAgIHkxID4gLXNpemUgJiZcbiAgICAgIHkxIDwgdGhpcy5jYW52YXMuaCArIHNpemU7XG5cbiAgcmV0dXJuIHtcbiAgICB4OiB4MSxcbiAgICB5OiB5MSxcbiAgICBvbl9zY3JlZW46IG9uX3NjcmVlblxuICB9O1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBNYWluIENhbnZhc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBjYW52YXNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfY2FudmFzID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldCB1cCBtYWluIGNhbnZhcyBkaW1lbnNpb25zIGFuZCBwb3NpdGlvblxuICB2YXIgZCA9IHNlbGVjdChcInByb2plY3RhbnRzXCIpO1xuICB0aGlzLmNhbnZhcyA9IHt9O1xuXG4gIC8vIGxpbWl0IGdhbWUgc2l6ZVxuICB0aGlzLmNhbnZhcy53ID0gZC5vZmZzZXRXaWR0aDtcbiAgdGhpcy5jYW52YXMuaCA9IGQub2Zmc2V0SGVpZ2h0O1xuICBpZiAodGhpcy5jYW52YXMuaCA8IDgwMCkge1xuICAgIHRoaXMuY2FudmFzLncgPSByb3VuZCh0aGlzLmNhbnZhcy53ICogKDgwMCAvIHRoaXMuY2FudmFzLmgpKTtcbiAgICB0aGlzLmNhbnZhcy5oID0gcm91bmQodGhpcy5jYW52YXMuaCAqICg4MDAgLyB0aGlzLmNhbnZhcy5oKSk7XG4gIH1cbiAgaWYgKHRoaXMuY2FudmFzLmggPiAxMDAwKSB7XG4gICAgdGhpcy5jYW52YXMudyA9IHJvdW5kKHRoaXMuY2FudmFzLncgKiAoMTAwMCAvIHRoaXMuY2FudmFzLmgpKTtcbiAgICB0aGlzLmNhbnZhcy5oID0gcm91bmQodGhpcy5jYW52YXMuaCAqICgxMDAwIC8gdGhpcy5jYW52YXMuaCkpO1xuICB9XG4gIHRoaXMuY2FudmFzLmN4ID0gcm91bmQodGhpcy5jYW52YXMudyAvIDIpO1xuICB0aGlzLmNhbnZhcy5jeSA9IHJvdW5kKHRoaXMuY2FudmFzLmggLyAyKTtcblxuICAvLyBpbml0aWFsaXNlIG1haW4gY2FudmFzXG4gIHRoaXMuY2FudmFzLmNhbnYgPSBlbGVtZW50KHsgdHlwZTogXCJjYW52YXNcIiB9KTtcbiAgdGhpcy5jYW52YXMuY2Fudi5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcbiAgdGhpcy5jYW52YXMuY29udCA9IHRoaXMuY2FudmFzLmNhbnYuZ2V0Q29udGV4dChcIjJkXCIpO1xuICB0aGlzLmNhbnZhcy5jYW52LndpZHRoID0gdGhpcy5jYW52YXMudztcbiAgdGhpcy5jYW52YXMuY2Fudi5oZWlnaHQgPSB0aGlzLmNhbnZhcy5oO1xuXG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5jYW52YXMuY2Fudik7XG59O1xuXG4vKiBGcmFtZSByZW5kZXJpbmdcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9jYW52YXMgPSBmdW5jdGlvbigpIHtcbiAgLy8gY2xlYXIgdGhlIGNhbnZhc1xuICB0aGlzLmNhbnZhcy5jb250LmNsZWFyUmVjdCgwLCAwLCB0aGlzLncsIHRoaXMuaCk7XG5cbiAgLy8gZG8gdGhlIGRyYXdpbmdcbiAgdGhpcy5kcmF3X2JhY2tncm91bmQoKTtcbiAgdGhpcy5kcmF3X21hcCgpO1xuICB0aGlzLmRyYXdfc3ByaXRlcygpO1xuICB0aGlzLmRyYXdfbGFiZWxzKCk7XG4gIHRoaXMuZHJhd19tZXNzYWdlcygpO1xuXG4gIC8vIGNsZWFyIHNwcml0ZXNcbiAgdGhpcy5zcHJpdGVzID0gW107XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIE9iamVjdCBMYWJlbHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBNYW5hZ2UgbGFiZWxzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2xhYmVscyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjcmVhdGUgbGFiZWxzXG4gIGZvciAoa2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKG9iai5jLmxhYmVscyAmJiAhdGhpcy5sYWJlbHNba2V5XSkge1xuICAgICAgdGhpcy5sYWJlbHNba2V5XSA9IHt9O1xuICAgICAgZm9yICh0eXBlIGluIG9iai5jLmxhYmVscykge1xuICAgICAgICBpZiAob2JqLmMubGFiZWxzW3R5cGVdKSB7XG4gICAgICAgICAgdGhpcy5jcmVhdGVfbGFiZWwodGhpcy5sYWJlbHNba2V5XSwgdHlwZSwga2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHJ1biB0aHJvdWdoIGxhYmVsc1xuICBmb3IgKGtleSBpbiB0aGlzLmxhYmVscykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmICghb2JqKSB7XG4gICAgICBkZWxldGUgdGhpcy5sYWJlbHNba2V5XTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBmb3IgKHR5cGUgaW4gdGhpcy5sYWJlbHNba2V5XSkge1xuICAgICAgdGhpcy5zZXRfbGFiZWwodGhpcy5sYWJlbHNba2V5XVt0eXBlXSwgb2JqKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIENyZWF0ZSBsYWJlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV9sYWJlbCA9IGZ1bmN0aW9uKHJlZiwgdHlwZSwga2V5KSB7XG4gIC8vIGNoZWNrIGhlYWx0aCBpcyBhY3RpdmVcbiAgaWYgKHR5cGUgPT09IFwicGxheWVyX2hlYWx0aFwiICYmICF0aGlzLnNjaGVtZS5oZWFsdGgpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjcmVhdGUgYW5kIGFkZCB0byByZWYgb2JqZWN0XG4gIHZhciBjYW52ID0gZWxlbWVudCh7IHR5cGU6IFwiY2FudmFzXCIgfSk7XG4gIHZhciBjb250ID0gY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIHJlZlt0eXBlXSA9IHsgY2FudjogY2FudiwgY29udDogY29udCwgdGV4dDogXCJcIiwga2V5OiBrZXksIHR5cGU6IHR5cGUgfTtcbn07XG5cbi8qIFNldCBsYWJlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9sYWJlbCA9IGZ1bmN0aW9uKGxhYmVsLCBvYmopIHtcbiAgLy8gcG9zaXRpb25cbiAgaWYgKGxhYmVsLnR5cGUgPT09IFwicG9zaXRpb25cIikge1xuICAgIHRoaXMuc2V0X2xhYmVsX3RleHQobGFiZWwsIG9iai54ICsgXCIgfCBcIiArIG9iai55KTtcbiAgfVxuXG4gIC8vIHBsYXllciBuYW1lXG4gIGVsc2UgaWYgKGxhYmVsLnR5cGUgPT09IFwicGxheWVyX25hbWVcIikge1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gICAgaWYgKHBsYXllcikge1xuICAgICAgdGhpcy5zZXRfbGFiZWxfdGV4dChsYWJlbCwgcGxheWVyLm5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgdGhpcy5sYWJlbHNbbGFiZWwua2V5XVtsYWJlbC50eXBlXTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICAvLyBoZWFsdGggYmFyXG4gIGVsc2UgaWYgKGxhYmVsLnR5cGUgPT09IFwicGxheWVyX2hlYWx0aFwiKSB7XG4gICAgdGhpcy5zZXRfbGFiZWxfaGVhbHRoKGxhYmVsLCBvYmoucGxheWVyX2lkKTtcbiAgfVxuXG4gIC8vIHRpbWVvdXRcbiAgZWxzZSBpZiAobGFiZWwudHlwZSA9PT0gXCJ0aW1lb3V0XCIpIHtcbiAgICB0aGlzLnNldF9sYWJlbF90ZXh0KFxuICAgICAgbGFiZWwsXG4gICAgICBjZWlsKChvYmouYy50aW1lb3V0IC0gKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAtIG9iai5mcmFtZSkpIC8gMjQpXG4gICAgKTtcbiAgfVxufTtcblxuLyogU2V0IHRleHQgbGFiZWxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfbGFiZWxfdGV4dCA9IGZ1bmN0aW9uKGxhYmVsLCB0ZXh0KSB7XG4gIC8vIHByZXAgdGV4dFxuICB0ZXh0ID0gU3RyaW5nKHRleHQpO1xuICB0ZXh0ID0gc3RyX3NwYWNlKHRleHQpO1xuXG4gIC8vIGlmIHRoZXJlJ3Mgbm8gY2hhbmdlIHRvIHRleHRcbiAgaWYgKGxhYmVsLnRleHQgPT09IHRleHQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBkcmF3IHRleHRcbiAgbGFiZWwudyA9IGxhYmVsLmNvbnQubWVhc3VyZVRleHQodGV4dCkud2lkdGggKyA5O1xuICBsYWJlbC5oID0gMTg7XG4gIGxhYmVsLmNhbnYud2lkdGggPSBsYWJlbC53O1xuICBsYWJlbC5jYW52LmhlaWdodCA9IGxhYmVsLmg7XG4gIGxhYmVsLmNvbnQucmVzdG9yZSgpO1xuICBsYWJlbC5jb250LmNsZWFyUmVjdCgwLCAwLCBsYWJlbC5jYW52LndpZHRoLCBsYWJlbC5jYW52LmhlaWdodCk7XG4gIGxhYmVsLmNvbnQuZm9udCA9IFwiMTJweCAnT3JiaXRyb24nXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFN0eWxlID0gXCIjMDAwXCI7XG4gIGxhYmVsLmNvbnQuZmlsdGVyID0gXCJkcm9wLXNoYWRvdygwIDJweCA0cHggIzAwMClcIjtcbiAgbGFiZWwuY29udC5maWxsVGV4dCh0ZXh0LCA0LCAxNCArIDAuNSk7XG4gIGxhYmVsLmNvbnQuZmlsbFN0eWxlID0gXCIjZGRkXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFRleHQodGV4dCwgNCwgMTIgKyAwLjUpO1xuICBsYWJlbC5jb250LnNhdmUoKTtcbn07XG5cbi8qIFNldCBoZWFsdGggbGFiZWxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfbGFiZWxfaGVhbHRoID0gZnVuY3Rpb24obGFiZWwsIHBsYXllcl9pZCkge1xuICBpZiAoIXRoaXMuc2NoZW1lLmhlYWx0aCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIGRlbGV0ZSB0aGlzLmxhYmVsc1tsYWJlbC5rZXldW2xhYmVsLnR5cGVdO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGFyZSB3ZSBkb2luZyBhbnl0aGluZyBhdCBhbGxcbiAgdmFyIGxldmVsID0gdGhpcy5zY2hlbWUubGV2ZWxzLmhlYWx0aFtwbGF5ZXIubGV2ZWxdO1xuICBpZiAoIWxldmVsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaXMgaXQgdGhlIHNhbWVcbiAgdmFyIHRleHQgPSBwbGF5ZXIuaGVhbHRoICsgXCIgLyBcIiArIGxldmVsO1xuICBpZiAodGV4dCA9PT0gbGFiZWwudGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuICBsYWJlbC50ZXh0ID0gdGV4dDtcblxuICAvLyBkcmF3IGxhYmVsXG4gIGxhYmVsLncgPSByb3VuZChsZXZlbCAvIDIpICsgNjtcbiAgbGFiZWwuaCA9IDg7XG4gIGxhYmVsLmNhbnYud2lkdGggPSBsYWJlbC53O1xuICBsYWJlbC5jYW52LmhlaWdodCA9IGxhYmVsLmg7XG4gIGxhYmVsLmNvbnQuZmlsbFN0eWxlID0gXCJyZ2JhKDI1NSwyNTUsMjU1LDAuMSlcIjtcbiAgbGFiZWwuY29udC5maWxsUmVjdCgwLCAwLCBsYWJlbC53LCBsYWJlbC5oKTtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcInJnYmEoMCwwLDAsMC44KVwiO1xuICBsYWJlbC5jb250LmZpbGxSZWN0KDEsIDEsIGxhYmVsLncgLSAyLCBsYWJlbC5oIC0gMik7XG4gIGxhYmVsLmNvbnQuZmlsbFN0eWxlID0gXCIjZTQxYTFhXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFJlY3QoMywgMywgcm91bmQocGxheWVyLmhlYWx0aCAvIDIpLCAyKTtcblxuICAvLyBhcmUgd2UgaGlkaW5nIGl0XG4gIGxhYmVsLmhpZGUgPSBwbGF5ZXIuZGVhZDtcbn07XG5cbi8qIERyYXcgbGFiZWxzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19sYWJlbHMgPSBmdW5jdGlvbigpIHtcbiAgLy8gZ28gdGhyb3VnaCBhbGwgbGFiZWxzXG4gIGZvciAoa2V5IGluIHRoaXMubGFiZWxzKSB7XG4gICAgLy8gaWdub3JlIGVtcHRpZXMgb3IgaGlkZGVuc1xuICAgIGlmICghdGhpcy5sYWJlbHNba2V5XSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHNjcmVlbiBwb3NpdGlvbiBvZiBvYmplY3RcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnNjcmVlbl9wb3NpdGlvbihvYmouZHgsIG9iai5keSwgNTApO1xuXG4gICAgLy8gaWdub3JlIHRvbyBmYXIgYXdheSBvYmplY3RzXG4gICAgaWYgKCFwb3NpdGlvbi5vbl9zY3JlZW4pIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdvIHRocm91Z2ggbGFiZWxzXG4gICAgdmFyIG4gPSAwO1xuICAgIGZvciAodHlwZSBpbiB0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICB2YXIgbGFiZWwgPSB0aGlzLmxhYmVsc1trZXldW3R5cGVdO1xuICAgICAgaWYgKGxhYmVsLmhpZGUpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB2YXIgeCA9IHJvdW5kKHBvc2l0aW9uLnggLSBsYWJlbC53IC8gMikgKyAwO1xuICAgICAgdmFyIHkgPVxuICAgICAgICByb3VuZChwb3NpdGlvbi55IC0gbGFiZWwuaCAvIDIgLSBvYmouYy5zaXplICogMiAtIChsYWJlbC5oIC0gNSkgKiBuKSAtXG4gICAgICAgIDIwO1xuICAgICAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UobGFiZWwuY2FudiwgeCwgeSk7XG4gICAgICBuKys7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIE1hcCBHcmFwaGljc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCB0aGUgbWFwIGNhbnZhc2VzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9tYXAgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5tYXAuZmcuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcImRlc3RpbmF0aW9uLW91dFwiO1xufTtcblxuLyogRHJhdyB0aGUgbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19tYXAgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHggPSB0aGlzLmNhbnZhcy5jeCAtIHRoaXMuY2FtZXJhLnggKyB0aGlzLmNhbWVyYS5zeDtcbiAgdmFyIHkgPSB0aGlzLmNhbnZhcy5jeSAtIHRoaXMuY2FtZXJhLnkgKyB0aGlzLmNhbWVyYS5zeTtcblxuICAvLyBkcmF3IGxheWVyc1xuICB0aGlzLmRyYXdfcmVwZWF0aW5nX2xheWVyKHRoaXMubWFwLmJnLmNhbnYsIHgsIHkpO1xuICB0aGlzLmRyYXdfcmVwZWF0aW5nX2xheWVyKHRoaXMubWFwLmZnLmNhbnYsIHgsIHkpO1xufTtcblxuLyogRHJhdyBsYXllciBjYW52YXMgcmVwZWF0aW5nIG9uIGFsbCBzaWRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfcmVwZWF0aW5nX2xheWVyID0gZnVuY3Rpb24oY2FudiwgeCwgeSkge1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4IC0gY2Fudi53aWR0aCwgeSAtIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCwgeSAtIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCArIGNhbnYud2lkdGgsIHkgLSBjYW52LmhlaWdodCk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggLSBjYW52LndpZHRoLCB5KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCArIGNhbnYud2lkdGgsIHkpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4IC0gY2Fudi53aWR0aCwgeSArIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCwgeSArIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCArIGNhbnYud2lkdGgsIHkgKyBjYW52LmhlaWdodCk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHgsIHkpO1xufTtcblxuLyogRGVzdHJveSBsYW5kIG9uIHRoZSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kZXN0cm95X2xhbmQgPSBmdW5jdGlvbih4LCB5LCBzaXplKSB7XG4gIHRoaXMubWFwLmZnLmNvbnQuYmVnaW5QYXRoKCk7XG4gIHRoaXMubWFwLmZnLmNvbnQuYXJjKHgsIHksIHNpemUsIDAsIDIgKiBwaSk7XG4gIHRoaXMubWFwLmZnLmNvbnQuZmlsbCgpO1xufTtcblxuLyogR2V0IGEgcGllY2Ugb2YgbGFuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmdldF9sYW5kX2Jsb2NrID0gZnVuY3Rpb24oeCwgeSwgdywgaCkge1xuICB2YXIgY2FudiA9IGVsZW1lbnQoeyB0eXBlOiBcImNhbnZhc1wiIH0pO1xuICB2YXIgY29udCA9IGNhbnYuZ2V0Q29udGV4dChcIjJkXCIpO1xuICBjYW52LndpZHRoID0gdztcbiAgY2Fudi5oZWlnaHQgPSBoO1xuICBjb250LmRyYXdJbWFnZSh0aGlzLm1hcC5mZy5jYW52LCB4LCB5LCB3LCBoLCAwLCAwLCB3LCBoKTtcblxuICByZXR1cm4gY2Fudjtcbn07XG5cbi8qIERyYXcgcGllY2Ugb2YgbGFuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfbGFuZF9ibG9jayA9IGZ1bmN0aW9uKHgsIHksIGNhbnYpIHtcbiAgdGhpcy5tYXAuZmcuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcIm5vcm1hbFwiO1xuICB0aGlzLm1hcC5mZy5jb250LmRyYXdJbWFnZShjYW52LCB4LCB5KTtcbiAgdGhpcy5tYXAuZmcuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcImRlc3RpbmF0aW9uLW91dFwiO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBPYmplY3QgTWVzc2FnZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBEcmF3IHRoZSBtZXNzYWdlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfbWVzc2FnZXMgPSBmdW5jdGlvbigpIHtcbiAgLy8gZ28gdGhyb3VnaCBtZXNzYWdlc1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgbWVzc2FnZSA9IHRoaXMubWVzc2FnZXNbaV07XG5cbiAgICAvLyBpbmNyZW1lbnQgdGltZVxuICAgIG1lc3NhZ2UudGltZSsrO1xuICAgIGlmIChtZXNzYWdlLnRpbWUgPiA0MCkge1xuICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UoaSwgMSk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgc2NyZWVuIHBvc2l0aW9uIG9mIG1lc3NhZ2VcbiAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnNjcmVlbl9wb3NpdGlvbihtZXNzYWdlLngsIG1lc3NhZ2UueSwgNTApO1xuXG4gICAgLy8gaWdub3JlIHRvbyBmYXIgYXdheSBtZXNzYWdlc1xuICAgIGlmICghcG9zaXRpb24ub25fc2NyZWVuKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnbyB0aHJvdWdoIGxhYmVsc1xuICAgIHZhciB4ID0gcm91bmQocG9zaXRpb24ueCAtIG1lc3NhZ2UudyAvIDIpICsgMC41O1xuICAgIHZhciB5ID0gcm91bmQocG9zaXRpb24ueSAtIG1lc3NhZ2UuaCAvIDIpIC0gMzAuNSAtIG1lc3NhZ2UudGltZTtcblxuICAgIHRoaXMuY2FudmFzLmNvbnQuc2F2ZSgpO1xuICAgIHRoaXMuY2FudmFzLmNvbnQudHJhbnNsYXRlKDAsIDApO1xuICAgIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKG1lc3NhZ2UuY2FudiwgeCwgeSk7XG4gICAgdGhpcy5jYW52YXMuY29udC5yZXN0b3JlKCk7XG4gIH1cbn07XG5cbi8qIExvb2sgZm9yIGNoYW5nZXMgaW4gaGVhbHRoXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3JlYXRlX21lc3NhZ2UgPSBmdW5jdGlvbihvYmosIGNvbCwgdGV4dCwgc2l6ZSwgeV9vZmZzZXQpIHtcbiAgLy8gc2V0IHVwIGNhbnZhc1xuICB2YXIgbWVzc2FnZSA9IHt9O1xuICBtZXNzYWdlLmNhbnYgPSBlbGVtZW50KHsgdHlwZTogXCJjYW52YXNcIiB9KTtcbiAgbWVzc2FnZS5jb250ID0gbWVzc2FnZS5jYW52LmdldENvbnRleHQoXCIyZFwiKTtcblxuICAvLyBkcmF3IHRleHRcbiAgdGV4dCA9IHN0cl9zcGFjZSh0ZXh0KTtcbiAgbWVzc2FnZS5jb250LmZvbnQgPSBzaXplICsgXCJweCBPcmJpdHJvblwiO1xuICBtZXNzYWdlLncgPSByb3VuZChtZXNzYWdlLmNvbnQubWVhc3VyZVRleHQodGV4dCkud2lkdGgpICsgODtcbiAgbWVzc2FnZS5oID0gc2l6ZSArIDQ7XG4gIG1lc3NhZ2UuY2Fudi53aWR0aCA9IG1lc3NhZ2UudztcbiAgbWVzc2FnZS5jYW52LmhlaWdodCA9IG1lc3NhZ2UuaDtcbiAgbWVzc2FnZS5jb250LmZvbnQgPSBzaXplICsgXCJweCBPcmJpdHJvblwiO1xuICAvLyBtZXNzYWdlLmNvbnQuZmlsbFN0eWxlID0gXCIjMDAwXCI7XG4gIC8vIG1lc3NhZ2UuY29udC5maWxsVGV4dCh0ZXh0LCAzLjUsIHNpemUgKyAwLjUpO1xuICBtZXNzYWdlLmNvbnQuZmlsbFN0eWxlID0gY29sO1xuICBtZXNzYWdlLmNvbnQuZmlsbFRleHQodGV4dCwgMy41LCBzaXplICsgMC41KTtcblxuICAvLyBzZXQgcG9zaXRpb25cbiAgdmFyIHlfb2Zmc2V0ID0geV9vZmZzZXQgfHwgMDtcbiAgbWVzc2FnZS54ID0gb2JqLng7XG4gIG1lc3NhZ2UueSA9IG9iai55ICsgeV9vZmZzZXQ7XG4gIG1lc3NhZ2UudGltZSA9IDA7XG5cbiAgLy8gYWRkIHRvIGFycmF5XG4gIHRoaXMubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgU3ByaXRlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBzcHJpdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19zcHJpdGVzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuc3ByaXRlcyA9IFtdO1xuXG4gIC8vIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKG9iai5oaWRlID4gMCkge1xuICAgICAgb2JqLmhpZGUtLTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIpIHtcbiAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICAgIGlmIChwbGF5ZXIpIHtcbiAgICAgICAgaWYgKHBsYXllci5oaXQgPiAwKSB7XG4gICAgICAgICAgdGhpcy5kcmF3X3BsYXllcl9oaXRfc3ByaXRlcyhvYmosIHBsYXllci5oaXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZHJhd19wbGF5ZXJfc3ByaXRlcyhvYmosIHBsYXllcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB2YXIgYXJncyA9IHtcbiAgICAgIGZyYW1lOiBvYmouZnJhbWUsXG4gICAgICB0eXBlOiBvYmouc3ByaXRlX2tleSxcbiAgICAgIHg6IG9iai5keCxcbiAgICAgIHk6IG9iai5keSxcbiAgICAgIGFuZ2xlOiBvYmouZGlzcGxheV9hbmdsZSxcbiAgICAgIGFuaW1hdGU6IG9iai5hbmltYXRlLFxuICAgICAgZmxvYXQ6IG9iai5jLmFuaW1hdGlvbi5haXJfZmxvYXQsXG4gICAgICByZXBlYXQ6IHRydWVcbiAgICB9O1xuICAgIHRoaXMuc3ByaXRlcy51bnNoaWZ0KGFyZ3MpO1xuICB9XG5cbiAgLy8gZXhwbG9zaW9uc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5leHBsb3Npb25zKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuZXhwbG9zaW9uc1trZXldO1xuICAgIHZhciBhcmdzID0ge1xuICAgICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICAgIHR5cGU6IG9iai5zcHJpdGUsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgYW5pbWF0ZTogdHJ1ZVxuICAgIH07XG4gICAgdGhpcy5zcHJpdGVzLnB1c2goYXJncyk7XG4gIH1cblxuICAvLyBkZWNvcmF0aW9uc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5kZWNvcmF0aW9ucykge1xuICAgIHZhciBvYmogPSB0aGlzLmRlY29yYXRpb25zW2tleV07XG4gICAgdmFyIGFyZ3MgPSB7XG4gICAgICBmcmFtZTogb2JqLmZyYW1lLFxuICAgICAgdHlwZTogb2JqLnNwcml0ZSxcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBhbmdsZTogb2JqLmFuZ2xlLFxuICAgICAgYW5pbWF0ZTogdHJ1ZSxcbiAgICAgIHJlcGVhdDogb2JqLnJlcGVhdFxuICAgIH07XG4gICAgdGhpcy5zcHJpdGVzLnVuc2hpZnQoYXJncyk7XG4gIH1cblxuICAvLyBnZXQgYXJyb3dzXG4gIHRoaXMucnVuX2Fycm93cygpO1xuXG4gIC8vIGRyYXcgdGhlbVxuICB0aGlzLmRyYXdfc3ByaXRlc19jYW52KCk7XG59O1xuXG4vKiBQbGF5ZXIgc3ByaXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfcGxheWVyX3Nwcml0ZXMgPSBmdW5jdGlvbihvYmosIHBsYXllcikge1xuICB2YXIgdyA9XG4gICAgdGhpcy5wbGF5ZXJfaWQgPT09IG9iai5wbGF5ZXJfaWQgPyB0aGlzLmN1cnJlbnRfd2VhcG9uIDogcGxheWVyLndlYXBvbjtcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW3ddO1xuXG4gIC8vIGJvZHlcbiAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgIGZyYW1lOiBvYmouZnJhbWUsXG4gICAgdHlwZTogb2JqLnNwcml0ZV9rZXksXG4gICAgeDogb2JqLmR4LFxuICAgIHk6IG9iai5keSxcbiAgICBhbmdsZTogb2JqLmRpc3BsYXlfYW5nbGUsXG4gICAgYW5pbWF0ZTogb2JqLmFuaW1hdGUsXG4gICAgcmVwZWF0OiB0cnVlXG4gIH0pO1xuXG4gIC8vIGdldCBoZWFkIGRpcmVjdGlvbiBhbmQgYW5nbGVcbiAgdmFyIGhlYWRfZGlyID0gb2JqLmRpcmVjdGlvbjtcbiAgaWYgKG9iai5ncm91bmRlZCkge1xuICAgIHZhciBkaWZmID0gbl9kaWZmKFxuICAgICAgb2JqLmJhcnJlbF9hbmdsZSxcbiAgICAgIGFuZ2xlX2FkZChvYmouZGlzcGxheV9hbmdsZSwgOTApLFxuICAgICAgMCxcbiAgICAgIDM2MFxuICAgICk7XG4gICAgaGVhZF9kaXIgPSBkaWZmID49IC0xODAgJiYgZGlmZiA8IDAgPyBcInJpZ2h0XCIgOiBcImxlZnRcIjtcbiAgfVxuICB2YXIgaGVhZF9hbmdsZSA9XG4gICAgaGVhZF9kaXIgPT09IFwicmlnaHRcIiA/IGFuZ2xlX2FkZChvYmouYmFycmVsX2FuZ2xlLCAxODApIDogb2JqLmJhcnJlbF9hbmdsZTtcblxuICAvLyB3ZWFwb25zXG4gIHZhciB3ZWFwb25fc3ByaXRlID0gXCJcIjtcbiAgaWYgKHdlYXBvbiAmJiB3ZWFwb24uc3ByaXRlKSB7XG4gICAgdmFyIHdlYXBvbl9zcHJpdGUgPSB3ZWFwb24uc3ByaXRlO1xuICAgIHZhciB3ZWFwb25fZnJhbWUgPSAwO1xuICAgIHZhciB0aHJvd2luZyA9IHdlYXBvbi5zcHJpdGUgPT09IFwidGhyb3dcIjtcblxuICAgIC8vIGp1c3QgZmlyZWQgc3ByaXRlc1xuICAgIGlmIChvYmouZmlyZV9zcHJpdGVfY291bnQpIHtcbiAgICAgIHdlYXBvbl9zcHJpdGUgPSB3ZWFwb24uZmlyZV9zcHJpdGU7XG4gICAgICB3ZWFwb25fZnJhbWUgPSBvYmouZmlyZV9zcHJpdGVfZnJhbWU7XG4gICAgICB0aHJvd2luZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGFkZCB0aGUgd2VhcG9uIHNwcml0ZVxuICAgIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiYW50LXdlYXBvbi1cIiArIHdlYXBvbl9zcHJpdGUgKyBcIi1cIiArIGhlYWRfZGlyLFxuICAgICAgeDogdGhpcy5jb3JlLm1hcC5sb29wX3gob2JqLmR4KSxcbiAgICAgIHk6IHRoaXMuY29yZS5tYXAubG9vcF95KG9iai5keSksXG4gICAgICBmcmFtZTogd2VhcG9uX2ZyYW1lLFxuICAgICAgYW5pbWF0ZTogdHJ1ZSxcbiAgICAgIHJlcGVhdDogdHJ1ZSxcbiAgICAgIGFuZ2xlOiBoZWFkX2FuZ2xlXG4gICAgfSk7XG4gIH1cblxuICAvLyBoZWFkXG4gIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICB0eXBlOiBcImFudC1oZWFkLVwiICsgaGVhZF9kaXIsXG4gICAgeDogdGhpcy5jb3JlLm1hcC5sb29wX3gob2JqLmR4KSxcbiAgICB5OiB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkpLFxuICAgIGFuaW1hdGU6IHRydWUsXG4gICAgcmVwZWF0OiB0cnVlLFxuICAgIGFuZ2xlOiBoZWFkX2FuZ2xlXG4gIH0pO1xuXG4gIC8vIGFkZCBhIHRocm93IHdlYXBvblxuICBpZiAodGhyb3dpbmcpIHtcbiAgICB2YXIgdG9iaiA9IHRoaXMuYy5vYmplY3RzW3dlYXBvbi5vYmplY3RdO1xuICAgIHZhciB0c3ByaXRlID0gdG9iai5hbmltYXRpb24uc3ByaXRlO1xuICAgIHZhciB0b2ZmX3ggPSB4eV9zcGVlZChvYmouYmFycmVsX2FuZ2xlLCAtMTYpO1xuICAgIHZhciB0b2ZmX3kgPSB4eV9zcGVlZChhbmdsZV9hZGQoaGVhZF9hbmdsZSwgOTApLCAxNCk7XG4gICAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgICAgdHlwZTogdHNwcml0ZSxcbiAgICAgIHg6IHRoaXMuY29yZS5tYXAubG9vcF94KG9iai5keCArIHRvZmZfeC54ICsgdG9mZl95LngpLFxuICAgICAgeTogdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5ICsgdG9mZl94LnkgKyB0b2ZmX3kueSksXG4gICAgICBhbmltYXRlOiBmYWxzZSxcbiAgICAgIGFuZ2xlOiBhbmdsZV9hZGQob2JqLmJhcnJlbF9hbmdsZSwgOTApXG4gICAgfSk7XG4gIH1cblxuICAvLyAvLyBzZXQgY3Jvc3NoYWlyXG4gIC8vIGlmICh0aGlzLnBsYXllcl9pZCA9PT0gb2JqLnBsYXllcl9pZCkge1xuICAvLyBcdHZhciBvZmZ4ID0geHlfc3BlZWQoYW5nbGUsIDUwICsgd2VhcG9uLm9mZnNldF94KTtcbiAgLy8gXHR2YXIgb2ZmeSA9IHh5X3NwZWVkKG9mZnNldF9hbmdsZSwgNyk7XG4gIC8vIFx0dGhpcy5zcHJpdGVzLnB1c2goe1xuICAvLyBcdFx0dHlwZTogXCJjcm9zc2hhaXJcIixcbiAgLy8gXHRcdHg6IHJvdW5kKG9iai5keCArIG9mZngueCArIG9mZnkueCksXG4gIC8vIFx0XHR5OiByb3VuZChvYmouZHkgKyBvZmZ4LnkgKyBvZmZ5LnkpLFxuICAvLyBcdFx0YW5nbGU6IGFuZ2xlX2FkZCh0aGlzLmNyb3NzaGFpciwgMTgwKVxuICAvLyBcdH0pO1xuICAvLyB9XG59O1xuXG4vKiBQbGF5ZXIgaGl0IHNwcml0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X3BsYXllcl9oaXRfc3ByaXRlcyA9IGZ1bmN0aW9uKG9iaiwgaGl0KSB7XG4gIC8vIGJvZHlcbiAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgIGZyYW1lOiBvYmouZnJhbWUsXG4gICAgdHlwZTogaGl0IDwgMTUgPyBcImFudC1ib2R5LWFpci1sZWZ0XCIgOiBcImFudC1ib2R5LWhpdFwiLFxuICAgIHg6IG9iai5keCxcbiAgICB5OiBvYmouZHksXG4gICAgYW5nbGU6IG9iai5kaXNwbGF5X2FuZ2xlLFxuICAgIGFuaW1hdGU6IG9iai5hbmltYXRlLFxuICAgIHJlcGVhdDogdHJ1ZVxuICB9KTtcblxuICAvLyBoZWFkXG4gIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICB0eXBlOiBoaXQgPCAxNSA/IFwiYW50LWhlYWQtbGVmdFwiIDogXCJhbnQtaGVhZC1oaXRcIixcbiAgICB4OiB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHgpLFxuICAgIHk6IHRoaXMuY29yZS5tYXAubG9vcF95KG9iai5keSksXG4gICAgYW5pbWF0ZTogdHJ1ZSxcbiAgICByZXBlYXQ6IHRydWUsXG4gICAgYW5nbGU6IG9iai5kaXNwbGF5X2FuZ2xlXG4gIH0pO1xufTtcblxuLyogRHJhdyBzcHJpdGVzIG9uIHRoZSBjYW52YXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X3Nwcml0ZXNfY2FudiA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3ByaXRlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcHJpdGUgPSB0aGlzLnNwcml0ZXNbaV07XG5cbiAgICAvLyBnZXQgcG9zaXRpb24gb24gc2NyZWVuXG4gICAgdmFyIHNjcmVlbl9wb3NpdGlvbiA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKHNwcml0ZS54LCBzcHJpdGUueSwgNDgpO1xuICAgIGlmICghc2NyZWVuX3Bvc2l0aW9uLm9uX3NjcmVlbikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHNwcml0ZSBrZXlcbiAgICB2YXIgc3ByaXRlX2tleSA9IHNwcml0ZS50eXBlO1xuICAgIHZhciBhbmltYXRpb24gPSB0aGlzLmMuYW5pbWF0aW9uc1tzcHJpdGVfa2V5XTtcbiAgICBpZiAoYW5pbWF0aW9uKSB7XG4gICAgICBzcHJpdGVfa2V5ID0gYW5pbWF0aW9uWzBdO1xuICAgICAgaWYgKHNwcml0ZS5hbmltYXRlKSB7XG4gICAgICAgIHZhciBmcmFtZSA9IHNwcml0ZS5mcmFtZSB8fCAwO1xuICAgICAgICBmcmFtZSA9IGZsb29yKCh0aGlzLmNvcmUuc3RhdGUuZnJhbWUgLSBmcmFtZSkgLyAyKTtcbiAgICAgICAgaWYgKHNwcml0ZS5yZXBlYXQpIHtcbiAgICAgICAgICBmcmFtZSA9IGZyYW1lICUgYW5pbWF0aW9uLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBzcHJpdGVfa2V5ID0gYW5pbWF0aW9uW2ZyYW1lXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBnZXQgc3ByaXRlIHJlZmVyZW5jZSBwb3NpdGlvbnNcbiAgICB2YXIgc3ByaXRlX3JlZiA9IHRoaXMuYy5zcHJpdGVzW3Nwcml0ZV9rZXldO1xuICAgIGlmICghc3ByaXRlX3JlZikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ2V0IG5ldyBwb3NpdGlvbiB0byBkcmF3IG9uXG4gICAgdmFyIHNpemUgPSBzcHJpdGVfcmVmLnNpemU7XG4gICAgdmFyIHBvcyA9IC0oc2l6ZSAvIDIpO1xuXG4gICAgLy8gZmxvYXQgZWZmZWN0XG4gICAgdmFyIHlfYWRkID0gMDtcbiAgICBpZiAoc3ByaXRlLmZsb2F0KSB7XG4gICAgICB5X2FkZCA9IGNvcygodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC0gc3ByaXRlLmZyYW1lKSAvIDQpICogMjtcbiAgICB9XG5cbiAgICAvLyBkcmF3IGl0XG4gICAgdGhpcy5jYW52YXMuY29udC5zYXZlKCk7XG4gICAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoc2NyZWVuX3Bvc2l0aW9uLngsIHNjcmVlbl9wb3NpdGlvbi55ICsgeV9hZGQpO1xuICAgIGlmIChzcHJpdGUuYW5nbGUgIT09IDApIHtcbiAgICAgIHRoaXMuY2FudmFzLmNvbnQucm90YXRlKChzcHJpdGUuYW5nbGUgKiBNYXRoLlBJKSAvIDE4MCk7XG4gICAgfVxuICAgIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKFxuICAgICAgdGhpcy5pbWcuc3ByaXRlcyxcbiAgICAgIHNwcml0ZV9yZWYueCxcbiAgICAgIHNwcml0ZV9yZWYueSxcbiAgICAgIHNpemUsXG4gICAgICBzaXplLFxuICAgICAgcG9zLFxuICAgICAgcG9zLFxuICAgICAgc2l6ZSxcbiAgICAgIHNpemVcbiAgICApO1xuICAgIHRoaXMuY2FudmFzLmNvbnQudHJhbnNsYXRlKFxuICAgICAgLXNjcmVlbl9wb3NpdGlvbi54LFxuICAgICAgLShzY3JlZW5fcG9zaXRpb24ueSArIHlfYWRkKVxuICAgICk7XG4gICAgdGhpcy5jYW52YXMuY29udC5yZXN0b3JlKCk7XG4gIH1cbn07XG4iXX0=

var config = config || {};
config.animations = {
  "ant-body-hit": [
    "ant-body-hit-1",
    "ant-body-hit-2",
    "ant-body-hit-1",
    "ant-body-hit-3"
  ],
  "ant-body-still-left": ["ant-body-walk-left-1"],
  "ant-body-still-right": ["ant-body-walk-right-1"],
  "ant-body-walk-left": [
    "ant-body-walk-left-2",
    "ant-body-walk-left-3",
    "ant-body-walk-left-4",
    "ant-body-walk-left-5"
  ],
  "ant-body-walk-right": [
    "ant-body-walk-right-2",
    "ant-body-walk-right-3",
    "ant-body-walk-right-4",
    "ant-body-walk-right-5"
  ],
  "ant-head-left": [
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-2",
    "ant-head-left-3",
    "ant-head-left-2"
  ],
  "ant-head-right": [
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-2",
    "ant-head-right-3",
    "ant-head-right-2"
  ],
  "ant-head-hit": ["ant-head-hit-1", "ant-head-hit-2", "ant-head-hit-3"],
  "ant-weapon-bazooka-left": ["ant-weapon-bazooka-left"],
  "ant-weapon-bazooka-right": ["ant-weapon-bazooka-right"],
  "ant-weapon-laser-left": ["ant-weapon-laser-left"],
  "ant-weapon-laser-right": ["ant-weapon-laser-right"],
  "ant-weapon-throw-left": ["ant-weapon-throw-left-1"],
  "ant-weapon-throw-fire-left": [
    "ant-weapon-throw-left-2",
    "ant-weapon-throw-left-3",
    "ant-weapon-throw-left-4",
    "ant-weapon-throw-left-5",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1"
  ],
  "ant-weapon-throw-right": ["ant-weapon-throw-right-1"],
  "ant-weapon-throw-fire-right": [
    "ant-weapon-throw-right-2",
    "ant-weapon-throw-right-3",
    "ant-weapon-throw-right-4",
    "ant-weapon-throw-right-5",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1"
  ],
  "ant-weapon-dig-left": ["ant-weapon-dig-left-1"],
  "ant-weapon-dig-fire-left": [
    "ant-weapon-dig-left-2",
    "ant-weapon-dig-left-3",
    "ant-weapon-dig-left-4"
  ],
  "ant-weapon-dig-right": ["ant-weapon-dig-right-1"],
  "ant-weapon-dig-fire-right": [
    "ant-weapon-dig-right-2",
    "ant-weapon-dig-right-3",
    "ant-weapon-dig-right-4"
  ],
  "ant-ghost": [
    "ant-ghost-1",
    "ant-ghost-1",
    "ant-ghost-2",
    "ant-ghost-2",
    "ant-ghost-3",
    "ant-ghost-3",
    "ant-ghost-2",
    "ant-ghost-2"
  ],
  "bubble-blue": [
    "ball-blue-1",
    "ball-blue-2",
    "ball-blue-3",
    "ball-blue-4",
    "ball-blue-5"
  ],
  "explosion-l": [
    "explosion-l-1",
    "explosion-l-2",
    "explosion-l-3",
    "explosion-l-4",
    "explosion-l-5",
    "explosion-l-6",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion2-l": [
    "explosion2-l-1",
    "explosion2-l-2",
    "explosion2-l-3",
    "explosion2-l-4",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion-green-l": [
    "explosion-green-l-1",
    "explosion-green-l-2",
    "explosion-green-l-3",
    "explosion-green-l-4",
    "explosion-green-l-5",
    "explosion-green-l-6",
    "explosion-green-l-7",
    "explosion-green-l-8"
  ],
  "explosion-laser-blue": [
    "explosion-laser-blue-1",
    "explosion-laser-blue-2",
    "explosion-laser-blue-3",
    "explosion-laser-blue-4",
    "explosion-laser-blue-5"
  ],
  flame: ["flame-1", "flame-2", "flame-3", "flame-4", "flame-5"],
  "flame-large": [
    "flame-large-1",
    "flame-large-2",
    "flame-large-3",
    "flame-large-4",
    "flame-large-5",
    "flame-large-6"
  ],
  focus: [
    "focus-1",
    "focus-2",
    "focus-3",
    "focus-4",
    "focus-5",
    "focus-6",
    "focus-7",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8"
  ],
  "gem-green": [
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-2",
    "gem-green-3",
    "gem-green-4"
  ],
  "gem-blue": [
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-2",
    "gem-blue-3",
    "gem-blue-4"
  ],
  "gem-red": [
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-2",
    "gem-red-3",
    "gem-red-4"
  ],
  "gem-purple": [
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-2",
    "gem-purple-3",
    "gem-purple-4"
  ],
  "gem-silver": [
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-2",
    "gem-silver-3",
    "gem-silver-4"
  ],
  "grenade-armed": [
    "grenade-green",
    "grenade-red",
    "grenade-red",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green"
  ],
  "mine-active": [
    "mine-red",
    "mine-red",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey"
  ],
  "smoke-green": [
    "smoke-green-1",
    "smoke-green-2",
    "smoke-green-3",
    "smoke-green-4",
    "smoke-green-5",
    "smoke-green-6",
    "smoke-green-7",
    "smoke-green-8"
  ],
  teleport: [
    "teleport-1",
    "teleport-2",
    "teleport-3",
    "teleport-4",
    "teleport-5",
    "teleport-6",
    "teleport-7"
  ],
  vortex: [
    "vortex-1",
    "vortex-2",
    "vortex-3",
    "vortex-4",
    "vortex-5",
    "vortex-6",
    "vortex-7",
    "vortex-8",
    "vortex-10",
    "vortex-11"
  ]
};

var config = config || {};
config.mapgen = {
  land_type: [
    {
      edge: 1,
      bg: "dirt",
      fg: "rock",
      decorations: {
        "1": [
          {
            x: 432,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 468,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 504,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 540,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 576,
            y: 0,
            w: 36,
            h: 72
          }
        ],
        "2": [
          {
            x: 0,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 72,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 144,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 216,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 288,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 360,
            y: 0,
            w: 72,
            h: 72
          }
        ]
      }
    }
  ]
};

var config = config || {};
config.names = [
  "Dave Lister",
  "Ace Rimmer",
  "Queeg 500",
  "Abradolf Lincler",
  "Beardless Riker",
  "The Ant With No Name",
  "Al Capone",
  "The Queen",
  "Mickey Eyes"
];

var config = config || {};
config.objects = {
  default: {
    size: 1,
    weight: 0,
    bounce: 0.4,
    timeout: 0,
    damage: 30,
    knock: 1,
    spawn: false,
    player_lock: false,
    launch_distance: 2,
    destroy_ground: true,
    stop: 0,
    ignore_level_damage: false,
    events: {
      frame: "",
      ground: "",
      object: "",
      explosion: "",
      die: ""
    },
    object_events: {},
    speed: {
      max_gravity: 30,
      max: 40,
      move: 4,
      jump: 10
    },
    cluster: {
      circle: true,
      object: "grenade",
      speed: 2,
      count: 6
    },
    animation: {
      explosion: "explosion-l",
      sprite: "",
      air_spin: false,
      air_float: false,
      static_angle: false,
      ground: false
    },
    audio: {
      explosion: "explosion",
      bounce: "donk",
      hit: "",
      air: "",
      walk: "walk"
    },
    labels: {
      player_health: false,
      player_name: false,
      timeout: false
    },
    trails: {
      count: 0,
      speed: 0.6,
      offset_x: 0,
      offset_y: 0,
      timeout: 0,
      rotate: false,
      move: true,
      sprite: ""
    }
  },
  player: {
    size: 12,
    weight: 0.7,
    bounce: 0.7,
    events: {
      ground: "player_bounce",
      explosion: "hit_receive"
    },
    object_events: {
      crate: "collect",
      medpack: "collect",
      "gem-1": "collect",
      "gem-5": "collect",
      "gem-20": "collect",
      "gem-50": "collect",
      "gem-200": "collect",
      vortex: "collect"
    },
    animation: {
      sprite: "ant-body",
      air_spin: false,
      ground: false
    },
    audio: {
      bounce: "doink",
      explosion: "pop"
    },
    labels: {
      player_health: true,
      player_name: true
    }
  },
  player_missile: {
    size: 12,
    weight: 0.7,
    damage: 50,
    events: {
      ground: ["bounce_explode", "spawn_ghost"],
      explosion: ["bounce_explode", "spawn_ghost"]
    },
    object_events: {
      player: ["bounce_explode", "spawn_ghost"]
    },
    animation: {
      sprite: "ant-bomb",
      air_spin: true
    },
    labels: {
      player_name: true
    },
    trails: {
      count: 2,
      speed: 0.6,
      timeout: 10,
      sprite: "ball-red"
    }
  },
  player_ghost: {
    size: 12,
    weight: 0,
    damage: 1,
    knock: 0,
    events: {
      object: "hit_receive",
      explosion: "hit_receive"
    },
    object_events: {
      player: "hit_give"
    },
    speed: {
      max: 2.5,
      move: 0.3
    },
    animation: {
      sprite: "ant-ghost",
      air_float: true
    },
    labels: {
      player_name: true
    }
  },
  crate: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-weapon",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-blue"
    }
  },
  medpack: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-health",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-red"
    }
  },
  "gem-1": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-green",
      static_angle: true,
      air_float: true
    }
  },
  "gem-5": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-blue",
      static_angle: true,
      air_float: true
    }
  },
  "gem-20": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-red",
      static_angle: true,
      air_float: true
    }
  },
  "gem-50": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-purple",
      static_angle: true,
      air_float: true
    }
  },
  "gem-200": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-silver",
      static_angle: true,
      air_float: true
    }
  },
  vortex: {
    size: 22,
    animation: {
      sprite: "vortex"
    }
  },
  target: {
    size: 22,
    damage: 0,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion-laser-blue",
      sprite: "target",
      air_float: true
    },
    audio: {
      explosion: "pop",
      air: "none"
    }
  },
  nuclear: {
    size: 22,
    damage: 100,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    animation: {
      explosion: "explosion-green-l",
      sprite: "nuclear",
      air_float: true
    },
    audio: {
      explosion: "explosion_gas",
      air: "none"
    }
  },
  mine: {
    size: 58,
    damage: 80,
    events: {
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "mine",
      air_float: true
    }
  },
  "asteroid-small": {
    size: 15,
    weight: 1,
    damage: 40,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-small",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 10,
      sprite: "flame"
    }
  },
  "asteroid-large": {
    size: 34,
    weight: 1,
    damage: 80,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    cluster: {
      circle: true,
      object: "asteroid-small",
      speed: 16,
      count: 3
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-large",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 20,
      sprite: "flame"
    }
  },
  dig: {
    size: 2,
    weight: 0,
    damage: 16,
    timeout: 6,
    ignore_level_damage: true,
    events: {
      ground: ["destroy", "drag_player", "die"]
    }
  },
  punch: {
    size: 20,
    weight: 0,
    damage: 16,
    timeout: 8,
    player_lock: true,
    stop: 6,
    events: {
      ground: "slide"
    },
    object_events: {
      player: "hit_give"
    },
    animation: {
      sprite: "flame-large"
    },
    audio: {
      air: "fly",
      bounce: "doink",
      hit: "punch"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  laser: {
    size: 24,
    weight: 0,
    timeout: 20,
    damage: 30,
    destroy_ground: false,
    events: {
      ground: "die",
      object: "none",
      die: "none"
    },
    object_events: {
      player: ["explode", "die"],
      player_ghost: ["hit_give", "die"]
    },
    animation: {
      sprite: "laser-blue",
      explosion: "explosion-laser-blue"
    },
    audio: {
      explosion: "explosion_laser"
    },
    trails: {
      count: 1,
      speed: 0,
      timeout: 10,
      rotate: false,
      move: false,
      sprite: "bubble-blue"
    }
  },
  bazooka: {
    size: 6,
    weight: 0.7,
    timeout: 300,
    damage: 70,
    events: {
      ground: "die",
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "bazooka-shell"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  grenade: {
    size: 4,
    weight: 0.7,
    timeout: 72,
    damage: 50,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "explode"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "grenade-armed"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "countdown"
    },
    trails: {
      count: 1,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-green"
    }
  },
  pumpkin: {
    size: 10,
    weight: 1,
    timeout: 120,
    damage: 70,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "cluster"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "spooky"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      rotate: true,
      sprite: "bat"
    },
    cluster: {
      circle: false,
      object: "pumpkin_slice",
      speed: 15,
      count: 3
    }
  },
  pumpkin_slice: {
    size: 6,
    weight: 1,
    timeout: 200,
    damage: 30,
    events: {
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin-slice"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-orange"
    }
  },
  paingiver: {
    size: 20,
    weight: 1,
    damage: 50,
    cluster: {
      circle: false,
      object: "grenade",
      speed: 15,
      count: 3
    },
    events: {
      ground: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "rocket"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  }
};

// prep objects
config.object_refs = [];
for (key in config.objects) {
  config.object_refs.push(key);
  config.objects[key] = deepmerge(config.objects.default, config.objects[key], {
    arrayMerge: dont_merge
  });
}

var config = config || {};
config.sprites = {
  "ball-blue": {
    size: 48,
    x: 1120,
    y: 240
  },
  "ball-green": {
    size: 48,
    x: 1120,
    y: 288
  },
  "ball-orange": {
    size: 48,
    x: 1120,
    y: 336
  },
  "ball-red": {
    size: 48,
    x: 1120,
    y: 672
  },
  "ball-silver": {
    size: 48,
    x: 1120,
    y: 720
  },
  bat: {
    size: 48,
    x: 1120,
    y: 768
  },
  "flame-1": {
    size: 48,
    x: 1120,
    y: 432
  },
  "flame-2": {
    size: 48,
    x: 1120,
    y: 480
  },
  "flame-3": {
    size: 48,
    x: 1120,
    y: 528
  },
  "flame-4": {
    size: 48,
    x: 1120,
    y: 576
  },
  "flame-5": {
    size: 48,
    x: 1120,
    y: 624
  },
  "mine-grey": {
    size: 48,
    x: 1168,
    y: 240
  },
  "mine-red": {
    size: 48,
    x: 1168,
    y: 288
  },
  "pumpkin-slice": {
    size: 48,
    x: 1168,
    y: 384
  },
  pumpkin: {
    size: 48,
    x: 1168,
    y: 432
  },
  "star-blue": {
    size: 48,
    x: 1168,
    y: 576
  },
  "ant-body-air-left": {
    size: 48,
    x: 0,
    y: 1168
  },
  "ant-body-air-right": {
    size: 48,
    x: 576,
    y: 1056
  },
  "ant-body-hit-1": {
    size: 48,
    x: 1120,
    y: 0
  },
  "ant-body-hit-2": {
    size: 48,
    x: 1120,
    y: 48
  },
  "ant-body-hit-3": {
    size: 48,
    x: 1120,
    y: 96
  },
  "ant-body-superman-left": {
    size: 48,
    x: 1120,
    y: 144
  },
  "ant-body-superman-right": {
    size: 48,
    x: 1120,
    y: 192
  },
  "ant-body-walk-left-1": {
    size: 48,
    x: 1168,
    y: 528
  },
  "ant-body-walk-left-2": {
    size: 48,
    x: 1168,
    y: 624
  },
  "ant-body-walk-left-3": {
    size: 48,
    x: 1168,
    y: 1104
  },
  "ant-body-walk-left-4": {
    size: 48,
    x: 1168,
    y: 1056
  },
  "ant-body-walk-left-5": {
    size: 48,
    x: 1168,
    y: 1008
  },
  "ant-body-walk-right-1": {
    size: 48,
    x: 1168,
    y: 336
  },
  "ant-body-walk-right-2": {
    size: 48,
    x: 192,
    y: 1120
  },
  "ant-body-walk-right-3": {
    size: 48,
    x: 144,
    y: 1120
  },
  "ant-body-walk-right-4": {
    size: 48,
    x: 96,
    y: 1120
  },
  "ant-body-walk-right-5": {
    size: 48,
    x: 48,
    y: 1120
  },
  "ant-bomb": {
    size: 48,
    x: 0,
    y: 1120
  },
  "ant-ghost-1": {
    size: 64,
    x: 128,
    y: 1056
  },
  "ant-ghost-2": {
    size: 64,
    x: 64,
    y: 1056
  },
  "ant-ghost-3": {
    size: 64,
    x: 0,
    y: 1056
  },
  "ant-head-hit-1": {
    size: 64,
    x: 1056,
    y: 960
  },
  "ant-head-hit-2": {
    size: 64,
    x: 1056,
    y: 896
  },
  "ant-head-hit-3": {
    size: 64,
    x: 640,
    y: 960
  },
  "ant-head-left-1": {
    size: 64,
    x: 1056,
    y: 832
  },
  "ant-head-left-2": {
    size: 64,
    x: 1056,
    y: 768
  },
  "ant-head-left-3": {
    size: 64,
    x: 1056,
    y: 704
  },
  "ant-head-right-1": {
    size: 64,
    x: 1056,
    y: 640
  },
  "ant-head-right-2": {
    size: 64,
    x: 1056,
    y: 576
  },
  "ant-head-right-3": {
    size: 64,
    x: 1056,
    y: 512
  },
  "ant-weapon-bazooka-left": {
    size: 64,
    x: 1056,
    y: 448
  },
  "ant-weapon-bazooka-right": {
    size: 64,
    x: 576,
    y: 960
  },
  "ant-weapon-dig-left-1": {
    size: 64,
    x: 1056,
    y: 320
  },
  "ant-weapon-dig-left-2": {
    size: 64,
    x: 1056,
    y: 256
  },
  "ant-weapon-dig-left-3": {
    size: 64,
    x: 1056,
    y: 192
  },
  "ant-weapon-dig-left-4": {
    size: 64,
    x: 1056,
    y: 128
  },
  "ant-weapon-dig-right-1": {
    size: 64,
    x: 1056,
    y: 64
  },
  "ant-weapon-dig-right-2": {
    size: 64,
    x: 1056,
    y: 0
  },
  "ant-weapon-dig-right-3": {
    size: 64,
    x: 960,
    y: 960
  },
  "ant-weapon-dig-right-4": {
    size: 64,
    x: 896,
    y: 960
  },
  "ant-weapon-laser-left": {
    size: 64,
    x: 832,
    y: 960
  },
  "ant-weapon-laser-right": {
    size: 64,
    x: 768,
    y: 960
  },
  "ant-weapon-punch-left": {
    size: 64,
    x: 704,
    y: 960
  },
  "ant-weapon-punch-right": {
    size: 64,
    x: 1056,
    y: 384
  },
  "ant-weapon-throw-left-1": {
    size: 48,
    x: 624,
    y: 1056
  },
  "ant-weapon-throw-left-2": {
    size: 48,
    x: 528,
    y: 1056
  },
  "ant-weapon-throw-left-3": {
    size: 48,
    x: 480,
    y: 1056
  },
  "ant-weapon-throw-left-4": {
    size: 48,
    x: 432,
    y: 1056
  },
  "ant-weapon-throw-left-5": {
    size: 48,
    x: 384,
    y: 1056
  },
  "ant-weapon-throw-right-1": {
    size: 48,
    x: 336,
    y: 1056
  },
  "ant-weapon-throw-right-2": {
    size: 48,
    x: 288,
    y: 1056
  },
  "ant-weapon-throw-right-3": {
    size: 48,
    x: 240,
    y: 1056
  },
  "ant-weapon-throw-right-4": {
    size: 48,
    x: 192,
    y: 1056
  },
  "ant-weapon-throw-right-5": {
    size: 48,
    x: 1120,
    y: 1056
  },
  "armoury-dig": {
    size: 48,
    x: 1056,
    y: 1056
  },
  "armoury-extinguishe": {
    size: 48,
    x: 1008,
    y: 1056
  },
  "armoury-laser-blue": {
    size: 48,
    x: 672,
    y: 1056
  },
  "armoury-laser-red": {
    size: 48,
    x: 1120,
    y: 816
  },
  "armoury-punch": {
    size: 48,
    x: 720,
    y: 1056
  },
  "arrow-blue": {
    size: 48,
    x: 768,
    y: 1056
  },
  "arrow-green": {
    size: 48,
    x: 816,
    y: 1056
  },
  "arrow-grey": {
    size: 48,
    x: 864,
    y: 1056
  },
  "arrow-purple": {
    size: 48,
    x: 912,
    y: 1056
  },
  "arrow-red": {
    size: 48,
    x: 960,
    y: 1056
  },
  "asteroid-1": {
    size: 96,
    x: 480,
    y: 960
  },
  "asteroid-2": {
    size: 96,
    x: 384,
    y: 960
  },
  "ball-blue-1": {
    size: 24,
    x: 600,
    y: 1024
  },
  "ball-blue-2": {
    size: 24,
    x: 576,
    y: 1024
  },
  "ball-blue-3": {
    size: 24,
    x: 1024,
    y: 984
  },
  "ball-blue-4": {
    size: 24,
    x: 1024,
    y: 960
  },
  "ball-blue-5": {
    size: 24,
    x: 1080,
    y: 1024
  },
  "bazooka-shell": {
    size: 48,
    x: 1120,
    y: 864
  },
  "crate-health": {
    size: 48,
    x: 1120,
    y: 912
  },
  "crate-weapon": {
    size: 48,
    x: 1120,
    y: 960
  },
  crosshair: {
    size: 48,
    x: 1120,
    y: 1008
  },
  "explosion-green-l-1": {
    size: 192,
    x: 768,
    y: 576
  },
  "explosion-green-l-2": {
    size: 192,
    x: 768,
    y: 384
  },
  "explosion-green-l-3": {
    size: 192,
    x: 768,
    y: 192
  },
  "explosion-green-l-4": {
    size: 192,
    x: 768,
    y: 0
  },
  "explosion-green-l-5": {
    size: 192,
    x: 576,
    y: 576
  },
  "explosion-green-l-6": {
    size: 192,
    x: 384,
    y: 576
  },
  "explosion-green-l-7": {
    size: 192,
    x: 192,
    y: 576
  },
  "explosion-green-l-8": {
    size: 192,
    x: 0,
    y: 576
  },
  "explosion-l-1": {
    size: 192,
    x: 576,
    y: 384
  },
  "explosion-l-2": {
    size: 192,
    x: 192,
    y: 0
  },
  "explosion-l-3": {
    size: 192,
    x: 0,
    y: 0
  },
  "explosion-l-4": {
    size: 192,
    x: 576,
    y: 0
  },
  "explosion-l-5": {
    size: 192,
    x: 384,
    y: 384
  },
  "explosion-l-6": {
    size: 192,
    x: 192,
    y: 384
  },
  "explosion-l-7": {
    size: 192,
    x: 0,
    y: 384
  },
  "explosion-laser-blue-1": {
    size: 96,
    x: 864,
    y: 864
  },
  "explosion-laser-blue-2": {
    size: 96,
    x: 768,
    y: 864
  },
  "explosion-laser-blue-3": {
    size: 96,
    x: 672,
    y: 864
  },
  "explosion-laser-blue-4": {
    size: 96,
    x: 576,
    y: 864
  },
  "explosion-laser-blue-5": {
    size: 96,
    x: 480,
    y: 864
  },
  "explosion2-l-1": {
    size: 96,
    x: 384,
    y: 864
  },
  "explosion2-l-2": {
    size: 96,
    x: 288,
    y: 864
  },
  "explosion2-l-3": {
    size: 96,
    x: 192,
    y: 864
  },
  "explosion2-l-4": {
    size: 192,
    x: 384,
    y: 192
  },
  "explosion2-l-5": {
    size: 192,
    x: 384,
    y: 0
  },
  "explosion2-l-6": {
    size: 192,
    x: 192,
    y: 192
  },
  "explosion2-l-7": {
    size: 192,
    x: 0,
    y: 192
  },
  "explosion2-l-8": {
    size: 192,
    x: 576,
    y: 192
  },
  extinguisher: {
    size: 48,
    x: 1120,
    y: 384
  },
  "flame-large-1": {
    size: 96,
    x: 576,
    y: 768
  },
  "flame-large-2": {
    size: 96,
    x: 480,
    y: 768
  },
  "flame-large-3": {
    size: 96,
    x: 384,
    y: 768
  },
  "flame-large-4": {
    size: 96,
    x: 288,
    y: 768
  },
  "flame-large-5": {
    size: 96,
    x: 192,
    y: 768
  },
  "flame-large-6": {
    size: 96,
    x: 96,
    y: 768
  },
  "focus-1": {
    size: 96,
    x: 0,
    y: 768
  },
  "focus-2": {
    size: 96,
    x: 288,
    y: 960
  },
  "focus-3": {
    size: 96,
    x: 192,
    y: 960
  },
  "focus-4": {
    size: 96,
    x: 96,
    y: 960
  },
  "focus-5": {
    size: 96,
    x: 0,
    y: 960
  },
  "focus-6": {
    size: 96,
    x: 960,
    y: 864
  },
  "focus-7": {
    size: 96,
    x: 960,
    y: 768
  },
  "focus-8": {
    size: 96,
    x: 960,
    y: 672
  },
  "gem-blue-1": {
    size: 48,
    x: 240,
    y: 1120
  },
  "gem-blue-2": {
    size: 48,
    x: 288,
    y: 1120
  },
  "gem-blue-3": {
    size: 48,
    x: 336,
    y: 1120
  },
  "gem-blue-4": {
    size: 48,
    x: 384,
    y: 1120
  },
  "gem-green-1": {
    size: 48,
    x: 432,
    y: 1120
  },
  "gem-green-2": {
    size: 48,
    x: 480,
    y: 1120
  },
  "gem-green-3": {
    size: 48,
    x: 528,
    y: 1120
  },
  "gem-green-4": {
    size: 48,
    x: 576,
    y: 1120
  },
  "gem-purple-1": {
    size: 48,
    x: 624,
    y: 1120
  },
  "gem-purple-2": {
    size: 48,
    x: 672,
    y: 1120
  },
  "gem-purple-3": {
    size: 48,
    x: 720,
    y: 1120
  },
  "gem-purple-4": {
    size: 48,
    x: 768,
    y: 1120
  },
  "gem-red-1": {
    size: 48,
    x: 816,
    y: 1120
  },
  "gem-red-2": {
    size: 48,
    x: 864,
    y: 1120
  },
  "gem-red-3": {
    size: 48,
    x: 912,
    y: 1120
  },
  "gem-red-4": {
    size: 48,
    x: 960,
    y: 1120
  },
  "gem-silver-1": {
    size: 48,
    x: 1008,
    y: 1120
  },
  "gem-silver-2": {
    size: 48,
    x: 1056,
    y: 1120
  },
  "gem-silver-3": {
    size: 48,
    x: 1104,
    y: 1120
  },
  "gem-silver-4": {
    size: 48,
    x: 1168,
    y: 0
  },
  "grenade-green": {
    size: 48,
    x: 1168,
    y: 48
  },
  "grenade-red": {
    size: 48,
    x: 1168,
    y: 96
  },
  "laser-blue": {
    size: 48,
    x: 1168,
    y: 144
  },
  "laser-red": {
    size: 48,
    x: 1168,
    y: 192
  },
  nuclear: {
    size: 96,
    x: 960,
    y: 576
  },
  rocket: {
    size: 48,
    x: 1168,
    y: 480
  },
  smoke: {
    size: 24,
    x: 1056,
    y: 1024
  },
  target: {
    size: 48,
    x: 48,
    y: 1168
  },
  "teleport-1": {
    size: 48,
    x: 1168,
    y: 672
  },
  "teleport-2": {
    size: 48,
    x: 1168,
    y: 720
  },
  "teleport-3": {
    size: 48,
    x: 1168,
    y: 768
  },
  "teleport-4": {
    size: 48,
    x: 1168,
    y: 816
  },
  "teleport-5": {
    size: 48,
    x: 1168,
    y: 864
  },
  "teleport-6": {
    size: 48,
    x: 1168,
    y: 912
  },
  "teleport-7": {
    size: 48,
    x: 1168,
    y: 960
  },
  "vortex-1": {
    size: 96,
    x: 960,
    y: 480
  },
  "vortex-10": {
    size: 96,
    x: 960,
    y: 384
  },
  "vortex-11": {
    size: 96,
    x: 960,
    y: 288
  },
  "vortex-2": {
    size: 96,
    x: 960,
    y: 192
  },
  "vortex-3": {
    size: 96,
    x: 960,
    y: 96
  },
  "vortex-4": {
    size: 96,
    x: 960,
    y: 0
  },
  "vortex-5": {
    size: 96,
    x: 96,
    y: 864
  },
  "vortex-6": {
    size: 96,
    x: 0,
    y: 864
  },
  "vortex-7": {
    size: 96,
    x: 864,
    y: 768
  },
  "vortex-8": {
    size: 96,
    x: 768,
    y: 768
  },
  "vortex-9": {
    size: 96,
    x: 672,
    y: 768
  }
};

var config = config || {};
config.weapons = {
  default: {
    title: "",
    armoury_sprite: "",
    sprite: "",
    fire_audio: "",
    fire_sprite: "",
    fire_body_sprite: "",
    fire_angle_lock: false,
    auto_follow: false,
    require_walk: false,
    speed: 0,
    object: "",
    cooldown: 0,
    recoil: 0,
    inertia: 0
  },
  dig: {
    title: "Dig",
    armoury_sprite: "armoury-dig",
    sprite: "dig",
    fire_sprite: "dig-fire",
    fire_body_sprite: "walk",
    fire_angle_lock: true,
    speed: 3,
    object: "dig",
    cooldown: 10
  },
  phaser: {
    title: "Phaser",
    armoury_sprite: "armoury-laser-blue",
    sprite: "laser",
    fire_audio: "shoot_laser",
    speed: 30,
    object: "laser",
    cooldown: 6,
    recoil: 0.1,
    inertia: 0.5
  },
  bazookoid: {
    title: "Bazookoid",
    armoury_sprite: "bazooka-shell",
    sprite: "bazooka",
    fire_audio: "shoot",
    auto_follow: true,
    speed: 24,
    object: "bazooka",
    cooldown: 40,
    recoil: 0.2,
    inertia: 0.5
  },
  grenade: {
    title: "Grenade",
    armoury_sprite: "grenade-green",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 24,
    object: "grenade",
    cooldown: 30,
    recoil: 0,
    inertia: 0.5
  },
  punch: {
    title: "Fire Punch",
    armoury_sprite: "armoury-punch",
    sprite: "punch",
    fire_audio: "throw",
    fire_body_sprite: "superman",
    speed: 14,
    object: "punch",
    cooldown: 30,
    recoil: 0,
    inertia: 0.5
  },
  pumpkin: {
    title: "Pumpkin",
    armoury_sprite: "pumpkin",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 30,
    object: "pumpkin",
    cooldown: 48,
    recoil: 0,
    inertia: 0.5
  },
  paingiver: {
    title: "Paingiver 2000",
    armoury_sprite: "rocket",
    sprite: "bazooka",
    fire_audio: "shoot",
    speed: 24,
    object: "paingiver",
    cooldown: 10,
    recoil: 0.4,
    inertia: 0.5
  }
};

// prep weapons
for (key in config.weapons) {
  config.weapons[key] = deepmerge(config.weapons.default, config.weapons[key], {
    arrayMerge: dont_merge
  });
}

/* ========================================================================
    Actions
 ========================================================================== */

/* Perform action
	---------------------------------------- */

core.prototype.action = function(player_id, action) {
  var response = { success: false };
  var player = this.state.players[player_id];
  var obj = this.state.objects["player-" + player_id];
  if (!player || !action || !obj) {
    return response;
  }

  var locked_obj = this.state.objects[player.locked];

  // players can do stuff
  if (!player.dead && !locked_obj && player.hit === 0) {
    // run them
    if (action.action === "move") {
      response = this.action_move(response, player, obj, action);
    }
    if (action.action === "jump") {
      response = this.action_jump(response, player, obj, action);
    }
    if (action.action === "shoot") {
      response = this.action_shoot(response, player, obj, action);
    }
  }

  response.x = obj.x;
  response.y = obj.y;
  response.speed_x = obj.speed_x;
  response.speed_y = obj.speed_y;
  response.frame = this.state.frame;

  // return status
  return response;
};

/* Walking
	---------------------------------------- */

core.prototype.action_move = function(response, player, obj, action) {
  response.type = "walk";

  if (obj.grounded) {
    var speed = this.scheme.levels.speed[player.level] || obj.c.speed.move;
    var speed = action.speed || speed;
    var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, action.angle, speed);
    if (walk.move) {
      if (this.action_walk_move(obj, walk.path)) {
        // record player event
        player.events.push({ frame: this.state.frame, type: "walk" });

        // return success
        response.success = true;
      }
    }
  }

  return response;
};

/* Walking in a direction
	---------------------------------------- */

core.prototype.action_walk_dir = function(obj, dir, speed) {
  var speed = speed || obj.c.speed.move;

  // get initial path
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 0, speed);

  if (walk.direction != dir) {
    walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 180, speed);
    if (walk.direction != dir) {
      walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 90, speed);
      if (walk.direction != dir) {
        walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 270, speed);
        if (walk.direction != dir) {
          return;
        }
      }
    }
  }
  if (!walk.move) {
    return;
  }

  this.action_walk_move(obj, walk.path);
};

/* Walk moving
	---------------------------------------- */

core.prototype.action_walk_move = function(obj, path) {
  // go through the course
  var x1 = obj.x;
  var y1 = obj.y;
  for (var i = 1; i < path.length; i++) {
    var point = path[i];

    // check object collisions
    var col = this.collisions(obj, point.x, point.y);
    if (col) {
      return;
    }

    obj.x = point.x;
    obj.y = point.y;
    obj.moved = true;
  }

  if (obj.moved) {
    return true;
  }
};

/* Jumping
	---------------------------------------- */

core.prototype.action_jump = function(response, player, obj, action) {
  response.type = "jump";

  if (obj.grounded && player.cooldown === 0) {
    var speed = this.scheme.levels.jump[player.level] || obj.c.speed.jump;
    var xy = xy_speed(action.angle, speed);
    obj.speed_x = xy.x.fixed();
    obj.speed_y = xy.y.fixed();
    if (this.physics_move(obj)) {
      // set grounding
      obj.grounded = false;

      // set cooldown
      player.cooldown = 7;

      // record player event
      player.events.push({ frame: this.state.frame, type: "jump" });

      // return success
      response.success = true;
    }
  }

  return response;
};

/* Shooting weapon
	---------------------------------------- */

core.prototype.action_shoot = function(response, player, obj, action) {
  response.type = "shoot";

  // if waiting for cooldown
  // is not real weapon
  // do we need to walk
  // check armoury count
  var weapon = this.c.weapons[action.weapon];
  if (
    (player.cooldown === 0 && !weapon) ||
    (weapon.require_walk && !obj.grounded) ||
    player.armoury[action.weapon] === 0
  ) {
    return response;
  }

  // crate the object
  var speed = xy_speed(action.angle, weapon.speed);
  var shot_obj = this.create_object({
    type: weapon.object,
    player_id: player.id,
    x: obj.x,
    y: obj.y,
    speed_x: (speed.x + obj.speed_x * weapon.inertia).fixed(),
    speed_y: (speed.y + obj.speed_y * weapon.inertia).fixed()
  });

  // set player recoil
  if (!obj.grounded) {
    obj.speed_x += (-speed.x * weapon.recoil).fixed();
    obj.speed_y += (-speed.y * weapon.recoil).fixed();
  }

  // set armoury values
  this.update_player_armoury(player.id, action.weapon, -1);

  // set cooldown
  player.cooldown = weapon.cooldown;

  // set player lock
  if (shot_obj.c.player_lock) {
    player.locked = shot_obj.key;
  }

  // record player event
  player.events.push({
    frame: this.state.frame,
    type: "shoot",
    obj: shot_obj.key,
    weapon: action.weapon
  });

  // return success
  response.success = true;
  return response;
};

/* ========================================================================
    Collisions
 ========================================================================== */

/* Run single collision check
	---------------------------------------- */

core.prototype.collisions = function(obj, x, y) {
  // check collision with ground
  if (this.map.i(round(x), round(y))) {
    var event = this.event(obj, "ground", null);
    if (event) {
      return event;
    }
  }

  // check collisions with other objects
  for (var key in this.state.objects) {
    if (obj.key === key) {
      continue;
    }
    if (this.collision_obj(obj, x, y, this.state.objects[key])) {
      return true;
    }
  }

  return false;
};

/* Run object collision check
	---------------------------------------- */

core.prototype.collision_obj = function(obj, x, y, check_obj) {
  // if no collision
  if (
    this.collision_check(
      x,
      y,
      check_obj.x,
      check_obj.y,
      obj.c.size,
      check_obj.c.size
    )
  ) {
    return;
  }

  // prevent hits on parent players for a short time or if they're player locked
  if (
    check_obj.type === "player" &&
    check_obj.player_id === obj.player_id &&
    (this.state.frame < obj.frame + 15 || obj.c.player_lock)
  ) {
    return;
  }

  // prevent clusters hitting each other for a short time
  if (
    check_obj.frame === obj.frame &&
    check_obj.player_id === obj.player_id &&
    this.state.frame < obj.frame + 60
  ) {
    return;
  }

  // trigger basic object collision event
  if (this.event(obj, "object", check_obj)) {
    return true;
  }

  // trigger specific object collision event
  var event = obj.c.object_events[check_obj.type];
  if (event) {
    if (this.run_event(obj, event, check_obj)) {
      return true;
    }
  }
};

/* Collision Maths
	---------------------------------------- */

core.prototype.collision_check = function(x1, y1, x2, y2, s1, s2) {
  return this.map.get_distance(x1, y1, x2, y2) > s1 + s2;
};

/* ========================================================================
    Core
 ========================================================================== */

/* create core object
	---------------------------------------- */

function core(config, scheme, map, gravity_map) {
  // config
  this.c = config;
  this.scheme = scheme;
  this.map = new core_map(map, scheme, gravity_map);

  // crate chance table
  this.crate_list = [];
  for (var key in this.scheme.weapons) {
    for (var i = 0; i < this.scheme.weapons[key].crate_chance; i++) {
      this.crate_list.push(key);
    }
  }

  // armoury reference table
  this.armoury_refs = [];
  for (key in this.scheme.weapons) {
    this.armoury_refs.push(key);
  }
}

/* Set a blank state
	---------------------------------------- */

core.prototype.blank_state = function() {
  return {
    frame: 0,
    explosions: {},
    objects: {},
    players: {},
    events: []
  };
};

/* Run every frame
	---------------------------------------- */

core.prototype.frame = function() {
  this.frame_explosions();
  this.frame_players();
  this.frame_objects();
};

/* ========================================================================
    Events
 ========================================================================== */

/* Run a specific type of event
	---------------------------------------- */

core.prototype.event = function(obj, type, collided_obj) {
  var event = obj.c.events[type];
  if (!event) {
    return;
  }
  return this.run_event(obj, event, collided_obj, type);
};

/* Run a specific event
	---------------------------------------- */

core.prototype.run_event = function(obj, event, collided_obj, type) {
  // handle arrays of events
  if (Array.isArray(event)) {
    var stop = false;
    for (var i = 0; i < event.length; i++) {
      var stop2 = this.run_event(obj, event[i], collided_obj, type);
      stop = stop2 ? true : stop;
    }
    return stop;
  }

  // run event function
  if (event === "die") {
    return this.event_die(obj, collided_obj, type);
  } else if (event === "kill") {
    return this.event_kill(obj, collided_obj);
  } else if (event === "explode") {
    return this.event_explode(obj);
  } else if (event === "hit_give") {
    return this.event_hit_give(obj, collided_obj, type);
  } else if (event === "hit_receive") {
    return this.event_hit_receive(obj, collided_obj, type);
  } else if (event === "destroy") {
    return this.event_destroy(obj);
  } else if (event === "cluster") {
    return this.event_cluster(obj);
  } else if (event === "bounce") {
    return this.event_bounce(obj, collided_obj, type);
  } else if (event === "bounce_explode") {
    return this.event_bounce_explode(obj, collided_obj, type);
  } else if (event === "stick") {
    return this.event_stick(obj);
  } else if (event === "slide") {
    return this.event_slide(obj);
  } else if (event === "player_bounce") {
    return this.event_player_bounce(obj, collided_obj, type);
  } else if (event === "drag_player") {
    return this.event_drag_player(obj);
  } else if (event === "spawn_ghost") {
    return this.event_spawn_ghost(obj);
  } else if (event === "collect") {
    return this.event_collect(obj, collided_obj);
  }
};

/* Object die
	---------------------------------------- */

core.prototype.event_die = function(obj, collided_obj, type) {
  // die event
  this.event(obj, "die");

  // check for destroy events
  if (this.scheme.events.destroy) {
    if (this.scheme.events.destroy[obj.id]) {
      this.state.events.push(this.scheme.events.destroy[obj.id]);
    }
  }

  // delete the object
  delete this.state.objects[obj.key];

  return true;
};

/* Object kill
	---------------------------------------- */

core.prototype.event_kill = function(obj, collided_obj) {
  // destroy it
  this.run_event(collided_obj, "die");
};

/* Explode
	---------------------------------------- */

core.prototype.event_explode = function(obj) {
  // create explosion object
  this.create_explosion({
    player_id: obj.player_id,
    x: obj.x,
    y: obj.y,
    parent: obj.key,
    parent_type: obj.type
  });
};

/* Give a hit
	---------------------------------------- */

core.prototype.event_hit_give = function(obj, collided_obj, type) {
  return this.run_event(collided_obj, "hit_receive", obj, type);
};

/* Receive a hit
	---------------------------------------- */

core.prototype.event_hit_receive = function(obj, collided_obj, type) {
  // prevent instant hits
  if (obj.hits) {
    for (var key in obj.hits) {
      if (key === collided_obj.key) {
        return;
      }
    }
  }

  // calculate direction and distance it came from
  var angle = this.map.get_heading(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );
  var distance = this.map.get_distance(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );

  // get damage values from collided object
  var damage = this.get_damage(collided_obj);
  var knock = collided_obj.c.knock;
  if (collided_obj.type === "explosion") {
    damage *= max(0, (damage * 2 - distance) / (damage * 2));
  }

  // ignore if there's no damage
  if (damage === 0) {
    return;
  }

  // knock object
  if (knock > 0) {
    var xy = xy_speed(angle, damage);
    obj.speed_x -= xy.x.fixed();
    obj.speed_y -= xy.y.fixed();
    obj.grounded = false;
  }

  // are we hitting player
  if (obj.type === "player") {
    this.player_health_add(obj.player_id, -round(damage));
    var player = this.state.players[obj.player_id];
    if (player) {
      player.hit = damage * 2;
    }
  }

  // sound effect
  if (collided_obj.c.audio.hit) {
    this.state.events.push({
      type: "sound",
      x: obj.x,
      y: obj.y,
      sound: collided_obj.c.audio.hit
    });
  }

  // set hits
  if (!obj.hits) {
    obj.hits = {};
  }
  obj.hits[collided_obj.key] = true;
};

/* Destroy ground
	---------------------------------------- */

core.prototype.event_destroy = function(obj) {
  // limit to once per frame
  if (obj.destroyed) {
    return;
  }
  obj.destroyed = true;

  var damage = this.get_damage(obj);

  // record ground damage
  this.state.events.push({
    type: "ground_damage",
    frame: this.state.frame,
    dig: true,
    x: obj.x,
    y: obj.y,
    radius: damage
  });
};

/* Object bounce
	---------------------------------------- */

core.prototype.event_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  // check speed
  var speed = get_speed(obj.speed_x, obj.speed_y);
  var check_speed = speed * obj.c.bounce;
  if (check_speed < 1) {
    obj.speed_x = 0;
    obj.speed_y = 0;
    return true;
  }

  // get new direction angle
  var direction = get_angle(obj.speed_x, obj.speed_y);
  var surface_angle = 0;

  // get angle from ground
  if (type === "ground") {
    var walk = this.map.walk(round(obj.x), round(obj.y), 0, 0, direction, 6);
    if (walk.move) {
      surface_angle = walk.angle;
    }
  }

  // get angle from object
  else {
    var heading = this.map.get_heading(
      obj.x,
      obj.y,
      collided_obj.x,
      collided_obj.y
    );
    surface_angle = angle_add(heading, 90);
  }

  // reflect direction angle with collision angle
  var reflection = (direction - surface_angle) * 2;
  var new_angle = angle_add(direction, -reflection);

  // transform main velocity towards new angle
  var new_speed = xy_speed(new_angle, check_speed);
  obj.speed_x = new_speed.x.fixed();
  obj.speed_y = new_speed.y.fixed();

  // record bounce event
  if (speed > 2) {
    this.state.events.push({
      type: "bounce",
      x: obj.x,
      y: obj.y,
      obj: obj.key
    });
  }

  return true;
};

/* Object stick to ground
	---------------------------------------- */

core.prototype.event_stick = function(obj) {
  obj.grounded = true;
  obj.speed_x = 0;
  obj.speed_y = 0;
  return true;
};

/* Object slide
	---------------------------------------- */

core.prototype.event_slide = function(obj) {
  var angle = get_angle(obj.speed_x, obj.speed_y);
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, angle, obj.speed_left);
  if (walk.move) {
    this.action_walk_move(obj, walk.path);
  }
  return true;
};

/* Player bounce
	---------------------------------------- */

core.prototype.event_player_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }
  var speed = get_speed(obj.speed_x, obj.speed_y);

  var max_speed = this.scheme.levels.jump[player.level] || 0;
  max_speed += 10;
  if (player.hit > 0 || speed > max_speed) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "stick");
  }
};

/* Drag player
	---------------------------------------- */

core.prototype.event_drag_player = function(obj) {
  var player_obj = this.state.objects["player-" + obj.player_id];
  if (!player_obj) {
    return;
  }

  player_obj.speed_x = obj.speed_x;
  player_obj.speed_y = obj.speed_y;
  player_obj.dragged = true;
};

/* First Destroy
	---------------------------------------- */

core.prototype.event_bounce_explode = function(obj, collided_obj, type) {
  if (obj.frame + 10 > this.state.frame) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "explode");
  }
};

/* Spawn player ghost
	---------------------------------------- */

core.prototype.event_spawn_ghost = function(obj) {
  // transform object into ghost
  obj.type = "player_ghost";
  obj.c = this.c.objects["player_ghost"];
  obj.speed_x = 0;
  obj.speed_y = 0;
};

/* Clusters
	---------------------------------------- */

core.prototype.event_cluster = function(obj) {
  // set off explosions
  this.run_event(obj, "explode");

  // get cluster constants
  var cluster = obj.c.cluster;

  // get opposite angle of gravity
  var angle = this.map.get_gravity_angle(obj.x, obj.y);
  angle = angle_add(angle, 135);

  // go through clusters
  var range = cluster.circle ? 360 - 360 / cluster.count : 90;
  var angle_diff = range / (cluster.count - 1);
  for (var i = 0; i < cluster.count; i++) {
    // create cluster objects
    var launch_angle = angle_add(angle, i * angle_diff);
    var speed = xy_speed(launch_angle, cluster.speed);

    // create cluster object
    this.create_object({
      type: cluster.object,
      id: obj.id,
      data: i + 1,
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: speed.x.fixed(),
      speed_y: speed.y.fixed()
    });
  }

  return true;
};

/* Collect Crate
	---------------------------------------- */

core.prototype.event_collect = function(obj, collided_obj) {
  // prep event to send to game
  var event = {
    type: "collect",
    obj: collided_obj.key,
    player_id: obj.player_id
  };
  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // crate
  if (collided_obj.type === "crate") {
    var count = this.scheme.weapons[collided_obj.data].crate_count;
    count = count === -1 ? "infinite" : count;
    this.update_player_armoury(obj.player_id, collided_obj.data, count);
    event.collected = "crate";
    event.weapon = collided_obj.data;
    event.count = count;
    player.events.push({
      frame: this.state.frame,
      type: "crate",
      obj: collided_obj.key
    });
  }

  // medpack
  else if (collided_obj.type === "medpack") {
    this.player_health_add(obj.player_id, this.scheme.drops.medpack.add);
    event.collected = "medpack";
    player.events.push({
      frame: this.state.frame,
      type: "medpack",
      obj: collided_obj.key
    });
  }

  // gems
  else if (collided_obj.type === "gem-1") {
    this.player_score_add(obj.player_id, 1);
    event.collected = "gem";
    event.n = 1;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-5") {
    this.player_score_add(obj.player_id, 5);
    event.collected = "gem";
    event.n = 5;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-20") {
    this.player_score_add(obj.player_id, 20);
    event.collected = "gem";
    event.n = 20;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-50") {
    this.player_score_add(obj.player_id, 50);
    event.collected = "gem";
    event.n = 50;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-200") {
    this.player_score_add(obj.player_id, 200);
    event.collected = "gem";
    event.n = 200;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  }

  // record event
  this.state.events.push(event);

  // kill object
  this.run_event(collided_obj, "die", obj, "collect");

  // check for collection events
  if (this.scheme.events.collect) {
    if (this.scheme.events.collect[collided_obj.id]) {
      this.state.events.push(this.scheme.events.collect[collided_obj.id]);
    }
  }

  return false;
};

/* ========================================================================
    Explosions
 ========================================================================== */

/* Create an explosion
	---------------------------------------- */

core.prototype.create_explosion = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "explosion",
    player_id: "",
    frame: state_ref.frame,
    x: 0,
    y: 0,
    parent: "",
    parent_type: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.parent_type];

  // add to state objects
  state_ref.explosions[obj.parent] = obj;
};

/* Check all existing explosions
	---------------------------------------- */

core.prototype.frame_explosions = function() {
  // go through all explosions
  for (var key in this.state.explosions) {
    var explode = this.state.explosions[key];

    // if expired remove
    if (this.state.frame > explode.frame + 40) {
      delete this.state.explosions[key];
    }

    // if exploding this frame run
    if (this.state.frame === explode.frame + 1) {
      this.run_explosion(explode);
    }
  }
};

/* Run an explosion
	---------------------------------------- */

core.prototype.run_explosion = function(explode) {
  // if no damage
  if (!explode.c.damage) {
    return;
  }

  // calculate additional player damage
  var damage = this.get_damage(explode);

  // check collisions
  for (key in this.state.objects) {
    var obj = this.state.objects[key];

    // if object was just made
    if (this.state.frame < obj.frame + 2) {
      continue;
    }

    // run collision check
    if (
      !this.collision_check(
        obj.x,
        obj.y,
        explode.x,
        explode.y,
        obj.c.size,
        damage * 2
      )
    ) {
      this.event(obj, "explosion", explode);
    }
  }

  // record ground damage
  var ptype = this.c.objects[explode.parent_type];
  if (ptype && ptype.destroy_ground) {
    this.state.events.push({
      type: "ground_damage",
      frame: this.state.frame,
      x: explode.x,
      y: explode.y,
      radius: damage
    });
  }
};

/* ========================================================================
    Objects
 ========================================================================== */

/* Create a new game object
	---------------------------------------- */

core.prototype.create_object = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "",
    player_id: "",
    id: "",
    frame: state_ref.frame,
    grounded: false,
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    data: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.type];
  var key_type = obj.type;

  // set key
  if (
    obj.type === "player" ||
    obj.type === "player_ghost" ||
    obj.type === "player_missile"
  ) {
    obj.key = "player-" + obj.player_id;
  } else {
    obj.key =
      obj.type +
      "-" +
      obj.player_id +
      "-" +
      obj.id +
      "-" +
      obj.frame +
      "-" +
      obj.data;
  }

  // add to state objects
  state_ref.objects[obj.key] = obj;

  // return it
  return obj;
};

/* Snap object to another object
	---------------------------------------- */

core.prototype.snap_object = function(obj1, obj2) {
  obj1.grounded = obj2.grounded;
  obj1.x = obj2.x;
  obj1.y = obj2.y;
  obj1.speed_x = obj2.speed_x;
  obj1.speed_y = obj2.speed_y;
};

/* Run through object frame events
	---------------------------------------- */

core.prototype.frame_objects = function() {
  // run through all objects
  for (var key in this.state.objects) {
    this.frame_object(this.state.objects[key]);
  }

  // check for player lock
  for (var key in this.state.players) {
    this.frame_player_lock(this.state.players[key]);
  }
};

core.prototype.frame_object = function(obj) {
  if (!obj) {
    return;
  }
  obj.destroyed = false;

  // stopping
  if (obj.c.stop > 0 && this.state.frame > obj.frame + obj.c.stop) {
    obj.speed_x = 0;
    obj.speed_y = 0;
  }

  // timeout
  if (obj.c.timeout > 0 && obj.frame + obj.c.timeout <= this.state.frame) {
    this.run_event(obj, "die");
    return;
  }

  // run physics on object
  this.physics(obj);

  // events
  this.event(obj, "frame");
};

/* Spawns
	---------------------------------------- */

core.prototype.spawn = function(props) {
  // weapon crate contents
  if (props.type == "crate") {
    if (this.crate_list.length < 1) {
      return;
    }
    props.data = this.crate_list[rand(0, this.crate_list.length)];
  }

  // do we have a set position
  if (!props.x && !props.y) {
    var pos = this.map.air_find_spot();
    props.x = pos.x;
    props.y = pos.y;
  }

  return this.create_object(props);
};

/* ========================================================================
    Physics
 ========================================================================== */

/* Run air physics
	---------------------------------------- */

core.prototype.physics = function(obj) {
  // are we still grounded
  if (obj.grounded) {
    if (!this.map.ground_pixel(round(obj.x), round(obj.y))) {
      obj.grounded = false;
    }
  }

  // run the main physics
  if (!obj.grounded) {
    this.physics_gravity(obj);
    this.physics_move(obj);
  }
};

/* Calculate gravity
	---------------------------------------- */

core.prototype.physics_gravity = function(obj) {
  // if no weight
  if (obj.c.weight <= 0) {
    return;
  }

  // get gravity values
  var gravity = this.map.get_gravity(round(obj.x), round(obj.y));

  // adjust speed
  this.physics_adjust_speed(
    obj,
    gravity.x,
    gravity.y,
    obj.c.speed.max_gravity,
    obj.c.weight
  );
};

/* Adjust speed of object
	---------------------------------------- */

core.prototype.physics_adjust_speed = function(
  obj,
  new_speed_x,
  new_speed_y,
  max_speed,
  weight
) {
  var angle = get_angle(new_speed_x, new_speed_y);
  var max_speed = xy_speed(angle, max_speed);
  var speed_add_x = new_speed_x * weight;
  var speed_add_y = new_speed_y * weight;
  var diff_x = max_speed.x - obj.speed_x;
  var diff_y = max_speed.y - obj.speed_y;

  // only add speed up to the limit without bringing it down
  if (max_speed.x < 0) {
    obj.speed_x += max(speed_add_x, min(0, diff_x));
  } else {
    obj.speed_x += min(speed_add_x, max(0, diff_x));
  }
  if (max_speed.y < 0) {
    obj.speed_y += max(speed_add_y, min(0, diff_y));
  } else {
    obj.speed_y += min(speed_add_y, max(0, diff_y));
  }

  obj.speed_x = obj.speed_x.fixed();
  obj.speed_y = obj.speed_y.fixed();
};

/* Do the movement
	---------------------------------------- */

core.prototype.physics_move = function(obj) {
  // check speed
  var speed_limit = check_speed(obj.speed_x, obj.speed_y, obj.c.speed.max);
  obj.speed_x = speed_limit.x.fixed();
  obj.speed_y = speed_limit.y.fixed();

  // plot a course
  var course = plot_course(obj.x, obj.y, obj.speed_x, obj.speed_y);

  // if no course
  if (!course.move) {
    this.collisions(obj, obj.x, obj.y);
    return;
  }

  // move through course
  var moved = false;
  for (var i = 1; i < course.points.length; i++) {
    // remaining movement points left
    obj.speed_left = course.points.length - i;

    var point = course.points[i];
    var nx = this.map.loop_x(round(point.x));
    var ny = this.map.loop_y(round(point.y));

    // collisions
    var collision = this.collisions(obj, nx, ny);
    if (collision) {
      break;
    }

    // move object
    obj.x = nx;
    obj.y = ny;
    moved = true;
  }

  return moved;
};

/* ========================================================================
    Players
 ========================================================================== */

/* Create a new player
	---------------------------------------- */

core.prototype.create_player = function(props, state) {
  if (typeof props.id === "undefined") {
    return;
  }

  var state_ref = state || this.state;

  // set up object
  var obj = {
    id: "",
    level: 0,
    score: 0,
    dead: false,
    health: this.scheme.levels.health[0],
    cooldown: 0,
    hit: 0,
    weapon: "",
    locked: "",
    events: [],
    armoury: {}
  };
  obj = deepmerge(obj, props);
  obj.id = parseInt(obj.id);

  // set level
  this.player_level(obj.id);

  // add to state objects
  state_ref.players[obj.id] = obj;

  return obj;
};

/* Remove player
	---------------------------------------- */

core.prototype.remove_player = function(player_id) {
  if (!this.state.players[player_id]) {
    return;
  }

  delete this.state.objects["player-" + player_id];
  delete this.state.players[player_id];
};

/* Start the player
	---------------------------------------- */

core.prototype.init_player = function(player_id, state) {
  player_id = parseInt(player_id);
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // player values
  player.level = 0;
  player.score = 0;
  player.dead = false;
  player.health = this.scheme.levels.health[0];
  player.cooldown = 0;
  player.events = [];

  // armoury
  var armoury = {};
  for (var key in this.scheme.weapons) {
    armoury[key] = this.scheme.weapons[key].start_count;
  }
  player.armoury = armoury;

  // merge with an external state
  if (state) {
    this.state.players[player_id] = deepmerge(player, state);
  }

  // set level
  this.player_level(player_id);

  // object values
  var obj = this.state.objects["player-" + player_id];
  if (!obj) {
    return;
  }
  if (this.scheme.spawn.length > 0) {
    var pos = this.scheme.spawn[rand(0, this.scheme.spawn.length)];
  } else {
    var pos = this.map.air_find_spot();
  }
  obj.type = "player";
  obj.grounded = false;
  obj.x = pos.x;
  obj.y = pos.y;
  obj.speed_x = 0;
  obj.speed_y = 0;
  obj.c = this.c.objects["player"];
};

/* Update armoury
	---------------------------------------- */

core.prototype.update_player_armoury = function(player_id, weapon, count) {
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // if infinite or if zero and taking away
  var old_count = player.armoury[weapon];
  if (!is_numeric(old_count)) {
    return false;
  }
  if (old_count === -1) {
    return true;
  }
  if (old_count === 0 && count < 1) {
    return false;
  }

  // if infinite
  if (count === "infinite") {
    player.armoury[weapon] = -1;
  } else {
    player.armoury[weapon] += count;
  }

  // record event
  this.state.events.push({
    type: "armoury",
    player_id: player_id,
    weapon: weapon
  });

  return true;
};

/* Add health to player
	---------------------------------------- */

core.prototype.player_health_add = function(player_id, health, no_message) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // no health enabled
  if (!this.scheme.health) {
    return;
  }

  // add it
  player.health += health;
  player.health = min(player.health, this.scheme.levels.health[player.level]);

  // are we dead
  if (player.health <= 0) {
    this.player_die(player_id);
  }

  // set event
  if (!no_message) {
    this.state.events.push({
      type: "player_health",
      id: player_id,
      health: health
    });
  }
};

/* Add score to player
	---------------------------------------- */

core.prototype.player_score_add = function(player_id, score) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // add it
  player.score += score;

  // set level
  this.player_level(player_id);

  // set event
  this.state.events.push({
    type: "player_score",
    id: player_id,
    score: score
  });
};

/* Set player level
	---------------------------------------- */

core.prototype.player_level = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // go through levels
  var level = 0;
  for (var i = 0; i < this.scheme.levels.score.length; i++) {
    if (this.scheme.levels.score[i] <= player.score) {
      level = i;
    }
  }
  player.level = level;
};

/* Player die
	---------------------------------------- */

core.prototype.player_die = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  player.dead = true;

  var obj = this.state.objects["player-" + player_id];
  obj.type = "player_missile";
  obj.c = this.c.objects["player_missile"];

  // figure out gems to spawn
  var n = max(round(player.score / 2), 3);
  var gems = [];
  while (n > 200) {
    gems.push(200);
    n -= 200;
  }
  while (n > 50) {
    gems.push(50);
    n -= 50;
  }
  while (n > 20) {
    gems.push(20);
    n -= 20;
  }
  while (n > 5) {
    gems.push(5);
    n -= 5;
  }
  while (n > 1) {
    gems.push(1);
    n -= 1;
  }

  // spawn them
  var angle_inc = round(360 / gems.length);
  for (var i = 0; i < gems.length; i++) {
    var n = ((i % 3) + 1) * 2;
    var xy = xy_speed(angle_inc * i, n);
    this.create_object({
      type: "gem-" + gems[i],
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: xy.x.fixed(),
      speed_y: xy.y.fixed(),
      data: i + 1
    });
  }
};

/* Run through players
	---------------------------------------- */

core.prototype.frame_players = function(ignore) {
  // run through all objects
  for (var key in this.state.players) {
    if (parseInt(key) !== ignore) {
      this.frame_player(this.state.players[key]);
    }
  }
};

core.prototype.frame_player = function(player) {
  if (!player) {
    return;
  }

  // cooldown
  if (player.cooldown > 0) {
    player.cooldown--;
  }

  // hit
  if (player.hit > 0) {
    player.hit--;
  }

  // health regen
  if (this.state.frame % 24 === 0) {
    if (player.health < this.scheme.levels.health[player.level]) {
      this.player_health_add(player.id, 2, true);
    }
  }

  // remove old events
  for (var i = 0; i < player.events.length; i++) {
    if (this.state.frame > player.events[i].frame + 18) {
      player.events.splice(i, 1);
    }
  }
};

/* Run through player locked objects
	---------------------------------------- */

core.prototype.frame_player_lock = function(player) {
  var player_obj = this.state.objects["player-" + player.id];
  var obj = this.state.objects[player.locked];
  if (player_obj && obj) {
    player_obj.x = obj.x;
    player_obj.y = obj.y;
    player_obj.speed_x = obj.speed_x;
    player_obj.speed_y = obj.speed_y;
  } else {
    player.locked = "";
  }
};

/* Get damage modifiers from player
	---------------------------------------- */

core.prototype.get_damage = function(obj) {
  var damage = obj.c.damage;
  var player = this.state.players[obj.player_id];
  if (player && damage !== 0 && !obj.c.ignore_level_damage) {
    var level = this.scheme.levels.damage[player.level];
    if (level) {
      damage += level;
    }
  }
  return damage;
};

/* ========================================================================
    State management
 ========================================================================== */

/* Get state
	---------------------------------------- */

core.prototype.pack_state = function(state) {
  // players
  var players = [];
  for (var id in state.players) {
    players.push(this.pack_player(state.players[id]));
  }

  // go through objects
  var objects = [];
  for (var key in state.objects) {
    objects.push(this.pack_object(state.objects[key]));
  }

  // go through explosions
  var explosions = [];
  for (key in state.explosions) {
    explosions.push(this.pack_explosion(state.explosions[key]));
  }

  return (
    players.join("#") + "+" + objects.join("#") + "+" + explosions.join("#")
  );
};

/* Set state
	---------------------------------------- */

core.prototype.unpack_state = function(str) {
  // blank state
  var state = this.blank_state();

  // run through state string
  var split = str.split("+");
  for (var i = 0; i < split.length; i++) {
    if (split[i]) {
      var split2 = split[i].split("#");
      for (var j = 0; j < split2.length; j++) {
        if (i == 0) {
          this.unpack_player(state, split2[j]);
        }
        if (i == 1) {
          this.unpack_object(state, split2[j]);
        }
        if (i == 2) {
          this.unpack_explosion(state, split2[j]);
        }
      }
    }
  }

  return state;
};

/* Players
	---------------------------------------- */

core.prototype.pack_player = function(obj) {
  // prep basic values
  var dead = obj.dead ? "1" : "";
  var weapon = this.armoury_refs.indexOf(obj.weapon);

  // prep armoury
  var armoury = [];
  for (var key in obj.armoury) {
    armoury.push(obj.armoury[key]);
  }
  armoury = armoury.join("$");

  // prep events
  var events = [];
  for (var i = 0; i < obj.events.length; i++) {
    var event = obj.events[i];
    if (event.type === "walk") {
      events.push(event.frame + "~0");
    }
    if (event.type === "jump") {
      events.push(event.frame + "~1");
    }
    if (event.type === "shoot") {
      events.push(event.frame + "~2~" + event.obj + "~" + event.weapon);
    }
    if (event.type === "crate") {
      events.push(event.frame + "~3~" + event.obj);
    }
    if (event.type === "medpack") {
      events.push(event.frame + "~4~" + event.obj);
    }
    if (event.type === "gem") {
      events.push(event.frame + "~5~" + event.obj);
    }
  }
  events = events.join("$");

  // return player string
  var arr = [
    obj.id,
    obj.level,
    obj.score,
    dead,
    obj.health,
    obj.cooldown,
    obj.hit,
    obj.locked,
    armoury,
    weapon,
    events
  ];
  return arr.join("/");
};

core.prototype.unpack_player = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.id = parseInt(split[0]);
  props.level = parseInt(split[1]);
  props.score = parseInt(split[2]);
  props.dead = split[3] === "1" ? true : false;
  props.health = parseInt(split[4]);
  props.cooldown = parseInt(split[5]);
  props.hit = parseInt(split[6]);
  props.locked = split[7];

  // prep armoury
  props.armoury = {};
  var split2 = split[8].split("$");
  for (var i = 0; i < split2.length; i++) {
    var key = this.armoury_refs[i];
    props.armoury[key] = parseInt(split2[i]);
  }

  // weapon
  var wep = parseInt(split[9]);
  if (wep !== -1) {
    props.weapon = this.armoury_refs[wep];
  }

  // prep events
  props.events = [];
  var split2 = split[10].split("$");
  for (var i = 0; i < split2.length; i++) {
    var split3 = split2[i].split("~");
    var obj = { frame: parseInt(split3[0]) };
    if (split3[1] === "0") {
      obj.type = "walk";
    }
    if (split3[1] === "1") {
      obj.type = "jump";
    }
    if (split3[1] === "2") {
      obj.type = "shoot";
      obj.obj = split3[2];
      obj.weapon = split3[3];
    }
    if (split3[1] === "3") {
      obj.type = "crate";
      obj.obj = split3[2];
    }
    if (split3[1] === "4") {
      obj.type = "medpack";
      obj.obj = split3[2];
    }
    if (split3[1] === "5") {
      obj.type = "gem";
      obj.obj = split3[2];
    }
    if (obj) {
      props.events.push(obj);
    }
  }

  // make it
  this.create_player(props, state);
};

/* Objects
	---------------------------------------- */

core.prototype.pack_object = function(obj) {
  var grounded = obj.grounded ? "1" : "";
  var arr = [
    obj.type,
    obj.player_id,
    obj.id,
    obj.frame,
    grounded,
    obj.x,
    obj.y,
    obj.speed_x,
    obj.speed_y,
    obj.data
  ];
  return arr.join("/");
};

core.prototype.unpack_object = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.type = split[0];
  props.player_id = parseInt(split[1]);
  props.id = split[2];
  props.frame = parseInt(split[3]);
  props.grounded = split[4] === "1" ? true : false;
  props.x = parseFloat(split[5]);
  props.y = parseFloat(split[6]);
  props.speed_x = parseFloat(split[7]);
  props.speed_y = parseFloat(split[8]);
  props.data = split[9];

  this.create_object(props, state);
};

/* Explosions
	---------------------------------------- */

core.prototype.pack_explosion = function(obj) {
  var arr = [
    obj.player_id,
    obj.frame,
    obj.x,
    obj.y,
    obj.parent,
    obj.parent_type
  ];
  return arr.join("/");
};

core.prototype.unpack_explosion = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.player_id = parseInt(split[0]);
  props.frame = parseInt(split[1]);
  props.x = parseFloat(split[2]);
  props.y = parseFloat(split[3]);
  props.parent = split[4];
  props.parent_type = split[5];

  this.create_explosion(props, state);
};

function isMergeableObject(val) {
  var nonNullObject = val && typeof val === "object";

  return (
    nonNullObject &&
    Object.prototype.toString.call(val) !== "[object RegExp]" &&
    Object.prototype.toString.call(val) !== "[object Date]"
  );
}

function emptyTarget(val) {
  return Array.isArray(val) ? [] : {};
}

function cloneIfNecessary(value, optionsArgument) {
  var clone = optionsArgument && optionsArgument.clone === true;
  return clone && isMergeableObject(value)
    ? deepmerge(emptyTarget(value), value, optionsArgument)
    : value;
}

function defaultArrayMerge(target, source, optionsArgument) {
  var destination = target.slice();
  source.forEach(function(e, i) {
    if (typeof destination[i] === "undefined") {
      destination[i] = cloneIfNecessary(e, optionsArgument);
    } else if (isMergeableObject(e)) {
      destination[i] = deepmerge(target[i], e, optionsArgument);
    } else if (target.indexOf(e) === -1) {
      destination.push(cloneIfNecessary(e, optionsArgument));
    }
  });
  return destination;
}

function mergeObject(target, source, optionsArgument) {
  var destination = {};
  if (isMergeableObject(target)) {
    Object.keys(target).forEach(function(key) {
      destination[key] = cloneIfNecessary(target[key], optionsArgument);
    });
  }
  Object.keys(source).forEach(function(key) {
    if (!isMergeableObject(source[key]) || !target[key]) {
      destination[key] = cloneIfNecessary(source[key], optionsArgument);
    } else {
      destination[key] = deepmerge(target[key], source[key], optionsArgument);
    }
  });
  return destination;
}

function deepmerge(target, source, optionsArgument) {
  var array = Array.isArray(source);
  var options = optionsArgument || { arrayMerge: defaultArrayMerge };
  var arrayMerge = options.arrayMerge || defaultArrayMerge;

  if (array) {
    return Array.isArray(target)
      ? arrayMerge(target, source, optionsArgument)
      : cloneIfNecessary(source, optionsArgument);
  } else {
    return mergeObject(target, source, optionsArgument);
  }
}

deepmerge.all = function deepmergeAll(array, optionsArgument) {
  if (!Array.isArray(array) || array.length < 2) {
    throw new Error(
      "first argument should be an array with at least two elements"
    );
  }

  // we are sure there are at least 2 values, so it is safe to have no initial value
  return array.reduce(function(prev, next) {
    return deepmerge(prev, next, optionsArgument);
  });
};

/* ========================================================================
    Math Functions
 ========================================================================== */

/* Shorten "Math" functions
	---------------------------------------- */

function cos(n) {
  return Math.cos(n);
}
function sin(n) {
  return Math.sin(n);
}
function pow(n) {
  return Math.pow(n);
}
function abs(n) {
  return Math.abs(n);
}
function sqr(n) {
  return Math.pow(n, 2);
}
function sqrt(n) {
  return Math.sqrt(n);
}
function round(n) {
  return Math.round(n);
}
function floor(n) {
  return Math.floor(n);
}
function ceil(n) {
  return Math.ceil(n);
}
function atan2(n1, n2) {
  return Math.atan2(n1, n2);
}
function min(n1, n2) {
  return Math.min(n1, n2);
}
function max(n1, n2) {
  return Math.max(n1, n2);
}
function rand(n1, n2) {
  return floor(Math.random() * n2) + n1;
}
var pi = Math.PI;

/* Fix number to decimal places
	---------------------------------------- */

Number.prototype.fixed = function(n) {
  n = n || 2;
  return parseFloat(this.toFixed(n));
};

/* Add preceding zeroes to number
	---------------------------------------- */

function preceding_zeroes(n, length) {
  var length = length || 2;
  var n = n.toString();
  while (n.length < length) {
    n = "0" + n;
  }
  return n;
}

/* Is number
	---------------------------------------- */

function is_numeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

/* Get distance between two points
	---------------------------------------- */

function get_speed(sx, sy) {
  return round(sqrt(sqr(sx) + sqr(sy)));
}

function get_distance(x1, y1, x2, y2) {
  var dx = x2 - x1,
    dy = y2 - y1;
  return get_speed(dx, dy);
}

/* Check speed limit
	---------------------------------------- */

function check_speed(sx, sy, speed) {
  var d = get_distance(0, 0, sx, sy),
    ns = {
      x: sx,
      y: sy,
      total: d
    };
  if (speed < d) {
    var multi = speed / d;
    ns.x = sx * multi;
    ns.y = sy * multi;
    ns.total = speed;
  }
  return ns;
}

/* Get Heading Angle From X and Y Speed
	// 0 = left, 360 = left
	---------------------------------------- */

function get_angle(sx, sy) {
  return (((atan2(sy, sx) * 180) / pi) % 360) + 180;
}

function get_heading(x1, y1, x2, y2) {
  var xs = x2 - x1,
    ys = y2 - y1;
  return get_angle(xs, ys);
}

/* Get X and Y speed from heading and velocity
	---------------------------------------- */

function xy_speed(angle, speed) {
  var a = angle_add(angle, 180),
    r = (a / 180) * pi;
  return {
    x: speed * cos(r),
    y: speed * sin(r)
  };
}

/* Get X and Y offset from heading and velocity
	---------------------------------------- */

function xy_offset(angle, sx, sy) {
  var xy1 = xy_speed(angle, sx);
  var xy2 = xy_speed(angle_add(angle, 90), sy);
  return {
    x: xy1.x + xy2.x,
    y: xy1.y + xy2.y
  };
}

/* Get difference between two numbers in a loop
	---------------------------------------- */

function n_diff(current, target, bottom, top) {
  if (current == target) {
    return 0;
  }

  var scale = abs(top - bottom), // get total size of the loop
    c_current = current - bottom, // correct current for negative numbers
    c_target = target - bottom, // correct target for negative numbers
    n1 = (c_target + scale - c_current) % scale, // get difference when adding
    n2 = (c_current + scale - c_target) % scale; // get difference when subtracting

  // return smallest distance
  if (n1 < n2) {
    return n1;
  } else {
    return -n2;
  }
}

/* Auto loop a number
	---------------------------------------- */

function n_loop(n, bottom, top) {
  var difference = abs(top - bottom);
  while (n <= bottom) {
    n += difference;
  }
  while (n > top) {
    n -= difference;
  }
  return n;
}

/* Add to a number without overflowing up or down from min/max
	---------------------------------------- */

function n_add(n1, n2, t1, t2) {
  var dif = abs(t2 - t1),
    na = n1 + n2;
  while (na < t1) {
    na += dif;
  }
  while (na >= t2) {
    na -= dif;
  }
  return na;
}

/* Add to an angle without overflowing up or down from 0-360
	---------------------------------------- */

function angle_add(angle, add) {
  if (!angle) {
    angle = 0;
  }
  return n_add(angle, add, 0, 360);
}

/* Move number towards a new number with loop
	---------------------------------------- */

function increment_num(current, target, bottom, top, speed) {
  var diff = n_diff(current, target, bottom, top); // get shortest route to number
  move = min(abs(diff) / 10, 4) * speed; // calculate how much to move

  // if difference is less then movement, return target
  if (abs(diff) < move) {
    return target;
  }

  // add or subtract movement
  move = diff < 0 ? -move : move;
  return n_add(current, move, bottom, top);
}

/* Move angle towards a new angle
	---------------------------------------- */

function increment_angle(old_angle, new_angle, speed) {
  return increment_num(old_angle, new_angle, 0, 360, speed);
}

/* If a point is within a circle
	---------------------------------------- */

function in_circle(x, y, cx, cy, radius) {
  return get_distance(x, y, cx, cy) < radius;
}

/* Plot a course
	---------------------------------------- */

function plot_course(x, y, sx, sy, extend) {
  // get initial speed
  var extend = extend ? extend : 0,
    speed = get_speed(sx, sy);

  // if no distance then do nothing
  if (speed == 0) {
    return { move: false };
  }

  // calculate increments
  var increment_x = sx / speed,
    increment_y = sy / speed,
    new_x = x - increment_x * extend,
    new_y = y - increment_y * extend,
    points = [{ x: new_x, y: new_y }];

  // iterate through path and record points
  for (var i = 0; i < speed + extend * 2; i++) {
    (new_x += increment_x), (new_y += increment_y);
    points.push({
      x: new_x,
      y: new_y
    });
  }

  // return point array
  return {
    move: true,
    points: points
  };
}

/* translate co-ordinates by an angle
	---------------------------------------- */

function rotate_coords(x, y, cx, cy, angle) {
  var r = (pi / 180) * angle;
  return {
    x: cos(r) * (x - cx) + sin(r) * (y - cy) + cx,
    y: cos(r) * (y - cy) - sin(r) * (x - cx) + cy
  };
}

/* ========================================================================
    Misc Functions
 ========================================================================== */

/* Duplicate object
	---------------------------------------- */

function duplicate_obj(obj) {
  return JSON.parse(JSON.stringify(obj));
}

/* Prevent array merging
	---------------------------------------- */

function dont_merge(destination, source) {
  if (!source) {
    return destination;
  } else {
    return source;
  }
}

/* Add space to a string
	---------------------------------------- */

function str_space(str) {
  var new_str = "";
  for (var i = 0; i < str.length; i++) {
    var add = i == str.length - 1 ? "" : "\u200A";
    new_str += str[i] + add;
  }
  return new_str;
}

/* Log multiple values
	---------------------------------------- */

function clog(
  s1,
  s2,
  s3,
  s4,
  s5,
  s6,
  s7,
  s8,
  s9,
  s10,
  s11,
  s12,
  s13,
  s14,
  s15
) {
  var str = s1;
  if (s2 != undefined) {
    str += " | " + s2;
  }
  if (s3 != undefined) {
    str += " | " + s3;
  }
  if (s4 != undefined) {
    str += " | " + s4;
  }
  if (s5 != undefined) {
    str += " | " + s5;
  }
  if (s6 != undefined) {
    str += " | " + s6;
  }
  if (s7 != undefined) {
    str += " | " + s7;
  }
  if (s8 != undefined) {
    str += " | " + s8;
  }
  if (s9 != undefined) {
    str += " | " + s9;
  }
  if (s10 != undefined) {
    str += " | " + s10;
  }
  if (s11 != undefined) {
    str += " | " + s11;
  }
  if (s12 != undefined) {
    str += " | " + s12;
  }
  if (s13 != undefined) {
    str += " | " + s13;
  }
  if (s14 != undefined) {
    str += " | " + s14;
  }
  if (s15 != undefined) {
    str += " | " + s15;
  }
  console.log(str);
}

/* ========================================================================
	Map Generator
	Blobs
 ========================================================================== */

/* Draw a blob
	---------------------------------------- */

function mapgen_blob(img, config, decorations, radius, type) {
  this.size = 36;
  this.img = img;
  this.c = config;

  // get land type
  var type = type || Math.floor(Math.random() * this.c.land_type.length);
  this.ref = this.c.land_type[type];

  // set up main anchor points
  var anchors = [];
  var points = Math.floor(radius / 2) + 4;
  var spike = Math.floor(radius / 2) + 2;
  for (var p = 0; p < points; p++) {
    var new_radius =
      Math.max(radius - Math.floor(Math.random() * spike), 1) + 1;
    var x =
      radius + Math.floor(new_radius * Math.cos((2 * Math.PI * p) / points));
    var y =
      radius + Math.floor(new_radius * Math.sin((2 * Math.PI * p) / points));
    anchors.push({ x: x, y: y });
  }

  // draw shape to canvas
  var size = radius * 2 + 1;
  var shape = mapgen_canvas(size, size);
  this.draw_path(shape, anchors);

  // build array of land or not tiles
  var pixels = shape.cont.getImageData(0, 0, shape.w, shape.h);
  this.land = [];
  for (var y = 0; y < size; y++) {
    this.land[y] = [];
    for (var x = 0; x < size; x++) {
      var i = (y * size + x) * 4 + 3;
      this.land[y][x] = pixels.data[i] > 30 ? 1 : 0;
    }
  }

  // build tile array and assign corners and land
  this.tiles = [];
  for (var y = 0; y < size; y++) {
    this.tiles[y] = [];
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] = this.set_corner_tile(y, x);
    }
  }

  // assign pixels a tile value
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] =
        this.tiles[y][x] === 12 ? this.set_land_tile(y, x) : this.tiles[y][x];
    }
  }

  // draw them
  var wh = (size + 4) * this.size;
  this.alpha = mapgen_canvas(wh, wh);
  this.edge = mapgen_canvas(wh, wh);
  this.bg = mapgen_canvas(wh, wh);
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      var tile = this.tiles[y][x];
      if (tile === -1) {
        continue;
      }

      // draw it
      var x1 = (x + 2) * this.size;
      var y1 = (y + 2) * this.size;
      this.draw_to_canvas(this.alpha.cont, x1, y1, tile, 0);
      this.draw_to_canvas(this.edge.cont, x1, y1, tile, this.ref.edge);

      if (decorations) {
        this.draw_decoration(this.bg.cont, x, y, tile);
      }
    }
  }

  // draw rest of fg
  var fg = mapgen_pattern(this.alpha.canv, this.img[this.ref.fg]);
  fg.cont.drawImage(this.edge.canv, 0, 0);

  // draw dirt bg
  var fg_dirt = mapgen_pattern(fg.canv, this.img[this.ref.bg]);
  this.bg.cont.drawImage(fg_dirt.canv, 0, 0);

  // export
  return {
    fg: fg,
    bg: this.bg
  };
}

/* Draw an alpha path
	---------------------------------------- */

mapgen_blob.prototype.draw_path = function(canv, path) {
  // start paths on canvases
  canv.cont.beginPath();
  canv.cont.moveTo(path[0].x, path[0].y);

  // go through path
  for (var i = 1; i < path.length - 1; i++) {
    // get next point to curve around
    var point1 = path[i],
      point2 = path[i + 1],
      qx,
      qy;

    // get curve values
    if (i < path.length - 1) {
      qx = (point1.x + point2.x) / 2;
      qy = (point1.y + point2.y) / 2;
    } else {
      qx = point2.x;
      qy = point2.y;
    }

    // draw curve to path
    canv.cont.quadraticCurveTo(point1.x, point1.y, qx, qy);
  }

  // rejoin the beginning of the path and fill
  canv.cont.lineTo(path[0].x, path[0].y);
  canv.cont.fill();
};

/* Draw a decoration
	---------------------------------------- */

mapgen_blob.prototype.draw_decoration = function(cont, x, y, tile) {
  // are we drawing one
  if (tile > 7 || Math.floor(Math.random() * 2) !== 0) {
    return;
  }

  // can we do doubles
  var double = false;
  if (tile === 0 && this.is_type(y, x + 1, 0)) {
    double = true;
  }
  if (tile === 1 && this.is_type(y, x - 1, 1)) {
    double = true;
  }
  if (tile === 2 && this.is_type(y - 1, x, 2)) {
    double = true;
  }
  if (tile === 3 && this.is_type(y + 1, x, 3)) {
    double = true;
  }
  if (tile === 4 && this.is_type(y - 1, x + 1, 4)) {
    double = true;
  }
  if (tile === 5 && this.is_type(y + 1, x + 1, 5)) {
    double = true;
  }
  if (tile === 6 && this.is_type(y - 1, x - 1, 6)) {
    double = true;
  }
  if (tile === 7 && this.is_type(y + 1, x - 1, 7)) {
    double = true;
  }

  // choose source
  var source = this.ref.decorations[1];
  if (double && Math.floor(Math.random() * 2) === 0) {
    source = this.ref.decorations[2];
  } else {
    double = false;
  }

  // choose decoration
  var i = Math.floor(Math.random() * source.length);
  var ref = source[i];

  // get position to draw it
  var half = this.size / 2;
  var x1 = (x + 2) * this.size;
  var y1 = (y + 2) * this.size;
  var angle = 0;
  if (tile === 1) {
    x1 += this.size;
    y1 += this.size;
    angle = 180;
  }
  if (tile === 2) {
    y1 += this.size;
    angle = 270;
  }
  if (tile === 3) {
    x1 += this.size;
    angle = 90;
  }
  if (tile === 4) {
    y1 += this.size;
    angle = 315;
  }
  if (tile === 5) {
    angle = 45;
  }
  if (tile === 6) {
    x1 += this.size;
    y1 += this.size;
    angle = 225;
  }
  if (tile === 7) {
    x1 += this.size;
    angle = 135;
  }

  // draw that shit
  var x_add = double ? this.size : 0;
  cont.save();
  cont.translate(x1, y1);
  cont.rotate((angle * Math.PI) / 180);
  cont.drawImage(
    this.img.decorations,
    ref.x,
    ref.y,
    ref.w,
    ref.h,
    0,
    -ref.h + 5,
    ref.w,
    ref.h
  );
  cont.translate(-x1, -y1);
  cont.restore();
};

/* Draw a tile to a canvas
	---------------------------------------- */

mapgen_blob.prototype.draw_to_canvas = function(cont, x, y, tile, key) {
  var ts = this.size;
  cont.save();
  cont.translate(x, y);
  cont.drawImage(this.img.edge, tile * ts, key * ts, ts, ts, 0, 0, ts, ts);
  cont.translate(-y, -y);
  cont.restore();
};

/* Get corner and land tiles
	---------------------------------------- */

mapgen_blob.prototype.set_corner_tile = function(y, x) {
  var tile = -1;

  //land
  if (this.is_land(y, x)) {
    tile = 12;

    // not land
  } else {
    // corners
    if (
      !this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 4;
    } else if (
      !this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 5;
    } else if (
      this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 6;
    } else if (
      this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 7;
    }
  }

  return tile;
};

/* Set land tile types
	---------------------------------------- */

mapgen_blob.prototype.set_land_tile = function(y, x) {
  var tile = 12;

  // corners
  if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 4;
  } else if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 5;
  } else if (
    !this.is_land(y, x - 1) &&
    !this.is_land(y + 1, x) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 6;
  } else if (
    !this.is_land(y + 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x - 1) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 7;

    // flat edges
  } else if (
    !this.is_land(y - 1, x) &&
    this.is_land(y + 1, x) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 0;
  } else if (
    !this.is_land(y + 1, x) &&
    this.is_land(y - 1, x) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 1;
  } else if (
    !this.is_land(y, x - 1) &&
    this.is_land(y, x + 1) &&
    !this.is_corner(y, x - 1)
  ) {
    tile = 2;
  } else if (
    !this.is_land(y, x + 1) &&
    this.is_land(y, x - 1) &&
    !this.is_corner(y, x + 1)
  ) {
    tile = 3;

    // inside corners
  } else if (this.is_type(y + 1, x, 7) || this.is_type(y, x + 1, 7)) {
    tile = 8;
  } else if (this.is_type(y + 1, x, 6) || this.is_type(y, x - 1, 6)) {
    tile = 9;
  } else if (this.is_type(y - 1, x, 5) || this.is_type(y, x + 1, 5)) {
    tile = 10;
  } else if (this.is_type(y - 1, x, 4) || this.is_type(y, x - 1, 4)) {
    tile = 11;
  }

  return tile;
};

/* Check arrays for values
	---------------------------------------- */

mapgen_blob.prototype.is_land_or_corner = function(y, x) {
  if (this.is_corner(y, x) || this.is_land(y, x)) {
    return true;
  }
};

mapgen_blob.prototype.is_corner = function(y, x) {
  return this.check_arr(this.tiles, y, x, [4, 5, 6, 7]);
};

mapgen_blob.prototype.is_type = function(y, x, type) {
  return this.check_arr(this.tiles, y, x, [type]);
};

mapgen_blob.prototype.is_land = function(y, x) {
  return this.check_arr(this.land, y, x, [1]);
};

mapgen_blob.prototype.check_arr = function(arr, y, x, checks) {
  if (y < 0 || y >= arr.length || x < 0 || x >= arr[0].length) {
    return false;
  }
  for (var i = 0; i < checks.length; i++) {
    if (arr[y][x] == checks[i]) {
      return true;
    }
  }
};

/* ========================================================================
	Map Generator
	Make Canvas
 ========================================================================== */

/* Set up a new canvas
	---------------------------------------- */

function mapgen_canvas(w, h) {
  var obj = {};
  if ("undefined" != typeof global) {
    obj.canv = new canvas();
  } else {
    obj.canv = document.createElement("canvas");
  }
  obj.cont = obj.canv.getContext("2d");
  obj.canv.width = w;
  obj.canv.height = h;
  obj.cont.fillStyle = "#fff";
  obj.w = w;
  obj.h = h;
  return obj;
}

/* Draw a pattern to a canvas
	---------------------------------------- */

function mapgen_pattern(alpha, pattern) {
  var canv = mapgen_canvas(alpha.width, alpha.height);
  if (typeof pattern !== "string") {
    pattern = canv.cont.createPattern(pattern, "repeat");
  }
  canv.cont.fillStyle = pattern;
  canv.cont.fillRect(0, 0, alpha.width, alpha.height);
  canv.cont.globalCompositeOperation = "destination-in";
  canv.cont.drawImage(alpha, 0, 0);
  canv.cont.globalCompositeOperation = "normal";

  return canv;
}

/* ========================================================================
	Map Generator
	------------
	Config:
	w           // width of map
	h           // height of map
	crust       // thickness of outer crust on land
	blobs       // initial blobs
	center_blob // size of center blob of land, 0 for none
	small_blobs // number of random small circles of land
	large_blobs // number of random large circles of land
	-----------
 ========================================================================== */

/* Server side only
	---------------------------------------- */

if ("undefined" != typeof global) {
  var fs = require("fs");
}

/* New Map Generation
	---------------------------------------- */

function mapgen(img, config, scheme, map_img) {
  this.size = 36;
  this.img = img;
  this.c = config;
  this.scheme = scheme;

  // choose type
  if (this.scheme.type == "random") {
    return this.draw_random();
  }
  if (this.scheme.type == "image") {
    return this.draw_image(map_img);
  }
}

/* Draw image
	---------------------------------------- */

mapgen.prototype.draw_image = function(map_img) {
  var fg = mapgen_canvas(
    map_img.width + this.scheme.gap * 2,
    map_img.height + this.scheme.gap * 2
  );
  fg.cont.drawImage(map_img, this.scheme.gap, this.scheme.gap);
  var bg = mapgen_pattern(fg.canv, this.img.dirt);
  return { fg: fg, bg: bg };
};

/* Draw random
	---------------------------------------- */

mapgen.prototype.draw_random = function() {
  // setup
  this.blobs = JSON.parse(JSON.stringify(this.scheme.blobs));
  this.bg = mapgen_canvas(this.scheme.w, this.scheme.h);
  this.fg = mapgen_canvas(this.scheme.w, this.scheme.h);

  // generate some random large circles
  for (var i = 0; i < this.scheme.large_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 4, 6);
  }

  // generate some random small circles
  for (var i = 0; i < this.scheme.small_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 1, 3);
  }

  // go through each blob
  for (var i = 0; i < this.blobs.length; i++) {
    var blob = this.blobs[i];

    // create the blobs
    var bg = new mapgen_blob(this.img, this.c, false, blob.r + 4, blob.type);
    var fg = new mapgen_blob(
      this.img,
      this.c,
      this.scheme.decorations,
      blob.r,
      blob.type
    );

    // combine the backgrounds
    var wh = fg.fg.canv.width;
    var new_bg = mapgen_canvas(wh, wh);
    new_bg.cont.drawImage(bg.fg.canv, wh * 0.1, wh * 0.1, wh * 0.8, wh * 0.8);
    new_bg.cont.globalCompositeOperation = "source-atop";
    new_bg.cont.fillStyle = "rgba(0,0,0,0.8)";
    new_bg.cont.fillRect(0, 0, wh, wh);
    new_bg.cont.globalCompositeOperation = "normal";
    new_bg.cont.drawImage(fg.bg.canv, 0, 0);

    // draw it to main canvas
    this.bg.cont.drawImage(new_bg.canv, blob.x - wh / 2, blob.y - wh / 2);
    this.fg.cont.drawImage(fg.fg.canv, blob.x - wh / 2, blob.y - wh / 2);
  }

  // return it
  return {
    bg: this.bg,
    fg: this.fg
  };
};

/* Get a far away circle
	---------------------------------------- */

mapgen.prototype.get_circle = function(arr, min_radius, max_radius) {
  // generate many circles and find furthest away
  var distance = 0;
  var circle = null;

  for (var i = 0; i < 20; i++) {
    // make new circle
    var test_circle = this.circle(min_radius, max_radius);
    var smallest_distance = 999999;

    // find shortest distance from all other circles
    for (var j = 0; j < arr.length; j++) {
      var dx = arr[j].x - test_circle.x;
      var dy = arr[j].y - test_circle.y;
      var test_distance = Math.round(
        Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))
      );
      smallest_distance =
        test_distance < smallest_distance ? test_distance : smallest_distance;
    }

    // if is the largest distance record this as furthest
    if (distance < smallest_distance) {
      distance = smallest_distance;
      circle = test_circle;
    }
  }

  // add furthest away circle to new array
  arr.push(circle);
  return arr;
};

/* Generate a random circle
	---------------------------------------- */

mapgen.prototype.circle = function(min_radius, max_radius) {
  var r = Math.floor(Math.random() * max_radius) + min_radius;
  var gap = (r + 2) * this.size + this.scheme.gap;
  var x = Math.floor(Math.random() * (this.scheme.w - gap * 2)) + gap;
  var y = Math.floor(Math.random() * (this.scheme.h - gap * 2)) + gap;
  return {
    r: r,
    x: x,
    y: y
  };
};

var schemes = schemes || {};
schemes.deathmatch = {
  title: "Deathmatch",
  time_limit: 5800,
  destroy_land: true,
  gravity: 2,
  score: true,
  drops: {
    crate: {
      time: 100,
      max: 1
    },
    medpack: {
      time: 100,
      add: 30,
      max: 1
    },
    "gem-1": {
      time: 100,
      max: 5
    },
    "gem-5": {
      time: 150,
      max: 1
    },
    "gem-20": {
      time: 500,
      max: 1
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 0,
      crate_chance: 1,
      crate_count: 5
    },
    paingiver: {
      start_count: 0,
      crate_chance: 1,
      crate_count: 5
    }
  },
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1900,
    h: 1400,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

var schemes = schemes || {};
schemes.default = {
  title: "",
  description: "",
  time_limit: 0,
  show_time: true,
  destroy_land: true,
  gravity_type: "land",
  gravity: 1,
  stars: {},
  score: false,
  health: true,
  levels: {
    score: [
      0,
      10,
      25,
      40,
      60,
      90,
      120,
      150,
      200,
      250,
      300,
      360,
      420,
      490,
      570,
      650,
      720,
      810,
      900,
      1000
    ],
    health: [
      100,
      120,
      120,
      120,
      140,
      140,
      140,
      140,
      160,
      180,
      200,
      200,
      200,
      200,
      220,
      220,
      220,
      220,
      240,
      300
    ],
    damage: [
      0,
      10,
      10,
      15,
      15,
      15,
      15,
      20,
      20,
      25,
      25,
      25,
      30,
      30,
      30,
      30,
      35,
      35,
      35,
      50
    ],
    speed: [
      4,
      6,
      8,
      8,
      8,
      8,
      10,
      10,
      10,
      12,
      12,
      12,
      12,
      14,
      14,
      14,
      14,
      16,
      16,
      20
    ],
    jump: [
      10,
      12,
      12,
      12,
      12,
      15,
      15,
      15,
      15,
      18,
      18,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      25
    ]
  },
  drops: {
    crate: {
      time: 0,
      max: 20
    },
    medpack: {
      time: 0,
      add: 30,
      max: 50
    },
    nuclear: {
      time: 0,
      max: 20
    },
    target: {
      time: 0,
      max: 100
    },
    asteroid_center: {
      time: 0,
      increase_frequency: false,
      max: 30
    },
    "gem-1": {
      time: 0,
      max: 20
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 1
    },
    paingiver: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 10
    }
  },
  armoury: [
    "dig",
    "phaser",
    "bazookoid",
    "grenade",
    "punch",
    "pumpkin",
    "paingiver"
  ],
  arrows: {
    nuclear: "green",
    player: "red",
    target: "blue",
    "asteroid-small": "grey",
    "asteroid-large": "grey",
    vortex: "purple",
    crate: "blue"
  },
  spawn: [],
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1000,
    h: 1000,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

/* ========================================================================
	Map Gravity
 ========================================================================== */

/* Set up gravity
	----------------------------------------- */

core_map.prototype.init_gravity = function(gravity_map) {
  this.weight = this.scheme.gravity || 1;
  this.gravity_type = this.scheme.gravity_type || "land";

  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // set values
  this.gravity = {
    w: 0,
    h: 0,
    map: [],
    scale: 24,
    reach: 18
  };

  if (gravity_map) {
    this.gravity.map = JSON.parse(gravity_map);
    this.gravity.w = this.gravity.map[0].length;
    this.gravity.h = this.gravity.map.length;
  } else {
    this.init_gravity_map();
  }
};

/* Generate gravity map
	---------------------------------------- */

core_map.prototype.init_gravity_map = function() {
  // set size of new gravity grid
  this.gravity.w = ceil(this.w / this.gravity.scale);
  this.gravity.h = ceil(this.h / this.gravity.scale);

  // generate map array
  var new_arr = [];
  for (var y = 0; y < this.gravity.h; y++) {
    this.gravity.map[y] = [];
    for (var x = 0; x < this.gravity.w; x++) {
      this.gravity.map[y].push([0, 0, 0]);
    }
  }

  // do the calculating
  this.action_gravity_generate(0, 0, this.w, this.h);
};

/* Apply new gravity calculations to a set of pixels
	---------------------------------------- */

core_map.prototype.action_gravity_generate = function(x, y, w, h) {
  // calculate which tiles are affected
  var x1 = max(0, min(floor(x / this.gravity.scale), this.gravity.w));
  var y1 = max(0, min(floor(y / this.gravity.scale), this.gravity.h));
  var x2 = max(0, min(floor((x + w) / this.gravity.scale), this.gravity.w));
  var y2 = max(0, min(floor((y + h) / this.gravity.scale), this.gravity.h));

  // get the weight of all affected tiles
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      this.gravity.map[y3][x3][0] = this.get_tile_weight(x3, y3);
    }
  }

  // calculate surrounding tiles
  var x1 = max(0, min(x1 - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y1 - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x2 + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y2 + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var xy = this.get_tile_gravity(x3, y3);
      this.gravity.map[y3][x3][1] = xy.x;
      this.gravity.map[y3][x3][2] = xy.y;
    }
  }
};

/* Get weight of a tile in the gravity map
	---------------------------------------- */

core_map.prototype.get_tile_weight = function(x, y) {
  // limit x and y to within the area
  var y1 = max(0, min(y * this.gravity.scale, this.h));
  var x1 = max(0, min(x * this.gravity.scale, this.w));
  var y2 = max(0, min(y * this.gravity.scale + this.gravity.scale, this.h));
  var x2 = max(0, min(x * this.gravity.scale + this.gravity.scale, this.w));

  // go through the grid of pixels
  var c = 0;
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var id = this.i(x3, y3);
      if (id == 1 || id == 2) {
        c += 1;
      }
      if (id == 3) {
        c += 3;
      }
    }
  }
  return c;
};

/* Get gravity of a tile from the weight of surrounding tiles
	---------------------------------------- */

core_map.prototype.get_tile_gravity = function(x, y) {
  // calculate surrounding tiles
  var wx = 0;
  var wy = 0;
  var x1 = max(0, min(x - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      wx += (x3 - x) * this.gravity.map[y3][x3][0];
      wy += (y3 - y) * this.gravity.map[y3][x3][0];
    }
  }

  wx = round(wx / 5000 / this.gravity.reach) / 60;
  wy = round(wy / 5000 / this.gravity.reach) / 60;

  return {
    x: wx,
    y: wy
  };
};

/* Reset gravity from destruction event
	---------------------------------------- */

core_map.prototype.gravity_event_recalculate = function(x, y, radius) {
  // if we are not using land gravity
  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // recalculate gravity
  var x1 = round(x - radius);
  var y1 = round(y - radius);
  var size = round(radius * 2 + 1);
  this.action_gravity_generate(x1, y1, size, size);
};

/* Return gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity = function(x, y) {
  // flat
  if (this.scheme.gravity_type === "flat") {
    return { x: 0, y: this.weight };
  }

  // map
  if (this.scheme.gravity_type === "land") {
    var x1 = max(0, min(round(x / this.gravity.scale), this.gravity.w - 1));
    var y1 = max(0, min(round(y / this.gravity.scale), this.gravity.h - 1));
    var obj = this.gravity.map[y1][x1];
    return {
      x: min(obj[1], 1) * this.weight,
      y: min(obj[2], 1) * this.weight
    };
  }
};

/* Return the angle of gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity_angle = function(x, y) {
  var grav = this.get_gravity(x, y);
  var a1 = get_angle(grav.x, grav.y);
  return a1;
};

/* ========================================================================
	Map Ground Checkers
 ========================================================================== */

/* Get array of offsets to check in an angles direction
	---------------------------------------- */

core_map.prototype.get_angle_offsets = function(a) {
  if (a > 22 && a <= 67) {
    return [[-1, -1], [0, -1], [-1, 0], [1, -1], [-1, 1], [1, 0], [0, 1]];
  } // up left
  if (a > 67 && a <= 112) {
    return [[0, -1], [-1, -1], [1, -1], [-1, 0], [1, 0], [-1, 1], [1, 1]];
  } // up
  if (a > 112 && a <= 157) {
    return [[1, -1], [0, -1], [1, 0], [-1, -1], [1, 1], [-1, 0], [0, 1]];
  } // up right
  if (a > 157 && a <= 202) {
    return [[1, 0], [1, -1], [1, 1], [0, -1], [0, 1], [-1, -1], [-1, 1]];
  } // right
  if (a > 202 && a <= 247) {
    return [[1, 1], [1, 0], [0, 1], [1, -1], [-1, 1], [0, -1], [-1, 0]];
  } // down right
  if (a > 247 && a <= 292) {
    return [[0, 1], [-1, 1], [1, 1], [-1, 0], [1, 0], [-1, -1], [1, -1]];
  } // down
  if (a > 292 && a <= 337) {
    return [[-1, 1], [-1, 0], [0, 1], [-1, -1], [1, 1], [0, -1], [1, 0]];
  } // down left
  if (a > 337 || a <= 22) {
    return [[-1, 0], [-1, -1], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 1]];
  } // left
};

/* Calculate walk path by angle
	---------------------------------------- */

core_map.prototype.walk = function(x, y, px, py, angle, speed) {
  // get neighboring pixels
  var offsets = this.get_angle_offsets(angle);

  // record old position
  var ox = x;
  var oy = y;

  // record result
  var result = {
    move: false, // we are moving
    angle: 0, // actual angle of movement
    path: [] // recorded coordinates
  };

  // go through number of movements per frame
  for (var i = 0; i < speed; i++) {
    var moved = false;

    // go through directional pixels to check based on angle of path
    for (var j = 0; j < offsets.length; j++) {
      // co-ordinates we're checking
      var x1 = x + offsets[j][0];
      var y1 = y + offsets[j][1];

      // if is previous location, land or not an edge
      if ((x1 == px && y1 == py) || !this.ground_pixel(x1, y1)) {
        continue;
      }

      // set new position
      px = x;
      py = y;
      x = x1;
      y = y1;
      result.move = true;
      result.angle = get_heading(ox, oy, x, y);
      result.path.push({ x: x1, y: y1 });

      var moved = true;
      break;
    }

    // if movement failed
    if (!moved) {
      break;
    }
  }

  // set direction left or right
  result.direction = this.ground_dir(ox, oy, x, y);

  return result;
};

/* Check a pixel is next to ground
	---------------------------------------- */

core_map.prototype.ground_pixel = function(x, y) {
  // if we have hit ground
  if (this.i(x, y)) {
    return false;
  }

  var trigger = false,
    off = [
      [0, -1],
      [-1, 0],
      [1, 0],
      [0, 1],
      [-1, -1],
      [-1, 1],
      [1, 1],
      [1, -1]
    ];

  for (var i = 0; i < off.length; i++) {
    // go through offsets
    var x1 = x + off[i][0]; // new x coordinate
    var y1 = y + off[i][1]; // new y coordinate
    if (this.i(x1, y1)) {
      // if pixel is land
      trigger = true; // we did it
      break;
    }
  }

  return trigger;
};

/* Calculate left or right movement
	//
	// calculates direction of land from a line of movement
	// 1. rotate line coords 90 degrees
	// 2. if the top part of the new line has more land then we are moving right
	// 3. if the bottom part we are moving left
	// 4. bananas, all of it
	---------------------------------------- */

core_map.prototype.ground_dir = function(x1, y1, x2, y2) {
  // rotate co-ordinated 90 degrees to point into the ground we're on
  var center_x = x1 + (x2 - x1) / 2;
  var center_y = y1 + (y2 - y1) / 2;
  var rotated_1 = rotate_coords(x1, y1, center_x, center_y, 90);
  var rotated_2 = rotate_coords(x2, y2, center_x, center_y, 90);

  // plot a course of co-ordinates to check
  var speed_x = this.get_distance_x(rotated_1.x, rotated_2.x);
  var speed_y = this.get_distance_y(rotated_1.y, rotated_2.y);
  var plotted = plot_course(rotated_1.x, rotated_1.y, speed_x, speed_y, 8);
  if (!plotted.move) {
    return "right";
  }

  // go through course and count which side has more land on it
  var count_left = 0,
    count_right = 0;
  for (var i = 0; i < plotted.points.length; i++) {
    var point = plotted.points[i];
    if (this.i(round(point.x), round(point.y))) {
      if (i < plotted.points.length / 2) {
        count_right++;
      } else {
        count_left++;
      }
    }
  }
  return count_left > count_right ? "left" : "right";
};

/* Set values in a circle in the ground array
	---------------------------------------- */

core_map.prototype.set_circle = function(x, y, radius, type) {
  // get boundaries
  var x1 = max(round(x - radius), 0);
  var x2 = min(round(x + radius), this.w - 1);
  var y1 = max(round(y - radius), 0);
  var y2 = min(round(y + radius), this.h - 1);

  // loop through co-ordinates
  for (var ly = y1; ly <= y2; ly++) {
    for (var lx = x1; lx <= x2; lx++) {
      if (in_circle(lx, ly, x, y, radius)) {
        this.i_set(lx, ly, type);
      }
    }
  }
};

/* Set block of cells from arr
	---------------------------------------- */

core_map.prototype.set_block_from_arr = function(x, y, arr) {
  for (var ly = 0; ly < arr.length; ly++) {
    for (var lx = 0; lx < arr[ly].length; lx++) {
      this.i_set(x + lx, y + ly, arr[ly][lx]);
    }
  }
};

/* Get block of cells
	---------------------------------------- */

core_map.prototype.get_block = function(x, y, w, h) {
  var response = [];

  // loop through co-ordinates
  for (var ly = 0; ly < h; ly++) {
    response[ly] = [];
    for (var lx = 0; lx < w; lx++) {
      response[ly][lx] = this.i(lx + x, ly + y);
    }
  }

  return response;
};

/* Find nearby ground spot
	---------------------------------------- */

core_map.prototype.find_ground_nearby = function(x, y) {
  var x1 = round(x);
  var y1 = round(y);

  // already on ground
  if (this.ground_pixel(x1, y1)) {
    return { x: x1, y: y1 };
  }

  var spiral_1 = 0;
  var spiral_2 = 1;
  var inc = 1;
  var dir = true;

  for (var i = 0; i < 450; i++) {
    x1 += dir ? inc : 0;
    y1 += !dir ? inc : 0;
    spiral_1++;
    if (spiral_1 == spiral_2) {
      spiral_1 = 0;
      if ((dir = !dir)) {
        inc = inc == 1 ? -1 : 1;
        spiral_2++;
      }
    }

    // check point for ground pixels
    if (this.ground_pixel(x1, y1)) {
      return { x: x1, y: y1 };
    }
  }
  return false;
};

/* Get random empty spot
	---------------------------------------- */

core_map.prototype.air_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if air pixel
    if (id == 0) {
      return { x: x, y: y };
    }

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* Get random ground spot
	---------------------------------------- */

core_map.prototype.ground_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if not land pixel
    if (id !== 1 && id !== 2) {
      continue;
    }

    // plot course to random angle
    var angle = rand(0, 360);
    for (var i = 0; i < 100; i++) {}

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* ========================================================================
    Map
 ========================================================================== */

// create map object
function core_map(canv, scheme, gravity_map) {
  // Server side only
  if ("undefined" != typeof global) {
    var canvas = require("canvas");
  }

  this.scheme = scheme;

  // set dimensions
  this.w = canv.canv.width;
  this.h = canv.canv.height;

  // get pixels
  var pixels = canv.cont.getImageData(0, 0, this.w, this.h);
  var length = Math.floor(pixels.data.length / 4);

  // create 8 bit alpha array
  // 0. air
  // 1. destructible land
  // 2. indestructible land
  // 3. sun
  this.arr = new Int8Array(length);
  for (var i = 0; i < length; i++) {
    if (pixels.data[i * 4 + 3] > 30) {
      this.arr[i] = 1;
    }
  }

  // set up gravity
  this.init_gravity(gravity_map);
}

/* Get and set array co-ordinate values
	---------------------------------------- */

core_map.prototype.i_get = function(x, y) {
  var x2 = this.loop_x(x);
  var y2 = this.loop_y(y);
  return y2 * this.w + x2;
};

core_map.prototype.i = function(x, y) {
  var i = this.i_get(x, y);
  if (i == null) {
    return 0;
  } else {
    return this.arr[i];
  }
};

core_map.prototype.i_set = function(x, y, val) {
  var i = this.i_get(x, y);
  if (i) {
    this.arr[i] = val;
  }
};

/* Get distance between two points in looping area
	---------------------------------------- */

core_map.prototype.get_distance = function(x1, y1, x2, y2) {
  var x = this.get_distance_x(x1, x2);
  var y = this.get_distance_y(y1, y2);
  return get_speed(x, y);
};

core_map.prototype.get_distance_x = function(x1, x2) {
  return n_diff(x1, x2, 0, this.w);
};
core_map.prototype.get_distance_y = function(y1, y2) {
  return n_diff(y1, y2, 0, this.h);
};

/* Get heading between two points in looping area
	---------------------------------------- */

core_map.prototype.get_heading = function(x1, y1, x2, y2) {
  var x = n_diff(x1, x2, 0, this.w);
  var y = n_diff(y1, y2, 0, this.h);
  return get_angle(x, y);
};

/* Get looping co-ordinate
	---------------------------------------- */

core_map.prototype.loop_x = function(x) {
  return n_loop(x, 0, this.w - 1);
};

core_map.prototype.loop_y = function(y) {
  return n_loop(y, 0, this.h - 1);
};

/* ========================================================================
    App
 ========================================================================== */

const shareLinksText =
  "<div class='links'><a target='_blank' class='fb ball' href='https://www.facebook.com/sharer/sharer.php?u=http://projectants.com' title='Share on Facebook'><img src='" +
  ASSETS +
  "/images/facebook.png' alt=''></a><a target='_blank' class='twitter ball' href='https://twitter.com/intent/tweet?status=Come%20and%20play%20http%3A%2F%2Fprojectants.com%20%23projectants' title='Share on Twitter'><img src='" +
  ASSETS +
  "/images/twitter.png' alt=''></a><br/><a target='_blank' href='mailto:projectantsgame@gmail.com'>Contact</a> | <a target='_blank' href='https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=projectantsgame@gmail.com&lc=UK&item_name=Keeping+the+ants+at+bay!&no_note=0&no_shipping=2&curency_code=GBP&bn=PP-DonationsBF:btn_donateCC_LG.gif:NonHosted'>Donate</a></div>";

const url = new URL(window.location);
const watch = !!url.searchParams.get("watch");

function app() {
  var self = this;
  this.assets_url = ASSETS;
  this.assets = {};
  this.started = false;
  this.watch = watch;
  this.nickname = "the watcher";

  this.sockets = new SocketConnection(function(event) {
    self.run_event(event);
  });
  this.init_interface();

  this.input = new input(function(event) {
    self.run_event(event);
  });
  this.audio = new audio();

  this.init_settings();

  if (this.watch) {
    this.load_room();
  } else {
    this.init_start();
  }
}

/* Load room
    ---------------------------------------- */

app.prototype.load_room = function() {
  if (this.start) {
    hide(this.start);
  }
  show(this.loading);

  // load assets
  var self = this;
  new loader(
    this.assets_url,
    {
      img: {
        sprites: "/images/sprites/sprites.png",
        bg: "/images/textures/space.jpg"
      },
      audio: {
        bleep1: "/audio/bleep1.mp3",
        bloop1: "/audio/bloop1.mp3",
        bloop2: "/audio/bloop2.mp3",
        bing: "/audio/bing.mp3",
        dig: "/audio/dig.mp3",
        doink: "/audio/doink.mp3",
        donk: "/audio/donk.mp3",
        explosion: "/audio/explosion.mp3",
        explosion_gas: "/audio/explosion_gas.mp3",
        explosion_laser: "/audio/explosion_laser.mp3",
        homing: "/audio/homing.mp3",
        fly: "/audio/fly.mp3",
        countdown: "/audio/countdown.mp3",
        jump: "/audio/jump.mp3",
        levelup: "/audio/levelup.mp3",
        locknload: "/audio/locknload.mp3",
        phase: "/audio/phase.mp3",
        pop: "/audio/pop.mp3",
        punch: "/audio/punch.mp3",
        shoot: "/audio/shoot.mp3",
        shoot_laser: "/audio/shoot_laser.mp3",
        throw: "/audio/throw.mp3",
        spooky: "/audio/spooky.mp3",
        walk: "/audio/walk.mp3"
      }
    },
    function(assets) {
      self.init_room(assets);
    }
  );
};

/* Start the app
    ---------------------------------------- */

app.prototype.init_room = function(assets) {
  hide(this.loading);

  this.started = true;
  this.assets = assets;
  this.audio.add_buffers(assets.audio);

  this.room = new multiplayer(
    this.assets,
    this.assets_url,
    this.audio,
    this.input,
    this.nickname,
    this.watch,
    this.run_event,
    this.sockets,
    new onboarding()
  );
  append(this.div, this.room.div);

  if (this.watch) {
    this.sockets.message_send("watcher", []);
  } else {
    this.nickname = this.check_name(this.nickname);
    this.sockets.message_send("send_name", [this.nickname]);
  }
};

window.onload = function() {
  new app();
};

/* ========================================================================
    App
    Events
 ========================================================================== */

/* Events
    ---------------------------------------- */

app.prototype.run_event = function(event) {
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // show and hide menu
  if (event.type == "show_menu") {
    show(this.menu);
  } else if (event.type == "hide_menu") {
    hide(this.menu);

    // if game is full
  } else if (event.type === "full") {
    hide(this.loading);
    show(this.game_full);
    if (this.room && this.room.connecting) {
      hide(this.room.connecting);
    }

    // show the controls screen
  } else if (event.type == "show_settings") {
    this.toggle_settings_screen();

    // send event down a level
  } else {
    if (this.room) {
      this.room.run_event(event);
    }
  }
};

/* ========================================================================
    App Interface
 ========================================================================== */

app.prototype.init_interface = function() {
  this.div = element({ id: "projectants", class: "app" });
  append(document.body, this.div);

  // game full
  this.game_full = element({
    class: "cont_center",
    text: "Oh dear, this room is very full!<br><br><br></div>"
  });
  this.button_new_game = element({
    type: "button",
    class: "button red",
    text: "Find A New One"
  });
  append(this.div, this.game_full);
  append(this.game_full, this.button_new_game);
  hide(this.game_full);

  // find new room
  this.button_new_game.onclick = function() {
    window.location = "/";
  };

  // limit game aspect ratio
  var ratio = this.div.offsetWidth / this.div.offsetHeight;
  this.div.style.width =
    ratio > 1.8
      ? round(this.div.offsetHeight * 1.8) + "px"
      : this.div.offsetWidth + "px";
  this.div.style.height =
    ratio < 1 ? this.div.offsetWidth + "px" : this.div.offsetHeight + "px";

  // loading
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);
};

/* ========================================================================
    App
    Settings
 ========================================================================== */

/* Start settings screen
    ---------------------------------------- */

app.prototype.init_settings = function() {
  var self = this;

  // corner button
  this.icon_settings = element({ class: "settings" });
  this.icon_settings_img = element({
    type: "img",
    src: this.assets_url + "/images/cog.png"
  });
  append(this.div, this.icon_settings);
  append(this.icon_settings, this.icon_settings_img);

  this.settings_visible = false;
  this.icon_settings.onclick = function() {
    self.toggle_settings_screen();
  };

  // box
  this.div_settings = element({ class: "full full_bg" });
  this.div_settings_cont = element({
    class: "cont_center div_controls",
    text: "<div class='top_message'>Settings</div>" + shareLinksText
  });
  append(this.div, this.div_settings);
  append(this.div_settings, this.div_settings_cont);
  hide(this.div_settings);

  // volume
  this.div_volume = element({ text: "<h2>Volume</h2>" });
  this.input_volume = element({ type: "input" });
  this.input_volume.type = "range";
  this.input_volume.setAttribute("min", 0);
  this.input_volume.setAttribute("max", 1);
  this.input_volume.setAttribute("step", 0.1);
  this.input_volume.value = this.audio.volume;
  append(this.div_settings_cont, this.div_volume);
  append(this.div_volume, this.input_volume);

  this.input_volume.onchange = function(e) {
    self.audio.set_global_volume(this.value);
  };

  // controls
  var ctext = "<h2>Controls</h2>";
  ctext += "<dl>";
  ctext += "<dt>Move</dt><dd>WASD / Arrow Keys / Right Click</dd>";
  ctext += "<dt>Jump</dt><dd>Spacebar</dd>";
  ctext += "<dt>Shoot</dt><dd>Left Click / Shift</dd>";
  ctext += "<dt>Select Weapon</dt><dd>1-9 / Scroll Wheel</dd>";
  ctext += "<dt>Follow Weapons</dt><dd>F</dd>";
  ctext += "<dt>Free Cam</dt><dd>Middle Click</dd>";
  ctext += "</dl>";
  this.div_controls = element({ text: ctext });
  append(this.div_settings_cont, this.div_controls);

  // server
  this.div_server = element({
    text:
      "<h2>Server</h2><p><a href='http://uk.projectants.com/'>UK</a> | <a href='http://us.projectants.com/'>US</a></p>"
  });
  append(this.div_settings_cont, this.div_server);

  // close button
  this.div_settings_buttons = element({ class: "buttons" });
  this.button_close_settings = element({ type: "button", text: "Close" });
  append(this.div_settings_cont, this.div_settings_buttons);
  append(this.div_settings_buttons, this.button_close_settings);

  this.button_close_settings.onclick = function() {
    self.settings_visible = false;
    hide(self.div_settings);
  };
};

app.prototype.toggle_settings_screen = function() {
  if ((this.settings_visible = !this.settings_visible)) {
    this.audio.play("bleep1", 0.8);
    show(this.div_settings);
  } else {
    hide(this.div_settings);
  }
};

/* ========================================================================
    App
    Start Screen
 ========================================================================== */

app.prototype.init_start = function() {
  var self = this;

  // get a new or stored nickname
  this.nickname = config.names[rand(0, config.names.length - 1)];
  if (typeof Storage !== "undefined") {
    var lsname = localStorage.getItem("pants_nn");
    if (config.names.indexOf(lsname) === -1) {
      this.nickname = lsname || this.nickname;
    }
  }

  this.start = element({ class: "start" });
  var logo = element({
    type: "img",
    class: "logo",
    src: this.assets_url + "/images/logo.png"
  });
  var instructions = element({
    type: "ul",
    class: "fade",
    text:
      "<li>Collect gems to get stronger</li><li>Destroy the enemy to get their gems!</li><li>WASD or Right Click to Move</li><li>Left Click or Shift to Shoot</li>"
  });
  this.input_name = element({
    type: "input",
    intype: "text",
    value: this.nickname,
    maxlength: 20
  });
  this.button_start = element({
    type: "button",
    class: "break",
    text: "Play Now"
  });

  append(this.div, this.start);
  append(this.start, logo);
  append(this.start, instructions);
  append(this.start, this.input_name);
  append(this.start, this.button_start);
  append(this.start, element({ text: shareLinksText }));

  // start up the app
  this.button_start.onclick = function() {
    self.load_room();
  };
};

/* Check name
    ---------------------------------------- */

app.prototype.check_name = function() {
  var new_name = this.nickname;
  if (this.input_name) {
    new_name = this.input_name.value;
  }
  new_name = new_name.length > 20 ? new_name.substring(0, 20) : new_name;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_nn", new_name);
  }
  return new_name;
};

/* ========================================================================
    Game
    Alert Messages
 ========================================================================== */

/* Set up alert div
    ---------------------------------------- */

game.prototype.init_alert = function() {
  this.div_alert = element({ class: "alert" });
  append(this.div, this.div_alert);
  this.alert_text = "";
  this.alert_count = 0;
};

/* Set alert
    ---------------------------------------- */

game.prototype.set_alert = function(text, col, count) {
  this.alert_count = count || 60;
  this.div_alert.className = "alert";
  this.div_alert.innerHTML = text;
  if (col) {
    add_class(this.div_alert, col);
  }
  show(this.div_alert);
};

/* Run alert
    ---------------------------------------- */

game.prototype.run_alert = function() {
  // do countdowns
  if (this.alert_count > 0) {
    this.alert_count--;
    if (this.alert_count == 0) {
      this.div_alert.innerHTML = "";
      hide(this.div_alert);
    }
  }
};

/* ========================================================================
    Game
    Armoury
 ========================================================================== */

/* Build armoury interface
    ---------------------------------------- */

game.prototype.init_armoury = function() {
  // selected weapon
  this.current_weapon = "";

  // detonation cooldown
  this.detonation_cooldown = 0;

  // create divs
  this.armoury = {
    div: element({ class: "armoury box" }),
    title: element({ class: "title" }),
    player: element({ class: "player_weapon hex-button" }),
    weapons: {},
    show_icon: false,
    show_icon_frame: null
  };
  append(this.div, this.armoury.div);
  append(this.div, this.armoury.player);
  hide(this.armoury.player);

  // go through armoury layout
  var self = this;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var type = this.scheme.armoury[i];

    // create elements
    this.armoury.weapons[type] = {
      box: element({ class: "hex-button weapon", data: type }),
      sprite: element({ class: "sprite" }),
      count: element({ class: "count" }),
      player_icon: element({ class: "icon sprite" }),
      i: i,
      active: false
    };
    append(this.armoury.div, this.armoury.weapons[type].box);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].sprite);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].count);
    append(this.armoury.player, this.armoury.weapons[type].player_icon);
    hide(this.armoury.weapons[type].player_icon);

    // set sprite background position
    var weapon = this.c.weapons[type];
    var sprite = this.c.sprites[weapon.armoury_sprite];
    if (!sprite) {
      continue;
    }
    var offset = ceil((sprite.size - 48) / 2);
    var x = -sprite.x - offset;
    var y = -sprite.y - offset;
    var pos = x - 1 + "px " + y + "px, 0 0";
    this.armoury.weapons[type].sprite.style.backgroundPosition = pos;
    this.armoury.weapons[type].player_icon.style.backgroundPosition = pos;

    // set element events
    this.armoury.weapons[type].box.onclick = function() {
      self.weapon_select(this.dataset.data);
    };
  }

  append(this.armoury.div, this.armoury.title);
  hide(this.armoury.div);
};

/* Initialise armoury with core data
	---------------------------------------- */

game.prototype.set_armoury = function() {
  // set display for all weapons
  for (type in this.armoury.weapons) {
    this.set_weapon(type);
  }

  // select weapon
  if (
    !this.current_weapon ||
    !this.armoury.weapons[this.current_weapon].active
  ) {
    this.weapon_select_n(0);
  }
};

/* Select weapon
	---------------------------------------- */

game.prototype.weapon_select = function(type, no_highlight) {
  // if same weapon or none left
  if (
    !this.player ||
    this.current_weapon === type ||
    this.player.armoury[type] === 0
  ) {
    return;
  }

  // do the change
  for (var key in this.armoury.weapons) {
    remove_class(this.armoury.weapons[key].box, "selected");
    hide(this.armoury.weapons[key].player_icon);
  }
  add_class(this.armoury.weapons[type].box, "selected");
  this.current_weapon = type;
  this.armoury.title.innerHTML = this.c.weapons[type].title;

  // auto following weapon
  var wep = this.c.weapons[type];
  if (
    (wep.auto_follow && !this.weapon_follow) ||
    (!wep.auto_follow && this.weapon_follow)
  ) {
    this.toggle_weapon_follow();
  }

  if (!no_highlight) {
    // play noise
    this.audio.play("bleep1", 0.8);

    // show icon
    this.armoury.show_icon = true;
    this.armoury.show_icon_frame = this.core.state.frame;
    show(this.armoury.weapons[type].player_icon);
    show(this.armoury.player);
  }

  return type;
};

/* Select weapon by position in armoury
	---------------------------------------- */

game.prototype.weapon_select_n = function(n) {
  // if is too big
  if (n >= this.scheme.armoury.length) {
    return;
  }

  // go through columns
  var n2 = 0;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var weapon = this.scheme.armoury[i];
    var active = false;
    if (this.armoury.weapons[weapon].active) {
      active = true;
      if (n2 === n && weapon !== this.current_weapon) {
        return this.weapon_select(weapon);
      }
    }

    // increase count of actual columns
    n2 = active ? n2 + 1 : n2;
  }

  return false;
};

/* Select weapon by scrolling
	---------------------------------------- */

game.prototype.weapon_scroll = function(down) {
  // if we don't have a selected weapon
  var current = this.armoury.weapons[this.current_weapon];
  if (!current) {
    return;
  }

  for (var i = 1; i < this.scheme.armoury.length; i++) {
    var i_down = down ? this.scheme.armoury.length - i : i;
    var new_i = n_loop(current.i + i_down, -1, this.scheme.armoury.length - 1);
    var weapon = this.scheme.armoury[new_i];
    if (this.armoury.weapons[weapon].active) {
      this.weapon_select(weapon);
      return weapon;
    }
  }
};

/* Change to weapon
	---------------------------------------- */

game.prototype.set_weapon = function(type) {
  if (!this.player) {
    return;
  }

  var count = this.player.armoury[type];
  this.armoury.weapons[type].count.innerHTML = count;

  if (count == -1) {
    this.armoury.weapons[type].active = true;
    show(this.armoury.weapons[type].box);
    hide(this.armoury.weapons[type].count);
  } else {
    if (count < 1) {
      this.armoury.weapons[type].active = false;
      hide(this.armoury.weapons[type].box);
      if (type == this.current_weapon) {
        this.weapon_select_n(0);
      }
    } else {
      this.armoury.weapons[type].active = true;
      show(this.armoury.weapons[type].box);
    }
  }

  if (!this.current_weapon) {
    this.weapon_select_n(0);
  }
  this.display_armoury();
};

/* Show armoury or not
	---------------------------------------- */

game.prototype.display_armoury = function() {
  var show_it = false;
  var even = false;
  if (this.player) {
    for (key in this.player.armoury) {
      if (this.player.armoury[key] > 0 || this.player.armoury[key] == -1) {
        show_it = true;
        even = !even;
      }
      this.armoury.weapons[key].box.style.marginTop = even ? "26px" : "0px";
    }
  }
  if (show_it) {
    show(this.armoury.div);
  } else {
    hide(this.armoury.div);
  }
};

/* Run every frame
	---------------------------------------- */

game.prototype.run_armoury = function() {
  // turn off icon
  if (
    this.armoury.show_icon &&
    this.core.state.frame > this.armoury.show_icon_frame + 30
  ) {
    this.armoury.show_icon = false;
    hide(this.armoury.player);
  }
};

/* ========================================================================
    Game
    Audio
 ========================================================================== */

/* Set up audio objects
    ---------------------------------------- */

game.prototype.init_audio = function() {
  // objects with repeating sounds
  this.audio_objs = {};

  // weapon loops
  this.audio_weapons = {};

  // set up power up sound
  this.power_up_audio_on = false;
};

/* Check all game objects with audio objects
    ---------------------------------------- */

game.prototype.run_audio = function() {
  // remove old audio objects
  for (key in this.audio_objs) {
    if (!this.core.state.objects[key]) {
      if (this.audio_objs[key]) {
        this.audio_objs[key].gain.disconnect();
        this.audio_objs[key] = null;
      }
    }
  }

  // objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];

    // what noise should be playing
    var audio_key = null;
    if (obj.grounded && obj.animate && obj.actioned) {
      audio_key = obj.c.audio.walk;
    } else {
      audio_key = obj.c.audio.air;
    }

    var volume = this.get_dist_volume(obj.x, obj.y);
    var audio_obj = this.audio_objs[key];

    // if there is an audio file playing
    if (audio_obj) {
      // change its volume
      this.audio.set_volume(audio_obj, volume);

      // disconnect it
      if (volume <= 0 || audio_obj.audio_key != audio_key || !audio_key) {
        audio_obj.gain.disconnect();
        this.audio_objs[key] = null;
      }

      // if there is not an audio file playing
    } else {
      if (audio_key) {
        this.audio_objs[key] = this.audio.play(audio_key, volume, true);
      }
    }
  }
};

/* Set a weapon shot sound effect
    ---------------------------------------- */

game.prototype.play_weapon_audio = function(props) {
  var weapon = this.c.weapons[props.weapon];
  if (!weapon) {
    return;
  }
  if (!this.audio.buffers[weapon.fire_audio]) {
    return;
  }

  // get volume
  var volume = this.get_dist_volume(props.x, props.y);
  this.audio.play(weapon.fire_audio, volume);
};

/* Get distance volume
    ---------------------------------------- */

game.prototype.get_dist_volume = function(x, y) {
  var distance = this.core.map.get_distance(x, y, this.camera.x, this.camera.y);
  var volume = (1200 - distance) / 1200;
  volume *= volume;
  return volume;
};

/* ========================================================================
    Game
    Crosshair
 ========================================================================== */

/* Set up crosshair
	---------------------------------------- */

game.prototype.init_crosshair = function() {
  this.crosshair = 0;
  this.crosshair_source = "button";
};

/* Calculate crosshair from cursor position
	---------------------------------------- */

game.prototype.run_crosshair = function() {
  if (!this.player || this.player.dead || !this.player_obj) {
    return;
  }
  var obj = this.core.state.objects[this.player_obj.key];
  if (!obj) {
    return;
  }

  this.crosshair = this.core.map.get_heading(
    obj.x,
    obj.y,
    this.cursor.x,
    this.cursor.y
  );

  // // calculate from cursor
  // if (this.crosshair_source == "cursor") {
  // 	this.crosshair = this.core.map.get_heading(obj.x, obj.y, this.cursor.x, this.cursor.y);

  // // calculate from buttons
  // } else
  // if (this.crosshair_source == "button") {

  // 	// calculate angle of crosshair
  // 	var angle = -1;
  // 	if (this.input.actions.move_up) {
  // 		angle = 90;
  // 		if (this.input.actions.move_right) { angle = 135; }
  // 		if (this.input.actions.move_left) { angle = 45; }
  // 	} else
  // 	if (this.input.actions.move_down) {
  // 		angle = 270;
  // 		if (this.input.actions.move_right) { angle = 225; }
  // 		if (this.input.actions.move_left) { angle = 305; }
  // 	} else {
  // 		if (this.input.actions.move_right) { angle = 180; }
  // 		if (this.input.actions.move_left) { angle = 0; }
  // 	}
  // 	if (angle !== -1) {
  // 		this.crosshair = increment_angle(this.crosshair, angle, 4);
  // 	}
  // }
};

/* ========================================================================
    Game
    Decorations
 ========================================================================== */

/* Create decoration
    ---------------------------------------- */

game.prototype.create_decoration = function(props) {
  var obj = {
    frame: this.core.state.frame,
    type: "",
    id: "",
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    timeout: 0,
    angle: 0,
    repeat: true,
    sprite: ""
  };
  obj = deepmerge(obj, props);
  obj.key =
    obj.frame + "-" + obj.x + "-" + obj.y + "-" + obj.sprite + "-" + obj.id;
  this.decorations[obj.key] = obj;
};

/* Run decorations
    ---------------------------------------- */

game.prototype.run_decorations = function() {
  // create trails from objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.trails.count === 0) {
      continue;
    }
    this.create_trail(obj, obj.c.trails);
  }

  // go through all decorations
  for (var key in this.decorations) {
    var dec = this.decorations[key];

    // do timeout
    dec.timeout--;
    if (dec.timeout < 1) {
      delete this.decorations[key];
      continue;
    }

    // move
    dec.x = this.core.map.loop_x(dec.x + dec.speed_x).fixed();
    dec.y = this.core.map.loop_y(dec.y + dec.speed_y).fixed();
  }
};

/* Create trails
	---------------------------------------- */

game.prototype.create_trail = function(obj, trails) {
  // create the trails
  for (var i = 0; i < trails.count; i++) {
    var args = {
      id: i,
      sprite: trails.sprite,
      timeout: trails.timeout,
      x: obj.dx,
      y: obj.dy
    };
    if (trails.rotate) {
      args.angle = rand(0, 360);
    } else {
      args.angle = angle_add(get_angle(-obj.speed_x, -obj.speed_y), 90);
      args.x -= obj.speed_x;
      args.y -= obj.speed_y;
      if (trails.offset_x || trails.offset_y) {
        var xyx = xy_speed(angle_add(args.angle, 90), trails.offset_x);
        var xyy = xy_speed(angle_add(args.angle, 180), trails.offset_y);
        args.x += xyx.x + xyy.x;
        args.y += xyx.y + xyy.y;
      }
    }
    if (trails.move) {
      var move_angle = rand(0, 360);
      var xy = xy_speed(move_angle, trails.speed);
      args.speed_x = -xy.x;
      args.speed_y = -xy.y;
    }
    this.create_decoration(args);
  }
};

/* ========================================================================
    Game
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

game.prototype.run_events = function(events) {
  // events from scheme
  var f_event = this.scheme.events.frame[this.core.current_frame];
  if (f_event) {
    this.run_event(f_event);
  }
};

game.prototype.run_event = function(event) {
  // handle array of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
  }

  // run event
  if (event.type === "weapon_select") {
    this.weapon_select_n(event.n);
  } else if (event.type === "weapon_scroll") {
    this.weapon_scroll(event.down);
  } else if (event.type === "switch_watcher_camera") {
    this.switch_watcher_camera();
  } else if (event.type === "follow_weapon") {
    this.toggle_weapon_follow(true);
  } else if (event.type === "follow_mouse") {
    this.toggle_mouse_follow();
  } else if (event.type === "ground_damage") {
    this.run_event_ground_damage(event);
  } else if (event.type === "screen_shake") {
    this.run_event_screen_shake(event);
  } else if (event.type === "player_health") {
    this.run_event_player_health(event);
  } else if (event.type === "player_level") {
    this.run_event_player_level(event);
  } else if (event.type === "explosion") {
    this.run_event_explosion(event);
  } else if (event.type === "armoury") {
    this.run_event_armoury(event);
  } else if (event.type === "bounce") {
    this.run_event_bounce(event);
  } else if (event.type === "sound") {
    this.run_event_sound(event);
  } else if (event.type === "target") {
    this.run_event_target(event);
  } else if (event.type === "spawn") {
    this.run_event_spawn(event);
  } else if (event.type === "focus") {
    this.run_event_focus(event);
  } else if (event.type === "alert") {
    this.run_event_alert(event);
  } else if (event.type === "collect") {
    this.run_event_collect(event);
  }
};

/* Ground Damage
    ---------------------------------------- */

game.prototype.run_event_ground_damage = function(event) {
  // are we destroying land
  if (!this.scheme.destroy_land) {
    return;
  }

  // damage the ground
  this.core.map.set_circle(event.x, event.y, event.radius, 0);
  this.destroy_land(event.x, event.y, event.radius);
  // this.core.map.gravity_event_recalculate(event.x, event.y, event.radius);

  // do the dig noise and smoke trails
  if (event.dig) {
    this.run_event_sound({ x: event.x, y: event.y, sound: "dig" });
    this.create_trail(
      { dx: event.x, dy: event.y },
      {
        count: 7,
        sprite: "smoke",
        timeout: 20,
        rotate: true,
        move: true,
        speed: 1
      }
    );
  }
};

/* Screen Shake
    ---------------------------------------- */

game.prototype.run_event_screen_shake = function(event) {
  var distance = this.core.map.get_distance(
    event.x,
    event.y,
    this.camera.x,
    this.camera.y
  );
  if (distance < event.radius * 2) {
    this.camera.shake_frame = this.core.state.frame;
    this.camera.shake_size = (distance - event.radius) / 4;
  }
};

/* Health
    ---------------------------------------- */

game.prototype.run_event_player_health = function(event) {
  var obj = this.core.state.objects["player-" + event.id];
  if (obj) {
    var text = String.fromCharCode(9829) + " " + event.health;
    this.create_message(obj, "#ff9999", text, 22);
  }
};

/* Level
    ---------------------------------------- */

game.prototype.run_event_player_level = function(event) {
  var obj = this.core.state.objects["player-" + event.id];

  // is this us
  if (this.player_id === event.id) {
    this.set_score();

    // set alert
    if (event.new > event.prev) {
      var lv = this.scheme.levels;
      var n1 = event.new;
      var n2 = event.prev;
      var benefits = "";
      if (lv.health[n1] > lv.health[n2]) {
        benefits += "<br>+" + (lv.health[n1] - lv.health[n2]) + " max health";
      }
      if (lv.damage[n1] > lv.damage[n2]) {
        benefits += "<br>+" + (lv.damage[n1] - lv.damage[n2]) + " damage";
      }
      if (lv.speed[n1] > lv.speed[n2]) {
        benefits += "<br>+" + (lv.speed[n1] - lv.speed[n2]) + " speed";
      }
      if (lv.jump[n1] > lv.jump[n2]) {
        benefits += "<br>+" + (lv.jump[n1] - lv.jump[n2]) + " jump power";
      }
      var text =
        "<small>You have reached</small><br><span class='large'>Level " +
        (event.new + 1) +
        "</span><small class='blue'>" +
        benefits +
        "</small>";
      this.set_alert(text, "#eeeeee", 150);
    }
  }

  // do the flourish
  if (event.new > event.prev) {
    this.create_message(obj, "#eee", "lvl " + (event.new + 1), 30, -30);
    this.run_event_sound({ x: obj.x, y: obj.y, sound: "levelup" });
    this.create_trail(obj, {
      count: 7,
      sprite: "star-blue",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 1.5
    });
    this.create_trail(obj, {
      count: 7,
      sprite: "ball-red",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 2
    });
  }
};

/* Explosion
    ---------------------------------------- */

game.prototype.run_event_explosion = function(event) {
  // focus camera if we were following it
  if (this.weapon_following === event.key) {
    this.camera.focus = this.core.state.frame;
    this.camera.focus_time = 30;
    this.camera.fx = event.x;
    this.camera.fy = event.y;
  }
};

/* Armoury
    ---------------------------------------- */

game.prototype.run_event_armoury = function(event) {
  if (event.player_id == this.player_id) {
    this.set_weapon(event.weapon);
  }
};

/* Bounce
    ---------------------------------------- */

game.prototype.run_event_bounce = function(event) {
  var obj = this.core.state.objects[event.obj];
  if (!obj) {
    return;
  }
  var sound = obj.c.audio.bounce;
  if (sound) {
    this.run_event_sound({ x: event.x, y: event.y, sound: sound });
  }
};

/* Sound
    ---------------------------------------- */

game.prototype.run_event_sound = function(event) {
  var volume = this.get_dist_volume(event.x, event.y);
  if (volume > 0) {
    this.audio.play(event.sound, volume);
  }
};

/* Set a target on the map
    ---------------------------------------- */

game.prototype.run_event_target = function(event) {
  this.create_decoration({
    sprite: "focus",
    timeout: event.time,
    x: event.x,
    y: event.y,
    repeat: false
  });
  this.audio.play("homing", 1);
};

/* Spawn Objects
    ---------------------------------------- */

game.prototype.run_event_spawn = function(event) {
  this.create_object(event.args, true);

  event.args.time = 30;
  if (event.target) {
    this.run_event_target(event.args);
  }
  if (event.focus) {
    this.run_event_focus(event.args);
  }
};

/* Focus Camera
    ---------------------------------------- */

game.prototype.run_event_focus = function(event) {
  this.camera.focus = this.core.state.frame;
  this.camera.focus_time = event.time;
  this.camera.fx = event.x;
  this.camera.fy = event.y;
  if (event.target) {
    this.run_event_target(event);
  }
};

/* Show alert
    ---------------------------------------- */

game.prototype.run_event_alert = function(event) {
  this.set_alert(event.text, "#eeeeee", event.time);
};

/* Crate Grab
    ---------------------------------------- */

game.prototype.run_event_collect = function(event) {
  // is this not us
  if (event.player_id !== this.player_id) {
    return;
  }

  // get our object
  var obj = this.core.state.objects["player-" + event.player_id];
  if (!obj) {
    return;
  }

  // crates
  if (event.collected === "crate") {
    var weapon = this.c.weapons[event.weapon];
    this.create_message(
      obj,
      "#eeeeee",
      "+" + event.count + " " + weapon.title,
      18
    );
  }

  // gems
  if (event.collected === "gem") {
    this.set_score();
    this.create_message(obj, "#aaff99", "+" + event.n, 22);
  }
};

/* ========================================================================
    Game
    Explosions
 ========================================================================== */

/* Check for explosions
    ---------------------------------------- */

game.prototype.run_explosions = function() {
  // run through all explosions
  for (var key in this.core.state.explosions) {
    var explode_state = this.core.state.explosions[key];
    var explode_sprite = this.explosions[key];

    // if it's not started
    if (!explode_sprite) {
      var type = this.c.objects[explode_state.parent_type];
      if (!type) {
        continue;
      }

      // create sprite reference
      this.explosions[key] = {
        sprite: type.animation.explosion,
        frame: this.core.state.frame,
        x: explode_state.x,
        y: explode_state.y
      };

      // run sound effect
      if (type.audio.explosion) {
        this.run_event_sound({
          sound: type.audio.explosion,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      // run screen shake
      if (type.damage > 0) {
        this.run_event_screen_shake({
          radius: type.damage,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      continue;
    }

    // match position
    explode_sprite.x = explode_sprite.x;
    explode_sprite.y = explode_sprite.y;
  }

  // remove explosions
  for (var key in this.explosions) {
    if (this.core.state.frame > this.explosions[key].frame + 60) {
      delete this.explosions[key];
    }
  }
};

/* ========================================================================
    Game
 ========================================================================== */

function game(
  assets,
  audio,
  input,
  scheme,
  map,
  players,
  player_id,
  top_event,
  onboarding
) {
  // args
  this.c = config;
  this.img = assets.img;
  this.audio = audio;
  this.input = input;
  this.scheme = scheme;
  this.map = map;
  this.players = players;
  this.player_id = player_id;
  this.leader = null;
  this.top_event = top_event;
  this.onboarding = onboarding;

  // game running
  this.active = false;
  this.last_frame = 0;

  // main div
  this.div = element({ class: "game full" });
  this.game_area = element({ id: "game_input" });
  append(this.div, this.game_area);

  // set up game modules
  this.init_crosshair();
  this.init_canvas();
  this.init_armoury();
  this.init_map();
  this.init_camera();
  this.init_background();
  this.init_time();
  this.init_score();
  this.init_alert();
  this.init_audio();

  // things to display
  this.objects = {};
  this.explosions = {};
  this.decorations = {};
  this.actions = {};
  this.sprites = [];
  this.messages = [];
  this.labels = {};

  // wait period before on fired weapon immediately after
  this.detonation_cooldown = 0;

  // create core
  this.core = new core(this.c, this.scheme, this.map.fg, this.map.gravity_map);
  this.core.state = this.core.blank_state();
  this.core.state = this.core.state;
}

/* Init game
    ---------------------------------------- */

game.prototype.start = function(frame) {
  // mark player events
  this.player_events = {};

  // set game status to active
  this.active = true;

  // set player obj
  this.set_this_player_refs();
  this.set_score();

  // set initial camera
  if (this.player) {
    this.camera.x = this.player_obj.x;
    this.camera.y = this.player_obj.y;
  }
};

/* Run core
    ---------------------------------------- */

game.prototype.frame_core = function(frame, actions) {
  // set up this state
  this.core.state.frame = frame;
  this.core.state.events = [];
  var response = this.core.action(this.player_id, actions);

  // run player actions
  this.run_players_events();

  // run this state
  this.core.frame();

  // return the input response
  return response;
};

/* Run display
    ---------------------------------------- */

game.prototype.frame_display = function() {
  this.run_objects();
  this.run_crosshair();
  this.run_camera();
  this.run_explosions();
  this.run_decorations();
  this.run_labels();
  this.run_canvas();
  this.run_audio();
  this.run_time();
  this.run_alert();
  this.run_armoury();

  // detonation cooldown
  this.detonation_cooldown -= this.detonation_cooldown > 0 ? 1 : 0;
};

/* ========================================================================
	Game
	Input
 ========================================================================== */

/* Get current core action input
	---------------------------------------- */

game.prototype.get_input = function() {
  // is the game active and does it have a player
  if (!this.active || !this.player || this.player.dead) {
    return;
  }

  // set source of crosshair movement
  if (
    this.input.active("move_up") ||
    this.input.active("move_down") ||
    this.input.active("move_left") ||
    this.input.active("move_right")
  ) {
    this.crosshair_source = "button";
  } else {
    if (this.input.cursor_moved) {
      this.crosshair_source = "cursor";
    }
  }
  this.input.cursor_moved = false;

  // get player actions
  var active = false;
  var response = {
    action: "none",
    angle: round(this.crosshair)
  };

  // weapon keys
  var shoot_key = false;
  var fire_weapon = false;
  var weapon = this.c.weapons[this.current_weapon];
  if (weapon && this.detonation_cooldown === 0 && this.input.active("shoot")) {
    // abandon a followed weapon
    if (this.core.state.objects[this.weapon_following]) {
      this.detonation_cooldown = 15;
      this.weapon_following = "";

      // normal firing
    } else {
      // on screen
      var pos = this.screen_position(
        this.player_obj.x,
        this.player_obj.y,
        this.player_obj.c.size
      );
      if (!pos.on_screen) {
        return;
      }

      // cooldown
      if (this.player.cooldown > 0) {
        return;
      }

      var weapon = this.c.weapons[this.current_weapon];
      if (!weapon) {
        return;
      }
      if (weapon.power_up && this.power_up < 60) {
        this.power_up++;
      } else {
        fire_weapon = true;
      }
    }
  } else {
    this.powered = false;
    if (this.power_up > 0) {
      fire_weapon = true;
    } else {
      this.power_up = 0;
    }
  }

  // fire weapon
  if (fire_weapon) {
    this.powered = true;
    response.action = "shoot";
    response.power = this.power_up;
    response.weapon = this.current_weapon;
    active = true;
    this.power_up = 0;
  }

  // walking restricted actions
  if (this.player_obj.grounded && !active) {
    // arrow key movement
    var arrow_angle = -1;
    if (this.input.active("move_up")) {
      arrow_angle = 90;
      if (this.input.active("move_right")) {
        arrow_angle = 135;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 45;
      }
    } else if (this.input.active("move_down")) {
      arrow_angle = 270;
      if (this.input.active("move_right")) {
        arrow_angle = 225;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 305;
      }
    } else {
      if (this.input.active("move_right")) {
        arrow_angle = 180;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 0;
      }
    }
    if (arrow_angle !== -1) {
      response.action = "move";
      response.angle = arrow_angle;
      active = true;
    }

    // move crosshair key
    if (this.input.active("move")) {
      response.action = "move";
      active = true;
    }

    // jumping
    if (this.input.active("jump")) {
      response.action = "jump";
      active = true;
    }
  }

  // cancel mouse follow if doing stuff
  if (active) {
    this.cancel_mouse_follow();
  }

  if (!active) {
    return false;
  }

  // set the onboarding
  this.onboarding.set(response.action);

  return response;
};

/* ========================================================================
    Game
    Run Objects
 ========================================================================== */

/* Start objects
	---------------------------------------- */

game.prototype.create_object = function(props, spawn) {
  // use existing props to make new core object
  var obj = this.core.create_object(props);

  // previous position
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = false;
  obj.px2 = obj.x;
  obj.py2 = obj.y;

  // display values
  obj.heading = 0;
  obj.hide = 0;
  obj.barrel_angle = 0;
  obj.actioned = false;
  obj.player_locked = false;

  // display position
  obj.dx = obj.x;
  obj.dy = obj.y;
  obj.ds = 0;

  // check for shoot events
  this.set_shot_object(obj);

  // previous display position
  obj.pdx = obj.x;
  obj.pdy = obj.y;

  // spawn
  if (obj.c.spawn || spawn) {
    // hide new object for x frames
    obj.hide = 9;

    // add a spawn decoration over top
    this.create_decoration({
      x: obj.x,
      y: obj.y,
      timeout: 16,
      repeat: false,
      type: "spawn",
      sprite: "teleport"
    });

    // play spawn sound
    this.run_event_sound({
      sound: "phase",
      x: obj.x,
      y: obj.y
    });
  }

  return obj;
};

/* Set a shot items new location
	---------------------------------------- */

game.prototype.set_shot_object = function(obj) {
  // check for a player
  var player = this.core.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // check for an action
  for (var i = 0; i < player.events.length; i++) {
    var act = player.events[i];
    if (act.obj === obj.key) {
      obj.hide = 100;
    }
  }
};

/* Run objects
	---------------------------------------- */

game.prototype.run_objects = function() {
  // check for player locked objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.player_lock) {
      var player = this.core.state.objects["player-" + obj.player_id];
      if (player) {
        player.player_locked = true;
      }
    }
  }

  for (var key in this.core.state.objects) {
    this.run_object(this.core.state.objects[key]);
  }
};

game.prototype.run_object = function(obj) {
  // snap immediately if us
  if (obj.player_id === this.player_id) {
    obj.dx = obj.x;
    obj.dy = obj.y;

    // prevent bobbling
    if (obj.x === obj.px2 && obj.y === obj.py2) {
      obj.dx = obj.pdx;
      obj.dy = obj.pdy;
    }

    // interpolate others
  } else {
    // get max speed of movement
    if (!obj.actioned) {
      obj.ds = get_speed(obj.speed_x, obj.speed_y);
    }

    // interpolate
    var dist_x = this.core.map.get_distance_x(obj.dx, obj.x);
    var dist_y = this.core.map.get_distance_y(obj.dy, obj.y);
    var max_speed = this.core.map.get_distance(obj.dx, obj.dy, obj.x, obj.y);
    var speed = max(max_speed / 4, min(max_speed, obj.ds));
    var move = check_speed(dist_x, dist_y, speed);
    obj.dx = this.core.map.loop_x(obj.dx + round(move.x));
    obj.dy = this.core.map.loop_y(obj.dy + round(move.y));
  }

  // have we moved
  var moved = obj.pdx !== obj.dx || obj.pdy !== obj.dy;

  // set heading and barrel angle
  if (moved) {
    obj.heading = this.core.map.get_heading(obj.pdx, obj.pdy, obj.dx, obj.dy);
    obj.barrel_angle = increment_angle(obj.barrel_angle, obj.heading, 3);
  }

  // is us
  if (obj.player_id === this.player_id) {
    obj.barrel_angle = obj.player_locked ? obj.heading : this.crosshair;
  }

  // if we have just landed set initial angle
  if (obj.grounded && !obj.pg) {
    var angle = get_angle(obj.speed_x, obj.speed_y);
    var walk = this.core.map.walk(obj.x, obj.y, obj.px, obj.py, angle, 6);
    if (walk.move) {
      obj.angle = walk.angle;
      obj.direction = walk.direction;
      obj.px = obj.x;
      obj.py = obj.y;
      obj.animate = false;
    }
  }

  // if walking
  else if (obj.grounded) {
    // set the display values
    var dist_x = this.core.map.get_distance_x(obj.pdx, obj.dx);
    var dist_y = this.core.map.get_distance_y(obj.pdy, obj.dy);
    var amount_moved = get_speed(dist_x, dist_y);
    if (amount_moved > 3) {
      obj.animate = true;
      obj.direction = this.core.map.ground_dir(
        obj.pdx,
        obj.pdy,
        obj.dx,
        obj.dy
      );
      obj.angle = obj.heading;
    } else {
      obj.animate = obj.c.animation.ground;
    }

    // set sprites
    var suffix = obj.animate ? "-walk-" : "-still-";
    obj.sprite_key = obj.c.animation.sprite + suffix + obj.direction;
    obj.display_angle =
      obj.direction === "left" ? obj.angle : angle_add(obj.angle, 180);

    // not walking
  } else {
    obj.sprite_key = obj.c.animation.sprite;
    obj.animate = true;

    // players
    var player = this.core.state.players[obj.player_id];
    if (obj.type === "player" && player.hit === 0) {
      obj.direction =
        obj.barrel_angle >= 90 && obj.barrel_angle < 270 ? "right" : "left";
      obj.sprite_key += "-air-" + obj.direction;
      obj.display_angle =
        obj.direction === "left"
          ? obj.barrel_angle
          : angle_add(obj.barrel_angle, 180);
    }

    // spinning in the air
    else if (obj.c.animation.air_spin) {
      var ground = this.core.map.ground_pixel(round(obj.dx), round(obj.dy));
      var speed = get_speed(obj.speed_x, obj.speed_y);
      var n = ground ? 0 : 1;
      var angle_adding = moved ? speed * 2 : n;
      obj.display_angle = angle_add(obj.display_angle, angle_adding);

      // pointing towards trajectory
    } else {
      if (round(abs(obj.speed_x) === 0) && round(abs(obj.speed_y) === 0)) {
        if (obj.c.animation.air_spin) {
          obj.display_angle = angle_add(obj.display_angle, 2);
        }
      } else {
        obj.display_angle = angle_add(
          get_angle(-obj.speed_x, -obj.speed_y),
          90
        );
      }
    }
  }

  // static angle flag
  if (obj.c.animation.static_angle) {
    obj.display_angle = 0;
  }

  // weapon just fired flags
  if (obj.fire_sprite_count) {
    obj.fire_sprite_count--;
  }
  if (obj.fire_angle_lock_count) {
    obj.direction = obj.fire_direction;
    obj.display_angle =
      obj.direction === "left"
        ? obj.fire_angle_lock
        : angle_add(obj.fire_angle_lock, 180);
    obj.fire_angle_lock_count--;
  }
  if (obj.fire_body_sprite_count) {
    obj.sprite_key = obj.fire_body_sprite + "-" + obj.direction;
    obj.animate = true;
    obj.fire_body_sprite_count--;
  }

  // previous position
  obj.px2 = obj.px;
  obj.py2 = obj.py;
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = obj.grounded;
  obj.pdx = obj.dx;
  obj.pdy = obj.dy;
  obj.player_locked = false;
};

/* ========================================================================
    Game
    Run Players
 ========================================================================== */

/* Start this player
	---------------------------------------- */

game.prototype.init_player = function(player, preserve_events, remove_events) {
  var new_player;

  // use sources
  if (player) {
    var core_player = this.core.state.players[player.id];
    if (preserve_events && core_player) {
      player.events = core_player.events.concat(player.events);
    }
    new_player = this.core.create_player(player);
    if (remove_events) {
      new_player.events = [];
    }

    // create new
  } else {
    new_player = this.core.create_player({ id: this.player_id });
    this.create_object({ type: "player", player_id: this.player_id });
    this.core.init_player(this.player_id);
  }

  // set this player
  if (new_player.id === this.player_id) {
    this.player = new_player;
    this.set_armoury();
  }
};

/* Resolve players from other states
	---------------------------------------- */

game.prototype.run_players_events = function(players) {
  // clear object actioned events
  for (var key in this.core.state.objects) {
    this.core.state.objects[key].actioned = false;
  }

  // run player events
  for (var key in this.core.state.players) {
    this.run_player_events(this.core.state.players[key]);
  }

  // remove old events
  for (var id in this.player_events) {
    for (var key in this.player_events[id]) {
      if (this.core.state.frame > this.player_events[id][key] + 30) {
        delete this.player_events[id][key];
      }
    }
  }
};

game.prototype.run_player_events = function(player) {
  // init player events
  if (!this.player_events[player.id]) {
    this.player_events[player.id] = {};
  }

  // go through events
  for (var i = 0; i < player.events.length; i++) {
    var event = player.events[i];
    var key = event.frame + "-" + event.type;
    if (!this.player_events[key]) {
      this.player_event(player, event);
      this.player_events[key] = this.core.state.frame;
      break;
    }
  }
};

/* Player action
	---------------------------------------- */

game.prototype.player_event = function(player, event) {
  // is there isn't an action
  if (!event) {
    return;
  }

  // get player object
  var obj = this.core.state.objects["player-" + player.id];
  if (!obj) {
    return;
  }

  // mark object as having performed an action
  obj.actioned = true;

  // movement
  if (event.type === "walk") {
    obj.ds = this.scheme.levels.speed[player.level] || obj.c.speed.move;
  }

  // jump
  if (event.type === "jump") {
    obj.ds = this.scheme.levels.jump[player.level] || obj.c.speed.jump;

    // play jump sound
    this.run_event_sound({
      sound: "jump",
      x: obj.x,
      y: obj.y
    });
  }

  // shooting
  if (event.type === "shoot") {
    var weapon = this.c.weapons[event.weapon];
    var weapon_obj = this.c.objects[weapon.object];

    // are we firing the weapon
    if (obj.player_id === this.player_id) {
      this.detonation_cooldown = min(20, weapon.cooldown);
      this.weapon_following = this.weapon_follow ? event.obj : "";

      // other players shots
    } else {
      var shot_obj = this.core.state.objects[event.obj];
      if (shot_obj) {
        shot_obj.hide = 0;
        shot_obj.dx = obj.dx;
        shot_obj.dy = obj.dy;
        obj.barrel_angle = this.core.map.get_heading(
          obj.x,
          obj.y,
          shot_obj.x,
          shot_obj.y
        );
      }
    }

    // if we are not a player and auto follow weapons
    if (this.player_id === null) {
      if (obj.player_id === parseInt(this.leader) && weapon.auto_follow) {
        this.weapon_following = event.obj;
      }
    }

    // weapon just fired sprite
    if (weapon.fire_sprite) {
      var sprite_key = "ant-weapon-" + weapon.fire_sprite;
      var animation = this.c.animations[sprite_key + "-left"];
      obj.fire_sprite = sprite_key;
      obj.fire_sprite_count = animation ? animation.length + 1 : 1;
      obj.fire_sprite_frame = this.core.state.frame;
    }

    // weapon body sprite
    if (weapon.fire_body_sprite) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_body_sprite = "ant-body-" + weapon.fire_body_sprite;
      obj.fire_body_sprite_count = cool;
    }

    // weapon angle lock
    if (weapon.fire_angle_lock) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_direction = obj.direction;
      obj.fire_angle_lock = obj.barrel_angle;
      obj.fire_angle_lock_count = cool;
    }

    // play sound effect
    this.play_weapon_audio({
      x: obj.dx,
      y: obj.dy,
      player_id: obj.player_id,
      weapon: event.weapon
    });
  }

  // collect a crate or medpack
  if (event.type === "crate" || event.type === "medpack") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "locknload"
    });
  }

  // collected a gem
  if (event.type === "gem") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "bing"
    });
  }
};

/* Set this player references
	---------------------------------------- */

game.prototype.set_this_player_refs = function() {
  // set player ref
  if (this.core.state.players[this.player_id]) {
    this.player = this.core.state.players[this.player_id];
  }

  // set object ref
  if (this.core.state.objects["player-" + this.player_id]) {
    this.player_obj = this.core.state.objects["player-" + this.player_id];
  }
};

/* ========================================================================
    Game
    Scores
 ========================================================================== */

/* Build score interface
    ---------------------------------------- */

game.prototype.init_score = function() {
  if (!this.scheme.score) {
    return;
  }

  this.div_score = element({ class: "score" });
  append(this.div, this.div_score);

  this.div_score_gem = element({ class: "gem" });
  this.div_score_text = element({ class: "text" });
  append(this.div_score, this.div_score_gem);
  append(this.div_score, this.div_score_text);

  // are we doing levels
  if (this.scheme.levels) {
    this.div_score_bar = element({ class: "bar" });
    this.div_score_bar_in = element({ class: "bar-inner" });
    this.div_score_level = element({ class: "level hex-button", text: " LVL" });
    this.div_score_level_num = element({ class: "level-num", text: "1" });
    append(this.div_score, this.div_score_bar);
    append(this.div_score_bar, this.div_score_bar_in);
    append(this.div_score, this.div_score_level);
    append(this.div_score_level, this.div_score_level_num);
  }
};

/* Set score interface
    ---------------------------------------- */

game.prototype.set_score = function() {
  if (!this.scheme.score) {
    return;
  }
  if (!this.player) {
    hide(this.div_score);
    return;
  } else {
    show(this.div_score);
  }

  this.div_score_text.innerHTML = this.player.score;
  if (this.scheme.levels) {
    this.div_score_level_num.innerHTML = this.player.level + 1;

    // do exp bar
    var width = 0;
    var this_level = this.scheme.levels.score[this.player.level];
    var next_level = this.scheme.levels.score[this.player.level + 1];
    if (this_level && next_level) {
      width = (
        ((this.player.score - this_level) / (next_level - this_level)) *
        94
      ).fixed();
    }
    this.div_score_bar_in.style.width = width + "%";
  }
};

/* ========================================================================
    Game
    Timer
 ========================================================================== */

/* Build time interface
    ---------------------------------------- */

game.prototype.init_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  // time divs
  this.div_time = element({ class: "time" });
  this.div_timeout = element({ class: "timeout" });
  append(this.div, this.div_time);
  append(this.div, this.div_timeout);
  hide(this.div_timeout);

  this.display_time = "";
};

/* Run the time interface
    ---------------------------------------- */

game.prototype.run_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  var secs;

  // counting up
  if (this.scheme.time_limit === 0) {
    secs = floor(this.core.state.frame / 24);

    // counting down
  } else {
    var dif = this.scheme.time_limit - this.core.state.frame;
    secs = ceil(dif / 24);

    // timeout
    if (dif === 240) {
      show(this.div_timeout);
    }
    if (dif <= 240 && dif % 24 === 0 && dif > 1) {
      this.audio.play("bloop2", 0.5);
    }
    if (dif === 1) {
      hide(this.div_timeout);
    }
    if (secs <= 10) {
      if (dif % 24 === 0 && secs >= 1) {
        this.div_timeout.innerHTML = secs;
      }
      if (dif === 96) {
        this.audio.play("timeout", 0.8);
      }
    }
  }

  // do time
  var new_time = "0:00";
  if (secs > 0) {
    var minutes = floor(secs / 60),
      seconds = (secs - minutes * 60).toString();
    seconds = seconds.length < 2 ? "0" + seconds : seconds;
    new_time = minutes + ":" + seconds;
  }
  if (this.display_time !== new_time) {
    this.display_time = new_time;
    this.div_time.innerHTML = new_time;
  }
};

/* ========================================================================
	Audio
 ========================================================================== */

window.AudioContext = window.AudioContext || window.webkitAudioContext;

function audio(assets_url) {
  var self = this;

  this.cont = new AudioContext();
  this.buffers = {};
  this.repeaters = {};
  this.volume = 0.1;
  this.stored_volume = 0.1;

  // button hover swish events
  this.button_hover = null;
  document.onmousemove = function(e) {
    if (self.volume == 0) {
      return;
    }
    if (
      e.target.classList.contains("button") ||
      e.target.tagName.toLowerCase() == "button"
    ) {
      if (
        e.target != self.button_hover &&
        !e.target.classList.contains("disabled")
      ) {
        self.button_hover = e.target;
        self.play("bloop1", 1);
      }
    } else {
      self.button_hover = null;
    }
  };
}

/* Set volume
	---------------------------------------- */

audio.prototype.set_global_volume = function(vol) {
  this.volume = vol;
};

/* Add buffers
	---------------------------------------- */

audio.prototype.add_buffers = function(buffers) {
  this.buffers = Object.assign(this.buffers, buffers);
};

/* Play a file
	---------------------------------------- */

audio.prototype.play = function(key, volume, repeat) {
  // if no sound effect
  if (!this.buffers[key]) {
    return;
  }

  // if we're not active
  if (!document.hasFocus() && key !== "join") {
    return;
  }

  var obj = {};
  obj.audio_key = key;
  obj.gain = this.cont.createGain();
  obj.source = this.cont.createBufferSource();
  obj.source.buffer = this.buffers[key];
  obj.source.connect(obj.gain);
  obj.gain.connect(this.cont.destination);
  obj.source.loop = repeat;
  obj.source.start(0);

  this.set_volume(obj, volume);

  return obj;
};

/* Set volume
	---------------------------------------- */

audio.prototype.set_volume = function(obj, volume) {
  if (!obj) {
    return;
  }
  volume = !volume ? 0 : min(volume, 1);
  obj.gain.gain.value = (volume * this.volume).fixed();
};

/* Stop playing audio
	---------------------------------------- */

audio.prototype.stop = function(obj) {
  this.cont.close();
  this.cont = new AudioContext();
};

/* ========================================================================
	Element Functions
 ========================================================================== */

function element(props) {
  // create the element
  var type = props.type ? props.type : "div",
    el = document.createElement(type);

  // set properties
  if (props.id) {
    el.id = props.id;
  }
  if (props.src) {
    el.src = props.src;
  }
  if (props.intype) {
    el.type = props.intype;
  }
  if (props.class) {
    el.className = props.class;
  }
  if (props.text) {
    el.innerHTML = props.text;
  }
  if (props.value) {
    el.value = props.value;
  }
  if (props.data) {
    el.dataset.data = props.data;
  }
  if (props.placeholder) {
    el.placeholder = props.placeholder;
  }
  if (props.maxlength) {
    el.maxLength = props.maxlength;
  }
  if (props.href) {
    el.href = props.href;
  }

  return el;
}

function select(id) {
  return document.getElementById(id);
}

function hide(el) {
  el.style.display = "none";
}

function show(el) {
  el.style.display = "block";
}

function remove(el) {
  el.parentNode.removeChild(el);
}

function empty(el) {
  while (el.firstChild) {
    el.removeChild(el.firstChild);
  }
}

function append(parent, child) {
  parent.appendChild(child);
}

function add_class(el, class_name) {
  var split = el.className.split(" ");
  if (!split.includes(class_name)) {
    split.push(class_name);
  }
  el.className = split.join(" ");
}

function remove_class(el, class_name) {
  var split = el.className.split(" "),
    i = split.indexOf(class_name);
  if (i != -1) {
    split.splice(i, 1);
  }
  el.className = split.join(" ");
}

function display_time(frames) {
  var secs = floor(frames / 30);
  var minutes = floor(secs / 60);
  var seconds = (secs - minutes * 60).toString();
  seconds = seconds.length < 2 ? "0" + seconds : seconds;
  return minutes + ":" + seconds;
}

function debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, br) {
  var e = select("debug");
  if (br) {
    e.innerHTML += "<br>";
  } else {
    e.innerHTML = "";
  }
  if (s1 != undefined) {
    e.innerHTML += s1;
  }
  if (s2 != undefined) {
    e.innerHTML += " | " + s2;
  }
  if (s3 != undefined) {
    e.innerHTML += " | " + s3;
  }
  if (s4 != undefined) {
    e.innerHTML += " | " + s4;
  }
  if (s5 != undefined) {
    e.innerHTML += " | " + s5;
  }
  if (s6 != undefined) {
    e.innerHTML += " | " + s6;
  }
  if (s7 != undefined) {
    e.innerHTML += " | " + s7;
  }
  if (s8 != undefined) {
    e.innerHTML += " | " + s8;
  }
  if (s9 != undefined) {
    e.innerHTML += " | " + s9;
  }
}

function debugbr(s1, s2, s3, s4, s5, s6, s7, s8, s9) {
  debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, true);
}

/* ========================================================================
	Input
 ========================================================================== */

function input(callback) {
  var self = this;
  this.callback = callback;

  // default action keys
  this.action_keys = {
    move: ["0"], // click
    shoot: ["2", ["0", "17"], ["0", "18"], ["0", "91"]], // click, ctrl, alt, cmd
    jump: ["32"], // space
    switch_watcher_camera: ["80"], // p
    follow_weapon: ["70"], // f
    follow_mouse: ["1"], // middle click
    // move_left: ["37", "65"], // left, a
    // move_up: ["38", "87"], // up, w
    // move_right: ["39", "68"], // right, d
    // move_down: ["40", "83"], // down, s
    show_settings: ["27", "13"], // esc, enter
    weapon_select_1: ["49"], // 1
    weapon_select_2: ["50"], // 2
    weapon_select_3: ["51"], // 3
    weapon_select_4: ["52"], // 4
    weapon_select_5: ["53"], // 5
    weapon_select_6: ["54"], // 6
    weapon_select_7: ["55"], // 7
    weapon_select_8: ["56"], // 8
    weapon_select_9: ["57"] // 9
  };

  // set up reference for pressed key codes
  this.key_codes = {};

  // cursor
  this.cursor_moved = false;
  this.cursor = { x: 0, y: 0 };

  // set cursor points
  document.body.onmousemove = function(e) {
    if (e.target.id === "game_input") {
      self.input_cursor(e.clientX, e.clientY);
    }
  };

  // prevent default right click behaviour
  document.body.oncontextmenu = function(e) {
    e.preventDefault();
    return false;
  };

  // manage click events
  document.body.onmousedown = function(e) {
    if (e.target.id === "game_input") {
      self.input_button(e.button, "down");
    }
    if (e.button == 1) {
      e.preventDefault();
      return false;
    }
  };
  document.body.onmouseup = function(e) {
    self.input_button(e.button, "up");
  };

  // mouse wheel
  if ("onmousewheel" in document.body) {
    document.body.onmousewheel = function(e) {
      e.preventDefault ? e.preventDefault() : (e.returnValue = false);
      e = e || window.event;
      self.scroll_wheel(e);
      return false;
    };
  } else {
    document.body.addEventListener("DOMMouseScroll", function(e) {
      self.scroll_wheel(e);
    });
  }

  // manage keyboard events
  document.body.onkeydown = function(e) {
    self.input_button(e.keyCode, "down");
  };
  document.body.onkeyup = function(e) {
    self.input_button(e.keyCode, "up");
  };

  // turn off input when window is not focused
  window.onblur = function() {
    self.input_reset();
  };
}

/* Is an action active
	---------------------------------------- */

input.prototype.active = function(type) {
  const action = this.action_keys[type];
  if (!action) {
    return;
  }
  for (let i = 0; i < action.length; i++) {
    const codes = action[i];
    if (Array.isArray(codes)) {
      let trigger = true;
      for (let i2 = 0; i2 < codes.length; i2++) {
        const code = codes[i2];
        if (!this.key_codes[code]) {
          trigger = false;
        }
      }
      if (trigger) {
        return true;
      }
    } else {
      if (this.key_codes[codes]) {
        return true;
      }
    }
  }
};

/* Find the action of a code
	---------------------------------------- */

input.prototype.find_action = function(code) {
  const actions = [];
  for (let key in this.action_keys) {
    for (let i = 0; i < this.action_keys[key].length; i++) {
      const codes = this.action_keys[key][i];
      if (!Array.isArray(codes) && String(codes) === String(code)) {
        const obj = { type: key };
        // if (key == "show_settings") {
        //   if (this.actions.shoot) {
        //     return [];
        //   }
        // }

        // please don't tell anybody I did this
        if (key == "weapon_select_1") {
          obj.type = "weapon_select";
          obj.n = 0;
        }
        if (key == "weapon_select_2") {
          obj.type = "weapon_select";
          obj.n = 1;
        }
        if (key == "weapon_select_3") {
          obj.type = "weapon_select";
          obj.n = 2;
        }
        if (key == "weapon_select_4") {
          obj.type = "weapon_select";
          obj.n = 3;
        }
        if (key == "weapon_select_5") {
          obj.type = "weapon_select";
          obj.n = 4;
        }
        if (key == "weapon_select_6") {
          obj.type = "weapon_select";
          obj.n = 5;
        }
        if (key == "weapon_select_7") {
          obj.type = "weapon_select";
          obj.n = 6;
        }
        if (key == "weapon_select_8") {
          obj.type = "weapon_select";
          obj.n = 7;
        }
        if (key == "weapon_select_9") {
          obj.type = "weapon_select";
          obj.n = 8;
        }
        actions.push(obj);
      }
    }
  }
  return actions;
};

/* Process input events
	---------------------------------------- */

input.prototype.input_button = function(code, type) {
  // ignore input on a text box
  if (document.activeElement.tagName.toLowerCase() === "input") {
    return;
  }

  if (type == "up") {
    this.key_codes[code] = false;
  }
  if (type == "down") {
    this.key_codes[code] = true;
    const actions = this.find_action(code);
    for (let i = 0; i < actions.length; i++) {
      this.callback(actions[i]);
    }
  }
};

/* Cursor move
    ---------------------------------------- */

input.prototype.input_cursor = function(x, y) {
  this.cursor_moved = true;
  this.cursor.x = x;
  this.cursor.y = y;
};

/* Scroll wheel
    ---------------------------------------- */

input.prototype.scroll_wheel = function(e) {
  // normalize delta for cross browser
  var d = e.detail,
    w = e.wheelDelta,
    d = d ? (w && (f = w / d) ? d / f : -d / 1.35) : w / 120;

  // up or down
  var down = d < 0 ? true : false;

  // event
  this.callback({ type: "weapon_scroll", down: down });
};

/* Reset actions
    ---------------------------------------- */

input.prototype.input_reset = function() {
  for (key in this.key_codes) {
    this.key_codes[key] = false;
  }
};

/* ========================================================================
	Asset Loader
 ========================================================================== */

function loader(assets_url, assets, onload) {
  var self = this;

  // set up loading values
  this.onload = onload;
  this.output = {};
  this.loaded = 0;
  this.count = 0;
  for (var type in assets) {
    this.count += Object.keys(assets[type]).length;
    this.output[type] = {};
  }

  // set up audio
  if (assets.audio) {
    if (Object.keys(assets.audio).length > 0) {
      this.audio_context = new AudioContext();
    }
  }

  // do the loading
  for (var type in assets) {
    for (var key in assets[type]) {
      var url = assets_url + assets[type][key];
      if (type == "json") {
        this.json(url, type, key);
      }
      if (type == "img") {
        this.image(url, type, key);
      }
      if (type == "audio") {
        this.audio(url, type, key);
      }
    }
  }
}

/* Load JSON
	---------------------------------------- */

loader.prototype.json = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.overrideMimeType("application/json");
  request.open("GET", url, true);
  request.onreadystatechange = function() {
    if (request.readyState == 4 && request.status == "200") {
      var response = JSON.parse(request.responseText);
      self.output[type][key] = response;
      self.check_loaded();
    }
  };
  request.send(null);
};

/* Load Image
	---------------------------------------- */

loader.prototype.image = function(url, type, key) {
  var self = this;

  this.output[type][key] = new Image();
  this.output[type][key].src = url;

  // when image is loaded
  this.output[type][key].onload = function() {
    self.check_loaded();
  };
};

/* Load Audio
	---------------------------------------- */

loader.prototype.audio = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.responseType = "arraybuffer";
  request.onload = function() {
    self.audio_context.decodeAudioData(request.response, function(buffer) {
      if (buffer) {
        var file = self.audio_context.createBufferSource();
        file.buffer = buffer;
        file.connect(self.audio_context.destination);

        var gain = self.audio_context.createGain();
        file.connect(gain);
        gain.connect(self.audio_context.destination);

        file.loop = true;

        // gain.gain.value = 1;
        // file.start(0);

        // this.files[key] = this.cont.createBufferSource();
        // this.files[key].buffer = files[key];
        // this.files[key].connect(this.cont.destination);

        // // set up gain node
        // this.gain[key] = this.cont.createGain();
        // this.files[key].connect(this.gain[key]);
        // this.gain[key].connect(this.cont.destination);

        self.output.audio[key] = buffer;
        self.check_loaded();
      }
    });
  };
  request.send(null);
};

/* Check Assets Are Loaded
	---------------------------------------- */

loader.prototype.check_loaded = function() {
  this.loaded++;

  // if we are not ready yet
  if (this.count <= this.loaded) {
    this.onload(this.output);
  }
};

/* ========================================================================
    Onboarding
 ========================================================================== */

function onboarding() {
  this.count = 0;
  this.done = false;
  this.action = {
    move: false,
    jump: false,
    shoot: false
  };

  if (typeof Storage !== "undefined") {
    this.count = localStorage.getItem("pants_onboarding") || 0;
    this.done = this.count > 1;
  }
}

/* Trigger onboardingness
	---------------------------------------- */

onboarding.prototype.set = function(type) {
  if (this.done) {
    return;
  }
  this.action[type] = true;
  for (let key in this.action) {
    if (!this.action[key]) {
      return;
    }
  }
  this.done = true;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_onboarding", this.count + 1);
  }
};

/* ========================================================================
    Socket Messages
    handle connection and message data to and from the server
 ========================================================================== */

function SocketConnection(callback) {
  var self = this;

  // socket connection
  this.io = io(DOMAIN + ":" + PORT);
  this.io.on("message", function(message) {
    self.message_receive(message);
  });
  this.io.on("disconnect", function() {
    callback({ type: "wait_for_connection" });
  });

  this.callback = callback;

  // ids
  this.message_receive_ids = [
    "full",
    "connected",
    "player_join",
    "player_leave",
    "game_wait",
    "game_start",
    "game_end",
    "game_state",
    "ping"
  ];

  this.message_send_ids = [
    "watcher",
    "send_name",
    "player_input",
    "weapon_selected",
    "respawn",
    "ping"
  ];

  // string separator
  this.message_separator = "|";
}

/* Send messages to server
	---------------------------------------- */

SocketConnection.prototype.message_send = function(type, props) {
  var i = this.message_send_ids.indexOf(type);

  // if not a valid message
  if (i === "undefined") {
    return;
  }

  // send message
  var self = this;
  var message = i + this.message_separator + props.join(this.message_separator);
  if (this.lag) {
    setTimeout(function() {
      self.io.send(message);
    }, this.lag);
  } else {
    this.io.send(message);
  }
};

/* Receive messages from server
	---------------------------------------- */

SocketConnection.prototype.message_receive = function(message) {
  // get type of message from id
  var split = message.split(this.message_separator);
  var id = parseInt(split[0]);

  // if not valid id
  if (!this.message_receive_ids[id]) {
    return;
  }
  var type = this.message_receive_ids[id];
  var event = { type: type };

  // prepare information for event handler
  if (type === "full") {
  } else if (type === "connected") {
    event.player_id = split[1] === "null" ? null : parseInt(split[1]);
    event.name = split[2];
    event.players = split[3];
    event.scheme = split[4];
  } else if (type === "player_join") {
    event.user_id = split[1];
    event.name = split[2];
    event.player_id = parseInt(split[3]);
  } else if (type === "player_leave") {
    event.user_id = split[1];
  } else if (type === "game_wait") {
  } else if (type === "game_start") {
    event.reset_players = parseInt(split[1]);
    event.bg_str = split[2];
    event.fg_str = split[3];
    event.gravity_map = split[4];
  } else if (type === "game_end") {
  } else if (type === "game_state") {
    event.frames = parseInt(split[1]);
    event.state = split[2];
    event.responses = split[3];
    event.damages = split[4];
  } else if (type === "ping") {
    event.frame = parseInt(split[1]);
  }

  // run event
  this.callback(event);
};

/* ========================================================================
    Multiplayer
    Player Deaths
 ========================================================================== */

/* Check if we're dead
    ---------------------------------------- */

multiplayer.prototype.frame_dead = function() {
  // not ready for any death stuff
  if (!this.game || !this.game.core || !this.game.player) {
    return;
  }

  // count up to deadness
  if (this.game.player.dead) {
    if (!this.dead) {
      if (this.wait_for_dead < 48) {
        this.wait_for_dead++;
      } else {
        this.death();
      }
    }
  } else {
    this.wait_for_dead = 0;
    if (this.dead) {
      this.respawn();
    }
  }

  // deadness
  if (this.dead) {
    if (this.wait_for_respawn > 0) {
      this.wait_for_respawn--;
      if (this.wait_for_respawn === 0) {
        this.div_dead_countdown.innerHTML = "Click to respawn";
        remove_class(this.button_respawn, "disabled");
      } else {
        this.div_dead_countdown.innerHTML =
          "Respawn in " + ceil(this.wait_for_respawn / 24) + " seconds";
      }
    }
  }
};

/* We have died
    ---------------------------------------- */

multiplayer.prototype.death = function() {
  this.dead = true;
  this.wait_for_dead = 0;
  this.wait_for_respawn = 96;

  hide(this.div_dead_text);
  add_class(this.button_respawn, "disabled");
  show(this.div_dead);
};

/* Respawn triggered
    ---------------------------------------- */

multiplayer.prototype.respawn = function() {
  this.dead = false;
  hide(this.div_dead);
};

/* ========================================================================
    Multiplayer
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

multiplayer.prototype.run_event = function(event) {
  if (!event) {
    return;
  }

  // handle arrays of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // run events
  if (event.type === "full") {
    this.game_full();
  } else if (event.type === "connected") {
    this.connected(event);
  } else if (event.type === "wait_for_connection") {
    this.wait_for_connection();
  } else if (event.type === "player_join") {
    this.player_join(event);
  } else if (event.type === "player_leave") {
    this.player_leave(event);
  } else if (event.type === "game_wait") {
  } else if (event.type === "game_start") {
    this.game_start(event);
  } else if (event.type === "game_end") {
    this.game_end(event);
  } else if (event.type === "game_state") {
    this.game_state_received(event);
  } else if (event.type === "collect") {
    this.event_collect(event);
  } else if (event.type === "ground_damage") {
    this.event_ground_damage(event);
  } else if (event.type === "player_death") {
    this.event_player_death(event);
  } else if (event.type === "weapon_selected") {
    this.sockets.message_send("weapon_selected", [event.weapon]);
  } else if (event.type === "ping") {
    this.event_ping(event);
  }

  // send event down a level
  else if (this.game) {
    this.game.run_event(event);
  }
};

/* Collected item
    ---------------------------------------- */

multiplayer.prototype.event_collect = function(event) {
  if (this.initialised) {
    // wait to recreate
    this.wait_to_create[event.obj] = this.game.core.state.frame;

    // run client collection events
    this.game.run_event(event);

    // run players interface
    this.players_interface();
  }
};

/* Player death
    ---------------------------------------- */

multiplayer.prototype.event_player_death = function(event) {
  // only use server events
  if (!event.from_server) {
    return;
  }

  // run it
  if (this.initialised) {
    this.player_death(event);
  }
};

/* Ping
    ---------------------------------------- */

multiplayer.prototype.event_ping = function(event) {
  // did we request this
  if (!this.pings[event.frame]) {
    return;
  }

  var now = new Date().getTime();

  // record end time for ping
  this.pings[event.frame].end = now;

  // go through all pings
  var ping_count = 0;
  var ping_total = 0;
  for (var frame in this.pings) {
    var ping = this.pings[frame];

    // remove old ones
    if (ping.end && ping.end + 10000 < now) {
      delete this.pings[frame];
      continue;
    }

    // calculate average
    ping_total += ping.end - ping.start;
    ping_count++;
  }

  // show ping
  this.div_ping.innerHTML = round(ping_total / ping_count);
};

/* ========================================================================
    Mulitplayer
    Frames
 ========================================================================== */

/* Start/stop loop
    ---------------------------------------- */

multiplayer.prototype.loop_start = function(start_frame) {
  // close any open loops
  this.loop_stop();

  // set loop vars
  this.start_frame = start_frame || 0;
  this.frames = this.start_frame;
  this.start_time = new Date().getTime();

  var self = this;
  this.interval = setInterval(function() {
    self.run_tick();
  }, 10);
};

multiplayer.prototype.loop_stop = function() {
  clearInterval(this.interval);
};

/* Run tick
    ---------------------------------------- */

multiplayer.prototype.run_tick = function() {
  // calculate number of frames since game start
  var now = new Date().getTime();
  var frames =
    this.start_frame + Math.floor((now - this.start_time) / this.ms_loop);

  // get number of remaining steps
  var frame_difference = frames - this.frames;

  // waiting
  if (frame_difference < 1) {
    return;
  }

  // too much lag
  if (frame_difference > 10) {
    this.loop_start();
    // console.log("tick lag | " + frame_difference);
    return;
  }

  // go through frames to process
  for (var i = 0; i < frame_difference; i++) {
    this.frame();
  }

  // run display loop
  this.game.frame_display();

  // record time this was done
  this.fpses.push(new Date().getTime());
  if (this.fpses.length > 72) {
    this.div_fps.innerHTML = round(
      (3000 / (this.fpses[72] - this.fpses[0])) * this.fps
    );
    this.fpses.splice(0, 1);
  }
};

/* Frame process
    ---------------------------------------- */

multiplayer.prototype.frame = function() {
  // increment frame count
  this.frames++;

  // store input
  if (this.game.player) {
    var action = this.game.get_input();
    if (action) {
      this.store_input[this.frames] = action;
      this.send_input(action);
    }
  }

  // run frame
  this.frame_run(this.frames);

  // remove old states
  this.remove_old_states();

  // run ground damage checks
  this.frame_ground();

  // run death frames
  this.frame_dead();

  // run players interface
  if (this.frames % 48 === 0) {
    this.players_interface();
  }

  // run ping
  if (this.frames % 12 === 0) {
    this.sockets.message_send("ping", [this.frames]);
    this.pings[this.frames] = { start: new Date().getTime() };
  }
};

/* Frame run
    ---------------------------------------- */

multiplayer.prototype.frame_run = function(frame) {
  // run core and store response
  var response = this.game.frame_core(frame, this.store_input[frame]);
  if (response.success) {
    this.store_responses.push(response);
  }

  // events
  this.run_event(this.game.core.state.events);

  // unpack any stored server state for this frame
  if (this.store_packet[frame]) {
    this.set_game_state(this.store_packet[frame]);
    delete this.store_packet[frame];
  }

  // record game state
  this.store_state[frame] = {
    frames: frame,
    state: this.game.core.pack_state(this.game.core.state)
  };
};

/* Remove old states
    ---------------------------------------- */

multiplayer.prototype.remove_old_states = function() {
  for (var frame in this.store_packet) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_packet[frame];
    }
  }
  for (var frame in this.store_state) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_state[frame];
    }
  }
  for (var frame in this.store_input) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_input[frame];
    }
  }
  for (var i = 0; i < this.store_responses.length; i++) {
    if (this.store_responses[i].frame + 50 < this.frames) {
      this.store_responses.splice(i, 1);
    }
  }
};

/* ========================================================================
    Mulitplayer
    Ground Damage
 ========================================================================== */

/* Damage the ground event
    ---------------------------------------- */

multiplayer.prototype.event_ground_damage = function(event) {
  var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

  // did we already have this happen
  if (this.ground_events[key]) {
    return;
  }

  // get boundaries
  var x1 = max(round(event.x - event.radius), 0);
  var x2 = min(round(event.x + event.radius), this.game.core.map.w - 1);
  var y1 = max(round(event.y - event.radius), 0);
  var y2 = min(round(event.y + event.radius), this.game.core.map.h - 1);
  var w = x2 - x1;
  var h = y2 - y1;

  // get array from the map
  var arr = this.game.core.map.get_block(x1, y1, w, h);

  // get piece of the map
  var canv = this.game.get_land_block(x1, y1, w, h);

  // store backed up damage
  this.ground_temp[key] = {
    frame: event.frame,
    x: x1,
    y: y1,
    arr: arr,
    canv: canv
  };

  // store the event itself
  this.ground_events[key] = duplicate_obj(event);
  this.ground_events[key].done = true;

  // run the event
  this.game.run_event(event);
};

/* Check ground damage events
    ---------------------------------------- */

multiplayer.prototype.frame_ground = function() {
  // go through all checks
  for (var key in this.ground_temp) {
    if (this.frames > this.ground_temp[key].frame + 40) {
      clog("damage not confirmed");
      this.undo_ground_damage(this.ground_temp[key], key);
      delete this.ground_temp[key];
      delete this.ground_events[key];
    }
  }

  // go through all events
  for (var key in this.ground_events) {
    var event = this.ground_events[key];
    if (this.frames >= event.frame) {
      if (!event.done) {
        this.game.run_event(event);
        this.ground_events[key].done = true;
      }
    }
    if (this.frames > this.ground_events[key].frame + 50) {
      delete this.ground_events[key];
    }
  }
};

/* Undo ground damage
    ---------------------------------------- */

multiplayer.prototype.undo_ground_damage = function(damage, d_key) {
  // restore it
  this.game.core.map.set_block_from_arr(damage.x, damage.y, damage.arr);
  this.game.draw_land_block(damage.x, damage.y, damage.canv);

  // redo any other events that happened since
  for (var key in this.ground_events) {
    if (d_key === key) {
      continue;
    }
    this.game.run_event(this.ground_events[key]);
  }
};

/* Server response
    ---------------------------------------- */

multiplayer.prototype.resolve_ground = function(str) {
  if (!str) {
    return;
  }

  // unpack damages
  var split = str.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    var event = {
      type: "ground_damage",
      frame: parseInt(split2[0]),
      x: parseFloat(split2[1]),
      y: parseFloat(split2[2]),
      radius: parseFloat(split2[3]),
      dig: split2[4] === "1"
    };
    var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

    // confirm already done damage
    if (this.ground_temp[key]) {
      delete this.ground_temp[key];

      // wait to perform it
    } else {
      this.ground_events[key] = event;
    }
  }
};

/* ========================================================================
    Multiplayer
    Interface
 ========================================================================== */

/* Init interface
    ---------------------------------------- */

multiplayer.prototype.init_interface = function() {
  // loading screen
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);

  // between games screen
  this.between_games = element({
    class: "cont_center",
    text: "Dimension jump in progress!<br><br><div class='loader'></div>"
  });
  append(this.div, this.between_games);
  hide(this.between_games);

  // performance
  this.div_ping = element({ class: "ping" });
  this.div_fps = element({ class: "fps" });
  append(this.div, this.div_ping);
  append(this.div, this.div_fps);

  // dead div
  this.div_dead = element({ class: "full full_bg" });
  this.div_dead_cont = element({
    class: "cont_center red",
    text: "<h3>You have died!</h3>" + shareLinksText
  });
  this.div_dead_text = element({
    type: "p",
    text: "You were killed in action."
  });
  this.div_dead_countdown = element({ type: "p", class: "grey" });
  this.div_dead_buttons = element({ class: "buttons" });
  this.button_respawn = element({
    type: "button",
    class: "button red disabled",
    text: "Respawn"
  });
  append(this.div, this.div_dead);
  append(this.div_dead, this.div_dead_cont);
  append(this.div_dead_cont, this.div_dead_text);
  append(this.div_dead_cont, this.div_dead_countdown);
  append(this.div_dead_cont, this.div_dead_buttons);
  append(this.div_dead_buttons, this.button_respawn);
  hide(this.div_dead);

  // game full screen
  this.full = element({
    class: "cont_center",
    text:
      "Game server full. Please try again later...<br><br><div class='loader'></div>"
  });
  append(this.div, this.full);
  hide(this.full);

  // respawn on click
  var self = this;
  this.button_respawn.onclick = function() {
    if (self.wait_for_respawn === 0) {
      self.sockets.message_send("respawn", []);
    }
  };

  // players
  this.div_players = element({ class: "players" });
  this.table_players = element({ type: "table" });
  append(this.div, this.div_players);
  append(this.div_players, this.table_players);
};

/* ========================================================================
    App
 ========================================================================== */

function multiplayer(
  assets,
  assets_url,
  audio,
  input,
  name,
  watcher,
  run_event,
  sockets,
  onboarding
) {
  // setup
  this.assets = assets;
  this.assets_url = assets_url;
  this.audio = audio;
  this.input = input;
  this.name = name;
  this.watcher = watcher;
  this.top_event = run_event;
  this.sockets = sockets;
  this.scheme = null;
  this.lag = 0;
  this.onboarding = onboarding;

  // loop
  this.fps = 24;
  this.ms_loop = Math.floor(1000 / this.fps);
  this.ms_tick = 10;
  this.active = false;

  // main divs
  this.div = element({ class: "full" });
  this.connecting = element({
    class: "cont_center",
    text: "Waiting for connection...<br><br><div class='loader'></div>"
  });
  append(this.div, this.connecting);

  // set up interface
  this.init_interface();

  // when joining a game record any incoming events for later use
  this.initial_game_events = [];
}

/* Wait for connection
    ---------------------------------------- */

multiplayer.prototype.wait_for_connection = function(event) {
  this.loop_stop();
  hide(this.between_games);
  hide(this.loading);
  hide(this.div_dead);
  show(this.connecting);
};

/* Connected
    ---------------------------------------- */

multiplayer.prototype.connected = function(event) {
  // set up scheme
  this.scheme = deepmerge(schemes.default, schemes[event.scheme]);

  // active values
  this.name = event.name;
  this.player_id = event.player_id;
  this.player_count = 0;
  this.players = {};
  this.players_ref = {};

  // go through string of players
  var split = event.players.split("+");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("/");
    this.init_player({
      user_id: split2[0],
      name: split2[1],
      player_id: parseInt(split2[2])
    });
  }

  // run the player interface
  this.players_interface();
};

/* Start game
    ---------------------------------------- */

multiplayer.prototype.game_start = function(event) {
  this.loading_start = true;
  this.initialised = false;
  this.gravity_map = event.gravity_map;

  this.game_close();

  // reset scores
  if (event.reset_players) {
    for (var id in this.players) {
      this.players[id].level = 0;
      this.players[id].score = 0;
    }
    this.players_interface();
  }

  // stored game states and actions
  this.store_packet = {};
  this.store_state = {};
  this.store_input = {};
  this.store_responses = [];

  // ground damage
  this.ground_temp = {};
  this.ground_events = {};

  // objects that we are waiting on for server confirmation
  this.wait_to_destroy = {};
  this.wait_to_create = {};

  // performance
  this.pings = {};
  this.fpses = [];

  // load the map from data url
  var self = this;
  new loader(
    "",
    {
      img: {
        bg: event.bg_str,
        fg: event.fg_str
      }
    },
    function(assets) {
      self.game_start_loaded(assets.img);
    }
  );
};

multiplayer.prototype.game_start_loaded = function(map) {
  // set up map
  var new_map = {
    fg: mapgen_canvas(map.fg.width, map.fg.height),
    bg: mapgen_canvas(map.bg.width, map.bg.height),
    gravity_map: this.gravity_map
  };
  new_map.fg.cont.drawImage(map.fg, 0, 0);
  new_map.bg.cont.drawImage(map.bg, 0, 0);

  // start up game object
  this.game = new game(
    this.assets,
    this.audio,
    this.input,
    this.scheme,
    new_map,
    this.players_ref,
    this.player_id,
    this.top_event,
    this.onboarding
  );
  append(this.div, this.game.div);

  // finished loading
  this.loading_start = false;
};

/* Init game
    ---------------------------------------- */

multiplayer.prototype.init_game = function(event) {
  if (!this.game || !this.game.core) {
    return;
  }

  // show interface
  hide(this.between_games);
  hide(this.div_dead);
  hide(this.connecting);
  hide(this.loading);

  // stop game
  this.loop_stop();

  // prepare state
  this.set_game_state(event, true);

  // start game
  this.game.start(event.frames);
  this.status = "active";

  // last frame a server packet was received
  this.last_packet = event.frames;
  this.disconnected = false;

  // run initial events
  this.run_event(this.initial_game_events);
  this.initial_game_events = [];
  this.initialised = true;

  // start loop
  this.loop_start(event.frames);
};

/* Close game
    ---------------------------------------- */

multiplayer.prototype.game_close = function(event) {
  this.loop_stop();
  if (this.game) {
    remove(this.game.div);
    delete this.game;
  }
};

/* End Game
    ---------------------------------------- */

multiplayer.prototype.game_end = function(event) {
  // stop game
  this.loop_stop();

  // stop audio
  this.audio.stop();

  // show loading screen
  hide(this.loading);
  hide(this.div_dead);
  hide(this.connecting);
  show(this.between_games);
};

/* Send input to server
    ---------------------------------------- */

multiplayer.prototype.send_input = function(action) {
  var arr = [this.frames, action.action, action.angle];
  if (action.action === "shoot") {
    arr.push(action.weapon);
  }
  this.sockets.message_send("player_input", arr);
};

/* ========================================================================
    Room Players
 ========================================================================== */

/* Create player objects
    ---------------------------------------- */

multiplayer.prototype.init_player = function(props) {
  // add player to array
  this.player_count++;
  this.players[props.user_id] = {
    name: props.name,
    id: props.player_id
  };

  // set players reference
  this.players_ref[props.player_id] = {
    user_id: props.user_id,
    name: props.name,
    level: 0
  };
};

/* Draw players interface
    ---------------------------------------- */

multiplayer.prototype.players_interface = function() {
  // are we good and active
  if (!this.initialised || !this.game.core.state.players) {
    return;
  }

  // show players
  var str = "";
  var sortable = this.players_sort();
  if (!sortable) {
    return;
  }

  // set leader id
  this.game.leader = parseInt(sortable[0].id);

  str = "<thead><th></th><th>lvl</th><th>score</th></thead>";
  for (var i = 0; i < sortable.length; i++) {
    var player = sortable[i];
    var tr_class = "";
    if (player.id == this.player_id) {
      tr_class += "highlight ";
    }
    if (player.dead) {
      tr_class += "dead ";
    }
    str +=
      "<tr class='" +
      tr_class +
      "''><td>" +
      player.name +
      "</td><td class='red'>" +
      (player.level + 1) +
      "</td><td class='green'>" +
      player.score +
      "</td></tr>";
  }

  // check for level ups
  for (var id in this.players_ref) {
    var player = this.players_ref[id];
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    if (player.level !== core_player.level) {
      this.run_event({
        type: "player_level",
        id: parseInt(id),
        prev: player.level,
        new: core_player.level
      });
      this.players_ref[id].level = core_player.level;
    }
  }

  // set content
  this.table_players.innerHTML = str;
};

/* Sort players by score
    ---------------------------------------- */

multiplayer.prototype.players_sort = function() {
  var sortable = [];
  for (var id in this.players_ref) {
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    sortable.push({
      id: id,
      name: this.players_ref[id].name,
      level: core_player.level,
      score: core_player.score,
      dead: core_player.dead
    });
  }
  sortable.sort(function(a, b) {
    return b.score - a.score;
  });
  return sortable;
};

/* Player has joined
    ---------------------------------------- */

multiplayer.prototype.player_join = function(event) {
  this.init_player(event, true);
  this.audio.play("join", 1);
};

/* Player left
    ---------------------------------------- */

multiplayer.prototype.player_leave = function(event) {
  if (!this.players[event.user_id]) {
    return;
  }

  var id = this.players[event.user_id].player_id;
  delete this.players_ref[id];
  delete this.players[event.user_id];
  this.player_count--;

  // remove from game
  if (this.game && this.game.core) {
    this.game.core.remove_player(id);
  }
};

/* ========================================================================
    Game States
 ========================================================================== */

/* Receive game state from server
    ---------------------------------------- */

multiplayer.prototype.game_state_received = function(event) {
  // if we are loading
  if (this.loading_start) {
    return;
  }

  // start the game
  if (!this.initialised || this.disconnected) {
    this.initialised = true;
    this.init_game(event);
    return;
  }

  var diff = event.frames - this.frames;

  // if we are too quick
  if (diff < 0) {
    // console.log("client too fast");
    this.init_game(event);
    return;
  }

  // if it's too far behind resync
  if (diff > 9) {
    // console.log("resync");
    this.init_game(event);
    return;
  }

  // apply the state
  if (event.frames === this.frames) {
    this.set_game_state(event);
  } else {
    this.store_packet[event.frames] = duplicate_obj(event);
  }
};

/* Set game state
    ---------------------------------------- */

multiplayer.prototype.set_game_state = function(event, ignore_res) {
  // run damages
  this.resolve_ground(event.damages);

  // unpack the state
  var state = this.game.core.unpack_state(event.state);

  // set players
  this.resolve_players(state, ignore_res);

  // set this player
  if (!ignore_res) {
    this.resolve_this_player(state, event.responses);
  }

  // set objects
  this.resolve_objects(state.objects, event.frames);

  // set explosions
  this.resolve_explosions(state.explosions, event.frames);

  // set game player references
  this.game.set_this_player_refs();
};

/* Resolve players
    ---------------------------------------- */

multiplayer.prototype.resolve_players = function(state, ignore_res) {
  // set all other players
  for (var key in state.players) {
    if (parseInt(key) !== this.player_id || ignore_res) {
      this.game.init_player(state.players[key], true);
    }
  }

  // remove players
  for (var key in this.game.core.state.players) {
    if (!state.players[key]) {
      this.game.core.remove_player(key);
    }
  }
};

/* Resolve this player
    ---------------------------------------- */

multiplayer.prototype.resolve_this_player = function(state, responses) {
  // prep server state objects
  var server_player = state.players[this.player_id];
  var server_obj = state.objects["player-" + this.player_id];
  if (!server_player || !server_obj) {
    return;
  }

  // prep server responses
  var server_responses = [];
  var split = responses.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    server_responses.push({
      frame: parseInt(split2[0]),
      success: split2[1] === "1",
      x: parseFloat(split2[2]),
      y: parseFloat(split2[3]),
      speed_x: parseFloat(split2[4]),
      speed_y: parseFloat(split2[5]),
      type: split2[6]
    });
  }

  // check player weapon
  if (server_player.weapon !== this.game.current_weapon) {
    this.sockets.message_send("weapon_selected", [this.game.current_weapon]);
  }

  // if we have no more actions
  if (this.store_responses.length === 0) {
    this.game.player.level = server_player.level;
    this.game.player.score = server_player.score;
    this.game.player.dead = server_player.dead;
    this.game.player.health = server_player.health;
    this.game.player.cooldown = server_player.cooldown;
    this.game.player.armoury = duplicate_obj(server_player.armoury);
    this.game.set_armoury();
  }

  // resolve our player
  for (var i = 0; i < this.store_responses.length; i++) {
    var client_response = this.store_responses[i];

    // go through action responses
    for (var j = 0; j < server_responses.length; j++) {
      var server_response = server_responses[j];

      // correct frame
      if (client_response.frame === server_response.frame) {
        // compare the response
        if (
          client_response.success === server_response.success &&
          client_response.x === server_response.x &&
          client_response.y === server_response.y &&
          client_response.speed_x === server_response.speed_x &&
          client_response.speed_y === server_response.speed_y
        ) {
          // clog("act success", server_response.frame, this.frames, server_response.type, client_response.x, server_response.x, client_response.y, server_response.y);
        } else {
          // resync the player
          clog(
            "act fail",
            server_response.frame,
            this.frames,
            server_response.type,
            client_response.x,
            server_response.x,
            client_response.y,
            server_response.y
          );
          if (!this.resync_this_player(server_response)) {
            this.game.init_player(server_player, false, true);
            this.game.create_object(server_obj);
            return;
          }
        }
        server_responses.splice(j, 1);
        this.store_responses.splice(i, 1);
        i--;
        break;
      }
    }
  }
};

/* Sync this player
    ---------------------------------------- */

multiplayer.prototype.resync_this_player = function(server_response) {
  // how far back is this
  var frame = server_response.frame;
  var frame_difference = this.frames - frame;

  // if it's too far back
  // if we have no state to roll back to
  if (frame_difference > 20 || !this.store_state[frame]) {
    // console.log("sync too far back | " + frame_difference);
    return false;
  }

  // reset game state
  this.set_game_state(this.store_state[frame], true);

  // reset player
  this.store_responses = [];
  this.game.player_obj.x = server_response.x;
  this.game.player_obj.y = server_response.y;
  this.game.player_obj.speed_x = server_response.speed_x;
  this.game.player_obj.speed_y = server_response.speed_y;

  // run all frames up to this point
  for (var i = 1; i <= frame_difference; i++) {
    this.frame_run(frame + i);
  }

  return true;
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_objects = function(objects, frame) {
  // check for uncreated objects
  for (var key in objects) {
    if (!this.game.core.state.objects[key]) {
      if (!this.wait_to_create[key] || this.wait_to_create[key] + 40 < frame) {
        delete this.wait_to_create[key];
        this.game.create_object(objects[key]);
      }
    }
  }

  // if there's no corresponding server object
  for (var key in this.game.core.state.objects) {
    if (!objects[key]) {
      // give them a delay
      if (!this.wait_to_destroy[key]) {
        this.wait_to_destroy[key] = frame + 40;
        continue;

        // remove when delay has expired
      } else if (this.wait_to_destroy[key] < frame) {
        delete this.game.core.state.objects[key];
        delete this.wait_to_destroy[key];
      }
    }
  }

  // match up objects
  for (var key in this.game.core.state.objects) {
    // if our player and waiting for action responses
    if (key === "player-" + this.player_id) {
      if (this.store_responses.length !== 0) {
        continue;
      }
    }

    var obj = this.game.core.state.objects[key];
    var res_obj = objects[key];

    // ignore any objects with no reference
    if (!res_obj) {
      continue;
    }

    // match values
    if (obj.type !== res_obj.type) {
      obj.type = res_obj.type;
      obj.c = this.game.c.objects[obj.type];
    }
    obj.grounded = res_obj.grounded;

    // if grounded or us
    if (obj.grounded || obj.player_id === this.player_id) {
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;

      // set interpolation position
    } else if (!obj.actioned) {
      obj.ghost = frame;
      obj.gx = obj.x;
      obj.gy = obj.y;
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;
    }
  }
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_explosions = function(explosions, frame) {
  // check for uncreated explosions
  for (var key in explosions) {
    if (!this.game.core.state.explosions[key]) {
      this.game.core.create_explosion(explosions[key]);

      // ensure correct position
    } else {
      this.game.core.state.explosions[key].x = explosions[key].x;
      this.game.core.state.explosions[key].y = explosions[key].y;
    }
  }
};

/* ========================================================================
    Game
    Tracker Arrows
 ========================================================================== */

/* Run the arrows
    ---------------------------------------- */

game.prototype.run_arrows = function() {
  for (var type in this.scheme.arrows) {
    var arrow = this.scheme.arrows[type];
    if (!arrow) {
      continue;
    }

    // find closest thing
    var lowest = 99999;
    var closest_obj = null;
    for (var key in this.core.state.objects) {
      var obj = this.core.state.objects[key];
      if (obj.type === "player" && obj.player_id === this.player_id) {
        continue;
      }
      if (obj.type === type) {
        var dist = this.core.map.get_distance(
          obj.x,
          obj.y,
          this.camera.x,
          this.camera.y
        );
        if (dist < lowest) {
          lowest = dist;
          closest_obj = obj;
        }
      }
    }
    if (!closest_obj) {
      continue;
    }

    // get screen position
    var pos = this.screen_position(closest_obj.x, closest_obj.y, 80);
    if (pos.on_screen) {
      continue;
    }

    // show an arrow
    var angle = this.core.map.get_heading(
      this.camera.x,
      this.camera.y,
      closest_obj.x,
      closest_obj.y
    );
    var dist = min(lowest, min(this.canvas.cx, this.canvas.cy)) - 22;
    var xy = xy_speed(angle, dist);
    this.sprites.push({
      type: "arrow-" + arrow,
      x: round(this.camera.x + xy.x),
      y: round(this.camera.y + xy.y),
      angle: angle_add(angle, 270)
    });
  }
};

/* ========================================================================
    Game
    Background Layer
 ========================================================================== */

/* Set up background
    ---------------------------------------- */

game.prototype.init_background = function() {
  this.bg = {};
  this.bg.parallax = 0.5;
  this.bg.x = 0;
  this.bg.y = 0;
  this.bg.w = this.img.bg.width;
  this.bg.h = this.img.bg.height;
  this.bg.pattern = this.canvas.cont.createPattern(this.img.bg, "repeat");
};

/* Draw the background
	---------------------------------------- */

game.prototype.draw_background = function() {
  // how much have we moved by
  var dx =
      this.core.map.get_distance_x(this.camera.x, this.camera.px) *
      this.bg.parallax,
    dy =
      this.core.map.get_distance_y(this.camera.y, this.camera.py) *
      this.bg.parallax;

  // add movement multiplied by parallax degree
  this.bg.x = n_loop(this.bg.x + dx, 0, this.bg.w);
  this.bg.y = n_loop(this.bg.y + dy, 0, this.bg.h);

  // draw it
  var size = max(this.canvas.h, this.canvas.w);
  this.canvas.cont.translate(
    this.bg.x + this.camera.sx,
    this.bg.y + this.camera.sy
  );
  this.canvas.cont.fillStyle = this.bg.pattern;
  this.canvas.cont.fillRect(-size, -size, size * 3, size * 3);
  this.canvas.cont.translate(
    -(this.bg.x + this.camera.sx),
    -(this.bg.y + this.camera.sy)
  );
};

/* ========================================================================
    Game
    Camera Position
 ========================================================================== */

/* Set up camera position
	---------------------------------------- */

game.prototype.init_camera = function() {
  this.camera = {};
  this.camera.x = round(this.map.fg.canv.width / 2);
  this.camera.y = round(this.map.fg.canv.height / 2);
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  // watcher follow player
  this.camera.watch_follow = "leader";
  this.camera.watch_follow_player = "";

  // camera weapon
  this.camera_weapon_key = null;

  // camera shake on hit
  this.camera.shake_frame = null;
  this.camera.sx = 0;
  this.camera.sy = 0;

  // camera focus event
  this.camera.focus = null;
  this.camera.focus_time = 0;
  this.camera.fx = 0;
  this.camera.fy = 0;

  // cursor
  this.cursor = { x: 0, y: 0 };

  // weapon following
  this.weapon_follow = false;
  this.weapon_following = "";
};

/* Switch watcher camera
	---------------------------------------- */

game.prototype.switch_watcher_camera = function() {
  if (!watch) {
    return;
  }
  var keys = Object.keys(this.players);
  var index = keys.indexOf(this.camera.watch_follow_player);
  if (index !== -1) {
    if (index === keys.length - 1) {
      this.camera.watch_follow_player = null;
      this.camera.watch_follow = "leader";
      this.set_alert("Following the Leader", "#ccffcc", 100);
      return;
    } else {
      this.camera.watch_follow_player = keys[index + 1];
    }
  } else {
    this.camera.watch_follow_player = keys[0];
  }
  console.log(this.camera.watch_follow_player);
  var player = this.players[this.camera.watch_follow_player];
  this.camera.watch_follow = "player";
  this.set_alert("Following " + player.name, "#eeeeee", 100);
};

/* Calculate current camera position
	---------------------------------------- */

game.prototype.run_camera = function() {
  // stop following if hit
  if (this.weapon_following && this.player && this.player.hit > 0) {
    this.weapon_following = "";
  }

  // set previous position
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  var x, y, move;

  // set fallback camera
  var watch_player_id = 0;
  if (this.camera.watch_follow === "leader") {
    watch_player_id = this.leader;
  } else if (this.camera.watch_follow === "player") {
    watch_player_id = this.camera.watch_follow_player;
  }

  // find object to follow
  var follow_obj = this.core.state.objects[this.weapon_following];
  var watch_obj = this.core.state.objects["player-" + watch_player_id];
  if (follow_obj) {
    x = follow_obj.dx;
    y = follow_obj.dy;
    move = 30;
  } else if (this.player_obj) {
    x = this.player_obj.dx;
    y = this.player_obj.dy;
    move = 60;
  } else if (watch_obj) {
    x = watch_obj.dx;
    y = watch_obj.dy;
    move = 30;
  }

  // go to focus event
  if (
    this.camera.focus != null &&
    this.camera.focus < this.core.state.frame &&
    this.camera.focus + this.camera.focus_time > this.core.state.frame
  ) {
    x = this.camera.fx;
    y = this.camera.fy;
    move = 100;

    // follow cursor
  } else if (this.mouse_follow || !move) {
    x = this.cursor.x;
    y = this.cursor.y;
    move =
      this.core.map.get_distance(this.camera.x, this.camera.y, x, y) * 0.05;
  }

  // move towards new position
  if (move) {
    var dx = this.core.map.get_distance_x(this.camera.x, x);
    var dy = this.core.map.get_distance_y(this.camera.y, y);
    var limit = check_speed(dx, dy, move);
    this.camera.x = this.core.map.loop_x(round(this.camera.x + limit.x));
    this.camera.y = this.core.map.loop_y(round(this.camera.y + limit.y));
  }

  // add screen shake
  this.camera.sx = 0;
  this.camera.sy = 0;
  var diff = this.camera.shake_frame
    ? this.core.state.frame - this.camera.shake_frame
    : 0;
  if (diff < 15 && diff > 0) {
    this.camera.sx = cos((diff / 2.5 - 1.5) * pi) * this.camera.shake_size;
    this.camera.sy = sin((diff / 3 - 1) * pi) * this.camera.shake_size;
  }

  // fix cursor input
  this.cursor_map();
};

/* Toggle weapon following
	---------------------------------------- */

game.prototype.toggle_weapon_follow = function(message) {
  this.weapon_follow = !this.weapon_follow;

  if (message) {
    var text = "on";
    if (!this.weapon_follow) {
      text = "off";
      this.weapon_following = "";
    }
    text = "Follow weapons " + text;
    this.set_alert(text, "#eee");
  }
};

/* Toggle mouse following
	---------------------------------------- */

game.prototype.toggle_mouse_follow = function() {
  this.mouse_follow = !this.mouse_follow;
  var text = this.mouse_follow ? "on" : "off";
  text = "Free cam " + text;
  this.set_alert(text, "#eee");
};

game.prototype.cancel_mouse_follow = function() {
  if (this.mouse_follow) {
    this.toggle_mouse_follow();
  }
};

/* Calculate cursor position on map
	---------------------------------------- */

game.prototype.cursor_map = function() {
  var scale_x = this.canvas.canv.offsetWidth / this.canvas.w;
  var scale_y = this.canvas.canv.offsetHeight / this.canvas.h;
  var x1 =
    this.camera.x +
    round((this.input.cursor.x - round(innerWidth / 2)) * scale_x);
  var y1 =
    this.camera.y +
    round((this.input.cursor.y - round(innerHeight / 2)) * scale_y);
  this.cursor.x = this.core.map.loop_x(round(x1));
  this.cursor.y = this.core.map.loop_y(round(y1));
};

/* Screen position of a co-ordinate
	---------------------------------------- */

game.prototype.screen_position = function(x, y, size) {
  var x1 =
      this.canvas.cx +
      this.core.map.get_distance_x(this.camera.x - this.camera.sx, x),
    y1 =
      this.canvas.cy +
      this.core.map.get_distance_y(this.camera.y - this.camera.sy, y),
    on_screen =
      x1 > -size &&
      x1 < this.canvas.w + size &&
      y1 > -size &&
      y1 < this.canvas.h + size;

  return {
    x: x1,
    y: y1,
    on_screen: on_screen
  };
};

/* ========================================================================
    Game
    Main Canvas
 ========================================================================== */

/* Set up canvas
    ---------------------------------------- */

game.prototype.init_canvas = function() {
  // set up main canvas dimensions and position
  var d = select("projectants");
  this.canvas = {};

  // limit game size
  this.canvas.w = d.offsetWidth;
  this.canvas.h = d.offsetHeight;
  if (this.canvas.h < 800) {
    this.canvas.w = round(this.canvas.w * (800 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (800 / this.canvas.h));
  }
  if (this.canvas.h > 1000) {
    this.canvas.w = round(this.canvas.w * (1000 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (1000 / this.canvas.h));
  }
  this.canvas.cx = round(this.canvas.w / 2);
  this.canvas.cy = round(this.canvas.h / 2);

  // initialise main canvas
  this.canvas.canv = element({ type: "canvas" });
  this.canvas.canv.style.position = "relative";
  this.canvas.cont = this.canvas.canv.getContext("2d");
  this.canvas.canv.width = this.canvas.w;
  this.canvas.canv.height = this.canvas.h;

  append(this.div, this.canvas.canv);
};

/* Frame rendering
    ---------------------------------------- */

game.prototype.run_canvas = function() {
  // clear the canvas
  this.canvas.cont.clearRect(0, 0, this.w, this.h);

  // do the drawing
  this.draw_background();
  this.draw_map();
  this.draw_sprites();
  this.draw_labels();
  this.draw_messages();

  // clear sprites
  this.sprites = [];
};

/* ========================================================================
    Game
    Object Labels
 ========================================================================== */

/* Manage labels
	---------------------------------------- */

game.prototype.run_labels = function() {
  // create labels
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.labels && !this.labels[key]) {
      this.labels[key] = {};
      for (type in obj.c.labels) {
        if (obj.c.labels[type]) {
          this.create_label(this.labels[key], type, key);
        }
      }
    }
  }

  // run through labels
  for (key in this.labels) {
    var obj = this.core.state.objects[key];
    if (!obj) {
      delete this.labels[key];
      continue;
    }
    for (type in this.labels[key]) {
      this.set_label(this.labels[key][type], obj);
    }
  }
};

/* Create label
	---------------------------------------- */

game.prototype.create_label = function(ref, type, key) {
  // check health is active
  if (type === "player_health" && !this.scheme.health) {
    return;
  }

  // create and add to ref object
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  ref[type] = { canv: canv, cont: cont, text: "", key: key, type: type };
};

/* Set label
	---------------------------------------- */

game.prototype.set_label = function(label, obj) {
  // position
  if (label.type === "position") {
    this.set_label_text(label, obj.x + " | " + obj.y);
  }

  // player name
  else if (label.type === "player_name") {
    var player = this.players[obj.player_id];
    if (player) {
      this.set_label_text(label, player.name);
    } else {
      delete this.labels[label.key][label.type];
      return;
    }
  }

  // health bar
  else if (label.type === "player_health") {
    this.set_label_health(label, obj.player_id);
  }

  // timeout
  else if (label.type === "timeout") {
    this.set_label_text(
      label,
      ceil((obj.c.timeout - (this.core.state.frame - obj.frame)) / 24)
    );
  }
};

/* Set text label
	---------------------------------------- */

game.prototype.set_label_text = function(label, text) {
  // prep text
  text = String(text);
  text = str_space(text);

  // if there's no change to text
  if (label.text === text) {
    return;
  }

  // draw text
  label.w = label.cont.measureText(text).width + 9;
  label.h = 18;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.restore();
  label.cont.clearRect(0, 0, label.canv.width, label.canv.height);
  label.cont.font = "12px 'Orbitron'";
  label.cont.fillStyle = "#000";
  label.cont.filter = "drop-shadow(0 2px 4px #000)";
  label.cont.fillText(text, 4, 14 + 0.5);
  label.cont.fillStyle = "#ddd";
  label.cont.fillText(text, 4, 12 + 0.5);
  label.cont.save();
};

/* Set health label
	---------------------------------------- */

game.prototype.set_label_health = function(label, player_id) {
  if (!this.scheme.health) {
    return;
  }

  var player = this.core.state.players[player_id];
  if (!player) {
    delete this.labels[label.key][label.type];
    return;
  }

  // are we doing anything at all
  var level = this.scheme.levels.health[player.level];
  if (!level) {
    return;
  }

  // is it the same
  var text = player.health + " / " + level;
  if (text === label.text) {
    return;
  }
  label.text = text;

  // draw label
  label.w = round(level / 2) + 6;
  label.h = 8;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.fillStyle = "rgba(255,255,255,0.1)";
  label.cont.fillRect(0, 0, label.w, label.h);
  label.cont.fillStyle = "rgba(0,0,0,0.8)";
  label.cont.fillRect(1, 1, label.w - 2, label.h - 2);
  label.cont.fillStyle = "#e41a1a";
  label.cont.fillRect(3, 3, round(player.health / 2), 2);

  // are we hiding it
  label.hide = player.dead;
};

/* Draw labels
	---------------------------------------- */

game.prototype.draw_labels = function() {
  // go through all labels
  for (key in this.labels) {
    // ignore empties or hiddens
    if (!this.labels[key]) {
      continue;
    }

    // get screen position of object
    var obj = this.core.state.objects[key];
    var position = this.screen_position(obj.dx, obj.dy, 50);

    // ignore too far away objects
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var n = 0;
    for (type in this.labels[key]) {
      var label = this.labels[key][type];
      if (label.hide) {
        continue;
      }
      var x = round(position.x - label.w / 2) + 0;
      var y =
        round(position.y - label.h / 2 - obj.c.size * 2 - (label.h - 5) * n) -
        20;
      this.canvas.cont.drawImage(label.canv, x, y);
      n++;
    }
  }
};

/* ========================================================================
    Game
    Map Graphics
 ========================================================================== */

/* Set up the map canvases
	---------------------------------------- */

game.prototype.init_map = function() {
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* Draw the map
	---------------------------------------- */

game.prototype.draw_map = function() {
  var x = this.canvas.cx - this.camera.x + this.camera.sx;
  var y = this.canvas.cy - this.camera.y + this.camera.sy;

  // draw layers
  this.draw_repeating_layer(this.map.bg.canv, x, y);
  this.draw_repeating_layer(this.map.fg.canv, x, y);
};

/* Draw layer canvas repeating on all sides
	---------------------------------------- */

game.prototype.draw_repeating_layer = function(canv, x, y) {
  this.canvas.cont.drawImage(canv, x - canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x, y - canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x - canv.width, y);
  this.canvas.cont.drawImage(canv, x + canv.width, y);
  this.canvas.cont.drawImage(canv, x - canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y + canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y);
};

/* Destroy land on the map
	---------------------------------------- */

game.prototype.destroy_land = function(x, y, size) {
  this.map.fg.cont.beginPath();
  this.map.fg.cont.arc(x, y, size, 0, 2 * pi);
  this.map.fg.cont.fill();
};

/* Get a piece of land
	---------------------------------------- */

game.prototype.get_land_block = function(x, y, w, h) {
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  canv.width = w;
  canv.height = h;
  cont.drawImage(this.map.fg.canv, x, y, w, h, 0, 0, w, h);

  return canv;
};

/* Draw piece of land
	---------------------------------------- */

game.prototype.draw_land_block = function(x, y, canv) {
  this.map.fg.cont.globalCompositeOperation = "normal";
  this.map.fg.cont.drawImage(canv, x, y);
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* ========================================================================
    Game
    Object Messages
 ========================================================================== */

/* Draw the messages
	---------------------------------------- */

game.prototype.draw_messages = function() {
  // go through messages
  for (var i = 0; i < this.messages.length; i++) {
    var message = this.messages[i];

    // increment time
    message.time++;
    if (message.time > 40) {
      this.messages.splice(i, 1);
      continue;
    }

    // get screen position of message
    var position = this.screen_position(message.x, message.y, 50);

    // ignore too far away messages
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var x = round(position.x - message.w / 2) + 0.5;
    var y = round(position.y - message.h / 2) - 30.5 - message.time;

    this.canvas.cont.save();
    this.canvas.cont.translate(0, 0);
    this.canvas.cont.drawImage(message.canv, x, y);
    this.canvas.cont.restore();
  }
};

/* Look for changes in health
	---------------------------------------- */

game.prototype.create_message = function(obj, col, text, size, y_offset) {
  // set up canvas
  var message = {};
  message.canv = element({ type: "canvas" });
  message.cont = message.canv.getContext("2d");

  // draw text
  text = str_space(text);
  message.cont.font = size + "px Orbitron";
  message.w = round(message.cont.measureText(text).width) + 8;
  message.h = size + 4;
  message.canv.width = message.w;
  message.canv.height = message.h;
  message.cont.font = size + "px Orbitron";
  // message.cont.fillStyle = "#000";
  // message.cont.fillText(text, 3.5, size + 0.5);
  message.cont.fillStyle = col;
  message.cont.fillText(text, 3.5, size + 0.5);

  // set position
  var y_offset = y_offset || 0;
  message.x = obj.x;
  message.y = obj.y + y_offset;
  message.time = 0;

  // add to array
  this.messages.push(message);
};

/* ========================================================================
    Game
    Sprites
 ========================================================================== */

/* Run sprites
	---------------------------------------- */

game.prototype.draw_sprites = function() {
  this.sprites = [];

  // objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.hide > 0) {
      obj.hide--;
      continue;
    }
    if (obj.type === "player") {
      var player = this.core.state.players[obj.player_id];
      if (player) {
        if (player.hit > 0) {
          this.draw_player_hit_sprites(obj, player.hit);
        } else {
          this.draw_player_sprites(obj, player);
        }
      }
      continue;
    }
    var args = {
      frame: obj.frame,
      type: obj.sprite_key,
      x: obj.dx,
      y: obj.dy,
      angle: obj.display_angle,
      animate: obj.animate,
      float: obj.c.animation.air_float,
      repeat: true
    };
    this.sprites.unshift(args);
  }

  // explosions
  for (var key in this.explosions) {
    var obj = this.explosions[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      animate: true
    };
    this.sprites.push(args);
  }

  // decorations
  for (var key in this.decorations) {
    var obj = this.decorations[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      angle: obj.angle,
      animate: true,
      repeat: obj.repeat
    };
    this.sprites.unshift(args);
  }

  // get arrows
  this.run_arrows();

  // draw them
  this.draw_sprites_canv();
};

/* Player sprites
	---------------------------------------- */

game.prototype.draw_player_sprites = function(obj, player) {
  var w =
    this.player_id === obj.player_id ? this.current_weapon : player.weapon;
  var weapon = this.c.weapons[w];

  // body
  this.sprites.push({
    frame: obj.frame,
    type: obj.sprite_key,
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // get head direction and angle
  var head_dir = obj.direction;
  if (obj.grounded) {
    var diff = n_diff(
      obj.barrel_angle,
      angle_add(obj.display_angle, 90),
      0,
      360
    );
    head_dir = diff >= -180 && diff < 0 ? "right" : "left";
  }
  var head_angle =
    head_dir === "right" ? angle_add(obj.barrel_angle, 180) : obj.barrel_angle;

  // weapons
  var weapon_sprite = "";
  if (weapon && weapon.sprite) {
    var weapon_sprite = weapon.sprite;
    var weapon_frame = 0;
    var throwing = weapon.sprite === "throw";

    // just fired sprites
    if (obj.fire_sprite_count) {
      weapon_sprite = weapon.fire_sprite;
      weapon_frame = obj.fire_sprite_frame;
      throwing = false;
    }

    // add the weapon sprite
    this.sprites.push({
      type: "ant-weapon-" + weapon_sprite + "-" + head_dir,
      x: this.core.map.loop_x(obj.dx),
      y: this.core.map.loop_y(obj.dy),
      frame: weapon_frame,
      animate: true,
      repeat: true,
      angle: head_angle
    });
  }

  // head
  this.sprites.push({
    type: "ant-head-" + head_dir,
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: head_angle
  });

  // add a throw weapon
  if (throwing) {
    var tobj = this.c.objects[weapon.object];
    var tsprite = tobj.animation.sprite;
    var toff_x = xy_speed(obj.barrel_angle, -16);
    var toff_y = xy_speed(angle_add(head_angle, 90), 14);
    this.sprites.push({
      type: tsprite,
      x: this.core.map.loop_x(obj.dx + toff_x.x + toff_y.x),
      y: this.core.map.loop_y(obj.dy + toff_x.y + toff_y.y),
      animate: false,
      angle: angle_add(obj.barrel_angle, 90)
    });
  }

  // // set crosshair
  // if (this.player_id === obj.player_id) {
  // 	var offx = xy_speed(angle, 50 + weapon.offset_x);
  // 	var offy = xy_speed(offset_angle, 7);
  // 	this.sprites.push({
  // 		type: "crosshair",
  // 		x: round(obj.dx + offx.x + offy.x),
  // 		y: round(obj.dy + offx.y + offy.y),
  // 		angle: angle_add(this.crosshair, 180)
  // 	});
  // }
};

/* Player hit sprites
	---------------------------------------- */

game.prototype.draw_player_hit_sprites = function(obj, hit) {
  // body
  this.sprites.push({
    frame: obj.frame,
    type: hit < 15 ? "ant-body-air-left" : "ant-body-hit",
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // head
  this.sprites.push({
    type: hit < 15 ? "ant-head-left" : "ant-head-hit",
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: obj.display_angle
  });
};

/* Draw sprites on the canvas
	---------------------------------------- */

game.prototype.draw_sprites_canv = function() {
  for (var i = 0; i < this.sprites.length; i++) {
    var sprite = this.sprites[i];

    // get position on screen
    var screen_position = this.screen_position(sprite.x, sprite.y, 48);
    if (!screen_position.on_screen) {
      continue;
    }

    // get sprite key
    var sprite_key = sprite.type;
    var animation = this.c.animations[sprite_key];
    if (animation) {
      sprite_key = animation[0];
      if (sprite.animate) {
        var frame = sprite.frame || 0;
        frame = floor((this.core.state.frame - frame) / 2);
        if (sprite.repeat) {
          frame = frame % animation.length;
        }
        sprite_key = animation[frame];
      }
    }

    // get sprite reference positions
    var sprite_ref = this.c.sprites[sprite_key];
    if (!sprite_ref) {
      continue;
    }

    // get new position to draw on
    var size = sprite_ref.size;
    var pos = -(size / 2);

    // float effect
    var y_add = 0;
    if (sprite.float) {
      y_add = cos((this.core.state.frame - sprite.frame) / 4) * 2;
    }

    // draw it
    this.canvas.cont.save();
    this.canvas.cont.translate(screen_position.x, screen_position.y + y_add);
    if (sprite.angle !== 0) {
      this.canvas.cont.rotate((sprite.angle * Math.PI) / 180);
    }
    this.canvas.cont.drawImage(
      this.img.sprites,
      sprite_ref.x,
      sprite_ref.y,
      size,
      size,
      pos,
      pos,
      size,
      size
    );
    this.canvas.cont.translate(
      -screen_position.x,
      -(screen_position.y + y_add)
    );
    this.canvas.cont.restore();
  }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9hbmltYXRpb25zLmpzIiwiY29uZmlnL21hcGdlbi5qcyIsImNvbmZpZy9uYW1lcy5qcyIsImNvbmZpZy9vYmplY3RzLmpzIiwiY29uZmlnL3Nwcml0ZXMuanMiLCJjb25maWcvd2VhcG9ucy5qcyIsImVuZ2luZS9hY3Rpb25zLmpzIiwiZW5naW5lL2NvbGxpc2lvbnMuanMiLCJlbmdpbmUvY29yZS5qcyIsImVuZ2luZS9ldmVudHMuanMiLCJlbmdpbmUvZXhwbG9zaW9ucy5qcyIsImVuZ2luZS9vYmplY3RzLmpzIiwiZW5naW5lL3BoeXNpY3MuanMiLCJlbmdpbmUvcGxheWVycy5qcyIsImVuZ2luZS9zdGF0ZXMuanMiLCJoZWxwZXJzL2RlZXBtZXJnZS5qcyIsImhlbHBlcnMvbWF0aC5qcyIsImhlbHBlcnMvbWlzYy5qcyIsIm1hcGdlbi9ibG9icy5qcyIsIm1hcGdlbi9jYW52YXMuanMiLCJtYXBnZW4vbWFwZ2VuLmpzIiwic2NoZW1lcy9kZWF0aG1hdGNoLmpzIiwic2NoZW1lcy9kZWZhdWx0LmpzIiwiZW5naW5lL21hcC9ncmF2aXR5LmpzIiwiZW5naW5lL21hcC9ncm91bmQuanMiLCJlbmdpbmUvbWFwL21hcC5qcyIsImFwcC5qcyIsImV2ZW50cy5qcyIsImludGVyZmFjZS5qcyIsInNldHRpbmdzLmpzIiwic3RhcnQuanMiLCJnYW1lL2FsZXJ0LmpzIiwiZ2FtZS9hcm1vdXJ5LmpzIiwiZ2FtZS9hdWRpby5qcyIsImdhbWUvY3Jvc3NoYWlyLmpzIiwiZ2FtZS9kZWNvcmF0aW9ucy5qcyIsImdhbWUvZXZlbnRzLmpzIiwiZ2FtZS9leHBsb3Npb25zLmpzIiwiZ2FtZS9nYW1lLmpzIiwiZ2FtZS9pbnB1dC5qcyIsImdhbWUvb2JqZWN0cy5qcyIsImdhbWUvcGxheWVycy5qcyIsImdhbWUvc2NvcmUuanMiLCJnYW1lL3RpbWUuanMiLCJtb2R1bGVzL2F1ZGlvLmpzIiwibW9kdWxlcy9lbGVtZW50cy5qcyIsIm1vZHVsZXMvaW5wdXQuanMiLCJtb2R1bGVzL2xvYWRlci5qcyIsIm1vZHVsZXMvb25ib2FyZGluZy5qcyIsIm1vZHVsZXMvc29ja2V0cy5qcyIsIm11bHRpcGxheWVyL2RlYXRocy5qcyIsIm11bHRpcGxheWVyL2V2ZW50cy5qcyIsIm11bHRpcGxheWVyL2ZyYW1lcy5qcyIsIm11bHRpcGxheWVyL2dyb3VuZC5qcyIsIm11bHRpcGxheWVyL2ludGVyZmFjZS5qcyIsIm11bHRpcGxheWVyL211bHRpcGxheWVyLmpzIiwibXVsdGlwbGF5ZXIvcGxheWVycy5qcyIsIm11bHRpcGxheWVyL3N0YXRlcy5qcyIsImdhbWUvY2FudmFzL2Fycm93cy5qcyIsImdhbWUvY2FudmFzL2JhY2tncm91bmQuanMiLCJnYW1lL2NhbnZhcy9jYW1lcmEuanMiLCJnYW1lL2NhbnZhcy9jYW52YXMuanMiLCJnYW1lL2NhbnZhcy9sYWJlbHMuanMiLCJnYW1lL2NhbnZhcy9tYXAuanMiLCJnYW1lL2NhbnZhcy9tZXNzYWdlcy5qcyIsImdhbWUvY2FudmFzL3Nwcml0ZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2NEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL2VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9TQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLmFuaW1hdGlvbnMgPSB7XG4gIFwiYW50LWJvZHktaGl0XCI6IFtcbiAgICBcImFudC1ib2R5LWhpdC0xXCIsXG4gICAgXCJhbnQtYm9keS1oaXQtMlwiLFxuICAgIFwiYW50LWJvZHktaGl0LTFcIixcbiAgICBcImFudC1ib2R5LWhpdC0zXCJcbiAgXSxcbiAgXCJhbnQtYm9keS1zdGlsbC1sZWZ0XCI6IFtcImFudC1ib2R5LXdhbGstbGVmdC0xXCJdLFxuICBcImFudC1ib2R5LXN0aWxsLXJpZ2h0XCI6IFtcImFudC1ib2R5LXdhbGstcmlnaHQtMVwiXSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnRcIjogW1xuICAgIFwiYW50LWJvZHktd2Fsay1sZWZ0LTJcIixcbiAgICBcImFudC1ib2R5LXdhbGstbGVmdC0zXCIsXG4gICAgXCJhbnQtYm9keS13YWxrLWxlZnQtNFwiLFxuICAgIFwiYW50LWJvZHktd2Fsay1sZWZ0LTVcIlxuICBdLFxuICBcImFudC1ib2R5LXdhbGstcmlnaHRcIjogW1xuICAgIFwiYW50LWJvZHktd2Fsay1yaWdodC0yXCIsXG4gICAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTNcIixcbiAgICBcImFudC1ib2R5LXdhbGstcmlnaHQtNFwiLFxuICAgIFwiYW50LWJvZHktd2Fsay1yaWdodC01XCJcbiAgXSxcbiAgXCJhbnQtaGVhZC1sZWZ0XCI6IFtcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMlwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0zXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTJcIlxuICBdLFxuICBcImFudC1oZWFkLXJpZ2h0XCI6IFtcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTFcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTJcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTNcIixcbiAgICBcImFudC1oZWFkLXJpZ2h0LTJcIlxuICBdLFxuICBcImFudC1oZWFkLWhpdFwiOiBbXCJhbnQtaGVhZC1oaXQtMVwiLCBcImFudC1oZWFkLWhpdC0yXCIsIFwiYW50LWhlYWQtaGl0LTNcIl0sXG4gIFwiYW50LXdlYXBvbi1iYXpvb2thLWxlZnRcIjogW1wiYW50LXdlYXBvbi1iYXpvb2thLWxlZnRcIl0sXG4gIFwiYW50LXdlYXBvbi1iYXpvb2thLXJpZ2h0XCI6IFtcImFudC13ZWFwb24tYmF6b29rYS1yaWdodFwiXSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLWxlZnRcIjogW1wiYW50LXdlYXBvbi1sYXNlci1sZWZ0XCJdLFxuICBcImFudC13ZWFwb24tbGFzZXItcmlnaHRcIjogW1wiYW50LXdlYXBvbi1sYXNlci1yaWdodFwiXSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnRcIjogW1wiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIl0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1maXJlLWxlZnRcIjogW1xuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTJcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0zXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNFwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTVcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiXG4gIF0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodFwiOiBbXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIl0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1maXJlLXJpZ2h0XCI6IFtcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMlwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0zXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTRcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtNVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIlxuICBdLFxuICBcImFudC13ZWFwb24tZGlnLWxlZnRcIjogW1wiYW50LXdlYXBvbi1kaWctbGVmdC0xXCJdLFxuICBcImFudC13ZWFwb24tZGlnLWZpcmUtbGVmdFwiOiBbXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTJcIixcbiAgICBcImFudC13ZWFwb24tZGlnLWxlZnQtM1wiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctbGVmdC00XCJcbiAgXSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodFwiOiBbXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0xXCJdLFxuICBcImFudC13ZWFwb24tZGlnLWZpcmUtcmlnaHRcIjogW1xuICAgIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtMlwiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtM1wiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtNFwiXG4gIF0sXG4gIFwiYW50LWdob3N0XCI6IFtcbiAgICBcImFudC1naG9zdC0xXCIsXG4gICAgXCJhbnQtZ2hvc3QtMVwiLFxuICAgIFwiYW50LWdob3N0LTJcIixcbiAgICBcImFudC1naG9zdC0yXCIsXG4gICAgXCJhbnQtZ2hvc3QtM1wiLFxuICAgIFwiYW50LWdob3N0LTNcIixcbiAgICBcImFudC1naG9zdC0yXCIsXG4gICAgXCJhbnQtZ2hvc3QtMlwiXG4gIF0sXG4gIFwiYnViYmxlLWJsdWVcIjogW1xuICAgIFwiYmFsbC1ibHVlLTFcIixcbiAgICBcImJhbGwtYmx1ZS0yXCIsXG4gICAgXCJiYWxsLWJsdWUtM1wiLFxuICAgIFwiYmFsbC1ibHVlLTRcIixcbiAgICBcImJhbGwtYmx1ZS01XCJcbiAgXSxcbiAgXCJleHBsb3Npb24tbFwiOiBbXG4gICAgXCJleHBsb3Npb24tbC0xXCIsXG4gICAgXCJleHBsb3Npb24tbC0yXCIsXG4gICAgXCJleHBsb3Npb24tbC0zXCIsXG4gICAgXCJleHBsb3Npb24tbC00XCIsXG4gICAgXCJleHBsb3Npb24tbC01XCIsXG4gICAgXCJleHBsb3Npb24tbC02XCIsXG4gICAgXCJleHBsb3Npb24yLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTZcIixcbiAgICBcImV4cGxvc2lvbjItbC03XCIsXG4gICAgXCJleHBsb3Npb24yLWwtOFwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uMi1sXCI6IFtcbiAgICBcImV4cGxvc2lvbjItbC0xXCIsXG4gICAgXCJleHBsb3Npb24yLWwtMlwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTNcIixcbiAgICBcImV4cGxvc2lvbjItbC00XCIsXG4gICAgXCJleHBsb3Npb24yLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTZcIixcbiAgICBcImV4cGxvc2lvbjItbC03XCIsXG4gICAgXCJleHBsb3Npb24yLWwtOFwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWxcIjogW1xuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtMVwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtMlwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtM1wiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtNFwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtNVwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtNlwiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtN1wiLFxuICAgIFwiZXhwbG9zaW9uLWdyZWVuLWwtOFwiXG4gIF0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWVcIjogW1xuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMVwiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMlwiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtM1wiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNFwiLFxuICAgIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNVwiXG4gIF0sXG4gIGZsYW1lOiBbXCJmbGFtZS0xXCIsIFwiZmxhbWUtMlwiLCBcImZsYW1lLTNcIiwgXCJmbGFtZS00XCIsIFwiZmxhbWUtNVwiXSxcbiAgXCJmbGFtZS1sYXJnZVwiOiBbXG4gICAgXCJmbGFtZS1sYXJnZS0xXCIsXG4gICAgXCJmbGFtZS1sYXJnZS0yXCIsXG4gICAgXCJmbGFtZS1sYXJnZS0zXCIsXG4gICAgXCJmbGFtZS1sYXJnZS00XCIsXG4gICAgXCJmbGFtZS1sYXJnZS01XCIsXG4gICAgXCJmbGFtZS1sYXJnZS02XCJcbiAgXSxcbiAgZm9jdXM6IFtcbiAgICBcImZvY3VzLTFcIixcbiAgICBcImZvY3VzLTJcIixcbiAgICBcImZvY3VzLTNcIixcbiAgICBcImZvY3VzLTRcIixcbiAgICBcImZvY3VzLTVcIixcbiAgICBcImZvY3VzLTZcIixcbiAgICBcImZvY3VzLTdcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIixcbiAgICBcImZvY3VzLThcIlxuICBdLFxuICBcImdlbS1ncmVlblwiOiBbXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMlwiLFxuICAgIFwiZ2VtLWdyZWVuLTNcIixcbiAgICBcImdlbS1ncmVlbi00XCJcbiAgXSxcbiAgXCJnZW0tYmx1ZVwiOiBbXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0xXCIsXG4gICAgXCJnZW0tYmx1ZS0yXCIsXG4gICAgXCJnZW0tYmx1ZS0zXCIsXG4gICAgXCJnZW0tYmx1ZS00XCJcbiAgXSxcbiAgXCJnZW0tcmVkXCI6IFtcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMlwiLFxuICAgIFwiZ2VtLXJlZC0zXCIsXG4gICAgXCJnZW0tcmVkLTRcIlxuICBdLFxuICBcImdlbS1wdXJwbGVcIjogW1xuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0yXCIsXG4gICAgXCJnZW0tcHVycGxlLTNcIixcbiAgICBcImdlbS1wdXJwbGUtNFwiXG4gIF0sXG4gIFwiZ2VtLXNpbHZlclwiOiBbXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTJcIixcbiAgICBcImdlbS1zaWx2ZXItM1wiLFxuICAgIFwiZ2VtLXNpbHZlci00XCJcbiAgXSxcbiAgXCJncmVuYWRlLWFybWVkXCI6IFtcbiAgICBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBcImdyZW5hZGUtcmVkXCIsXG4gICAgXCJncmVuYWRlLXJlZFwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1ncmVlblwiXG4gIF0sXG4gIFwibWluZS1hY3RpdmVcIjogW1xuICAgIFwibWluZS1yZWRcIixcbiAgICBcIm1pbmUtcmVkXCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIlxuICBdLFxuICBcInNtb2tlLWdyZWVuXCI6IFtcbiAgICBcInNtb2tlLWdyZWVuLTFcIixcbiAgICBcInNtb2tlLWdyZWVuLTJcIixcbiAgICBcInNtb2tlLWdyZWVuLTNcIixcbiAgICBcInNtb2tlLWdyZWVuLTRcIixcbiAgICBcInNtb2tlLWdyZWVuLTVcIixcbiAgICBcInNtb2tlLWdyZWVuLTZcIixcbiAgICBcInNtb2tlLWdyZWVuLTdcIixcbiAgICBcInNtb2tlLWdyZWVuLThcIlxuICBdLFxuICB0ZWxlcG9ydDogW1xuICAgIFwidGVsZXBvcnQtMVwiLFxuICAgIFwidGVsZXBvcnQtMlwiLFxuICAgIFwidGVsZXBvcnQtM1wiLFxuICAgIFwidGVsZXBvcnQtNFwiLFxuICAgIFwidGVsZXBvcnQtNVwiLFxuICAgIFwidGVsZXBvcnQtNlwiLFxuICAgIFwidGVsZXBvcnQtN1wiXG4gIF0sXG4gIHZvcnRleDogW1xuICAgIFwidm9ydGV4LTFcIixcbiAgICBcInZvcnRleC0yXCIsXG4gICAgXCJ2b3J0ZXgtM1wiLFxuICAgIFwidm9ydGV4LTRcIixcbiAgICBcInZvcnRleC01XCIsXG4gICAgXCJ2b3J0ZXgtNlwiLFxuICAgIFwidm9ydGV4LTdcIixcbiAgICBcInZvcnRleC04XCIsXG4gICAgXCJ2b3J0ZXgtMTBcIixcbiAgICBcInZvcnRleC0xMVwiXG4gIF1cbn07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLm1hcGdlbiA9IHtcbiAgbGFuZF90eXBlOiBbXG4gICAge1xuICAgICAgZWRnZTogMSxcbiAgICAgIGJnOiBcImRpcnRcIixcbiAgICAgIGZnOiBcInJvY2tcIixcbiAgICAgIGRlY29yYXRpb25zOiB7XG4gICAgICAgIFwiMVwiOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNDMyLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDQ2OCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA1MDQsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogMzYsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNTQwLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDU3NixcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcIjJcIjogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNzIsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMTQ0LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDIxNixcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiAyODgsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMzYwLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG4gIF1cbn07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLm5hbWVzID0gW1xuICBcIkRhdmUgTGlzdGVyXCIsXG4gIFwiQWNlIFJpbW1lclwiLFxuICBcIlF1ZWVnIDUwMFwiLFxuICBcIkFicmFkb2xmIExpbmNsZXJcIixcbiAgXCJCZWFyZGxlc3MgUmlrZXJcIixcbiAgXCJUaGUgQW50IFdpdGggTm8gTmFtZVwiLFxuICBcIkFsIENhcG9uZVwiLFxuICBcIlRoZSBRdWVlblwiLFxuICBcIk1pY2tleSBFeWVzXCJcbl07XG4iLCJ2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuY29uZmlnLm9iamVjdHMgPSB7XG4gIGRlZmF1bHQ6IHtcbiAgICBzaXplOiAxLFxuICAgIHdlaWdodDogMCxcbiAgICBib3VuY2U6IDAuNCxcbiAgICB0aW1lb3V0OiAwLFxuICAgIGRhbWFnZTogMzAsXG4gICAga25vY2s6IDEsXG4gICAgc3Bhd246IGZhbHNlLFxuICAgIHBsYXllcl9sb2NrOiBmYWxzZSxcbiAgICBsYXVuY2hfZGlzdGFuY2U6IDIsXG4gICAgZGVzdHJveV9ncm91bmQ6IHRydWUsXG4gICAgc3RvcDogMCxcbiAgICBpZ25vcmVfbGV2ZWxfZGFtYWdlOiBmYWxzZSxcbiAgICBldmVudHM6IHtcbiAgICAgIGZyYW1lOiBcIlwiLFxuICAgICAgZ3JvdW5kOiBcIlwiLFxuICAgICAgb2JqZWN0OiBcIlwiLFxuICAgICAgZXhwbG9zaW9uOiBcIlwiLFxuICAgICAgZGllOiBcIlwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7fSxcbiAgICBzcGVlZDoge1xuICAgICAgbWF4X2dyYXZpdHk6IDMwLFxuICAgICAgbWF4OiA0MCxcbiAgICAgIG1vdmU6IDQsXG4gICAgICBqdW1wOiAxMFxuICAgIH0sXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiB0cnVlLFxuICAgICAgb2JqZWN0OiBcImdyZW5hZGVcIixcbiAgICAgIHNwZWVkOiAyLFxuICAgICAgY291bnQ6IDZcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbi1sXCIsXG4gICAgICBzcHJpdGU6IFwiXCIsXG4gICAgICBhaXJfc3BpbjogZmFsc2UsXG4gICAgICBhaXJfZmxvYXQ6IGZhbHNlLFxuICAgICAgc3RhdGljX2FuZ2xlOiBmYWxzZSxcbiAgICAgIGdyb3VuZDogZmFsc2VcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uXCIsXG4gICAgICBib3VuY2U6IFwiZG9ua1wiLFxuICAgICAgaGl0OiBcIlwiLFxuICAgICAgYWlyOiBcIlwiLFxuICAgICAgd2FsazogXCJ3YWxrXCJcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgcGxheWVyX2hlYWx0aDogZmFsc2UsXG4gICAgICBwbGF5ZXJfbmFtZTogZmFsc2UsXG4gICAgICB0aW1lb3V0OiBmYWxzZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMCxcbiAgICAgIHNwZWVkOiAwLjYsXG4gICAgICBvZmZzZXRfeDogMCxcbiAgICAgIG9mZnNldF95OiAwLFxuICAgICAgdGltZW91dDogMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcIlwiXG4gICAgfVxuICB9LFxuICBwbGF5ZXI6IHtcbiAgICBzaXplOiAxMixcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICBib3VuY2U6IDAuNyxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJwbGF5ZXJfYm91bmNlXCIsXG4gICAgICBleHBsb3Npb246IFwiaGl0X3JlY2VpdmVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgY3JhdGU6IFwiY29sbGVjdFwiLFxuICAgICAgbWVkcGFjazogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS0xXCI6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tNVwiOiBcImNvbGxlY3RcIixcbiAgICAgIFwiZ2VtLTIwXCI6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tNTBcIjogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS0yMDBcIjogXCJjb2xsZWN0XCIsXG4gICAgICB2b3J0ZXg6IFwiY29sbGVjdFwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJhbnQtYm9keVwiLFxuICAgICAgYWlyX3NwaW46IGZhbHNlLFxuICAgICAgZ3JvdW5kOiBmYWxzZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGJvdW5jZTogXCJkb2lua1wiLFxuICAgICAgZXhwbG9zaW9uOiBcInBvcFwiXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHBsYXllcl9oZWFsdGg6IHRydWUsXG4gICAgICBwbGF5ZXJfbmFtZTogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgcGxheWVyX21pc3NpbGU6IHtcbiAgICBzaXplOiAxMixcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICBkYW1hZ2U6IDUwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBbXCJib3VuY2VfZXhwbG9kZVwiLCBcInNwYXduX2dob3N0XCJdLFxuICAgICAgZXhwbG9zaW9uOiBbXCJib3VuY2VfZXhwbG9kZVwiLCBcInNwYXduX2dob3N0XCJdXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFtcImJvdW5jZV9leHBsb2RlXCIsIFwic3Bhd25fZ2hvc3RcIl1cbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImFudC1ib21iXCIsXG4gICAgICBhaXJfc3BpbjogdHJ1ZVxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICBwbGF5ZXJfbmFtZTogdHJ1ZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAwLjYsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHNwcml0ZTogXCJiYWxsLXJlZFwiXG4gICAgfVxuICB9LFxuICBwbGF5ZXJfZ2hvc3Q6IHtcbiAgICBzaXplOiAxMixcbiAgICB3ZWlnaHQ6IDAsXG4gICAgZGFtYWdlOiAxLFxuICAgIGtub2NrOiAwLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImhpdF9yZWNlaXZlXCIsXG4gICAgICBleHBsb3Npb246IFwiaGl0X3JlY2VpdmVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImhpdF9naXZlXCJcbiAgICB9LFxuICAgIHNwZWVkOiB7XG4gICAgICBtYXg6IDIuNSxcbiAgICAgIG1vdmU6IDAuM1xuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiYW50LWdob3N0XCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgcGxheWVyX25hbWU6IHRydWVcbiAgICB9XG4gIH0sXG4gIGNyYXRlOiB7XG4gICAgc2l6ZTogMTYsXG4gICAgc3Bhd246IHRydWUsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiY3JhdGUtd2VhcG9uXCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMSxcbiAgICAgIHRpbWVvdXQ6IDMwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1ibHVlXCJcbiAgICB9XG4gIH0sXG4gIG1lZHBhY2s6IHtcbiAgICBzaXplOiAxNixcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJjcmF0ZS1oZWFsdGhcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAxLFxuICAgICAgdGltZW91dDogMzAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYWxsLXJlZFwiXG4gICAgfVxuICB9LFxuICBcImdlbS0xXCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tZ3JlZW5cIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tNVwiOiB7XG4gICAgc2l6ZTogMTgsXG4gICAgc3Bhd246IHRydWUsXG4gICAgc3RvcDogMTAsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZ2VtLWJsdWVcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tMjBcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1yZWRcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tNTBcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1wdXJwbGVcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgXCJnZW0tMjAwXCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tc2lsdmVyXCIsXG4gICAgICBzdGF0aWNfYW5nbGU6IHRydWUsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIHZvcnRleDoge1xuICAgIHNpemU6IDIyLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcInZvcnRleFwiXG4gICAgfVxuICB9LFxuICB0YXJnZXQ6IHtcbiAgICBzaXplOiAyMixcbiAgICBkYW1hZ2U6IDAsXG4gICAgc3Bhd246IHRydWUsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbi1sYXNlci1ibHVlXCIsXG4gICAgICBzcHJpdGU6IFwidGFyZ2V0XCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBleHBsb3Npb246IFwicG9wXCIsXG4gICAgICBhaXI6IFwibm9uZVwiXG4gICAgfVxuICB9LFxuICBudWNsZWFyOiB7XG4gICAgc2l6ZTogMjIsXG4gICAgZGFtYWdlOiAxMDAsXG4gICAgc3Bhd246IHRydWUsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24tZ3JlZW4tbFwiLFxuICAgICAgc3ByaXRlOiBcIm51Y2xlYXJcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb25fZ2FzXCIsXG4gICAgICBhaXI6IFwibm9uZVwiXG4gICAgfVxuICB9LFxuICBtaW5lOiB7XG4gICAgc2l6ZTogNTgsXG4gICAgZGFtYWdlOiA4MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwibWluZVwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICBcImFzdGVyb2lkLXNtYWxsXCI6IHtcbiAgICBzaXplOiAxNSxcbiAgICB3ZWlnaHQ6IDEsXG4gICAgZGFtYWdlOiA0MCxcbiAgICBldmVudHM6IHtcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uMi1sXCIsXG4gICAgICBzcHJpdGU6IFwiYXN0ZXJvaWQtc21hbGxcIixcbiAgICAgIGFpcl9zcGluOiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgc3BlZWQ6IDAuNixcbiAgICAgIG9mZnNldF94OiAtNSxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH0sXG4gIFwiYXN0ZXJvaWQtbGFyZ2VcIjoge1xuICAgIHNpemU6IDM0LFxuICAgIHdlaWdodDogMSxcbiAgICBkYW1hZ2U6IDgwLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImRpZVwiLFxuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImNsdXN0ZXJcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBjbHVzdGVyOiB7XG4gICAgICBjaXJjbGU6IHRydWUsXG4gICAgICBvYmplY3Q6IFwiYXN0ZXJvaWQtc21hbGxcIixcbiAgICAgIHNwZWVkOiAxNixcbiAgICAgIGNvdW50OiAzXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24yLWxcIixcbiAgICAgIHNwcml0ZTogXCJhc3Rlcm9pZC1sYXJnZVwiLFxuICAgICAgYWlyX3NwaW46IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMC42LFxuICAgICAgb2Zmc2V0X3g6IC01LFxuICAgICAgdGltZW91dDogMjAsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfSxcbiAgZGlnOiB7XG4gICAgc2l6ZTogMixcbiAgICB3ZWlnaHQ6IDAsXG4gICAgZGFtYWdlOiAxNixcbiAgICB0aW1lb3V0OiA2LFxuICAgIGlnbm9yZV9sZXZlbF9kYW1hZ2U6IHRydWUsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFtcImRlc3Ryb3lcIiwgXCJkcmFnX3BsYXllclwiLCBcImRpZVwiXVxuICAgIH1cbiAgfSxcbiAgcHVuY2g6IHtcbiAgICBzaXplOiAyMCxcbiAgICB3ZWlnaHQ6IDAsXG4gICAgZGFtYWdlOiAxNixcbiAgICB0aW1lb3V0OiA4LFxuICAgIHBsYXllcl9sb2NrOiB0cnVlLFxuICAgIHN0b3A6IDYsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwic2xpZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImhpdF9naXZlXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImZsYW1lLWxhcmdlXCJcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCIsXG4gICAgICBib3VuY2U6IFwiZG9pbmtcIixcbiAgICAgIGhpdDogXCJwdW5jaFwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgc3BlZWQ6IDEuNSxcbiAgICAgIG9mZnNldF94OiAtMTAsXG4gICAgICBvZmZzZXRfeTogMCxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfSxcbiAgbGFzZXI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB3ZWlnaHQ6IDAsXG4gICAgdGltZW91dDogMjAsXG4gICAgZGFtYWdlOiAzMCxcbiAgICBkZXN0cm95X2dyb3VuZDogZmFsc2UsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBvYmplY3Q6IFwibm9uZVwiLFxuICAgICAgZGllOiBcIm5vbmVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBbXCJleHBsb2RlXCIsIFwiZGllXCJdLFxuICAgICAgcGxheWVyX2dob3N0OiBbXCJoaXRfZ2l2ZVwiLCBcImRpZVwiXVxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwibGFzZXItYmx1ZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbi1sYXNlci1ibHVlXCJcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uX2xhc2VyXCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDEsXG4gICAgICBzcGVlZDogMCxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IGZhbHNlLFxuICAgICAgc3ByaXRlOiBcImJ1YmJsZS1ibHVlXCJcbiAgICB9XG4gIH0sXG4gIGJhem9va2E6IHtcbiAgICBzaXplOiA2LFxuICAgIHdlaWdodDogMC43LFxuICAgIHRpbWVvdXQ6IDMwMCxcbiAgICBkYW1hZ2U6IDcwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgb2JqZWN0OiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJiYXpvb2thLXNoZWxsXCJcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDEsXG4gICAgICBzcGVlZDogMS41LFxuICAgICAgb2Zmc2V0X3g6IC0xMCxcbiAgICAgIG9mZnNldF95OiAwLFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJmbGFtZVwiXG4gICAgfVxuICB9LFxuICBncmVuYWRlOiB7XG4gICAgc2l6ZTogNCxcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICB0aW1lb3V0OiA3MixcbiAgICBkYW1hZ2U6IDUwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImJvdW5jZVwiLFxuICAgICAgb2JqZWN0OiBcImJvdW5jZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImJvdW5jZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImJvdW5jZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGFpcl9zcGluOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImdyZW5hZGUtYXJtZWRcIlxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICB0aW1lb3V0OiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImNvdW50ZG93blwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgdGltZW91dDogMjAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYWxsLWdyZWVuXCJcbiAgICB9XG4gIH0sXG4gIHB1bXBraW46IHtcbiAgICBzaXplOiAxMCxcbiAgICB3ZWlnaHQ6IDEsXG4gICAgdGltZW91dDogMTIwLFxuICAgIGRhbWFnZTogNzAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiYm91bmNlXCIsXG4gICAgICBvYmplY3Q6IFwiYm91bmNlXCIsXG4gICAgICBleHBsb3Npb246IFwiYm91bmNlXCIsXG4gICAgICBkaWU6IFwiY2x1c3RlclwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiYm91bmNlXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgYWlyX3NwaW46IHRydWUsXG4gICAgICBzcHJpdGU6IFwicHVtcGtpblwiXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHRpbWVvdXQ6IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwic3Bvb2t5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICB0aW1lb3V0OiAyMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgcm90YXRlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImJhdFwiXG4gICAgfSxcbiAgICBjbHVzdGVyOiB7XG4gICAgICBjaXJjbGU6IGZhbHNlLFxuICAgICAgb2JqZWN0OiBcInB1bXBraW5fc2xpY2VcIixcbiAgICAgIHNwZWVkOiAxNSxcbiAgICAgIGNvdW50OiAzXG4gICAgfVxuICB9LFxuICBwdW1wa2luX3NsaWNlOiB7XG4gICAgc2l6ZTogNixcbiAgICB3ZWlnaHQ6IDEsXG4gICAgdGltZW91dDogMjAwLFxuICAgIGRhbWFnZTogMzAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiZXhwbG9kZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgYWlyX3NwaW46IHRydWUsXG4gICAgICBzcHJpdGU6IFwicHVtcGtpbi1zbGljZVwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgdGltZW91dDogMjAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYWxsLW9yYW5nZVwiXG4gICAgfVxuICB9LFxuICBwYWluZ2l2ZXI6IHtcbiAgICBzaXplOiAyMCxcbiAgICB3ZWlnaHQ6IDEsXG4gICAgZGFtYWdlOiA1MCxcbiAgICBjbHVzdGVyOiB7XG4gICAgICBjaXJjbGU6IGZhbHNlLFxuICAgICAgb2JqZWN0OiBcImdyZW5hZGVcIixcbiAgICAgIHNwZWVkOiAxNSxcbiAgICAgIGNvdW50OiAzXG4gICAgfSxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIGRpZTogXCJjbHVzdGVyXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwicm9ja2V0XCJcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDEsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH1cbn07XG5cbi8vIHByZXAgb2JqZWN0c1xuY29uZmlnLm9iamVjdF9yZWZzID0gW107XG5mb3IgKGtleSBpbiBjb25maWcub2JqZWN0cykge1xuICBjb25maWcub2JqZWN0X3JlZnMucHVzaChrZXkpO1xuICBjb25maWcub2JqZWN0c1trZXldID0gZGVlcG1lcmdlKGNvbmZpZy5vYmplY3RzLmRlZmF1bHQsIGNvbmZpZy5vYmplY3RzW2tleV0sIHtcbiAgICBhcnJheU1lcmdlOiBkb250X21lcmdlXG4gIH0pO1xufVxuIiwidmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbmNvbmZpZy5zcHJpdGVzID0ge1xuICBcImJhbGwtYmx1ZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAyNDBcbiAgfSxcbiAgXCJiYWxsLWdyZWVuXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDI4OFxuICB9LFxuICBcImJhbGwtb3JhbmdlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDMzNlxuICB9LFxuICBcImJhbGwtcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDY3MlxuICB9LFxuICBcImJhbGwtc2lsdmVyXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDcyMFxuICB9LFxuICBiYXQ6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDc2OFxuICB9LFxuICBcImZsYW1lLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNDMyXG4gIH0sXG4gIFwiZmxhbWUtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA0ODBcbiAgfSxcbiAgXCJmbGFtZS0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDUyOFxuICB9LFxuICBcImZsYW1lLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZmxhbWUtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA2MjRcbiAgfSxcbiAgXCJtaW5lLWdyZXlcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMjQwXG4gIH0sXG4gIFwibWluZS1yZWRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMjg4XG4gIH0sXG4gIFwicHVtcGtpbi1zbGljZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAzODRcbiAgfSxcbiAgcHVtcGtpbjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDMyXG4gIH0sXG4gIFwic3Rhci1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDU3NlxuICB9LFxuICBcImFudC1ib2R5LWFpci1sZWZ0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAwLFxuICAgIHk6IDExNjhcbiAgfSxcbiAgXCJhbnQtYm9keS1haXItcmlnaHRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDU3NixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LWJvZHktaGl0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMFxuICB9LFxuICBcImFudC1ib2R5LWhpdC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDQ4XG4gIH0sXG4gIFwiYW50LWJvZHktaGl0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogOTZcbiAgfSxcbiAgXCJhbnQtYm9keS1zdXBlcm1hbi1sZWZ0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDE0NFxuICB9LFxuICBcImFudC1ib2R5LXN1cGVybWFuLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDUyOFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDYyNFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstbGVmdC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDExMDRcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLWxlZnQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTAwOFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAzMzZcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDE5MixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodC0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxNDQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFudC1ib21iXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhbnQtZ2hvc3QtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTI4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtZ2hvc3QtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNjQsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC1naG9zdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtaGVhZC1oaXQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtaGVhZC1oaXQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA4OTZcbiAgfSxcbiAgXCJhbnQtaGVhZC1oaXQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNjQwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1oZWFkLWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA4MzJcbiAgfSxcbiAgXCJhbnQtaGVhZC1sZWZ0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiYW50LWhlYWQtbGVmdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDcwNFxuICB9LFxuICBcImFudC1oZWFkLXJpZ2h0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNjQwXG4gIH0sXG4gIFwiYW50LWhlYWQtcmlnaHQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJhbnQtaGVhZC1yaWdodC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDUxMlxuICB9LFxuICBcImFudC13ZWFwb24tYmF6b29rYS1sZWZ0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDQ0OFxuICB9LFxuICBcImFudC13ZWFwb24tYmF6b29rYS1yaWdodFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNTc2LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAzMjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMjU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctbGVmdC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDE5MlxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLWxlZnQtNFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMjhcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0xXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDY0XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogOTYwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDg5NixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLWxlZnRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDgzMixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLXJpZ2h0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA3NjgsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1wdW5jaC1sZWZ0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA3MDQsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1wdW5jaC1yaWdodFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNjI0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNTI4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDMyLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzg0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDMzNixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAyODgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjQwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDE5MixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhcm1vdXJ5LWRpZ1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYXJtb3VyeS1leHRpbmd1aXNoZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTAwOCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYXJtb3VyeS1sYXNlci1ibHVlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2NzIsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFybW91cnktbGFzZXItcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDgxNlxuICB9LFxuICBcImFybW91cnktcHVuY2hcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDcyMCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYXJyb3ctYmx1ZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzY4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhcnJvdy1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogODE2LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhcnJvdy1ncmV5XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4NjQsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFycm93LXB1cnBsZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTEyLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhcnJvdy1yZWRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDk2MCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYXN0ZXJvaWQtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNDgwLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFzdGVyb2lkLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDM4NCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJiYWxsLWJsdWUtMVwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogNjAwLFxuICAgIHk6IDEwMjRcbiAgfSxcbiAgXCJiYWxsLWJsdWUtMlwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogNTc2LFxuICAgIHk6IDEwMjRcbiAgfSxcbiAgXCJiYWxsLWJsdWUtM1wiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTAyNCxcbiAgICB5OiA5ODRcbiAgfSxcbiAgXCJiYWxsLWJsdWUtNFwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTAyNCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJiYWxsLWJsdWUtNVwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTA4MCxcbiAgICB5OiAxMDI0XG4gIH0sXG4gIFwiYmF6b29rYS1zaGVsbFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJjcmF0ZS1oZWFsdGhcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogOTEyXG4gIH0sXG4gIFwiY3JhdGUtd2VhcG9uXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDk2MFxuICB9LFxuICBjcm9zc2hhaXI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDEwMDhcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC0xXCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNzY4LFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTJcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiA3NjgsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtM1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNzY4LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC01XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAzODQsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDE5MixcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC04XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHBsb3Npb24tbC0xXCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTJcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTNcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24tbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24tbC01XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMzg0LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDAsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogODY0LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDc2OCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0zXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA2NzIsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNTc2LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDQ4MCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMzg0LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImV4cGxvc2lvbjItbC0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAyODgsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDE5MixcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtNFwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtNVwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTdcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImV4cGxvc2lvbjItbC04XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDE5MlxuICB9LFxuICBleHRpbmd1aXNoZXI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDM4NFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTFcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDU3NixcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA0ODAsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtM1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMzg0LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTRcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDI4OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS01XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAxOTIsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtNlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZm9jdXMtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJmb2N1cy0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAyODgsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiZm9jdXMtM1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMTkyLFxuICAgIHk6IDk2MFxuICB9LFxuICBcImZvY3VzLTRcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImZvY3VzLTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDAsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiZm9jdXMtNlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZvY3VzLTdcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJmb2N1cy04XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNjcyXG4gIH0sXG4gIFwiZ2VtLWJsdWUtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjQwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tYmx1ZS0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAyODgsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ibHVlLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDMzNixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWJsdWUtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzg0LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDMyLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDgwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNTI4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNTc2LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDYyNCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLXB1cnBsZS0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2NzIsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1wdXJwbGUtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzIwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDc2OCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLXJlZC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4MTYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1yZWQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogODY0LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tcmVkLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDkxMixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLXJlZC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5NjAsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1zaWx2ZXItMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTAwOCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLXNpbHZlci0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tc2lsdmVyLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMDQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1zaWx2ZXItNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZ3JlbmFkZS1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA0OFxuICB9LFxuICBcImdyZW5hZGUtcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDk2XG4gIH0sXG4gIFwibGFzZXItYmx1ZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAxNDRcbiAgfSxcbiAgXCJsYXNlci1yZWRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTkyXG4gIH0sXG4gIG51Y2xlYXI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNTc2XG4gIH0sXG4gIHJvY2tldDoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDgwXG4gIH0sXG4gIHNtb2tlOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAxMDI0XG4gIH0sXG4gIHRhcmdldDoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQ4LFxuICAgIHk6IDExNjhcbiAgfSxcbiAgXCJ0ZWxlcG9ydC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDY3MlxuICB9LFxuICBcInRlbGVwb3J0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNzIwXG4gIH0sXG4gIFwidGVsZXBvcnQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJ0ZWxlcG9ydC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDgxNlxuICB9LFxuICBcInRlbGVwb3J0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogODY0XG4gIH0sXG4gIFwidGVsZXBvcnQtNlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA5MTJcbiAgfSxcbiAgXCJ0ZWxlcG9ydC03XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDk2MFxuICB9LFxuICBcInZvcnRleC0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNDgwXG4gIH0sXG4gIFwidm9ydGV4LTEwXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwidm9ydGV4LTExXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogMjg4XG4gIH0sXG4gIFwidm9ydGV4LTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJ2b3J0ZXgtM1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDk2XG4gIH0sXG4gIFwidm9ydGV4LTRcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiAwXG4gIH0sXG4gIFwidm9ydGV4LTVcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2LFxuICAgIHk6IDg2NFxuICB9LFxuICBcInZvcnRleC02XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAwLFxuICAgIHk6IDg2NFxuICB9LFxuICBcInZvcnRleC03XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA4NjQsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwidm9ydGV4LThcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDc2OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJ2b3J0ZXgtOVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNjcyLFxuICAgIHk6IDc2OFxuICB9XG59O1xuIiwidmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbmNvbmZpZy53ZWFwb25zID0ge1xuICBkZWZhdWx0OiB7XG4gICAgdGl0bGU6IFwiXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiXCIsXG4gICAgc3ByaXRlOiBcIlwiLFxuICAgIGZpcmVfYXVkaW86IFwiXCIsXG4gICAgZmlyZV9zcHJpdGU6IFwiXCIsXG4gICAgZmlyZV9ib2R5X3Nwcml0ZTogXCJcIixcbiAgICBmaXJlX2FuZ2xlX2xvY2s6IGZhbHNlLFxuICAgIGF1dG9fZm9sbG93OiBmYWxzZSxcbiAgICByZXF1aXJlX3dhbGs6IGZhbHNlLFxuICAgIHNwZWVkOiAwLFxuICAgIG9iamVjdDogXCJcIixcbiAgICBjb29sZG93bjogMCxcbiAgICByZWNvaWw6IDAsXG4gICAgaW5lcnRpYTogMFxuICB9LFxuICBkaWc6IHtcbiAgICB0aXRsZTogXCJEaWdcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJhcm1vdXJ5LWRpZ1wiLFxuICAgIHNwcml0ZTogXCJkaWdcIixcbiAgICBmaXJlX3Nwcml0ZTogXCJkaWctZmlyZVwiLFxuICAgIGZpcmVfYm9keV9zcHJpdGU6IFwid2Fsa1wiLFxuICAgIGZpcmVfYW5nbGVfbG9jazogdHJ1ZSxcbiAgICBzcGVlZDogMyxcbiAgICBvYmplY3Q6IFwiZGlnXCIsXG4gICAgY29vbGRvd246IDEwXG4gIH0sXG4gIHBoYXNlcjoge1xuICAgIHRpdGxlOiBcIlBoYXNlclwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImFybW91cnktbGFzZXItYmx1ZVwiLFxuICAgIHNwcml0ZTogXCJsYXNlclwiLFxuICAgIGZpcmVfYXVkaW86IFwic2hvb3RfbGFzZXJcIixcbiAgICBzcGVlZDogMzAsXG4gICAgb2JqZWN0OiBcImxhc2VyXCIsXG4gICAgY29vbGRvd246IDYsXG4gICAgcmVjb2lsOiAwLjEsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIGJhem9va29pZDoge1xuICAgIHRpdGxlOiBcIkJhem9va29pZFwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImJhem9va2Etc2hlbGxcIixcbiAgICBzcHJpdGU6IFwiYmF6b29rYVwiLFxuICAgIGZpcmVfYXVkaW86IFwic2hvb3RcIixcbiAgICBhdXRvX2ZvbGxvdzogdHJ1ZSxcbiAgICBzcGVlZDogMjQsXG4gICAgb2JqZWN0OiBcImJhem9va2FcIixcbiAgICBjb29sZG93bjogNDAsXG4gICAgcmVjb2lsOiAwLjIsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIGdyZW5hZGU6IHtcbiAgICB0aXRsZTogXCJHcmVuYWRlXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIHNwcml0ZTogXCJ0aHJvd1wiLFxuICAgIGZpcmVfYXVkaW86IFwidGhyb3dcIixcbiAgICBmaXJlX3Nwcml0ZTogXCJ0aHJvdy1maXJlXCIsXG4gICAgYXV0b19mb2xsb3c6IHRydWUsXG4gICAgc3BlZWQ6IDI0LFxuICAgIG9iamVjdDogXCJncmVuYWRlXCIsXG4gICAgY29vbGRvd246IDMwLFxuICAgIHJlY29pbDogMCxcbiAgICBpbmVydGlhOiAwLjVcbiAgfSxcbiAgcHVuY2g6IHtcbiAgICB0aXRsZTogXCJGaXJlIFB1bmNoXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiYXJtb3VyeS1wdW5jaFwiLFxuICAgIHNwcml0ZTogXCJwdW5jaFwiLFxuICAgIGZpcmVfYXVkaW86IFwidGhyb3dcIixcbiAgICBmaXJlX2JvZHlfc3ByaXRlOiBcInN1cGVybWFuXCIsXG4gICAgc3BlZWQ6IDE0LFxuICAgIG9iamVjdDogXCJwdW5jaFwiLFxuICAgIGNvb2xkb3duOiAzMCxcbiAgICByZWNvaWw6IDAsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIHB1bXBraW46IHtcbiAgICB0aXRsZTogXCJQdW1wa2luXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwicHVtcGtpblwiLFxuICAgIHNwcml0ZTogXCJ0aHJvd1wiLFxuICAgIGZpcmVfYXVkaW86IFwidGhyb3dcIixcbiAgICBmaXJlX3Nwcml0ZTogXCJ0aHJvdy1maXJlXCIsXG4gICAgYXV0b19mb2xsb3c6IHRydWUsXG4gICAgc3BlZWQ6IDMwLFxuICAgIG9iamVjdDogXCJwdW1wa2luXCIsXG4gICAgY29vbGRvd246IDQ4LFxuICAgIHJlY29pbDogMCxcbiAgICBpbmVydGlhOiAwLjVcbiAgfSxcbiAgcGFpbmdpdmVyOiB7XG4gICAgdGl0bGU6IFwiUGFpbmdpdmVyIDIwMDBcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJyb2NrZXRcIixcbiAgICBzcHJpdGU6IFwiYmF6b29rYVwiLFxuICAgIGZpcmVfYXVkaW86IFwic2hvb3RcIixcbiAgICBzcGVlZDogMjQsXG4gICAgb2JqZWN0OiBcInBhaW5naXZlclwiLFxuICAgIGNvb2xkb3duOiAxMCxcbiAgICByZWNvaWw6IDAuNCxcbiAgICBpbmVydGlhOiAwLjVcbiAgfVxufTtcblxuLy8gcHJlcCB3ZWFwb25zXG5mb3IgKGtleSBpbiBjb25maWcud2VhcG9ucykge1xuICBjb25maWcud2VhcG9uc1trZXldID0gZGVlcG1lcmdlKGNvbmZpZy53ZWFwb25zLmRlZmF1bHQsIGNvbmZpZy53ZWFwb25zW2tleV0sIHtcbiAgICBhcnJheU1lcmdlOiBkb250X21lcmdlXG4gIH0pO1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQWN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFBlcmZvcm0gYWN0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uID0gZnVuY3Rpb24ocGxheWVyX2lkLCBhY3Rpb24pIHtcbiAgdmFyIHJlc3BvbnNlID0geyBzdWNjZXNzOiBmYWxzZSB9O1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCAhYWN0aW9uIHx8ICFvYmopIHtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICB2YXIgbG9ja2VkX29iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1twbGF5ZXIubG9ja2VkXTtcblxuICAvLyBwbGF5ZXJzIGNhbiBkbyBzdHVmZlxuICBpZiAoIXBsYXllci5kZWFkICYmICFsb2NrZWRfb2JqICYmIHBsYXllci5oaXQgPT09IDApIHtcbiAgICAvLyBydW4gdGhlbVxuICAgIGlmIChhY3Rpb24uYWN0aW9uID09PSBcIm1vdmVcIikge1xuICAgICAgcmVzcG9uc2UgPSB0aGlzLmFjdGlvbl9tb3ZlKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKTtcbiAgICB9XG4gICAgaWYgKGFjdGlvbi5hY3Rpb24gPT09IFwianVtcFwiKSB7XG4gICAgICByZXNwb25zZSA9IHRoaXMuYWN0aW9uX2p1bXAocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYWN0aW9uLmFjdGlvbiA9PT0gXCJzaG9vdFwiKSB7XG4gICAgICByZXNwb25zZSA9IHRoaXMuYWN0aW9uX3Nob290KHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICByZXNwb25zZS54ID0gb2JqLng7XG4gIHJlc3BvbnNlLnkgPSBvYmoueTtcbiAgcmVzcG9uc2Uuc3BlZWRfeCA9IG9iai5zcGVlZF94O1xuICByZXNwb25zZS5zcGVlZF95ID0gb2JqLnNwZWVkX3k7XG4gIHJlc3BvbnNlLmZyYW1lID0gdGhpcy5zdGF0ZS5mcmFtZTtcblxuICAvLyByZXR1cm4gc3RhdHVzXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFdhbGtpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fbW92ZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKSB7XG4gIHJlc3BvbnNlLnR5cGUgPSBcIndhbGtcIjtcblxuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgdmFyIHNwZWVkID0gdGhpcy5zY2hlbWUubGV2ZWxzLnNwZWVkW3BsYXllci5sZXZlbF0gfHwgb2JqLmMuc3BlZWQubW92ZTtcbiAgICB2YXIgc3BlZWQgPSBhY3Rpb24uc3BlZWQgfHwgc3BlZWQ7XG4gICAgdmFyIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCBhY3Rpb24uYW5nbGUsIHNwZWVkKTtcbiAgICBpZiAod2Fsay5tb3ZlKSB7XG4gICAgICBpZiAodGhpcy5hY3Rpb25fd2Fsa19tb3ZlKG9iaiwgd2Fsay5wYXRoKSkge1xuICAgICAgICAvLyByZWNvcmQgcGxheWVyIGV2ZW50XG4gICAgICAgIHBsYXllci5ldmVudHMucHVzaCh7IGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLCB0eXBlOiBcIndhbGtcIiB9KTtcblxuICAgICAgICAvLyByZXR1cm4gc3VjY2Vzc1xuICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKiBXYWxraW5nIGluIGEgZGlyZWN0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX3dhbGtfZGlyID0gZnVuY3Rpb24ob2JqLCBkaXIsIHNwZWVkKSB7XG4gIHZhciBzcGVlZCA9IHNwZWVkIHx8IG9iai5jLnNwZWVkLm1vdmU7XG5cbiAgLy8gZ2V0IGluaXRpYWwgcGF0aFxuICB2YXIgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIDAsIHNwZWVkKTtcblxuICBpZiAod2Fsay5kaXJlY3Rpb24gIT0gZGlyKSB7XG4gICAgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIDE4MCwgc3BlZWQpO1xuICAgIGlmICh3YWxrLmRpcmVjdGlvbiAhPSBkaXIpIHtcbiAgICAgIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCA5MCwgc3BlZWQpO1xuICAgICAgaWYgKHdhbGsuZGlyZWN0aW9uICE9IGRpcikge1xuICAgICAgICB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgMjcwLCBzcGVlZCk7XG4gICAgICAgIGlmICh3YWxrLmRpcmVjdGlvbiAhPSBkaXIpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKCF3YWxrLm1vdmUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLmFjdGlvbl93YWxrX21vdmUob2JqLCB3YWxrLnBhdGgpO1xufTtcblxuLyogV2FsayBtb3Zpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fd2Fsa19tb3ZlID0gZnVuY3Rpb24ob2JqLCBwYXRoKSB7XG4gIC8vIGdvIHRocm91Z2ggdGhlIGNvdXJzZVxuICB2YXIgeDEgPSBvYmoueDtcbiAgdmFyIHkxID0gb2JqLnk7XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwb2ludCA9IHBhdGhbaV07XG5cbiAgICAvLyBjaGVjayBvYmplY3QgY29sbGlzaW9uc1xuICAgIHZhciBjb2wgPSB0aGlzLmNvbGxpc2lvbnMob2JqLCBwb2ludC54LCBwb2ludC55KTtcbiAgICBpZiAoY29sKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgb2JqLnggPSBwb2ludC54O1xuICAgIG9iai55ID0gcG9pbnQueTtcbiAgICBvYmoubW92ZWQgPSB0cnVlO1xuICB9XG5cbiAgaWYgKG9iai5tb3ZlZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG4vKiBKdW1waW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX2p1bXAgPSBmdW5jdGlvbihyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbikge1xuICByZXNwb25zZS50eXBlID0gXCJqdW1wXCI7XG5cbiAgaWYgKG9iai5ncm91bmRlZCAmJiBwbGF5ZXIuY29vbGRvd24gPT09IDApIHtcbiAgICB2YXIgc3BlZWQgPSB0aGlzLnNjaGVtZS5sZXZlbHMuanVtcFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLmp1bXA7XG4gICAgdmFyIHh5ID0geHlfc3BlZWQoYWN0aW9uLmFuZ2xlLCBzcGVlZCk7XG4gICAgb2JqLnNwZWVkX3ggPSB4eS54LmZpeGVkKCk7XG4gICAgb2JqLnNwZWVkX3kgPSB4eS55LmZpeGVkKCk7XG4gICAgaWYgKHRoaXMucGh5c2ljc19tb3ZlKG9iaikpIHtcbiAgICAgIC8vIHNldCBncm91bmRpbmdcbiAgICAgIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuXG4gICAgICAvLyBzZXQgY29vbGRvd25cbiAgICAgIHBsYXllci5jb29sZG93biA9IDc7XG5cbiAgICAgIC8vIHJlY29yZCBwbGF5ZXIgZXZlbnRcbiAgICAgIHBsYXllci5ldmVudHMucHVzaCh7IGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLCB0eXBlOiBcImp1bXBcIiB9KTtcblxuICAgICAgLy8gcmV0dXJuIHN1Y2Nlc3NcbiAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFNob290aW5nIHdlYXBvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbl9zaG9vdCA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKSB7XG4gIHJlc3BvbnNlLnR5cGUgPSBcInNob290XCI7XG5cbiAgLy8gaWYgd2FpdGluZyBmb3IgY29vbGRvd25cbiAgLy8gaXMgbm90IHJlYWwgd2VhcG9uXG4gIC8vIGRvIHdlIG5lZWQgdG8gd2Fsa1xuICAvLyBjaGVjayBhcm1vdXJ5IGNvdW50XG4gIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1thY3Rpb24ud2VhcG9uXTtcbiAgaWYgKFxuICAgIChwbGF5ZXIuY29vbGRvd24gPT09IDAgJiYgIXdlYXBvbikgfHxcbiAgICAod2VhcG9uLnJlcXVpcmVfd2FsayAmJiAhb2JqLmdyb3VuZGVkKSB8fFxuICAgIHBsYXllci5hcm1vdXJ5W2FjdGlvbi53ZWFwb25dID09PSAwXG4gICkge1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIC8vIGNyYXRlIHRoZSBvYmplY3RcbiAgdmFyIHNwZWVkID0geHlfc3BlZWQoYWN0aW9uLmFuZ2xlLCB3ZWFwb24uc3BlZWQpO1xuICB2YXIgc2hvdF9vYmogPSB0aGlzLmNyZWF0ZV9vYmplY3Qoe1xuICAgIHR5cGU6IHdlYXBvbi5vYmplY3QsXG4gICAgcGxheWVyX2lkOiBwbGF5ZXIuaWQsXG4gICAgeDogb2JqLngsXG4gICAgeTogb2JqLnksXG4gICAgc3BlZWRfeDogKHNwZWVkLnggKyBvYmouc3BlZWRfeCAqIHdlYXBvbi5pbmVydGlhKS5maXhlZCgpLFxuICAgIHNwZWVkX3k6IChzcGVlZC55ICsgb2JqLnNwZWVkX3kgKiB3ZWFwb24uaW5lcnRpYSkuZml4ZWQoKVxuICB9KTtcblxuICAvLyBzZXQgcGxheWVyIHJlY29pbFxuICBpZiAoIW9iai5ncm91bmRlZCkge1xuICAgIG9iai5zcGVlZF94ICs9ICgtc3BlZWQueCAqIHdlYXBvbi5yZWNvaWwpLmZpeGVkKCk7XG4gICAgb2JqLnNwZWVkX3kgKz0gKC1zcGVlZC55ICogd2VhcG9uLnJlY29pbCkuZml4ZWQoKTtcbiAgfVxuXG4gIC8vIHNldCBhcm1vdXJ5IHZhbHVlc1xuICB0aGlzLnVwZGF0ZV9wbGF5ZXJfYXJtb3VyeShwbGF5ZXIuaWQsIGFjdGlvbi53ZWFwb24sIC0xKTtcblxuICAvLyBzZXQgY29vbGRvd25cbiAgcGxheWVyLmNvb2xkb3duID0gd2VhcG9uLmNvb2xkb3duO1xuXG4gIC8vIHNldCBwbGF5ZXIgbG9ja1xuICBpZiAoc2hvdF9vYmouYy5wbGF5ZXJfbG9jaykge1xuICAgIHBsYXllci5sb2NrZWQgPSBzaG90X29iai5rZXk7XG4gIH1cblxuICAvLyByZWNvcmQgcGxheWVyIGV2ZW50XG4gIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgdHlwZTogXCJzaG9vdFwiLFxuICAgIG9iajogc2hvdF9vYmoua2V5LFxuICAgIHdlYXBvbjogYWN0aW9uLndlYXBvblxuICB9KTtcblxuICAvLyByZXR1cm4gc3VjY2Vzc1xuICByZXNwb25zZS5zdWNjZXNzID0gdHJ1ZTtcbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIENvbGxpc2lvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gc2luZ2xlIGNvbGxpc2lvbiBjaGVja1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNvbGxpc2lvbnMgPSBmdW5jdGlvbihvYmosIHgsIHkpIHtcbiAgLy8gY2hlY2sgY29sbGlzaW9uIHdpdGggZ3JvdW5kXG4gIGlmICh0aGlzLm1hcC5pKHJvdW5kKHgpLCByb3VuZCh5KSkpIHtcbiAgICB2YXIgZXZlbnQgPSB0aGlzLmV2ZW50KG9iaiwgXCJncm91bmRcIiwgbnVsbCk7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfVxuICB9XG5cbiAgLy8gY2hlY2sgY29sbGlzaW9ucyB3aXRoIG90aGVyIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUub2JqZWN0cykge1xuICAgIGlmIChvYmoua2V5ID09PSBrZXkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb2xsaXNpb25fb2JqKG9iaiwgeCwgeSwgdGhpcy5zdGF0ZS5vYmplY3RzW2tleV0pKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBSdW4gb2JqZWN0IGNvbGxpc2lvbiBjaGVja1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNvbGxpc2lvbl9vYmogPSBmdW5jdGlvbihvYmosIHgsIHksIGNoZWNrX29iaikge1xuICAvLyBpZiBubyBjb2xsaXNpb25cbiAgaWYgKFxuICAgIHRoaXMuY29sbGlzaW9uX2NoZWNrKFxuICAgICAgeCxcbiAgICAgIHksXG4gICAgICBjaGVja19vYmoueCxcbiAgICAgIGNoZWNrX29iai55LFxuICAgICAgb2JqLmMuc2l6ZSxcbiAgICAgIGNoZWNrX29iai5jLnNpemVcbiAgICApXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHByZXZlbnQgaGl0cyBvbiBwYXJlbnQgcGxheWVycyBmb3IgYSBzaG9ydCB0aW1lIG9yIGlmIHRoZXkncmUgcGxheWVyIGxvY2tlZFxuICBpZiAoXG4gICAgY2hlY2tfb2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiZcbiAgICBjaGVja19vYmoucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkICYmXG4gICAgKHRoaXMuc3RhdGUuZnJhbWUgPCBvYmouZnJhbWUgKyAxNSB8fCBvYmouYy5wbGF5ZXJfbG9jaylcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcHJldmVudCBjbHVzdGVycyBoaXR0aW5nIGVhY2ggb3RoZXIgZm9yIGEgc2hvcnQgdGltZVxuICBpZiAoXG4gICAgY2hlY2tfb2JqLmZyYW1lID09PSBvYmouZnJhbWUgJiZcbiAgICBjaGVja19vYmoucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkICYmXG4gICAgdGhpcy5zdGF0ZS5mcmFtZSA8IG9iai5mcmFtZSArIDYwXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHRyaWdnZXIgYmFzaWMgb2JqZWN0IGNvbGxpc2lvbiBldmVudFxuICBpZiAodGhpcy5ldmVudChvYmosIFwib2JqZWN0XCIsIGNoZWNrX29iaikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIHRyaWdnZXIgc3BlY2lmaWMgb2JqZWN0IGNvbGxpc2lvbiBldmVudFxuICB2YXIgZXZlbnQgPSBvYmouYy5vYmplY3RfZXZlbnRzW2NoZWNrX29iai50eXBlXTtcbiAgaWYgKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMucnVuX2V2ZW50KG9iaiwgZXZlbnQsIGNoZWNrX29iaikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ29sbGlzaW9uIE1hdGhzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY29sbGlzaW9uX2NoZWNrID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIsIHMxLCBzMikge1xuICByZXR1cm4gdGhpcy5tYXAuZ2V0X2Rpc3RhbmNlKHgxLCB5MSwgeDIsIHkyKSA+IHMxICsgczI7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQ29yZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIGNyZWF0ZSBjb3JlIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGNvcmUoY29uZmlnLCBzY2hlbWUsIG1hcCwgZ3Jhdml0eV9tYXApIHtcbiAgLy8gY29uZmlnXG4gIHRoaXMuYyA9IGNvbmZpZztcbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG4gIHRoaXMubWFwID0gbmV3IGNvcmVfbWFwKG1hcCwgc2NoZW1lLCBncmF2aXR5X21hcCk7XG5cbiAgLy8gY3JhdGUgY2hhbmNlIHRhYmxlXG4gIHRoaXMuY3JhdGVfbGlzdCA9IFtdO1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zY2hlbWUud2VhcG9ucykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUud2VhcG9uc1trZXldLmNyYXRlX2NoYW5jZTsgaSsrKSB7XG4gICAgICB0aGlzLmNyYXRlX2xpc3QucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGFybW91cnkgcmVmZXJlbmNlIHRhYmxlXG4gIHRoaXMuYXJtb3VyeV9yZWZzID0gW107XG4gIGZvciAoa2V5IGluIHRoaXMuc2NoZW1lLndlYXBvbnMpIHtcbiAgICB0aGlzLmFybW91cnlfcmVmcy5wdXNoKGtleSk7XG4gIH1cbn1cblxuLyogU2V0IGEgYmxhbmsgc3RhdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ibGFua19zdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4ge1xuICAgIGZyYW1lOiAwLFxuICAgIGV4cGxvc2lvbnM6IHt9LFxuICAgIG9iamVjdHM6IHt9LFxuICAgIHBsYXllcnM6IHt9LFxuICAgIGV2ZW50czogW11cbiAgfTtcbn07XG5cbi8qIFJ1biBldmVyeSBmcmFtZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmZyYW1lID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZnJhbWVfZXhwbG9zaW9ucygpO1xuICB0aGlzLmZyYW1lX3BsYXllcnMoKTtcbiAgdGhpcy5mcmFtZV9vYmplY3RzKCk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgRXZlbnRzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIGEgc3BlY2lmaWMgdHlwZSBvZiBldmVudFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50ID0gZnVuY3Rpb24ob2JqLCB0eXBlLCBjb2xsaWRlZF9vYmopIHtcbiAgdmFyIGV2ZW50ID0gb2JqLmMuZXZlbnRzW3R5cGVdO1xuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIGV2ZW50LCBjb2xsaWRlZF9vYmosIHR5cGUpO1xufTtcblxuLyogUnVuIGEgc3BlY2lmaWMgZXZlbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ydW5fZXZlbnQgPSBmdW5jdGlvbihvYmosIGV2ZW50LCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gaGFuZGxlIGFycmF5cyBvZiBldmVudHNcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgdmFyIHN0b3AgPSBmYWxzZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc3RvcDIgPSB0aGlzLnJ1bl9ldmVudChvYmosIGV2ZW50W2ldLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICAgICAgc3RvcCA9IHN0b3AyID8gdHJ1ZSA6IHN0b3A7XG4gICAgfVxuICAgIHJldHVybiBzdG9wO1xuICB9XG5cbiAgLy8gcnVuIGV2ZW50IGZ1bmN0aW9uXG4gIGlmIChldmVudCA9PT0gXCJkaWVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2RpZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwia2lsbFwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfa2lsbChvYmosIGNvbGxpZGVkX29iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiZXhwbG9kZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfZXhwbG9kZShvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImhpdF9naXZlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9oaXRfZ2l2ZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiaGl0X3JlY2VpdmVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2hpdF9yZWNlaXZlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJkZXN0cm95XCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9kZXN0cm95KG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiY2x1c3RlclwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfY2x1c3RlcihvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImJvdW5jZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfYm91bmNlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJib3VuY2VfZXhwbG9kZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfYm91bmNlX2V4cGxvZGUob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInN0aWNrXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9zdGljayhvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInNsaWRlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9zbGlkZShvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInBsYXllcl9ib3VuY2VcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X3BsYXllcl9ib3VuY2Uob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImRyYWdfcGxheWVyXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9kcmFnX3BsYXllcihvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcInNwYXduX2dob3N0XCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9zcGF3bl9naG9zdChvYmopO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImNvbGxlY3RcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2NvbGxlY3Qob2JqLCBjb2xsaWRlZF9vYmopO1xuICB9XG59O1xuXG4vKiBPYmplY3QgZGllXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfZGllID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gZGllIGV2ZW50XG4gIHRoaXMuZXZlbnQob2JqLCBcImRpZVwiKTtcblxuICAvLyBjaGVjayBmb3IgZGVzdHJveSBldmVudHNcbiAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5kZXN0cm95KSB7XG4gICAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5kZXN0cm95W29iai5pZF0pIHtcbiAgICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2godGhpcy5zY2hlbWUuZXZlbnRzLmRlc3Ryb3lbb2JqLmlkXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gZGVsZXRlIHRoZSBvYmplY3RcbiAgZGVsZXRlIHRoaXMuc3RhdGUub2JqZWN0c1tvYmoua2V5XTtcblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIE9iamVjdCBraWxsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfa2lsbCA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqKSB7XG4gIC8vIGRlc3Ryb3kgaXRcbiAgdGhpcy5ydW5fZXZlbnQoY29sbGlkZWRfb2JqLCBcImRpZVwiKTtcbn07XG5cbi8qIEV4cGxvZGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9leHBsb2RlID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGNyZWF0ZSBleHBsb3Npb24gb2JqZWN0XG4gIHRoaXMuY3JlYXRlX2V4cGxvc2lvbih7XG4gICAgcGxheWVyX2lkOiBvYmoucGxheWVyX2lkLFxuICAgIHg6IG9iai54LFxuICAgIHk6IG9iai55LFxuICAgIHBhcmVudDogb2JqLmtleSxcbiAgICBwYXJlbnRfdHlwZTogb2JqLnR5cGVcbiAgfSk7XG59O1xuXG4vKiBHaXZlIGEgaGl0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfaGl0X2dpdmUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICByZXR1cm4gdGhpcy5ydW5fZXZlbnQoY29sbGlkZWRfb2JqLCBcImhpdF9yZWNlaXZlXCIsIG9iaiwgdHlwZSk7XG59O1xuXG4vKiBSZWNlaXZlIGEgaGl0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfaGl0X3JlY2VpdmUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBwcmV2ZW50IGluc3RhbnQgaGl0c1xuICBpZiAob2JqLmhpdHMpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqLmhpdHMpIHtcbiAgICAgIGlmIChrZXkgPT09IGNvbGxpZGVkX29iai5rZXkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGNhbGN1bGF0ZSBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGl0IGNhbWUgZnJvbVxuICB2YXIgYW5nbGUgPSB0aGlzLm1hcC5nZXRfaGVhZGluZyhcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICBjb2xsaWRlZF9vYmoueCxcbiAgICBjb2xsaWRlZF9vYmoueVxuICApO1xuICB2YXIgZGlzdGFuY2UgPSB0aGlzLm1hcC5nZXRfZGlzdGFuY2UoXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgY29sbGlkZWRfb2JqLngsXG4gICAgY29sbGlkZWRfb2JqLnlcbiAgKTtcblxuICAvLyBnZXQgZGFtYWdlIHZhbHVlcyBmcm9tIGNvbGxpZGVkIG9iamVjdFxuICB2YXIgZGFtYWdlID0gdGhpcy5nZXRfZGFtYWdlKGNvbGxpZGVkX29iaik7XG4gIHZhciBrbm9jayA9IGNvbGxpZGVkX29iai5jLmtub2NrO1xuICBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZXhwbG9zaW9uXCIpIHtcbiAgICBkYW1hZ2UgKj0gbWF4KDAsIChkYW1hZ2UgKiAyIC0gZGlzdGFuY2UpIC8gKGRhbWFnZSAqIDIpKTtcbiAgfVxuXG4gIC8vIGlnbm9yZSBpZiB0aGVyZSdzIG5vIGRhbWFnZVxuICBpZiAoZGFtYWdlID09PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8ga25vY2sgb2JqZWN0XG4gIGlmIChrbm9jayA+IDApIHtcbiAgICB2YXIgeHkgPSB4eV9zcGVlZChhbmdsZSwgZGFtYWdlKTtcbiAgICBvYmouc3BlZWRfeCAtPSB4eS54LmZpeGVkKCk7XG4gICAgb2JqLnNwZWVkX3kgLT0geHkueS5maXhlZCgpO1xuICAgIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuICB9XG5cbiAgLy8gYXJlIHdlIGhpdHRpbmcgcGxheWVyXG4gIGlmIChvYmoudHlwZSA9PT0gXCJwbGF5ZXJcIikge1xuICAgIHRoaXMucGxheWVyX2hlYWx0aF9hZGQob2JqLnBsYXllcl9pZCwgLXJvdW5kKGRhbWFnZSkpO1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gICAgaWYgKHBsYXllcikge1xuICAgICAgcGxheWVyLmhpdCA9IGRhbWFnZSAqIDI7XG4gICAgfVxuICB9XG5cbiAgLy8gc291bmQgZWZmZWN0XG4gIGlmIChjb2xsaWRlZF9vYmouYy5hdWRpby5oaXQpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwic291bmRcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBzb3VuZDogY29sbGlkZWRfb2JqLmMuYXVkaW8uaGl0XG4gICAgfSk7XG4gIH1cblxuICAvLyBzZXQgaGl0c1xuICBpZiAoIW9iai5oaXRzKSB7XG4gICAgb2JqLmhpdHMgPSB7fTtcbiAgfVxuICBvYmouaGl0c1tjb2xsaWRlZF9vYmoua2V5XSA9IHRydWU7XG59O1xuXG4vKiBEZXN0cm95IGdyb3VuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2Rlc3Ryb3kgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gbGltaXQgdG8gb25jZSBwZXIgZnJhbWVcbiAgaWYgKG9iai5kZXN0cm95ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb2JqLmRlc3Ryb3llZCA9IHRydWU7XG5cbiAgdmFyIGRhbWFnZSA9IHRoaXMuZ2V0X2RhbWFnZShvYmopO1xuXG4gIC8vIHJlY29yZCBncm91bmQgZGFtYWdlXG4gIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgIHR5cGU6IFwiZ3JvdW5kX2RhbWFnZVwiLFxuICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgIGRpZzogdHJ1ZSxcbiAgICB4OiBvYmoueCxcbiAgICB5OiBvYmoueSxcbiAgICByYWRpdXM6IGRhbWFnZVxuICB9KTtcbn07XG5cbi8qIE9iamVjdCBib3VuY2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9ib3VuY2UgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBpZiBncm91bmRlZCBkb250IGRvIGFueXRoaW5nXG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIGNoZWNrIHNwZWVkXG4gIHZhciBzcGVlZCA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICB2YXIgY2hlY2tfc3BlZWQgPSBzcGVlZCAqIG9iai5jLmJvdW5jZTtcbiAgaWYgKGNoZWNrX3NwZWVkIDwgMSkge1xuICAgIG9iai5zcGVlZF94ID0gMDtcbiAgICBvYmouc3BlZWRfeSA9IDA7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBnZXQgbmV3IGRpcmVjdGlvbiBhbmdsZVxuICB2YXIgZGlyZWN0aW9uID0gZ2V0X2FuZ2xlKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gIHZhciBzdXJmYWNlX2FuZ2xlID0gMDtcblxuICAvLyBnZXQgYW5nbGUgZnJvbSBncm91bmRcbiAgaWYgKHR5cGUgPT09IFwiZ3JvdW5kXCIpIHtcbiAgICB2YXIgd2FsayA9IHRoaXMubWFwLndhbGsocm91bmQob2JqLngpLCByb3VuZChvYmoueSksIDAsIDAsIGRpcmVjdGlvbiwgNik7XG4gICAgaWYgKHdhbGsubW92ZSkge1xuICAgICAgc3VyZmFjZV9hbmdsZSA9IHdhbGsuYW5nbGU7XG4gICAgfVxuICB9XG5cbiAgLy8gZ2V0IGFuZ2xlIGZyb20gb2JqZWN0XG4gIGVsc2Uge1xuICAgIHZhciBoZWFkaW5nID0gdGhpcy5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgICBvYmoueCxcbiAgICAgIG9iai55LFxuICAgICAgY29sbGlkZWRfb2JqLngsXG4gICAgICBjb2xsaWRlZF9vYmoueVxuICAgICk7XG4gICAgc3VyZmFjZV9hbmdsZSA9IGFuZ2xlX2FkZChoZWFkaW5nLCA5MCk7XG4gIH1cblxuICAvLyByZWZsZWN0IGRpcmVjdGlvbiBhbmdsZSB3aXRoIGNvbGxpc2lvbiBhbmdsZVxuICB2YXIgcmVmbGVjdGlvbiA9IChkaXJlY3Rpb24gLSBzdXJmYWNlX2FuZ2xlKSAqIDI7XG4gIHZhciBuZXdfYW5nbGUgPSBhbmdsZV9hZGQoZGlyZWN0aW9uLCAtcmVmbGVjdGlvbik7XG5cbiAgLy8gdHJhbnNmb3JtIG1haW4gdmVsb2NpdHkgdG93YXJkcyBuZXcgYW5nbGVcbiAgdmFyIG5ld19zcGVlZCA9IHh5X3NwZWVkKG5ld19hbmdsZSwgY2hlY2tfc3BlZWQpO1xuICBvYmouc3BlZWRfeCA9IG5ld19zcGVlZC54LmZpeGVkKCk7XG4gIG9iai5zcGVlZF95ID0gbmV3X3NwZWVkLnkuZml4ZWQoKTtcblxuICAvLyByZWNvcmQgYm91bmNlIGV2ZW50XG4gIGlmIChzcGVlZCA+IDIpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiYm91bmNlXCIsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgb2JqOiBvYmoua2V5XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIE9iamVjdCBzdGljayB0byBncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9zdGljayA9IGZ1bmN0aW9uKG9iaikge1xuICBvYmouZ3JvdW5kZWQgPSB0cnVlO1xuICBvYmouc3BlZWRfeCA9IDA7XG4gIG9iai5zcGVlZF95ID0gMDtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBPYmplY3Qgc2xpZGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9zbGlkZSA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgYW5nbGUgPSBnZXRfYW5nbGUob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgdmFyIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCBhbmdsZSwgb2JqLnNwZWVkX2xlZnQpO1xuICBpZiAod2Fsay5tb3ZlKSB7XG4gICAgdGhpcy5hY3Rpb25fd2Fsa19tb3ZlKG9iaiwgd2Fsay5wYXRoKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIFBsYXllciBib3VuY2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9wbGF5ZXJfYm91bmNlID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpIHtcbiAgLy8gaWYgZ3JvdW5kZWQgZG9udCBkbyBhbnl0aGluZ1xuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgc3BlZWQgPSBnZXRfc3BlZWQob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcblxuICB2YXIgbWF4X3NwZWVkID0gdGhpcy5zY2hlbWUubGV2ZWxzLmp1bXBbcGxheWVyLmxldmVsXSB8fCAwO1xuICBtYXhfc3BlZWQgKz0gMTA7XG4gIGlmIChwbGF5ZXIuaGl0ID4gMCB8fCBzcGVlZCA+IG1heF9zcGVlZCkge1xuICAgIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIFwiYm91bmNlXCIsIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJzdGlja1wiKTtcbiAgfVxufTtcblxuLyogRHJhZyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9kcmFnX3BsYXllciA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgcGxheWVyX29iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIG9iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcl9vYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBwbGF5ZXJfb2JqLnNwZWVkX3ggPSBvYmouc3BlZWRfeDtcbiAgcGxheWVyX29iai5zcGVlZF95ID0gb2JqLnNwZWVkX3k7XG4gIHBsYXllcl9vYmouZHJhZ2dlZCA9IHRydWU7XG59O1xuXG4vKiBGaXJzdCBEZXN0cm95XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfYm91bmNlX2V4cGxvZGUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICBpZiAob2JqLmZyYW1lICsgMTAgPiB0aGlzLnN0YXRlLmZyYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJib3VuY2VcIiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdGhpcy5ydW5fZXZlbnQob2JqLCBcImV4cGxvZGVcIik7XG4gIH1cbn07XG5cbi8qIFNwYXduIHBsYXllciBnaG9zdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X3NwYXduX2dob3N0ID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIHRyYW5zZm9ybSBvYmplY3QgaW50byBnaG9zdFxuICBvYmoudHlwZSA9IFwicGxheWVyX2dob3N0XCI7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbXCJwbGF5ZXJfZ2hvc3RcIl07XG4gIG9iai5zcGVlZF94ID0gMDtcbiAgb2JqLnNwZWVkX3kgPSAwO1xufTtcblxuLyogQ2x1c3RlcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9jbHVzdGVyID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIHNldCBvZmYgZXhwbG9zaW9uc1xuICB0aGlzLnJ1bl9ldmVudChvYmosIFwiZXhwbG9kZVwiKTtcblxuICAvLyBnZXQgY2x1c3RlciBjb25zdGFudHNcbiAgdmFyIGNsdXN0ZXIgPSBvYmouYy5jbHVzdGVyO1xuXG4gIC8vIGdldCBvcHBvc2l0ZSBhbmdsZSBvZiBncmF2aXR5XG4gIHZhciBhbmdsZSA9IHRoaXMubWFwLmdldF9ncmF2aXR5X2FuZ2xlKG9iai54LCBvYmoueSk7XG4gIGFuZ2xlID0gYW5nbGVfYWRkKGFuZ2xlLCAxMzUpO1xuXG4gIC8vIGdvIHRocm91Z2ggY2x1c3RlcnNcbiAgdmFyIHJhbmdlID0gY2x1c3Rlci5jaXJjbGUgPyAzNjAgLSAzNjAgLyBjbHVzdGVyLmNvdW50IDogOTA7XG4gIHZhciBhbmdsZV9kaWZmID0gcmFuZ2UgLyAoY2x1c3Rlci5jb3VudCAtIDEpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNsdXN0ZXIuY291bnQ7IGkrKykge1xuICAgIC8vIGNyZWF0ZSBjbHVzdGVyIG9iamVjdHNcbiAgICB2YXIgbGF1bmNoX2FuZ2xlID0gYW5nbGVfYWRkKGFuZ2xlLCBpICogYW5nbGVfZGlmZik7XG4gICAgdmFyIHNwZWVkID0geHlfc3BlZWQobGF1bmNoX2FuZ2xlLCBjbHVzdGVyLnNwZWVkKTtcblxuICAgIC8vIGNyZWF0ZSBjbHVzdGVyIG9iamVjdFxuICAgIHRoaXMuY3JlYXRlX29iamVjdCh7XG4gICAgICB0eXBlOiBjbHVzdGVyLm9iamVjdCxcbiAgICAgIGlkOiBvYmouaWQsXG4gICAgICBkYXRhOiBpICsgMSxcbiAgICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBzcGVlZF94OiBzcGVlZC54LmZpeGVkKCksXG4gICAgICBzcGVlZF95OiBzcGVlZC55LmZpeGVkKClcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogQ29sbGVjdCBDcmF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2NvbGxlY3QgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaikge1xuICAvLyBwcmVwIGV2ZW50IHRvIHNlbmQgdG8gZ2FtZVxuICB2YXIgZXZlbnQgPSB7XG4gICAgdHlwZTogXCJjb2xsZWN0XCIsXG4gICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5LFxuICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZFxuICB9O1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNyYXRlXG4gIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJjcmF0ZVwiKSB7XG4gICAgdmFyIGNvdW50ID0gdGhpcy5zY2hlbWUud2VhcG9uc1tjb2xsaWRlZF9vYmouZGF0YV0uY3JhdGVfY291bnQ7XG4gICAgY291bnQgPSBjb3VudCA9PT0gLTEgPyBcImluZmluaXRlXCIgOiBjb3VudDtcbiAgICB0aGlzLnVwZGF0ZV9wbGF5ZXJfYXJtb3VyeShvYmoucGxheWVyX2lkLCBjb2xsaWRlZF9vYmouZGF0YSwgY291bnQpO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiY3JhdGVcIjtcbiAgICBldmVudC53ZWFwb24gPSBjb2xsaWRlZF9vYmouZGF0YTtcbiAgICBldmVudC5jb3VudCA9IGNvdW50O1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiY3JhdGVcIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9XG5cbiAgLy8gbWVkcGFja1xuICBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJtZWRwYWNrXCIpIHtcbiAgICB0aGlzLnBsYXllcl9oZWFsdGhfYWRkKG9iai5wbGF5ZXJfaWQsIHRoaXMuc2NoZW1lLmRyb3BzLm1lZHBhY2suYWRkKTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcIm1lZHBhY2tcIjtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcIm1lZHBhY2tcIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9XG5cbiAgLy8gZ2Vtc1xuICBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tMVwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfc2NvcmVfYWRkKG9iai5wbGF5ZXJfaWQsIDEpO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDE7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS01XCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgNSk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gNTtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZ2VtLTIwXCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgMjApO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDIwO1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiZ2VtXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tNTBcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCA1MCk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gNTA7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS0yMDBcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCAyMDApO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwiZ2VtXCI7XG4gICAgZXZlbnQubiA9IDIwMDtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH1cblxuICAvLyByZWNvcmQgZXZlbnRcbiAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaChldmVudCk7XG5cbiAgLy8ga2lsbCBvYmplY3RcbiAgdGhpcy5ydW5fZXZlbnQoY29sbGlkZWRfb2JqLCBcImRpZVwiLCBvYmosIFwiY29sbGVjdFwiKTtcblxuICAvLyBjaGVjayBmb3IgY29sbGVjdGlvbiBldmVudHNcbiAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5jb2xsZWN0KSB7XG4gICAgaWYgKHRoaXMuc2NoZW1lLmV2ZW50cy5jb2xsZWN0W2NvbGxpZGVkX29iai5pZF0pIHtcbiAgICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2godGhpcy5zY2hlbWUuZXZlbnRzLmNvbGxlY3RbY29sbGlkZWRfb2JqLmlkXSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEV4cGxvc2lvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDcmVhdGUgYW4gZXhwbG9zaW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY3JlYXRlX2V4cGxvc2lvbiA9IGZ1bmN0aW9uKHByb3BzLCBzdGF0ZSkge1xuICB2YXIgc3RhdGVfcmVmID0gc3RhdGUgfHwgdGhpcy5zdGF0ZTtcblxuICB2YXIgb2JqID0ge1xuICAgIHR5cGU6IFwiZXhwbG9zaW9uXCIsXG4gICAgcGxheWVyX2lkOiBcIlwiLFxuICAgIGZyYW1lOiBzdGF0ZV9yZWYuZnJhbWUsXG4gICAgeDogMCxcbiAgICB5OiAwLFxuICAgIHBhcmVudDogXCJcIixcbiAgICBwYXJlbnRfdHlwZTogXCJcIlxuICB9O1xuICBvYmogPSBkZWVwbWVyZ2Uob2JqLCBwcm9wcyk7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbb2JqLnBhcmVudF90eXBlXTtcblxuICAvLyBhZGQgdG8gc3RhdGUgb2JqZWN0c1xuICBzdGF0ZV9yZWYuZXhwbG9zaW9uc1tvYmoucGFyZW50XSA9IG9iajtcbn07XG5cbi8qIENoZWNrIGFsbCBleGlzdGluZyBleHBsb3Npb25zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZnJhbWVfZXhwbG9zaW9ucyA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIGFsbCBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLmV4cGxvc2lvbnMpIHtcbiAgICB2YXIgZXhwbG9kZSA9IHRoaXMuc3RhdGUuZXhwbG9zaW9uc1trZXldO1xuXG4gICAgLy8gaWYgZXhwaXJlZCByZW1vdmVcbiAgICBpZiAodGhpcy5zdGF0ZS5mcmFtZSA+IGV4cGxvZGUuZnJhbWUgKyA0MCkge1xuICAgICAgZGVsZXRlIHRoaXMuc3RhdGUuZXhwbG9zaW9uc1trZXldO1xuICAgIH1cblxuICAgIC8vIGlmIGV4cGxvZGluZyB0aGlzIGZyYW1lIHJ1blxuICAgIGlmICh0aGlzLnN0YXRlLmZyYW1lID09PSBleHBsb2RlLmZyYW1lICsgMSkge1xuICAgICAgdGhpcy5ydW5fZXhwbG9zaW9uKGV4cGxvZGUpO1xuICAgIH1cbiAgfVxufTtcblxuLyogUnVuIGFuIGV4cGxvc2lvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnJ1bl9leHBsb3Npb24gPSBmdW5jdGlvbihleHBsb2RlKSB7XG4gIC8vIGlmIG5vIGRhbWFnZVxuICBpZiAoIWV4cGxvZGUuYy5kYW1hZ2UpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgYWRkaXRpb25hbCBwbGF5ZXIgZGFtYWdlXG4gIHZhciBkYW1hZ2UgPSB0aGlzLmdldF9kYW1hZ2UoZXhwbG9kZSk7XG5cbiAgLy8gY2hlY2sgY29sbGlzaW9uc1xuICBmb3IgKGtleSBpbiB0aGlzLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW2tleV07XG5cbiAgICAvLyBpZiBvYmplY3Qgd2FzIGp1c3QgbWFkZVxuICAgIGlmICh0aGlzLnN0YXRlLmZyYW1lIDwgb2JqLmZyYW1lICsgMikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gcnVuIGNvbGxpc2lvbiBjaGVja1xuICAgIGlmIChcbiAgICAgICF0aGlzLmNvbGxpc2lvbl9jaGVjayhcbiAgICAgICAgb2JqLngsXG4gICAgICAgIG9iai55LFxuICAgICAgICBleHBsb2RlLngsXG4gICAgICAgIGV4cGxvZGUueSxcbiAgICAgICAgb2JqLmMuc2l6ZSxcbiAgICAgICAgZGFtYWdlICogMlxuICAgICAgKVxuICAgICkge1xuICAgICAgdGhpcy5ldmVudChvYmosIFwiZXhwbG9zaW9uXCIsIGV4cGxvZGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJlY29yZCBncm91bmQgZGFtYWdlXG4gIHZhciBwdHlwZSA9IHRoaXMuYy5vYmplY3RzW2V4cGxvZGUucGFyZW50X3R5cGVdO1xuICBpZiAocHR5cGUgJiYgcHR5cGUuZGVzdHJveV9ncm91bmQpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiZ3JvdW5kX2RhbWFnZVwiLFxuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB4OiBleHBsb2RlLngsXG4gICAgICB5OiBleHBsb2RlLnksXG4gICAgICByYWRpdXM6IGRhbWFnZVxuICAgIH0pO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgT2JqZWN0c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBhIG5ldyBnYW1lIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNyZWF0ZV9vYmplY3QgPSBmdW5jdGlvbihwcm9wcywgc3RhdGUpIHtcbiAgdmFyIHN0YXRlX3JlZiA9IHN0YXRlIHx8IHRoaXMuc3RhdGU7XG5cbiAgdmFyIG9iaiA9IHtcbiAgICB0eXBlOiBcIlwiLFxuICAgIHBsYXllcl9pZDogXCJcIixcbiAgICBpZDogXCJcIixcbiAgICBmcmFtZTogc3RhdGVfcmVmLmZyYW1lLFxuICAgIGdyb3VuZGVkOiBmYWxzZSxcbiAgICB4OiAwLFxuICAgIHk6IDAsXG4gICAgc3BlZWRfeDogMCxcbiAgICBzcGVlZF95OiAwLFxuICAgIGRhdGE6IFwiXCJcbiAgfTtcbiAgb2JqID0gZGVlcG1lcmdlKG9iaiwgcHJvcHMpO1xuICBvYmouYyA9IHRoaXMuYy5vYmplY3RzW29iai50eXBlXTtcbiAgdmFyIGtleV90eXBlID0gb2JqLnR5cGU7XG5cbiAgLy8gc2V0IGtleVxuICBpZiAoXG4gICAgb2JqLnR5cGUgPT09IFwicGxheWVyXCIgfHxcbiAgICBvYmoudHlwZSA9PT0gXCJwbGF5ZXJfZ2hvc3RcIiB8fFxuICAgIG9iai50eXBlID09PSBcInBsYXllcl9taXNzaWxlXCJcbiAgKSB7XG4gICAgb2JqLmtleSA9IFwicGxheWVyLVwiICsgb2JqLnBsYXllcl9pZDtcbiAgfSBlbHNlIHtcbiAgICBvYmoua2V5ID1cbiAgICAgIG9iai50eXBlICtcbiAgICAgIFwiLVwiICtcbiAgICAgIG9iai5wbGF5ZXJfaWQgK1xuICAgICAgXCItXCIgK1xuICAgICAgb2JqLmlkICtcbiAgICAgIFwiLVwiICtcbiAgICAgIG9iai5mcmFtZSArXG4gICAgICBcIi1cIiArXG4gICAgICBvYmouZGF0YTtcbiAgfVxuXG4gIC8vIGFkZCB0byBzdGF0ZSBvYmplY3RzXG4gIHN0YXRlX3JlZi5vYmplY3RzW29iai5rZXldID0gb2JqO1xuXG4gIC8vIHJldHVybiBpdFxuICByZXR1cm4gb2JqO1xufTtcblxuLyogU25hcCBvYmplY3QgdG8gYW5vdGhlciBvYmplY3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5zbmFwX29iamVjdCA9IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgb2JqMS5ncm91bmRlZCA9IG9iajIuZ3JvdW5kZWQ7XG4gIG9iajEueCA9IG9iajIueDtcbiAgb2JqMS55ID0gb2JqMi55O1xuICBvYmoxLnNwZWVkX3ggPSBvYmoyLnNwZWVkX3g7XG4gIG9iajEuc3BlZWRfeSA9IG9iajIuc3BlZWRfeTtcbn07XG5cbi8qIFJ1biB0aHJvdWdoIG9iamVjdCBmcmFtZSBldmVudHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9vYmplY3RzID0gZnVuY3Rpb24oKSB7XG4gIC8vIHJ1biB0aHJvdWdoIGFsbCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLm9iamVjdHMpIHtcbiAgICB0aGlzLmZyYW1lX29iamVjdCh0aGlzLnN0YXRlLm9iamVjdHNba2V5XSk7XG4gIH1cblxuICAvLyBjaGVjayBmb3IgcGxheWVyIGxvY2tcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUucGxheWVycykge1xuICAgIHRoaXMuZnJhbWVfcGxheWVyX2xvY2sodGhpcy5zdGF0ZS5wbGF5ZXJzW2tleV0pO1xuICB9XG59O1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb2JqLmRlc3Ryb3llZCA9IGZhbHNlO1xuXG4gIC8vIHN0b3BwaW5nXG4gIGlmIChvYmouYy5zdG9wID4gMCAmJiB0aGlzLnN0YXRlLmZyYW1lID4gb2JqLmZyYW1lICsgb2JqLmMuc3RvcCkge1xuICAgIG9iai5zcGVlZF94ID0gMDtcbiAgICBvYmouc3BlZWRfeSA9IDA7XG4gIH1cblxuICAvLyB0aW1lb3V0XG4gIGlmIChvYmouYy50aW1lb3V0ID4gMCAmJiBvYmouZnJhbWUgKyBvYmouYy50aW1lb3V0IDw9IHRoaXMuc3RhdGUuZnJhbWUpIHtcbiAgICB0aGlzLnJ1bl9ldmVudChvYmosIFwiZGllXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJ1biBwaHlzaWNzIG9uIG9iamVjdFxuICB0aGlzLnBoeXNpY3Mob2JqKTtcblxuICAvLyBldmVudHNcbiAgdGhpcy5ldmVudChvYmosIFwiZnJhbWVcIik7XG59O1xuXG4vKiBTcGF3bnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5zcGF3biA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gIC8vIHdlYXBvbiBjcmF0ZSBjb250ZW50c1xuICBpZiAocHJvcHMudHlwZSA9PSBcImNyYXRlXCIpIHtcbiAgICBpZiAodGhpcy5jcmF0ZV9saXN0Lmxlbmd0aCA8IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcHJvcHMuZGF0YSA9IHRoaXMuY3JhdGVfbGlzdFtyYW5kKDAsIHRoaXMuY3JhdGVfbGlzdC5sZW5ndGgpXTtcbiAgfVxuXG4gIC8vIGRvIHdlIGhhdmUgYSBzZXQgcG9zaXRpb25cbiAgaWYgKCFwcm9wcy54ICYmICFwcm9wcy55KSB7XG4gICAgdmFyIHBvcyA9IHRoaXMubWFwLmFpcl9maW5kX3Nwb3QoKTtcbiAgICBwcm9wcy54ID0gcG9zLng7XG4gICAgcHJvcHMueSA9IHBvcy55O1xuICB9XG5cbiAgcmV0dXJuIHRoaXMuY3JlYXRlX29iamVjdChwcm9wcyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgUGh5c2ljc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBhaXIgcGh5c2ljc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3MgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gYXJlIHdlIHN0aWxsIGdyb3VuZGVkXG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICBpZiAoIXRoaXMubWFwLmdyb3VuZF9waXhlbChyb3VuZChvYmoueCksIHJvdW5kKG9iai55KSkpIHtcbiAgICAgIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJ1biB0aGUgbWFpbiBwaHlzaWNzXG4gIGlmICghb2JqLmdyb3VuZGVkKSB7XG4gICAgdGhpcy5waHlzaWNzX2dyYXZpdHkob2JqKTtcbiAgICB0aGlzLnBoeXNpY3NfbW92ZShvYmopO1xuICB9XG59O1xuXG4vKiBDYWxjdWxhdGUgZ3Jhdml0eVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3NfZ3Jhdml0eSA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBpZiBubyB3ZWlnaHRcbiAgaWYgKG9iai5jLndlaWdodCA8PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IGdyYXZpdHkgdmFsdWVzXG4gIHZhciBncmF2aXR5ID0gdGhpcy5tYXAuZ2V0X2dyYXZpdHkocm91bmQob2JqLngpLCByb3VuZChvYmoueSkpO1xuXG4gIC8vIGFkanVzdCBzcGVlZFxuICB0aGlzLnBoeXNpY3NfYWRqdXN0X3NwZWVkKFxuICAgIG9iaixcbiAgICBncmF2aXR5LngsXG4gICAgZ3Jhdml0eS55LFxuICAgIG9iai5jLnNwZWVkLm1heF9ncmF2aXR5LFxuICAgIG9iai5jLndlaWdodFxuICApO1xufTtcblxuLyogQWRqdXN0IHNwZWVkIG9mIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBoeXNpY3NfYWRqdXN0X3NwZWVkID0gZnVuY3Rpb24oXG4gIG9iaixcbiAgbmV3X3NwZWVkX3gsXG4gIG5ld19zcGVlZF95LFxuICBtYXhfc3BlZWQsXG4gIHdlaWdodFxuKSB7XG4gIHZhciBhbmdsZSA9IGdldF9hbmdsZShuZXdfc3BlZWRfeCwgbmV3X3NwZWVkX3kpO1xuICB2YXIgbWF4X3NwZWVkID0geHlfc3BlZWQoYW5nbGUsIG1heF9zcGVlZCk7XG4gIHZhciBzcGVlZF9hZGRfeCA9IG5ld19zcGVlZF94ICogd2VpZ2h0O1xuICB2YXIgc3BlZWRfYWRkX3kgPSBuZXdfc3BlZWRfeSAqIHdlaWdodDtcbiAgdmFyIGRpZmZfeCA9IG1heF9zcGVlZC54IC0gb2JqLnNwZWVkX3g7XG4gIHZhciBkaWZmX3kgPSBtYXhfc3BlZWQueSAtIG9iai5zcGVlZF95O1xuXG4gIC8vIG9ubHkgYWRkIHNwZWVkIHVwIHRvIHRoZSBsaW1pdCB3aXRob3V0IGJyaW5naW5nIGl0IGRvd25cbiAgaWYgKG1heF9zcGVlZC54IDwgMCkge1xuICAgIG9iai5zcGVlZF94ICs9IG1heChzcGVlZF9hZGRfeCwgbWluKDAsIGRpZmZfeCkpO1xuICB9IGVsc2Uge1xuICAgIG9iai5zcGVlZF94ICs9IG1pbihzcGVlZF9hZGRfeCwgbWF4KDAsIGRpZmZfeCkpO1xuICB9XG4gIGlmIChtYXhfc3BlZWQueSA8IDApIHtcbiAgICBvYmouc3BlZWRfeSArPSBtYXgoc3BlZWRfYWRkX3ksIG1pbigwLCBkaWZmX3kpKTtcbiAgfSBlbHNlIHtcbiAgICBvYmouc3BlZWRfeSArPSBtaW4oc3BlZWRfYWRkX3ksIG1heCgwLCBkaWZmX3kpKTtcbiAgfVxuXG4gIG9iai5zcGVlZF94ID0gb2JqLnNwZWVkX3guZml4ZWQoKTtcbiAgb2JqLnNwZWVkX3kgPSBvYmouc3BlZWRfeS5maXhlZCgpO1xufTtcblxuLyogRG8gdGhlIG1vdmVtZW50XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGh5c2ljc19tb3ZlID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGNoZWNrIHNwZWVkXG4gIHZhciBzcGVlZF9saW1pdCA9IGNoZWNrX3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSwgb2JqLmMuc3BlZWQubWF4KTtcbiAgb2JqLnNwZWVkX3ggPSBzcGVlZF9saW1pdC54LmZpeGVkKCk7XG4gIG9iai5zcGVlZF95ID0gc3BlZWRfbGltaXQueS5maXhlZCgpO1xuXG4gIC8vIHBsb3QgYSBjb3Vyc2VcbiAgdmFyIGNvdXJzZSA9IHBsb3RfY291cnNlKG9iai54LCBvYmoueSwgb2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcblxuICAvLyBpZiBubyBjb3Vyc2VcbiAgaWYgKCFjb3Vyc2UubW92ZSkge1xuICAgIHRoaXMuY29sbGlzaW9ucyhvYmosIG9iai54LCBvYmoueSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gbW92ZSB0aHJvdWdoIGNvdXJzZVxuICB2YXIgbW92ZWQgPSBmYWxzZTtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBjb3Vyc2UucG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgLy8gcmVtYWluaW5nIG1vdmVtZW50IHBvaW50cyBsZWZ0XG4gICAgb2JqLnNwZWVkX2xlZnQgPSBjb3Vyc2UucG9pbnRzLmxlbmd0aCAtIGk7XG5cbiAgICB2YXIgcG9pbnQgPSBjb3Vyc2UucG9pbnRzW2ldO1xuICAgIHZhciBueCA9IHRoaXMubWFwLmxvb3BfeChyb3VuZChwb2ludC54KSk7XG4gICAgdmFyIG55ID0gdGhpcy5tYXAubG9vcF95KHJvdW5kKHBvaW50LnkpKTtcblxuICAgIC8vIGNvbGxpc2lvbnNcbiAgICB2YXIgY29sbGlzaW9uID0gdGhpcy5jb2xsaXNpb25zKG9iaiwgbngsIG55KTtcbiAgICBpZiAoY29sbGlzaW9uKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBtb3ZlIG9iamVjdFxuICAgIG9iai54ID0gbng7XG4gICAgb2JqLnkgPSBueTtcbiAgICBtb3ZlZCA9IHRydWU7XG4gIH1cblxuICByZXR1cm4gbW92ZWQ7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgUGxheWVyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBhIG5ldyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jcmVhdGVfcGxheWVyID0gZnVuY3Rpb24ocHJvcHMsIHN0YXRlKSB7XG4gIGlmICh0eXBlb2YgcHJvcHMuaWQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc3RhdGVfcmVmID0gc3RhdGUgfHwgdGhpcy5zdGF0ZTtcblxuICAvLyBzZXQgdXAgb2JqZWN0XG4gIHZhciBvYmogPSB7XG4gICAgaWQ6IFwiXCIsXG4gICAgbGV2ZWw6IDAsXG4gICAgc2NvcmU6IDAsXG4gICAgZGVhZDogZmFsc2UsXG4gICAgaGVhbHRoOiB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoWzBdLFxuICAgIGNvb2xkb3duOiAwLFxuICAgIGhpdDogMCxcbiAgICB3ZWFwb246IFwiXCIsXG4gICAgbG9ja2VkOiBcIlwiLFxuICAgIGV2ZW50czogW10sXG4gICAgYXJtb3VyeToge31cbiAgfTtcbiAgb2JqID0gZGVlcG1lcmdlKG9iaiwgcHJvcHMpO1xuICBvYmouaWQgPSBwYXJzZUludChvYmouaWQpO1xuXG4gIC8vIHNldCBsZXZlbFxuICB0aGlzLnBsYXllcl9sZXZlbChvYmouaWQpO1xuXG4gIC8vIGFkZCB0byBzdGF0ZSBvYmplY3RzXG4gIHN0YXRlX3JlZi5wbGF5ZXJzW29iai5pZF0gPSBvYmo7XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cbi8qIFJlbW92ZSBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5yZW1vdmVfcGxheWVyID0gZnVuY3Rpb24ocGxheWVyX2lkKSB7XG4gIGlmICghdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBkZWxldGUgdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyX2lkXTtcbiAgZGVsZXRlIHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xufTtcblxuLyogU3RhcnQgdGhlIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmluaXRfcGxheWVyID0gZnVuY3Rpb24ocGxheWVyX2lkLCBzdGF0ZSkge1xuICBwbGF5ZXJfaWQgPSBwYXJzZUludChwbGF5ZXJfaWQpO1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcGxheWVyIHZhbHVlc1xuICBwbGF5ZXIubGV2ZWwgPSAwO1xuICBwbGF5ZXIuc2NvcmUgPSAwO1xuICBwbGF5ZXIuZGVhZCA9IGZhbHNlO1xuICBwbGF5ZXIuaGVhbHRoID0gdGhpcy5zY2hlbWUubGV2ZWxzLmhlYWx0aFswXTtcbiAgcGxheWVyLmNvb2xkb3duID0gMDtcbiAgcGxheWVyLmV2ZW50cyA9IFtdO1xuXG4gIC8vIGFybW91cnlcbiAgdmFyIGFybW91cnkgPSB7fTtcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc2NoZW1lLndlYXBvbnMpIHtcbiAgICBhcm1vdXJ5W2tleV0gPSB0aGlzLnNjaGVtZS53ZWFwb25zW2tleV0uc3RhcnRfY291bnQ7XG4gIH1cbiAgcGxheWVyLmFybW91cnkgPSBhcm1vdXJ5O1xuXG4gIC8vIG1lcmdlIHdpdGggYW4gZXh0ZXJuYWwgc3RhdGVcbiAgaWYgKHN0YXRlKSB7XG4gICAgdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF0gPSBkZWVwbWVyZ2UocGxheWVyLCBzdGF0ZSk7XG4gIH1cblxuICAvLyBzZXQgbGV2ZWxcbiAgdGhpcy5wbGF5ZXJfbGV2ZWwocGxheWVyX2lkKTtcblxuICAvLyBvYmplY3QgdmFsdWVzXG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAodGhpcy5zY2hlbWUuc3Bhd24ubGVuZ3RoID4gMCkge1xuICAgIHZhciBwb3MgPSB0aGlzLnNjaGVtZS5zcGF3bltyYW5kKDAsIHRoaXMuc2NoZW1lLnNwYXduLmxlbmd0aCldO1xuICB9IGVsc2Uge1xuICAgIHZhciBwb3MgPSB0aGlzLm1hcC5haXJfZmluZF9zcG90KCk7XG4gIH1cbiAgb2JqLnR5cGUgPSBcInBsYXllclwiO1xuICBvYmouZ3JvdW5kZWQgPSBmYWxzZTtcbiAgb2JqLnggPSBwb3MueDtcbiAgb2JqLnkgPSBwb3MueTtcbiAgb2JqLnNwZWVkX3ggPSAwO1xuICBvYmouc3BlZWRfeSA9IDA7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbXCJwbGF5ZXJcIl07XG59O1xuXG4vKiBVcGRhdGUgYXJtb3VyeVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnVwZGF0ZV9wbGF5ZXJfYXJtb3VyeSA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgd2VhcG9uLCBjb3VudCkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaWYgaW5maW5pdGUgb3IgaWYgemVybyBhbmQgdGFraW5nIGF3YXlcbiAgdmFyIG9sZF9jb3VudCA9IHBsYXllci5hcm1vdXJ5W3dlYXBvbl07XG4gIGlmICghaXNfbnVtZXJpYyhvbGRfY291bnQpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChvbGRfY291bnQgPT09IC0xKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKG9sZF9jb3VudCA9PT0gMCAmJiBjb3VudCA8IDEpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBpZiBpbmZpbml0ZVxuICBpZiAoY291bnQgPT09IFwiaW5maW5pdGVcIikge1xuICAgIHBsYXllci5hcm1vdXJ5W3dlYXBvbl0gPSAtMTtcbiAgfSBlbHNlIHtcbiAgICBwbGF5ZXIuYXJtb3VyeVt3ZWFwb25dICs9IGNvdW50O1xuICB9XG5cbiAgLy8gcmVjb3JkIGV2ZW50XG4gIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgIHR5cGU6IFwiYXJtb3VyeVwiLFxuICAgIHBsYXllcl9pZDogcGxheWVyX2lkLFxuICAgIHdlYXBvbjogd2VhcG9uXG4gIH0pO1xuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogQWRkIGhlYWx0aCB0byBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfaGVhbHRoX2FkZCA9IGZ1bmN0aW9uKHBsYXllcl9pZCwgaGVhbHRoLCBub19tZXNzYWdlKSB7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIgfHwgcGxheWVyLmRlYWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBubyBoZWFsdGggZW5hYmxlZFxuICBpZiAoIXRoaXMuc2NoZW1lLmhlYWx0aCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGFkZCBpdFxuICBwbGF5ZXIuaGVhbHRoICs9IGhlYWx0aDtcbiAgcGxheWVyLmhlYWx0aCA9IG1pbihwbGF5ZXIuaGVhbHRoLCB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoW3BsYXllci5sZXZlbF0pO1xuXG4gIC8vIGFyZSB3ZSBkZWFkXG4gIGlmIChwbGF5ZXIuaGVhbHRoIDw9IDApIHtcbiAgICB0aGlzLnBsYXllcl9kaWUocGxheWVyX2lkKTtcbiAgfVxuXG4gIC8vIHNldCBldmVudFxuICBpZiAoIW5vX21lc3NhZ2UpIHtcbiAgICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICAgIHR5cGU6IFwicGxheWVyX2hlYWx0aFwiLFxuICAgICAgaWQ6IHBsYXllcl9pZCxcbiAgICAgIGhlYWx0aDogaGVhbHRoXG4gICAgfSk7XG4gIH1cbn07XG5cbi8qIEFkZCBzY29yZSB0byBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfc2NvcmVfYWRkID0gZnVuY3Rpb24ocGxheWVyX2lkLCBzY29yZSkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8IHBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYWRkIGl0XG4gIHBsYXllci5zY29yZSArPSBzY29yZTtcblxuICAvLyBzZXQgbGV2ZWxcbiAgdGhpcy5wbGF5ZXJfbGV2ZWwocGxheWVyX2lkKTtcblxuICAvLyBzZXQgZXZlbnRcbiAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgdHlwZTogXCJwbGF5ZXJfc2NvcmVcIixcbiAgICBpZDogcGxheWVyX2lkLFxuICAgIHNjb3JlOiBzY29yZVxuICB9KTtcbn07XG5cbi8qIFNldCBwbGF5ZXIgbGV2ZWxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfbGV2ZWwgPSBmdW5jdGlvbihwbGF5ZXJfaWQpIHtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCBwbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggbGV2ZWxzXG4gIHZhciBsZXZlbCA9IDA7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHRoaXMuc2NoZW1lLmxldmVscy5zY29yZVtpXSA8PSBwbGF5ZXIuc2NvcmUpIHtcbiAgICAgIGxldmVsID0gaTtcbiAgICB9XG4gIH1cbiAgcGxheWVyLmxldmVsID0gbGV2ZWw7XG59O1xuXG4vKiBQbGF5ZXIgZGllXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGxheWVyX2RpZSA9IGZ1bmN0aW9uKHBsYXllcl9pZCkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8IHBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcGxheWVyLmRlYWQgPSB0cnVlO1xuXG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBvYmoudHlwZSA9IFwicGxheWVyX21pc3NpbGVcIjtcbiAgb2JqLmMgPSB0aGlzLmMub2JqZWN0c1tcInBsYXllcl9taXNzaWxlXCJdO1xuXG4gIC8vIGZpZ3VyZSBvdXQgZ2VtcyB0byBzcGF3blxuICB2YXIgbiA9IG1heChyb3VuZChwbGF5ZXIuc2NvcmUgLyAyKSwgMyk7XG4gIHZhciBnZW1zID0gW107XG4gIHdoaWxlIChuID4gMjAwKSB7XG4gICAgZ2Vtcy5wdXNoKDIwMCk7XG4gICAgbiAtPSAyMDA7XG4gIH1cbiAgd2hpbGUgKG4gPiA1MCkge1xuICAgIGdlbXMucHVzaCg1MCk7XG4gICAgbiAtPSA1MDtcbiAgfVxuICB3aGlsZSAobiA+IDIwKSB7XG4gICAgZ2Vtcy5wdXNoKDIwKTtcbiAgICBuIC09IDIwO1xuICB9XG4gIHdoaWxlIChuID4gNSkge1xuICAgIGdlbXMucHVzaCg1KTtcbiAgICBuIC09IDU7XG4gIH1cbiAgd2hpbGUgKG4gPiAxKSB7XG4gICAgZ2Vtcy5wdXNoKDEpO1xuICAgIG4gLT0gMTtcbiAgfVxuXG4gIC8vIHNwYXduIHRoZW1cbiAgdmFyIGFuZ2xlX2luYyA9IHJvdW5kKDM2MCAvIGdlbXMubGVuZ3RoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIG4gPSAoKGkgJSAzKSArIDEpICogMjtcbiAgICB2YXIgeHkgPSB4eV9zcGVlZChhbmdsZV9pbmMgKiBpLCBuKTtcbiAgICB0aGlzLmNyZWF0ZV9vYmplY3Qoe1xuICAgICAgdHlwZTogXCJnZW0tXCIgKyBnZW1zW2ldLFxuICAgICAgcGxheWVyX2lkOiBvYmoucGxheWVyX2lkLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNwZWVkX3g6IHh5LnguZml4ZWQoKSxcbiAgICAgIHNwZWVkX3k6IHh5LnkuZml4ZWQoKSxcbiAgICAgIGRhdGE6IGkgKyAxXG4gICAgfSk7XG4gIH1cbn07XG5cbi8qIFJ1biB0aHJvdWdoIHBsYXllcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9wbGF5ZXJzID0gZnVuY3Rpb24oaWdub3JlKSB7XG4gIC8vIHJ1biB0aHJvdWdoIGFsbCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnN0YXRlLnBsYXllcnMpIHtcbiAgICBpZiAocGFyc2VJbnQoa2V5KSAhPT0gaWdub3JlKSB7XG4gICAgICB0aGlzLmZyYW1lX3BsYXllcih0aGlzLnN0YXRlLnBsYXllcnNba2V5XSk7XG4gICAgfVxuICB9XG59O1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9wbGF5ZXIgPSBmdW5jdGlvbihwbGF5ZXIpIHtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb29sZG93blxuICBpZiAocGxheWVyLmNvb2xkb3duID4gMCkge1xuICAgIHBsYXllci5jb29sZG93bi0tO1xuICB9XG5cbiAgLy8gaGl0XG4gIGlmIChwbGF5ZXIuaGl0ID4gMCkge1xuICAgIHBsYXllci5oaXQtLTtcbiAgfVxuXG4gIC8vIGhlYWx0aCByZWdlblxuICBpZiAodGhpcy5zdGF0ZS5mcmFtZSAlIDI0ID09PSAwKSB7XG4gICAgaWYgKHBsYXllci5oZWFsdGggPCB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoW3BsYXllci5sZXZlbF0pIHtcbiAgICAgIHRoaXMucGxheWVyX2hlYWx0aF9hZGQocGxheWVyLmlkLCAyLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvLyByZW1vdmUgb2xkIGV2ZW50c1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsYXllci5ldmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGhpcy5zdGF0ZS5mcmFtZSA+IHBsYXllci5ldmVudHNbaV0uZnJhbWUgKyAxOCkge1xuICAgICAgcGxheWVyLmV2ZW50cy5zcGxpY2UoaSwgMSk7XG4gICAgfVxuICB9XG59O1xuXG4vKiBSdW4gdGhyb3VnaCBwbGF5ZXIgbG9ja2VkIG9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9wbGF5ZXJfbG9jayA9IGZ1bmN0aW9uKHBsYXllcikge1xuICB2YXIgcGxheWVyX29iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllci5pZF07XG4gIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNbcGxheWVyLmxvY2tlZF07XG4gIGlmIChwbGF5ZXJfb2JqICYmIG9iaikge1xuICAgIHBsYXllcl9vYmoueCA9IG9iai54O1xuICAgIHBsYXllcl9vYmoueSA9IG9iai55O1xuICAgIHBsYXllcl9vYmouc3BlZWRfeCA9IG9iai5zcGVlZF94O1xuICAgIHBsYXllcl9vYmouc3BlZWRfeSA9IG9iai5zcGVlZF95O1xuICB9IGVsc2Uge1xuICAgIHBsYXllci5sb2NrZWQgPSBcIlwiO1xuICB9XG59O1xuXG4vKiBHZXQgZGFtYWdlIG1vZGlmaWVycyBmcm9tIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmdldF9kYW1hZ2UgPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIGRhbWFnZSA9IG9iai5jLmRhbWFnZTtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgaWYgKHBsYXllciAmJiBkYW1hZ2UgIT09IDAgJiYgIW9iai5jLmlnbm9yZV9sZXZlbF9kYW1hZ2UpIHtcbiAgICB2YXIgbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuZGFtYWdlW3BsYXllci5sZXZlbF07XG4gICAgaWYgKGxldmVsKSB7XG4gICAgICBkYW1hZ2UgKz0gbGV2ZWw7XG4gICAgfVxuICB9XG4gIHJldHVybiBkYW1hZ2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgU3RhdGUgbWFuYWdlbWVudFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEdldCBzdGF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBhY2tfc3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICAvLyBwbGF5ZXJzXG4gIHZhciBwbGF5ZXJzID0gW107XG4gIGZvciAodmFyIGlkIGluIHN0YXRlLnBsYXllcnMpIHtcbiAgICBwbGF5ZXJzLnB1c2godGhpcy5wYWNrX3BsYXllcihzdGF0ZS5wbGF5ZXJzW2lkXSkpO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBvYmplY3RzXG4gIHZhciBvYmplY3RzID0gW107XG4gIGZvciAodmFyIGtleSBpbiBzdGF0ZS5vYmplY3RzKSB7XG4gICAgb2JqZWN0cy5wdXNoKHRoaXMucGFja19vYmplY3Qoc3RhdGUub2JqZWN0c1trZXldKSk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGV4cGxvc2lvbnNcbiAgdmFyIGV4cGxvc2lvbnMgPSBbXTtcbiAgZm9yIChrZXkgaW4gc3RhdGUuZXhwbG9zaW9ucykge1xuICAgIGV4cGxvc2lvbnMucHVzaCh0aGlzLnBhY2tfZXhwbG9zaW9uKHN0YXRlLmV4cGxvc2lvbnNba2V5XSkpO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICBwbGF5ZXJzLmpvaW4oXCIjXCIpICsgXCIrXCIgKyBvYmplY3RzLmpvaW4oXCIjXCIpICsgXCIrXCIgKyBleHBsb3Npb25zLmpvaW4oXCIjXCIpXG4gICk7XG59O1xuXG4vKiBTZXQgc3RhdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS51bnBhY2tfc3RhdGUgPSBmdW5jdGlvbihzdHIpIHtcbiAgLy8gYmxhbmsgc3RhdGVcbiAgdmFyIHN0YXRlID0gdGhpcy5ibGFua19zdGF0ZSgpO1xuXG4gIC8vIHJ1biB0aHJvdWdoIHN0YXRlIHN0cmluZ1xuICB2YXIgc3BsaXQgPSBzdHIuc3BsaXQoXCIrXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHNwbGl0W2ldKSB7XG4gICAgICB2YXIgc3BsaXQyID0gc3BsaXRbaV0uc3BsaXQoXCIjXCIpO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzcGxpdDIubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKGkgPT0gMCkge1xuICAgICAgICAgIHRoaXMudW5wYWNrX3BsYXllcihzdGF0ZSwgc3BsaXQyW2pdKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA9PSAxKSB7XG4gICAgICAgICAgdGhpcy51bnBhY2tfb2JqZWN0KHN0YXRlLCBzcGxpdDJbal0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpID09IDIpIHtcbiAgICAgICAgICB0aGlzLnVucGFja19leHBsb3Npb24oc3RhdGUsIHNwbGl0MltqXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3RhdGU7XG59O1xuXG4vKiBQbGF5ZXJzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGFja19wbGF5ZXIgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gcHJlcCBiYXNpYyB2YWx1ZXNcbiAgdmFyIGRlYWQgPSBvYmouZGVhZCA/IFwiMVwiIDogXCJcIjtcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYXJtb3VyeV9yZWZzLmluZGV4T2Yob2JqLndlYXBvbik7XG5cbiAgLy8gcHJlcCBhcm1vdXJ5XG4gIHZhciBhcm1vdXJ5ID0gW107XG4gIGZvciAodmFyIGtleSBpbiBvYmouYXJtb3VyeSkge1xuICAgIGFybW91cnkucHVzaChvYmouYXJtb3VyeVtrZXldKTtcbiAgfVxuICBhcm1vdXJ5ID0gYXJtb3VyeS5qb2luKFwiJFwiKTtcblxuICAvLyBwcmVwIGV2ZW50c1xuICB2YXIgZXZlbnRzID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBldmVudCA9IG9iai5ldmVudHNbaV07XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwid2Fsa1wiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjBcIik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcImp1bXBcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn4xXCIpO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJzaG9vdFwiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjJ+XCIgKyBldmVudC5vYmogKyBcIn5cIiArIGV2ZW50LndlYXBvbik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcImNyYXRlXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+M35cIiArIGV2ZW50Lm9iaik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcIm1lZHBhY2tcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn40flwiICsgZXZlbnQub2JqKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2VtXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+NX5cIiArIGV2ZW50Lm9iaik7XG4gICAgfVxuICB9XG4gIGV2ZW50cyA9IGV2ZW50cy5qb2luKFwiJFwiKTtcblxuICAvLyByZXR1cm4gcGxheWVyIHN0cmluZ1xuICB2YXIgYXJyID0gW1xuICAgIG9iai5pZCxcbiAgICBvYmoubGV2ZWwsXG4gICAgb2JqLnNjb3JlLFxuICAgIGRlYWQsXG4gICAgb2JqLmhlYWx0aCxcbiAgICBvYmouY29vbGRvd24sXG4gICAgb2JqLmhpdCxcbiAgICBvYmoubG9ja2VkLFxuICAgIGFybW91cnksXG4gICAgd2VhcG9uLFxuICAgIGV2ZW50c1xuICBdO1xuICByZXR1cm4gYXJyLmpvaW4oXCIvXCIpO1xufTtcblxuY29yZS5wcm90b3R5cGUudW5wYWNrX3BsYXllciA9IGZ1bmN0aW9uKHN0YXRlLCBzdHIpIHtcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiL1wiKTtcbiAgdmFyIHByb3BzID0ge307XG4gIHByb3BzLmlkID0gcGFyc2VJbnQoc3BsaXRbMF0pO1xuICBwcm9wcy5sZXZlbCA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgcHJvcHMuc2NvcmUgPSBwYXJzZUludChzcGxpdFsyXSk7XG4gIHByb3BzLmRlYWQgPSBzcGxpdFszXSA9PT0gXCIxXCIgPyB0cnVlIDogZmFsc2U7XG4gIHByb3BzLmhlYWx0aCA9IHBhcnNlSW50KHNwbGl0WzRdKTtcbiAgcHJvcHMuY29vbGRvd24gPSBwYXJzZUludChzcGxpdFs1XSk7XG4gIHByb3BzLmhpdCA9IHBhcnNlSW50KHNwbGl0WzZdKTtcbiAgcHJvcHMubG9ja2VkID0gc3BsaXRbN107XG5cbiAgLy8gcHJlcCBhcm1vdXJ5XG4gIHByb3BzLmFybW91cnkgPSB7fTtcbiAgdmFyIHNwbGl0MiA9IHNwbGl0WzhdLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdDIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gdGhpcy5hcm1vdXJ5X3JlZnNbaV07XG4gICAgcHJvcHMuYXJtb3VyeVtrZXldID0gcGFyc2VJbnQoc3BsaXQyW2ldKTtcbiAgfVxuXG4gIC8vIHdlYXBvblxuICB2YXIgd2VwID0gcGFyc2VJbnQoc3BsaXRbOV0pO1xuICBpZiAod2VwICE9PSAtMSkge1xuICAgIHByb3BzLndlYXBvbiA9IHRoaXMuYXJtb3VyeV9yZWZzW3dlcF07XG4gIH1cblxuICAvLyBwcmVwIGV2ZW50c1xuICBwcm9wcy5ldmVudHMgPSBbXTtcbiAgdmFyIHNwbGl0MiA9IHNwbGl0WzEwXS5zcGxpdChcIiRcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQyLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwbGl0MyA9IHNwbGl0MltpXS5zcGxpdChcIn5cIik7XG4gICAgdmFyIG9iaiA9IHsgZnJhbWU6IHBhcnNlSW50KHNwbGl0M1swXSkgfTtcbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjBcIikge1xuICAgICAgb2JqLnR5cGUgPSBcIndhbGtcIjtcbiAgICB9XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCIxXCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJqdW1wXCI7XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiMlwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwic2hvb3RcIjtcbiAgICAgIG9iai5vYmogPSBzcGxpdDNbMl07XG4gICAgICBvYmoud2VhcG9uID0gc3BsaXQzWzNdO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjNcIikge1xuICAgICAgb2JqLnR5cGUgPSBcImNyYXRlXCI7XG4gICAgICBvYmoub2JqID0gc3BsaXQzWzJdO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjRcIikge1xuICAgICAgb2JqLnR5cGUgPSBcIm1lZHBhY2tcIjtcbiAgICAgIG9iai5vYmogPSBzcGxpdDNbMl07XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiNVwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwiZ2VtXCI7XG4gICAgICBvYmoub2JqID0gc3BsaXQzWzJdO1xuICAgIH1cbiAgICBpZiAob2JqKSB7XG4gICAgICBwcm9wcy5ldmVudHMucHVzaChvYmopO1xuICAgIH1cbiAgfVxuXG4gIC8vIG1ha2UgaXRcbiAgdGhpcy5jcmVhdGVfcGxheWVyKHByb3BzLCBzdGF0ZSk7XG59O1xuXG4vKiBPYmplY3RzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGFja19vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIGdyb3VuZGVkID0gb2JqLmdyb3VuZGVkID8gXCIxXCIgOiBcIlwiO1xuICB2YXIgYXJyID0gW1xuICAgIG9iai50eXBlLFxuICAgIG9iai5wbGF5ZXJfaWQsXG4gICAgb2JqLmlkLFxuICAgIG9iai5mcmFtZSxcbiAgICBncm91bmRlZCxcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICBvYmouc3BlZWRfeCxcbiAgICBvYmouc3BlZWRfeSxcbiAgICBvYmouZGF0YVxuICBdO1xuICByZXR1cm4gYXJyLmpvaW4oXCIvXCIpO1xufTtcblxuY29yZS5wcm90b3R5cGUudW5wYWNrX29iamVjdCA9IGZ1bmN0aW9uKHN0YXRlLCBzdHIpIHtcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiL1wiKTtcbiAgdmFyIHByb3BzID0ge307XG4gIHByb3BzLnR5cGUgPSBzcGxpdFswXTtcbiAgcHJvcHMucGxheWVyX2lkID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICBwcm9wcy5pZCA9IHNwbGl0WzJdO1xuICBwcm9wcy5mcmFtZSA9IHBhcnNlSW50KHNwbGl0WzNdKTtcbiAgcHJvcHMuZ3JvdW5kZWQgPSBzcGxpdFs0XSA9PT0gXCIxXCIgPyB0cnVlIDogZmFsc2U7XG4gIHByb3BzLnggPSBwYXJzZUZsb2F0KHNwbGl0WzVdKTtcbiAgcHJvcHMueSA9IHBhcnNlRmxvYXQoc3BsaXRbNl0pO1xuICBwcm9wcy5zcGVlZF94ID0gcGFyc2VGbG9hdChzcGxpdFs3XSk7XG4gIHByb3BzLnNwZWVkX3kgPSBwYXJzZUZsb2F0KHNwbGl0WzhdKTtcbiAgcHJvcHMuZGF0YSA9IHNwbGl0WzldO1xuXG4gIHRoaXMuY3JlYXRlX29iamVjdChwcm9wcywgc3RhdGUpO1xufTtcblxuLyogRXhwbG9zaW9uc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBhY2tfZXhwbG9zaW9uID0gZnVuY3Rpb24ob2JqKSB7XG4gIHZhciBhcnIgPSBbXG4gICAgb2JqLnBsYXllcl9pZCxcbiAgICBvYmouZnJhbWUsXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgb2JqLnBhcmVudCxcbiAgICBvYmoucGFyZW50X3R5cGVcbiAgXTtcbiAgcmV0dXJuIGFyci5qb2luKFwiL1wiKTtcbn07XG5cbmNvcmUucHJvdG90eXBlLnVucGFja19leHBsb3Npb24gPSBmdW5jdGlvbihzdGF0ZSwgc3RyKSB7XG4gIHZhciBzcGxpdCA9IHN0ci5zcGxpdChcIi9cIik7XG4gIHZhciBwcm9wcyA9IHt9O1xuICBwcm9wcy5wbGF5ZXJfaWQgPSBwYXJzZUludChzcGxpdFswXSk7XG4gIHByb3BzLmZyYW1lID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICBwcm9wcy54ID0gcGFyc2VGbG9hdChzcGxpdFsyXSk7XG4gIHByb3BzLnkgPSBwYXJzZUZsb2F0KHNwbGl0WzNdKTtcbiAgcHJvcHMucGFyZW50ID0gc3BsaXRbNF07XG4gIHByb3BzLnBhcmVudF90eXBlID0gc3BsaXRbNV07XG5cbiAgdGhpcy5jcmVhdGVfZXhwbG9zaW9uKHByb3BzLCBzdGF0ZSk7XG59O1xuIiwiZnVuY3Rpb24gaXNNZXJnZWFibGVPYmplY3QodmFsKSB7XG4gIHZhciBub25OdWxsT2JqZWN0ID0gdmFsICYmIHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCI7XG5cbiAgcmV0dXJuIChcbiAgICBub25OdWxsT2JqZWN0ICYmXG4gICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbCkgIT09IFwiW29iamVjdCBSZWdFeHBdXCIgJiZcbiAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKSAhPT0gXCJbb2JqZWN0IERhdGVdXCJcbiAgKTtcbn1cblxuZnVuY3Rpb24gZW1wdHlUYXJnZXQodmFsKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHZhbCkgPyBbXSA6IHt9O1xufVxuXG5mdW5jdGlvbiBjbG9uZUlmTmVjZXNzYXJ5KHZhbHVlLCBvcHRpb25zQXJndW1lbnQpIHtcbiAgdmFyIGNsb25lID0gb3B0aW9uc0FyZ3VtZW50ICYmIG9wdGlvbnNBcmd1bWVudC5jbG9uZSA9PT0gdHJ1ZTtcbiAgcmV0dXJuIGNsb25lICYmIGlzTWVyZ2VhYmxlT2JqZWN0KHZhbHVlKVxuICAgID8gZGVlcG1lcmdlKGVtcHR5VGFyZ2V0KHZhbHVlKSwgdmFsdWUsIG9wdGlvbnNBcmd1bWVudClcbiAgICA6IHZhbHVlO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0QXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBkZXN0aW5hdGlvbiA9IHRhcmdldC5zbGljZSgpO1xuICBzb3VyY2UuZm9yRWFjaChmdW5jdGlvbihlLCBpKSB7XG4gICAgaWYgKHR5cGVvZiBkZXN0aW5hdGlvbltpXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgZGVzdGluYXRpb25baV0gPSBjbG9uZUlmTmVjZXNzYXJ5KGUsIG9wdGlvbnNBcmd1bWVudCk7XG4gICAgfSBlbHNlIGlmIChpc01lcmdlYWJsZU9iamVjdChlKSkge1xuICAgICAgZGVzdGluYXRpb25baV0gPSBkZWVwbWVyZ2UodGFyZ2V0W2ldLCBlLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0gZWxzZSBpZiAodGFyZ2V0LmluZGV4T2YoZSkgPT09IC0xKSB7XG4gICAgICBkZXN0aW5hdGlvbi5wdXNoKGNsb25lSWZOZWNlc3NhcnkoZSwgb3B0aW9uc0FyZ3VtZW50KSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRlc3RpbmF0aW9uO1xufVxuXG5mdW5jdGlvbiBtZXJnZU9iamVjdCh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBkZXN0aW5hdGlvbiA9IHt9O1xuICBpZiAoaXNNZXJnZWFibGVPYmplY3QodGFyZ2V0KSkge1xuICAgIE9iamVjdC5rZXlzKHRhcmdldCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBjbG9uZUlmTmVjZXNzYXJ5KHRhcmdldFtrZXldLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0pO1xuICB9XG4gIE9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAoIWlzTWVyZ2VhYmxlT2JqZWN0KHNvdXJjZVtrZXldKSB8fCAhdGFyZ2V0W2tleV0pIHtcbiAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBjbG9uZUlmTmVjZXNzYXJ5KHNvdXJjZVtrZXldLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZXN0aW5hdGlvbltrZXldID0gZGVlcG1lcmdlKHRhcmdldFtrZXldLCBzb3VyY2Vba2V5XSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZGVzdGluYXRpb247XG59XG5cbmZ1bmN0aW9uIGRlZXBtZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIHZhciBhcnJheSA9IEFycmF5LmlzQXJyYXkoc291cmNlKTtcbiAgdmFyIG9wdGlvbnMgPSBvcHRpb25zQXJndW1lbnQgfHwgeyBhcnJheU1lcmdlOiBkZWZhdWx0QXJyYXlNZXJnZSB9O1xuICB2YXIgYXJyYXlNZXJnZSA9IG9wdGlvbnMuYXJyYXlNZXJnZSB8fCBkZWZhdWx0QXJyYXlNZXJnZTtcblxuICBpZiAoYXJyYXkpIHtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh0YXJnZXQpXG4gICAgICA/IGFycmF5TWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnNBcmd1bWVudClcbiAgICAgIDogY2xvbmVJZk5lY2Vzc2FyeShzb3VyY2UsIG9wdGlvbnNBcmd1bWVudCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zQXJndW1lbnQpO1xuICB9XG59XG5cbmRlZXBtZXJnZS5hbGwgPSBmdW5jdGlvbiBkZWVwbWVyZ2VBbGwoYXJyYXksIG9wdGlvbnNBcmd1bWVudCkge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoYXJyYXkpIHx8IGFycmF5Lmxlbmd0aCA8IDIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcImZpcnN0IGFyZ3VtZW50IHNob3VsZCBiZSBhbiBhcnJheSB3aXRoIGF0IGxlYXN0IHR3byBlbGVtZW50c1wiXG4gICAgKTtcbiAgfVxuXG4gIC8vIHdlIGFyZSBzdXJlIHRoZXJlIGFyZSBhdCBsZWFzdCAyIHZhbHVlcywgc28gaXQgaXMgc2FmZSB0byBoYXZlIG5vIGluaXRpYWwgdmFsdWVcbiAgcmV0dXJuIGFycmF5LnJlZHVjZShmdW5jdGlvbihwcmV2LCBuZXh0KSB7XG4gICAgcmV0dXJuIGRlZXBtZXJnZShwcmV2LCBuZXh0LCBvcHRpb25zQXJndW1lbnQpO1xuICB9KTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNYXRoIEZ1bmN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNob3J0ZW4gXCJNYXRoXCIgZnVuY3Rpb25zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gY29zKG4pIHtcbiAgcmV0dXJuIE1hdGguY29zKG4pO1xufVxuZnVuY3Rpb24gc2luKG4pIHtcbiAgcmV0dXJuIE1hdGguc2luKG4pO1xufVxuZnVuY3Rpb24gcG93KG4pIHtcbiAgcmV0dXJuIE1hdGgucG93KG4pO1xufVxuZnVuY3Rpb24gYWJzKG4pIHtcbiAgcmV0dXJuIE1hdGguYWJzKG4pO1xufVxuZnVuY3Rpb24gc3FyKG4pIHtcbiAgcmV0dXJuIE1hdGgucG93KG4sIDIpO1xufVxuZnVuY3Rpb24gc3FydChuKSB7XG4gIHJldHVybiBNYXRoLnNxcnQobik7XG59XG5mdW5jdGlvbiByb3VuZChuKSB7XG4gIHJldHVybiBNYXRoLnJvdW5kKG4pO1xufVxuZnVuY3Rpb24gZmxvb3Iobikge1xuICByZXR1cm4gTWF0aC5mbG9vcihuKTtcbn1cbmZ1bmN0aW9uIGNlaWwobikge1xuICByZXR1cm4gTWF0aC5jZWlsKG4pO1xufVxuZnVuY3Rpb24gYXRhbjIobjEsIG4yKSB7XG4gIHJldHVybiBNYXRoLmF0YW4yKG4xLCBuMik7XG59XG5mdW5jdGlvbiBtaW4objEsIG4yKSB7XG4gIHJldHVybiBNYXRoLm1pbihuMSwgbjIpO1xufVxuZnVuY3Rpb24gbWF4KG4xLCBuMikge1xuICByZXR1cm4gTWF0aC5tYXgobjEsIG4yKTtcbn1cbmZ1bmN0aW9uIHJhbmQobjEsIG4yKSB7XG4gIHJldHVybiBmbG9vcihNYXRoLnJhbmRvbSgpICogbjIpICsgbjE7XG59XG52YXIgcGkgPSBNYXRoLlBJO1xuXG4vKiBGaXggbnVtYmVyIHRvIGRlY2ltYWwgcGxhY2VzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuTnVtYmVyLnByb3RvdHlwZS5maXhlZCA9IGZ1bmN0aW9uKG4pIHtcbiAgbiA9IG4gfHwgMjtcbiAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy50b0ZpeGVkKG4pKTtcbn07XG5cbi8qIEFkZCBwcmVjZWRpbmcgemVyb2VzIHRvIG51bWJlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHByZWNlZGluZ196ZXJvZXMobiwgbGVuZ3RoKSB7XG4gIHZhciBsZW5ndGggPSBsZW5ndGggfHwgMjtcbiAgdmFyIG4gPSBuLnRvU3RyaW5nKCk7XG4gIHdoaWxlIChuLmxlbmd0aCA8IGxlbmd0aCkge1xuICAgIG4gPSBcIjBcIiArIG47XG4gIH1cbiAgcmV0dXJuIG47XG59XG5cbi8qIElzIG51bWJlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGlzX251bWVyaWMobikge1xuICByZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQobikpICYmIGlzRmluaXRlKG4pO1xufVxuXG4vKiBHZXQgZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gZ2V0X3NwZWVkKHN4LCBzeSkge1xuICByZXR1cm4gcm91bmQoc3FydChzcXIoc3gpICsgc3FyKHN5KSkpO1xufVxuXG5mdW5jdGlvbiBnZXRfZGlzdGFuY2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgdmFyIGR4ID0geDIgLSB4MSxcbiAgICBkeSA9IHkyIC0geTE7XG4gIHJldHVybiBnZXRfc3BlZWQoZHgsIGR5KTtcbn1cblxuLyogQ2hlY2sgc3BlZWQgbGltaXRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBjaGVja19zcGVlZChzeCwgc3ksIHNwZWVkKSB7XG4gIHZhciBkID0gZ2V0X2Rpc3RhbmNlKDAsIDAsIHN4LCBzeSksXG4gICAgbnMgPSB7XG4gICAgICB4OiBzeCxcbiAgICAgIHk6IHN5LFxuICAgICAgdG90YWw6IGRcbiAgICB9O1xuICBpZiAoc3BlZWQgPCBkKSB7XG4gICAgdmFyIG11bHRpID0gc3BlZWQgLyBkO1xuICAgIG5zLnggPSBzeCAqIG11bHRpO1xuICAgIG5zLnkgPSBzeSAqIG11bHRpO1xuICAgIG5zLnRvdGFsID0gc3BlZWQ7XG4gIH1cbiAgcmV0dXJuIG5zO1xufVxuXG4vKiBHZXQgSGVhZGluZyBBbmdsZSBGcm9tIFggYW5kIFkgU3BlZWRcblx0Ly8gMCA9IGxlZnQsIDM2MCA9IGxlZnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBnZXRfYW5nbGUoc3gsIHN5KSB7XG4gIHJldHVybiAoKChhdGFuMihzeSwgc3gpICogMTgwKSAvIHBpKSAlIDM2MCkgKyAxODA7XG59XG5cbmZ1bmN0aW9uIGdldF9oZWFkaW5nKHgxLCB5MSwgeDIsIHkyKSB7XG4gIHZhciB4cyA9IHgyIC0geDEsXG4gICAgeXMgPSB5MiAtIHkxO1xuICByZXR1cm4gZ2V0X2FuZ2xlKHhzLCB5cyk7XG59XG5cbi8qIEdldCBYIGFuZCBZIHNwZWVkIGZyb20gaGVhZGluZyBhbmQgdmVsb2NpdHlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiB4eV9zcGVlZChhbmdsZSwgc3BlZWQpIHtcbiAgdmFyIGEgPSBhbmdsZV9hZGQoYW5nbGUsIDE4MCksXG4gICAgciA9IChhIC8gMTgwKSAqIHBpO1xuICByZXR1cm4ge1xuICAgIHg6IHNwZWVkICogY29zKHIpLFxuICAgIHk6IHNwZWVkICogc2luKHIpXG4gIH07XG59XG5cbi8qIEdldCBYIGFuZCBZIG9mZnNldCBmcm9tIGhlYWRpbmcgYW5kIHZlbG9jaXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24geHlfb2Zmc2V0KGFuZ2xlLCBzeCwgc3kpIHtcbiAgdmFyIHh5MSA9IHh5X3NwZWVkKGFuZ2xlLCBzeCk7XG4gIHZhciB4eTIgPSB4eV9zcGVlZChhbmdsZV9hZGQoYW5nbGUsIDkwKSwgc3kpO1xuICByZXR1cm4ge1xuICAgIHg6IHh5MS54ICsgeHkyLngsXG4gICAgeTogeHkxLnkgKyB4eTIueVxuICB9O1xufVxuXG4vKiBHZXQgZGlmZmVyZW5jZSBiZXR3ZWVuIHR3byBudW1iZXJzIGluIGEgbG9vcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG5fZGlmZihjdXJyZW50LCB0YXJnZXQsIGJvdHRvbSwgdG9wKSB7XG4gIGlmIChjdXJyZW50ID09IHRhcmdldCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgdmFyIHNjYWxlID0gYWJzKHRvcCAtIGJvdHRvbSksIC8vIGdldCB0b3RhbCBzaXplIG9mIHRoZSBsb29wXG4gICAgY19jdXJyZW50ID0gY3VycmVudCAtIGJvdHRvbSwgLy8gY29ycmVjdCBjdXJyZW50IGZvciBuZWdhdGl2ZSBudW1iZXJzXG4gICAgY190YXJnZXQgPSB0YXJnZXQgLSBib3R0b20sIC8vIGNvcnJlY3QgdGFyZ2V0IGZvciBuZWdhdGl2ZSBudW1iZXJzXG4gICAgbjEgPSAoY190YXJnZXQgKyBzY2FsZSAtIGNfY3VycmVudCkgJSBzY2FsZSwgLy8gZ2V0IGRpZmZlcmVuY2Ugd2hlbiBhZGRpbmdcbiAgICBuMiA9IChjX2N1cnJlbnQgKyBzY2FsZSAtIGNfdGFyZ2V0KSAlIHNjYWxlOyAvLyBnZXQgZGlmZmVyZW5jZSB3aGVuIHN1YnRyYWN0aW5nXG5cbiAgLy8gcmV0dXJuIHNtYWxsZXN0IGRpc3RhbmNlXG4gIGlmIChuMSA8IG4yKSB7XG4gICAgcmV0dXJuIG4xO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAtbjI7XG4gIH1cbn1cblxuLyogQXV0byBsb29wIGEgbnVtYmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbl9sb29wKG4sIGJvdHRvbSwgdG9wKSB7XG4gIHZhciBkaWZmZXJlbmNlID0gYWJzKHRvcCAtIGJvdHRvbSk7XG4gIHdoaWxlIChuIDw9IGJvdHRvbSkge1xuICAgIG4gKz0gZGlmZmVyZW5jZTtcbiAgfVxuICB3aGlsZSAobiA+IHRvcCkge1xuICAgIG4gLT0gZGlmZmVyZW5jZTtcbiAgfVxuICByZXR1cm4gbjtcbn1cblxuLyogQWRkIHRvIGEgbnVtYmVyIHdpdGhvdXQgb3ZlcmZsb3dpbmcgdXAgb3IgZG93biBmcm9tIG1pbi9tYXhcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBuX2FkZChuMSwgbjIsIHQxLCB0Mikge1xuICB2YXIgZGlmID0gYWJzKHQyIC0gdDEpLFxuICAgIG5hID0gbjEgKyBuMjtcbiAgd2hpbGUgKG5hIDwgdDEpIHtcbiAgICBuYSArPSBkaWY7XG4gIH1cbiAgd2hpbGUgKG5hID49IHQyKSB7XG4gICAgbmEgLT0gZGlmO1xuICB9XG4gIHJldHVybiBuYTtcbn1cblxuLyogQWRkIHRvIGFuIGFuZ2xlIHdpdGhvdXQgb3ZlcmZsb3dpbmcgdXAgb3IgZG93biBmcm9tIDAtMzYwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gYW5nbGVfYWRkKGFuZ2xlLCBhZGQpIHtcbiAgaWYgKCFhbmdsZSkge1xuICAgIGFuZ2xlID0gMDtcbiAgfVxuICByZXR1cm4gbl9hZGQoYW5nbGUsIGFkZCwgMCwgMzYwKTtcbn1cblxuLyogTW92ZSBudW1iZXIgdG93YXJkcyBhIG5ldyBudW1iZXIgd2l0aCBsb29wXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gaW5jcmVtZW50X251bShjdXJyZW50LCB0YXJnZXQsIGJvdHRvbSwgdG9wLCBzcGVlZCkge1xuICB2YXIgZGlmZiA9IG5fZGlmZihjdXJyZW50LCB0YXJnZXQsIGJvdHRvbSwgdG9wKTsgLy8gZ2V0IHNob3J0ZXN0IHJvdXRlIHRvIG51bWJlclxuICBtb3ZlID0gbWluKGFicyhkaWZmKSAvIDEwLCA0KSAqIHNwZWVkOyAvLyBjYWxjdWxhdGUgaG93IG11Y2ggdG8gbW92ZVxuXG4gIC8vIGlmIGRpZmZlcmVuY2UgaXMgbGVzcyB0aGVuIG1vdmVtZW50LCByZXR1cm4gdGFyZ2V0XG4gIGlmIChhYnMoZGlmZikgPCBtb3ZlKSB7XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIC8vIGFkZCBvciBzdWJ0cmFjdCBtb3ZlbWVudFxuICBtb3ZlID0gZGlmZiA8IDAgPyAtbW92ZSA6IG1vdmU7XG4gIHJldHVybiBuX2FkZChjdXJyZW50LCBtb3ZlLCBib3R0b20sIHRvcCk7XG59XG5cbi8qIE1vdmUgYW5nbGUgdG93YXJkcyBhIG5ldyBhbmdsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGluY3JlbWVudF9hbmdsZShvbGRfYW5nbGUsIG5ld19hbmdsZSwgc3BlZWQpIHtcbiAgcmV0dXJuIGluY3JlbWVudF9udW0ob2xkX2FuZ2xlLCBuZXdfYW5nbGUsIDAsIDM2MCwgc3BlZWQpO1xufVxuXG4vKiBJZiBhIHBvaW50IGlzIHdpdGhpbiBhIGNpcmNsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGluX2NpcmNsZSh4LCB5LCBjeCwgY3ksIHJhZGl1cykge1xuICByZXR1cm4gZ2V0X2Rpc3RhbmNlKHgsIHksIGN4LCBjeSkgPCByYWRpdXM7XG59XG5cbi8qIFBsb3QgYSBjb3Vyc2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBwbG90X2NvdXJzZSh4LCB5LCBzeCwgc3ksIGV4dGVuZCkge1xuICAvLyBnZXQgaW5pdGlhbCBzcGVlZFxuICB2YXIgZXh0ZW5kID0gZXh0ZW5kID8gZXh0ZW5kIDogMCxcbiAgICBzcGVlZCA9IGdldF9zcGVlZChzeCwgc3kpO1xuXG4gIC8vIGlmIG5vIGRpc3RhbmNlIHRoZW4gZG8gbm90aGluZ1xuICBpZiAoc3BlZWQgPT0gMCkge1xuICAgIHJldHVybiB7IG1vdmU6IGZhbHNlIH07XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgaW5jcmVtZW50c1xuICB2YXIgaW5jcmVtZW50X3ggPSBzeCAvIHNwZWVkLFxuICAgIGluY3JlbWVudF95ID0gc3kgLyBzcGVlZCxcbiAgICBuZXdfeCA9IHggLSBpbmNyZW1lbnRfeCAqIGV4dGVuZCxcbiAgICBuZXdfeSA9IHkgLSBpbmNyZW1lbnRfeSAqIGV4dGVuZCxcbiAgICBwb2ludHMgPSBbeyB4OiBuZXdfeCwgeTogbmV3X3kgfV07XG5cbiAgLy8gaXRlcmF0ZSB0aHJvdWdoIHBhdGggYW5kIHJlY29yZCBwb2ludHNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVlZCArIGV4dGVuZCAqIDI7IGkrKykge1xuICAgIChuZXdfeCArPSBpbmNyZW1lbnRfeCksIChuZXdfeSArPSBpbmNyZW1lbnRfeSk7XG4gICAgcG9pbnRzLnB1c2goe1xuICAgICAgeDogbmV3X3gsXG4gICAgICB5OiBuZXdfeVxuICAgIH0pO1xuICB9XG5cbiAgLy8gcmV0dXJuIHBvaW50IGFycmF5XG4gIHJldHVybiB7XG4gICAgbW92ZTogdHJ1ZSxcbiAgICBwb2ludHM6IHBvaW50c1xuICB9O1xufVxuXG4vKiB0cmFuc2xhdGUgY28tb3JkaW5hdGVzIGJ5IGFuIGFuZ2xlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gcm90YXRlX2Nvb3Jkcyh4LCB5LCBjeCwgY3ksIGFuZ2xlKSB7XG4gIHZhciByID0gKHBpIC8gMTgwKSAqIGFuZ2xlO1xuICByZXR1cm4ge1xuICAgIHg6IGNvcyhyKSAqICh4IC0gY3gpICsgc2luKHIpICogKHkgLSBjeSkgKyBjeCxcbiAgICB5OiBjb3MocikgKiAoeSAtIGN5KSAtIHNpbihyKSAqICh4IC0gY3gpICsgY3lcbiAgfTtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1pc2MgRnVuY3Rpb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogRHVwbGljYXRlIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGR1cGxpY2F0ZV9vYmoob2JqKSB7XG4gIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xufVxuXG4vKiBQcmV2ZW50IGFycmF5IG1lcmdpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBkb250X21lcmdlKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHtcbiAgaWYgKCFzb3VyY2UpIHtcbiAgICByZXR1cm4gZGVzdGluYXRpb247XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNvdXJjZTtcbiAgfVxufVxuXG4vKiBBZGQgc3BhY2UgdG8gYSBzdHJpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBzdHJfc3BhY2Uoc3RyKSB7XG4gIHZhciBuZXdfc3RyID0gXCJcIjtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgYWRkID0gaSA9PSBzdHIubGVuZ3RoIC0gMSA/IFwiXCIgOiBcIlxcdTIwMEFcIjtcbiAgICBuZXdfc3RyICs9IHN0cltpXSArIGFkZDtcbiAgfVxuICByZXR1cm4gbmV3X3N0cjtcbn1cblxuLyogTG9nIG11bHRpcGxlIHZhbHVlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGNsb2coXG4gIHMxLFxuICBzMixcbiAgczMsXG4gIHM0LFxuICBzNSxcbiAgczYsXG4gIHM3LFxuICBzOCxcbiAgczksXG4gIHMxMCxcbiAgczExLFxuICBzMTIsXG4gIHMxMyxcbiAgczE0LFxuICBzMTVcbikge1xuICB2YXIgc3RyID0gczE7XG4gIGlmIChzMiAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMyO1xuICB9XG4gIGlmIChzMyAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMzO1xuICB9XG4gIGlmIChzNCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM0O1xuICB9XG4gIGlmIChzNSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM1O1xuICB9XG4gIGlmIChzNiAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM2O1xuICB9XG4gIGlmIChzNyAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM3O1xuICB9XG4gIGlmIChzOCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM4O1xuICB9XG4gIGlmIChzOSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHM5O1xuICB9XG4gIGlmIChzMTAgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTA7XG4gIH1cbiAgaWYgKHMxMSAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxMTtcbiAgfVxuICBpZiAoczEyICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczEyO1xuICB9XG4gIGlmIChzMTMgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTM7XG4gIH1cbiAgaWYgKHMxNCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxNDtcbiAgfVxuICBpZiAoczE1ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczE1O1xuICB9XG4gIGNvbnNvbGUubG9nKHN0cik7XG59XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0TWFwIEdlbmVyYXRvclxuXHRCbG9ic1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIERyYXcgYSBibG9iXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbWFwZ2VuX2Jsb2IoaW1nLCBjb25maWcsIGRlY29yYXRpb25zLCByYWRpdXMsIHR5cGUpIHtcbiAgdGhpcy5zaXplID0gMzY7XG4gIHRoaXMuaW1nID0gaW1nO1xuICB0aGlzLmMgPSBjb25maWc7XG5cbiAgLy8gZ2V0IGxhbmQgdHlwZVxuICB2YXIgdHlwZSA9IHR5cGUgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5jLmxhbmRfdHlwZS5sZW5ndGgpO1xuICB0aGlzLnJlZiA9IHRoaXMuYy5sYW5kX3R5cGVbdHlwZV07XG5cbiAgLy8gc2V0IHVwIG1haW4gYW5jaG9yIHBvaW50c1xuICB2YXIgYW5jaG9ycyA9IFtdO1xuICB2YXIgcG9pbnRzID0gTWF0aC5mbG9vcihyYWRpdXMgLyAyKSArIDQ7XG4gIHZhciBzcGlrZSA9IE1hdGguZmxvb3IocmFkaXVzIC8gMikgKyAyO1xuICBmb3IgKHZhciBwID0gMDsgcCA8IHBvaW50czsgcCsrKSB7XG4gICAgdmFyIG5ld19yYWRpdXMgPVxuICAgICAgTWF0aC5tYXgocmFkaXVzIC0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3Bpa2UpLCAxKSArIDE7XG4gICAgdmFyIHggPVxuICAgICAgcmFkaXVzICsgTWF0aC5mbG9vcihuZXdfcmFkaXVzICogTWF0aC5jb3MoKDIgKiBNYXRoLlBJICogcCkgLyBwb2ludHMpKTtcbiAgICB2YXIgeSA9XG4gICAgICByYWRpdXMgKyBNYXRoLmZsb29yKG5ld19yYWRpdXMgKiBNYXRoLnNpbigoMiAqIE1hdGguUEkgKiBwKSAvIHBvaW50cykpO1xuICAgIGFuY2hvcnMucHVzaCh7IHg6IHgsIHk6IHkgfSk7XG4gIH1cblxuICAvLyBkcmF3IHNoYXBlIHRvIGNhbnZhc1xuICB2YXIgc2l6ZSA9IHJhZGl1cyAqIDIgKyAxO1xuICB2YXIgc2hhcGUgPSBtYXBnZW5fY2FudmFzKHNpemUsIHNpemUpO1xuICB0aGlzLmRyYXdfcGF0aChzaGFwZSwgYW5jaG9ycyk7XG5cbiAgLy8gYnVpbGQgYXJyYXkgb2YgbGFuZCBvciBub3QgdGlsZXNcbiAgdmFyIHBpeGVscyA9IHNoYXBlLmNvbnQuZ2V0SW1hZ2VEYXRhKDAsIDAsIHNoYXBlLncsIHNoYXBlLmgpO1xuICB0aGlzLmxhbmQgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCBzaXplOyB5KyspIHtcbiAgICB0aGlzLmxhbmRbeV0gPSBbXTtcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNpemU7IHgrKykge1xuICAgICAgdmFyIGkgPSAoeSAqIHNpemUgKyB4KSAqIDQgKyAzO1xuICAgICAgdGhpcy5sYW5kW3ldW3hdID0gcGl4ZWxzLmRhdGFbaV0gPiAzMCA/IDEgOiAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIGJ1aWxkIHRpbGUgYXJyYXkgYW5kIGFzc2lnbiBjb3JuZXJzIGFuZCBsYW5kXG4gIHRoaXMudGlsZXMgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCBzaXplOyB5KyspIHtcbiAgICB0aGlzLnRpbGVzW3ldID0gW107XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzaXplOyB4KyspIHtcbiAgICAgIHRoaXMudGlsZXNbeV1beF0gPSB0aGlzLnNldF9jb3JuZXJfdGlsZSh5LCB4KTtcbiAgICB9XG4gIH1cblxuICAvLyBhc3NpZ24gcGl4ZWxzIGEgdGlsZSB2YWx1ZVxuICBmb3IgKHZhciB5ID0gMDsgeSA8IHNpemU7IHkrKykge1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCsrKSB7XG4gICAgICB0aGlzLnRpbGVzW3ldW3hdID1cbiAgICAgICAgdGhpcy50aWxlc1t5XVt4XSA9PT0gMTIgPyB0aGlzLnNldF9sYW5kX3RpbGUoeSwgeCkgOiB0aGlzLnRpbGVzW3ldW3hdO1xuICAgIH1cbiAgfVxuXG4gIC8vIGRyYXcgdGhlbVxuICB2YXIgd2ggPSAoc2l6ZSArIDQpICogdGhpcy5zaXplO1xuICB0aGlzLmFscGhhID0gbWFwZ2VuX2NhbnZhcyh3aCwgd2gpO1xuICB0aGlzLmVkZ2UgPSBtYXBnZW5fY2FudmFzKHdoLCB3aCk7XG4gIHRoaXMuYmcgPSBtYXBnZW5fY2FudmFzKHdoLCB3aCk7XG4gIGZvciAodmFyIHkgPSAwOyB5IDwgc2l6ZTsgeSsrKSB7XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzaXplOyB4KyspIHtcbiAgICAgIHZhciB0aWxlID0gdGhpcy50aWxlc1t5XVt4XTtcbiAgICAgIGlmICh0aWxlID09PSAtMSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gZHJhdyBpdFxuICAgICAgdmFyIHgxID0gKHggKyAyKSAqIHRoaXMuc2l6ZTtcbiAgICAgIHZhciB5MSA9ICh5ICsgMikgKiB0aGlzLnNpemU7XG4gICAgICB0aGlzLmRyYXdfdG9fY2FudmFzKHRoaXMuYWxwaGEuY29udCwgeDEsIHkxLCB0aWxlLCAwKTtcbiAgICAgIHRoaXMuZHJhd190b19jYW52YXModGhpcy5lZGdlLmNvbnQsIHgxLCB5MSwgdGlsZSwgdGhpcy5yZWYuZWRnZSk7XG5cbiAgICAgIGlmIChkZWNvcmF0aW9ucykge1xuICAgICAgICB0aGlzLmRyYXdfZGVjb3JhdGlvbih0aGlzLmJnLmNvbnQsIHgsIHksIHRpbGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGRyYXcgcmVzdCBvZiBmZ1xuICB2YXIgZmcgPSBtYXBnZW5fcGF0dGVybih0aGlzLmFscGhhLmNhbnYsIHRoaXMuaW1nW3RoaXMucmVmLmZnXSk7XG4gIGZnLmNvbnQuZHJhd0ltYWdlKHRoaXMuZWRnZS5jYW52LCAwLCAwKTtcblxuICAvLyBkcmF3IGRpcnQgYmdcbiAgdmFyIGZnX2RpcnQgPSBtYXBnZW5fcGF0dGVybihmZy5jYW52LCB0aGlzLmltZ1t0aGlzLnJlZi5iZ10pO1xuICB0aGlzLmJnLmNvbnQuZHJhd0ltYWdlKGZnX2RpcnQuY2FudiwgMCwgMCk7XG5cbiAgLy8gZXhwb3J0XG4gIHJldHVybiB7XG4gICAgZmc6IGZnLFxuICAgIGJnOiB0aGlzLmJnXG4gIH07XG59XG5cbi8qIERyYXcgYW4gYWxwaGEgcGF0aFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5kcmF3X3BhdGggPSBmdW5jdGlvbihjYW52LCBwYXRoKSB7XG4gIC8vIHN0YXJ0IHBhdGhzIG9uIGNhbnZhc2VzXG4gIGNhbnYuY29udC5iZWdpblBhdGgoKTtcbiAgY2Fudi5jb250Lm1vdmVUbyhwYXRoWzBdLngsIHBhdGhbMF0ueSk7XG5cbiAgLy8gZ28gdGhyb3VnaCBwYXRoXG4gIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAvLyBnZXQgbmV4dCBwb2ludCB0byBjdXJ2ZSBhcm91bmRcbiAgICB2YXIgcG9pbnQxID0gcGF0aFtpXSxcbiAgICAgIHBvaW50MiA9IHBhdGhbaSArIDFdLFxuICAgICAgcXgsXG4gICAgICBxeTtcblxuICAgIC8vIGdldCBjdXJ2ZSB2YWx1ZXNcbiAgICBpZiAoaSA8IHBhdGgubGVuZ3RoIC0gMSkge1xuICAgICAgcXggPSAocG9pbnQxLnggKyBwb2ludDIueCkgLyAyO1xuICAgICAgcXkgPSAocG9pbnQxLnkgKyBwb2ludDIueSkgLyAyO1xuICAgIH0gZWxzZSB7XG4gICAgICBxeCA9IHBvaW50Mi54O1xuICAgICAgcXkgPSBwb2ludDIueTtcbiAgICB9XG5cbiAgICAvLyBkcmF3IGN1cnZlIHRvIHBhdGhcbiAgICBjYW52LmNvbnQucXVhZHJhdGljQ3VydmVUbyhwb2ludDEueCwgcG9pbnQxLnksIHF4LCBxeSk7XG4gIH1cblxuICAvLyByZWpvaW4gdGhlIGJlZ2lubmluZyBvZiB0aGUgcGF0aCBhbmQgZmlsbFxuICBjYW52LmNvbnQubGluZVRvKHBhdGhbMF0ueCwgcGF0aFswXS55KTtcbiAgY2Fudi5jb250LmZpbGwoKTtcbn07XG5cbi8qIERyYXcgYSBkZWNvcmF0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmRyYXdfZGVjb3JhdGlvbiA9IGZ1bmN0aW9uKGNvbnQsIHgsIHksIHRpbGUpIHtcbiAgLy8gYXJlIHdlIGRyYXdpbmcgb25lXG4gIGlmICh0aWxlID4gNyB8fCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSAhPT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNhbiB3ZSBkbyBkb3VibGVzXG4gIHZhciBkb3VibGUgPSBmYWxzZTtcbiAgaWYgKHRpbGUgPT09IDAgJiYgdGhpcy5pc190eXBlKHksIHggKyAxLCAwKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDEgJiYgdGhpcy5pc190eXBlKHksIHggLSAxLCAxKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDIgJiYgdGhpcy5pc190eXBlKHkgLSAxLCB4LCAyKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDMgJiYgdGhpcy5pc190eXBlKHkgKyAxLCB4LCAzKSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDQgJiYgdGhpcy5pc190eXBlKHkgLSAxLCB4ICsgMSwgNCkpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSA1ICYmIHRoaXMuaXNfdHlwZSh5ICsgMSwgeCArIDEsIDUpKSB7XG4gICAgZG91YmxlID0gdHJ1ZTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNiAmJiB0aGlzLmlzX3R5cGUoeSAtIDEsIHggLSAxLCA2KSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDcgJiYgdGhpcy5pc190eXBlKHkgKyAxLCB4IC0gMSwgNykpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG5cbiAgLy8gY2hvb3NlIHNvdXJjZVxuICB2YXIgc291cmNlID0gdGhpcy5yZWYuZGVjb3JhdGlvbnNbMV07XG4gIGlmIChkb3VibGUgJiYgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgPT09IDApIHtcbiAgICBzb3VyY2UgPSB0aGlzLnJlZi5kZWNvcmF0aW9uc1syXTtcbiAgfSBlbHNlIHtcbiAgICBkb3VibGUgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIGNob29zZSBkZWNvcmF0aW9uXG4gIHZhciBpID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc291cmNlLmxlbmd0aCk7XG4gIHZhciByZWYgPSBzb3VyY2VbaV07XG5cbiAgLy8gZ2V0IHBvc2l0aW9uIHRvIGRyYXcgaXRcbiAgdmFyIGhhbGYgPSB0aGlzLnNpemUgLyAyO1xuICB2YXIgeDEgPSAoeCArIDIpICogdGhpcy5zaXplO1xuICB2YXIgeTEgPSAoeSArIDIpICogdGhpcy5zaXplO1xuICB2YXIgYW5nbGUgPSAwO1xuICBpZiAodGlsZSA9PT0gMSkge1xuICAgIHgxICs9IHRoaXMuc2l6ZTtcbiAgICB5MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSAxODA7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDIpIHtcbiAgICB5MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSAyNzA7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDMpIHtcbiAgICB4MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSA5MDtcbiAgfVxuICBpZiAodGlsZSA9PT0gNCkge1xuICAgIHkxICs9IHRoaXMuc2l6ZTtcbiAgICBhbmdsZSA9IDMxNTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNSkge1xuICAgIGFuZ2xlID0gNDU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDYpIHtcbiAgICB4MSArPSB0aGlzLnNpemU7XG4gICAgeTEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMjI1O1xuICB9XG4gIGlmICh0aWxlID09PSA3KSB7XG4gICAgeDEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMTM1O1xuICB9XG5cbiAgLy8gZHJhdyB0aGF0IHNoaXRcbiAgdmFyIHhfYWRkID0gZG91YmxlID8gdGhpcy5zaXplIDogMDtcbiAgY29udC5zYXZlKCk7XG4gIGNvbnQudHJhbnNsYXRlKHgxLCB5MSk7XG4gIGNvbnQucm90YXRlKChhbmdsZSAqIE1hdGguUEkpIC8gMTgwKTtcbiAgY29udC5kcmF3SW1hZ2UoXG4gICAgdGhpcy5pbWcuZGVjb3JhdGlvbnMsXG4gICAgcmVmLngsXG4gICAgcmVmLnksXG4gICAgcmVmLncsXG4gICAgcmVmLmgsXG4gICAgMCxcbiAgICAtcmVmLmggKyA1LFxuICAgIHJlZi53LFxuICAgIHJlZi5oXG4gICk7XG4gIGNvbnQudHJhbnNsYXRlKC14MSwgLXkxKTtcbiAgY29udC5yZXN0b3JlKCk7XG59O1xuXG4vKiBEcmF3IGEgdGlsZSB0byBhIGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5kcmF3X3RvX2NhbnZhcyA9IGZ1bmN0aW9uKGNvbnQsIHgsIHksIHRpbGUsIGtleSkge1xuICB2YXIgdHMgPSB0aGlzLnNpemU7XG4gIGNvbnQuc2F2ZSgpO1xuICBjb250LnRyYW5zbGF0ZSh4LCB5KTtcbiAgY29udC5kcmF3SW1hZ2UodGhpcy5pbWcuZWRnZSwgdGlsZSAqIHRzLCBrZXkgKiB0cywgdHMsIHRzLCAwLCAwLCB0cywgdHMpO1xuICBjb250LnRyYW5zbGF0ZSgteSwgLXkpO1xuICBjb250LnJlc3RvcmUoKTtcbn07XG5cbi8qIEdldCBjb3JuZXIgYW5kIGxhbmQgdGlsZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuc2V0X2Nvcm5lcl90aWxlID0gZnVuY3Rpb24oeSwgeCkge1xuICB2YXIgdGlsZSA9IC0xO1xuXG4gIC8vbGFuZFxuICBpZiAodGhpcy5pc19sYW5kKHksIHgpKSB7XG4gICAgdGlsZSA9IDEyO1xuXG4gICAgLy8gbm90IGxhbmRcbiAgfSBlbHNlIHtcbiAgICAvLyBjb3JuZXJzXG4gICAgaWYgKFxuICAgICAgIXRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNDtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgIXRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgIHRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAgIHRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICAgIXRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNjtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpXG4gICAgKSB7XG4gICAgICB0aWxlID0gNztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGlsZTtcbn07XG5cbi8qIFNldCBsYW5kIHRpbGUgdHlwZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuc2V0X2xhbmRfdGlsZSA9IGZ1bmN0aW9uKHksIHgpIHtcbiAgdmFyIHRpbGUgPSAxMjtcblxuICAvLyBjb3JuZXJzXG4gIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5ICsgMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHksIHggKyAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSAtIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSA0O1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgIXRoaXMuaXNfbGFuZCh5LCB4ICsgMSkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHksIHggLSAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSArIDEsIHgpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHksIHggKyAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5IC0gMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDU7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSAtIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCAtIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgKyAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gNjtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5IC0gMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHksIHggLSAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSArIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSA3O1xuXG4gICAgLy8gZmxhdCBlZGdlc1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5IC0gMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDA7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgKyAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gMTtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZCh5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCAtIDEpXG4gICkge1xuICAgIHRpbGUgPSAyO1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4ICsgMSlcbiAgKSB7XG4gICAgdGlsZSA9IDM7XG5cbiAgICAvLyBpbnNpZGUgY29ybmVyc1xuICB9IGVsc2UgaWYgKHRoaXMuaXNfdHlwZSh5ICsgMSwgeCwgNykgfHwgdGhpcy5pc190eXBlKHksIHggKyAxLCA3KSkge1xuICAgIHRpbGUgPSA4O1xuICB9IGVsc2UgaWYgKHRoaXMuaXNfdHlwZSh5ICsgMSwgeCwgNikgfHwgdGhpcy5pc190eXBlKHksIHggLSAxLCA2KSkge1xuICAgIHRpbGUgPSA5O1xuICB9IGVsc2UgaWYgKHRoaXMuaXNfdHlwZSh5IC0gMSwgeCwgNSkgfHwgdGhpcy5pc190eXBlKHksIHggKyAxLCA1KSkge1xuICAgIHRpbGUgPSAxMDtcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSAtIDEsIHgsIDQpIHx8IHRoaXMuaXNfdHlwZSh5LCB4IC0gMSwgNCkpIHtcbiAgICB0aWxlID0gMTE7XG4gIH1cblxuICByZXR1cm4gdGlsZTtcbn07XG5cbi8qIENoZWNrIGFycmF5cyBmb3IgdmFsdWVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmlzX2xhbmRfb3JfY29ybmVyID0gZnVuY3Rpb24oeSwgeCkge1xuICBpZiAodGhpcy5pc19jb3JuZXIoeSwgeCkgfHwgdGhpcy5pc19sYW5kKHksIHgpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn07XG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc19jb3JuZXIgPSBmdW5jdGlvbih5LCB4KSB7XG4gIHJldHVybiB0aGlzLmNoZWNrX2Fycih0aGlzLnRpbGVzLCB5LCB4LCBbNCwgNSwgNiwgN10pO1xufTtcblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmlzX3R5cGUgPSBmdW5jdGlvbih5LCB4LCB0eXBlKSB7XG4gIHJldHVybiB0aGlzLmNoZWNrX2Fycih0aGlzLnRpbGVzLCB5LCB4LCBbdHlwZV0pO1xufTtcblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmlzX2xhbmQgPSBmdW5jdGlvbih5LCB4KSB7XG4gIHJldHVybiB0aGlzLmNoZWNrX2Fycih0aGlzLmxhbmQsIHksIHgsIFsxXSk7XG59O1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuY2hlY2tfYXJyID0gZnVuY3Rpb24oYXJyLCB5LCB4LCBjaGVja3MpIHtcbiAgaWYgKHkgPCAwIHx8IHkgPj0gYXJyLmxlbmd0aCB8fCB4IDwgMCB8fCB4ID49IGFyclswXS5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGVja3MubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoYXJyW3ldW3hdID09IGNoZWNrc1tpXSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHZW5lcmF0b3Jcblx0TWFrZSBDYW52YXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgYSBuZXcgY2FudmFzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbWFwZ2VuX2NhbnZhcyh3LCBoKSB7XG4gIHZhciBvYmogPSB7fTtcbiAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICAgIG9iai5jYW52ID0gbmV3IGNhbnZhcygpO1xuICB9IGVsc2Uge1xuICAgIG9iai5jYW52ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgfVxuICBvYmouY29udCA9IG9iai5jYW52LmdldENvbnRleHQoXCIyZFwiKTtcbiAgb2JqLmNhbnYud2lkdGggPSB3O1xuICBvYmouY2Fudi5oZWlnaHQgPSBoO1xuICBvYmouY29udC5maWxsU3R5bGUgPSBcIiNmZmZcIjtcbiAgb2JqLncgPSB3O1xuICBvYmouaCA9IGg7XG4gIHJldHVybiBvYmo7XG59XG5cbi8qIERyYXcgYSBwYXR0ZXJuIHRvIGEgY2FudmFzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbWFwZ2VuX3BhdHRlcm4oYWxwaGEsIHBhdHRlcm4pIHtcbiAgdmFyIGNhbnYgPSBtYXBnZW5fY2FudmFzKGFscGhhLndpZHRoLCBhbHBoYS5oZWlnaHQpO1xuICBpZiAodHlwZW9mIHBhdHRlcm4gIT09IFwic3RyaW5nXCIpIHtcbiAgICBwYXR0ZXJuID0gY2Fudi5jb250LmNyZWF0ZVBhdHRlcm4ocGF0dGVybiwgXCJyZXBlYXRcIik7XG4gIH1cbiAgY2Fudi5jb250LmZpbGxTdHlsZSA9IHBhdHRlcm47XG4gIGNhbnYuY29udC5maWxsUmVjdCgwLCAwLCBhbHBoYS53aWR0aCwgYWxwaGEuaGVpZ2h0KTtcbiAgY2Fudi5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24taW5cIjtcbiAgY2Fudi5jb250LmRyYXdJbWFnZShhbHBoYSwgMCwgMCk7XG4gIGNhbnYuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcIm5vcm1hbFwiO1xuXG4gIHJldHVybiBjYW52O1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHZW5lcmF0b3Jcblx0LS0tLS0tLS0tLS0tXG5cdENvbmZpZzpcblx0dyAgICAgICAgICAgLy8gd2lkdGggb2YgbWFwXG5cdGggICAgICAgICAgIC8vIGhlaWdodCBvZiBtYXBcblx0Y3J1c3QgICAgICAgLy8gdGhpY2tuZXNzIG9mIG91dGVyIGNydXN0IG9uIGxhbmRcblx0YmxvYnMgICAgICAgLy8gaW5pdGlhbCBibG9ic1xuXHRjZW50ZXJfYmxvYiAvLyBzaXplIG9mIGNlbnRlciBibG9iIG9mIGxhbmQsIDAgZm9yIG5vbmVcblx0c21hbGxfYmxvYnMgLy8gbnVtYmVyIG9mIHJhbmRvbSBzbWFsbCBjaXJjbGVzIG9mIGxhbmRcblx0bGFyZ2VfYmxvYnMgLy8gbnVtYmVyIG9mIHJhbmRvbSBsYXJnZSBjaXJjbGVzIG9mIGxhbmRcblx0LS0tLS0tLS0tLS1cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXJ2ZXIgc2lkZSBvbmx5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICB2YXIgZnMgPSByZXF1aXJlKFwiZnNcIik7XG59XG5cbi8qIE5ldyBNYXAgR2VuZXJhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbihpbWcsIGNvbmZpZywgc2NoZW1lLCBtYXBfaW1nKSB7XG4gIHRoaXMuc2l6ZSA9IDM2O1xuICB0aGlzLmltZyA9IGltZztcbiAgdGhpcy5jID0gY29uZmlnO1xuICB0aGlzLnNjaGVtZSA9IHNjaGVtZTtcblxuICAvLyBjaG9vc2UgdHlwZVxuICBpZiAodGhpcy5zY2hlbWUudHlwZSA9PSBcInJhbmRvbVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZHJhd19yYW5kb20oKTtcbiAgfVxuICBpZiAodGhpcy5zY2hlbWUudHlwZSA9PSBcImltYWdlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3X2ltYWdlKG1hcF9pbWcpO1xuICB9XG59XG5cbi8qIERyYXcgaW1hZ2Vcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmRyYXdfaW1hZ2UgPSBmdW5jdGlvbihtYXBfaW1nKSB7XG4gIHZhciBmZyA9IG1hcGdlbl9jYW52YXMoXG4gICAgbWFwX2ltZy53aWR0aCArIHRoaXMuc2NoZW1lLmdhcCAqIDIsXG4gICAgbWFwX2ltZy5oZWlnaHQgKyB0aGlzLnNjaGVtZS5nYXAgKiAyXG4gICk7XG4gIGZnLmNvbnQuZHJhd0ltYWdlKG1hcF9pbWcsIHRoaXMuc2NoZW1lLmdhcCwgdGhpcy5zY2hlbWUuZ2FwKTtcbiAgdmFyIGJnID0gbWFwZ2VuX3BhdHRlcm4oZmcuY2FudiwgdGhpcy5pbWcuZGlydCk7XG4gIHJldHVybiB7IGZnOiBmZywgYmc6IGJnIH07XG59O1xuXG4vKiBEcmF3IHJhbmRvbVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbi5wcm90b3R5cGUuZHJhd19yYW5kb20gPSBmdW5jdGlvbigpIHtcbiAgLy8gc2V0dXBcbiAgdGhpcy5ibG9icyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5zY2hlbWUuYmxvYnMpKTtcbiAgdGhpcy5iZyA9IG1hcGdlbl9jYW52YXModGhpcy5zY2hlbWUudywgdGhpcy5zY2hlbWUuaCk7XG4gIHRoaXMuZmcgPSBtYXBnZW5fY2FudmFzKHRoaXMuc2NoZW1lLncsIHRoaXMuc2NoZW1lLmgpO1xuXG4gIC8vIGdlbmVyYXRlIHNvbWUgcmFuZG9tIGxhcmdlIGNpcmNsZXNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5sYXJnZV9ibG9iczsgaSsrKSB7XG4gICAgdGhpcy5ibG9icyA9IHRoaXMuZ2V0X2NpcmNsZSh0aGlzLmJsb2JzLCA0LCA2KTtcbiAgfVxuXG4gIC8vIGdlbmVyYXRlIHNvbWUgcmFuZG9tIHNtYWxsIGNpcmNsZXNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5zbWFsbF9ibG9iczsgaSsrKSB7XG4gICAgdGhpcy5ibG9icyA9IHRoaXMuZ2V0X2NpcmNsZSh0aGlzLmJsb2JzLCAxLCAzKTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZWFjaCBibG9iXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ibG9icy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBibG9iID0gdGhpcy5ibG9ic1tpXTtcblxuICAgIC8vIGNyZWF0ZSB0aGUgYmxvYnNcbiAgICB2YXIgYmcgPSBuZXcgbWFwZ2VuX2Jsb2IodGhpcy5pbWcsIHRoaXMuYywgZmFsc2UsIGJsb2IuciArIDQsIGJsb2IudHlwZSk7XG4gICAgdmFyIGZnID0gbmV3IG1hcGdlbl9ibG9iKFxuICAgICAgdGhpcy5pbWcsXG4gICAgICB0aGlzLmMsXG4gICAgICB0aGlzLnNjaGVtZS5kZWNvcmF0aW9ucyxcbiAgICAgIGJsb2IucixcbiAgICAgIGJsb2IudHlwZVxuICAgICk7XG5cbiAgICAvLyBjb21iaW5lIHRoZSBiYWNrZ3JvdW5kc1xuICAgIHZhciB3aCA9IGZnLmZnLmNhbnYud2lkdGg7XG4gICAgdmFyIG5ld19iZyA9IG1hcGdlbl9jYW52YXMod2gsIHdoKTtcbiAgICBuZXdfYmcuY29udC5kcmF3SW1hZ2UoYmcuZmcuY2Fudiwgd2ggKiAwLjEsIHdoICogMC4xLCB3aCAqIDAuOCwgd2ggKiAwLjgpO1xuICAgIG5ld19iZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLWF0b3BcIjtcbiAgICBuZXdfYmcuY29udC5maWxsU3R5bGUgPSBcInJnYmEoMCwwLDAsMC44KVwiO1xuICAgIG5ld19iZy5jb250LmZpbGxSZWN0KDAsIDAsIHdoLCB3aCk7XG4gICAgbmV3X2JnLmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJub3JtYWxcIjtcbiAgICBuZXdfYmcuY29udC5kcmF3SW1hZ2UoZmcuYmcuY2FudiwgMCwgMCk7XG5cbiAgICAvLyBkcmF3IGl0IHRvIG1haW4gY2FudmFzXG4gICAgdGhpcy5iZy5jb250LmRyYXdJbWFnZShuZXdfYmcuY2FudiwgYmxvYi54IC0gd2ggLyAyLCBibG9iLnkgLSB3aCAvIDIpO1xuICAgIHRoaXMuZmcuY29udC5kcmF3SW1hZ2UoZmcuZmcuY2FudiwgYmxvYi54IC0gd2ggLyAyLCBibG9iLnkgLSB3aCAvIDIpO1xuICB9XG5cbiAgLy8gcmV0dXJuIGl0XG4gIHJldHVybiB7XG4gICAgYmc6IHRoaXMuYmcsXG4gICAgZmc6IHRoaXMuZmdcbiAgfTtcbn07XG5cbi8qIEdldCBhIGZhciBhd2F5IGNpcmNsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbi5wcm90b3R5cGUuZ2V0X2NpcmNsZSA9IGZ1bmN0aW9uKGFyciwgbWluX3JhZGl1cywgbWF4X3JhZGl1cykge1xuICAvLyBnZW5lcmF0ZSBtYW55IGNpcmNsZXMgYW5kIGZpbmQgZnVydGhlc3QgYXdheVxuICB2YXIgZGlzdGFuY2UgPSAwO1xuICB2YXIgY2lyY2xlID0gbnVsbDtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IDIwOyBpKyspIHtcbiAgICAvLyBtYWtlIG5ldyBjaXJjbGVcbiAgICB2YXIgdGVzdF9jaXJjbGUgPSB0aGlzLmNpcmNsZShtaW5fcmFkaXVzLCBtYXhfcmFkaXVzKTtcbiAgICB2YXIgc21hbGxlc3RfZGlzdGFuY2UgPSA5OTk5OTk7XG5cbiAgICAvLyBmaW5kIHNob3J0ZXN0IGRpc3RhbmNlIGZyb20gYWxsIG90aGVyIGNpcmNsZXNcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFyci5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIGR4ID0gYXJyW2pdLnggLSB0ZXN0X2NpcmNsZS54O1xuICAgICAgdmFyIGR5ID0gYXJyW2pdLnkgLSB0ZXN0X2NpcmNsZS55O1xuICAgICAgdmFyIHRlc3RfZGlzdGFuY2UgPSBNYXRoLnJvdW5kKFxuICAgICAgICBNYXRoLnNxcnQoTWF0aC5wb3coZHgsIDIpICsgTWF0aC5wb3coZHksIDIpKVxuICAgICAgKTtcbiAgICAgIHNtYWxsZXN0X2Rpc3RhbmNlID1cbiAgICAgICAgdGVzdF9kaXN0YW5jZSA8IHNtYWxsZXN0X2Rpc3RhbmNlID8gdGVzdF9kaXN0YW5jZSA6IHNtYWxsZXN0X2Rpc3RhbmNlO1xuICAgIH1cblxuICAgIC8vIGlmIGlzIHRoZSBsYXJnZXN0IGRpc3RhbmNlIHJlY29yZCB0aGlzIGFzIGZ1cnRoZXN0XG4gICAgaWYgKGRpc3RhbmNlIDwgc21hbGxlc3RfZGlzdGFuY2UpIHtcbiAgICAgIGRpc3RhbmNlID0gc21hbGxlc3RfZGlzdGFuY2U7XG4gICAgICBjaXJjbGUgPSB0ZXN0X2NpcmNsZTtcbiAgICB9XG4gIH1cblxuICAvLyBhZGQgZnVydGhlc3QgYXdheSBjaXJjbGUgdG8gbmV3IGFycmF5XG4gIGFyci5wdXNoKGNpcmNsZSk7XG4gIHJldHVybiBhcnI7XG59O1xuXG4vKiBHZW5lcmF0ZSBhIHJhbmRvbSBjaXJjbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmNpcmNsZSA9IGZ1bmN0aW9uKG1pbl9yYWRpdXMsIG1heF9yYWRpdXMpIHtcbiAgdmFyIHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhfcmFkaXVzKSArIG1pbl9yYWRpdXM7XG4gIHZhciBnYXAgPSAociArIDIpICogdGhpcy5zaXplICsgdGhpcy5zY2hlbWUuZ2FwO1xuICB2YXIgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLnNjaGVtZS53IC0gZ2FwICogMikpICsgZ2FwO1xuICB2YXIgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLnNjaGVtZS5oIC0gZ2FwICogMikpICsgZ2FwO1xuICByZXR1cm4ge1xuICAgIHI6IHIsXG4gICAgeDogeCxcbiAgICB5OiB5XG4gIH07XG59O1xuIiwidmFyIHNjaGVtZXMgPSBzY2hlbWVzIHx8IHt9O1xuc2NoZW1lcy5kZWF0aG1hdGNoID0ge1xuICB0aXRsZTogXCJEZWF0aG1hdGNoXCIsXG4gIHRpbWVfbGltaXQ6IDU4MDAsXG4gIGRlc3Ryb3lfbGFuZDogdHJ1ZSxcbiAgZ3Jhdml0eTogMixcbiAgc2NvcmU6IHRydWUsXG4gIGRyb3BzOiB7XG4gICAgY3JhdGU6IHtcbiAgICAgIHRpbWU6IDEwMCxcbiAgICAgIG1heDogMVxuICAgIH0sXG4gICAgbWVkcGFjazoge1xuICAgICAgdGltZTogMTAwLFxuICAgICAgYWRkOiAzMCxcbiAgICAgIG1heDogMVxuICAgIH0sXG4gICAgXCJnZW0tMVwiOiB7XG4gICAgICB0aW1lOiAxMDAsXG4gICAgICBtYXg6IDVcbiAgICB9LFxuICAgIFwiZ2VtLTVcIjoge1xuICAgICAgdGltZTogMTUwLFxuICAgICAgbWF4OiAxXG4gICAgfSxcbiAgICBcImdlbS0yMFwiOiB7XG4gICAgICB0aW1lOiA1MDAsXG4gICAgICBtYXg6IDFcbiAgICB9XG4gIH0sXG4gIHdlYXBvbnM6IHtcbiAgICBkaWc6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAtMSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgcGhhc2VyOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIGJhem9va29pZDoge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBncmVuYWRlOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bmNoOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bXBraW46IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAwLFxuICAgICAgY3JhdGVfY2hhbmNlOiAxLFxuICAgICAgY3JhdGVfY291bnQ6IDVcbiAgICB9LFxuICAgIHBhaW5naXZlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDEsXG4gICAgICBjcmF0ZV9jb3VudDogNVxuICAgIH1cbiAgfSxcbiAgbWFwZ2VuOiB7XG4gICAgdHlwZTogXCJyYW5kb21cIixcbiAgICBzcmM6IFwiXCIsXG4gICAgZ2FwOiAyMCxcbiAgICB3OiAxOTAwLFxuICAgIGg6IDE0MDAsXG4gICAgYmxvYnM6IFtdLFxuICAgIGRlY29yYXRpb25zOiB0cnVlLFxuICAgIHNtYWxsX2Jsb2JzOiA1LFxuICAgIGxhcmdlX2Jsb2JzOiAzXG4gIH0sXG4gIGV2ZW50czoge1xuICAgIGZyYW1lOiB7fSxcbiAgICBjb2xsZWN0OiB7fSxcbiAgICBkZXN0cm95OiB7fSxcbiAgICB0aW1lb3V0OiB7fSxcbiAgICBkZXN0cm95X29ial90eXBlOiB7fSxcbiAgICBkZXN0cm95X29ial9wbGF5ZXI6IHt9XG4gIH1cbn07XG4iLCJ2YXIgc2NoZW1lcyA9IHNjaGVtZXMgfHwge307XG5zY2hlbWVzLmRlZmF1bHQgPSB7XG4gIHRpdGxlOiBcIlwiLFxuICBkZXNjcmlwdGlvbjogXCJcIixcbiAgdGltZV9saW1pdDogMCxcbiAgc2hvd190aW1lOiB0cnVlLFxuICBkZXN0cm95X2xhbmQ6IHRydWUsXG4gIGdyYXZpdHlfdHlwZTogXCJsYW5kXCIsXG4gIGdyYXZpdHk6IDEsXG4gIHN0YXJzOiB7fSxcbiAgc2NvcmU6IGZhbHNlLFxuICBoZWFsdGg6IHRydWUsXG4gIGxldmVsczoge1xuICAgIHNjb3JlOiBbXG4gICAgICAwLFxuICAgICAgMTAsXG4gICAgICAyNSxcbiAgICAgIDQwLFxuICAgICAgNjAsXG4gICAgICA5MCxcbiAgICAgIDEyMCxcbiAgICAgIDE1MCxcbiAgICAgIDIwMCxcbiAgICAgIDI1MCxcbiAgICAgIDMwMCxcbiAgICAgIDM2MCxcbiAgICAgIDQyMCxcbiAgICAgIDQ5MCxcbiAgICAgIDU3MCxcbiAgICAgIDY1MCxcbiAgICAgIDcyMCxcbiAgICAgIDgxMCxcbiAgICAgIDkwMCxcbiAgICAgIDEwMDBcbiAgICBdLFxuICAgIGhlYWx0aDogW1xuICAgICAgMTAwLFxuICAgICAgMTIwLFxuICAgICAgMTIwLFxuICAgICAgMTIwLFxuICAgICAgMTQwLFxuICAgICAgMTQwLFxuICAgICAgMTQwLFxuICAgICAgMTQwLFxuICAgICAgMTYwLFxuICAgICAgMTgwLFxuICAgICAgMjAwLFxuICAgICAgMjAwLFxuICAgICAgMjAwLFxuICAgICAgMjAwLFxuICAgICAgMjIwLFxuICAgICAgMjIwLFxuICAgICAgMjIwLFxuICAgICAgMjIwLFxuICAgICAgMjQwLFxuICAgICAgMzAwXG4gICAgXSxcbiAgICBkYW1hZ2U6IFtcbiAgICAgIDAsXG4gICAgICAxMCxcbiAgICAgIDEwLFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjUsXG4gICAgICAyNSxcbiAgICAgIDI1LFxuICAgICAgMzAsXG4gICAgICAzMCxcbiAgICAgIDMwLFxuICAgICAgMzAsXG4gICAgICAzNSxcbiAgICAgIDM1LFxuICAgICAgMzUsXG4gICAgICA1MFxuICAgIF0sXG4gICAgc3BlZWQ6IFtcbiAgICAgIDQsXG4gICAgICA2LFxuICAgICAgOCxcbiAgICAgIDgsXG4gICAgICA4LFxuICAgICAgOCxcbiAgICAgIDEwLFxuICAgICAgMTAsXG4gICAgICAxMCxcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTQsXG4gICAgICAxNCxcbiAgICAgIDE0LFxuICAgICAgMTQsXG4gICAgICAxNixcbiAgICAgIDE2LFxuICAgICAgMjBcbiAgICBdLFxuICAgIGp1bXA6IFtcbiAgICAgIDEwLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE4LFxuICAgICAgMTgsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjVcbiAgICBdXG4gIH0sXG4gIGRyb3BzOiB7XG4gICAgY3JhdGU6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDIwXG4gICAgfSxcbiAgICBtZWRwYWNrOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgYWRkOiAzMCxcbiAgICAgIG1heDogNTBcbiAgICB9LFxuICAgIG51Y2xlYXI6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDIwXG4gICAgfSxcbiAgICB0YXJnZXQ6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDEwMFxuICAgIH0sXG4gICAgYXN0ZXJvaWRfY2VudGVyOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgaW5jcmVhc2VfZnJlcXVlbmN5OiBmYWxzZSxcbiAgICAgIG1heDogMzBcbiAgICB9LFxuICAgIFwiZ2VtLTFcIjoge1xuICAgICAgdGltZTogMCxcbiAgICAgIG1heDogMjBcbiAgICB9XG4gIH0sXG4gIHdlYXBvbnM6IHtcbiAgICBkaWc6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAtMSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgcGhhc2VyOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgYmF6b29rb2lkOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgZ3JlbmFkZToge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bmNoOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgcHVtcGtpbjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogMVxuICAgIH0sXG4gICAgcGFpbmdpdmVyOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAxMFxuICAgIH1cbiAgfSxcbiAgYXJtb3VyeTogW1xuICAgIFwiZGlnXCIsXG4gICAgXCJwaGFzZXJcIixcbiAgICBcImJhem9va29pZFwiLFxuICAgIFwiZ3JlbmFkZVwiLFxuICAgIFwicHVuY2hcIixcbiAgICBcInB1bXBraW5cIixcbiAgICBcInBhaW5naXZlclwiXG4gIF0sXG4gIGFycm93czoge1xuICAgIG51Y2xlYXI6IFwiZ3JlZW5cIixcbiAgICBwbGF5ZXI6IFwicmVkXCIsXG4gICAgdGFyZ2V0OiBcImJsdWVcIixcbiAgICBcImFzdGVyb2lkLXNtYWxsXCI6IFwiZ3JleVwiLFxuICAgIFwiYXN0ZXJvaWQtbGFyZ2VcIjogXCJncmV5XCIsXG4gICAgdm9ydGV4OiBcInB1cnBsZVwiLFxuICAgIGNyYXRlOiBcImJsdWVcIlxuICB9LFxuICBzcGF3bjogW10sXG4gIG1hcGdlbjoge1xuICAgIHR5cGU6IFwicmFuZG9tXCIsXG4gICAgc3JjOiBcIlwiLFxuICAgIGdhcDogMjAsXG4gICAgdzogMTAwMCxcbiAgICBoOiAxMDAwLFxuICAgIGJsb2JzOiBbXSxcbiAgICBkZWNvcmF0aW9uczogdHJ1ZSxcbiAgICBzbWFsbF9ibG9iczogNSxcbiAgICBsYXJnZV9ibG9iczogM1xuICB9LFxuICBldmVudHM6IHtcbiAgICBmcmFtZToge30sXG4gICAgY29sbGVjdDoge30sXG4gICAgZGVzdHJveToge30sXG4gICAgdGltZW91dDoge30sXG4gICAgZGVzdHJveV9vYmpfdHlwZToge30sXG4gICAgZGVzdHJveV9vYmpfcGxheWVyOiB7fVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHcmF2aXR5XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGdyYXZpdHlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmluaXRfZ3Jhdml0eSA9IGZ1bmN0aW9uKGdyYXZpdHlfbWFwKSB7XG4gIHRoaXMud2VpZ2h0ID0gdGhpcy5zY2hlbWUuZ3Jhdml0eSB8fCAxO1xuICB0aGlzLmdyYXZpdHlfdHlwZSA9IHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSB8fCBcImxhbmRcIjtcblxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlICE9PSBcImxhbmRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNldCB2YWx1ZXNcbiAgdGhpcy5ncmF2aXR5ID0ge1xuICAgIHc6IDAsXG4gICAgaDogMCxcbiAgICBtYXA6IFtdLFxuICAgIHNjYWxlOiAyNCxcbiAgICByZWFjaDogMThcbiAgfTtcblxuICBpZiAoZ3Jhdml0eV9tYXApIHtcbiAgICB0aGlzLmdyYXZpdHkubWFwID0gSlNPTi5wYXJzZShncmF2aXR5X21hcCk7XG4gICAgdGhpcy5ncmF2aXR5LncgPSB0aGlzLmdyYXZpdHkubWFwWzBdLmxlbmd0aDtcbiAgICB0aGlzLmdyYXZpdHkuaCA9IHRoaXMuZ3Jhdml0eS5tYXAubGVuZ3RoO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuaW5pdF9ncmF2aXR5X21hcCgpO1xuICB9XG59O1xuXG4vKiBHZW5lcmF0ZSBncmF2aXR5IG1hcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5pbml0X2dyYXZpdHlfbWFwID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldCBzaXplIG9mIG5ldyBncmF2aXR5IGdyaWRcbiAgdGhpcy5ncmF2aXR5LncgPSBjZWlsKHRoaXMudyAvIHRoaXMuZ3Jhdml0eS5zY2FsZSk7XG4gIHRoaXMuZ3Jhdml0eS5oID0gY2VpbCh0aGlzLmggLyB0aGlzLmdyYXZpdHkuc2NhbGUpO1xuXG4gIC8vIGdlbmVyYXRlIG1hcCBhcnJheVxuICB2YXIgbmV3X2FyciA9IFtdO1xuICBmb3IgKHZhciB5ID0gMDsgeSA8IHRoaXMuZ3Jhdml0eS5oOyB5KyspIHtcbiAgICB0aGlzLmdyYXZpdHkubWFwW3ldID0gW107XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCB0aGlzLmdyYXZpdHkudzsgeCsrKSB7XG4gICAgICB0aGlzLmdyYXZpdHkubWFwW3ldLnB1c2goWzAsIDAsIDBdKTtcbiAgICB9XG4gIH1cblxuICAvLyBkbyB0aGUgY2FsY3VsYXRpbmdcbiAgdGhpcy5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSgwLCAwLCB0aGlzLncsIHRoaXMuaCk7XG59O1xuXG4vKiBBcHBseSBuZXcgZ3Jhdml0eSBjYWxjdWxhdGlvbnMgdG8gYSBzZXQgb2YgcGl4ZWxzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmFjdGlvbl9ncmF2aXR5X2dlbmVyYXRlID0gZnVuY3Rpb24oeCwgeSwgdywgaCkge1xuICAvLyBjYWxjdWxhdGUgd2hpY2ggdGlsZXMgYXJlIGFmZmVjdGVkXG4gIHZhciB4MSA9IG1heCgwLCBtaW4oZmxvb3IoeCAvIHRoaXMuZ3Jhdml0eS5zY2FsZSksIHRoaXMuZ3Jhdml0eS53KSk7XG4gIHZhciB5MSA9IG1heCgwLCBtaW4oZmxvb3IoeSAvIHRoaXMuZ3Jhdml0eS5zY2FsZSksIHRoaXMuZ3Jhdml0eS5oKSk7XG4gIHZhciB4MiA9IG1heCgwLCBtaW4oZmxvb3IoKHggKyB3KSAvIHRoaXMuZ3Jhdml0eS5zY2FsZSksIHRoaXMuZ3Jhdml0eS53KSk7XG4gIHZhciB5MiA9IG1heCgwLCBtaW4oZmxvb3IoKHkgKyBoKSAvIHRoaXMuZ3Jhdml0eS5zY2FsZSksIHRoaXMuZ3Jhdml0eS5oKSk7XG5cbiAgLy8gZ2V0IHRoZSB3ZWlnaHQgb2YgYWxsIGFmZmVjdGVkIHRpbGVzXG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB0aGlzLmdyYXZpdHkubWFwW3kzXVt4M11bMF0gPSB0aGlzLmdldF90aWxlX3dlaWdodCh4MywgeTMpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNhbGN1bGF0ZSBzdXJyb3VuZGluZyB0aWxlc1xuICB2YXIgeDEgPSBtYXgoMCwgbWluKHgxIC0gdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTEgPSBtYXgoMCwgbWluKHkxIC0gdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKHgyICsgdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTIgPSBtYXgoMCwgbWluKHkyICsgdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkuaCkpO1xuXG4gIC8vIGdvIHRocm91Z2ggc3Vycm91bmRpbmcgdGlsZXMgdG8gZ2V0IGdyYXZpdHlcbiAgZm9yICh2YXIgeTMgPSB5MTsgeTMgPCB5MjsgeTMrKykge1xuICAgIGZvciAodmFyIHgzID0geDE7IHgzIDwgeDI7IHgzKyspIHtcbiAgICAgIHZhciB4eSA9IHRoaXMuZ2V0X3RpbGVfZ3Jhdml0eSh4MywgeTMpO1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzFdID0geHkueDtcbiAgICAgIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVsyXSA9IHh5Lnk7XG4gICAgfVxuICB9XG59O1xuXG4vKiBHZXQgd2VpZ2h0IG9mIGEgdGlsZSBpbiB0aGUgZ3Jhdml0eSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X3RpbGVfd2VpZ2h0ID0gZnVuY3Rpb24oeCwgeSkge1xuICAvLyBsaW1pdCB4IGFuZCB5IHRvIHdpdGhpbiB0aGUgYXJlYVxuICB2YXIgeTEgPSBtYXgoMCwgbWluKHkgKiB0aGlzLmdyYXZpdHkuc2NhbGUsIHRoaXMuaCkpO1xuICB2YXIgeDEgPSBtYXgoMCwgbWluKHggKiB0aGlzLmdyYXZpdHkuc2NhbGUsIHRoaXMudykpO1xuICB2YXIgeTIgPSBtYXgoMCwgbWluKHkgKiB0aGlzLmdyYXZpdHkuc2NhbGUgKyB0aGlzLmdyYXZpdHkuc2NhbGUsIHRoaXMuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKHggKiB0aGlzLmdyYXZpdHkuc2NhbGUgKyB0aGlzLmdyYXZpdHkuc2NhbGUsIHRoaXMudykpO1xuXG4gIC8vIGdvIHRocm91Z2ggdGhlIGdyaWQgb2YgcGl4ZWxzXG4gIHZhciBjID0gMDtcbiAgZm9yICh2YXIgeTMgPSB5MTsgeTMgPCB5MjsgeTMrKykge1xuICAgIGZvciAodmFyIHgzID0geDE7IHgzIDwgeDI7IHgzKyspIHtcbiAgICAgIHZhciBpZCA9IHRoaXMuaSh4MywgeTMpO1xuICAgICAgaWYgKGlkID09IDEgfHwgaWQgPT0gMikge1xuICAgICAgICBjICs9IDE7XG4gICAgICB9XG4gICAgICBpZiAoaWQgPT0gMykge1xuICAgICAgICBjICs9IDM7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBjO1xufTtcblxuLyogR2V0IGdyYXZpdHkgb2YgYSB0aWxlIGZyb20gdGhlIHdlaWdodCBvZiBzdXJyb3VuZGluZyB0aWxlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfdGlsZV9ncmF2aXR5ID0gZnVuY3Rpb24oeCwgeSkge1xuICAvLyBjYWxjdWxhdGUgc3Vycm91bmRpbmcgdGlsZXNcbiAgdmFyIHd4ID0gMDtcbiAgdmFyIHd5ID0gMDtcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4IC0gdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTEgPSBtYXgoMCwgbWluKHkgLSB0aGlzLmdyYXZpdHkucmVhY2gsIHRoaXMuZ3Jhdml0eS5oKSk7XG4gIHZhciB4MiA9IG1heCgwLCBtaW4oeCArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5ICsgdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkuaCkpO1xuXG4gIC8vIGdvIHRocm91Z2ggc3Vycm91bmRpbmcgdGlsZXMgdG8gZ2V0IGdyYXZpdHlcbiAgZm9yICh2YXIgeTMgPSB5MTsgeTMgPCB5MjsgeTMrKykge1xuICAgIGZvciAodmFyIHgzID0geDE7IHgzIDwgeDI7IHgzKyspIHtcbiAgICAgIHd4ICs9ICh4MyAtIHgpICogdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdO1xuICAgICAgd3kgKz0gKHkzIC0geSkgKiB0aGlzLmdyYXZpdHkubWFwW3kzXVt4M11bMF07XG4gICAgfVxuICB9XG5cbiAgd3ggPSByb3VuZCh3eCAvIDUwMDAgLyB0aGlzLmdyYXZpdHkucmVhY2gpIC8gNjA7XG4gIHd5ID0gcm91bmQod3kgLyA1MDAwIC8gdGhpcy5ncmF2aXR5LnJlYWNoKSAvIDYwO1xuXG4gIHJldHVybiB7XG4gICAgeDogd3gsXG4gICAgeTogd3lcbiAgfTtcbn07XG5cbi8qIFJlc2V0IGdyYXZpdHkgZnJvbSBkZXN0cnVjdGlvbiBldmVudFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5ncmF2aXR5X2V2ZW50X3JlY2FsY3VsYXRlID0gZnVuY3Rpb24oeCwgeSwgcmFkaXVzKSB7XG4gIC8vIGlmIHdlIGFyZSBub3QgdXNpbmcgbGFuZCBncmF2aXR5XG4gIGlmICh0aGlzLnNjaGVtZS5ncmF2aXR5X3R5cGUgIT09IFwibGFuZFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcmVjYWxjdWxhdGUgZ3Jhdml0eVxuICB2YXIgeDEgPSByb3VuZCh4IC0gcmFkaXVzKTtcbiAgdmFyIHkxID0gcm91bmQoeSAtIHJhZGl1cyk7XG4gIHZhciBzaXplID0gcm91bmQocmFkaXVzICogMiArIDEpO1xuICB0aGlzLmFjdGlvbl9ncmF2aXR5X2dlbmVyYXRlKHgxLCB5MSwgc2l6ZSwgc2l6ZSk7XG59O1xuXG4vKiBSZXR1cm4gZ3Jhdml0eSBmb3IgY28tb3JkaW5hdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9ncmF2aXR5ID0gZnVuY3Rpb24oeCwgeSkge1xuICAvLyBmbGF0XG4gIGlmICh0aGlzLnNjaGVtZS5ncmF2aXR5X3R5cGUgPT09IFwiZmxhdFwiKSB7XG4gICAgcmV0dXJuIHsgeDogMCwgeTogdGhpcy53ZWlnaHQgfTtcbiAgfVxuXG4gIC8vIG1hcFxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlID09PSBcImxhbmRcIikge1xuICAgIHZhciB4MSA9IG1heCgwLCBtaW4ocm91bmQoeCAvIHRoaXMuZ3Jhdml0eS5zY2FsZSksIHRoaXMuZ3Jhdml0eS53IC0gMSkpO1xuICAgIHZhciB5MSA9IG1heCgwLCBtaW4ocm91bmQoeSAvIHRoaXMuZ3Jhdml0eS5zY2FsZSksIHRoaXMuZ3Jhdml0eS5oIC0gMSkpO1xuICAgIHZhciBvYmogPSB0aGlzLmdyYXZpdHkubWFwW3kxXVt4MV07XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IG1pbihvYmpbMV0sIDEpICogdGhpcy53ZWlnaHQsXG4gICAgICB5OiBtaW4ob2JqWzJdLCAxKSAqIHRoaXMud2VpZ2h0XG4gICAgfTtcbiAgfVxufTtcblxuLyogUmV0dXJuIHRoZSBhbmdsZSBvZiBncmF2aXR5IGZvciBjby1vcmRpbmF0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2dyYXZpdHlfYW5nbGUgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciBncmF2ID0gdGhpcy5nZXRfZ3Jhdml0eSh4LCB5KTtcbiAgdmFyIGExID0gZ2V0X2FuZ2xlKGdyYXYueCwgZ3Jhdi55KTtcbiAgcmV0dXJuIGExO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR3JvdW5kIENoZWNrZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogR2V0IGFycmF5IG9mIG9mZnNldHMgdG8gY2hlY2sgaW4gYW4gYW5nbGVzIGRpcmVjdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfYW5nbGVfb2Zmc2V0cyA9IGZ1bmN0aW9uKGEpIHtcbiAgaWYgKGEgPiAyMiAmJiBhIDw9IDY3KSB7XG4gICAgcmV0dXJuIFtbLTEsIC0xXSwgWzAsIC0xXSwgWy0xLCAwXSwgWzEsIC0xXSwgWy0xLCAxXSwgWzEsIDBdLCBbMCwgMV1dO1xuICB9IC8vIHVwIGxlZnRcbiAgaWYgKGEgPiA2NyAmJiBhIDw9IDExMikge1xuICAgIHJldHVybiBbWzAsIC0xXSwgWy0xLCAtMV0sIFsxLCAtMV0sIFstMSwgMF0sIFsxLCAwXSwgWy0xLCAxXSwgWzEsIDFdXTtcbiAgfSAvLyB1cFxuICBpZiAoYSA+IDExMiAmJiBhIDw9IDE1Nykge1xuICAgIHJldHVybiBbWzEsIC0xXSwgWzAsIC0xXSwgWzEsIDBdLCBbLTEsIC0xXSwgWzEsIDFdLCBbLTEsIDBdLCBbMCwgMV1dO1xuICB9IC8vIHVwIHJpZ2h0XG4gIGlmIChhID4gMTU3ICYmIGEgPD0gMjAyKSB7XG4gICAgcmV0dXJuIFtbMSwgMF0sIFsxLCAtMV0sIFsxLCAxXSwgWzAsIC0xXSwgWzAsIDFdLCBbLTEsIC0xXSwgWy0xLCAxXV07XG4gIH0gLy8gcmlnaHRcbiAgaWYgKGEgPiAyMDIgJiYgYSA8PSAyNDcpIHtcbiAgICByZXR1cm4gW1sxLCAxXSwgWzEsIDBdLCBbMCwgMV0sIFsxLCAtMV0sIFstMSwgMV0sIFswLCAtMV0sIFstMSwgMF1dO1xuICB9IC8vIGRvd24gcmlnaHRcbiAgaWYgKGEgPiAyNDcgJiYgYSA8PSAyOTIpIHtcbiAgICByZXR1cm4gW1swLCAxXSwgWy0xLCAxXSwgWzEsIDFdLCBbLTEsIDBdLCBbMSwgMF0sIFstMSwgLTFdLCBbMSwgLTFdXTtcbiAgfSAvLyBkb3duXG4gIGlmIChhID4gMjkyICYmIGEgPD0gMzM3KSB7XG4gICAgcmV0dXJuIFtbLTEsIDFdLCBbLTEsIDBdLCBbMCwgMV0sIFstMSwgLTFdLCBbMSwgMV0sIFswLCAtMV0sIFsxLCAwXV07XG4gIH0gLy8gZG93biBsZWZ0XG4gIGlmIChhID4gMzM3IHx8IGEgPD0gMjIpIHtcbiAgICByZXR1cm4gW1stMSwgMF0sIFstMSwgLTFdLCBbLTEsIDFdLCBbMCwgLTFdLCBbMCwgMV0sIFsxLCAtMV0sIFsxLCAxXV07XG4gIH0gLy8gbGVmdFxufTtcblxuLyogQ2FsY3VsYXRlIHdhbGsgcGF0aCBieSBhbmdsZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS53YWxrID0gZnVuY3Rpb24oeCwgeSwgcHgsIHB5LCBhbmdsZSwgc3BlZWQpIHtcbiAgLy8gZ2V0IG5laWdoYm9yaW5nIHBpeGVsc1xuICB2YXIgb2Zmc2V0cyA9IHRoaXMuZ2V0X2FuZ2xlX29mZnNldHMoYW5nbGUpO1xuXG4gIC8vIHJlY29yZCBvbGQgcG9zaXRpb25cbiAgdmFyIG94ID0geDtcbiAgdmFyIG95ID0geTtcblxuICAvLyByZWNvcmQgcmVzdWx0XG4gIHZhciByZXN1bHQgPSB7XG4gICAgbW92ZTogZmFsc2UsIC8vIHdlIGFyZSBtb3ZpbmdcbiAgICBhbmdsZTogMCwgLy8gYWN0dWFsIGFuZ2xlIG9mIG1vdmVtZW50XG4gICAgcGF0aDogW10gLy8gcmVjb3JkZWQgY29vcmRpbmF0ZXNcbiAgfTtcblxuICAvLyBnbyB0aHJvdWdoIG51bWJlciBvZiBtb3ZlbWVudHMgcGVyIGZyYW1lXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlZWQ7IGkrKykge1xuICAgIHZhciBtb3ZlZCA9IGZhbHNlO1xuXG4gICAgLy8gZ28gdGhyb3VnaCBkaXJlY3Rpb25hbCBwaXhlbHMgdG8gY2hlY2sgYmFzZWQgb24gYW5nbGUgb2YgcGF0aFxuICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2Zmc2V0cy5sZW5ndGg7IGorKykge1xuICAgICAgLy8gY28tb3JkaW5hdGVzIHdlJ3JlIGNoZWNraW5nXG4gICAgICB2YXIgeDEgPSB4ICsgb2Zmc2V0c1tqXVswXTtcbiAgICAgIHZhciB5MSA9IHkgKyBvZmZzZXRzW2pdWzFdO1xuXG4gICAgICAvLyBpZiBpcyBwcmV2aW91cyBsb2NhdGlvbiwgbGFuZCBvciBub3QgYW4gZWRnZVxuICAgICAgaWYgKCh4MSA9PSBweCAmJiB5MSA9PSBweSkgfHwgIXRoaXMuZ3JvdW5kX3BpeGVsKHgxLCB5MSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIHNldCBuZXcgcG9zaXRpb25cbiAgICAgIHB4ID0geDtcbiAgICAgIHB5ID0geTtcbiAgICAgIHggPSB4MTtcbiAgICAgIHkgPSB5MTtcbiAgICAgIHJlc3VsdC5tb3ZlID0gdHJ1ZTtcbiAgICAgIHJlc3VsdC5hbmdsZSA9IGdldF9oZWFkaW5nKG94LCBveSwgeCwgeSk7XG4gICAgICByZXN1bHQucGF0aC5wdXNoKHsgeDogeDEsIHk6IHkxIH0pO1xuXG4gICAgICB2YXIgbW92ZWQgPSB0cnVlO1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gaWYgbW92ZW1lbnQgZmFpbGVkXG4gICAgaWYgKCFtb3ZlZCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgLy8gc2V0IGRpcmVjdGlvbiBsZWZ0IG9yIHJpZ2h0XG4gIHJlc3VsdC5kaXJlY3Rpb24gPSB0aGlzLmdyb3VuZF9kaXIob3gsIG95LCB4LCB5KTtcblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuLyogQ2hlY2sgYSBwaXhlbCBpcyBuZXh0IHRvIGdyb3VuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5ncm91bmRfcGl4ZWwgPSBmdW5jdGlvbih4LCB5KSB7XG4gIC8vIGlmIHdlIGhhdmUgaGl0IGdyb3VuZFxuICBpZiAodGhpcy5pKHgsIHkpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIHRyaWdnZXIgPSBmYWxzZSxcbiAgICBvZmYgPSBbXG4gICAgICBbMCwgLTFdLFxuICAgICAgWy0xLCAwXSxcbiAgICAgIFsxLCAwXSxcbiAgICAgIFswLCAxXSxcbiAgICAgIFstMSwgLTFdLFxuICAgICAgWy0xLCAxXSxcbiAgICAgIFsxLCAxXSxcbiAgICAgIFsxLCAtMV1cbiAgICBdO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgb2ZmLmxlbmd0aDsgaSsrKSB7XG4gICAgLy8gZ28gdGhyb3VnaCBvZmZzZXRzXG4gICAgdmFyIHgxID0geCArIG9mZltpXVswXTsgLy8gbmV3IHggY29vcmRpbmF0ZVxuICAgIHZhciB5MSA9IHkgKyBvZmZbaV1bMV07IC8vIG5ldyB5IGNvb3JkaW5hdGVcbiAgICBpZiAodGhpcy5pKHgxLCB5MSkpIHtcbiAgICAgIC8vIGlmIHBpeGVsIGlzIGxhbmRcbiAgICAgIHRyaWdnZXIgPSB0cnVlOyAvLyB3ZSBkaWQgaXRcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cmlnZ2VyO1xufTtcblxuLyogQ2FsY3VsYXRlIGxlZnQgb3IgcmlnaHQgbW92ZW1lbnRcblx0Ly9cblx0Ly8gY2FsY3VsYXRlcyBkaXJlY3Rpb24gb2YgbGFuZCBmcm9tIGEgbGluZSBvZiBtb3ZlbWVudFxuXHQvLyAxLiByb3RhdGUgbGluZSBjb29yZHMgOTAgZGVncmVlc1xuXHQvLyAyLiBpZiB0aGUgdG9wIHBhcnQgb2YgdGhlIG5ldyBsaW5lIGhhcyBtb3JlIGxhbmQgdGhlbiB3ZSBhcmUgbW92aW5nIHJpZ2h0XG5cdC8vIDMuIGlmIHRoZSBib3R0b20gcGFydCB3ZSBhcmUgbW92aW5nIGxlZnRcblx0Ly8gNC4gYmFuYW5hcywgYWxsIG9mIGl0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdyb3VuZF9kaXIgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5Mikge1xuICAvLyByb3RhdGUgY28tb3JkaW5hdGVkIDkwIGRlZ3JlZXMgdG8gcG9pbnQgaW50byB0aGUgZ3JvdW5kIHdlJ3JlIG9uXG4gIHZhciBjZW50ZXJfeCA9IHgxICsgKHgyIC0geDEpIC8gMjtcbiAgdmFyIGNlbnRlcl95ID0geTEgKyAoeTIgLSB5MSkgLyAyO1xuICB2YXIgcm90YXRlZF8xID0gcm90YXRlX2Nvb3Jkcyh4MSwgeTEsIGNlbnRlcl94LCBjZW50ZXJfeSwgOTApO1xuICB2YXIgcm90YXRlZF8yID0gcm90YXRlX2Nvb3Jkcyh4MiwgeTIsIGNlbnRlcl94LCBjZW50ZXJfeSwgOTApO1xuXG4gIC8vIHBsb3QgYSBjb3Vyc2Ugb2YgY28tb3JkaW5hdGVzIHRvIGNoZWNrXG4gIHZhciBzcGVlZF94ID0gdGhpcy5nZXRfZGlzdGFuY2VfeChyb3RhdGVkXzEueCwgcm90YXRlZF8yLngpO1xuICB2YXIgc3BlZWRfeSA9IHRoaXMuZ2V0X2Rpc3RhbmNlX3kocm90YXRlZF8xLnksIHJvdGF0ZWRfMi55KTtcbiAgdmFyIHBsb3R0ZWQgPSBwbG90X2NvdXJzZShyb3RhdGVkXzEueCwgcm90YXRlZF8xLnksIHNwZWVkX3gsIHNwZWVkX3ksIDgpO1xuICBpZiAoIXBsb3R0ZWQubW92ZSkge1xuICAgIHJldHVybiBcInJpZ2h0XCI7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGNvdXJzZSBhbmQgY291bnQgd2hpY2ggc2lkZSBoYXMgbW9yZSBsYW5kIG9uIGl0XG4gIHZhciBjb3VudF9sZWZ0ID0gMCxcbiAgICBjb3VudF9yaWdodCA9IDA7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGxvdHRlZC5wb2ludHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcG9pbnQgPSBwbG90dGVkLnBvaW50c1tpXTtcbiAgICBpZiAodGhpcy5pKHJvdW5kKHBvaW50LngpLCByb3VuZChwb2ludC55KSkpIHtcbiAgICAgIGlmIChpIDwgcGxvdHRlZC5wb2ludHMubGVuZ3RoIC8gMikge1xuICAgICAgICBjb3VudF9yaWdodCsrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY291bnRfbGVmdCsrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gY291bnRfbGVmdCA+IGNvdW50X3JpZ2h0ID8gXCJsZWZ0XCIgOiBcInJpZ2h0XCI7XG59O1xuXG4vKiBTZXQgdmFsdWVzIGluIGEgY2lyY2xlIGluIHRoZSBncm91bmQgYXJyYXlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuc2V0X2NpcmNsZSA9IGZ1bmN0aW9uKHgsIHksIHJhZGl1cywgdHlwZSkge1xuICAvLyBnZXQgYm91bmRhcmllc1xuICB2YXIgeDEgPSBtYXgocm91bmQoeCAtIHJhZGl1cyksIDApO1xuICB2YXIgeDIgPSBtaW4ocm91bmQoeCArIHJhZGl1cyksIHRoaXMudyAtIDEpO1xuICB2YXIgeTEgPSBtYXgocm91bmQoeSAtIHJhZGl1cyksIDApO1xuICB2YXIgeTIgPSBtaW4ocm91bmQoeSArIHJhZGl1cyksIHRoaXMuaCAtIDEpO1xuXG4gIC8vIGxvb3AgdGhyb3VnaCBjby1vcmRpbmF0ZXNcbiAgZm9yICh2YXIgbHkgPSB5MTsgbHkgPD0geTI7IGx5KyspIHtcbiAgICBmb3IgKHZhciBseCA9IHgxOyBseCA8PSB4MjsgbHgrKykge1xuICAgICAgaWYgKGluX2NpcmNsZShseCwgbHksIHgsIHksIHJhZGl1cykpIHtcbiAgICAgICAgdGhpcy5pX3NldChseCwgbHksIHR5cGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyogU2V0IGJsb2NrIG9mIGNlbGxzIGZyb20gYXJyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLnNldF9ibG9ja19mcm9tX2FyciA9IGZ1bmN0aW9uKHgsIHksIGFycikge1xuICBmb3IgKHZhciBseSA9IDA7IGx5IDwgYXJyLmxlbmd0aDsgbHkrKykge1xuICAgIGZvciAodmFyIGx4ID0gMDsgbHggPCBhcnJbbHldLmxlbmd0aDsgbHgrKykge1xuICAgICAgdGhpcy5pX3NldCh4ICsgbHgsIHkgKyBseSwgYXJyW2x5XVtseF0pO1xuICAgIH1cbiAgfVxufTtcblxuLyogR2V0IGJsb2NrIG9mIGNlbGxzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9ibG9jayA9IGZ1bmN0aW9uKHgsIHksIHcsIGgpIHtcbiAgdmFyIHJlc3BvbnNlID0gW107XG5cbiAgLy8gbG9vcCB0aHJvdWdoIGNvLW9yZGluYXRlc1xuICBmb3IgKHZhciBseSA9IDA7IGx5IDwgaDsgbHkrKykge1xuICAgIHJlc3BvbnNlW2x5XSA9IFtdO1xuICAgIGZvciAodmFyIGx4ID0gMDsgbHggPCB3OyBseCsrKSB7XG4gICAgICByZXNwb25zZVtseV1bbHhdID0gdGhpcy5pKGx4ICsgeCwgbHkgKyB5KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKiBGaW5kIG5lYXJieSBncm91bmQgc3BvdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5maW5kX2dyb3VuZF9uZWFyYnkgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciB4MSA9IHJvdW5kKHgpO1xuICB2YXIgeTEgPSByb3VuZCh5KTtcblxuICAvLyBhbHJlYWR5IG9uIGdyb3VuZFxuICBpZiAodGhpcy5ncm91bmRfcGl4ZWwoeDEsIHkxKSkge1xuICAgIHJldHVybiB7IHg6IHgxLCB5OiB5MSB9O1xuICB9XG5cbiAgdmFyIHNwaXJhbF8xID0gMDtcbiAgdmFyIHNwaXJhbF8yID0gMTtcbiAgdmFyIGluYyA9IDE7XG4gIHZhciBkaXIgPSB0cnVlO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgNDUwOyBpKyspIHtcbiAgICB4MSArPSBkaXIgPyBpbmMgOiAwO1xuICAgIHkxICs9ICFkaXIgPyBpbmMgOiAwO1xuICAgIHNwaXJhbF8xKys7XG4gICAgaWYgKHNwaXJhbF8xID09IHNwaXJhbF8yKSB7XG4gICAgICBzcGlyYWxfMSA9IDA7XG4gICAgICBpZiAoKGRpciA9ICFkaXIpKSB7XG4gICAgICAgIGluYyA9IGluYyA9PSAxID8gLTEgOiAxO1xuICAgICAgICBzcGlyYWxfMisrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNoZWNrIHBvaW50IGZvciBncm91bmQgcGl4ZWxzXG4gICAgaWYgKHRoaXMuZ3JvdW5kX3BpeGVsKHgxLCB5MSkpIHtcbiAgICAgIHJldHVybiB7IHg6IHgxLCB5OiB5MSB9O1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBHZXQgcmFuZG9tIGVtcHR5IHNwb3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuYWlyX2ZpbmRfc3BvdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbGltaXQgPSA1MDA7XG4gIHZhciBuID0gMDtcblxuICB3aGlsZSAobiA8IGxpbWl0KSB7XG4gICAgdmFyIHggPSByYW5kKDAsIHRoaXMudyksXG4gICAgICB5ID0gcmFuZCgwLCB0aGlzLmgpLFxuICAgICAgaWQgPSB0aGlzLmkoeCwgeSk7XG5cbiAgICAvLyBpZiBhaXIgcGl4ZWxcbiAgICBpZiAoaWQgPT0gMCkge1xuICAgICAgcmV0dXJuIHsgeDogeCwgeTogeSB9O1xuICAgIH1cblxuICAgIC8vIGNvdW50IHVwXG4gICAgbisrO1xuICB9XG5cbiAgLy8gZmFpbGVkIHRvIGZpbmQgYSBzcG90XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qIEdldCByYW5kb20gZ3JvdW5kIHNwb3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3JvdW5kX2ZpbmRfc3BvdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbGltaXQgPSA1MDA7XG4gIHZhciBuID0gMDtcblxuICB3aGlsZSAobiA8IGxpbWl0KSB7XG4gICAgdmFyIHggPSByYW5kKDAsIHRoaXMudyksXG4gICAgICB5ID0gcmFuZCgwLCB0aGlzLmgpLFxuICAgICAgaWQgPSB0aGlzLmkoeCwgeSk7XG5cbiAgICAvLyBpZiBub3QgbGFuZCBwaXhlbFxuICAgIGlmIChpZCAhPT0gMSAmJiBpZCAhPT0gMikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gcGxvdCBjb3Vyc2UgdG8gcmFuZG9tIGFuZ2xlXG4gICAgdmFyIGFuZ2xlID0gcmFuZCgwLCAzNjApO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTAwOyBpKyspIHt9XG5cbiAgICAvLyBjb3VudCB1cFxuICAgIG4rKztcbiAgfVxuXG4gIC8vIGZhaWxlZCB0byBmaW5kIGEgc3BvdFxuICByZXR1cm4gZmFsc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTWFwXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLy8gY3JlYXRlIG1hcCBvYmplY3RcbmZ1bmN0aW9uIGNvcmVfbWFwKGNhbnYsIHNjaGVtZSwgZ3Jhdml0eV9tYXApIHtcbiAgLy8gU2VydmVyIHNpZGUgb25seVxuICBpZiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgZ2xvYmFsKSB7XG4gICAgdmFyIGNhbnZhcyA9IHJlcXVpcmUoXCJjYW52YXNcIik7XG4gIH1cblxuICB0aGlzLnNjaGVtZSA9IHNjaGVtZTtcblxuICAvLyBzZXQgZGltZW5zaW9uc1xuICB0aGlzLncgPSBjYW52LmNhbnYud2lkdGg7XG4gIHRoaXMuaCA9IGNhbnYuY2Fudi5oZWlnaHQ7XG5cbiAgLy8gZ2V0IHBpeGVsc1xuICB2YXIgcGl4ZWxzID0gY2Fudi5jb250LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLncsIHRoaXMuaCk7XG4gIHZhciBsZW5ndGggPSBNYXRoLmZsb29yKHBpeGVscy5kYXRhLmxlbmd0aCAvIDQpO1xuXG4gIC8vIGNyZWF0ZSA4IGJpdCBhbHBoYSBhcnJheVxuICAvLyAwLiBhaXJcbiAgLy8gMS4gZGVzdHJ1Y3RpYmxlIGxhbmRcbiAgLy8gMi4gaW5kZXN0cnVjdGlibGUgbGFuZFxuICAvLyAzLiBzdW5cbiAgdGhpcy5hcnIgPSBuZXcgSW50OEFycmF5KGxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocGl4ZWxzLmRhdGFbaSAqIDQgKyAzXSA+IDMwKSB7XG4gICAgICB0aGlzLmFycltpXSA9IDE7XG4gICAgfVxuICB9XG5cbiAgLy8gc2V0IHVwIGdyYXZpdHlcbiAgdGhpcy5pbml0X2dyYXZpdHkoZ3Jhdml0eV9tYXApO1xufVxuXG4vKiBHZXQgYW5kIHNldCBhcnJheSBjby1vcmRpbmF0ZSB2YWx1ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuaV9nZXQgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciB4MiA9IHRoaXMubG9vcF94KHgpO1xuICB2YXIgeTIgPSB0aGlzLmxvb3BfeSh5KTtcbiAgcmV0dXJuIHkyICogdGhpcy53ICsgeDI7XG59O1xuXG5jb3JlX21hcC5wcm90b3R5cGUuaSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgdmFyIGkgPSB0aGlzLmlfZ2V0KHgsIHkpO1xuICBpZiAoaSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMuYXJyW2ldO1xuICB9XG59O1xuXG5jb3JlX21hcC5wcm90b3R5cGUuaV9zZXQgPSBmdW5jdGlvbih4LCB5LCB2YWwpIHtcbiAgdmFyIGkgPSB0aGlzLmlfZ2V0KHgsIHkpO1xuICBpZiAoaSkge1xuICAgIHRoaXMuYXJyW2ldID0gdmFsO1xuICB9XG59O1xuXG4vKiBHZXQgZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzIGluIGxvb3BpbmcgYXJlYVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZGlzdGFuY2UgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5Mikge1xuICB2YXIgeCA9IHRoaXMuZ2V0X2Rpc3RhbmNlX3goeDEsIHgyKTtcbiAgdmFyIHkgPSB0aGlzLmdldF9kaXN0YW5jZV95KHkxLCB5Mik7XG4gIHJldHVybiBnZXRfc3BlZWQoeCwgeSk7XG59O1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2Rpc3RhbmNlX3ggPSBmdW5jdGlvbih4MSwgeDIpIHtcbiAgcmV0dXJuIG5fZGlmZih4MSwgeDIsIDAsIHRoaXMudyk7XG59O1xuY29yZV9tYXAucHJvdG90eXBlLmdldF9kaXN0YW5jZV95ID0gZnVuY3Rpb24oeTEsIHkyKSB7XG4gIHJldHVybiBuX2RpZmYoeTEsIHkyLCAwLCB0aGlzLmgpO1xufTtcblxuLyogR2V0IGhlYWRpbmcgYmV0d2VlbiB0d28gcG9pbnRzIGluIGxvb3BpbmcgYXJlYVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfaGVhZGluZyA9IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyKSB7XG4gIHZhciB4ID0gbl9kaWZmKHgxLCB4MiwgMCwgdGhpcy53KTtcbiAgdmFyIHkgPSBuX2RpZmYoeTEsIHkyLCAwLCB0aGlzLmgpO1xuICByZXR1cm4gZ2V0X2FuZ2xlKHgsIHkpO1xufTtcblxuLyogR2V0IGxvb3BpbmcgY28tb3JkaW5hdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUubG9vcF94ID0gZnVuY3Rpb24oeCkge1xuICByZXR1cm4gbl9sb29wKHgsIDAsIHRoaXMudyAtIDEpO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmxvb3BfeSA9IGZ1bmN0aW9uKHkpIHtcbiAgcmV0dXJuIG5fbG9vcCh5LCAwLCB0aGlzLmggLSAxKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5jb25zdCBzaGFyZUxpbmtzVGV4dCA9XG4gIFwiPGRpdiBjbGFzcz0nbGlua3MnPjxhIHRhcmdldD0nX2JsYW5rJyBjbGFzcz0nZmIgYmFsbCcgaHJlZj0naHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3NoYXJlci9zaGFyZXIucGhwP3U9aHR0cDovL3Byb2plY3RhbnRzLmNvbScgdGl0bGU9J1NoYXJlIG9uIEZhY2Vib29rJz48aW1nIHNyYz0nXCIgK1xuICBBU1NFVFMgK1xuICBcIi9pbWFnZXMvZmFjZWJvb2sucG5nJyBhbHQ9Jyc+PC9hPjxhIHRhcmdldD0nX2JsYW5rJyBjbGFzcz0ndHdpdHRlciBiYWxsJyBocmVmPSdodHRwczovL3R3aXR0ZXIuY29tL2ludGVudC90d2VldD9zdGF0dXM9Q29tZSUyMGFuZCUyMHBsYXklMjBodHRwJTNBJTJGJTJGcHJvamVjdGFudHMuY29tJTIwJTIzcHJvamVjdGFudHMnIHRpdGxlPSdTaGFyZSBvbiBUd2l0dGVyJz48aW1nIHNyYz0nXCIgK1xuICBBU1NFVFMgK1xuICBcIi9pbWFnZXMvdHdpdHRlci5wbmcnIGFsdD0nJz48L2E+PGJyLz48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0nbWFpbHRvOnByb2plY3RhbnRzZ2FtZUBnbWFpbC5jb20nPkNvbnRhY3Q8L2E+IHwgPGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vd3d3LnBheXBhbC5jb20vY2dpLWJpbi93ZWJzY3I/Y21kPV9kb25hdGlvbnMmYnVzaW5lc3M9cHJvamVjdGFudHNnYW1lQGdtYWlsLmNvbSZsYz1VSyZpdGVtX25hbWU9S2VlcGluZyt0aGUrYW50cythdCtiYXkhJm5vX25vdGU9MCZub19zaGlwcGluZz0yJmN1cmVuY3lfY29kZT1HQlAmYm49UFAtRG9uYXRpb25zQkY6YnRuX2RvbmF0ZUNDX0xHLmdpZjpOb25Ib3N0ZWQnPkRvbmF0ZTwvYT48L2Rpdj5cIjtcblxuY29uc3QgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24pO1xuY29uc3Qgd2F0Y2ggPSAhIXVybC5zZWFyY2hQYXJhbXMuZ2V0KFwid2F0Y2hcIik7XG5cbmZ1bmN0aW9uIGFwcCgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmFzc2V0c191cmwgPSBBU1NFVFM7XG4gIHRoaXMuYXNzZXRzID0ge307XG4gIHRoaXMuc3RhcnRlZCA9IGZhbHNlO1xuICB0aGlzLndhdGNoID0gd2F0Y2g7XG4gIHRoaXMubmlja25hbWUgPSBcInRoZSB3YXRjaGVyXCI7XG5cbiAgdGhpcy5zb2NrZXRzID0gbmV3IFNvY2tldENvbm5lY3Rpb24oZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBzZWxmLnJ1bl9ldmVudChldmVudCk7XG4gIH0pO1xuICB0aGlzLmluaXRfaW50ZXJmYWNlKCk7XG5cbiAgdGhpcy5pbnB1dCA9IG5ldyBpbnB1dChmdW5jdGlvbihldmVudCkge1xuICAgIHNlbGYucnVuX2V2ZW50KGV2ZW50KTtcbiAgfSk7XG4gIHRoaXMuYXVkaW8gPSBuZXcgYXVkaW8oKTtcblxuICB0aGlzLmluaXRfc2V0dGluZ3MoKTtcblxuICBpZiAodGhpcy53YXRjaCkge1xuICAgIHRoaXMubG9hZF9yb29tKCk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5pbml0X3N0YXJ0KCk7XG4gIH1cbn1cblxuLyogTG9hZCByb29tXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hcHAucHJvdG90eXBlLmxvYWRfcm9vbSA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5zdGFydCkge1xuICAgIGhpZGUodGhpcy5zdGFydCk7XG4gIH1cbiAgc2hvdyh0aGlzLmxvYWRpbmcpO1xuXG4gIC8vIGxvYWQgYXNzZXRzXG4gIHZhciBzZWxmID0gdGhpcztcbiAgbmV3IGxvYWRlcihcbiAgICB0aGlzLmFzc2V0c191cmwsXG4gICAge1xuICAgICAgaW1nOiB7XG4gICAgICAgIHNwcml0ZXM6IFwiL2ltYWdlcy9zcHJpdGVzL3Nwcml0ZXMucG5nXCIsXG4gICAgICAgIGJnOiBcIi9pbWFnZXMvdGV4dHVyZXMvc3BhY2UuanBnXCJcbiAgICAgIH0sXG4gICAgICBhdWRpbzoge1xuICAgICAgICBibGVlcDE6IFwiL2F1ZGlvL2JsZWVwMS5tcDNcIixcbiAgICAgICAgYmxvb3AxOiBcIi9hdWRpby9ibG9vcDEubXAzXCIsXG4gICAgICAgIGJsb29wMjogXCIvYXVkaW8vYmxvb3AyLm1wM1wiLFxuICAgICAgICBiaW5nOiBcIi9hdWRpby9iaW5nLm1wM1wiLFxuICAgICAgICBkaWc6IFwiL2F1ZGlvL2RpZy5tcDNcIixcbiAgICAgICAgZG9pbms6IFwiL2F1ZGlvL2RvaW5rLm1wM1wiLFxuICAgICAgICBkb25rOiBcIi9hdWRpby9kb25rLm1wM1wiLFxuICAgICAgICBleHBsb3Npb246IFwiL2F1ZGlvL2V4cGxvc2lvbi5tcDNcIixcbiAgICAgICAgZXhwbG9zaW9uX2dhczogXCIvYXVkaW8vZXhwbG9zaW9uX2dhcy5tcDNcIixcbiAgICAgICAgZXhwbG9zaW9uX2xhc2VyOiBcIi9hdWRpby9leHBsb3Npb25fbGFzZXIubXAzXCIsXG4gICAgICAgIGhvbWluZzogXCIvYXVkaW8vaG9taW5nLm1wM1wiLFxuICAgICAgICBmbHk6IFwiL2F1ZGlvL2ZseS5tcDNcIixcbiAgICAgICAgY291bnRkb3duOiBcIi9hdWRpby9jb3VudGRvd24ubXAzXCIsXG4gICAgICAgIGp1bXA6IFwiL2F1ZGlvL2p1bXAubXAzXCIsXG4gICAgICAgIGxldmVsdXA6IFwiL2F1ZGlvL2xldmVsdXAubXAzXCIsXG4gICAgICAgIGxvY2tubG9hZDogXCIvYXVkaW8vbG9ja25sb2FkLm1wM1wiLFxuICAgICAgICBwaGFzZTogXCIvYXVkaW8vcGhhc2UubXAzXCIsXG4gICAgICAgIHBvcDogXCIvYXVkaW8vcG9wLm1wM1wiLFxuICAgICAgICBwdW5jaDogXCIvYXVkaW8vcHVuY2gubXAzXCIsXG4gICAgICAgIHNob290OiBcIi9hdWRpby9zaG9vdC5tcDNcIixcbiAgICAgICAgc2hvb3RfbGFzZXI6IFwiL2F1ZGlvL3Nob290X2xhc2VyLm1wM1wiLFxuICAgICAgICB0aHJvdzogXCIvYXVkaW8vdGhyb3cubXAzXCIsXG4gICAgICAgIHNwb29reTogXCIvYXVkaW8vc3Bvb2t5Lm1wM1wiLFxuICAgICAgICB3YWxrOiBcIi9hdWRpby93YWxrLm1wM1wiXG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbihhc3NldHMpIHtcbiAgICAgIHNlbGYuaW5pdF9yb29tKGFzc2V0cyk7XG4gICAgfVxuICApO1xufTtcblxuLyogU3RhcnQgdGhlIGFwcFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXBwLnByb3RvdHlwZS5pbml0X3Jvb20gPSBmdW5jdGlvbihhc3NldHMpIHtcbiAgaGlkZSh0aGlzLmxvYWRpbmcpO1xuXG4gIHRoaXMuc3RhcnRlZCA9IHRydWU7XG4gIHRoaXMuYXNzZXRzID0gYXNzZXRzO1xuICB0aGlzLmF1ZGlvLmFkZF9idWZmZXJzKGFzc2V0cy5hdWRpbyk7XG5cbiAgdGhpcy5yb29tID0gbmV3IG11bHRpcGxheWVyKFxuICAgIHRoaXMuYXNzZXRzLFxuICAgIHRoaXMuYXNzZXRzX3VybCxcbiAgICB0aGlzLmF1ZGlvLFxuICAgIHRoaXMuaW5wdXQsXG4gICAgdGhpcy5uaWNrbmFtZSxcbiAgICB0aGlzLndhdGNoLFxuICAgIHRoaXMucnVuX2V2ZW50LFxuICAgIHRoaXMuc29ja2V0cyxcbiAgICBuZXcgb25ib2FyZGluZygpXG4gICk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5yb29tLmRpdik7XG5cbiAgaWYgKHRoaXMud2F0Y2gpIHtcbiAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwid2F0Y2hlclwiLCBbXSk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5uaWNrbmFtZSA9IHRoaXMuY2hlY2tfbmFtZSh0aGlzLm5pY2tuYW1lKTtcbiAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwic2VuZF9uYW1lXCIsIFt0aGlzLm5pY2tuYW1lXSk7XG4gIH1cbn07XG5cbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgbmV3IGFwcCgpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFwcFxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEV2ZW50c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXBwLnByb3RvdHlwZS5ydW5fZXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudChldmVudFtpXSk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNob3cgYW5kIGhpZGUgbWVudVxuICBpZiAoZXZlbnQudHlwZSA9PSBcInNob3dfbWVudVwiKSB7XG4gICAgc2hvdyh0aGlzLm1lbnUpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT0gXCJoaWRlX21lbnVcIikge1xuICAgIGhpZGUodGhpcy5tZW51KTtcblxuICAgIC8vIGlmIGdhbWUgaXMgZnVsbFxuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZnVsbFwiKSB7XG4gICAgaGlkZSh0aGlzLmxvYWRpbmcpO1xuICAgIHNob3codGhpcy5nYW1lX2Z1bGwpO1xuICAgIGlmICh0aGlzLnJvb20gJiYgdGhpcy5yb29tLmNvbm5lY3RpbmcpIHtcbiAgICAgIGhpZGUodGhpcy5yb29tLmNvbm5lY3RpbmcpO1xuICAgIH1cblxuICAgIC8vIHNob3cgdGhlIGNvbnRyb2xzIHNjcmVlblxuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT0gXCJzaG93X3NldHRpbmdzXCIpIHtcbiAgICB0aGlzLnRvZ2dsZV9zZXR0aW5nc19zY3JlZW4oKTtcblxuICAgIC8vIHNlbmQgZXZlbnQgZG93biBhIGxldmVsXG4gIH0gZWxzZSB7XG4gICAgaWYgKHRoaXMucm9vbSkge1xuICAgICAgdGhpcy5yb29tLnJ1bl9ldmVudChldmVudCk7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwIEludGVyZmFjZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9pbnRlcmZhY2UgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5kaXYgPSBlbGVtZW50KHsgaWQ6IFwicHJvamVjdGFudHNcIiwgY2xhc3M6IFwiYXBwXCIgfSk7XG4gIGFwcGVuZChkb2N1bWVudC5ib2R5LCB0aGlzLmRpdik7XG5cbiAgLy8gZ2FtZSBmdWxsXG4gIHRoaXMuZ2FtZV9mdWxsID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OiBcIk9oIGRlYXIsIHRoaXMgcm9vbSBpcyB2ZXJ5IGZ1bGwhPGJyPjxicj48YnI+PC9kaXY+XCJcbiAgfSk7XG4gIHRoaXMuYnV0dG9uX25ld19nYW1lID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJidXR0b25cIixcbiAgICBjbGFzczogXCJidXR0b24gcmVkXCIsXG4gICAgdGV4dDogXCJGaW5kIEEgTmV3IE9uZVwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZ2FtZV9mdWxsKTtcbiAgYXBwZW5kKHRoaXMuZ2FtZV9mdWxsLCB0aGlzLmJ1dHRvbl9uZXdfZ2FtZSk7XG4gIGhpZGUodGhpcy5nYW1lX2Z1bGwpO1xuXG4gIC8vIGZpbmQgbmV3IHJvb21cbiAgdGhpcy5idXR0b25fbmV3X2dhbWUub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL1wiO1xuICB9O1xuXG4gIC8vIGxpbWl0IGdhbWUgYXNwZWN0IHJhdGlvXG4gIHZhciByYXRpbyA9IHRoaXMuZGl2Lm9mZnNldFdpZHRoIC8gdGhpcy5kaXYub2Zmc2V0SGVpZ2h0O1xuICB0aGlzLmRpdi5zdHlsZS53aWR0aCA9XG4gICAgcmF0aW8gPiAxLjhcbiAgICAgID8gcm91bmQodGhpcy5kaXYub2Zmc2V0SGVpZ2h0ICogMS44KSArIFwicHhcIlxuICAgICAgOiB0aGlzLmRpdi5vZmZzZXRXaWR0aCArIFwicHhcIjtcbiAgdGhpcy5kaXYuc3R5bGUuaGVpZ2h0ID1cbiAgICByYXRpbyA8IDEgPyB0aGlzLmRpdi5vZmZzZXRXaWR0aCArIFwicHhcIiA6IHRoaXMuZGl2Lm9mZnNldEhlaWdodCArIFwicHhcIjtcblxuICAvLyBsb2FkaW5nXG4gIHRoaXMubG9hZGluZyA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJMb2FkaW5nLi4uPGJyPjxicj48ZGl2IGNsYXNzPSdsb2FkZXInPjwvZGl2PlwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMubG9hZGluZyk7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiAgICBTZXR0aW5nc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFN0YXJ0IHNldHRpbmdzIHNjcmVlblxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXBwLnByb3RvdHlwZS5pbml0X3NldHRpbmdzID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBjb3JuZXIgYnV0dG9uXG4gIHRoaXMuaWNvbl9zZXR0aW5ncyA9IGVsZW1lbnQoeyBjbGFzczogXCJzZXR0aW5nc1wiIH0pO1xuICB0aGlzLmljb25fc2V0dGluZ3NfaW1nID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJpbWdcIixcbiAgICBzcmM6IHRoaXMuYXNzZXRzX3VybCArIFwiL2ltYWdlcy9jb2cucG5nXCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5pY29uX3NldHRpbmdzKTtcbiAgYXBwZW5kKHRoaXMuaWNvbl9zZXR0aW5ncywgdGhpcy5pY29uX3NldHRpbmdzX2ltZyk7XG5cbiAgdGhpcy5zZXR0aW5nc192aXNpYmxlID0gZmFsc2U7XG4gIHRoaXMuaWNvbl9zZXR0aW5ncy5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi50b2dnbGVfc2V0dGluZ3Nfc2NyZWVuKCk7XG4gIH07XG5cbiAgLy8gYm94XG4gIHRoaXMuZGl2X3NldHRpbmdzID0gZWxlbWVudCh7IGNsYXNzOiBcImZ1bGwgZnVsbF9iZ1wiIH0pO1xuICB0aGlzLmRpdl9zZXR0aW5nc19jb250ID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXIgZGl2X2NvbnRyb2xzXCIsXG4gICAgdGV4dDogXCI8ZGl2IGNsYXNzPSd0b3BfbWVzc2FnZSc+U2V0dGluZ3M8L2Rpdj5cIiArIHNoYXJlTGlua3NUZXh0XG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3NldHRpbmdzKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzLCB0aGlzLmRpdl9zZXR0aW5nc19jb250KTtcbiAgaGlkZSh0aGlzLmRpdl9zZXR0aW5ncyk7XG5cbiAgLy8gdm9sdW1lXG4gIHRoaXMuZGl2X3ZvbHVtZSA9IGVsZW1lbnQoeyB0ZXh0OiBcIjxoMj5Wb2x1bWU8L2gyPlwiIH0pO1xuICB0aGlzLmlucHV0X3ZvbHVtZSA9IGVsZW1lbnQoeyB0eXBlOiBcImlucHV0XCIgfSk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lLnR5cGUgPSBcInJhbmdlXCI7XG4gIHRoaXMuaW5wdXRfdm9sdW1lLnNldEF0dHJpYnV0ZShcIm1pblwiLCAwKTtcbiAgdGhpcy5pbnB1dF92b2x1bWUuc2V0QXR0cmlidXRlKFwibWF4XCIsIDEpO1xuICB0aGlzLmlucHV0X3ZvbHVtZS5zZXRBdHRyaWJ1dGUoXCJzdGVwXCIsIDAuMSk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lLnZhbHVlID0gdGhpcy5hdWRpby52b2x1bWU7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19jb250LCB0aGlzLmRpdl92b2x1bWUpO1xuICBhcHBlbmQodGhpcy5kaXZfdm9sdW1lLCB0aGlzLmlucHV0X3ZvbHVtZSk7XG5cbiAgdGhpcy5pbnB1dF92b2x1bWUub25jaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4gICAgc2VsZi5hdWRpby5zZXRfZ2xvYmFsX3ZvbHVtZSh0aGlzLnZhbHVlKTtcbiAgfTtcblxuICAvLyBjb250cm9sc1xuICB2YXIgY3RleHQgPSBcIjxoMj5Db250cm9sczwvaDI+XCI7XG4gIGN0ZXh0ICs9IFwiPGRsPlwiO1xuICBjdGV4dCArPSBcIjxkdD5Nb3ZlPC9kdD48ZGQ+V0FTRCAvIEFycm93IEtleXMgLyBSaWdodCBDbGljazwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0Pkp1bXA8L2R0PjxkZD5TcGFjZWJhcjwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PlNob290PC9kdD48ZGQ+TGVmdCBDbGljayAvIFNoaWZ0PC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+U2VsZWN0IFdlYXBvbjwvZHQ+PGRkPjEtOSAvIFNjcm9sbCBXaGVlbDwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PkZvbGxvdyBXZWFwb25zPC9kdD48ZGQ+RjwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PkZyZWUgQ2FtPC9kdD48ZGQ+TWlkZGxlIENsaWNrPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8L2RsPlwiO1xuICB0aGlzLmRpdl9jb250cm9scyA9IGVsZW1lbnQoeyB0ZXh0OiBjdGV4dCB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2NvbnQsIHRoaXMuZGl2X2NvbnRyb2xzKTtcblxuICAvLyBzZXJ2ZXJcbiAgdGhpcy5kaXZfc2VydmVyID0gZWxlbWVudCh7XG4gICAgdGV4dDpcbiAgICAgIFwiPGgyPlNlcnZlcjwvaDI+PHA+PGEgaHJlZj0naHR0cDovL3VrLnByb2plY3RhbnRzLmNvbS8nPlVLPC9hPiB8IDxhIGhyZWY9J2h0dHA6Ly91cy5wcm9qZWN0YW50cy5jb20vJz5VUzwvYT48L3A+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19jb250LCB0aGlzLmRpdl9zZXJ2ZXIpO1xuXG4gIC8vIGNsb3NlIGJ1dHRvblxuICB0aGlzLmRpdl9zZXR0aW5nc19idXR0b25zID0gZWxlbWVudCh7IGNsYXNzOiBcImJ1dHRvbnNcIiB9KTtcbiAgdGhpcy5idXR0b25fY2xvc2Vfc2V0dGluZ3MgPSBlbGVtZW50KHsgdHlwZTogXCJidXR0b25cIiwgdGV4dDogXCJDbG9zZVwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3NfY29udCwgdGhpcy5kaXZfc2V0dGluZ3NfYnV0dG9ucyk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19idXR0b25zLCB0aGlzLmJ1dHRvbl9jbG9zZV9zZXR0aW5ncyk7XG5cbiAgdGhpcy5idXR0b25fY2xvc2Vfc2V0dGluZ3Mub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuc2V0dGluZ3NfdmlzaWJsZSA9IGZhbHNlO1xuICAgIGhpZGUoc2VsZi5kaXZfc2V0dGluZ3MpO1xuICB9O1xufTtcblxuYXBwLnByb3RvdHlwZS50b2dnbGVfc2V0dGluZ3Nfc2NyZWVuID0gZnVuY3Rpb24oKSB7XG4gIGlmICgodGhpcy5zZXR0aW5nc192aXNpYmxlID0gIXRoaXMuc2V0dGluZ3NfdmlzaWJsZSkpIHtcbiAgICB0aGlzLmF1ZGlvLnBsYXkoXCJibGVlcDFcIiwgMC44KTtcbiAgICBzaG93KHRoaXMuZGl2X3NldHRpbmdzKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlKHRoaXMuZGl2X3NldHRpbmdzKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFwcFxuICAgIFN0YXJ0IFNjcmVlblxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9zdGFydCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgLy8gZ2V0IGEgbmV3IG9yIHN0b3JlZCBuaWNrbmFtZVxuICB0aGlzLm5pY2tuYW1lID0gY29uZmlnLm5hbWVzW3JhbmQoMCwgY29uZmlnLm5hbWVzLmxlbmd0aCAtIDEpXTtcbiAgaWYgKHR5cGVvZiBTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgdmFyIGxzbmFtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicGFudHNfbm5cIik7XG4gICAgaWYgKGNvbmZpZy5uYW1lcy5pbmRleE9mKGxzbmFtZSkgPT09IC0xKSB7XG4gICAgICB0aGlzLm5pY2tuYW1lID0gbHNuYW1lIHx8IHRoaXMubmlja25hbWU7XG4gICAgfVxuICB9XG5cbiAgdGhpcy5zdGFydCA9IGVsZW1lbnQoeyBjbGFzczogXCJzdGFydFwiIH0pO1xuICB2YXIgbG9nbyA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiaW1nXCIsXG4gICAgY2xhc3M6IFwibG9nb1wiLFxuICAgIHNyYzogdGhpcy5hc3NldHNfdXJsICsgXCIvaW1hZ2VzL2xvZ28ucG5nXCJcbiAgfSk7XG4gIHZhciBpbnN0cnVjdGlvbnMgPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcInVsXCIsXG4gICAgY2xhc3M6IFwiZmFkZVwiLFxuICAgIHRleHQ6XG4gICAgICBcIjxsaT5Db2xsZWN0IGdlbXMgdG8gZ2V0IHN0cm9uZ2VyPC9saT48bGk+RGVzdHJveSB0aGUgZW5lbXkgdG8gZ2V0IHRoZWlyIGdlbXMhPC9saT48bGk+V0FTRCBvciBSaWdodCBDbGljayB0byBNb3ZlPC9saT48bGk+TGVmdCBDbGljayBvciBTaGlmdCB0byBTaG9vdDwvbGk+XCJcbiAgfSk7XG4gIHRoaXMuaW5wdXRfbmFtZSA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiaW5wdXRcIixcbiAgICBpbnR5cGU6IFwidGV4dFwiLFxuICAgIHZhbHVlOiB0aGlzLm5pY2tuYW1lLFxuICAgIG1heGxlbmd0aDogMjBcbiAgfSk7XG4gIHRoaXMuYnV0dG9uX3N0YXJ0ID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJidXR0b25cIixcbiAgICBjbGFzczogXCJicmVha1wiLFxuICAgIHRleHQ6IFwiUGxheSBOb3dcIlxuICB9KTtcblxuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuc3RhcnQpO1xuICBhcHBlbmQodGhpcy5zdGFydCwgbG9nbyk7XG4gIGFwcGVuZCh0aGlzLnN0YXJ0LCBpbnN0cnVjdGlvbnMpO1xuICBhcHBlbmQodGhpcy5zdGFydCwgdGhpcy5pbnB1dF9uYW1lKTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIHRoaXMuYnV0dG9uX3N0YXJ0KTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIGVsZW1lbnQoeyB0ZXh0OiBzaGFyZUxpbmtzVGV4dCB9KSk7XG5cbiAgLy8gc3RhcnQgdXAgdGhlIGFwcFxuICB0aGlzLmJ1dHRvbl9zdGFydC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5sb2FkX3Jvb20oKTtcbiAgfTtcbn07XG5cbi8qIENoZWNrIG5hbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuY2hlY2tfbmFtZSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbmV3X25hbWUgPSB0aGlzLm5pY2tuYW1lO1xuICBpZiAodGhpcy5pbnB1dF9uYW1lKSB7XG4gICAgbmV3X25hbWUgPSB0aGlzLmlucHV0X25hbWUudmFsdWU7XG4gIH1cbiAgbmV3X25hbWUgPSBuZXdfbmFtZS5sZW5ndGggPiAyMCA/IG5ld19uYW1lLnN1YnN0cmluZygwLCAyMCkgOiBuZXdfbmFtZTtcbiAgaWYgKHR5cGVvZiBTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJwYW50c19ublwiLCBuZXdfbmFtZSk7XG4gIH1cbiAgcmV0dXJuIG5ld19uYW1lO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBBbGVydCBNZXNzYWdlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBhbGVydCBkaXZcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfYWxlcnQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5kaXZfYWxlcnQgPSBlbGVtZW50KHsgY2xhc3M6IFwiYWxlcnRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9hbGVydCk7XG4gIHRoaXMuYWxlcnRfdGV4dCA9IFwiXCI7XG4gIHRoaXMuYWxlcnRfY291bnQgPSAwO1xufTtcblxuLyogU2V0IGFsZXJ0XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfYWxlcnQgPSBmdW5jdGlvbih0ZXh0LCBjb2wsIGNvdW50KSB7XG4gIHRoaXMuYWxlcnRfY291bnQgPSBjb3VudCB8fCA2MDtcbiAgdGhpcy5kaXZfYWxlcnQuY2xhc3NOYW1lID0gXCJhbGVydFwiO1xuICB0aGlzLmRpdl9hbGVydC5pbm5lckhUTUwgPSB0ZXh0O1xuICBpZiAoY29sKSB7XG4gICAgYWRkX2NsYXNzKHRoaXMuZGl2X2FsZXJ0LCBjb2wpO1xuICB9XG4gIHNob3codGhpcy5kaXZfYWxlcnQpO1xufTtcblxuLyogUnVuIGFsZXJ0XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fYWxlcnQgPSBmdW5jdGlvbigpIHtcbiAgLy8gZG8gY291bnRkb3duc1xuICBpZiAodGhpcy5hbGVydF9jb3VudCA+IDApIHtcbiAgICB0aGlzLmFsZXJ0X2NvdW50LS07XG4gICAgaWYgKHRoaXMuYWxlcnRfY291bnQgPT0gMCkge1xuICAgICAgdGhpcy5kaXZfYWxlcnQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgIGhpZGUodGhpcy5kaXZfYWxlcnQpO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBBcm1vdXJ5XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQnVpbGQgYXJtb3VyeSBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfYXJtb3VyeSA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZWxlY3RlZCB3ZWFwb25cbiAgdGhpcy5jdXJyZW50X3dlYXBvbiA9IFwiXCI7XG5cbiAgLy8gZGV0b25hdGlvbiBjb29sZG93blxuICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPSAwO1xuXG4gIC8vIGNyZWF0ZSBkaXZzXG4gIHRoaXMuYXJtb3VyeSA9IHtcbiAgICBkaXY6IGVsZW1lbnQoeyBjbGFzczogXCJhcm1vdXJ5IGJveFwiIH0pLFxuICAgIHRpdGxlOiBlbGVtZW50KHsgY2xhc3M6IFwidGl0bGVcIiB9KSxcbiAgICBwbGF5ZXI6IGVsZW1lbnQoeyBjbGFzczogXCJwbGF5ZXJfd2VhcG9uIGhleC1idXR0b25cIiB9KSxcbiAgICB3ZWFwb25zOiB7fSxcbiAgICBzaG93X2ljb246IGZhbHNlLFxuICAgIHNob3dfaWNvbl9mcmFtZTogbnVsbFxuICB9O1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuYXJtb3VyeS5kaXYpO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuYXJtb3VyeS5wbGF5ZXIpO1xuICBoaWRlKHRoaXMuYXJtb3VyeS5wbGF5ZXIpO1xuXG4gIC8vIGdvIHRocm91Z2ggYXJtb3VyeSBsYXlvdXRcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgdHlwZSA9IHRoaXMuc2NoZW1lLmFybW91cnlbaV07XG5cbiAgICAvLyBjcmVhdGUgZWxlbWVudHNcbiAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXSA9IHtcbiAgICAgIGJveDogZWxlbWVudCh7IGNsYXNzOiBcImhleC1idXR0b24gd2VhcG9uXCIsIGRhdGE6IHR5cGUgfSksXG4gICAgICBzcHJpdGU6IGVsZW1lbnQoeyBjbGFzczogXCJzcHJpdGVcIiB9KSxcbiAgICAgIGNvdW50OiBlbGVtZW50KHsgY2xhc3M6IFwiY291bnRcIiB9KSxcbiAgICAgIHBsYXllcl9pY29uOiBlbGVtZW50KHsgY2xhc3M6IFwiaWNvbiBzcHJpdGVcIiB9KSxcbiAgICAgIGk6IGksXG4gICAgICBhY3RpdmU6IGZhbHNlXG4gICAgfTtcbiAgICBhcHBlbmQodGhpcy5hcm1vdXJ5LmRpdiwgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94KTtcbiAgICBhcHBlbmQodGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94LCB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5zcHJpdGUpO1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gsIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmNvdW50KTtcbiAgICBhcHBlbmQodGhpcy5hcm1vdXJ5LnBsYXllciwgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0ucGxheWVyX2ljb24pO1xuICAgIGhpZGUodGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0ucGxheWVyX2ljb24pO1xuXG4gICAgLy8gc2V0IHNwcml0ZSBiYWNrZ3JvdW5kIHBvc2l0aW9uXG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW3R5cGVdO1xuICAgIHZhciBzcHJpdGUgPSB0aGlzLmMuc3ByaXRlc1t3ZWFwb24uYXJtb3VyeV9zcHJpdGVdO1xuICAgIGlmICghc3ByaXRlKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgdmFyIG9mZnNldCA9IGNlaWwoKHNwcml0ZS5zaXplIC0gNDgpIC8gMik7XG4gICAgdmFyIHggPSAtc3ByaXRlLnggLSBvZmZzZXQ7XG4gICAgdmFyIHkgPSAtc3ByaXRlLnkgLSBvZmZzZXQ7XG4gICAgdmFyIHBvcyA9IHggLSAxICsgXCJweCBcIiArIHkgKyBcInB4LCAwIDBcIjtcbiAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5zcHJpdGUuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gcG9zO1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnBsYXllcl9pY29uLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbiA9IHBvcztcblxuICAgIC8vIHNldCBlbGVtZW50IGV2ZW50c1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLndlYXBvbl9zZWxlY3QodGhpcy5kYXRhc2V0LmRhdGEpO1xuICAgIH07XG4gIH1cblxuICBhcHBlbmQodGhpcy5hcm1vdXJ5LmRpdiwgdGhpcy5hcm1vdXJ5LnRpdGxlKTtcbiAgaGlkZSh0aGlzLmFybW91cnkuZGl2KTtcbn07XG5cbi8qIEluaXRpYWxpc2UgYXJtb3VyeSB3aXRoIGNvcmUgZGF0YVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9hcm1vdXJ5ID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldCBkaXNwbGF5IGZvciBhbGwgd2VhcG9uc1xuICBmb3IgKHR5cGUgaW4gdGhpcy5hcm1vdXJ5LndlYXBvbnMpIHtcbiAgICB0aGlzLnNldF93ZWFwb24odHlwZSk7XG4gIH1cblxuICAvLyBzZWxlY3Qgd2VhcG9uXG4gIGlmIChcbiAgICAhdGhpcy5jdXJyZW50X3dlYXBvbiB8fFxuICAgICF0aGlzLmFybW91cnkud2VhcG9uc1t0aGlzLmN1cnJlbnRfd2VhcG9uXS5hY3RpdmVcbiAgKSB7XG4gICAgdGhpcy53ZWFwb25fc2VsZWN0X24oMCk7XG4gIH1cbn07XG5cbi8qIFNlbGVjdCB3ZWFwb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS53ZWFwb25fc2VsZWN0ID0gZnVuY3Rpb24odHlwZSwgbm9faGlnaGxpZ2h0KSB7XG4gIC8vIGlmIHNhbWUgd2VhcG9uIG9yIG5vbmUgbGVmdFxuICBpZiAoXG4gICAgIXRoaXMucGxheWVyIHx8XG4gICAgdGhpcy5jdXJyZW50X3dlYXBvbiA9PT0gdHlwZSB8fFxuICAgIHRoaXMucGxheWVyLmFybW91cnlbdHlwZV0gPT09IDBcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZG8gdGhlIGNoYW5nZVxuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5hcm1vdXJ5LndlYXBvbnMpIHtcbiAgICByZW1vdmVfY2xhc3ModGhpcy5hcm1vdXJ5LndlYXBvbnNba2V5XS5ib3gsIFwic2VsZWN0ZWRcIik7XG4gICAgaGlkZSh0aGlzLmFybW91cnkud2VhcG9uc1trZXldLnBsYXllcl9pY29uKTtcbiAgfVxuICBhZGRfY2xhc3ModGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94LCBcInNlbGVjdGVkXCIpO1xuICB0aGlzLmN1cnJlbnRfd2VhcG9uID0gdHlwZTtcbiAgdGhpcy5hcm1vdXJ5LnRpdGxlLmlubmVySFRNTCA9IHRoaXMuYy53ZWFwb25zW3R5cGVdLnRpdGxlO1xuXG4gIC8vIGF1dG8gZm9sbG93aW5nIHdlYXBvblxuICB2YXIgd2VwID0gdGhpcy5jLndlYXBvbnNbdHlwZV07XG4gIGlmIChcbiAgICAod2VwLmF1dG9fZm9sbG93ICYmICF0aGlzLndlYXBvbl9mb2xsb3cpIHx8XG4gICAgKCF3ZXAuYXV0b19mb2xsb3cgJiYgdGhpcy53ZWFwb25fZm9sbG93KVxuICApIHtcbiAgICB0aGlzLnRvZ2dsZV93ZWFwb25fZm9sbG93KCk7XG4gIH1cblxuICBpZiAoIW5vX2hpZ2hsaWdodCkge1xuICAgIC8vIHBsYXkgbm9pc2VcbiAgICB0aGlzLmF1ZGlvLnBsYXkoXCJibGVlcDFcIiwgMC44KTtcblxuICAgIC8vIHNob3cgaWNvblxuICAgIHRoaXMuYXJtb3VyeS5zaG93X2ljb24gPSB0cnVlO1xuICAgIHRoaXMuYXJtb3VyeS5zaG93X2ljb25fZnJhbWUgPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgc2hvdyh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5wbGF5ZXJfaWNvbik7XG4gICAgc2hvdyh0aGlzLmFybW91cnkucGxheWVyKTtcbiAgfVxuXG4gIHJldHVybiB0eXBlO1xufTtcblxuLyogU2VsZWN0IHdlYXBvbiBieSBwb3NpdGlvbiBpbiBhcm1vdXJ5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUud2VhcG9uX3NlbGVjdF9uID0gZnVuY3Rpb24obikge1xuICAvLyBpZiBpcyB0b28gYmlnXG4gIGlmIChuID49IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBjb2x1bW5zXG4gIHZhciBuMiA9IDA7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGg7IGkrKykge1xuICAgIHZhciB3ZWFwb24gPSB0aGlzLnNjaGVtZS5hcm1vdXJ5W2ldO1xuICAgIHZhciBhY3RpdmUgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5hcm1vdXJ5LndlYXBvbnNbd2VhcG9uXS5hY3RpdmUpIHtcbiAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgICBpZiAobjIgPT09IG4gJiYgd2VhcG9uICE9PSB0aGlzLmN1cnJlbnRfd2VhcG9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndlYXBvbl9zZWxlY3Qod2VhcG9uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBpbmNyZWFzZSBjb3VudCBvZiBhY3R1YWwgY29sdW1uc1xuICAgIG4yID0gYWN0aXZlID8gbjIgKyAxIDogbjI7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBTZWxlY3Qgd2VhcG9uIGJ5IHNjcm9sbGluZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLndlYXBvbl9zY3JvbGwgPSBmdW5jdGlvbihkb3duKSB7XG4gIC8vIGlmIHdlIGRvbid0IGhhdmUgYSBzZWxlY3RlZCB3ZWFwb25cbiAgdmFyIGN1cnJlbnQgPSB0aGlzLmFybW91cnkud2VhcG9uc1t0aGlzLmN1cnJlbnRfd2VhcG9uXTtcbiAgaWYgKCFjdXJyZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGlfZG93biA9IGRvd24gPyB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aCAtIGkgOiBpO1xuICAgIHZhciBuZXdfaSA9IG5fbG9vcChjdXJyZW50LmkgKyBpX2Rvd24sIC0xLCB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aCAtIDEpO1xuICAgIHZhciB3ZWFwb24gPSB0aGlzLnNjaGVtZS5hcm1vdXJ5W25ld19pXTtcbiAgICBpZiAodGhpcy5hcm1vdXJ5LndlYXBvbnNbd2VhcG9uXS5hY3RpdmUpIHtcbiAgICAgIHRoaXMud2VhcG9uX3NlbGVjdCh3ZWFwb24pO1xuICAgICAgcmV0dXJuIHdlYXBvbjtcbiAgICB9XG4gIH1cbn07XG5cbi8qIENoYW5nZSB0byB3ZWFwb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfd2VhcG9uID0gZnVuY3Rpb24odHlwZSkge1xuICBpZiAoIXRoaXMucGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNvdW50ID0gdGhpcy5wbGF5ZXIuYXJtb3VyeVt0eXBlXTtcbiAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uY291bnQuaW5uZXJIVE1MID0gY291bnQ7XG5cbiAgaWYgKGNvdW50ID09IC0xKSB7XG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYWN0aXZlID0gdHJ1ZTtcbiAgICBzaG93KHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCk7XG4gICAgaGlkZSh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5jb3VudCk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGNvdW50IDwgMSkge1xuICAgICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYWN0aXZlID0gZmFsc2U7XG4gICAgICBoaWRlKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCk7XG4gICAgICBpZiAodHlwZSA9PSB0aGlzLmN1cnJlbnRfd2VhcG9uKSB7XG4gICAgICAgIHRoaXMud2VhcG9uX3NlbGVjdF9uKDApO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgc2hvdyh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gpO1xuICAgIH1cbiAgfVxuXG4gIGlmICghdGhpcy5jdXJyZW50X3dlYXBvbikge1xuICAgIHRoaXMud2VhcG9uX3NlbGVjdF9uKDApO1xuICB9XG4gIHRoaXMuZGlzcGxheV9hcm1vdXJ5KCk7XG59O1xuXG4vKiBTaG93IGFybW91cnkgb3Igbm90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZGlzcGxheV9hcm1vdXJ5ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzaG93X2l0ID0gZmFsc2U7XG4gIHZhciBldmVuID0gZmFsc2U7XG4gIGlmICh0aGlzLnBsYXllcikge1xuICAgIGZvciAoa2V5IGluIHRoaXMucGxheWVyLmFybW91cnkpIHtcbiAgICAgIGlmICh0aGlzLnBsYXllci5hcm1vdXJ5W2tleV0gPiAwIHx8IHRoaXMucGxheWVyLmFybW91cnlba2V5XSA9PSAtMSkge1xuICAgICAgICBzaG93X2l0ID0gdHJ1ZTtcbiAgICAgICAgZXZlbiA9ICFldmVuO1xuICAgICAgfVxuICAgICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNba2V5XS5ib3guc3R5bGUubWFyZ2luVG9wID0gZXZlbiA/IFwiMjZweFwiIDogXCIwcHhcIjtcbiAgICB9XG4gIH1cbiAgaWYgKHNob3dfaXQpIHtcbiAgICBzaG93KHRoaXMuYXJtb3VyeS5kaXYpO1xuICB9IGVsc2Uge1xuICAgIGhpZGUodGhpcy5hcm1vdXJ5LmRpdik7XG4gIH1cbn07XG5cbi8qIFJ1biBldmVyeSBmcmFtZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9hcm1vdXJ5ID0gZnVuY3Rpb24oKSB7XG4gIC8vIHR1cm4gb2ZmIGljb25cbiAgaWYgKFxuICAgIHRoaXMuYXJtb3VyeS5zaG93X2ljb24gJiZcbiAgICB0aGlzLmNvcmUuc3RhdGUuZnJhbWUgPiB0aGlzLmFybW91cnkuc2hvd19pY29uX2ZyYW1lICsgMzBcbiAgKSB7XG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbiA9IGZhbHNlO1xuICAgIGhpZGUodGhpcy5hcm1vdXJ5LnBsYXllcik7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgQXVkaW9cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgYXVkaW8gb2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9hdWRpbyA9IGZ1bmN0aW9uKCkge1xuICAvLyBvYmplY3RzIHdpdGggcmVwZWF0aW5nIHNvdW5kc1xuICB0aGlzLmF1ZGlvX29ianMgPSB7fTtcblxuICAvLyB3ZWFwb24gbG9vcHNcbiAgdGhpcy5hdWRpb193ZWFwb25zID0ge307XG5cbiAgLy8gc2V0IHVwIHBvd2VyIHVwIHNvdW5kXG4gIHRoaXMucG93ZXJfdXBfYXVkaW9fb24gPSBmYWxzZTtcbn07XG5cbi8qIENoZWNrIGFsbCBnYW1lIG9iamVjdHMgd2l0aCBhdWRpbyBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fYXVkaW8gPSBmdW5jdGlvbigpIHtcbiAgLy8gcmVtb3ZlIG9sZCBhdWRpbyBvYmplY3RzXG4gIGZvciAoa2V5IGluIHRoaXMuYXVkaW9fb2Jqcykge1xuICAgIGlmICghdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XSkge1xuICAgICAgaWYgKHRoaXMuYXVkaW9fb2Jqc1trZXldKSB7XG4gICAgICAgIHRoaXMuYXVkaW9fb2Jqc1trZXldLmdhaW4uZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLmF1ZGlvX29ianNba2V5XSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gb2JqZWN0c1xuICBmb3IgKGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuXG4gICAgLy8gd2hhdCBub2lzZSBzaG91bGQgYmUgcGxheWluZ1xuICAgIHZhciBhdWRpb19rZXkgPSBudWxsO1xuICAgIGlmIChvYmouZ3JvdW5kZWQgJiYgb2JqLmFuaW1hdGUgJiYgb2JqLmFjdGlvbmVkKSB7XG4gICAgICBhdWRpb19rZXkgPSBvYmouYy5hdWRpby53YWxrO1xuICAgIH0gZWxzZSB7XG4gICAgICBhdWRpb19rZXkgPSBvYmouYy5hdWRpby5haXI7XG4gICAgfVxuXG4gICAgdmFyIHZvbHVtZSA9IHRoaXMuZ2V0X2Rpc3Rfdm9sdW1lKG9iai54LCBvYmoueSk7XG4gICAgdmFyIGF1ZGlvX29iaiA9IHRoaXMuYXVkaW9fb2Jqc1trZXldO1xuXG4gICAgLy8gaWYgdGhlcmUgaXMgYW4gYXVkaW8gZmlsZSBwbGF5aW5nXG4gICAgaWYgKGF1ZGlvX29iaikge1xuICAgICAgLy8gY2hhbmdlIGl0cyB2b2x1bWVcbiAgICAgIHRoaXMuYXVkaW8uc2V0X3ZvbHVtZShhdWRpb19vYmosIHZvbHVtZSk7XG5cbiAgICAgIC8vIGRpc2Nvbm5lY3QgaXRcbiAgICAgIGlmICh2b2x1bWUgPD0gMCB8fCBhdWRpb19vYmouYXVkaW9fa2V5ICE9IGF1ZGlvX2tleSB8fCAhYXVkaW9fa2V5KSB7XG4gICAgICAgIGF1ZGlvX29iai5nYWluLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgdGhpcy5hdWRpb19vYmpzW2tleV0gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBpZiB0aGVyZSBpcyBub3QgYW4gYXVkaW8gZmlsZSBwbGF5aW5nXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChhdWRpb19rZXkpIHtcbiAgICAgICAgdGhpcy5hdWRpb19vYmpzW2tleV0gPSB0aGlzLmF1ZGlvLnBsYXkoYXVkaW9fa2V5LCB2b2x1bWUsIHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyogU2V0IGEgd2VhcG9uIHNob3Qgc291bmQgZWZmZWN0XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5wbGF5X3dlYXBvbl9hdWRpbyA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1twcm9wcy53ZWFwb25dO1xuICBpZiAoIXdlYXBvbikge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIXRoaXMuYXVkaW8uYnVmZmVyc1t3ZWFwb24uZmlyZV9hdWRpb10pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnZXQgdm9sdW1lXG4gIHZhciB2b2x1bWUgPSB0aGlzLmdldF9kaXN0X3ZvbHVtZShwcm9wcy54LCBwcm9wcy55KTtcbiAgdGhpcy5hdWRpby5wbGF5KHdlYXBvbi5maXJlX2F1ZGlvLCB2b2x1bWUpO1xufTtcblxuLyogR2V0IGRpc3RhbmNlIHZvbHVtZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZ2V0X2Rpc3Rfdm9sdW1lID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgZGlzdGFuY2UgPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZSh4LCB5LCB0aGlzLmNhbWVyYS54LCB0aGlzLmNhbWVyYS55KTtcbiAgdmFyIHZvbHVtZSA9ICgxMjAwIC0gZGlzdGFuY2UpIC8gMTIwMDtcbiAgdm9sdW1lICo9IHZvbHVtZTtcbiAgcmV0dXJuIHZvbHVtZTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgQ3Jvc3NoYWlyXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGNyb3NzaGFpclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfY3Jvc3NoYWlyID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuY3Jvc3NoYWlyID0gMDtcbiAgdGhpcy5jcm9zc2hhaXJfc291cmNlID0gXCJidXR0b25cIjtcbn07XG5cbi8qIENhbGN1bGF0ZSBjcm9zc2hhaXIgZnJvbSBjdXJzb3IgcG9zaXRpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fY3Jvc3NoYWlyID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5wbGF5ZXIgfHwgdGhpcy5wbGF5ZXIuZGVhZCB8fCAhdGhpcy5wbGF5ZXJfb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1t0aGlzLnBsYXllcl9vYmoua2V5XTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLmNyb3NzaGFpciA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgb2JqLngsXG4gICAgb2JqLnksXG4gICAgdGhpcy5jdXJzb3IueCxcbiAgICB0aGlzLmN1cnNvci55XG4gICk7XG5cbiAgLy8gLy8gY2FsY3VsYXRlIGZyb20gY3Vyc29yXG4gIC8vIGlmICh0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPT0gXCJjdXJzb3JcIikge1xuICAvLyBcdHRoaXMuY3Jvc3NoYWlyID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhvYmoueCwgb2JqLnksIHRoaXMuY3Vyc29yLngsIHRoaXMuY3Vyc29yLnkpO1xuXG4gIC8vIC8vIGNhbGN1bGF0ZSBmcm9tIGJ1dHRvbnNcbiAgLy8gfSBlbHNlXG4gIC8vIGlmICh0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPT0gXCJidXR0b25cIikge1xuXG4gIC8vIFx0Ly8gY2FsY3VsYXRlIGFuZ2xlIG9mIGNyb3NzaGFpclxuICAvLyBcdHZhciBhbmdsZSA9IC0xO1xuICAvLyBcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV91cCkge1xuICAvLyBcdFx0YW5nbGUgPSA5MDtcbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9yaWdodCkgeyBhbmdsZSA9IDEzNTsgfVxuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX2xlZnQpIHsgYW5nbGUgPSA0NTsgfVxuICAvLyBcdH0gZWxzZVxuICAvLyBcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9kb3duKSB7XG4gIC8vIFx0XHRhbmdsZSA9IDI3MDtcbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9yaWdodCkgeyBhbmdsZSA9IDIyNTsgfVxuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX2xlZnQpIHsgYW5nbGUgPSAzMDU7IH1cbiAgLy8gXHR9IGVsc2Uge1xuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3JpZ2h0KSB7IGFuZ2xlID0gMTgwOyB9XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfbGVmdCkgeyBhbmdsZSA9IDA7IH1cbiAgLy8gXHR9XG4gIC8vIFx0aWYgKGFuZ2xlICE9PSAtMSkge1xuICAvLyBcdFx0dGhpcy5jcm9zc2hhaXIgPSBpbmNyZW1lbnRfYW5nbGUodGhpcy5jcm9zc2hhaXIsIGFuZ2xlLCA0KTtcbiAgLy8gXHR9XG4gIC8vIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgRGVjb3JhdGlvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDcmVhdGUgZGVjb3JhdGlvblxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3JlYXRlX2RlY29yYXRpb24gPSBmdW5jdGlvbihwcm9wcykge1xuICB2YXIgb2JqID0ge1xuICAgIGZyYW1lOiB0aGlzLmNvcmUuc3RhdGUuZnJhbWUsXG4gICAgdHlwZTogXCJcIixcbiAgICBpZDogXCJcIixcbiAgICB4OiAwLFxuICAgIHk6IDAsXG4gICAgc3BlZWRfeDogMCxcbiAgICBzcGVlZF95OiAwLFxuICAgIHRpbWVvdXQ6IDAsXG4gICAgYW5nbGU6IDAsXG4gICAgcmVwZWF0OiB0cnVlLFxuICAgIHNwcml0ZTogXCJcIlxuICB9O1xuICBvYmogPSBkZWVwbWVyZ2Uob2JqLCBwcm9wcyk7XG4gIG9iai5rZXkgPVxuICAgIG9iai5mcmFtZSArIFwiLVwiICsgb2JqLnggKyBcIi1cIiArIG9iai55ICsgXCItXCIgKyBvYmouc3ByaXRlICsgXCItXCIgKyBvYmouaWQ7XG4gIHRoaXMuZGVjb3JhdGlvbnNbb2JqLmtleV0gPSBvYmo7XG59O1xuXG4vKiBSdW4gZGVjb3JhdGlvbnNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9kZWNvcmF0aW9ucyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjcmVhdGUgdHJhaWxzIGZyb20gb2JqZWN0c1xuICBmb3IgKGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmIChvYmouYy50cmFpbHMuY291bnQgPT09IDApIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB0aGlzLmNyZWF0ZV90cmFpbChvYmosIG9iai5jLnRyYWlscyk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGFsbCBkZWNvcmF0aW9uc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5kZWNvcmF0aW9ucykge1xuICAgIHZhciBkZWMgPSB0aGlzLmRlY29yYXRpb25zW2tleV07XG5cbiAgICAvLyBkbyB0aW1lb3V0XG4gICAgZGVjLnRpbWVvdXQtLTtcbiAgICBpZiAoZGVjLnRpbWVvdXQgPCAxKSB7XG4gICAgICBkZWxldGUgdGhpcy5kZWNvcmF0aW9uc1trZXldO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gbW92ZVxuICAgIGRlYy54ID0gdGhpcy5jb3JlLm1hcC5sb29wX3goZGVjLnggKyBkZWMuc3BlZWRfeCkuZml4ZWQoKTtcbiAgICBkZWMueSA9IHRoaXMuY29yZS5tYXAubG9vcF95KGRlYy55ICsgZGVjLnNwZWVkX3kpLmZpeGVkKCk7XG4gIH1cbn07XG5cbi8qIENyZWF0ZSB0cmFpbHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfdHJhaWwgPSBmdW5jdGlvbihvYmosIHRyYWlscykge1xuICAvLyBjcmVhdGUgdGhlIHRyYWlsc1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRyYWlscy5jb3VudDsgaSsrKSB7XG4gICAgdmFyIGFyZ3MgPSB7XG4gICAgICBpZDogaSxcbiAgICAgIHNwcml0ZTogdHJhaWxzLnNwcml0ZSxcbiAgICAgIHRpbWVvdXQ6IHRyYWlscy50aW1lb3V0LFxuICAgICAgeDogb2JqLmR4LFxuICAgICAgeTogb2JqLmR5XG4gICAgfTtcbiAgICBpZiAodHJhaWxzLnJvdGF0ZSkge1xuICAgICAgYXJncy5hbmdsZSA9IHJhbmQoMCwgMzYwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXJncy5hbmdsZSA9IGFuZ2xlX2FkZChnZXRfYW5nbGUoLW9iai5zcGVlZF94LCAtb2JqLnNwZWVkX3kpLCA5MCk7XG4gICAgICBhcmdzLnggLT0gb2JqLnNwZWVkX3g7XG4gICAgICBhcmdzLnkgLT0gb2JqLnNwZWVkX3k7XG4gICAgICBpZiAodHJhaWxzLm9mZnNldF94IHx8IHRyYWlscy5vZmZzZXRfeSkge1xuICAgICAgICB2YXIgeHl4ID0geHlfc3BlZWQoYW5nbGVfYWRkKGFyZ3MuYW5nbGUsIDkwKSwgdHJhaWxzLm9mZnNldF94KTtcbiAgICAgICAgdmFyIHh5eSA9IHh5X3NwZWVkKGFuZ2xlX2FkZChhcmdzLmFuZ2xlLCAxODApLCB0cmFpbHMub2Zmc2V0X3kpO1xuICAgICAgICBhcmdzLnggKz0geHl4LnggKyB4eXkueDtcbiAgICAgICAgYXJncy55ICs9IHh5eC55ICsgeHl5Lnk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0cmFpbHMubW92ZSkge1xuICAgICAgdmFyIG1vdmVfYW5nbGUgPSByYW5kKDAsIDM2MCk7XG4gICAgICB2YXIgeHkgPSB4eV9zcGVlZChtb3ZlX2FuZ2xlLCB0cmFpbHMuc3BlZWQpO1xuICAgICAgYXJncy5zcGVlZF94ID0gLXh5Lng7XG4gICAgICBhcmdzLnNwZWVkX3kgPSAteHkueTtcbiAgICB9XG4gICAgdGhpcy5jcmVhdGVfZGVjb3JhdGlvbihhcmdzKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBFdmVudHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gZXZlbnRzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRzID0gZnVuY3Rpb24oZXZlbnRzKSB7XG4gIC8vIGV2ZW50cyBmcm9tIHNjaGVtZVxuICB2YXIgZl9ldmVudCA9IHRoaXMuc2NoZW1lLmV2ZW50cy5mcmFtZVt0aGlzLmNvcmUuY3VycmVudF9mcmFtZV07XG4gIGlmIChmX2V2ZW50KSB7XG4gICAgdGhpcy5ydW5fZXZlbnQoZl9ldmVudCk7XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGhhbmRsZSBhcnJheSBvZiBldmVudHNcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoZXZlbnRbaV0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJ1biBldmVudFxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3ZWFwb25fc2VsZWN0XCIpIHtcbiAgICB0aGlzLndlYXBvbl9zZWxlY3RfbihldmVudC5uKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcIndlYXBvbl9zY3JvbGxcIikge1xuICAgIHRoaXMud2VhcG9uX3Njcm9sbChldmVudC5kb3duKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInN3aXRjaF93YXRjaGVyX2NhbWVyYVwiKSB7XG4gICAgdGhpcy5zd2l0Y2hfd2F0Y2hlcl9jYW1lcmEoKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZvbGxvd193ZWFwb25cIikge1xuICAgIHRoaXMudG9nZ2xlX3dlYXBvbl9mb2xsb3codHJ1ZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJmb2xsb3dfbW91c2VcIikge1xuICAgIHRoaXMudG9nZ2xlX21vdXNlX2ZvbGxvdygpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ3JvdW5kX2RhbWFnZVwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfZ3JvdW5kX2RhbWFnZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJzY3JlZW5fc2hha2VcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3NjcmVlbl9zaGFrZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJwbGF5ZXJfaGVhbHRoXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9wbGF5ZXJfaGVhbHRoKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9sZXZlbFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfcGxheWVyX2xldmVsKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImV4cGxvc2lvblwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfZXhwbG9zaW9uKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImFybW91cnlcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2FybW91cnkoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiYm91bmNlXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9ib3VuY2UoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwic291bmRcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInRhcmdldFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfdGFyZ2V0KGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInNwYXduXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9zcGF3bihldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJmb2N1c1wiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfZm9jdXMoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiYWxlcnRcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2FsZXJ0KGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImNvbGxlY3RcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2NvbGxlY3QoZXZlbnQpO1xuICB9XG59O1xuXG4vKiBHcm91bmQgRGFtYWdlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfZ3JvdW5kX2RhbWFnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGFyZSB3ZSBkZXN0cm95aW5nIGxhbmRcbiAgaWYgKCF0aGlzLnNjaGVtZS5kZXN0cm95X2xhbmQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBkYW1hZ2UgdGhlIGdyb3VuZFxuICB0aGlzLmNvcmUubWFwLnNldF9jaXJjbGUoZXZlbnQueCwgZXZlbnQueSwgZXZlbnQucmFkaXVzLCAwKTtcbiAgdGhpcy5kZXN0cm95X2xhbmQoZXZlbnQueCwgZXZlbnQueSwgZXZlbnQucmFkaXVzKTtcbiAgLy8gdGhpcy5jb3JlLm1hcC5ncmF2aXR5X2V2ZW50X3JlY2FsY3VsYXRlKGV2ZW50LngsIGV2ZW50LnksIGV2ZW50LnJhZGl1cyk7XG5cbiAgLy8gZG8gdGhlIGRpZyBub2lzZSBhbmQgc21va2UgdHJhaWxzXG4gIGlmIChldmVudC5kaWcpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7IHg6IGV2ZW50LngsIHk6IGV2ZW50LnksIHNvdW5kOiBcImRpZ1wiIH0pO1xuICAgIHRoaXMuY3JlYXRlX3RyYWlsKFxuICAgICAgeyBkeDogZXZlbnQueCwgZHk6IGV2ZW50LnkgfSxcbiAgICAgIHtcbiAgICAgICAgY291bnQ6IDcsXG4gICAgICAgIHNwcml0ZTogXCJzbW9rZVwiLFxuICAgICAgICB0aW1lb3V0OiAyMCxcbiAgICAgICAgcm90YXRlOiB0cnVlLFxuICAgICAgICBtb3ZlOiB0cnVlLFxuICAgICAgICBzcGVlZDogMVxuICAgICAgfVxuICAgICk7XG4gIH1cbn07XG5cbi8qIFNjcmVlbiBTaGFrZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3NjcmVlbl9zaGFrZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBkaXN0YW5jZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlKFxuICAgIGV2ZW50LngsXG4gICAgZXZlbnQueSxcbiAgICB0aGlzLmNhbWVyYS54LFxuICAgIHRoaXMuY2FtZXJhLnlcbiAgKTtcbiAgaWYgKGRpc3RhbmNlIDwgZXZlbnQucmFkaXVzICogMikge1xuICAgIHRoaXMuY2FtZXJhLnNoYWtlX2ZyYW1lID0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHRoaXMuY2FtZXJhLnNoYWtlX3NpemUgPSAoZGlzdGFuY2UgLSBldmVudC5yYWRpdXMpIC8gNDtcbiAgfVxufTtcblxuLyogSGVhbHRoXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfcGxheWVyX2hlYWx0aCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIGV2ZW50LmlkXTtcbiAgaWYgKG9iaikge1xuICAgIHZhciB0ZXh0ID0gU3RyaW5nLmZyb21DaGFyQ29kZSg5ODI5KSArIFwiIFwiICsgZXZlbnQuaGVhbHRoO1xuICAgIHRoaXMuY3JlYXRlX21lc3NhZ2Uob2JqLCBcIiNmZjk5OTlcIiwgdGV4dCwgMjIpO1xuICB9XG59O1xuXG4vKiBMZXZlbFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3BsYXllcl9sZXZlbCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIGV2ZW50LmlkXTtcblxuICAvLyBpcyB0aGlzIHVzXG4gIGlmICh0aGlzLnBsYXllcl9pZCA9PT0gZXZlbnQuaWQpIHtcbiAgICB0aGlzLnNldF9zY29yZSgpO1xuXG4gICAgLy8gc2V0IGFsZXJ0XG4gICAgaWYgKGV2ZW50Lm5ldyA+IGV2ZW50LnByZXYpIHtcbiAgICAgIHZhciBsdiA9IHRoaXMuc2NoZW1lLmxldmVscztcbiAgICAgIHZhciBuMSA9IGV2ZW50Lm5ldztcbiAgICAgIHZhciBuMiA9IGV2ZW50LnByZXY7XG4gICAgICB2YXIgYmVuZWZpdHMgPSBcIlwiO1xuICAgICAgaWYgKGx2LmhlYWx0aFtuMV0gPiBsdi5oZWFsdGhbbjJdKSB7XG4gICAgICAgIGJlbmVmaXRzICs9IFwiPGJyPitcIiArIChsdi5oZWFsdGhbbjFdIC0gbHYuaGVhbHRoW24yXSkgKyBcIiBtYXggaGVhbHRoXCI7XG4gICAgICB9XG4gICAgICBpZiAobHYuZGFtYWdlW24xXSA+IGx2LmRhbWFnZVtuMl0pIHtcbiAgICAgICAgYmVuZWZpdHMgKz0gXCI8YnI+K1wiICsgKGx2LmRhbWFnZVtuMV0gLSBsdi5kYW1hZ2VbbjJdKSArIFwiIGRhbWFnZVwiO1xuICAgICAgfVxuICAgICAgaWYgKGx2LnNwZWVkW24xXSA+IGx2LnNwZWVkW24yXSkge1xuICAgICAgICBiZW5lZml0cyArPSBcIjxicj4rXCIgKyAobHYuc3BlZWRbbjFdIC0gbHYuc3BlZWRbbjJdKSArIFwiIHNwZWVkXCI7XG4gICAgICB9XG4gICAgICBpZiAobHYuanVtcFtuMV0gPiBsdi5qdW1wW24yXSkge1xuICAgICAgICBiZW5lZml0cyArPSBcIjxicj4rXCIgKyAobHYuanVtcFtuMV0gLSBsdi5qdW1wW24yXSkgKyBcIiBqdW1wIHBvd2VyXCI7XG4gICAgICB9XG4gICAgICB2YXIgdGV4dCA9XG4gICAgICAgIFwiPHNtYWxsPllvdSBoYXZlIHJlYWNoZWQ8L3NtYWxsPjxicj48c3BhbiBjbGFzcz0nbGFyZ2UnPkxldmVsIFwiICtcbiAgICAgICAgKGV2ZW50Lm5ldyArIDEpICtcbiAgICAgICAgXCI8L3NwYW4+PHNtYWxsIGNsYXNzPSdibHVlJz5cIiArXG4gICAgICAgIGJlbmVmaXRzICtcbiAgICAgICAgXCI8L3NtYWxsPlwiO1xuICAgICAgdGhpcy5zZXRfYWxlcnQodGV4dCwgXCIjZWVlZWVlXCIsIDE1MCk7XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGhlIGZsb3VyaXNoXG4gIGlmIChldmVudC5uZXcgPiBldmVudC5wcmV2KSB7XG4gICAgdGhpcy5jcmVhdGVfbWVzc2FnZShvYmosIFwiI2VlZVwiLCBcImx2bCBcIiArIChldmVudC5uZXcgKyAxKSwgMzAsIC0zMCk7XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoeyB4OiBvYmoueCwgeTogb2JqLnksIHNvdW5kOiBcImxldmVsdXBcIiB9KTtcbiAgICB0aGlzLmNyZWF0ZV90cmFpbChvYmosIHtcbiAgICAgIGNvdW50OiA3LFxuICAgICAgc3ByaXRlOiBcInN0YXItYmx1ZVwiLFxuICAgICAgdGltZW91dDogMzAsXG4gICAgICByb3RhdGU6IHRydWUsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3BlZWQ6IDEuNVxuICAgIH0pO1xuICAgIHRoaXMuY3JlYXRlX3RyYWlsKG9iaiwge1xuICAgICAgY291bnQ6IDcsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1yZWRcIixcbiAgICAgIHRpbWVvdXQ6IDMwLFxuICAgICAgcm90YXRlOiB0cnVlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwZWVkOiAyXG4gICAgfSk7XG4gIH1cbn07XG5cbi8qIEV4cGxvc2lvblxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2V4cGxvc2lvbiA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGZvY3VzIGNhbWVyYSBpZiB3ZSB3ZXJlIGZvbGxvd2luZyBpdFxuICBpZiAodGhpcy53ZWFwb25fZm9sbG93aW5nID09PSBldmVudC5rZXkpIHtcbiAgICB0aGlzLmNhbWVyYS5mb2N1cyA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICB0aGlzLmNhbWVyYS5mb2N1c190aW1lID0gMzA7XG4gICAgdGhpcy5jYW1lcmEuZnggPSBldmVudC54O1xuICAgIHRoaXMuY2FtZXJhLmZ5ID0gZXZlbnQueTtcbiAgfVxufTtcblxuLyogQXJtb3VyeVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2FybW91cnkgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoZXZlbnQucGxheWVyX2lkID09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgdGhpcy5zZXRfd2VhcG9uKGV2ZW50LndlYXBvbik7XG4gIH1cbn07XG5cbi8qIEJvdW5jZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2JvdW5jZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgc291bmQgPSBvYmouYy5hdWRpby5ib3VuY2U7XG4gIGlmIChzb3VuZCkge1xuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHsgeDogZXZlbnQueCwgeTogZXZlbnQueSwgc291bmQ6IHNvdW5kIH0pO1xuICB9XG59O1xuXG4vKiBTb3VuZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3NvdW5kID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIHZvbHVtZSA9IHRoaXMuZ2V0X2Rpc3Rfdm9sdW1lKGV2ZW50LngsIGV2ZW50LnkpO1xuICBpZiAodm9sdW1lID4gMCkge1xuICAgIHRoaXMuYXVkaW8ucGxheShldmVudC5zb3VuZCwgdm9sdW1lKTtcbiAgfVxufTtcblxuLyogU2V0IGEgdGFyZ2V0IG9uIHRoZSBtYXBcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF90YXJnZXQgPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmNyZWF0ZV9kZWNvcmF0aW9uKHtcbiAgICBzcHJpdGU6IFwiZm9jdXNcIixcbiAgICB0aW1lb3V0OiBldmVudC50aW1lLFxuICAgIHg6IGV2ZW50LngsXG4gICAgeTogZXZlbnQueSxcbiAgICByZXBlYXQ6IGZhbHNlXG4gIH0pO1xuICB0aGlzLmF1ZGlvLnBsYXkoXCJob21pbmdcIiwgMSk7XG59O1xuXG4vKiBTcGF3biBPYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfc3Bhd24gPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmNyZWF0ZV9vYmplY3QoZXZlbnQuYXJncywgdHJ1ZSk7XG5cbiAgZXZlbnQuYXJncy50aW1lID0gMzA7XG4gIGlmIChldmVudC50YXJnZXQpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF90YXJnZXQoZXZlbnQuYXJncyk7XG4gIH1cbiAgaWYgKGV2ZW50LmZvY3VzKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfZm9jdXMoZXZlbnQuYXJncyk7XG4gIH1cbn07XG5cbi8qIEZvY3VzIENhbWVyYVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2ZvY3VzID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5jYW1lcmEuZm9jdXMgPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gIHRoaXMuY2FtZXJhLmZvY3VzX3RpbWUgPSBldmVudC50aW1lO1xuICB0aGlzLmNhbWVyYS5meCA9IGV2ZW50Lng7XG4gIHRoaXMuY2FtZXJhLmZ5ID0gZXZlbnQueTtcbiAgaWYgKGV2ZW50LnRhcmdldCkge1xuICAgIHRoaXMucnVuX2V2ZW50X3RhcmdldChldmVudCk7XG4gIH1cbn07XG5cbi8qIFNob3cgYWxlcnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9hbGVydCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuc2V0X2FsZXJ0KGV2ZW50LnRleHQsIFwiI2VlZWVlZVwiLCBldmVudC50aW1lKTtcbn07XG5cbi8qIENyYXRlIEdyYWJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9jb2xsZWN0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gaXMgdGhpcyBub3QgdXNcbiAgaWYgKGV2ZW50LnBsYXllcl9pZCAhPT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnZXQgb3VyIG9iamVjdFxuICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBldmVudC5wbGF5ZXJfaWRdO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNyYXRlc1xuICBpZiAoZXZlbnQuY29sbGVjdGVkID09PSBcImNyYXRlXCIpIHtcbiAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbZXZlbnQud2VhcG9uXTtcbiAgICB0aGlzLmNyZWF0ZV9tZXNzYWdlKFxuICAgICAgb2JqLFxuICAgICAgXCIjZWVlZWVlXCIsXG4gICAgICBcIitcIiArIGV2ZW50LmNvdW50ICsgXCIgXCIgKyB3ZWFwb24udGl0bGUsXG4gICAgICAxOFxuICAgICk7XG4gIH1cblxuICAvLyBnZW1zXG4gIGlmIChldmVudC5jb2xsZWN0ZWQgPT09IFwiZ2VtXCIpIHtcbiAgICB0aGlzLnNldF9zY29yZSgpO1xuICAgIHRoaXMuY3JlYXRlX21lc3NhZ2Uob2JqLCBcIiNhYWZmOTlcIiwgXCIrXCIgKyBldmVudC5uLCAyMik7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgRXhwbG9zaW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENoZWNrIGZvciBleHBsb3Npb25zXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXhwbG9zaW9ucyA9IGZ1bmN0aW9uKCkge1xuICAvLyBydW4gdGhyb3VnaCBhbGwgZXhwbG9zaW9uc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLmV4cGxvc2lvbnMpIHtcbiAgICB2YXIgZXhwbG9kZV9zdGF0ZSA9IHRoaXMuY29yZS5zdGF0ZS5leHBsb3Npb25zW2tleV07XG4gICAgdmFyIGV4cGxvZGVfc3ByaXRlID0gdGhpcy5leHBsb3Npb25zW2tleV07XG5cbiAgICAvLyBpZiBpdCdzIG5vdCBzdGFydGVkXG4gICAgaWYgKCFleHBsb2RlX3Nwcml0ZSkge1xuICAgICAgdmFyIHR5cGUgPSB0aGlzLmMub2JqZWN0c1tleHBsb2RlX3N0YXRlLnBhcmVudF90eXBlXTtcbiAgICAgIGlmICghdHlwZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gY3JlYXRlIHNwcml0ZSByZWZlcmVuY2VcbiAgICAgIHRoaXMuZXhwbG9zaW9uc1trZXldID0ge1xuICAgICAgICBzcHJpdGU6IHR5cGUuYW5pbWF0aW9uLmV4cGxvc2lvbixcbiAgICAgICAgZnJhbWU6IHRoaXMuY29yZS5zdGF0ZS5mcmFtZSxcbiAgICAgICAgeDogZXhwbG9kZV9zdGF0ZS54LFxuICAgICAgICB5OiBleHBsb2RlX3N0YXRlLnlcbiAgICAgIH07XG5cbiAgICAgIC8vIHJ1biBzb3VuZCBlZmZlY3RcbiAgICAgIGlmICh0eXBlLmF1ZGlvLmV4cGxvc2lvbikge1xuICAgICAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7XG4gICAgICAgICAgc291bmQ6IHR5cGUuYXVkaW8uZXhwbG9zaW9uLFxuICAgICAgICAgIHg6IGV4cGxvZGVfc3RhdGUueCxcbiAgICAgICAgICB5OiBleHBsb2RlX3N0YXRlLnlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHJ1biBzY3JlZW4gc2hha2VcbiAgICAgIGlmICh0eXBlLmRhbWFnZSA+IDApIHtcbiAgICAgICAgdGhpcy5ydW5fZXZlbnRfc2NyZWVuX3NoYWtlKHtcbiAgICAgICAgICByYWRpdXM6IHR5cGUuZGFtYWdlLFxuICAgICAgICAgIHg6IGV4cGxvZGVfc3RhdGUueCxcbiAgICAgICAgICB5OiBleHBsb2RlX3N0YXRlLnlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIG1hdGNoIHBvc2l0aW9uXG4gICAgZXhwbG9kZV9zcHJpdGUueCA9IGV4cGxvZGVfc3ByaXRlLng7XG4gICAgZXhwbG9kZV9zcHJpdGUueSA9IGV4cGxvZGVfc3ByaXRlLnk7XG4gIH1cblxuICAvLyByZW1vdmUgZXhwbG9zaW9uc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5leHBsb3Npb25zKSB7XG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSA+IHRoaXMuZXhwbG9zaW9uc1trZXldLmZyYW1lICsgNjApIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmV4cGxvc2lvbnNba2V5XTtcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gZ2FtZShcbiAgYXNzZXRzLFxuICBhdWRpbyxcbiAgaW5wdXQsXG4gIHNjaGVtZSxcbiAgbWFwLFxuICBwbGF5ZXJzLFxuICBwbGF5ZXJfaWQsXG4gIHRvcF9ldmVudCxcbiAgb25ib2FyZGluZ1xuKSB7XG4gIC8vIGFyZ3NcbiAgdGhpcy5jID0gY29uZmlnO1xuICB0aGlzLmltZyA9IGFzc2V0cy5pbWc7XG4gIHRoaXMuYXVkaW8gPSBhdWRpbztcbiAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICB0aGlzLnNjaGVtZSA9IHNjaGVtZTtcbiAgdGhpcy5tYXAgPSBtYXA7XG4gIHRoaXMucGxheWVycyA9IHBsYXllcnM7XG4gIHRoaXMucGxheWVyX2lkID0gcGxheWVyX2lkO1xuICB0aGlzLmxlYWRlciA9IG51bGw7XG4gIHRoaXMudG9wX2V2ZW50ID0gdG9wX2V2ZW50O1xuICB0aGlzLm9uYm9hcmRpbmcgPSBvbmJvYXJkaW5nO1xuXG4gIC8vIGdhbWUgcnVubmluZ1xuICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICB0aGlzLmxhc3RfZnJhbWUgPSAwO1xuXG4gIC8vIG1haW4gZGl2XG4gIHRoaXMuZGl2ID0gZWxlbWVudCh7IGNsYXNzOiBcImdhbWUgZnVsbFwiIH0pO1xuICB0aGlzLmdhbWVfYXJlYSA9IGVsZW1lbnQoeyBpZDogXCJnYW1lX2lucHV0XCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5nYW1lX2FyZWEpO1xuXG4gIC8vIHNldCB1cCBnYW1lIG1vZHVsZXNcbiAgdGhpcy5pbml0X2Nyb3NzaGFpcigpO1xuICB0aGlzLmluaXRfY2FudmFzKCk7XG4gIHRoaXMuaW5pdF9hcm1vdXJ5KCk7XG4gIHRoaXMuaW5pdF9tYXAoKTtcbiAgdGhpcy5pbml0X2NhbWVyYSgpO1xuICB0aGlzLmluaXRfYmFja2dyb3VuZCgpO1xuICB0aGlzLmluaXRfdGltZSgpO1xuICB0aGlzLmluaXRfc2NvcmUoKTtcbiAgdGhpcy5pbml0X2FsZXJ0KCk7XG4gIHRoaXMuaW5pdF9hdWRpbygpO1xuXG4gIC8vIHRoaW5ncyB0byBkaXNwbGF5XG4gIHRoaXMub2JqZWN0cyA9IHt9O1xuICB0aGlzLmV4cGxvc2lvbnMgPSB7fTtcbiAgdGhpcy5kZWNvcmF0aW9ucyA9IHt9O1xuICB0aGlzLmFjdGlvbnMgPSB7fTtcbiAgdGhpcy5zcHJpdGVzID0gW107XG4gIHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgdGhpcy5sYWJlbHMgPSB7fTtcblxuICAvLyB3YWl0IHBlcmlvZCBiZWZvcmUgb24gZmlyZWQgd2VhcG9uIGltbWVkaWF0ZWx5IGFmdGVyXG4gIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA9IDA7XG5cbiAgLy8gY3JlYXRlIGNvcmVcbiAgdGhpcy5jb3JlID0gbmV3IGNvcmUodGhpcy5jLCB0aGlzLnNjaGVtZSwgdGhpcy5tYXAuZmcsIHRoaXMubWFwLmdyYXZpdHlfbWFwKTtcbiAgdGhpcy5jb3JlLnN0YXRlID0gdGhpcy5jb3JlLmJsYW5rX3N0YXRlKCk7XG4gIHRoaXMuY29yZS5zdGF0ZSA9IHRoaXMuY29yZS5zdGF0ZTtcbn1cblxuLyogSW5pdCBnYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKGZyYW1lKSB7XG4gIC8vIG1hcmsgcGxheWVyIGV2ZW50c1xuICB0aGlzLnBsYXllcl9ldmVudHMgPSB7fTtcblxuICAvLyBzZXQgZ2FtZSBzdGF0dXMgdG8gYWN0aXZlXG4gIHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuICAvLyBzZXQgcGxheWVyIG9ialxuICB0aGlzLnNldF90aGlzX3BsYXllcl9yZWZzKCk7XG4gIHRoaXMuc2V0X3Njb3JlKCk7XG5cbiAgLy8gc2V0IGluaXRpYWwgY2FtZXJhXG4gIGlmICh0aGlzLnBsYXllcikge1xuICAgIHRoaXMuY2FtZXJhLnggPSB0aGlzLnBsYXllcl9vYmoueDtcbiAgICB0aGlzLmNhbWVyYS55ID0gdGhpcy5wbGF5ZXJfb2JqLnk7XG4gIH1cbn07XG5cbi8qIFJ1biBjb3JlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5mcmFtZV9jb3JlID0gZnVuY3Rpb24oZnJhbWUsIGFjdGlvbnMpIHtcbiAgLy8gc2V0IHVwIHRoaXMgc3RhdGVcbiAgdGhpcy5jb3JlLnN0YXRlLmZyYW1lID0gZnJhbWU7XG4gIHRoaXMuY29yZS5zdGF0ZS5ldmVudHMgPSBbXTtcbiAgdmFyIHJlc3BvbnNlID0gdGhpcy5jb3JlLmFjdGlvbih0aGlzLnBsYXllcl9pZCwgYWN0aW9ucyk7XG5cbiAgLy8gcnVuIHBsYXllciBhY3Rpb25zXG4gIHRoaXMucnVuX3BsYXllcnNfZXZlbnRzKCk7XG5cbiAgLy8gcnVuIHRoaXMgc3RhdGVcbiAgdGhpcy5jb3JlLmZyYW1lKCk7XG5cbiAgLy8gcmV0dXJuIHRoZSBpbnB1dCByZXNwb25zZVxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKiBSdW4gZGlzcGxheVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZnJhbWVfZGlzcGxheSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnJ1bl9vYmplY3RzKCk7XG4gIHRoaXMucnVuX2Nyb3NzaGFpcigpO1xuICB0aGlzLnJ1bl9jYW1lcmEoKTtcbiAgdGhpcy5ydW5fZXhwbG9zaW9ucygpO1xuICB0aGlzLnJ1bl9kZWNvcmF0aW9ucygpO1xuICB0aGlzLnJ1bl9sYWJlbHMoKTtcbiAgdGhpcy5ydW5fY2FudmFzKCk7XG4gIHRoaXMucnVuX2F1ZGlvKCk7XG4gIHRoaXMucnVuX3RpbWUoKTtcbiAgdGhpcy5ydW5fYWxlcnQoKTtcbiAgdGhpcy5ydW5fYXJtb3VyeSgpO1xuXG4gIC8vIGRldG9uYXRpb24gY29vbGRvd25cbiAgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duIC09IHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA+IDAgPyAxIDogMDtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0R2FtZVxuXHRJbnB1dFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEdldCBjdXJyZW50IGNvcmUgYWN0aW9uIGlucHV0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZ2V0X2lucHV0ID0gZnVuY3Rpb24oKSB7XG4gIC8vIGlzIHRoZSBnYW1lIGFjdGl2ZSBhbmQgZG9lcyBpdCBoYXZlIGEgcGxheWVyXG4gIGlmICghdGhpcy5hY3RpdmUgfHwgIXRoaXMucGxheWVyIHx8IHRoaXMucGxheWVyLmRlYWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZXQgc291cmNlIG9mIGNyb3NzaGFpciBtb3ZlbWVudFxuICBpZiAoXG4gICAgdGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3VwXCIpIHx8XG4gICAgdGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2Rvd25cIikgfHxcbiAgICB0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfbGVmdFwiKSB8fFxuICAgIHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9yaWdodFwiKVxuICApIHtcbiAgICB0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPSBcImJ1dHRvblwiO1xuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLmlucHV0LmN1cnNvcl9tb3ZlZCkge1xuICAgICAgdGhpcy5jcm9zc2hhaXJfc291cmNlID0gXCJjdXJzb3JcIjtcbiAgICB9XG4gIH1cbiAgdGhpcy5pbnB1dC5jdXJzb3JfbW92ZWQgPSBmYWxzZTtcblxuICAvLyBnZXQgcGxheWVyIGFjdGlvbnNcbiAgdmFyIGFjdGl2ZSA9IGZhbHNlO1xuICB2YXIgcmVzcG9uc2UgPSB7XG4gICAgYWN0aW9uOiBcIm5vbmVcIixcbiAgICBhbmdsZTogcm91bmQodGhpcy5jcm9zc2hhaXIpXG4gIH07XG5cbiAgLy8gd2VhcG9uIGtleXNcbiAgdmFyIHNob290X2tleSA9IGZhbHNlO1xuICB2YXIgZmlyZV93ZWFwb24gPSBmYWxzZTtcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW3RoaXMuY3VycmVudF93ZWFwb25dO1xuICBpZiAod2VhcG9uICYmIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA9PT0gMCAmJiB0aGlzLmlucHV0LmFjdGl2ZShcInNob290XCIpKSB7XG4gICAgLy8gYWJhbmRvbiBhIGZvbGxvd2VkIHdlYXBvblxuICAgIGlmICh0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1t0aGlzLndlYXBvbl9mb2xsb3dpbmddKSB7XG4gICAgICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPSAxNTtcbiAgICAgIHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9IFwiXCI7XG5cbiAgICAgIC8vIG5vcm1hbCBmaXJpbmdcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gb24gc2NyZWVuXG4gICAgICB2YXIgcG9zID0gdGhpcy5zY3JlZW5fcG9zaXRpb24oXG4gICAgICAgIHRoaXMucGxheWVyX29iai54LFxuICAgICAgICB0aGlzLnBsYXllcl9vYmoueSxcbiAgICAgICAgdGhpcy5wbGF5ZXJfb2JqLmMuc2l6ZVxuICAgICAgKTtcbiAgICAgIGlmICghcG9zLm9uX3NjcmVlbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIGNvb2xkb3duXG4gICAgICBpZiAodGhpcy5wbGF5ZXIuY29vbGRvd24gPiAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW3RoaXMuY3VycmVudF93ZWFwb25dO1xuICAgICAgaWYgKCF3ZWFwb24pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHdlYXBvbi5wb3dlcl91cCAmJiB0aGlzLnBvd2VyX3VwIDwgNjApIHtcbiAgICAgICAgdGhpcy5wb3dlcl91cCsrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmlyZV93ZWFwb24gPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aGlzLnBvd2VyZWQgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5wb3dlcl91cCA+IDApIHtcbiAgICAgIGZpcmVfd2VhcG9uID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wb3dlcl91cCA9IDA7XG4gICAgfVxuICB9XG5cbiAgLy8gZmlyZSB3ZWFwb25cbiAgaWYgKGZpcmVfd2VhcG9uKSB7XG4gICAgdGhpcy5wb3dlcmVkID0gdHJ1ZTtcbiAgICByZXNwb25zZS5hY3Rpb24gPSBcInNob290XCI7XG4gICAgcmVzcG9uc2UucG93ZXIgPSB0aGlzLnBvd2VyX3VwO1xuICAgIHJlc3BvbnNlLndlYXBvbiA9IHRoaXMuY3VycmVudF93ZWFwb247XG4gICAgYWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLnBvd2VyX3VwID0gMDtcbiAgfVxuXG4gIC8vIHdhbGtpbmcgcmVzdHJpY3RlZCBhY3Rpb25zXG4gIGlmICh0aGlzLnBsYXllcl9vYmouZ3JvdW5kZWQgJiYgIWFjdGl2ZSkge1xuICAgIC8vIGFycm93IGtleSBtb3ZlbWVudFxuICAgIHZhciBhcnJvd19hbmdsZSA9IC0xO1xuICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfdXBcIikpIHtcbiAgICAgIGFycm93X2FuZ2xlID0gOTA7XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3JpZ2h0XCIpKSB7XG4gICAgICAgIGFycm93X2FuZ2xlID0gMTM1O1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9sZWZ0XCIpKSB7XG4gICAgICAgIGFycm93X2FuZ2xlID0gNDU7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfZG93blwiKSkge1xuICAgICAgYXJyb3dfYW5nbGUgPSAyNzA7XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3JpZ2h0XCIpKSB7XG4gICAgICAgIGFycm93X2FuZ2xlID0gMjI1O1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9sZWZ0XCIpKSB7XG4gICAgICAgIGFycm93X2FuZ2xlID0gMzA1O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3JpZ2h0XCIpKSB7XG4gICAgICAgIGFycm93X2FuZ2xlID0gMTgwO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9sZWZ0XCIpKSB7XG4gICAgICAgIGFycm93X2FuZ2xlID0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGFycm93X2FuZ2xlICE9PSAtMSkge1xuICAgICAgcmVzcG9uc2UuYWN0aW9uID0gXCJtb3ZlXCI7XG4gICAgICByZXNwb25zZS5hbmdsZSA9IGFycm93X2FuZ2xlO1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBtb3ZlIGNyb3NzaGFpciBrZXlcbiAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlXCIpKSB7XG4gICAgICByZXNwb25zZS5hY3Rpb24gPSBcIm1vdmVcIjtcbiAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8ganVtcGluZ1xuICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcImp1bXBcIikpIHtcbiAgICAgIHJlc3BvbnNlLmFjdGlvbiA9IFwianVtcFwiO1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvLyBjYW5jZWwgbW91c2UgZm9sbG93IGlmIGRvaW5nIHN0dWZmXG4gIGlmIChhY3RpdmUpIHtcbiAgICB0aGlzLmNhbmNlbF9tb3VzZV9mb2xsb3coKTtcbiAgfVxuXG4gIGlmICghYWN0aXZlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gc2V0IHRoZSBvbmJvYXJkaW5nXG4gIHRoaXMub25ib2FyZGluZy5zZXQocmVzcG9uc2UuYWN0aW9uKTtcblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFJ1biBPYmplY3RzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQgb2JqZWN0c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV9vYmplY3QgPSBmdW5jdGlvbihwcm9wcywgc3Bhd24pIHtcbiAgLy8gdXNlIGV4aXN0aW5nIHByb3BzIHRvIG1ha2UgbmV3IGNvcmUgb2JqZWN0XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuY3JlYXRlX29iamVjdChwcm9wcyk7XG5cbiAgLy8gcHJldmlvdXMgcG9zaXRpb25cbiAgb2JqLnB4ID0gb2JqLng7XG4gIG9iai5weSA9IG9iai55O1xuICBvYmoucGcgPSBmYWxzZTtcbiAgb2JqLnB4MiA9IG9iai54O1xuICBvYmoucHkyID0gb2JqLnk7XG5cbiAgLy8gZGlzcGxheSB2YWx1ZXNcbiAgb2JqLmhlYWRpbmcgPSAwO1xuICBvYmouaGlkZSA9IDA7XG4gIG9iai5iYXJyZWxfYW5nbGUgPSAwO1xuICBvYmouYWN0aW9uZWQgPSBmYWxzZTtcbiAgb2JqLnBsYXllcl9sb2NrZWQgPSBmYWxzZTtcblxuICAvLyBkaXNwbGF5IHBvc2l0aW9uXG4gIG9iai5keCA9IG9iai54O1xuICBvYmouZHkgPSBvYmoueTtcbiAgb2JqLmRzID0gMDtcblxuICAvLyBjaGVjayBmb3Igc2hvb3QgZXZlbnRzXG4gIHRoaXMuc2V0X3Nob3Rfb2JqZWN0KG9iaik7XG5cbiAgLy8gcHJldmlvdXMgZGlzcGxheSBwb3NpdGlvblxuICBvYmoucGR4ID0gb2JqLng7XG4gIG9iai5wZHkgPSBvYmoueTtcblxuICAvLyBzcGF3blxuICBpZiAob2JqLmMuc3Bhd24gfHwgc3Bhd24pIHtcbiAgICAvLyBoaWRlIG5ldyBvYmplY3QgZm9yIHggZnJhbWVzXG4gICAgb2JqLmhpZGUgPSA5O1xuXG4gICAgLy8gYWRkIGEgc3Bhd24gZGVjb3JhdGlvbiBvdmVyIHRvcFxuICAgIHRoaXMuY3JlYXRlX2RlY29yYXRpb24oe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHRpbWVvdXQ6IDE2LFxuICAgICAgcmVwZWF0OiBmYWxzZSxcbiAgICAgIHR5cGU6IFwic3Bhd25cIixcbiAgICAgIHNwcml0ZTogXCJ0ZWxlcG9ydFwiXG4gICAgfSk7XG5cbiAgICAvLyBwbGF5IHNwYXduIHNvdW5kXG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgc291bmQ6IFwicGhhc2VcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnlcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBTZXQgYSBzaG90IGl0ZW1zIG5ldyBsb2NhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9zaG90X29iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBjaGVjayBmb3IgYSBwbGF5ZXJcbiAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBhbiBhY3Rpb25cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbGF5ZXIuZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGFjdCA9IHBsYXllci5ldmVudHNbaV07XG4gICAgaWYgKGFjdC5vYmogPT09IG9iai5rZXkpIHtcbiAgICAgIG9iai5oaWRlID0gMTAwO1xuICAgIH1cbiAgfVxufTtcblxuLyogUnVuIG9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fb2JqZWN0cyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjaGVjayBmb3IgcGxheWVyIGxvY2tlZCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmIChvYmouYy5wbGF5ZXJfbG9jaykge1xuICAgICAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgb2JqLnBsYXllcl9pZF07XG4gICAgICBpZiAocGxheWVyKSB7XG4gICAgICAgIHBsYXllci5wbGF5ZXJfbG9ja2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB0aGlzLnJ1bl9vYmplY3QodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XSk7XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gc25hcCBpbW1lZGlhdGVseSBpZiB1c1xuICBpZiAob2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICBvYmouZHggPSBvYmoueDtcbiAgICBvYmouZHkgPSBvYmoueTtcblxuICAgIC8vIHByZXZlbnQgYm9iYmxpbmdcbiAgICBpZiAob2JqLnggPT09IG9iai5weDIgJiYgb2JqLnkgPT09IG9iai5weTIpIHtcbiAgICAgIG9iai5keCA9IG9iai5wZHg7XG4gICAgICBvYmouZHkgPSBvYmoucGR5O1xuICAgIH1cblxuICAgIC8vIGludGVycG9sYXRlIG90aGVyc1xuICB9IGVsc2Uge1xuICAgIC8vIGdldCBtYXggc3BlZWQgb2YgbW92ZW1lbnRcbiAgICBpZiAoIW9iai5hY3Rpb25lZCkge1xuICAgICAgb2JqLmRzID0gZ2V0X3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gICAgfVxuXG4gICAgLy8gaW50ZXJwb2xhdGVcbiAgICB2YXIgZGlzdF94ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeChvYmouZHgsIG9iai54KTtcbiAgICB2YXIgZGlzdF95ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeShvYmouZHksIG9iai55KTtcbiAgICB2YXIgbWF4X3NwZWVkID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2Uob2JqLmR4LCBvYmouZHksIG9iai54LCBvYmoueSk7XG4gICAgdmFyIHNwZWVkID0gbWF4KG1heF9zcGVlZCAvIDQsIG1pbihtYXhfc3BlZWQsIG9iai5kcykpO1xuICAgIHZhciBtb3ZlID0gY2hlY2tfc3BlZWQoZGlzdF94LCBkaXN0X3ksIHNwZWVkKTtcbiAgICBvYmouZHggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHggKyByb3VuZChtb3ZlLngpKTtcbiAgICBvYmouZHkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkgKyByb3VuZChtb3ZlLnkpKTtcbiAgfVxuXG4gIC8vIGhhdmUgd2UgbW92ZWRcbiAgdmFyIG1vdmVkID0gb2JqLnBkeCAhPT0gb2JqLmR4IHx8IG9iai5wZHkgIT09IG9iai5keTtcblxuICAvLyBzZXQgaGVhZGluZyBhbmQgYmFycmVsIGFuZ2xlXG4gIGlmIChtb3ZlZCkge1xuICAgIG9iai5oZWFkaW5nID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhvYmoucGR4LCBvYmoucGR5LCBvYmouZHgsIG9iai5keSk7XG4gICAgb2JqLmJhcnJlbF9hbmdsZSA9IGluY3JlbWVudF9hbmdsZShvYmouYmFycmVsX2FuZ2xlLCBvYmouaGVhZGluZywgMyk7XG4gIH1cblxuICAvLyBpcyB1c1xuICBpZiAob2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICBvYmouYmFycmVsX2FuZ2xlID0gb2JqLnBsYXllcl9sb2NrZWQgPyBvYmouaGVhZGluZyA6IHRoaXMuY3Jvc3NoYWlyO1xuICB9XG5cbiAgLy8gaWYgd2UgaGF2ZSBqdXN0IGxhbmRlZCBzZXQgaW5pdGlhbCBhbmdsZVxuICBpZiAob2JqLmdyb3VuZGVkICYmICFvYmoucGcpIHtcbiAgICB2YXIgYW5nbGUgPSBnZXRfYW5nbGUob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgICB2YXIgd2FsayA9IHRoaXMuY29yZS5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai5weCwgb2JqLnB5LCBhbmdsZSwgNik7XG4gICAgaWYgKHdhbGsubW92ZSkge1xuICAgICAgb2JqLmFuZ2xlID0gd2Fsay5hbmdsZTtcbiAgICAgIG9iai5kaXJlY3Rpb24gPSB3YWxrLmRpcmVjdGlvbjtcbiAgICAgIG9iai5weCA9IG9iai54O1xuICAgICAgb2JqLnB5ID0gb2JqLnk7XG4gICAgICBvYmouYW5pbWF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlmIHdhbGtpbmdcbiAgZWxzZSBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgLy8gc2V0IHRoZSBkaXNwbGF5IHZhbHVlc1xuICAgIHZhciBkaXN0X3ggPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV94KG9iai5wZHgsIG9iai5keCk7XG4gICAgdmFyIGRpc3RfeSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kob2JqLnBkeSwgb2JqLmR5KTtcbiAgICB2YXIgYW1vdW50X21vdmVkID0gZ2V0X3NwZWVkKGRpc3RfeCwgZGlzdF95KTtcbiAgICBpZiAoYW1vdW50X21vdmVkID4gMykge1xuICAgICAgb2JqLmFuaW1hdGUgPSB0cnVlO1xuICAgICAgb2JqLmRpcmVjdGlvbiA9IHRoaXMuY29yZS5tYXAuZ3JvdW5kX2RpcihcbiAgICAgICAgb2JqLnBkeCxcbiAgICAgICAgb2JqLnBkeSxcbiAgICAgICAgb2JqLmR4LFxuICAgICAgICBvYmouZHlcbiAgICAgICk7XG4gICAgICBvYmouYW5nbGUgPSBvYmouaGVhZGluZztcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqLmFuaW1hdGUgPSBvYmouYy5hbmltYXRpb24uZ3JvdW5kO1xuICAgIH1cblxuICAgIC8vIHNldCBzcHJpdGVzXG4gICAgdmFyIHN1ZmZpeCA9IG9iai5hbmltYXRlID8gXCItd2Fsay1cIiA6IFwiLXN0aWxsLVwiO1xuICAgIG9iai5zcHJpdGVfa2V5ID0gb2JqLmMuYW5pbWF0aW9uLnNwcml0ZSArIHN1ZmZpeCArIG9iai5kaXJlY3Rpb247XG4gICAgb2JqLmRpc3BsYXlfYW5nbGUgPVxuICAgICAgb2JqLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIgPyBvYmouYW5nbGUgOiBhbmdsZV9hZGQob2JqLmFuZ2xlLCAxODApO1xuXG4gICAgLy8gbm90IHdhbGtpbmdcbiAgfSBlbHNlIHtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5jLmFuaW1hdGlvbi5zcHJpdGU7XG4gICAgb2JqLmFuaW1hdGUgPSB0cnVlO1xuXG4gICAgLy8gcGxheWVyc1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiYgcGxheWVyLmhpdCA9PT0gMCkge1xuICAgICAgb2JqLmRpcmVjdGlvbiA9XG4gICAgICAgIG9iai5iYXJyZWxfYW5nbGUgPj0gOTAgJiYgb2JqLmJhcnJlbF9hbmdsZSA8IDI3MCA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICAgICAgb2JqLnNwcml0ZV9rZXkgKz0gXCItYWlyLVwiICsgb2JqLmRpcmVjdGlvbjtcbiAgICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgICAgb2JqLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCJcbiAgICAgICAgICA/IG9iai5iYXJyZWxfYW5nbGVcbiAgICAgICAgICA6IGFuZ2xlX2FkZChvYmouYmFycmVsX2FuZ2xlLCAxODApO1xuICAgIH1cblxuICAgIC8vIHNwaW5uaW5nIGluIHRoZSBhaXJcbiAgICBlbHNlIGlmIChvYmouYy5hbmltYXRpb24uYWlyX3NwaW4pIHtcbiAgICAgIHZhciBncm91bmQgPSB0aGlzLmNvcmUubWFwLmdyb3VuZF9waXhlbChyb3VuZChvYmouZHgpLCByb3VuZChvYmouZHkpKTtcbiAgICAgIHZhciBzcGVlZCA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICAgICAgdmFyIG4gPSBncm91bmQgPyAwIDogMTtcbiAgICAgIHZhciBhbmdsZV9hZGRpbmcgPSBtb3ZlZCA/IHNwZWVkICogMiA6IG47XG4gICAgICBvYmouZGlzcGxheV9hbmdsZSA9IGFuZ2xlX2FkZChvYmouZGlzcGxheV9hbmdsZSwgYW5nbGVfYWRkaW5nKTtcblxuICAgICAgLy8gcG9pbnRpbmcgdG93YXJkcyB0cmFqZWN0b3J5XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyb3VuZChhYnMob2JqLnNwZWVkX3gpID09PSAwKSAmJiByb3VuZChhYnMob2JqLnNwZWVkX3kpID09PSAwKSkge1xuICAgICAgICBpZiAob2JqLmMuYW5pbWF0aW9uLmFpcl9zcGluKSB7XG4gICAgICAgICAgb2JqLmRpc3BsYXlfYW5nbGUgPSBhbmdsZV9hZGQob2JqLmRpc3BsYXlfYW5nbGUsIDIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmouZGlzcGxheV9hbmdsZSA9IGFuZ2xlX2FkZChcbiAgICAgICAgICBnZXRfYW5nbGUoLW9iai5zcGVlZF94LCAtb2JqLnNwZWVkX3kpLFxuICAgICAgICAgIDkwXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gc3RhdGljIGFuZ2xlIGZsYWdcbiAgaWYgKG9iai5jLmFuaW1hdGlvbi5zdGF0aWNfYW5nbGUpIHtcbiAgICBvYmouZGlzcGxheV9hbmdsZSA9IDA7XG4gIH1cblxuICAvLyB3ZWFwb24ganVzdCBmaXJlZCBmbGFnc1xuICBpZiAob2JqLmZpcmVfc3ByaXRlX2NvdW50KSB7XG4gICAgb2JqLmZpcmVfc3ByaXRlX2NvdW50LS07XG4gIH1cbiAgaWYgKG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQpIHtcbiAgICBvYmouZGlyZWN0aW9uID0gb2JqLmZpcmVfZGlyZWN0aW9uO1xuICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgIG9iai5kaXJlY3Rpb24gPT09IFwibGVmdFwiXG4gICAgICAgID8gb2JqLmZpcmVfYW5nbGVfbG9ja1xuICAgICAgICA6IGFuZ2xlX2FkZChvYmouZmlyZV9hbmdsZV9sb2NrLCAxODApO1xuICAgIG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQtLTtcbiAgfVxuICBpZiAob2JqLmZpcmVfYm9keV9zcHJpdGVfY291bnQpIHtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5maXJlX2JvZHlfc3ByaXRlICsgXCItXCIgKyBvYmouZGlyZWN0aW9uO1xuICAgIG9iai5hbmltYXRlID0gdHJ1ZTtcbiAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZV9jb3VudC0tO1xuICB9XG5cbiAgLy8gcHJldmlvdXMgcG9zaXRpb25cbiAgb2JqLnB4MiA9IG9iai5weDtcbiAgb2JqLnB5MiA9IG9iai5weTtcbiAgb2JqLnB4ID0gb2JqLng7XG4gIG9iai5weSA9IG9iai55O1xuICBvYmoucGcgPSBvYmouZ3JvdW5kZWQ7XG4gIG9iai5wZHggPSBvYmouZHg7XG4gIG9iai5wZHkgPSBvYmouZHk7XG4gIG9iai5wbGF5ZXJfbG9ja2VkID0gZmFsc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFJ1biBQbGF5ZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQgdGhpcyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X3BsYXllciA9IGZ1bmN0aW9uKHBsYXllciwgcHJlc2VydmVfZXZlbnRzLCByZW1vdmVfZXZlbnRzKSB7XG4gIHZhciBuZXdfcGxheWVyO1xuXG4gIC8vIHVzZSBzb3VyY2VzXG4gIGlmIChwbGF5ZXIpIHtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1twbGF5ZXIuaWRdO1xuICAgIGlmIChwcmVzZXJ2ZV9ldmVudHMgJiYgY29yZV9wbGF5ZXIpIHtcbiAgICAgIHBsYXllci5ldmVudHMgPSBjb3JlX3BsYXllci5ldmVudHMuY29uY2F0KHBsYXllci5ldmVudHMpO1xuICAgIH1cbiAgICBuZXdfcGxheWVyID0gdGhpcy5jb3JlLmNyZWF0ZV9wbGF5ZXIocGxheWVyKTtcbiAgICBpZiAocmVtb3ZlX2V2ZW50cykge1xuICAgICAgbmV3X3BsYXllci5ldmVudHMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgbmV3XG4gIH0gZWxzZSB7XG4gICAgbmV3X3BsYXllciA9IHRoaXMuY29yZS5jcmVhdGVfcGxheWVyKHsgaWQ6IHRoaXMucGxheWVyX2lkIH0pO1xuICAgIHRoaXMuY3JlYXRlX29iamVjdCh7IHR5cGU6IFwicGxheWVyXCIsIHBsYXllcl9pZDogdGhpcy5wbGF5ZXJfaWQgfSk7XG4gICAgdGhpcy5jb3JlLmluaXRfcGxheWVyKHRoaXMucGxheWVyX2lkKTtcbiAgfVxuXG4gIC8vIHNldCB0aGlzIHBsYXllclxuICBpZiAobmV3X3BsYXllci5pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICB0aGlzLnBsYXllciA9IG5ld19wbGF5ZXI7XG4gICAgdGhpcy5zZXRfYXJtb3VyeSgpO1xuICB9XG59O1xuXG4vKiBSZXNvbHZlIHBsYXllcnMgZnJvbSBvdGhlciBzdGF0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fcGxheWVyc19ldmVudHMgPSBmdW5jdGlvbihwbGF5ZXJzKSB7XG4gIC8vIGNsZWFyIG9iamVjdCBhY3Rpb25lZCBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XS5hY3Rpb25lZCA9IGZhbHNlO1xuICB9XG5cbiAgLy8gcnVuIHBsYXllciBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgdGhpcy5ydW5fcGxheWVyX2V2ZW50cyh0aGlzLmNvcmUuc3RhdGUucGxheWVyc1trZXldKTtcbiAgfVxuXG4gIC8vIHJlbW92ZSBvbGQgZXZlbnRzXG4gIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVyX2V2ZW50cykge1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnBsYXllcl9ldmVudHNbaWRdKSB7XG4gICAgICBpZiAodGhpcy5jb3JlLnN0YXRlLmZyYW1lID4gdGhpcy5wbGF5ZXJfZXZlbnRzW2lkXVtrZXldICsgMzApIHtcbiAgICAgICAgZGVsZXRlIHRoaXMucGxheWVyX2V2ZW50c1tpZF1ba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9wbGF5ZXJfZXZlbnRzID0gZnVuY3Rpb24ocGxheWVyKSB7XG4gIC8vIGluaXQgcGxheWVyIGV2ZW50c1xuICBpZiAoIXRoaXMucGxheWVyX2V2ZW50c1twbGF5ZXIuaWRdKSB7XG4gICAgdGhpcy5wbGF5ZXJfZXZlbnRzW3BsYXllci5pZF0gPSB7fTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZXZlbnRzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBldmVudCA9IHBsYXllci5ldmVudHNbaV07XG4gICAgdmFyIGtleSA9IGV2ZW50LmZyYW1lICsgXCItXCIgKyBldmVudC50eXBlO1xuICAgIGlmICghdGhpcy5wbGF5ZXJfZXZlbnRzW2tleV0pIHtcbiAgICAgIHRoaXMucGxheWVyX2V2ZW50KHBsYXllciwgZXZlbnQpO1xuICAgICAgdGhpcy5wbGF5ZXJfZXZlbnRzW2tleV0gPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbn07XG5cbi8qIFBsYXllciBhY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5wbGF5ZXJfZXZlbnQgPSBmdW5jdGlvbihwbGF5ZXIsIGV2ZW50KSB7XG4gIC8vIGlzIHRoZXJlIGlzbid0IGFuIGFjdGlvblxuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IHBsYXllciBvYmplY3RcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyLmlkXTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBtYXJrIG9iamVjdCBhcyBoYXZpbmcgcGVyZm9ybWVkIGFuIGFjdGlvblxuICBvYmouYWN0aW9uZWQgPSB0cnVlO1xuXG4gIC8vIG1vdmVtZW50XG4gIGlmIChldmVudC50eXBlID09PSBcIndhbGtcIikge1xuICAgIG9iai5kcyA9IHRoaXMuc2NoZW1lLmxldmVscy5zcGVlZFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLm1vdmU7XG4gIH1cblxuICAvLyBqdW1wXG4gIGlmIChldmVudC50eXBlID09PSBcImp1bXBcIikge1xuICAgIG9iai5kcyA9IHRoaXMuc2NoZW1lLmxldmVscy5qdW1wW3BsYXllci5sZXZlbF0gfHwgb2JqLmMuc3BlZWQuanVtcDtcblxuICAgIC8vIHBsYXkganVtcCBzb3VuZFxuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgIHNvdW5kOiBcImp1bXBcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHNob290aW5nXG4gIGlmIChldmVudC50eXBlID09PSBcInNob290XCIpIHtcbiAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbZXZlbnQud2VhcG9uXTtcbiAgICB2YXIgd2VhcG9uX29iaiA9IHRoaXMuYy5vYmplY3RzW3dlYXBvbi5vYmplY3RdO1xuXG4gICAgLy8gYXJlIHdlIGZpcmluZyB0aGUgd2VhcG9uXG4gICAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPSBtaW4oMjAsIHdlYXBvbi5jb29sZG93bik7XG4gICAgICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSB0aGlzLndlYXBvbl9mb2xsb3cgPyBldmVudC5vYmogOiBcIlwiO1xuXG4gICAgICAvLyBvdGhlciBwbGF5ZXJzIHNob3RzXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBzaG90X29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gICAgICBpZiAoc2hvdF9vYmopIHtcbiAgICAgICAgc2hvdF9vYmouaGlkZSA9IDA7XG4gICAgICAgIHNob3Rfb2JqLmR4ID0gb2JqLmR4O1xuICAgICAgICBzaG90X29iai5keSA9IG9iai5keTtcbiAgICAgICAgb2JqLmJhcnJlbF9hbmdsZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgICAgICAgb2JqLngsXG4gICAgICAgICAgb2JqLnksXG4gICAgICAgICAgc2hvdF9vYmoueCxcbiAgICAgICAgICBzaG90X29iai55XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgYXJlIG5vdCBhIHBsYXllciBhbmQgYXV0byBmb2xsb3cgd2VhcG9uc1xuICAgIGlmICh0aGlzLnBsYXllcl9pZCA9PT0gbnVsbCkge1xuICAgICAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHBhcnNlSW50KHRoaXMubGVhZGVyKSAmJiB3ZWFwb24uYXV0b19mb2xsb3cpIHtcbiAgICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gZXZlbnQub2JqO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHdlYXBvbiBqdXN0IGZpcmVkIHNwcml0ZVxuICAgIGlmICh3ZWFwb24uZmlyZV9zcHJpdGUpIHtcbiAgICAgIHZhciBzcHJpdGVfa2V5ID0gXCJhbnQtd2VhcG9uLVwiICsgd2VhcG9uLmZpcmVfc3ByaXRlO1xuICAgICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYy5hbmltYXRpb25zW3Nwcml0ZV9rZXkgKyBcIi1sZWZ0XCJdO1xuICAgICAgb2JqLmZpcmVfc3ByaXRlID0gc3ByaXRlX2tleTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZV9jb3VudCA9IGFuaW1hdGlvbiA/IGFuaW1hdGlvbi5sZW5ndGggKyAxIDogMTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZV9mcmFtZSA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICB9XG5cbiAgICAvLyB3ZWFwb24gYm9keSBzcHJpdGVcbiAgICBpZiAod2VhcG9uLmZpcmVfYm9keV9zcHJpdGUpIHtcbiAgICAgIHZhciBjb29sID0gd2VhcG9uX29iai50aW1lb3V0XG4gICAgICAgID8gd2VhcG9uX29iai50aW1lb3V0ICsgNVxuICAgICAgICA6IHdlYXBvbi5jb29sZG93biArIDU7XG4gICAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZSA9IFwiYW50LWJvZHktXCIgKyB3ZWFwb24uZmlyZV9ib2R5X3Nwcml0ZTtcbiAgICAgIG9iai5maXJlX2JvZHlfc3ByaXRlX2NvdW50ID0gY29vbDtcbiAgICB9XG5cbiAgICAvLyB3ZWFwb24gYW5nbGUgbG9ja1xuICAgIGlmICh3ZWFwb24uZmlyZV9hbmdsZV9sb2NrKSB7XG4gICAgICB2YXIgY29vbCA9IHdlYXBvbl9vYmoudGltZW91dFxuICAgICAgICA/IHdlYXBvbl9vYmoudGltZW91dCArIDVcbiAgICAgICAgOiB3ZWFwb24uY29vbGRvd24gKyA1O1xuICAgICAgb2JqLmZpcmVfZGlyZWN0aW9uID0gb2JqLmRpcmVjdGlvbjtcbiAgICAgIG9iai5maXJlX2FuZ2xlX2xvY2sgPSBvYmouYmFycmVsX2FuZ2xlO1xuICAgICAgb2JqLmZpcmVfYW5nbGVfbG9ja19jb3VudCA9IGNvb2w7XG4gICAgfVxuXG4gICAgLy8gcGxheSBzb3VuZCBlZmZlY3RcbiAgICB0aGlzLnBsYXlfd2VhcG9uX2F1ZGlvKHtcbiAgICAgIHg6IG9iai5keCxcbiAgICAgIHk6IG9iai5keSxcbiAgICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICAgIHdlYXBvbjogZXZlbnQud2VhcG9uXG4gICAgfSk7XG4gIH1cblxuICAvLyBjb2xsZWN0IGEgY3JhdGUgb3IgbWVkcGFja1xuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJjcmF0ZVwiIHx8IGV2ZW50LnR5cGUgPT09IFwibWVkcGFja1wiKSB7XG4gICAgLy8gcmVtb3ZlIHRoZSBvYmplY3RcbiAgICBpZiAodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbZXZlbnQub2JqXSkge1xuICAgICAgZGVsZXRlIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gICAgfVxuXG4gICAgLy8gcGxheSBzb3VuZCBlZmZlY3RcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7XG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgc291bmQ6IFwibG9ja25sb2FkXCJcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGNvbGxlY3RlZCBhIGdlbVxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJnZW1cIikge1xuICAgIC8vIHJlbW92ZSB0aGUgb2JqZWN0XG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial0pIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdO1xuICAgIH1cblxuICAgIC8vIHBsYXkgc291bmQgZWZmZWN0XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNvdW5kOiBcImJpbmdcIlxuICAgIH0pO1xuICB9XG59O1xuXG4vKiBTZXQgdGhpcyBwbGF5ZXIgcmVmZXJlbmNlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF90aGlzX3BsYXllcl9yZWZzID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldCBwbGF5ZXIgcmVmXG4gIGlmICh0aGlzLmNvcmUuc3RhdGUucGxheWVyc1t0aGlzLnBsYXllcl9pZF0pIHtcbiAgICB0aGlzLnBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXTtcbiAgfVxuXG4gIC8vIHNldCBvYmplY3QgcmVmXG4gIGlmICh0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHRoaXMucGxheWVyX2lkXSkge1xuICAgIHRoaXMucGxheWVyX29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWRdO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFNjb3Jlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIHNjb3JlIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9zY29yZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuc2NoZW1lLnNjb3JlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5kaXZfc2NvcmUgPSBlbGVtZW50KHsgY2xhc3M6IFwic2NvcmVcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9zY29yZSk7XG5cbiAgdGhpcy5kaXZfc2NvcmVfZ2VtID0gZWxlbWVudCh7IGNsYXNzOiBcImdlbVwiIH0pO1xuICB0aGlzLmRpdl9zY29yZV90ZXh0ID0gZWxlbWVudCh7IGNsYXNzOiBcInRleHRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2X3Njb3JlLCB0aGlzLmRpdl9zY29yZV9nZW0pO1xuICBhcHBlbmQodGhpcy5kaXZfc2NvcmUsIHRoaXMuZGl2X3Njb3JlX3RleHQpO1xuXG4gIC8vIGFyZSB3ZSBkb2luZyBsZXZlbHNcbiAgaWYgKHRoaXMuc2NoZW1lLmxldmVscykge1xuICAgIHRoaXMuZGl2X3Njb3JlX2JhciA9IGVsZW1lbnQoeyBjbGFzczogXCJiYXJcIiB9KTtcbiAgICB0aGlzLmRpdl9zY29yZV9iYXJfaW4gPSBlbGVtZW50KHsgY2xhc3M6IFwiYmFyLWlubmVyXCIgfSk7XG4gICAgdGhpcy5kaXZfc2NvcmVfbGV2ZWwgPSBlbGVtZW50KHsgY2xhc3M6IFwibGV2ZWwgaGV4LWJ1dHRvblwiLCB0ZXh0OiBcIiBMVkxcIiB9KTtcbiAgICB0aGlzLmRpdl9zY29yZV9sZXZlbF9udW0gPSBlbGVtZW50KHsgY2xhc3M6IFwibGV2ZWwtbnVtXCIsIHRleHQ6IFwiMVwiIH0pO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfYmFyKTtcbiAgICBhcHBlbmQodGhpcy5kaXZfc2NvcmVfYmFyLCB0aGlzLmRpdl9zY29yZV9iYXJfaW4pO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfbGV2ZWwpO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZV9sZXZlbCwgdGhpcy5kaXZfc2NvcmVfbGV2ZWxfbnVtKTtcbiAgfVxufTtcblxuLyogU2V0IHNjb3JlIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X3Njb3JlID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2NvcmUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLnBsYXllcikge1xuICAgIGhpZGUodGhpcy5kaXZfc2NvcmUpO1xuICAgIHJldHVybjtcbiAgfSBlbHNlIHtcbiAgICBzaG93KHRoaXMuZGl2X3Njb3JlKTtcbiAgfVxuXG4gIHRoaXMuZGl2X3Njb3JlX3RleHQuaW5uZXJIVE1MID0gdGhpcy5wbGF5ZXIuc2NvcmU7XG4gIGlmICh0aGlzLnNjaGVtZS5sZXZlbHMpIHtcbiAgICB0aGlzLmRpdl9zY29yZV9sZXZlbF9udW0uaW5uZXJIVE1MID0gdGhpcy5wbGF5ZXIubGV2ZWwgKyAxO1xuXG4gICAgLy8gZG8gZXhwIGJhclxuICAgIHZhciB3aWR0aCA9IDA7XG4gICAgdmFyIHRoaXNfbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuc2NvcmVbdGhpcy5wbGF5ZXIubGV2ZWxdO1xuICAgIHZhciBuZXh0X2xldmVsID0gdGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlW3RoaXMucGxheWVyLmxldmVsICsgMV07XG4gICAgaWYgKHRoaXNfbGV2ZWwgJiYgbmV4dF9sZXZlbCkge1xuICAgICAgd2lkdGggPSAoXG4gICAgICAgICgodGhpcy5wbGF5ZXIuc2NvcmUgLSB0aGlzX2xldmVsKSAvIChuZXh0X2xldmVsIC0gdGhpc19sZXZlbCkpICpcbiAgICAgICAgOTRcbiAgICAgICkuZml4ZWQoKTtcbiAgICB9XG4gICAgdGhpcy5kaXZfc2NvcmVfYmFyX2luLnN0eWxlLndpZHRoID0gd2lkdGggKyBcIiVcIjtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBUaW1lclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIHRpbWUgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X3RpbWUgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLnNjaGVtZS5zaG93X3RpbWUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB0aW1lIGRpdnNcbiAgdGhpcy5kaXZfdGltZSA9IGVsZW1lbnQoeyBjbGFzczogXCJ0aW1lXCIgfSk7XG4gIHRoaXMuZGl2X3RpbWVvdXQgPSBlbGVtZW50KHsgY2xhc3M6IFwidGltZW91dFwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3RpbWUpO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3RpbWVvdXQpO1xuICBoaWRlKHRoaXMuZGl2X3RpbWVvdXQpO1xuXG4gIHRoaXMuZGlzcGxheV90aW1lID0gXCJcIjtcbn07XG5cbi8qIFJ1biB0aGUgdGltZSBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl90aW1lID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2hvd190aW1lKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNlY3M7XG5cbiAgLy8gY291bnRpbmcgdXBcbiAgaWYgKHRoaXMuc2NoZW1lLnRpbWVfbGltaXQgPT09IDApIHtcbiAgICBzZWNzID0gZmxvb3IodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC8gMjQpO1xuXG4gICAgLy8gY291bnRpbmcgZG93blxuICB9IGVsc2Uge1xuICAgIHZhciBkaWYgPSB0aGlzLnNjaGVtZS50aW1lX2xpbWl0IC0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHNlY3MgPSBjZWlsKGRpZiAvIDI0KTtcblxuICAgIC8vIHRpbWVvdXRcbiAgICBpZiAoZGlmID09PSAyNDApIHtcbiAgICAgIHNob3codGhpcy5kaXZfdGltZW91dCk7XG4gICAgfVxuICAgIGlmIChkaWYgPD0gMjQwICYmIGRpZiAlIDI0ID09PSAwICYmIGRpZiA+IDEpIHtcbiAgICAgIHRoaXMuYXVkaW8ucGxheShcImJsb29wMlwiLCAwLjUpO1xuICAgIH1cbiAgICBpZiAoZGlmID09PSAxKSB7XG4gICAgICBoaWRlKHRoaXMuZGl2X3RpbWVvdXQpO1xuICAgIH1cbiAgICBpZiAoc2VjcyA8PSAxMCkge1xuICAgICAgaWYgKGRpZiAlIDI0ID09PSAwICYmIHNlY3MgPj0gMSkge1xuICAgICAgICB0aGlzLmRpdl90aW1lb3V0LmlubmVySFRNTCA9IHNlY3M7XG4gICAgICB9XG4gICAgICBpZiAoZGlmID09PSA5Nikge1xuICAgICAgICB0aGlzLmF1ZGlvLnBsYXkoXCJ0aW1lb3V0XCIsIDAuOCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGltZVxuICB2YXIgbmV3X3RpbWUgPSBcIjA6MDBcIjtcbiAgaWYgKHNlY3MgPiAwKSB7XG4gICAgdmFyIG1pbnV0ZXMgPSBmbG9vcihzZWNzIC8gNjApLFxuICAgICAgc2Vjb25kcyA9IChzZWNzIC0gbWludXRlcyAqIDYwKS50b1N0cmluZygpO1xuICAgIHNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA8IDIgPyBcIjBcIiArIHNlY29uZHMgOiBzZWNvbmRzO1xuICAgIG5ld190aW1lID0gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcbiAgfVxuICBpZiAodGhpcy5kaXNwbGF5X3RpbWUgIT09IG5ld190aW1lKSB7XG4gICAgdGhpcy5kaXNwbGF5X3RpbWUgPSBuZXdfdGltZTtcbiAgICB0aGlzLmRpdl90aW1lLmlubmVySFRNTCA9IG5ld190aW1lO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdEF1ZGlvXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxud2luZG93LkF1ZGlvQ29udGV4dCA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcblxuZnVuY3Rpb24gYXVkaW8oYXNzZXRzX3VybCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdGhpcy5jb250ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICB0aGlzLmJ1ZmZlcnMgPSB7fTtcbiAgdGhpcy5yZXBlYXRlcnMgPSB7fTtcbiAgdGhpcy52b2x1bWUgPSAwLjE7XG4gIHRoaXMuc3RvcmVkX3ZvbHVtZSA9IDAuMTtcblxuICAvLyBidXR0b24gaG92ZXIgc3dpc2ggZXZlbnRzXG4gIHRoaXMuYnV0dG9uX2hvdmVyID0gbnVsbDtcbiAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHNlbGYudm9sdW1lID09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYnV0dG9uXCIpIHx8XG4gICAgICBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gXCJidXR0b25cIlxuICAgICkge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldCAhPSBzZWxmLmJ1dHRvbl9ob3ZlciAmJlxuICAgICAgICAhZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZGlzYWJsZWRcIilcbiAgICAgICkge1xuICAgICAgICBzZWxmLmJ1dHRvbl9ob3ZlciA9IGUudGFyZ2V0O1xuICAgICAgICBzZWxmLnBsYXkoXCJibG9vcDFcIiwgMSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuYnV0dG9uX2hvdmVyID0gbnVsbDtcbiAgICB9XG4gIH07XG59XG5cbi8qIFNldCB2b2x1bWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuc2V0X2dsb2JhbF92b2x1bWUgPSBmdW5jdGlvbih2b2wpIHtcbiAgdGhpcy52b2x1bWUgPSB2b2w7XG59O1xuXG4vKiBBZGQgYnVmZmVyc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmF1ZGlvLnByb3RvdHlwZS5hZGRfYnVmZmVycyA9IGZ1bmN0aW9uKGJ1ZmZlcnMpIHtcbiAgdGhpcy5idWZmZXJzID0gT2JqZWN0LmFzc2lnbih0aGlzLmJ1ZmZlcnMsIGJ1ZmZlcnMpO1xufTtcblxuLyogUGxheSBhIGZpbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKGtleSwgdm9sdW1lLCByZXBlYXQpIHtcbiAgLy8gaWYgbm8gc291bmQgZWZmZWN0XG4gIGlmICghdGhpcy5idWZmZXJzW2tleV0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpZiB3ZSdyZSBub3QgYWN0aXZlXG4gIGlmICghZG9jdW1lbnQuaGFzRm9jdXMoKSAmJiBrZXkgIT09IFwiam9pblwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG9iaiA9IHt9O1xuICBvYmouYXVkaW9fa2V5ID0ga2V5O1xuICBvYmouZ2FpbiA9IHRoaXMuY29udC5jcmVhdGVHYWluKCk7XG4gIG9iai5zb3VyY2UgPSB0aGlzLmNvbnQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gIG9iai5zb3VyY2UuYnVmZmVyID0gdGhpcy5idWZmZXJzW2tleV07XG4gIG9iai5zb3VyY2UuY29ubmVjdChvYmouZ2Fpbik7XG4gIG9iai5nYWluLmNvbm5lY3QodGhpcy5jb250LmRlc3RpbmF0aW9uKTtcbiAgb2JqLnNvdXJjZS5sb29wID0gcmVwZWF0O1xuICBvYmouc291cmNlLnN0YXJ0KDApO1xuXG4gIHRoaXMuc2V0X3ZvbHVtZShvYmosIHZvbHVtZSk7XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cbi8qIFNldCB2b2x1bWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuc2V0X3ZvbHVtZSA9IGZ1bmN0aW9uKG9iaiwgdm9sdW1lKSB7XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZvbHVtZSA9ICF2b2x1bWUgPyAwIDogbWluKHZvbHVtZSwgMSk7XG4gIG9iai5nYWluLmdhaW4udmFsdWUgPSAodm9sdW1lICogdGhpcy52b2x1bWUpLmZpeGVkKCk7XG59O1xuXG4vKiBTdG9wIHBsYXlpbmcgYXVkaW9cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKG9iaikge1xuICB0aGlzLmNvbnQuY2xvc2UoKTtcbiAgdGhpcy5jb250ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRFbGVtZW50IEZ1bmN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIGVsZW1lbnQocHJvcHMpIHtcbiAgLy8gY3JlYXRlIHRoZSBlbGVtZW50XG4gIHZhciB0eXBlID0gcHJvcHMudHlwZSA/IHByb3BzLnR5cGUgOiBcImRpdlwiLFxuICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTtcblxuICAvLyBzZXQgcHJvcGVydGllc1xuICBpZiAocHJvcHMuaWQpIHtcbiAgICBlbC5pZCA9IHByb3BzLmlkO1xuICB9XG4gIGlmIChwcm9wcy5zcmMpIHtcbiAgICBlbC5zcmMgPSBwcm9wcy5zcmM7XG4gIH1cbiAgaWYgKHByb3BzLmludHlwZSkge1xuICAgIGVsLnR5cGUgPSBwcm9wcy5pbnR5cGU7XG4gIH1cbiAgaWYgKHByb3BzLmNsYXNzKSB7XG4gICAgZWwuY2xhc3NOYW1lID0gcHJvcHMuY2xhc3M7XG4gIH1cbiAgaWYgKHByb3BzLnRleHQpIHtcbiAgICBlbC5pbm5lckhUTUwgPSBwcm9wcy50ZXh0O1xuICB9XG4gIGlmIChwcm9wcy52YWx1ZSkge1xuICAgIGVsLnZhbHVlID0gcHJvcHMudmFsdWU7XG4gIH1cbiAgaWYgKHByb3BzLmRhdGEpIHtcbiAgICBlbC5kYXRhc2V0LmRhdGEgPSBwcm9wcy5kYXRhO1xuICB9XG4gIGlmIChwcm9wcy5wbGFjZWhvbGRlcikge1xuICAgIGVsLnBsYWNlaG9sZGVyID0gcHJvcHMucGxhY2Vob2xkZXI7XG4gIH1cbiAgaWYgKHByb3BzLm1heGxlbmd0aCkge1xuICAgIGVsLm1heExlbmd0aCA9IHByb3BzLm1heGxlbmd0aDtcbiAgfVxuICBpZiAocHJvcHMuaHJlZikge1xuICAgIGVsLmhyZWYgPSBwcm9wcy5ocmVmO1xuICB9XG5cbiAgcmV0dXJuIGVsO1xufVxuXG5mdW5jdGlvbiBzZWxlY3QoaWQpIHtcbiAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbn1cblxuZnVuY3Rpb24gaGlkZShlbCkge1xuICBlbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG59XG5cbmZ1bmN0aW9uIHNob3coZWwpIHtcbiAgZWwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlKGVsKSB7XG4gIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xufVxuXG5mdW5jdGlvbiBlbXB0eShlbCkge1xuICB3aGlsZSAoZWwuZmlyc3RDaGlsZCkge1xuICAgIGVsLnJlbW92ZUNoaWxkKGVsLmZpcnN0Q2hpbGQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFwcGVuZChwYXJlbnQsIGNoaWxkKSB7XG4gIHBhcmVudC5hcHBlbmRDaGlsZChjaGlsZCk7XG59XG5cbmZ1bmN0aW9uIGFkZF9jbGFzcyhlbCwgY2xhc3NfbmFtZSkge1xuICB2YXIgc3BsaXQgPSBlbC5jbGFzc05hbWUuc3BsaXQoXCIgXCIpO1xuICBpZiAoIXNwbGl0LmluY2x1ZGVzKGNsYXNzX25hbWUpKSB7XG4gICAgc3BsaXQucHVzaChjbGFzc19uYW1lKTtcbiAgfVxuICBlbC5jbGFzc05hbWUgPSBzcGxpdC5qb2luKFwiIFwiKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlX2NsYXNzKGVsLCBjbGFzc19uYW1lKSB7XG4gIHZhciBzcGxpdCA9IGVsLmNsYXNzTmFtZS5zcGxpdChcIiBcIiksXG4gICAgaSA9IHNwbGl0LmluZGV4T2YoY2xhc3NfbmFtZSk7XG4gIGlmIChpICE9IC0xKSB7XG4gICAgc3BsaXQuc3BsaWNlKGksIDEpO1xuICB9XG4gIGVsLmNsYXNzTmFtZSA9IHNwbGl0LmpvaW4oXCIgXCIpO1xufVxuXG5mdW5jdGlvbiBkaXNwbGF5X3RpbWUoZnJhbWVzKSB7XG4gIHZhciBzZWNzID0gZmxvb3IoZnJhbWVzIC8gMzApO1xuICB2YXIgbWludXRlcyA9IGZsb29yKHNlY3MgLyA2MCk7XG4gIHZhciBzZWNvbmRzID0gKHNlY3MgLSBtaW51dGVzICogNjApLnRvU3RyaW5nKCk7XG4gIHNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA8IDIgPyBcIjBcIiArIHNlY29uZHMgOiBzZWNvbmRzO1xuICByZXR1cm4gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcbn1cblxuZnVuY3Rpb24gZGVidWcoczEsIHMyLCBzMywgczQsIHM1LCBzNiwgczcsIHM4LCBzOSwgYnIpIHtcbiAgdmFyIGUgPSBzZWxlY3QoXCJkZWJ1Z1wiKTtcbiAgaWYgKGJyKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCI8YnI+XCI7XG4gIH0gZWxzZSB7XG4gICAgZS5pbm5lckhUTUwgPSBcIlwiO1xuICB9XG4gIGlmIChzMSAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBzMTtcbiAgfVxuICBpZiAoczIgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHMyO1xuICB9XG4gIGlmIChzMyAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczM7XG4gIH1cbiAgaWYgKHM0ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzNDtcbiAgfVxuICBpZiAoczUgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM1O1xuICB9XG4gIGlmIChzNiAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczY7XG4gIH1cbiAgaWYgKHM3ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzNztcbiAgfVxuICBpZiAoczggIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM4O1xuICB9XG4gIGlmIChzOSAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZGVidWdicihzMSwgczIsIHMzLCBzNCwgczUsIHM2LCBzNywgczgsIHM5KSB7XG4gIGRlYnVnKHMxLCBzMiwgczMsIHM0LCBzNSwgczYsIHM3LCBzOCwgczksIHRydWUpO1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdElucHV0XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gaW5wdXQoY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG5cbiAgLy8gZGVmYXVsdCBhY3Rpb24ga2V5c1xuICB0aGlzLmFjdGlvbl9rZXlzID0ge1xuICAgIG1vdmU6IFtcIjBcIl0sIC8vIGNsaWNrXG4gICAgc2hvb3Q6IFtcIjJcIiwgW1wiMFwiLCBcIjE3XCJdLCBbXCIwXCIsIFwiMThcIl0sIFtcIjBcIiwgXCI5MVwiXV0sIC8vIGNsaWNrLCBjdHJsLCBhbHQsIGNtZFxuICAgIGp1bXA6IFtcIjMyXCJdLCAvLyBzcGFjZVxuICAgIHN3aXRjaF93YXRjaGVyX2NhbWVyYTogW1wiODBcIl0sIC8vIHBcbiAgICBmb2xsb3dfd2VhcG9uOiBbXCI3MFwiXSwgLy8gZlxuICAgIGZvbGxvd19tb3VzZTogW1wiMVwiXSwgLy8gbWlkZGxlIGNsaWNrXG4gICAgLy8gbW92ZV9sZWZ0OiBbXCIzN1wiLCBcIjY1XCJdLCAvLyBsZWZ0LCBhXG4gICAgLy8gbW92ZV91cDogW1wiMzhcIiwgXCI4N1wiXSwgLy8gdXAsIHdcbiAgICAvLyBtb3ZlX3JpZ2h0OiBbXCIzOVwiLCBcIjY4XCJdLCAvLyByaWdodCwgZFxuICAgIC8vIG1vdmVfZG93bjogW1wiNDBcIiwgXCI4M1wiXSwgLy8gZG93biwgc1xuICAgIHNob3dfc2V0dGluZ3M6IFtcIjI3XCIsIFwiMTNcIl0sIC8vIGVzYywgZW50ZXJcbiAgICB3ZWFwb25fc2VsZWN0XzE6IFtcIjQ5XCJdLCAvLyAxXG4gICAgd2VhcG9uX3NlbGVjdF8yOiBbXCI1MFwiXSwgLy8gMlxuICAgIHdlYXBvbl9zZWxlY3RfMzogW1wiNTFcIl0sIC8vIDNcbiAgICB3ZWFwb25fc2VsZWN0XzQ6IFtcIjUyXCJdLCAvLyA0XG4gICAgd2VhcG9uX3NlbGVjdF81OiBbXCI1M1wiXSwgLy8gNVxuICAgIHdlYXBvbl9zZWxlY3RfNjogW1wiNTRcIl0sIC8vIDZcbiAgICB3ZWFwb25fc2VsZWN0Xzc6IFtcIjU1XCJdLCAvLyA3XG4gICAgd2VhcG9uX3NlbGVjdF84OiBbXCI1NlwiXSwgLy8gOFxuICAgIHdlYXBvbl9zZWxlY3RfOTogW1wiNTdcIl0gLy8gOVxuICB9O1xuXG4gIC8vIHNldCB1cCByZWZlcmVuY2UgZm9yIHByZXNzZWQga2V5IGNvZGVzXG4gIHRoaXMua2V5X2NvZGVzID0ge307XG5cbiAgLy8gY3Vyc29yXG4gIHRoaXMuY3Vyc29yX21vdmVkID0gZmFsc2U7XG4gIHRoaXMuY3Vyc29yID0geyB4OiAwLCB5OiAwIH07XG5cbiAgLy8gc2V0IGN1cnNvciBwb2ludHNcbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwiZ2FtZV9pbnB1dFwiKSB7XG4gICAgICBzZWxmLmlucHV0X2N1cnNvcihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgfVxuICB9O1xuXG4gIC8vIHByZXZlbnQgZGVmYXVsdCByaWdodCBjbGljayBiZWhhdmlvdXJcbiAgZG9jdW1lbnQuYm9keS5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLy8gbWFuYWdlIGNsaWNrIGV2ZW50c1xuICBkb2N1bWVudC5ib2R5Lm9ubW91c2Vkb3duID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5pZCA9PT0gXCJnYW1lX2lucHV0XCIpIHtcbiAgICAgIHNlbGYuaW5wdXRfYnV0dG9uKGUuYnV0dG9uLCBcImRvd25cIik7XG4gICAgfVxuICAgIGlmIChlLmJ1dHRvbiA9PSAxKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuICBkb2N1bWVudC5ib2R5Lm9ubW91c2V1cCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmlucHV0X2J1dHRvbihlLmJ1dHRvbiwgXCJ1cFwiKTtcbiAgfTtcblxuICAvLyBtb3VzZSB3aGVlbFxuICBpZiAoXCJvbm1vdXNld2hlZWxcIiBpbiBkb2N1bWVudC5ib2R5KSB7XG4gICAgZG9jdW1lbnQuYm9keS5vbm1vdXNld2hlZWwgPSBmdW5jdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogKGUucmV0dXJuVmFsdWUgPSBmYWxzZSk7XG4gICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICBzZWxmLnNjcm9sbF93aGVlbChlKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTU1vdXNlU2Nyb2xsXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHNlbGYuc2Nyb2xsX3doZWVsKGUpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gbWFuYWdlIGtleWJvYXJkIGV2ZW50c1xuICBkb2N1bWVudC5ib2R5Lm9ua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmlucHV0X2J1dHRvbihlLmtleUNvZGUsIFwiZG93blwiKTtcbiAgfTtcbiAgZG9jdW1lbnQuYm9keS5vbmtleXVwID0gZnVuY3Rpb24oZSkge1xuICAgIHNlbGYuaW5wdXRfYnV0dG9uKGUua2V5Q29kZSwgXCJ1cFwiKTtcbiAgfTtcblxuICAvLyB0dXJuIG9mZiBpbnB1dCB3aGVuIHdpbmRvdyBpcyBub3QgZm9jdXNlZFxuICB3aW5kb3cub25ibHVyID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5pbnB1dF9yZXNldCgpO1xuICB9O1xufVxuXG4vKiBJcyBhbiBhY3Rpb24gYWN0aXZlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmFjdGl2ZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgY29uc3QgYWN0aW9uID0gdGhpcy5hY3Rpb25fa2V5c1t0eXBlXTtcbiAgaWYgKCFhY3Rpb24pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3Rpb24ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjb2RlcyA9IGFjdGlvbltpXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb2RlcykpIHtcbiAgICAgIGxldCB0cmlnZ2VyID0gdHJ1ZTtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBjb2Rlcy5sZW5ndGg7IGkyKyspIHtcbiAgICAgICAgY29uc3QgY29kZSA9IGNvZGVzW2kyXTtcbiAgICAgICAgaWYgKCF0aGlzLmtleV9jb2Rlc1tjb2RlXSkge1xuICAgICAgICAgIHRyaWdnZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRyaWdnZXIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmtleV9jb2Rlc1tjb2Rlc10pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKiBGaW5kIHRoZSBhY3Rpb24gb2YgYSBjb2RlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmZpbmRfYWN0aW9uID0gZnVuY3Rpb24oY29kZSkge1xuICBjb25zdCBhY3Rpb25zID0gW107XG4gIGZvciAobGV0IGtleSBpbiB0aGlzLmFjdGlvbl9rZXlzKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFjdGlvbl9rZXlzW2tleV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNvZGVzID0gdGhpcy5hY3Rpb25fa2V5c1trZXldW2ldO1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvZGVzKSAmJiBTdHJpbmcoY29kZXMpID09PSBTdHJpbmcoY29kZSkpIHtcbiAgICAgICAgY29uc3Qgb2JqID0geyB0eXBlOiBrZXkgfTtcbiAgICAgICAgLy8gaWYgKGtleSA9PSBcInNob3dfc2V0dGluZ3NcIikge1xuICAgICAgICAvLyAgIGlmICh0aGlzLmFjdGlvbnMuc2hvb3QpIHtcbiAgICAgICAgLy8gICAgIHJldHVybiBbXTtcbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vIH1cblxuICAgICAgICAvLyBwbGVhc2UgZG9uJ3QgdGVsbCBhbnlib2R5IEkgZGlkIHRoaXNcbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfMVwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfMlwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfM1wiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfNFwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfNVwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfNlwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfN1wiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDY7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfOFwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvbl9zZWxlY3RfOVwiKSB7XG4gICAgICAgICAgb2JqLnR5cGUgPSBcIndlYXBvbl9zZWxlY3RcIjtcbiAgICAgICAgICBvYmoubiA9IDg7XG4gICAgICAgIH1cbiAgICAgICAgYWN0aW9ucy5wdXNoKG9iaik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBhY3Rpb25zO1xufTtcblxuLyogUHJvY2VzcyBpbnB1dCBldmVudHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuaW5wdXRfYnV0dG9uID0gZnVuY3Rpb24oY29kZSwgdHlwZSkge1xuICAvLyBpZ25vcmUgaW5wdXQgb24gYSB0ZXh0IGJveFxuICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0eXBlID09IFwidXBcIikge1xuICAgIHRoaXMua2V5X2NvZGVzW2NvZGVdID0gZmFsc2U7XG4gIH1cbiAgaWYgKHR5cGUgPT0gXCJkb3duXCIpIHtcbiAgICB0aGlzLmtleV9jb2Rlc1tjb2RlXSA9IHRydWU7XG4gICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuZmluZF9hY3Rpb24oY29kZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrKGFjdGlvbnNbaV0pO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ3Vyc29yIG1vdmVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5pbnB1dF9jdXJzb3IgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHRoaXMuY3Vyc29yX21vdmVkID0gdHJ1ZTtcbiAgdGhpcy5jdXJzb3IueCA9IHg7XG4gIHRoaXMuY3Vyc29yLnkgPSB5O1xufTtcblxuLyogU2Nyb2xsIHdoZWVsXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuc2Nyb2xsX3doZWVsID0gZnVuY3Rpb24oZSkge1xuICAvLyBub3JtYWxpemUgZGVsdGEgZm9yIGNyb3NzIGJyb3dzZXJcbiAgdmFyIGQgPSBlLmRldGFpbCxcbiAgICB3ID0gZS53aGVlbERlbHRhLFxuICAgIGQgPSBkID8gKHcgJiYgKGYgPSB3IC8gZCkgPyBkIC8gZiA6IC1kIC8gMS4zNSkgOiB3IC8gMTIwO1xuXG4gIC8vIHVwIG9yIGRvd25cbiAgdmFyIGRvd24gPSBkIDwgMCA/IHRydWUgOiBmYWxzZTtcblxuICAvLyBldmVudFxuICB0aGlzLmNhbGxiYWNrKHsgdHlwZTogXCJ3ZWFwb25fc2Nyb2xsXCIsIGRvd246IGRvd24gfSk7XG59O1xuXG4vKiBSZXNldCBhY3Rpb25zXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuaW5wdXRfcmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgZm9yIChrZXkgaW4gdGhpcy5rZXlfY29kZXMpIHtcbiAgICB0aGlzLmtleV9jb2Rlc1trZXldID0gZmFsc2U7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0QXNzZXQgTG9hZGVyXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gbG9hZGVyKGFzc2V0c191cmwsIGFzc2V0cywgb25sb2FkKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBzZXQgdXAgbG9hZGluZyB2YWx1ZXNcbiAgdGhpcy5vbmxvYWQgPSBvbmxvYWQ7XG4gIHRoaXMub3V0cHV0ID0ge307XG4gIHRoaXMubG9hZGVkID0gMDtcbiAgdGhpcy5jb3VudCA9IDA7XG4gIGZvciAodmFyIHR5cGUgaW4gYXNzZXRzKSB7XG4gICAgdGhpcy5jb3VudCArPSBPYmplY3Qua2V5cyhhc3NldHNbdHlwZV0pLmxlbmd0aDtcbiAgICB0aGlzLm91dHB1dFt0eXBlXSA9IHt9O1xuICB9XG5cbiAgLy8gc2V0IHVwIGF1ZGlvXG4gIGlmIChhc3NldHMuYXVkaW8pIHtcbiAgICBpZiAoT2JqZWN0LmtleXMoYXNzZXRzLmF1ZGlvKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmF1ZGlvX2NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGhlIGxvYWRpbmdcbiAgZm9yICh2YXIgdHlwZSBpbiBhc3NldHMpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gYXNzZXRzW3R5cGVdKSB7XG4gICAgICB2YXIgdXJsID0gYXNzZXRzX3VybCArIGFzc2V0c1t0eXBlXVtrZXldO1xuICAgICAgaWYgKHR5cGUgPT0gXCJqc29uXCIpIHtcbiAgICAgICAgdGhpcy5qc29uKHVybCwgdHlwZSwga2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09IFwiaW1nXCIpIHtcbiAgICAgICAgdGhpcy5pbWFnZSh1cmwsIHR5cGUsIGtleSk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PSBcImF1ZGlvXCIpIHtcbiAgICAgICAgdGhpcy5hdWRpbyh1cmwsIHR5cGUsIGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qIExvYWQgSlNPTlxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmxvYWRlci5wcm90b3R5cGUuanNvbiA9IGZ1bmN0aW9uKHVybCwgdHlwZSwga2V5KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICByZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcbiAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09IDQgJiYgcmVxdWVzdC5zdGF0dXMgPT0gXCIyMDBcIikge1xuICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICBzZWxmLm91dHB1dFt0eXBlXVtrZXldID0gcmVzcG9uc2U7XG4gICAgICBzZWxmLmNoZWNrX2xvYWRlZCgpO1xuICAgIH1cbiAgfTtcbiAgcmVxdWVzdC5zZW5kKG51bGwpO1xufTtcblxuLyogTG9hZCBJbWFnZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmxvYWRlci5wcm90b3R5cGUuaW1hZ2UgPSBmdW5jdGlvbih1cmwsIHR5cGUsIGtleSkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdGhpcy5vdXRwdXRbdHlwZV1ba2V5XSA9IG5ldyBJbWFnZSgpO1xuICB0aGlzLm91dHB1dFt0eXBlXVtrZXldLnNyYyA9IHVybDtcblxuICAvLyB3aGVuIGltYWdlIGlzIGxvYWRlZFxuICB0aGlzLm91dHB1dFt0eXBlXVtrZXldLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuY2hlY2tfbG9hZGVkKCk7XG4gIH07XG59O1xuXG4vKiBMb2FkIEF1ZGlvXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubG9hZGVyLnByb3RvdHlwZS5hdWRpbyA9IGZ1bmN0aW9uKHVybCwgdHlwZSwga2V5KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcbiAgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XG4gIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5hdWRpb19jb250ZXh0LmRlY29kZUF1ZGlvRGF0YShyZXF1ZXN0LnJlc3BvbnNlLCBmdW5jdGlvbihidWZmZXIpIHtcbiAgICAgIGlmIChidWZmZXIpIHtcbiAgICAgICAgdmFyIGZpbGUgPSBzZWxmLmF1ZGlvX2NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgIGZpbGUuYnVmZmVyID0gYnVmZmVyO1xuICAgICAgICBmaWxlLmNvbm5lY3Qoc2VsZi5hdWRpb19jb250ZXh0LmRlc3RpbmF0aW9uKTtcblxuICAgICAgICB2YXIgZ2FpbiA9IHNlbGYuYXVkaW9fY29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgIGZpbGUuY29ubmVjdChnYWluKTtcbiAgICAgICAgZ2Fpbi5jb25uZWN0KHNlbGYuYXVkaW9fY29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgICAgZmlsZS5sb29wID0gdHJ1ZTtcblxuICAgICAgICAvLyBnYWluLmdhaW4udmFsdWUgPSAxO1xuICAgICAgICAvLyBmaWxlLnN0YXJ0KDApO1xuXG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XSA9IHRoaXMuY29udC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgLy8gdGhpcy5maWxlc1trZXldLmJ1ZmZlciA9IGZpbGVzW2tleV07XG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XS5jb25uZWN0KHRoaXMuY29udC5kZXN0aW5hdGlvbik7XG5cbiAgICAgICAgLy8gLy8gc2V0IHVwIGdhaW4gbm9kZVxuICAgICAgICAvLyB0aGlzLmdhaW5ba2V5XSA9IHRoaXMuY29udC5jcmVhdGVHYWluKCk7XG4gICAgICAgIC8vIHRoaXMuZmlsZXNba2V5XS5jb25uZWN0KHRoaXMuZ2FpbltrZXldKTtcbiAgICAgICAgLy8gdGhpcy5nYWluW2tleV0uY29ubmVjdCh0aGlzLmNvbnQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgIHNlbGYub3V0cHV0LmF1ZGlvW2tleV0gPSBidWZmZXI7XG4gICAgICAgIHNlbGYuY2hlY2tfbG9hZGVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJlcXVlc3Quc2VuZChudWxsKTtcbn07XG5cbi8qIENoZWNrIEFzc2V0cyBBcmUgTG9hZGVkXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubG9hZGVyLnByb3RvdHlwZS5jaGVja19sb2FkZWQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5sb2FkZWQrKztcblxuICAvLyBpZiB3ZSBhcmUgbm90IHJlYWR5IHlldFxuICBpZiAodGhpcy5jb3VudCA8PSB0aGlzLmxvYWRlZCkge1xuICAgIHRoaXMub25sb2FkKHRoaXMub3V0cHV0KTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE9uYm9hcmRpbmdcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBvbmJvYXJkaW5nKCkge1xuICB0aGlzLmNvdW50ID0gMDtcbiAgdGhpcy5kb25lID0gZmFsc2U7XG4gIHRoaXMuYWN0aW9uID0ge1xuICAgIG1vdmU6IGZhbHNlLFxuICAgIGp1bXA6IGZhbHNlLFxuICAgIHNob290OiBmYWxzZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgU3RvcmFnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHRoaXMuY291bnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInBhbnRzX29uYm9hcmRpbmdcIikgfHwgMDtcbiAgICB0aGlzLmRvbmUgPSB0aGlzLmNvdW50ID4gMTtcbiAgfVxufVxuXG4vKiBUcmlnZ2VyIG9uYm9hcmRpbmduZXNzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxub25ib2FyZGluZy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24odHlwZSkge1xuICBpZiAodGhpcy5kb25lKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHRoaXMuYWN0aW9uW3R5cGVdID0gdHJ1ZTtcbiAgZm9yIChsZXQga2V5IGluIHRoaXMuYWN0aW9uKSB7XG4gICAgaWYgKCF0aGlzLmFjdGlvbltrZXldKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIHRoaXMuZG9uZSA9IHRydWU7XG4gIGlmICh0eXBlb2YgU3RvcmFnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwicGFudHNfb25ib2FyZGluZ1wiLCB0aGlzLmNvdW50ICsgMSk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBTb2NrZXQgTWVzc2FnZXNcbiAgICBoYW5kbGUgY29ubmVjdGlvbiBhbmQgbWVzc2FnZSBkYXRhIHRvIGFuZCBmcm9tIHRoZSBzZXJ2ZXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBTb2NrZXRDb25uZWN0aW9uKGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBzb2NrZXQgY29ubmVjdGlvblxuICB0aGlzLmlvID0gaW8oRE9NQUlOICsgXCI6XCIgKyBQT1JUKTtcbiAgdGhpcy5pby5vbihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24obWVzc2FnZSkge1xuICAgIHNlbGYubWVzc2FnZV9yZWNlaXZlKG1lc3NhZ2UpO1xuICB9KTtcbiAgdGhpcy5pby5vbihcImRpc2Nvbm5lY3RcIiwgZnVuY3Rpb24oKSB7XG4gICAgY2FsbGJhY2soeyB0eXBlOiBcIndhaXRfZm9yX2Nvbm5lY3Rpb25cIiB9KTtcbiAgfSk7XG5cbiAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuXG4gIC8vIGlkc1xuICB0aGlzLm1lc3NhZ2VfcmVjZWl2ZV9pZHMgPSBbXG4gICAgXCJmdWxsXCIsXG4gICAgXCJjb25uZWN0ZWRcIixcbiAgICBcInBsYXllcl9qb2luXCIsXG4gICAgXCJwbGF5ZXJfbGVhdmVcIixcbiAgICBcImdhbWVfd2FpdFwiLFxuICAgIFwiZ2FtZV9zdGFydFwiLFxuICAgIFwiZ2FtZV9lbmRcIixcbiAgICBcImdhbWVfc3RhdGVcIixcbiAgICBcInBpbmdcIlxuICBdO1xuXG4gIHRoaXMubWVzc2FnZV9zZW5kX2lkcyA9IFtcbiAgICBcIndhdGNoZXJcIixcbiAgICBcInNlbmRfbmFtZVwiLFxuICAgIFwicGxheWVyX2lucHV0XCIsXG4gICAgXCJ3ZWFwb25fc2VsZWN0ZWRcIixcbiAgICBcInJlc3Bhd25cIixcbiAgICBcInBpbmdcIlxuICBdO1xuXG4gIC8vIHN0cmluZyBzZXBhcmF0b3JcbiAgdGhpcy5tZXNzYWdlX3NlcGFyYXRvciA9IFwifFwiO1xufVxuXG4vKiBTZW5kIG1lc3NhZ2VzIHRvIHNlcnZlclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblNvY2tldENvbm5lY3Rpb24ucHJvdG90eXBlLm1lc3NhZ2Vfc2VuZCA9IGZ1bmN0aW9uKHR5cGUsIHByb3BzKSB7XG4gIHZhciBpID0gdGhpcy5tZXNzYWdlX3NlbmRfaWRzLmluZGV4T2YodHlwZSk7XG5cbiAgLy8gaWYgbm90IGEgdmFsaWQgbWVzc2FnZVxuICBpZiAoaSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNlbmQgbWVzc2FnZVxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtZXNzYWdlID0gaSArIHRoaXMubWVzc2FnZV9zZXBhcmF0b3IgKyBwcm9wcy5qb2luKHRoaXMubWVzc2FnZV9zZXBhcmF0b3IpO1xuICBpZiAodGhpcy5sYWcpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5pby5zZW5kKG1lc3NhZ2UpO1xuICAgIH0sIHRoaXMubGFnKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmlvLnNlbmQobWVzc2FnZSk7XG4gIH1cbn07XG5cbi8qIFJlY2VpdmUgbWVzc2FnZXMgZnJvbSBzZXJ2ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5Tb2NrZXRDb25uZWN0aW9uLnByb3RvdHlwZS5tZXNzYWdlX3JlY2VpdmUgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gIC8vIGdldCB0eXBlIG9mIG1lc3NhZ2UgZnJvbSBpZFxuICB2YXIgc3BsaXQgPSBtZXNzYWdlLnNwbGl0KHRoaXMubWVzc2FnZV9zZXBhcmF0b3IpO1xuICB2YXIgaWQgPSBwYXJzZUludChzcGxpdFswXSk7XG5cbiAgLy8gaWYgbm90IHZhbGlkIGlkXG4gIGlmICghdGhpcy5tZXNzYWdlX3JlY2VpdmVfaWRzW2lkXSkge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgdHlwZSA9IHRoaXMubWVzc2FnZV9yZWNlaXZlX2lkc1tpZF07XG4gIHZhciBldmVudCA9IHsgdHlwZTogdHlwZSB9O1xuXG4gIC8vIHByZXBhcmUgaW5mb3JtYXRpb24gZm9yIGV2ZW50IGhhbmRsZXJcbiAgaWYgKHR5cGUgPT09IFwiZnVsbFwiKSB7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJjb25uZWN0ZWRcIikge1xuICAgIGV2ZW50LnBsYXllcl9pZCA9IHNwbGl0WzFdID09PSBcIm51bGxcIiA/IG51bGwgOiBwYXJzZUludChzcGxpdFsxXSk7XG4gICAgZXZlbnQubmFtZSA9IHNwbGl0WzJdO1xuICAgIGV2ZW50LnBsYXllcnMgPSBzcGxpdFszXTtcbiAgICBldmVudC5zY2hlbWUgPSBzcGxpdFs0XTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcInBsYXllcl9qb2luXCIpIHtcbiAgICBldmVudC51c2VyX2lkID0gc3BsaXRbMV07XG4gICAgZXZlbnQubmFtZSA9IHNwbGl0WzJdO1xuICAgIGV2ZW50LnBsYXllcl9pZCA9IHBhcnNlSW50KHNwbGl0WzNdKTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcInBsYXllcl9sZWF2ZVwiKSB7XG4gICAgZXZlbnQudXNlcl9pZCA9IHNwbGl0WzFdO1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiZ2FtZV93YWl0XCIpIHtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImdhbWVfc3RhcnRcIikge1xuICAgIGV2ZW50LnJlc2V0X3BsYXllcnMgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gICAgZXZlbnQuYmdfc3RyID0gc3BsaXRbMl07XG4gICAgZXZlbnQuZmdfc3RyID0gc3BsaXRbM107XG4gICAgZXZlbnQuZ3Jhdml0eV9tYXAgPSBzcGxpdFs0XTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImdhbWVfZW5kXCIpIHtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImdhbWVfc3RhdGVcIikge1xuICAgIGV2ZW50LmZyYW1lcyA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgICBldmVudC5zdGF0ZSA9IHNwbGl0WzJdO1xuICAgIGV2ZW50LnJlc3BvbnNlcyA9IHNwbGl0WzNdO1xuICAgIGV2ZW50LmRhbWFnZXMgPSBzcGxpdFs0XTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcInBpbmdcIikge1xuICAgIGV2ZW50LmZyYW1lID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICB9XG5cbiAgLy8gcnVuIGV2ZW50XG4gIHRoaXMuY2FsbGJhY2soZXZlbnQpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bHRpcGxheWVyXG4gICAgUGxheWVyIERlYXRoc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENoZWNrIGlmIHdlJ3JlIGRlYWRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5mcmFtZV9kZWFkID0gZnVuY3Rpb24oKSB7XG4gIC8vIG5vdCByZWFkeSBmb3IgYW55IGRlYXRoIHN0dWZmXG4gIGlmICghdGhpcy5nYW1lIHx8ICF0aGlzLmdhbWUuY29yZSB8fCAhdGhpcy5nYW1lLnBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNvdW50IHVwIHRvIGRlYWRuZXNzXG4gIGlmICh0aGlzLmdhbWUucGxheWVyLmRlYWQpIHtcbiAgICBpZiAoIXRoaXMuZGVhZCkge1xuICAgICAgaWYgKHRoaXMud2FpdF9mb3JfZGVhZCA8IDQ4KSB7XG4gICAgICAgIHRoaXMud2FpdF9mb3JfZGVhZCsrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kZWF0aCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aGlzLndhaXRfZm9yX2RlYWQgPSAwO1xuICAgIGlmICh0aGlzLmRlYWQpIHtcbiAgICAgIHRoaXMucmVzcGF3bigpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGRlYWRuZXNzXG4gIGlmICh0aGlzLmRlYWQpIHtcbiAgICBpZiAodGhpcy53YWl0X2Zvcl9yZXNwYXduID4gMCkge1xuICAgICAgdGhpcy53YWl0X2Zvcl9yZXNwYXduLS07XG4gICAgICBpZiAodGhpcy53YWl0X2Zvcl9yZXNwYXduID09PSAwKSB7XG4gICAgICAgIHRoaXMuZGl2X2RlYWRfY291bnRkb3duLmlubmVySFRNTCA9IFwiQ2xpY2sgdG8gcmVzcGF3blwiO1xuICAgICAgICByZW1vdmVfY2xhc3ModGhpcy5idXR0b25fcmVzcGF3biwgXCJkaXNhYmxlZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGl2X2RlYWRfY291bnRkb3duLmlubmVySFRNTCA9XG4gICAgICAgICAgXCJSZXNwYXduIGluIFwiICsgY2VpbCh0aGlzLndhaXRfZm9yX3Jlc3Bhd24gLyAyNCkgKyBcIiBzZWNvbmRzXCI7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKiBXZSBoYXZlIGRpZWRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5kZWF0aCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRlYWQgPSB0cnVlO1xuICB0aGlzLndhaXRfZm9yX2RlYWQgPSAwO1xuICB0aGlzLndhaXRfZm9yX3Jlc3Bhd24gPSA5NjtcblxuICBoaWRlKHRoaXMuZGl2X2RlYWRfdGV4dCk7XG4gIGFkZF9jbGFzcyh0aGlzLmJ1dHRvbl9yZXNwYXduLCBcImRpc2FibGVkXCIpO1xuICBzaG93KHRoaXMuZGl2X2RlYWQpO1xufTtcblxuLyogUmVzcGF3biB0cmlnZ2VyZWRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNwYXduID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZGVhZCA9IGZhbHNlO1xuICBoaWRlKHRoaXMuZGl2X2RlYWQpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bHRpcGxheWVyXG4gICAgRXZlbnRzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIGV2ZW50c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJ1bl9ldmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmICghZXZlbnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBoYW5kbGUgYXJyYXlzIG9mIGV2ZW50c1xuICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudChldmVudFtpXSk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJ1biBldmVudHNcbiAgaWYgKGV2ZW50LnR5cGUgPT09IFwiZnVsbFwiKSB7XG4gICAgdGhpcy5nYW1lX2Z1bGwoKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImNvbm5lY3RlZFwiKSB7XG4gICAgdGhpcy5jb25uZWN0ZWQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwid2FpdF9mb3JfY29ubmVjdGlvblwiKSB7XG4gICAgdGhpcy53YWl0X2Zvcl9jb25uZWN0aW9uKCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJwbGF5ZXJfam9pblwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfam9pbihldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJwbGF5ZXJfbGVhdmVcIikge1xuICAgIHRoaXMucGxheWVyX2xlYXZlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdhbWVfd2FpdFwiKSB7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJnYW1lX3N0YXJ0XCIpIHtcbiAgICB0aGlzLmdhbWVfc3RhcnQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2FtZV9lbmRcIikge1xuICAgIHRoaXMuZ2FtZV9lbmQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2FtZV9zdGF0ZVwiKSB7XG4gICAgdGhpcy5nYW1lX3N0YXRlX3JlY2VpdmVkKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImNvbGxlY3RcIikge1xuICAgIHRoaXMuZXZlbnRfY29sbGVjdChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJncm91bmRfZGFtYWdlXCIpIHtcbiAgICB0aGlzLmV2ZW50X2dyb3VuZF9kYW1hZ2UoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2RlYXRoXCIpIHtcbiAgICB0aGlzLmV2ZW50X3BsYXllcl9kZWF0aChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3ZWFwb25fc2VsZWN0ZWRcIikge1xuICAgIHRoaXMuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJ3ZWFwb25fc2VsZWN0ZWRcIiwgW2V2ZW50LndlYXBvbl0pO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGluZ1wiKSB7XG4gICAgdGhpcy5ldmVudF9waW5nKGV2ZW50KTtcbiAgfVxuXG4gIC8vIHNlbmQgZXZlbnQgZG93biBhIGxldmVsXG4gIGVsc2UgaWYgKHRoaXMuZ2FtZSkge1xuICAgIHRoaXMuZ2FtZS5ydW5fZXZlbnQoZXZlbnQpO1xuICB9XG59O1xuXG4vKiBDb2xsZWN0ZWQgaXRlbVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmV2ZW50X2NvbGxlY3QgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAodGhpcy5pbml0aWFsaXNlZCkge1xuICAgIC8vIHdhaXQgdG8gcmVjcmVhdGVcbiAgICB0aGlzLndhaXRfdG9fY3JlYXRlW2V2ZW50Lm9ial0gPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5mcmFtZTtcblxuICAgIC8vIHJ1biBjbGllbnQgY29sbGVjdGlvbiBldmVudHNcbiAgICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcblxuICAgIC8vIHJ1biBwbGF5ZXJzIGludGVyZmFjZVxuICAgIHRoaXMucGxheWVyc19pbnRlcmZhY2UoKTtcbiAgfVxufTtcblxuLyogUGxheWVyIGRlYXRoXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZXZlbnRfcGxheWVyX2RlYXRoID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gb25seSB1c2Ugc2VydmVyIGV2ZW50c1xuICBpZiAoIWV2ZW50LmZyb21fc2VydmVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcnVuIGl0XG4gIGlmICh0aGlzLmluaXRpYWxpc2VkKSB7XG4gICAgdGhpcy5wbGF5ZXJfZGVhdGgoZXZlbnQpO1xuICB9XG59O1xuXG4vKiBQaW5nXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZXZlbnRfcGluZyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGRpZCB3ZSByZXF1ZXN0IHRoaXNcbiAgaWYgKCF0aGlzLnBpbmdzW2V2ZW50LmZyYW1lXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuICAvLyByZWNvcmQgZW5kIHRpbWUgZm9yIHBpbmdcbiAgdGhpcy5waW5nc1tldmVudC5mcmFtZV0uZW5kID0gbm93O1xuXG4gIC8vIGdvIHRocm91Z2ggYWxsIHBpbmdzXG4gIHZhciBwaW5nX2NvdW50ID0gMDtcbiAgdmFyIHBpbmdfdG90YWwgPSAwO1xuICBmb3IgKHZhciBmcmFtZSBpbiB0aGlzLnBpbmdzKSB7XG4gICAgdmFyIHBpbmcgPSB0aGlzLnBpbmdzW2ZyYW1lXTtcblxuICAgIC8vIHJlbW92ZSBvbGQgb25lc1xuICAgIGlmIChwaW5nLmVuZCAmJiBwaW5nLmVuZCArIDEwMDAwIDwgbm93KSB7XG4gICAgICBkZWxldGUgdGhpcy5waW5nc1tmcmFtZV07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBjYWxjdWxhdGUgYXZlcmFnZVxuICAgIHBpbmdfdG90YWwgKz0gcGluZy5lbmQgLSBwaW5nLnN0YXJ0O1xuICAgIHBpbmdfY291bnQrKztcbiAgfVxuXG4gIC8vIHNob3cgcGluZ1xuICB0aGlzLmRpdl9waW5nLmlubmVySFRNTCA9IHJvdW5kKHBpbmdfdG90YWwgLyBwaW5nX2NvdW50KTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWxpdHBsYXllclxuICAgIEZyYW1lc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFN0YXJ0L3N0b3AgbG9vcFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmxvb3Bfc3RhcnQgPSBmdW5jdGlvbihzdGFydF9mcmFtZSkge1xuICAvLyBjbG9zZSBhbnkgb3BlbiBsb29wc1xuICB0aGlzLmxvb3Bfc3RvcCgpO1xuXG4gIC8vIHNldCBsb29wIHZhcnNcbiAgdGhpcy5zdGFydF9mcmFtZSA9IHN0YXJ0X2ZyYW1lIHx8IDA7XG4gIHRoaXMuZnJhbWVzID0gdGhpcy5zdGFydF9mcmFtZTtcbiAgdGhpcy5zdGFydF90aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5ydW5fdGljaygpO1xuICB9LCAxMCk7XG59O1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUubG9vcF9zdG9wID0gZnVuY3Rpb24oKSB7XG4gIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG59O1xuXG4vKiBSdW4gdGlja1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJ1bl90aWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNhbGN1bGF0ZSBudW1iZXIgb2YgZnJhbWVzIHNpbmNlIGdhbWUgc3RhcnRcbiAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICB2YXIgZnJhbWVzID1cbiAgICB0aGlzLnN0YXJ0X2ZyYW1lICsgTWF0aC5mbG9vcigobm93IC0gdGhpcy5zdGFydF90aW1lKSAvIHRoaXMubXNfbG9vcCk7XG5cbiAgLy8gZ2V0IG51bWJlciBvZiByZW1haW5pbmcgc3RlcHNcbiAgdmFyIGZyYW1lX2RpZmZlcmVuY2UgPSBmcmFtZXMgLSB0aGlzLmZyYW1lcztcblxuICAvLyB3YWl0aW5nXG4gIGlmIChmcmFtZV9kaWZmZXJlbmNlIDwgMSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHRvbyBtdWNoIGxhZ1xuICBpZiAoZnJhbWVfZGlmZmVyZW5jZSA+IDEwKSB7XG4gICAgdGhpcy5sb29wX3N0YXJ0KCk7XG4gICAgLy8gY29uc29sZS5sb2coXCJ0aWNrIGxhZyB8IFwiICsgZnJhbWVfZGlmZmVyZW5jZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBmcmFtZXMgdG8gcHJvY2Vzc1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGZyYW1lX2RpZmZlcmVuY2U7IGkrKykge1xuICAgIHRoaXMuZnJhbWUoKTtcbiAgfVxuXG4gIC8vIHJ1biBkaXNwbGF5IGxvb3BcbiAgdGhpcy5nYW1lLmZyYW1lX2Rpc3BsYXkoKTtcblxuICAvLyByZWNvcmQgdGltZSB0aGlzIHdhcyBkb25lXG4gIHRoaXMuZnBzZXMucHVzaChuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XG4gIGlmICh0aGlzLmZwc2VzLmxlbmd0aCA+IDcyKSB7XG4gICAgdGhpcy5kaXZfZnBzLmlubmVySFRNTCA9IHJvdW5kKFxuICAgICAgKDMwMDAgLyAodGhpcy5mcHNlc1s3Ml0gLSB0aGlzLmZwc2VzWzBdKSkgKiB0aGlzLmZwc1xuICAgICk7XG4gICAgdGhpcy5mcHNlcy5zcGxpY2UoMCwgMSk7XG4gIH1cbn07XG5cbi8qIEZyYW1lIHByb2Nlc3NcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5mcmFtZSA9IGZ1bmN0aW9uKCkge1xuICAvLyBpbmNyZW1lbnQgZnJhbWUgY291bnRcbiAgdGhpcy5mcmFtZXMrKztcblxuICAvLyBzdG9yZSBpbnB1dFxuICBpZiAodGhpcy5nYW1lLnBsYXllcikge1xuICAgIHZhciBhY3Rpb24gPSB0aGlzLmdhbWUuZ2V0X2lucHV0KCk7XG4gICAgaWYgKGFjdGlvbikge1xuICAgICAgdGhpcy5zdG9yZV9pbnB1dFt0aGlzLmZyYW1lc10gPSBhY3Rpb247XG4gICAgICB0aGlzLnNlbmRfaW5wdXQoYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICAvLyBydW4gZnJhbWVcbiAgdGhpcy5mcmFtZV9ydW4odGhpcy5mcmFtZXMpO1xuXG4gIC8vIHJlbW92ZSBvbGQgc3RhdGVzXG4gIHRoaXMucmVtb3ZlX29sZF9zdGF0ZXMoKTtcblxuICAvLyBydW4gZ3JvdW5kIGRhbWFnZSBjaGVja3NcbiAgdGhpcy5mcmFtZV9ncm91bmQoKTtcblxuICAvLyBydW4gZGVhdGggZnJhbWVzXG4gIHRoaXMuZnJhbWVfZGVhZCgpO1xuXG4gIC8vIHJ1biBwbGF5ZXJzIGludGVyZmFjZVxuICBpZiAodGhpcy5mcmFtZXMgJSA0OCA9PT0gMCkge1xuICAgIHRoaXMucGxheWVyc19pbnRlcmZhY2UoKTtcbiAgfVxuXG4gIC8vIHJ1biBwaW5nXG4gIGlmICh0aGlzLmZyYW1lcyAlIDEyID09PSAwKSB7XG4gICAgdGhpcy5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcInBpbmdcIiwgW3RoaXMuZnJhbWVzXSk7XG4gICAgdGhpcy5waW5nc1t0aGlzLmZyYW1lc10gPSB7IHN0YXJ0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSB9O1xuICB9XG59O1xuXG4vKiBGcmFtZSBydW5cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5mcmFtZV9ydW4gPSBmdW5jdGlvbihmcmFtZSkge1xuICAvLyBydW4gY29yZSBhbmQgc3RvcmUgcmVzcG9uc2VcbiAgdmFyIHJlc3BvbnNlID0gdGhpcy5nYW1lLmZyYW1lX2NvcmUoZnJhbWUsIHRoaXMuc3RvcmVfaW5wdXRbZnJhbWVdKTtcbiAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICB0aGlzLnN0b3JlX3Jlc3BvbnNlcy5wdXNoKHJlc3BvbnNlKTtcbiAgfVxuXG4gIC8vIGV2ZW50c1xuICB0aGlzLnJ1bl9ldmVudCh0aGlzLmdhbWUuY29yZS5zdGF0ZS5ldmVudHMpO1xuXG4gIC8vIHVucGFjayBhbnkgc3RvcmVkIHNlcnZlciBzdGF0ZSBmb3IgdGhpcyBmcmFtZVxuICBpZiAodGhpcy5zdG9yZV9wYWNrZXRbZnJhbWVdKSB7XG4gICAgdGhpcy5zZXRfZ2FtZV9zdGF0ZSh0aGlzLnN0b3JlX3BhY2tldFtmcmFtZV0pO1xuICAgIGRlbGV0ZSB0aGlzLnN0b3JlX3BhY2tldFtmcmFtZV07XG4gIH1cblxuICAvLyByZWNvcmQgZ2FtZSBzdGF0ZVxuICB0aGlzLnN0b3JlX3N0YXRlW2ZyYW1lXSA9IHtcbiAgICBmcmFtZXM6IGZyYW1lLFxuICAgIHN0YXRlOiB0aGlzLmdhbWUuY29yZS5wYWNrX3N0YXRlKHRoaXMuZ2FtZS5jb3JlLnN0YXRlKVxuICB9O1xufTtcblxuLyogUmVtb3ZlIG9sZCBzdGF0ZXNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZW1vdmVfb2xkX3N0YXRlcyA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKHZhciBmcmFtZSBpbiB0aGlzLnN0b3JlX3BhY2tldCkge1xuICAgIGlmIChwYXJzZUludChmcmFtZSkgKyA1MCA8IHRoaXMuZnJhbWVzKSB7XG4gICAgICBkZWxldGUgdGhpcy5zdG9yZV9wYWNrZXRbZnJhbWVdO1xuICAgIH1cbiAgfVxuICBmb3IgKHZhciBmcmFtZSBpbiB0aGlzLnN0b3JlX3N0YXRlKSB7XG4gICAgaWYgKHBhcnNlSW50KGZyYW1lKSArIDUwIDwgdGhpcy5mcmFtZXMpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLnN0b3JlX3N0YXRlW2ZyYW1lXTtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5zdG9yZV9pbnB1dCkge1xuICAgIGlmIChwYXJzZUludChmcmFtZSkgKyA1MCA8IHRoaXMuZnJhbWVzKSB7XG4gICAgICBkZWxldGUgdGhpcy5zdG9yZV9pbnB1dFtmcmFtZV07XG4gICAgfVxuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdG9yZV9yZXNwb25zZXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGhpcy5zdG9yZV9yZXNwb25zZXNbaV0uZnJhbWUgKyA1MCA8IHRoaXMuZnJhbWVzKSB7XG4gICAgICB0aGlzLnN0b3JlX3Jlc3BvbnNlcy5zcGxpY2UoaSwgMSk7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTXVsaXRwbGF5ZXJcbiAgICBHcm91bmQgRGFtYWdlXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogRGFtYWdlIHRoZSBncm91bmQgZXZlbnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ldmVudF9ncm91bmRfZGFtYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIGtleSA9IGV2ZW50LmZyYW1lICsgXCItXCIgKyBldmVudC54ICsgXCItXCIgKyBldmVudC55ICsgXCItXCIgKyBldmVudC5yYWRpdXM7XG5cbiAgLy8gZGlkIHdlIGFscmVhZHkgaGF2ZSB0aGlzIGhhcHBlblxuICBpZiAodGhpcy5ncm91bmRfZXZlbnRzW2tleV0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnZXQgYm91bmRhcmllc1xuICB2YXIgeDEgPSBtYXgocm91bmQoZXZlbnQueCAtIGV2ZW50LnJhZGl1cyksIDApO1xuICB2YXIgeDIgPSBtaW4ocm91bmQoZXZlbnQueCArIGV2ZW50LnJhZGl1cyksIHRoaXMuZ2FtZS5jb3JlLm1hcC53IC0gMSk7XG4gIHZhciB5MSA9IG1heChyb3VuZChldmVudC55IC0gZXZlbnQucmFkaXVzKSwgMCk7XG4gIHZhciB5MiA9IG1pbihyb3VuZChldmVudC55ICsgZXZlbnQucmFkaXVzKSwgdGhpcy5nYW1lLmNvcmUubWFwLmggLSAxKTtcbiAgdmFyIHcgPSB4MiAtIHgxO1xuICB2YXIgaCA9IHkyIC0geTE7XG5cbiAgLy8gZ2V0IGFycmF5IGZyb20gdGhlIG1hcFxuICB2YXIgYXJyID0gdGhpcy5nYW1lLmNvcmUubWFwLmdldF9ibG9jayh4MSwgeTEsIHcsIGgpO1xuXG4gIC8vIGdldCBwaWVjZSBvZiB0aGUgbWFwXG4gIHZhciBjYW52ID0gdGhpcy5nYW1lLmdldF9sYW5kX2Jsb2NrKHgxLCB5MSwgdywgaCk7XG5cbiAgLy8gc3RvcmUgYmFja2VkIHVwIGRhbWFnZVxuICB0aGlzLmdyb3VuZF90ZW1wW2tleV0gPSB7XG4gICAgZnJhbWU6IGV2ZW50LmZyYW1lLFxuICAgIHg6IHgxLFxuICAgIHk6IHkxLFxuICAgIGFycjogYXJyLFxuICAgIGNhbnY6IGNhbnZcbiAgfTtcblxuICAvLyBzdG9yZSB0aGUgZXZlbnQgaXRzZWxmXG4gIHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldID0gZHVwbGljYXRlX29iaihldmVudCk7XG4gIHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldLmRvbmUgPSB0cnVlO1xuXG4gIC8vIHJ1biB0aGUgZXZlbnRcbiAgdGhpcy5nYW1lLnJ1bl9ldmVudChldmVudCk7XG59O1xuXG4vKiBDaGVjayBncm91bmQgZGFtYWdlIGV2ZW50c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmZyYW1lX2dyb3VuZCA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIGFsbCBjaGVja3NcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ3JvdW5kX3RlbXApIHtcbiAgICBpZiAodGhpcy5mcmFtZXMgPiB0aGlzLmdyb3VuZF90ZW1wW2tleV0uZnJhbWUgKyA0MCkge1xuICAgICAgY2xvZyhcImRhbWFnZSBub3QgY29uZmlybWVkXCIpO1xuICAgICAgdGhpcy51bmRvX2dyb3VuZF9kYW1hZ2UodGhpcy5ncm91bmRfdGVtcFtrZXldLCBrZXkpO1xuICAgICAgZGVsZXRlIHRoaXMuZ3JvdW5kX3RlbXBba2V5XTtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF9ldmVudHNba2V5XTtcbiAgICB9XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGFsbCBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ3JvdW5kX2V2ZW50cykge1xuICAgIHZhciBldmVudCA9IHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldO1xuICAgIGlmICh0aGlzLmZyYW1lcyA+PSBldmVudC5mcmFtZSkge1xuICAgICAgaWYgKCFldmVudC5kb25lKSB7XG4gICAgICAgIHRoaXMuZ2FtZS5ydW5fZXZlbnQoZXZlbnQpO1xuICAgICAgICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XS5kb25lID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuZnJhbWVzID4gdGhpcy5ncm91bmRfZXZlbnRzW2tleV0uZnJhbWUgKyA1MCkge1xuICAgICAgZGVsZXRlIHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldO1xuICAgIH1cbiAgfVxufTtcblxuLyogVW5kbyBncm91bmQgZGFtYWdlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUudW5kb19ncm91bmRfZGFtYWdlID0gZnVuY3Rpb24oZGFtYWdlLCBkX2tleSkge1xuICAvLyByZXN0b3JlIGl0XG4gIHRoaXMuZ2FtZS5jb3JlLm1hcC5zZXRfYmxvY2tfZnJvbV9hcnIoZGFtYWdlLngsIGRhbWFnZS55LCBkYW1hZ2UuYXJyKTtcbiAgdGhpcy5nYW1lLmRyYXdfbGFuZF9ibG9jayhkYW1hZ2UueCwgZGFtYWdlLnksIGRhbWFnZS5jYW52KTtcblxuICAvLyByZWRvIGFueSBvdGhlciBldmVudHMgdGhhdCBoYXBwZW5lZCBzaW5jZVxuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5ncm91bmRfZXZlbnRzKSB7XG4gICAgaWYgKGRfa2V5ID09PSBrZXkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB0aGlzLmdhbWUucnVuX2V2ZW50KHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldKTtcbiAgfVxufTtcblxuLyogU2VydmVyIHJlc3BvbnNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzb2x2ZV9ncm91bmQgPSBmdW5jdGlvbihzdHIpIHtcbiAgaWYgKCFzdHIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB1bnBhY2sgZGFtYWdlc1xuICB2YXIgc3BsaXQgPSBzdHIuc3BsaXQoXCIkXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwbGl0MiA9IHNwbGl0W2ldLnNwbGl0KFwiflwiKTtcbiAgICB2YXIgZXZlbnQgPSB7XG4gICAgICB0eXBlOiBcImdyb3VuZF9kYW1hZ2VcIixcbiAgICAgIGZyYW1lOiBwYXJzZUludChzcGxpdDJbMF0pLFxuICAgICAgeDogcGFyc2VGbG9hdChzcGxpdDJbMV0pLFxuICAgICAgeTogcGFyc2VGbG9hdChzcGxpdDJbMl0pLFxuICAgICAgcmFkaXVzOiBwYXJzZUZsb2F0KHNwbGl0MlszXSksXG4gICAgICBkaWc6IHNwbGl0Mls0XSA9PT0gXCIxXCJcbiAgICB9O1xuICAgIHZhciBrZXkgPSBldmVudC5mcmFtZSArIFwiLVwiICsgZXZlbnQueCArIFwiLVwiICsgZXZlbnQueSArIFwiLVwiICsgZXZlbnQucmFkaXVzO1xuXG4gICAgLy8gY29uZmlybSBhbHJlYWR5IGRvbmUgZGFtYWdlXG4gICAgaWYgKHRoaXMuZ3JvdW5kX3RlbXBba2V5XSkge1xuICAgICAgZGVsZXRlIHRoaXMuZ3JvdW5kX3RlbXBba2V5XTtcblxuICAgICAgLy8gd2FpdCB0byBwZXJmb3JtIGl0XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldID0gZXZlbnQ7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTXVsdGlwbGF5ZXJcbiAgICBJbnRlcmZhY2VcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBJbml0IGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmluaXRfaW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gIC8vIGxvYWRpbmcgc2NyZWVuXG4gIHRoaXMubG9hZGluZyA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJMb2FkaW5nLi4uPGJyPjxicj48ZGl2IGNsYXNzPSdsb2FkZXInPjwvZGl2PlwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMubG9hZGluZyk7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcblxuICAvLyBiZXR3ZWVuIGdhbWVzIHNjcmVlblxuICB0aGlzLmJldHdlZW5fZ2FtZXMgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiRGltZW5zaW9uIGp1bXAgaW4gcHJvZ3Jlc3MhPGJyPjxicj48ZGl2IGNsYXNzPSdsb2FkZXInPjwvZGl2PlwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuYmV0d2Vlbl9nYW1lcyk7XG4gIGhpZGUodGhpcy5iZXR3ZWVuX2dhbWVzKTtcblxuICAvLyBwZXJmb3JtYW5jZVxuICB0aGlzLmRpdl9waW5nID0gZWxlbWVudCh7IGNsYXNzOiBcInBpbmdcIiB9KTtcbiAgdGhpcy5kaXZfZnBzID0gZWxlbWVudCh7IGNsYXNzOiBcImZwc1wiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3BpbmcpO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X2Zwcyk7XG5cbiAgLy8gZGVhZCBkaXZcbiAgdGhpcy5kaXZfZGVhZCA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsIGZ1bGxfYmdcIiB9KTtcbiAgdGhpcy5kaXZfZGVhZF9jb250ID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXIgcmVkXCIsXG4gICAgdGV4dDogXCI8aDM+WW91IGhhdmUgZGllZCE8L2gzPlwiICsgc2hhcmVMaW5rc1RleHRcbiAgfSk7XG4gIHRoaXMuZGl2X2RlYWRfdGV4dCA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwicFwiLFxuICAgIHRleHQ6IFwiWW91IHdlcmUga2lsbGVkIGluIGFjdGlvbi5cIlxuICB9KTtcbiAgdGhpcy5kaXZfZGVhZF9jb3VudGRvd24gPSBlbGVtZW50KHsgdHlwZTogXCJwXCIsIGNsYXNzOiBcImdyZXlcIiB9KTtcbiAgdGhpcy5kaXZfZGVhZF9idXR0b25zID0gZWxlbWVudCh7IGNsYXNzOiBcImJ1dHRvbnNcIiB9KTtcbiAgdGhpcy5idXR0b25fcmVzcGF3biA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnV0dG9uIHJlZCBkaXNhYmxlZFwiLFxuICAgIHRleHQ6IFwiUmVzcGF3blwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X2RlYWQpO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZCwgdGhpcy5kaXZfZGVhZF9jb250KTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWRfY29udCwgdGhpcy5kaXZfZGVhZF90ZXh0KTtcbiAgYXBwZW5kKHRoaXMuZGl2X2RlYWRfY29udCwgdGhpcy5kaXZfZGVhZF9jb3VudGRvd24pO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZF9jb250LCB0aGlzLmRpdl9kZWFkX2J1dHRvbnMpO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZF9idXR0b25zLCB0aGlzLmJ1dHRvbl9yZXNwYXduKTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcblxuICAvLyBnYW1lIGZ1bGwgc2NyZWVuXG4gIHRoaXMuZnVsbCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDpcbiAgICAgIFwiR2FtZSBzZXJ2ZXIgZnVsbC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmZ1bGwpO1xuICBoaWRlKHRoaXMuZnVsbCk7XG5cbiAgLy8gcmVzcGF3biBvbiBjbGlja1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuYnV0dG9uX3Jlc3Bhd24ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChzZWxmLndhaXRfZm9yX3Jlc3Bhd24gPT09IDApIHtcbiAgICAgIHNlbGYuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJyZXNwYXduXCIsIFtdKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gcGxheWVyc1xuICB0aGlzLmRpdl9wbGF5ZXJzID0gZWxlbWVudCh7IGNsYXNzOiBcInBsYXllcnNcIiB9KTtcbiAgdGhpcy50YWJsZV9wbGF5ZXJzID0gZWxlbWVudCh7IHR5cGU6IFwidGFibGVcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9wbGF5ZXJzKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3BsYXllcnMsIHRoaXMudGFibGVfcGxheWVycyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gbXVsdGlwbGF5ZXIoXG4gIGFzc2V0cyxcbiAgYXNzZXRzX3VybCxcbiAgYXVkaW8sXG4gIGlucHV0LFxuICBuYW1lLFxuICB3YXRjaGVyLFxuICBydW5fZXZlbnQsXG4gIHNvY2tldHMsXG4gIG9uYm9hcmRpbmdcbikge1xuICAvLyBzZXR1cFxuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hc3NldHNfdXJsID0gYXNzZXRzX3VybDtcbiAgdGhpcy5hdWRpbyA9IGF1ZGlvO1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMud2F0Y2hlciA9IHdhdGNoZXI7XG4gIHRoaXMudG9wX2V2ZW50ID0gcnVuX2V2ZW50O1xuICB0aGlzLnNvY2tldHMgPSBzb2NrZXRzO1xuICB0aGlzLnNjaGVtZSA9IG51bGw7XG4gIHRoaXMubGFnID0gMDtcbiAgdGhpcy5vbmJvYXJkaW5nID0gb25ib2FyZGluZztcblxuICAvLyBsb29wXG4gIHRoaXMuZnBzID0gMjQ7XG4gIHRoaXMubXNfbG9vcCA9IE1hdGguZmxvb3IoMTAwMCAvIHRoaXMuZnBzKTtcbiAgdGhpcy5tc190aWNrID0gMTA7XG4gIHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cbiAgLy8gbWFpbiBkaXZzXG4gIHRoaXMuZGl2ID0gZWxlbWVudCh7IGNsYXNzOiBcImZ1bGxcIiB9KTtcbiAgdGhpcy5jb25uZWN0aW5nID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OiBcIldhaXRpbmcgZm9yIGNvbm5lY3Rpb24uLi48YnI+PGJyPjxkaXYgY2xhc3M9J2xvYWRlcic+PC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5jb25uZWN0aW5nKTtcblxuICAvLyBzZXQgdXAgaW50ZXJmYWNlXG4gIHRoaXMuaW5pdF9pbnRlcmZhY2UoKTtcblxuICAvLyB3aGVuIGpvaW5pbmcgYSBnYW1lIHJlY29yZCBhbnkgaW5jb21pbmcgZXZlbnRzIGZvciBsYXRlciB1c2VcbiAgdGhpcy5pbml0aWFsX2dhbWVfZXZlbnRzID0gW107XG59XG5cbi8qIFdhaXQgZm9yIGNvbm5lY3Rpb25cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS53YWl0X2Zvcl9jb25uZWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5sb29wX3N0b3AoKTtcbiAgaGlkZSh0aGlzLmJldHdlZW5fZ2FtZXMpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG4gIHNob3codGhpcy5jb25uZWN0aW5nKTtcbn07XG5cbi8qIENvbm5lY3RlZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmNvbm5lY3RlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIHNldCB1cCBzY2hlbWVcbiAgdGhpcy5zY2hlbWUgPSBkZWVwbWVyZ2Uoc2NoZW1lcy5kZWZhdWx0LCBzY2hlbWVzW2V2ZW50LnNjaGVtZV0pO1xuXG4gIC8vIGFjdGl2ZSB2YWx1ZXNcbiAgdGhpcy5uYW1lID0gZXZlbnQubmFtZTtcbiAgdGhpcy5wbGF5ZXJfaWQgPSBldmVudC5wbGF5ZXJfaWQ7XG4gIHRoaXMucGxheWVyX2NvdW50ID0gMDtcbiAgdGhpcy5wbGF5ZXJzID0ge307XG4gIHRoaXMucGxheWVyc19yZWYgPSB7fTtcblxuICAvLyBnbyB0aHJvdWdoIHN0cmluZyBvZiBwbGF5ZXJzXG4gIHZhciBzcGxpdCA9IGV2ZW50LnBsYXllcnMuc3BsaXQoXCIrXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwbGl0MiA9IHNwbGl0W2ldLnNwbGl0KFwiL1wiKTtcbiAgICB0aGlzLmluaXRfcGxheWVyKHtcbiAgICAgIHVzZXJfaWQ6IHNwbGl0MlswXSxcbiAgICAgIG5hbWU6IHNwbGl0MlsxXSxcbiAgICAgIHBsYXllcl9pZDogcGFyc2VJbnQoc3BsaXQyWzJdKVxuICAgIH0pO1xuICB9XG5cbiAgLy8gcnVuIHRoZSBwbGF5ZXIgaW50ZXJmYWNlXG4gIHRoaXMucGxheWVyc19pbnRlcmZhY2UoKTtcbn07XG5cbi8qIFN0YXJ0IGdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX3N0YXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5sb2FkaW5nX3N0YXJ0ID0gdHJ1ZTtcbiAgdGhpcy5pbml0aWFsaXNlZCA9IGZhbHNlO1xuICB0aGlzLmdyYXZpdHlfbWFwID0gZXZlbnQuZ3Jhdml0eV9tYXA7XG5cbiAgdGhpcy5nYW1lX2Nsb3NlKCk7XG5cbiAgLy8gcmVzZXQgc2NvcmVzXG4gIGlmIChldmVudC5yZXNldF9wbGF5ZXJzKSB7XG4gICAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzKSB7XG4gICAgICB0aGlzLnBsYXllcnNbaWRdLmxldmVsID0gMDtcbiAgICAgIHRoaXMucGxheWVyc1tpZF0uc2NvcmUgPSAwO1xuICAgIH1cbiAgICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG4gIH1cblxuICAvLyBzdG9yZWQgZ2FtZSBzdGF0ZXMgYW5kIGFjdGlvbnNcbiAgdGhpcy5zdG9yZV9wYWNrZXQgPSB7fTtcbiAgdGhpcy5zdG9yZV9zdGF0ZSA9IHt9O1xuICB0aGlzLnN0b3JlX2lucHV0ID0ge307XG4gIHRoaXMuc3RvcmVfcmVzcG9uc2VzID0gW107XG5cbiAgLy8gZ3JvdW5kIGRhbWFnZVxuICB0aGlzLmdyb3VuZF90ZW1wID0ge307XG4gIHRoaXMuZ3JvdW5kX2V2ZW50cyA9IHt9O1xuXG4gIC8vIG9iamVjdHMgdGhhdCB3ZSBhcmUgd2FpdGluZyBvbiBmb3Igc2VydmVyIGNvbmZpcm1hdGlvblxuICB0aGlzLndhaXRfdG9fZGVzdHJveSA9IHt9O1xuICB0aGlzLndhaXRfdG9fY3JlYXRlID0ge307XG5cbiAgLy8gcGVyZm9ybWFuY2VcbiAgdGhpcy5waW5ncyA9IHt9O1xuICB0aGlzLmZwc2VzID0gW107XG5cbiAgLy8gbG9hZCB0aGUgbWFwIGZyb20gZGF0YSB1cmxcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBuZXcgbG9hZGVyKFxuICAgIFwiXCIsXG4gICAge1xuICAgICAgaW1nOiB7XG4gICAgICAgIGJnOiBldmVudC5iZ19zdHIsXG4gICAgICAgIGZnOiBldmVudC5mZ19zdHJcbiAgICAgIH1cbiAgICB9LFxuICAgIGZ1bmN0aW9uKGFzc2V0cykge1xuICAgICAgc2VsZi5nYW1lX3N0YXJ0X2xvYWRlZChhc3NldHMuaW1nKTtcbiAgICB9XG4gICk7XG59O1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9zdGFydF9sb2FkZWQgPSBmdW5jdGlvbihtYXApIHtcbiAgLy8gc2V0IHVwIG1hcFxuICB2YXIgbmV3X21hcCA9IHtcbiAgICBmZzogbWFwZ2VuX2NhbnZhcyhtYXAuZmcud2lkdGgsIG1hcC5mZy5oZWlnaHQpLFxuICAgIGJnOiBtYXBnZW5fY2FudmFzKG1hcC5iZy53aWR0aCwgbWFwLmJnLmhlaWdodCksXG4gICAgZ3Jhdml0eV9tYXA6IHRoaXMuZ3Jhdml0eV9tYXBcbiAgfTtcbiAgbmV3X21hcC5mZy5jb250LmRyYXdJbWFnZShtYXAuZmcsIDAsIDApO1xuICBuZXdfbWFwLmJnLmNvbnQuZHJhd0ltYWdlKG1hcC5iZywgMCwgMCk7XG5cbiAgLy8gc3RhcnQgdXAgZ2FtZSBvYmplY3RcbiAgdGhpcy5nYW1lID0gbmV3IGdhbWUoXG4gICAgdGhpcy5hc3NldHMsXG4gICAgdGhpcy5hdWRpbyxcbiAgICB0aGlzLmlucHV0LFxuICAgIHRoaXMuc2NoZW1lLFxuICAgIG5ld19tYXAsXG4gICAgdGhpcy5wbGF5ZXJzX3JlZixcbiAgICB0aGlzLnBsYXllcl9pZCxcbiAgICB0aGlzLnRvcF9ldmVudCxcbiAgICB0aGlzLm9uYm9hcmRpbmdcbiAgKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWUuZGl2KTtcblxuICAvLyBmaW5pc2hlZCBsb2FkaW5nXG4gIHRoaXMubG9hZGluZ19zdGFydCA9IGZhbHNlO1xufTtcblxuLyogSW5pdCBnYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuaW5pdF9nYW1lID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKCF0aGlzLmdhbWUgfHwgIXRoaXMuZ2FtZS5jb3JlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2hvdyBpbnRlcmZhY2VcbiAgaGlkZSh0aGlzLmJldHdlZW5fZ2FtZXMpO1xuICBoaWRlKHRoaXMuZGl2X2RlYWQpO1xuICBoaWRlKHRoaXMuY29ubmVjdGluZyk7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcblxuICAvLyBzdG9wIGdhbWVcbiAgdGhpcy5sb29wX3N0b3AoKTtcblxuICAvLyBwcmVwYXJlIHN0YXRlXG4gIHRoaXMuc2V0X2dhbWVfc3RhdGUoZXZlbnQsIHRydWUpO1xuXG4gIC8vIHN0YXJ0IGdhbWVcbiAgdGhpcy5nYW1lLnN0YXJ0KGV2ZW50LmZyYW1lcyk7XG4gIHRoaXMuc3RhdHVzID0gXCJhY3RpdmVcIjtcblxuICAvLyBsYXN0IGZyYW1lIGEgc2VydmVyIHBhY2tldCB3YXMgcmVjZWl2ZWRcbiAgdGhpcy5sYXN0X3BhY2tldCA9IGV2ZW50LmZyYW1lcztcbiAgdGhpcy5kaXNjb25uZWN0ZWQgPSBmYWxzZTtcblxuICAvLyBydW4gaW5pdGlhbCBldmVudHNcbiAgdGhpcy5ydW5fZXZlbnQodGhpcy5pbml0aWFsX2dhbWVfZXZlbnRzKTtcbiAgdGhpcy5pbml0aWFsX2dhbWVfZXZlbnRzID0gW107XG4gIHRoaXMuaW5pdGlhbGlzZWQgPSB0cnVlO1xuXG4gIC8vIHN0YXJ0IGxvb3BcbiAgdGhpcy5sb29wX3N0YXJ0KGV2ZW50LmZyYW1lcyk7XG59O1xuXG4vKiBDbG9zZSBnYW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9jbG9zZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMubG9vcF9zdG9wKCk7XG4gIGlmICh0aGlzLmdhbWUpIHtcbiAgICByZW1vdmUodGhpcy5nYW1lLmRpdik7XG4gICAgZGVsZXRlIHRoaXMuZ2FtZTtcbiAgfVxufTtcblxuLyogRW5kIEdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX2VuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIHN0b3AgZ2FtZVxuICB0aGlzLmxvb3Bfc3RvcCgpO1xuXG4gIC8vIHN0b3AgYXVkaW9cbiAgdGhpcy5hdWRpby5zdG9wKCk7XG5cbiAgLy8gc2hvdyBsb2FkaW5nIHNjcmVlblxuICBoaWRlKHRoaXMubG9hZGluZyk7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG4gIGhpZGUodGhpcy5jb25uZWN0aW5nKTtcbiAgc2hvdyh0aGlzLmJldHdlZW5fZ2FtZXMpO1xufTtcblxuLyogU2VuZCBpbnB1dCB0byBzZXJ2ZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5zZW5kX2lucHV0ID0gZnVuY3Rpb24oYWN0aW9uKSB7XG4gIHZhciBhcnIgPSBbdGhpcy5mcmFtZXMsIGFjdGlvbi5hY3Rpb24sIGFjdGlvbi5hbmdsZV07XG4gIGlmIChhY3Rpb24uYWN0aW9uID09PSBcInNob290XCIpIHtcbiAgICBhcnIucHVzaChhY3Rpb24ud2VhcG9uKTtcbiAgfVxuICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwicGxheWVyX2lucHV0XCIsIGFycik7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgUm9vbSBQbGF5ZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ3JlYXRlIHBsYXllciBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuaW5pdF9wbGF5ZXIgPSBmdW5jdGlvbihwcm9wcykge1xuICAvLyBhZGQgcGxheWVyIHRvIGFycmF5XG4gIHRoaXMucGxheWVyX2NvdW50Kys7XG4gIHRoaXMucGxheWVyc1twcm9wcy51c2VyX2lkXSA9IHtcbiAgICBuYW1lOiBwcm9wcy5uYW1lLFxuICAgIGlkOiBwcm9wcy5wbGF5ZXJfaWRcbiAgfTtcblxuICAvLyBzZXQgcGxheWVycyByZWZlcmVuY2VcbiAgdGhpcy5wbGF5ZXJzX3JlZltwcm9wcy5wbGF5ZXJfaWRdID0ge1xuICAgIHVzZXJfaWQ6IHByb3BzLnVzZXJfaWQsXG4gICAgbmFtZTogcHJvcHMubmFtZSxcbiAgICBsZXZlbDogMFxuICB9O1xufTtcblxuLyogRHJhdyBwbGF5ZXJzIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnBsYXllcnNfaW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gIC8vIGFyZSB3ZSBnb29kIGFuZCBhY3RpdmVcbiAgaWYgKCF0aGlzLmluaXRpYWxpc2VkIHx8ICF0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2hvdyBwbGF5ZXJzXG4gIHZhciBzdHIgPSBcIlwiO1xuICB2YXIgc29ydGFibGUgPSB0aGlzLnBsYXllcnNfc29ydCgpO1xuICBpZiAoIXNvcnRhYmxlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc2V0IGxlYWRlciBpZFxuICB0aGlzLmdhbWUubGVhZGVyID0gcGFyc2VJbnQoc29ydGFibGVbMF0uaWQpO1xuXG4gIHN0ciA9IFwiPHRoZWFkPjx0aD48L3RoPjx0aD5sdmw8L3RoPjx0aD5zY29yZTwvdGg+PC90aGVhZD5cIjtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0YWJsZS5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwbGF5ZXIgPSBzb3J0YWJsZVtpXTtcbiAgICB2YXIgdHJfY2xhc3MgPSBcIlwiO1xuICAgIGlmIChwbGF5ZXIuaWQgPT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgIHRyX2NsYXNzICs9IFwiaGlnaGxpZ2h0IFwiO1xuICAgIH1cbiAgICBpZiAocGxheWVyLmRlYWQpIHtcbiAgICAgIHRyX2NsYXNzICs9IFwiZGVhZCBcIjtcbiAgICB9XG4gICAgc3RyICs9XG4gICAgICBcIjx0ciBjbGFzcz0nXCIgK1xuICAgICAgdHJfY2xhc3MgK1xuICAgICAgXCInJz48dGQ+XCIgK1xuICAgICAgcGxheWVyLm5hbWUgK1xuICAgICAgXCI8L3RkPjx0ZCBjbGFzcz0ncmVkJz5cIiArXG4gICAgICAocGxheWVyLmxldmVsICsgMSkgK1xuICAgICAgXCI8L3RkPjx0ZCBjbGFzcz0nZ3JlZW4nPlwiICtcbiAgICAgIHBsYXllci5zY29yZSArXG4gICAgICBcIjwvdGQ+PC90cj5cIjtcbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBsZXZlbCB1cHNcbiAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzX3JlZikge1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNfcmVmW2lkXTtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzW2lkXTtcbiAgICBpZiAoIWNvcmVfcGxheWVyKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHBsYXllci5sZXZlbCAhPT0gY29yZV9wbGF5ZXIubGV2ZWwpIHtcbiAgICAgIHRoaXMucnVuX2V2ZW50KHtcbiAgICAgICAgdHlwZTogXCJwbGF5ZXJfbGV2ZWxcIixcbiAgICAgICAgaWQ6IHBhcnNlSW50KGlkKSxcbiAgICAgICAgcHJldjogcGxheWVyLmxldmVsLFxuICAgICAgICBuZXc6IGNvcmVfcGxheWVyLmxldmVsXG4gICAgICB9KTtcbiAgICAgIHRoaXMucGxheWVyc19yZWZbaWRdLmxldmVsID0gY29yZV9wbGF5ZXIubGV2ZWw7XG4gICAgfVxuICB9XG5cbiAgLy8gc2V0IGNvbnRlbnRcbiAgdGhpcy50YWJsZV9wbGF5ZXJzLmlubmVySFRNTCA9IHN0cjtcbn07XG5cbi8qIFNvcnQgcGxheWVycyBieSBzY29yZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnBsYXllcnNfc29ydCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc29ydGFibGUgPSBbXTtcbiAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzX3JlZikge1xuICAgIHZhciBjb3JlX3BsYXllciA9IHRoaXMuZ2FtZS5jb3JlLnN0YXRlLnBsYXllcnNbaWRdO1xuICAgIGlmICghY29yZV9wbGF5ZXIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBzb3J0YWJsZS5wdXNoKHtcbiAgICAgIGlkOiBpZCxcbiAgICAgIG5hbWU6IHRoaXMucGxheWVyc19yZWZbaWRdLm5hbWUsXG4gICAgICBsZXZlbDogY29yZV9wbGF5ZXIubGV2ZWwsXG4gICAgICBzY29yZTogY29yZV9wbGF5ZXIuc2NvcmUsXG4gICAgICBkZWFkOiBjb3JlX3BsYXllci5kZWFkXG4gICAgfSk7XG4gIH1cbiAgc29ydGFibGUuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICB9KTtcbiAgcmV0dXJuIHNvcnRhYmxlO1xufTtcblxuLyogUGxheWVyIGhhcyBqb2luZWRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5wbGF5ZXJfam9pbiA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuaW5pdF9wbGF5ZXIoZXZlbnQsIHRydWUpO1xuICB0aGlzLmF1ZGlvLnBsYXkoXCJqb2luXCIsIDEpO1xufTtcblxuLyogUGxheWVyIGxlZnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5wbGF5ZXJfbGVhdmUgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoIXRoaXMucGxheWVyc1tldmVudC51c2VyX2lkXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpZCA9IHRoaXMucGxheWVyc1tldmVudC51c2VyX2lkXS5wbGF5ZXJfaWQ7XG4gIGRlbGV0ZSB0aGlzLnBsYXllcnNfcmVmW2lkXTtcbiAgZGVsZXRlIHRoaXMucGxheWVyc1tldmVudC51c2VyX2lkXTtcbiAgdGhpcy5wbGF5ZXJfY291bnQtLTtcblxuICAvLyByZW1vdmUgZnJvbSBnYW1lXG4gIGlmICh0aGlzLmdhbWUgJiYgdGhpcy5nYW1lLmNvcmUpIHtcbiAgICB0aGlzLmdhbWUuY29yZS5yZW1vdmVfcGxheWVyKGlkKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWUgU3RhdGVzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUmVjZWl2ZSBnYW1lIHN0YXRlIGZyb20gc2VydmVyXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZ2FtZV9zdGF0ZV9yZWNlaXZlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIGlmIHdlIGFyZSBsb2FkaW5nXG4gIGlmICh0aGlzLmxvYWRpbmdfc3RhcnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzdGFydCB0aGUgZ2FtZVxuICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQgfHwgdGhpcy5kaXNjb25uZWN0ZWQpIHtcbiAgICB0aGlzLmluaXRpYWxpc2VkID0gdHJ1ZTtcbiAgICB0aGlzLmluaXRfZ2FtZShldmVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGRpZmYgPSBldmVudC5mcmFtZXMgLSB0aGlzLmZyYW1lcztcblxuICAvLyBpZiB3ZSBhcmUgdG9vIHF1aWNrXG4gIGlmIChkaWZmIDwgMCkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwiY2xpZW50IHRvbyBmYXN0XCIpO1xuICAgIHRoaXMuaW5pdF9nYW1lKGV2ZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpZiBpdCdzIHRvbyBmYXIgYmVoaW5kIHJlc3luY1xuICBpZiAoZGlmZiA+IDkpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlc3luY1wiKTtcbiAgICB0aGlzLmluaXRfZ2FtZShldmVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYXBwbHkgdGhlIHN0YXRlXG4gIGlmIChldmVudC5mcmFtZXMgPT09IHRoaXMuZnJhbWVzKSB7XG4gICAgdGhpcy5zZXRfZ2FtZV9zdGF0ZShldmVudCk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5zdG9yZV9wYWNrZXRbZXZlbnQuZnJhbWVzXSA9IGR1cGxpY2F0ZV9vYmooZXZlbnQpO1xuICB9XG59O1xuXG4vKiBTZXQgZ2FtZSBzdGF0ZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnNldF9nYW1lX3N0YXRlID0gZnVuY3Rpb24oZXZlbnQsIGlnbm9yZV9yZXMpIHtcbiAgLy8gcnVuIGRhbWFnZXNcbiAgdGhpcy5yZXNvbHZlX2dyb3VuZChldmVudC5kYW1hZ2VzKTtcblxuICAvLyB1bnBhY2sgdGhlIHN0YXRlXG4gIHZhciBzdGF0ZSA9IHRoaXMuZ2FtZS5jb3JlLnVucGFja19zdGF0ZShldmVudC5zdGF0ZSk7XG5cbiAgLy8gc2V0IHBsYXllcnNcbiAgdGhpcy5yZXNvbHZlX3BsYXllcnMoc3RhdGUsIGlnbm9yZV9yZXMpO1xuXG4gIC8vIHNldCB0aGlzIHBsYXllclxuICBpZiAoIWlnbm9yZV9yZXMpIHtcbiAgICB0aGlzLnJlc29sdmVfdGhpc19wbGF5ZXIoc3RhdGUsIGV2ZW50LnJlc3BvbnNlcyk7XG4gIH1cblxuICAvLyBzZXQgb2JqZWN0c1xuICB0aGlzLnJlc29sdmVfb2JqZWN0cyhzdGF0ZS5vYmplY3RzLCBldmVudC5mcmFtZXMpO1xuXG4gIC8vIHNldCBleHBsb3Npb25zXG4gIHRoaXMucmVzb2x2ZV9leHBsb3Npb25zKHN0YXRlLmV4cGxvc2lvbnMsIGV2ZW50LmZyYW1lcyk7XG5cbiAgLy8gc2V0IGdhbWUgcGxheWVyIHJlZmVyZW5jZXNcbiAgdGhpcy5nYW1lLnNldF90aGlzX3BsYXllcl9yZWZzKCk7XG59O1xuXG4vKiBSZXNvbHZlIHBsYXllcnNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX3BsYXllcnMgPSBmdW5jdGlvbihzdGF0ZSwgaWdub3JlX3Jlcykge1xuICAvLyBzZXQgYWxsIG90aGVyIHBsYXllcnNcbiAgZm9yICh2YXIga2V5IGluIHN0YXRlLnBsYXllcnMpIHtcbiAgICBpZiAocGFyc2VJbnQoa2V5KSAhPT0gdGhpcy5wbGF5ZXJfaWQgfHwgaWdub3JlX3Jlcykge1xuICAgICAgdGhpcy5nYW1lLmluaXRfcGxheWVyKHN0YXRlLnBsYXllcnNba2V5XSwgdHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gcmVtb3ZlIHBsYXllcnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLnBsYXllcnMpIHtcbiAgICBpZiAoIXN0YXRlLnBsYXllcnNba2V5XSkge1xuICAgICAgdGhpcy5nYW1lLmNvcmUucmVtb3ZlX3BsYXllcihrZXkpO1xuICAgIH1cbiAgfVxufTtcblxuLyogUmVzb2x2ZSB0aGlzIHBsYXllclxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfdGhpc19wbGF5ZXIgPSBmdW5jdGlvbihzdGF0ZSwgcmVzcG9uc2VzKSB7XG4gIC8vIHByZXAgc2VydmVyIHN0YXRlIG9iamVjdHNcbiAgdmFyIHNlcnZlcl9wbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXTtcbiAgdmFyIHNlcnZlcl9vYmogPSBzdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWRdO1xuICBpZiAoIXNlcnZlcl9wbGF5ZXIgfHwgIXNlcnZlcl9vYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBwcmVwIHNlcnZlciByZXNwb25zZXNcbiAgdmFyIHNlcnZlcl9yZXNwb25zZXMgPSBbXTtcbiAgdmFyIHNwbGl0ID0gcmVzcG9uc2VzLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcGxpdDIgPSBzcGxpdFtpXS5zcGxpdChcIn5cIik7XG4gICAgc2VydmVyX3Jlc3BvbnNlcy5wdXNoKHtcbiAgICAgIGZyYW1lOiBwYXJzZUludChzcGxpdDJbMF0pLFxuICAgICAgc3VjY2Vzczogc3BsaXQyWzFdID09PSBcIjFcIixcbiAgICAgIHg6IHBhcnNlRmxvYXQoc3BsaXQyWzJdKSxcbiAgICAgIHk6IHBhcnNlRmxvYXQoc3BsaXQyWzNdKSxcbiAgICAgIHNwZWVkX3g6IHBhcnNlRmxvYXQoc3BsaXQyWzRdKSxcbiAgICAgIHNwZWVkX3k6IHBhcnNlRmxvYXQoc3BsaXQyWzVdKSxcbiAgICAgIHR5cGU6IHNwbGl0Mls2XVxuICAgIH0pO1xuICB9XG5cbiAgLy8gY2hlY2sgcGxheWVyIHdlYXBvblxuICBpZiAoc2VydmVyX3BsYXllci53ZWFwb24gIT09IHRoaXMuZ2FtZS5jdXJyZW50X3dlYXBvbikge1xuICAgIHRoaXMuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJ3ZWFwb25fc2VsZWN0ZWRcIiwgW3RoaXMuZ2FtZS5jdXJyZW50X3dlYXBvbl0pO1xuICB9XG5cbiAgLy8gaWYgd2UgaGF2ZSBubyBtb3JlIGFjdGlvbnNcbiAgaWYgKHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIubGV2ZWwgPSBzZXJ2ZXJfcGxheWVyLmxldmVsO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuc2NvcmUgPSBzZXJ2ZXJfcGxheWVyLnNjb3JlO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuZGVhZCA9IHNlcnZlcl9wbGF5ZXIuZGVhZDtcbiAgICB0aGlzLmdhbWUucGxheWVyLmhlYWx0aCA9IHNlcnZlcl9wbGF5ZXIuaGVhbHRoO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuY29vbGRvd24gPSBzZXJ2ZXJfcGxheWVyLmNvb2xkb3duO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuYXJtb3VyeSA9IGR1cGxpY2F0ZV9vYmooc2VydmVyX3BsYXllci5hcm1vdXJ5KTtcbiAgICB0aGlzLmdhbWUuc2V0X2FybW91cnkoKTtcbiAgfVxuXG4gIC8vIHJlc29sdmUgb3VyIHBsYXllclxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGNsaWVudF9yZXNwb25zZSA9IHRoaXMuc3RvcmVfcmVzcG9uc2VzW2ldO1xuXG4gICAgLy8gZ28gdGhyb3VnaCBhY3Rpb24gcmVzcG9uc2VzXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZXJ2ZXJfcmVzcG9uc2VzLmxlbmd0aDsgaisrKSB7XG4gICAgICB2YXIgc2VydmVyX3Jlc3BvbnNlID0gc2VydmVyX3Jlc3BvbnNlc1tqXTtcblxuICAgICAgLy8gY29ycmVjdCBmcmFtZVxuICAgICAgaWYgKGNsaWVudF9yZXNwb25zZS5mcmFtZSA9PT0gc2VydmVyX3Jlc3BvbnNlLmZyYW1lKSB7XG4gICAgICAgIC8vIGNvbXBhcmUgdGhlIHJlc3BvbnNlXG4gICAgICAgIGlmIChcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2Uuc3VjY2VzcyA9PT0gc2VydmVyX3Jlc3BvbnNlLnN1Y2Nlc3MgJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueCA9PT0gc2VydmVyX3Jlc3BvbnNlLnggJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueSA9PT0gc2VydmVyX3Jlc3BvbnNlLnkgJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2Uuc3BlZWRfeCA9PT0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3ggJiZcbiAgICAgICAgICBjbGllbnRfcmVzcG9uc2Uuc3BlZWRfeSA9PT0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3lcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gY2xvZyhcImFjdCBzdWNjZXNzXCIsIHNlcnZlcl9yZXNwb25zZS5mcmFtZSwgdGhpcy5mcmFtZXMsIHNlcnZlcl9yZXNwb25zZS50eXBlLCBjbGllbnRfcmVzcG9uc2UueCwgc2VydmVyX3Jlc3BvbnNlLngsIGNsaWVudF9yZXNwb25zZS55LCBzZXJ2ZXJfcmVzcG9uc2UueSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVzeW5jIHRoZSBwbGF5ZXJcbiAgICAgICAgICBjbG9nKFxuICAgICAgICAgICAgXCJhY3QgZmFpbFwiLFxuICAgICAgICAgICAgc2VydmVyX3Jlc3BvbnNlLmZyYW1lLFxuICAgICAgICAgICAgdGhpcy5mcmFtZXMsXG4gICAgICAgICAgICBzZXJ2ZXJfcmVzcG9uc2UudHlwZSxcbiAgICAgICAgICAgIGNsaWVudF9yZXNwb25zZS54LFxuICAgICAgICAgICAgc2VydmVyX3Jlc3BvbnNlLngsXG4gICAgICAgICAgICBjbGllbnRfcmVzcG9uc2UueSxcbiAgICAgICAgICAgIHNlcnZlcl9yZXNwb25zZS55XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXRoaXMucmVzeW5jX3RoaXNfcGxheWVyKHNlcnZlcl9yZXNwb25zZSkpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5pbml0X3BsYXllcihzZXJ2ZXJfcGxheWVyLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuY3JlYXRlX29iamVjdChzZXJ2ZXJfb2JqKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2VydmVyX3Jlc3BvbnNlcy5zcGxpY2UoaiwgMSk7XG4gICAgICAgIHRoaXMuc3RvcmVfcmVzcG9uc2VzLnNwbGljZShpLCAxKTtcbiAgICAgICAgaS0tO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFN5bmMgdGhpcyBwbGF5ZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXN5bmNfdGhpc19wbGF5ZXIgPSBmdW5jdGlvbihzZXJ2ZXJfcmVzcG9uc2UpIHtcbiAgLy8gaG93IGZhciBiYWNrIGlzIHRoaXNcbiAgdmFyIGZyYW1lID0gc2VydmVyX3Jlc3BvbnNlLmZyYW1lO1xuICB2YXIgZnJhbWVfZGlmZmVyZW5jZSA9IHRoaXMuZnJhbWVzIC0gZnJhbWU7XG5cbiAgLy8gaWYgaXQncyB0b28gZmFyIGJhY2tcbiAgLy8gaWYgd2UgaGF2ZSBubyBzdGF0ZSB0byByb2xsIGJhY2sgdG9cbiAgaWYgKGZyYW1lX2RpZmZlcmVuY2UgPiAyMCB8fCAhdGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV0pIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInN5bmMgdG9vIGZhciBiYWNrIHwgXCIgKyBmcmFtZV9kaWZmZXJlbmNlKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyByZXNldCBnYW1lIHN0YXRlXG4gIHRoaXMuc2V0X2dhbWVfc3RhdGUodGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV0sIHRydWUpO1xuXG4gIC8vIHJlc2V0IHBsYXllclxuICB0aGlzLnN0b3JlX3Jlc3BvbnNlcyA9IFtdO1xuICB0aGlzLmdhbWUucGxheWVyX29iai54ID0gc2VydmVyX3Jlc3BvbnNlLng7XG4gIHRoaXMuZ2FtZS5wbGF5ZXJfb2JqLnkgPSBzZXJ2ZXJfcmVzcG9uc2UueTtcbiAgdGhpcy5nYW1lLnBsYXllcl9vYmouc3BlZWRfeCA9IHNlcnZlcl9yZXNwb25zZS5zcGVlZF94O1xuICB0aGlzLmdhbWUucGxheWVyX29iai5zcGVlZF95ID0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3k7XG5cbiAgLy8gcnVuIGFsbCBmcmFtZXMgdXAgdG8gdGhpcyBwb2ludFxuICBmb3IgKHZhciBpID0gMTsgaSA8PSBmcmFtZV9kaWZmZXJlbmNlOyBpKyspIHtcbiAgICB0aGlzLmZyYW1lX3J1bihmcmFtZSArIGkpO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBSZXNvbHZlIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5yZXNvbHZlX29iamVjdHMgPSBmdW5jdGlvbihvYmplY3RzLCBmcmFtZSkge1xuICAvLyBjaGVjayBmb3IgdW5jcmVhdGVkIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIG9iamVjdHMpIHtcbiAgICBpZiAoIXRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHNba2V5XSkge1xuICAgICAgaWYgKCF0aGlzLndhaXRfdG9fY3JlYXRlW2tleV0gfHwgdGhpcy53YWl0X3RvX2NyZWF0ZVtrZXldICsgNDAgPCBmcmFtZSkge1xuICAgICAgICBkZWxldGUgdGhpcy53YWl0X3RvX2NyZWF0ZVtrZXldO1xuICAgICAgICB0aGlzLmdhbWUuY3JlYXRlX29iamVjdChvYmplY3RzW2tleV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGlmIHRoZXJlJ3Mgbm8gY29ycmVzcG9uZGluZyBzZXJ2ZXIgb2JqZWN0XG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgaWYgKCFvYmplY3RzW2tleV0pIHtcbiAgICAgIC8vIGdpdmUgdGhlbSBhIGRlbGF5XG4gICAgICBpZiAoIXRoaXMud2FpdF90b19kZXN0cm95W2tleV0pIHtcbiAgICAgICAgdGhpcy53YWl0X3RvX2Rlc3Ryb3lba2V5XSA9IGZyYW1lICsgNDA7XG4gICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgIC8vIHJlbW92ZSB3aGVuIGRlbGF5IGhhcyBleHBpcmVkXG4gICAgICB9IGVsc2UgaWYgKHRoaXMud2FpdF90b19kZXN0cm95W2tleV0gPCBmcmFtZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgICAgICBkZWxldGUgdGhpcy53YWl0X3RvX2Rlc3Ryb3lba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBtYXRjaCB1cCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgLy8gaWYgb3VyIHBsYXllciBhbmQgd2FpdGluZyBmb3IgYWN0aW9uIHJlc3BvbnNlc1xuICAgIGlmIChrZXkgPT09IFwicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgIGlmICh0aGlzLnN0b3JlX3Jlc3BvbnNlcy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIG9iaiA9IHRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICB2YXIgcmVzX29iaiA9IG9iamVjdHNba2V5XTtcblxuICAgIC8vIGlnbm9yZSBhbnkgb2JqZWN0cyB3aXRoIG5vIHJlZmVyZW5jZVxuICAgIGlmICghcmVzX29iaikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gbWF0Y2ggdmFsdWVzXG4gICAgaWYgKG9iai50eXBlICE9PSByZXNfb2JqLnR5cGUpIHtcbiAgICAgIG9iai50eXBlID0gcmVzX29iai50eXBlO1xuICAgICAgb2JqLmMgPSB0aGlzLmdhbWUuYy5vYmplY3RzW29iai50eXBlXTtcbiAgICB9XG4gICAgb2JqLmdyb3VuZGVkID0gcmVzX29iai5ncm91bmRlZDtcblxuICAgIC8vIGlmIGdyb3VuZGVkIG9yIHVzXG4gICAgaWYgKG9iai5ncm91bmRlZCB8fCBvYmoucGxheWVyX2lkID09PSB0aGlzLnBsYXllcl9pZCkge1xuICAgICAgb2JqLnggPSByZXNfb2JqLng7XG4gICAgICBvYmoueSA9IHJlc19vYmoueTtcbiAgICAgIG9iai5zcGVlZF94ID0gcmVzX29iai5zcGVlZF94O1xuICAgICAgb2JqLnNwZWVkX3kgPSByZXNfb2JqLnNwZWVkX3k7XG5cbiAgICAgIC8vIHNldCBpbnRlcnBvbGF0aW9uIHBvc2l0aW9uXG4gICAgfSBlbHNlIGlmICghb2JqLmFjdGlvbmVkKSB7XG4gICAgICBvYmouZ2hvc3QgPSBmcmFtZTtcbiAgICAgIG9iai5neCA9IG9iai54O1xuICAgICAgb2JqLmd5ID0gb2JqLnk7XG4gICAgICBvYmoueCA9IHJlc19vYmoueDtcbiAgICAgIG9iai55ID0gcmVzX29iai55O1xuICAgICAgb2JqLnNwZWVkX3ggPSByZXNfb2JqLnNwZWVkX3g7XG4gICAgICBvYmouc3BlZWRfeSA9IHJlc19vYmouc3BlZWRfeTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFJlc29sdmUgb2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfZXhwbG9zaW9ucyA9IGZ1bmN0aW9uKGV4cGxvc2lvbnMsIGZyYW1lKSB7XG4gIC8vIGNoZWNrIGZvciB1bmNyZWF0ZWQgZXhwbG9zaW9uc1xuICBmb3IgKHZhciBrZXkgaW4gZXhwbG9zaW9ucykge1xuICAgIGlmICghdGhpcy5nYW1lLmNvcmUuc3RhdGUuZXhwbG9zaW9uc1trZXldKSB7XG4gICAgICB0aGlzLmdhbWUuY29yZS5jcmVhdGVfZXhwbG9zaW9uKGV4cGxvc2lvbnNba2V5XSk7XG5cbiAgICAgIC8vIGVuc3VyZSBjb3JyZWN0IHBvc2l0aW9uXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLmV4cGxvc2lvbnNba2V5XS54ID0gZXhwbG9zaW9uc1trZXldLng7XG4gICAgICB0aGlzLmdhbWUuY29yZS5zdGF0ZS5leHBsb3Npb25zW2tleV0ueSA9IGV4cGxvc2lvbnNba2V5XS55O1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBUcmFja2VyIEFycm93c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biB0aGUgYXJyb3dzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fYXJyb3dzID0gZnVuY3Rpb24oKSB7XG4gIGZvciAodmFyIHR5cGUgaW4gdGhpcy5zY2hlbWUuYXJyb3dzKSB7XG4gICAgdmFyIGFycm93ID0gdGhpcy5zY2hlbWUuYXJyb3dzW3R5cGVdO1xuICAgIGlmICghYXJyb3cpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGZpbmQgY2xvc2VzdCB0aGluZ1xuICAgIHZhciBsb3dlc3QgPSA5OTk5OTtcbiAgICB2YXIgY2xvc2VzdF9vYmogPSBudWxsO1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiYgb2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAob2JqLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgdmFyIGRpc3QgPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZShcbiAgICAgICAgICBvYmoueCxcbiAgICAgICAgICBvYmoueSxcbiAgICAgICAgICB0aGlzLmNhbWVyYS54LFxuICAgICAgICAgIHRoaXMuY2FtZXJhLnlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGRpc3QgPCBsb3dlc3QpIHtcbiAgICAgICAgICBsb3dlc3QgPSBkaXN0O1xuICAgICAgICAgIGNsb3Nlc3Rfb2JqID0gb2JqO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghY2xvc2VzdF9vYmopIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBzY3JlZW4gcG9zaXRpb25cbiAgICB2YXIgcG9zID0gdGhpcy5zY3JlZW5fcG9zaXRpb24oY2xvc2VzdF9vYmoueCwgY2xvc2VzdF9vYmoueSwgODApO1xuICAgIGlmIChwb3Mub25fc2NyZWVuKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBzaG93IGFuIGFycm93XG4gICAgdmFyIGFuZ2xlID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhcbiAgICAgIHRoaXMuY2FtZXJhLngsXG4gICAgICB0aGlzLmNhbWVyYS55LFxuICAgICAgY2xvc2VzdF9vYmoueCxcbiAgICAgIGNsb3Nlc3Rfb2JqLnlcbiAgICApO1xuICAgIHZhciBkaXN0ID0gbWluKGxvd2VzdCwgbWluKHRoaXMuY2FudmFzLmN4LCB0aGlzLmNhbnZhcy5jeSkpIC0gMjI7XG4gICAgdmFyIHh5ID0geHlfc3BlZWQoYW5nbGUsIGRpc3QpO1xuICAgIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICAgIHR5cGU6IFwiYXJyb3ctXCIgKyBhcnJvdyxcbiAgICAgIHg6IHJvdW5kKHRoaXMuY2FtZXJhLnggKyB4eS54KSxcbiAgICAgIHk6IHJvdW5kKHRoaXMuY2FtZXJhLnkgKyB4eS55KSxcbiAgICAgIGFuZ2xlOiBhbmdsZV9hZGQoYW5nbGUsIDI3MClcbiAgICB9KTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBCYWNrZ3JvdW5kIExheWVyXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGJhY2tncm91bmRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfYmFja2dyb3VuZCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmJnID0ge307XG4gIHRoaXMuYmcucGFyYWxsYXggPSAwLjU7XG4gIHRoaXMuYmcueCA9IDA7XG4gIHRoaXMuYmcueSA9IDA7XG4gIHRoaXMuYmcudyA9IHRoaXMuaW1nLmJnLndpZHRoO1xuICB0aGlzLmJnLmggPSB0aGlzLmltZy5iZy5oZWlnaHQ7XG4gIHRoaXMuYmcucGF0dGVybiA9IHRoaXMuY2FudmFzLmNvbnQuY3JlYXRlUGF0dGVybih0aGlzLmltZy5iZywgXCJyZXBlYXRcIik7XG59O1xuXG4vKiBEcmF3IHRoZSBiYWNrZ3JvdW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19iYWNrZ3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gIC8vIGhvdyBtdWNoIGhhdmUgd2UgbW92ZWQgYnlcbiAgdmFyIGR4ID1cbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3godGhpcy5jYW1lcmEueCwgdGhpcy5jYW1lcmEucHgpICpcbiAgICAgIHRoaXMuYmcucGFyYWxsYXgsXG4gICAgZHkgPVxuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeSh0aGlzLmNhbWVyYS55LCB0aGlzLmNhbWVyYS5weSkgKlxuICAgICAgdGhpcy5iZy5wYXJhbGxheDtcblxuICAvLyBhZGQgbW92ZW1lbnQgbXVsdGlwbGllZCBieSBwYXJhbGxheCBkZWdyZWVcbiAgdGhpcy5iZy54ID0gbl9sb29wKHRoaXMuYmcueCArIGR4LCAwLCB0aGlzLmJnLncpO1xuICB0aGlzLmJnLnkgPSBuX2xvb3AodGhpcy5iZy55ICsgZHksIDAsIHRoaXMuYmcuaCk7XG5cbiAgLy8gZHJhdyBpdFxuICB2YXIgc2l6ZSA9IG1heCh0aGlzLmNhbnZhcy5oLCB0aGlzLmNhbnZhcy53KTtcbiAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoXG4gICAgdGhpcy5iZy54ICsgdGhpcy5jYW1lcmEuc3gsXG4gICAgdGhpcy5iZy55ICsgdGhpcy5jYW1lcmEuc3lcbiAgKTtcbiAgdGhpcy5jYW52YXMuY29udC5maWxsU3R5bGUgPSB0aGlzLmJnLnBhdHRlcm47XG4gIHRoaXMuY2FudmFzLmNvbnQuZmlsbFJlY3QoLXNpemUsIC1zaXplLCBzaXplICogMywgc2l6ZSAqIDMpO1xuICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZShcbiAgICAtKHRoaXMuYmcueCArIHRoaXMuY2FtZXJhLnN4KSxcbiAgICAtKHRoaXMuYmcueSArIHRoaXMuY2FtZXJhLnN5KVxuICApO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBDYW1lcmEgUG9zaXRpb25cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgY2FtZXJhIHBvc2l0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9jYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jYW1lcmEgPSB7fTtcbiAgdGhpcy5jYW1lcmEueCA9IHJvdW5kKHRoaXMubWFwLmZnLmNhbnYud2lkdGggLyAyKTtcbiAgdGhpcy5jYW1lcmEueSA9IHJvdW5kKHRoaXMubWFwLmZnLmNhbnYuaGVpZ2h0IC8gMik7XG4gIHRoaXMuY2FtZXJhLnB4ID0gdGhpcy5jYW1lcmEueDtcbiAgdGhpcy5jYW1lcmEucHkgPSB0aGlzLmNhbWVyYS55O1xuXG4gIC8vIHdhdGNoZXIgZm9sbG93IHBsYXllclxuICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPSBcImxlYWRlclwiO1xuICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3dfcGxheWVyID0gXCJcIjtcblxuICAvLyBjYW1lcmEgd2VhcG9uXG4gIHRoaXMuY2FtZXJhX3dlYXBvbl9rZXkgPSBudWxsO1xuXG4gIC8vIGNhbWVyYSBzaGFrZSBvbiBoaXRcbiAgdGhpcy5jYW1lcmEuc2hha2VfZnJhbWUgPSBudWxsO1xuICB0aGlzLmNhbWVyYS5zeCA9IDA7XG4gIHRoaXMuY2FtZXJhLnN5ID0gMDtcblxuICAvLyBjYW1lcmEgZm9jdXMgZXZlbnRcbiAgdGhpcy5jYW1lcmEuZm9jdXMgPSBudWxsO1xuICB0aGlzLmNhbWVyYS5mb2N1c190aW1lID0gMDtcbiAgdGhpcy5jYW1lcmEuZnggPSAwO1xuICB0aGlzLmNhbWVyYS5meSA9IDA7XG5cbiAgLy8gY3Vyc29yXG4gIHRoaXMuY3Vyc29yID0geyB4OiAwLCB5OiAwIH07XG5cbiAgLy8gd2VhcG9uIGZvbGxvd2luZ1xuICB0aGlzLndlYXBvbl9mb2xsb3cgPSBmYWxzZTtcbiAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcbn07XG5cbi8qIFN3aXRjaCB3YXRjaGVyIGNhbWVyYVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnN3aXRjaF93YXRjaGVyX2NhbWVyYSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXdhdGNoKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXModGhpcy5wbGF5ZXJzKTtcbiAgdmFyIGluZGV4ID0ga2V5cy5pbmRleE9mKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIpO1xuICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgaWYgKGluZGV4ID09PSBrZXlzLmxlbmd0aCAtIDEpIHtcbiAgICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBudWxsO1xuICAgICAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93ID0gXCJsZWFkZXJcIjtcbiAgICAgIHRoaXMuc2V0X2FsZXJ0KFwiRm9sbG93aW5nIHRoZSBMZWFkZXJcIiwgXCIjY2NmZmNjXCIsIDEwMCk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBrZXlzW2luZGV4ICsgMV07XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBrZXlzWzBdO1xuICB9XG4gIGNvbnNvbGUubG9nKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIpO1xuICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW3RoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXJdO1xuICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPSBcInBsYXllclwiO1xuICB0aGlzLnNldF9hbGVydChcIkZvbGxvd2luZyBcIiArIHBsYXllci5uYW1lLCBcIiNlZWVlZWVcIiwgMTAwKTtcbn07XG5cbi8qIENhbGN1bGF0ZSBjdXJyZW50IGNhbWVyYSBwb3NpdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9jYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgLy8gc3RvcCBmb2xsb3dpbmcgaWYgaGl0XG4gIGlmICh0aGlzLndlYXBvbl9mb2xsb3dpbmcgJiYgdGhpcy5wbGF5ZXIgJiYgdGhpcy5wbGF5ZXIuaGl0ID4gMCkge1xuICAgIHRoaXMud2VhcG9uX2ZvbGxvd2luZyA9IFwiXCI7XG4gIH1cblxuICAvLyBzZXQgcHJldmlvdXMgcG9zaXRpb25cbiAgdGhpcy5jYW1lcmEucHggPSB0aGlzLmNhbWVyYS54O1xuICB0aGlzLmNhbWVyYS5weSA9IHRoaXMuY2FtZXJhLnk7XG5cbiAgdmFyIHgsIHksIG1vdmU7XG5cbiAgLy8gc2V0IGZhbGxiYWNrIGNhbWVyYVxuICB2YXIgd2F0Y2hfcGxheWVyX2lkID0gMDtcbiAgaWYgKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9PT0gXCJsZWFkZXJcIikge1xuICAgIHdhdGNoX3BsYXllcl9pZCA9IHRoaXMubGVhZGVyO1xuICB9IGVsc2UgaWYgKHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9PT0gXCJwbGF5ZXJcIikge1xuICAgIHdhdGNoX3BsYXllcl9pZCA9IHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXI7XG4gIH1cblxuICAvLyBmaW5kIG9iamVjdCB0byBmb2xsb3dcbiAgdmFyIGZvbGxvd19vYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1t0aGlzLndlYXBvbl9mb2xsb3dpbmddO1xuICB2YXIgd2F0Y2hfb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyB3YXRjaF9wbGF5ZXJfaWRdO1xuICBpZiAoZm9sbG93X29iaikge1xuICAgIHggPSBmb2xsb3dfb2JqLmR4O1xuICAgIHkgPSBmb2xsb3dfb2JqLmR5O1xuICAgIG1vdmUgPSAzMDtcbiAgfSBlbHNlIGlmICh0aGlzLnBsYXllcl9vYmopIHtcbiAgICB4ID0gdGhpcy5wbGF5ZXJfb2JqLmR4O1xuICAgIHkgPSB0aGlzLnBsYXllcl9vYmouZHk7XG4gICAgbW92ZSA9IDYwO1xuICB9IGVsc2UgaWYgKHdhdGNoX29iaikge1xuICAgIHggPSB3YXRjaF9vYmouZHg7XG4gICAgeSA9IHdhdGNoX29iai5keTtcbiAgICBtb3ZlID0gMzA7XG4gIH1cblxuICAvLyBnbyB0byBmb2N1cyBldmVudFxuICBpZiAoXG4gICAgdGhpcy5jYW1lcmEuZm9jdXMgIT0gbnVsbCAmJlxuICAgIHRoaXMuY2FtZXJhLmZvY3VzIDwgdGhpcy5jb3JlLnN0YXRlLmZyYW1lICYmXG4gICAgdGhpcy5jYW1lcmEuZm9jdXMgKyB0aGlzLmNhbWVyYS5mb2N1c190aW1lID4gdGhpcy5jb3JlLnN0YXRlLmZyYW1lXG4gICkge1xuICAgIHggPSB0aGlzLmNhbWVyYS5meDtcbiAgICB5ID0gdGhpcy5jYW1lcmEuZnk7XG4gICAgbW92ZSA9IDEwMDtcblxuICAgIC8vIGZvbGxvdyBjdXJzb3JcbiAgfSBlbHNlIGlmICh0aGlzLm1vdXNlX2ZvbGxvdyB8fCAhbW92ZSkge1xuICAgIHggPSB0aGlzLmN1cnNvci54O1xuICAgIHkgPSB0aGlzLmN1cnNvci55O1xuICAgIG1vdmUgPVxuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2UodGhpcy5jYW1lcmEueCwgdGhpcy5jYW1lcmEueSwgeCwgeSkgKiAwLjA1O1xuICB9XG5cbiAgLy8gbW92ZSB0b3dhcmRzIG5ldyBwb3NpdGlvblxuICBpZiAobW92ZSkge1xuICAgIHZhciBkeCA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3godGhpcy5jYW1lcmEueCwgeCk7XG4gICAgdmFyIGR5ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeSh0aGlzLmNhbWVyYS55LCB5KTtcbiAgICB2YXIgbGltaXQgPSBjaGVja19zcGVlZChkeCwgZHksIG1vdmUpO1xuICAgIHRoaXMuY2FtZXJhLnggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChyb3VuZCh0aGlzLmNhbWVyYS54ICsgbGltaXQueCkpO1xuICAgIHRoaXMuY2FtZXJhLnkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShyb3VuZCh0aGlzLmNhbWVyYS55ICsgbGltaXQueSkpO1xuICB9XG5cbiAgLy8gYWRkIHNjcmVlbiBzaGFrZVxuICB0aGlzLmNhbWVyYS5zeCA9IDA7XG4gIHRoaXMuY2FtZXJhLnN5ID0gMDtcbiAgdmFyIGRpZmYgPSB0aGlzLmNhbWVyYS5zaGFrZV9mcmFtZVxuICAgID8gdGhpcy5jb3JlLnN0YXRlLmZyYW1lIC0gdGhpcy5jYW1lcmEuc2hha2VfZnJhbWVcbiAgICA6IDA7XG4gIGlmIChkaWZmIDwgMTUgJiYgZGlmZiA+IDApIHtcbiAgICB0aGlzLmNhbWVyYS5zeCA9IGNvcygoZGlmZiAvIDIuNSAtIDEuNSkgKiBwaSkgKiB0aGlzLmNhbWVyYS5zaGFrZV9zaXplO1xuICAgIHRoaXMuY2FtZXJhLnN5ID0gc2luKChkaWZmIC8gMyAtIDEpICogcGkpICogdGhpcy5jYW1lcmEuc2hha2Vfc2l6ZTtcbiAgfVxuXG4gIC8vIGZpeCBjdXJzb3IgaW5wdXRcbiAgdGhpcy5jdXJzb3JfbWFwKCk7XG59O1xuXG4vKiBUb2dnbGUgd2VhcG9uIGZvbGxvd2luZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnRvZ2dsZV93ZWFwb25fZm9sbG93ID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICB0aGlzLndlYXBvbl9mb2xsb3cgPSAhdGhpcy53ZWFwb25fZm9sbG93O1xuXG4gIGlmIChtZXNzYWdlKSB7XG4gICAgdmFyIHRleHQgPSBcIm9uXCI7XG4gICAgaWYgKCF0aGlzLndlYXBvbl9mb2xsb3cpIHtcbiAgICAgIHRleHQgPSBcIm9mZlwiO1xuICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcbiAgICB9XG4gICAgdGV4dCA9IFwiRm9sbG93IHdlYXBvbnMgXCIgKyB0ZXh0O1xuICAgIHRoaXMuc2V0X2FsZXJ0KHRleHQsIFwiI2VlZVwiKTtcbiAgfVxufTtcblxuLyogVG9nZ2xlIG1vdXNlIGZvbGxvd2luZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnRvZ2dsZV9tb3VzZV9mb2xsb3cgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5tb3VzZV9mb2xsb3cgPSAhdGhpcy5tb3VzZV9mb2xsb3c7XG4gIHZhciB0ZXh0ID0gdGhpcy5tb3VzZV9mb2xsb3cgPyBcIm9uXCIgOiBcIm9mZlwiO1xuICB0ZXh0ID0gXCJGcmVlIGNhbSBcIiArIHRleHQ7XG4gIHRoaXMuc2V0X2FsZXJ0KHRleHQsIFwiI2VlZVwiKTtcbn07XG5cbmdhbWUucHJvdG90eXBlLmNhbmNlbF9tb3VzZV9mb2xsb3cgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMubW91c2VfZm9sbG93KSB7XG4gICAgdGhpcy50b2dnbGVfbW91c2VfZm9sbG93KCk7XG4gIH1cbn07XG5cbi8qIENhbGN1bGF0ZSBjdXJzb3IgcG9zaXRpb24gb24gbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3Vyc29yX21hcCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2NhbGVfeCA9IHRoaXMuY2FudmFzLmNhbnYub2Zmc2V0V2lkdGggLyB0aGlzLmNhbnZhcy53O1xuICB2YXIgc2NhbGVfeSA9IHRoaXMuY2FudmFzLmNhbnYub2Zmc2V0SGVpZ2h0IC8gdGhpcy5jYW52YXMuaDtcbiAgdmFyIHgxID1cbiAgICB0aGlzLmNhbWVyYS54ICtcbiAgICByb3VuZCgodGhpcy5pbnB1dC5jdXJzb3IueCAtIHJvdW5kKGlubmVyV2lkdGggLyAyKSkgKiBzY2FsZV94KTtcbiAgdmFyIHkxID1cbiAgICB0aGlzLmNhbWVyYS55ICtcbiAgICByb3VuZCgodGhpcy5pbnB1dC5jdXJzb3IueSAtIHJvdW5kKGlubmVySGVpZ2h0IC8gMikpICogc2NhbGVfeSk7XG4gIHRoaXMuY3Vyc29yLnggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChyb3VuZCh4MSkpO1xuICB0aGlzLmN1cnNvci55ID0gdGhpcy5jb3JlLm1hcC5sb29wX3kocm91bmQoeTEpKTtcbn07XG5cbi8qIFNjcmVlbiBwb3NpdGlvbiBvZiBhIGNvLW9yZGluYXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2NyZWVuX3Bvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgc2l6ZSkge1xuICB2YXIgeDEgPVxuICAgICAgdGhpcy5jYW52YXMuY3ggK1xuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeCh0aGlzLmNhbWVyYS54IC0gdGhpcy5jYW1lcmEuc3gsIHgpLFxuICAgIHkxID1cbiAgICAgIHRoaXMuY2FudmFzLmN5ICtcbiAgICAgIHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kodGhpcy5jYW1lcmEueSAtIHRoaXMuY2FtZXJhLnN5LCB5KSxcbiAgICBvbl9zY3JlZW4gPVxuICAgICAgeDEgPiAtc2l6ZSAmJlxuICAgICAgeDEgPCB0aGlzLmNhbnZhcy53ICsgc2l6ZSAmJlxuICAgICAgeTEgPiAtc2l6ZSAmJlxuICAgICAgeTEgPCB0aGlzLmNhbnZhcy5oICsgc2l6ZTtcblxuICByZXR1cm4ge1xuICAgIHg6IHgxLFxuICAgIHk6IHkxLFxuICAgIG9uX3NjcmVlbjogb25fc2NyZWVuXG4gIH07XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIE1haW4gQ2FudmFzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGNhbnZhc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9jYW52YXMgPSBmdW5jdGlvbigpIHtcbiAgLy8gc2V0IHVwIG1haW4gY2FudmFzIGRpbWVuc2lvbnMgYW5kIHBvc2l0aW9uXG4gIHZhciBkID0gc2VsZWN0KFwicHJvamVjdGFudHNcIik7XG4gIHRoaXMuY2FudmFzID0ge307XG5cbiAgLy8gbGltaXQgZ2FtZSBzaXplXG4gIHRoaXMuY2FudmFzLncgPSBkLm9mZnNldFdpZHRoO1xuICB0aGlzLmNhbnZhcy5oID0gZC5vZmZzZXRIZWlnaHQ7XG4gIGlmICh0aGlzLmNhbnZhcy5oIDwgODAwKSB7XG4gICAgdGhpcy5jYW52YXMudyA9IHJvdW5kKHRoaXMuY2FudmFzLncgKiAoODAwIC8gdGhpcy5jYW52YXMuaCkpO1xuICAgIHRoaXMuY2FudmFzLmggPSByb3VuZCh0aGlzLmNhbnZhcy5oICogKDgwMCAvIHRoaXMuY2FudmFzLmgpKTtcbiAgfVxuICBpZiAodGhpcy5jYW52YXMuaCA+IDEwMDApIHtcbiAgICB0aGlzLmNhbnZhcy53ID0gcm91bmQodGhpcy5jYW52YXMudyAqICgxMDAwIC8gdGhpcy5jYW52YXMuaCkpO1xuICAgIHRoaXMuY2FudmFzLmggPSByb3VuZCh0aGlzLmNhbnZhcy5oICogKDEwMDAgLyB0aGlzLmNhbnZhcy5oKSk7XG4gIH1cbiAgdGhpcy5jYW52YXMuY3ggPSByb3VuZCh0aGlzLmNhbnZhcy53IC8gMik7XG4gIHRoaXMuY2FudmFzLmN5ID0gcm91bmQodGhpcy5jYW52YXMuaCAvIDIpO1xuXG4gIC8vIGluaXRpYWxpc2UgbWFpbiBjYW52YXNcbiAgdGhpcy5jYW52YXMuY2FudiA9IGVsZW1lbnQoeyB0eXBlOiBcImNhbnZhc1wiIH0pO1xuICB0aGlzLmNhbnZhcy5jYW52LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICB0aGlzLmNhbnZhcy5jb250ID0gdGhpcy5jYW52YXMuY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIHRoaXMuY2FudmFzLmNhbnYud2lkdGggPSB0aGlzLmNhbnZhcy53O1xuICB0aGlzLmNhbnZhcy5jYW52LmhlaWdodCA9IHRoaXMuY2FudmFzLmg7XG5cbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmNhbnZhcy5jYW52KTtcbn07XG5cbi8qIEZyYW1lIHJlbmRlcmluZ1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2NhbnZhcyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjbGVhciB0aGUgY2FudmFzXG4gIHRoaXMuY2FudmFzLmNvbnQuY2xlYXJSZWN0KDAsIDAsIHRoaXMudywgdGhpcy5oKTtcblxuICAvLyBkbyB0aGUgZHJhd2luZ1xuICB0aGlzLmRyYXdfYmFja2dyb3VuZCgpO1xuICB0aGlzLmRyYXdfbWFwKCk7XG4gIHRoaXMuZHJhd19zcHJpdGVzKCk7XG4gIHRoaXMuZHJhd19sYWJlbHMoKTtcbiAgdGhpcy5kcmF3X21lc3NhZ2VzKCk7XG5cbiAgLy8gY2xlYXIgc3ByaXRlc1xuICB0aGlzLnNwcml0ZXMgPSBbXTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgT2JqZWN0IExhYmVsc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIE1hbmFnZSBsYWJlbHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fbGFiZWxzID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNyZWF0ZSBsYWJlbHNcbiAgZm9yIChrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAob2JqLmMubGFiZWxzICYmICF0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICB0aGlzLmxhYmVsc1trZXldID0ge307XG4gICAgICBmb3IgKHR5cGUgaW4gb2JqLmMubGFiZWxzKSB7XG4gICAgICAgIGlmIChvYmouYy5sYWJlbHNbdHlwZV0pIHtcbiAgICAgICAgICB0aGlzLmNyZWF0ZV9sYWJlbCh0aGlzLmxhYmVsc1trZXldLCB0eXBlLCBrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIHRocm91Z2ggbGFiZWxzXG4gIGZvciAoa2V5IGluIHRoaXMubGFiZWxzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKCFvYmopIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmxhYmVsc1trZXldO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGZvciAodHlwZSBpbiB0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICB0aGlzLnNldF9sYWJlbCh0aGlzLmxhYmVsc1trZXldW3R5cGVdLCBvYmopO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ3JlYXRlIGxhYmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuY3JlYXRlX2xhYmVsID0gZnVuY3Rpb24ocmVmLCB0eXBlLCBrZXkpIHtcbiAgLy8gY2hlY2sgaGVhbHRoIGlzIGFjdGl2ZVxuICBpZiAodHlwZSA9PT0gXCJwbGF5ZXJfaGVhbHRoXCIgJiYgIXRoaXMuc2NoZW1lLmhlYWx0aCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNyZWF0ZSBhbmQgYWRkIHRvIHJlZiBvYmplY3RcbiAgdmFyIGNhbnYgPSBlbGVtZW50KHsgdHlwZTogXCJjYW52YXNcIiB9KTtcbiAgdmFyIGNvbnQgPSBjYW52LmdldENvbnRleHQoXCIyZFwiKTtcbiAgcmVmW3R5cGVdID0geyBjYW52OiBjYW52LCBjb250OiBjb250LCB0ZXh0OiBcIlwiLCBrZXk6IGtleSwgdHlwZTogdHlwZSB9O1xufTtcblxuLyogU2V0IGxhYmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2xhYmVsID0gZnVuY3Rpb24obGFiZWwsIG9iaikge1xuICAvLyBwb3NpdGlvblxuICBpZiAobGFiZWwudHlwZSA9PT0gXCJwb3NpdGlvblwiKSB7XG4gICAgdGhpcy5zZXRfbGFiZWxfdGV4dChsYWJlbCwgb2JqLnggKyBcIiB8IFwiICsgb2JqLnkpO1xuICB9XG5cbiAgLy8gcGxheWVyIG5hbWVcbiAgZWxzZSBpZiAobGFiZWwudHlwZSA9PT0gXCJwbGF5ZXJfbmFtZVwiKSB7XG4gICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICBpZiAocGxheWVyKSB7XG4gICAgICB0aGlzLnNldF9sYWJlbF90ZXh0KGxhYmVsLCBwbGF5ZXIubmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmxhYmVsc1tsYWJlbC5rZXldW2xhYmVsLnR5cGVdO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIC8vIGhlYWx0aCBiYXJcbiAgZWxzZSBpZiAobGFiZWwudHlwZSA9PT0gXCJwbGF5ZXJfaGVhbHRoXCIpIHtcbiAgICB0aGlzLnNldF9sYWJlbF9oZWFsdGgobGFiZWwsIG9iai5wbGF5ZXJfaWQpO1xuICB9XG5cbiAgLy8gdGltZW91dFxuICBlbHNlIGlmIChsYWJlbC50eXBlID09PSBcInRpbWVvdXRcIikge1xuICAgIHRoaXMuc2V0X2xhYmVsX3RleHQoXG4gICAgICBsYWJlbCxcbiAgICAgIGNlaWwoKG9iai5jLnRpbWVvdXQgLSAodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC0gb2JqLmZyYW1lKSkgLyAyNClcbiAgICApO1xuICB9XG59O1xuXG4vKiBTZXQgdGV4dCBsYWJlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9sYWJlbF90ZXh0ID0gZnVuY3Rpb24obGFiZWwsIHRleHQpIHtcbiAgLy8gcHJlcCB0ZXh0XG4gIHRleHQgPSBTdHJpbmcodGV4dCk7XG4gIHRleHQgPSBzdHJfc3BhY2UodGV4dCk7XG5cbiAgLy8gaWYgdGhlcmUncyBubyBjaGFuZ2UgdG8gdGV4dFxuICBpZiAobGFiZWwudGV4dCA9PT0gdGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGRyYXcgdGV4dFxuICBsYWJlbC53ID0gbGFiZWwuY29udC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aCArIDk7XG4gIGxhYmVsLmggPSAxODtcbiAgbGFiZWwuY2Fudi53aWR0aCA9IGxhYmVsLnc7XG4gIGxhYmVsLmNhbnYuaGVpZ2h0ID0gbGFiZWwuaDtcbiAgbGFiZWwuY29udC5yZXN0b3JlKCk7XG4gIGxhYmVsLmNvbnQuY2xlYXJSZWN0KDAsIDAsIGxhYmVsLmNhbnYud2lkdGgsIGxhYmVsLmNhbnYuaGVpZ2h0KTtcbiAgbGFiZWwuY29udC5mb250ID0gXCIxMnB4ICdPcmJpdHJvbidcIjtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcIiMwMDBcIjtcbiAgbGFiZWwuY29udC5maWx0ZXIgPSBcImRyb3Atc2hhZG93KDAgMnB4IDRweCAjMDAwKVwiO1xuICBsYWJlbC5jb250LmZpbGxUZXh0KHRleHQsIDQsIDE0ICsgMC41KTtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcIiNkZGRcIjtcbiAgbGFiZWwuY29udC5maWxsVGV4dCh0ZXh0LCA0LCAxMiArIDAuNSk7XG4gIGxhYmVsLmNvbnQuc2F2ZSgpO1xufTtcblxuLyogU2V0IGhlYWx0aCBsYWJlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9sYWJlbF9oZWFsdGggPSBmdW5jdGlvbihsYWJlbCwgcGxheWVyX2lkKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuaGVhbHRoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgZGVsZXRlIHRoaXMubGFiZWxzW2xhYmVsLmtleV1bbGFiZWwudHlwZV07XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYXJlIHdlIGRvaW5nIGFueXRoaW5nIGF0IGFsbFxuICB2YXIgbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoW3BsYXllci5sZXZlbF07XG4gIGlmICghbGV2ZWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpcyBpdCB0aGUgc2FtZVxuICB2YXIgdGV4dCA9IHBsYXllci5oZWFsdGggKyBcIiAvIFwiICsgbGV2ZWw7XG4gIGlmICh0ZXh0ID09PSBsYWJlbC50ZXh0KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxhYmVsLnRleHQgPSB0ZXh0O1xuXG4gIC8vIGRyYXcgbGFiZWxcbiAgbGFiZWwudyA9IHJvdW5kKGxldmVsIC8gMikgKyA2O1xuICBsYWJlbC5oID0gODtcbiAgbGFiZWwuY2Fudi53aWR0aCA9IGxhYmVsLnc7XG4gIGxhYmVsLmNhbnYuaGVpZ2h0ID0gbGFiZWwuaDtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcInJnYmEoMjU1LDI1NSwyNTUsMC4xKVwiO1xuICBsYWJlbC5jb250LmZpbGxSZWN0KDAsIDAsIGxhYmVsLncsIGxhYmVsLmgpO1xuICBsYWJlbC5jb250LmZpbGxTdHlsZSA9IFwicmdiYSgwLDAsMCwwLjgpXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFJlY3QoMSwgMSwgbGFiZWwudyAtIDIsIGxhYmVsLmggLSAyKTtcbiAgbGFiZWwuY29udC5maWxsU3R5bGUgPSBcIiNlNDFhMWFcIjtcbiAgbGFiZWwuY29udC5maWxsUmVjdCgzLCAzLCByb3VuZChwbGF5ZXIuaGVhbHRoIC8gMiksIDIpO1xuXG4gIC8vIGFyZSB3ZSBoaWRpbmcgaXRcbiAgbGFiZWwuaGlkZSA9IHBsYXllci5kZWFkO1xufTtcblxuLyogRHJhdyBsYWJlbHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X2xhYmVscyA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIGFsbCBsYWJlbHNcbiAgZm9yIChrZXkgaW4gdGhpcy5sYWJlbHMpIHtcbiAgICAvLyBpZ25vcmUgZW1wdGllcyBvciBoaWRkZW5zXG4gICAgaWYgKCF0aGlzLmxhYmVsc1trZXldKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgc2NyZWVuIHBvc2l0aW9uIG9mIG9iamVjdFxuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIHZhciBwb3NpdGlvbiA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKG9iai5keCwgb2JqLmR5LCA1MCk7XG5cbiAgICAvLyBpZ25vcmUgdG9vIGZhciBhd2F5IG9iamVjdHNcbiAgICBpZiAoIXBvc2l0aW9uLm9uX3NjcmVlbikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ28gdGhyb3VnaCBsYWJlbHNcbiAgICB2YXIgbiA9IDA7XG4gICAgZm9yICh0eXBlIGluIHRoaXMubGFiZWxzW2tleV0pIHtcbiAgICAgIHZhciBsYWJlbCA9IHRoaXMubGFiZWxzW2tleV1bdHlwZV07XG4gICAgICBpZiAobGFiZWwuaGlkZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciB4ID0gcm91bmQocG9zaXRpb24ueCAtIGxhYmVsLncgLyAyKSArIDA7XG4gICAgICB2YXIgeSA9XG4gICAgICAgIHJvdW5kKHBvc2l0aW9uLnkgLSBsYWJlbC5oIC8gMiAtIG9iai5jLnNpemUgKiAyIC0gKGxhYmVsLmggLSA1KSAqIG4pIC1cbiAgICAgICAgMjA7XG4gICAgICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShsYWJlbC5jYW52LCB4LCB5KTtcbiAgICAgIG4rKztcbiAgICB9XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgTWFwIEdyYXBoaWNzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIHRoZSBtYXAgY2FudmFzZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X21hcCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24tb3V0XCI7XG59O1xuXG4vKiBEcmF3IHRoZSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X21hcCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgeCA9IHRoaXMuY2FudmFzLmN4IC0gdGhpcy5jYW1lcmEueCArIHRoaXMuY2FtZXJhLnN4O1xuICB2YXIgeSA9IHRoaXMuY2FudmFzLmN5IC0gdGhpcy5jYW1lcmEueSArIHRoaXMuY2FtZXJhLnN5O1xuXG4gIC8vIGRyYXcgbGF5ZXJzXG4gIHRoaXMuZHJhd19yZXBlYXRpbmdfbGF5ZXIodGhpcy5tYXAuYmcuY2FudiwgeCwgeSk7XG4gIHRoaXMuZHJhd19yZXBlYXRpbmdfbGF5ZXIodGhpcy5tYXAuZmcuY2FudiwgeCwgeSk7XG59O1xuXG4vKiBEcmF3IGxheWVyIGNhbnZhcyByZXBlYXRpbmcgb24gYWxsIHNpZGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19yZXBlYXRpbmdfbGF5ZXIgPSBmdW5jdGlvbihjYW52LCB4LCB5KSB7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggLSBjYW52LndpZHRoLCB5IC0gY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4LCB5IC0gY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4ICsgY2Fudi53aWR0aCwgeSAtIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCAtIGNhbnYud2lkdGgsIHkpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4ICsgY2Fudi53aWR0aCwgeSk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggLSBjYW52LndpZHRoLCB5ICsgY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4LCB5ICsgY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4ICsgY2Fudi53aWR0aCwgeSArIGNhbnYuaGVpZ2h0KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCwgeSk7XG59O1xuXG4vKiBEZXN0cm95IGxhbmQgb24gdGhlIG1hcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRlc3Ryb3lfbGFuZCA9IGZ1bmN0aW9uKHgsIHksIHNpemUpIHtcbiAgdGhpcy5tYXAuZmcuY29udC5iZWdpblBhdGgoKTtcbiAgdGhpcy5tYXAuZmcuY29udC5hcmMoeCwgeSwgc2l6ZSwgMCwgMiAqIHBpKTtcbiAgdGhpcy5tYXAuZmcuY29udC5maWxsKCk7XG59O1xuXG4vKiBHZXQgYSBwaWVjZSBvZiBsYW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZ2V0X2xhbmRfYmxvY2sgPSBmdW5jdGlvbih4LCB5LCB3LCBoKSB7XG4gIHZhciBjYW52ID0gZWxlbWVudCh7IHR5cGU6IFwiY2FudmFzXCIgfSk7XG4gIHZhciBjb250ID0gY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGNhbnYud2lkdGggPSB3O1xuICBjYW52LmhlaWdodCA9IGg7XG4gIGNvbnQuZHJhd0ltYWdlKHRoaXMubWFwLmZnLmNhbnYsIHgsIHksIHcsIGgsIDAsIDAsIHcsIGgpO1xuXG4gIHJldHVybiBjYW52O1xufTtcblxuLyogRHJhdyBwaWVjZSBvZiBsYW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19sYW5kX2Jsb2NrID0gZnVuY3Rpb24oeCwgeSwgY2Fudikge1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwibm9ybWFsXCI7XG4gIHRoaXMubWFwLmZnLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHgsIHkpO1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24tb3V0XCI7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIE9iamVjdCBNZXNzYWdlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIERyYXcgdGhlIG1lc3NhZ2VzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19tZXNzYWdlcyA9IGZ1bmN0aW9uKCkge1xuICAvLyBnbyB0aHJvdWdoIG1lc3NhZ2VzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBtZXNzYWdlID0gdGhpcy5tZXNzYWdlc1tpXTtcblxuICAgIC8vIGluY3JlbWVudCB0aW1lXG4gICAgbWVzc2FnZS50aW1lKys7XG4gICAgaWYgKG1lc3NhZ2UudGltZSA+IDQwKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VzLnNwbGljZShpLCAxKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBzY3JlZW4gcG9zaXRpb24gb2YgbWVzc2FnZVxuICAgIHZhciBwb3NpdGlvbiA9IHRoaXMuc2NyZWVuX3Bvc2l0aW9uKG1lc3NhZ2UueCwgbWVzc2FnZS55LCA1MCk7XG5cbiAgICAvLyBpZ25vcmUgdG9vIGZhciBhd2F5IG1lc3NhZ2VzXG4gICAgaWYgKCFwb3NpdGlvbi5vbl9zY3JlZW4pIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdvIHRocm91Z2ggbGFiZWxzXG4gICAgdmFyIHggPSByb3VuZChwb3NpdGlvbi54IC0gbWVzc2FnZS53IC8gMikgKyAwLjU7XG4gICAgdmFyIHkgPSByb3VuZChwb3NpdGlvbi55IC0gbWVzc2FnZS5oIC8gMikgLSAzMC41IC0gbWVzc2FnZS50aW1lO1xuXG4gICAgdGhpcy5jYW52YXMuY29udC5zYXZlKCk7XG4gICAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoMCwgMCk7XG4gICAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UobWVzc2FnZS5jYW52LCB4LCB5KTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnJlc3RvcmUoKTtcbiAgfVxufTtcblxuLyogTG9vayBmb3IgY2hhbmdlcyBpbiBoZWFsdGhcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfbWVzc2FnZSA9IGZ1bmN0aW9uKG9iaiwgY29sLCB0ZXh0LCBzaXplLCB5X29mZnNldCkge1xuICAvLyBzZXQgdXAgY2FudmFzXG4gIHZhciBtZXNzYWdlID0ge307XG4gIG1lc3NhZ2UuY2FudiA9IGVsZW1lbnQoeyB0eXBlOiBcImNhbnZhc1wiIH0pO1xuICBtZXNzYWdlLmNvbnQgPSBtZXNzYWdlLmNhbnYuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gIC8vIGRyYXcgdGV4dFxuICB0ZXh0ID0gc3RyX3NwYWNlKHRleHQpO1xuICBtZXNzYWdlLmNvbnQuZm9udCA9IHNpemUgKyBcInB4IE9yYml0cm9uXCI7XG4gIG1lc3NhZ2UudyA9IHJvdW5kKG1lc3NhZ2UuY29udC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aCkgKyA4O1xuICBtZXNzYWdlLmggPSBzaXplICsgNDtcbiAgbWVzc2FnZS5jYW52LndpZHRoID0gbWVzc2FnZS53O1xuICBtZXNzYWdlLmNhbnYuaGVpZ2h0ID0gbWVzc2FnZS5oO1xuICBtZXNzYWdlLmNvbnQuZm9udCA9IHNpemUgKyBcInB4IE9yYml0cm9uXCI7XG4gIC8vIG1lc3NhZ2UuY29udC5maWxsU3R5bGUgPSBcIiMwMDBcIjtcbiAgLy8gbWVzc2FnZS5jb250LmZpbGxUZXh0KHRleHQsIDMuNSwgc2l6ZSArIDAuNSk7XG4gIG1lc3NhZ2UuY29udC5maWxsU3R5bGUgPSBjb2w7XG4gIG1lc3NhZ2UuY29udC5maWxsVGV4dCh0ZXh0LCAzLjUsIHNpemUgKyAwLjUpO1xuXG4gIC8vIHNldCBwb3NpdGlvblxuICB2YXIgeV9vZmZzZXQgPSB5X29mZnNldCB8fCAwO1xuICBtZXNzYWdlLnggPSBvYmoueDtcbiAgbWVzc2FnZS55ID0gb2JqLnkgKyB5X29mZnNldDtcbiAgbWVzc2FnZS50aW1lID0gMDtcblxuICAvLyBhZGQgdG8gYXJyYXlcbiAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBTcHJpdGVzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIHNwcml0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X3Nwcml0ZXMgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5zcHJpdGVzID0gW107XG5cbiAgLy8gb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAob2JqLmhpZGUgPiAwKSB7XG4gICAgICBvYmouaGlkZS0tO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChvYmoudHlwZSA9PT0gXCJwbGF5ZXJcIikge1xuICAgICAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICAgICAgaWYgKHBsYXllcikge1xuICAgICAgICBpZiAocGxheWVyLmhpdCA+IDApIHtcbiAgICAgICAgICB0aGlzLmRyYXdfcGxheWVyX2hpdF9zcHJpdGVzKG9iaiwgcGxheWVyLmhpdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kcmF3X3BsYXllcl9zcHJpdGVzKG9iaiwgcGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHZhciBhcmdzID0ge1xuICAgICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICAgIHR5cGU6IG9iai5zcHJpdGVfa2V5LFxuICAgICAgeDogb2JqLmR4LFxuICAgICAgeTogb2JqLmR5LFxuICAgICAgYW5nbGU6IG9iai5kaXNwbGF5X2FuZ2xlLFxuICAgICAgYW5pbWF0ZTogb2JqLmFuaW1hdGUsXG4gICAgICBmbG9hdDogb2JqLmMuYW5pbWF0aW9uLmFpcl9mbG9hdCxcbiAgICAgIHJlcGVhdDogdHJ1ZVxuICAgIH07XG4gICAgdGhpcy5zcHJpdGVzLnVuc2hpZnQoYXJncyk7XG4gIH1cblxuICAvLyBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmV4cGxvc2lvbnMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5leHBsb3Npb25zW2tleV07XG4gICAgdmFyIGFyZ3MgPSB7XG4gICAgICBmcmFtZTogb2JqLmZyYW1lLFxuICAgICAgdHlwZTogb2JqLnNwcml0ZSxcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBhbmltYXRlOiB0cnVlXG4gICAgfTtcbiAgICB0aGlzLnNwcml0ZXMucHVzaChhcmdzKTtcbiAgfVxuXG4gIC8vIGRlY29yYXRpb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmRlY29yYXRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuZGVjb3JhdGlvbnNba2V5XTtcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgIGZyYW1lOiBvYmouZnJhbWUsXG4gICAgICB0eXBlOiBvYmouc3ByaXRlLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIGFuZ2xlOiBvYmouYW5nbGUsXG4gICAgICBhbmltYXRlOiB0cnVlLFxuICAgICAgcmVwZWF0OiBvYmoucmVwZWF0XG4gICAgfTtcbiAgICB0aGlzLnNwcml0ZXMudW5zaGlmdChhcmdzKTtcbiAgfVxuXG4gIC8vIGdldCBhcnJvd3NcbiAgdGhpcy5ydW5fYXJyb3dzKCk7XG5cbiAgLy8gZHJhdyB0aGVtXG4gIHRoaXMuZHJhd19zcHJpdGVzX2NhbnYoKTtcbn07XG5cbi8qIFBsYXllciBzcHJpdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19wbGF5ZXJfc3ByaXRlcyA9IGZ1bmN0aW9uKG9iaiwgcGxheWVyKSB7XG4gIHZhciB3ID1cbiAgICB0aGlzLnBsYXllcl9pZCA9PT0gb2JqLnBsYXllcl9pZCA/IHRoaXMuY3VycmVudF93ZWFwb24gOiBwbGF5ZXIud2VhcG9uO1xuICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbd107XG5cbiAgLy8gYm9keVxuICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICB0eXBlOiBvYmouc3ByaXRlX2tleSxcbiAgICB4OiBvYmouZHgsXG4gICAgeTogb2JqLmR5LFxuICAgIGFuZ2xlOiBvYmouZGlzcGxheV9hbmdsZSxcbiAgICBhbmltYXRlOiBvYmouYW5pbWF0ZSxcbiAgICByZXBlYXQ6IHRydWVcbiAgfSk7XG5cbiAgLy8gZ2V0IGhlYWQgZGlyZWN0aW9uIGFuZCBhbmdsZVxuICB2YXIgaGVhZF9kaXIgPSBvYmouZGlyZWN0aW9uO1xuICBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgdmFyIGRpZmYgPSBuX2RpZmYoXG4gICAgICBvYmouYmFycmVsX2FuZ2xlLFxuICAgICAgYW5nbGVfYWRkKG9iai5kaXNwbGF5X2FuZ2xlLCA5MCksXG4gICAgICAwLFxuICAgICAgMzYwXG4gICAgKTtcbiAgICBoZWFkX2RpciA9IGRpZmYgPj0gLTE4MCAmJiBkaWZmIDwgMCA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICB9XG4gIHZhciBoZWFkX2FuZ2xlID1cbiAgICBoZWFkX2RpciA9PT0gXCJyaWdodFwiID8gYW5nbGVfYWRkKG9iai5iYXJyZWxfYW5nbGUsIDE4MCkgOiBvYmouYmFycmVsX2FuZ2xlO1xuXG4gIC8vIHdlYXBvbnNcbiAgdmFyIHdlYXBvbl9zcHJpdGUgPSBcIlwiO1xuICBpZiAod2VhcG9uICYmIHdlYXBvbi5zcHJpdGUpIHtcbiAgICB2YXIgd2VhcG9uX3Nwcml0ZSA9IHdlYXBvbi5zcHJpdGU7XG4gICAgdmFyIHdlYXBvbl9mcmFtZSA9IDA7XG4gICAgdmFyIHRocm93aW5nID0gd2VhcG9uLnNwcml0ZSA9PT0gXCJ0aHJvd1wiO1xuXG4gICAgLy8ganVzdCBmaXJlZCBzcHJpdGVzXG4gICAgaWYgKG9iai5maXJlX3Nwcml0ZV9jb3VudCkge1xuICAgICAgd2VhcG9uX3Nwcml0ZSA9IHdlYXBvbi5maXJlX3Nwcml0ZTtcbiAgICAgIHdlYXBvbl9mcmFtZSA9IG9iai5maXJlX3Nwcml0ZV9mcmFtZTtcbiAgICAgIHRocm93aW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gYWRkIHRoZSB3ZWFwb24gc3ByaXRlXG4gICAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgICAgdHlwZTogXCJhbnQtd2VhcG9uLVwiICsgd2VhcG9uX3Nwcml0ZSArIFwiLVwiICsgaGVhZF9kaXIsXG4gICAgICB4OiB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHgpLFxuICAgICAgeTogdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5KSxcbiAgICAgIGZyYW1lOiB3ZWFwb25fZnJhbWUsXG4gICAgICBhbmltYXRlOiB0cnVlLFxuICAgICAgcmVwZWF0OiB0cnVlLFxuICAgICAgYW5nbGU6IGhlYWRfYW5nbGVcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGhlYWRcbiAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgIHR5cGU6IFwiYW50LWhlYWQtXCIgKyBoZWFkX2RpcixcbiAgICB4OiB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHgpLFxuICAgIHk6IHRoaXMuY29yZS5tYXAubG9vcF95KG9iai5keSksXG4gICAgYW5pbWF0ZTogdHJ1ZSxcbiAgICByZXBlYXQ6IHRydWUsXG4gICAgYW5nbGU6IGhlYWRfYW5nbGVcbiAgfSk7XG5cbiAgLy8gYWRkIGEgdGhyb3cgd2VhcG9uXG4gIGlmICh0aHJvd2luZykge1xuICAgIHZhciB0b2JqID0gdGhpcy5jLm9iamVjdHNbd2VhcG9uLm9iamVjdF07XG4gICAgdmFyIHRzcHJpdGUgPSB0b2JqLmFuaW1hdGlvbi5zcHJpdGU7XG4gICAgdmFyIHRvZmZfeCA9IHh5X3NwZWVkKG9iai5iYXJyZWxfYW5nbGUsIC0xNik7XG4gICAgdmFyIHRvZmZfeSA9IHh5X3NwZWVkKGFuZ2xlX2FkZChoZWFkX2FuZ2xlLCA5MCksIDE0KTtcbiAgICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgICB0eXBlOiB0c3ByaXRlLFxuICAgICAgeDogdGhpcy5jb3JlLm1hcC5sb29wX3gob2JqLmR4ICsgdG9mZl94LnggKyB0b2ZmX3kueCksXG4gICAgICB5OiB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkgKyB0b2ZmX3gueSArIHRvZmZfeS55KSxcbiAgICAgIGFuaW1hdGU6IGZhbHNlLFxuICAgICAgYW5nbGU6IGFuZ2xlX2FkZChvYmouYmFycmVsX2FuZ2xlLCA5MClcbiAgICB9KTtcbiAgfVxuXG4gIC8vIC8vIHNldCBjcm9zc2hhaXJcbiAgLy8gaWYgKHRoaXMucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkKSB7XG4gIC8vIFx0dmFyIG9mZnggPSB4eV9zcGVlZChhbmdsZSwgNTAgKyB3ZWFwb24ub2Zmc2V0X3gpO1xuICAvLyBcdHZhciBvZmZ5ID0geHlfc3BlZWQob2Zmc2V0X2FuZ2xlLCA3KTtcbiAgLy8gXHR0aGlzLnNwcml0ZXMucHVzaCh7XG4gIC8vIFx0XHR0eXBlOiBcImNyb3NzaGFpclwiLFxuICAvLyBcdFx0eDogcm91bmQob2JqLmR4ICsgb2ZmeC54ICsgb2ZmeS54KSxcbiAgLy8gXHRcdHk6IHJvdW5kKG9iai5keSArIG9mZngueSArIG9mZnkueSksXG4gIC8vIFx0XHRhbmdsZTogYW5nbGVfYWRkKHRoaXMuY3Jvc3NoYWlyLCAxODApXG4gIC8vIFx0fSk7XG4gIC8vIH1cbn07XG5cbi8qIFBsYXllciBoaXQgc3ByaXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfcGxheWVyX2hpdF9zcHJpdGVzID0gZnVuY3Rpb24ob2JqLCBoaXQpIHtcbiAgLy8gYm9keVxuICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICB0eXBlOiBoaXQgPCAxNSA/IFwiYW50LWJvZHktYWlyLWxlZnRcIiA6IFwiYW50LWJvZHktaGl0XCIsXG4gICAgeDogb2JqLmR4LFxuICAgIHk6IG9iai5keSxcbiAgICBhbmdsZTogb2JqLmRpc3BsYXlfYW5nbGUsXG4gICAgYW5pbWF0ZTogb2JqLmFuaW1hdGUsXG4gICAgcmVwZWF0OiB0cnVlXG4gIH0pO1xuXG4gIC8vIGhlYWRcbiAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgIHR5cGU6IGhpdCA8IDE1ID8gXCJhbnQtaGVhZC1sZWZ0XCIgOiBcImFudC1oZWFkLWhpdFwiLFxuICAgIHg6IHRoaXMuY29yZS5tYXAubG9vcF94KG9iai5keCksXG4gICAgeTogdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5KSxcbiAgICBhbmltYXRlOiB0cnVlLFxuICAgIHJlcGVhdDogdHJ1ZSxcbiAgICBhbmdsZTogb2JqLmRpc3BsYXlfYW5nbGVcbiAgfSk7XG59O1xuXG4vKiBEcmF3IHNwcml0ZXMgb24gdGhlIGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfc3ByaXRlc19jYW52ID0gZnVuY3Rpb24oKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zcHJpdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwcml0ZSA9IHRoaXMuc3ByaXRlc1tpXTtcblxuICAgIC8vIGdldCBwb3NpdGlvbiBvbiBzY3JlZW5cbiAgICB2YXIgc2NyZWVuX3Bvc2l0aW9uID0gdGhpcy5zY3JlZW5fcG9zaXRpb24oc3ByaXRlLngsIHNwcml0ZS55LCA0OCk7XG4gICAgaWYgKCFzY3JlZW5fcG9zaXRpb24ub25fc2NyZWVuKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgc3ByaXRlIGtleVxuICAgIHZhciBzcHJpdGVfa2V5ID0gc3ByaXRlLnR5cGU7XG4gICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYy5hbmltYXRpb25zW3Nwcml0ZV9rZXldO1xuICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgIHNwcml0ZV9rZXkgPSBhbmltYXRpb25bMF07XG4gICAgICBpZiAoc3ByaXRlLmFuaW1hdGUpIHtcbiAgICAgICAgdmFyIGZyYW1lID0gc3ByaXRlLmZyYW1lIHx8IDA7XG4gICAgICAgIGZyYW1lID0gZmxvb3IoKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAtIGZyYW1lKSAvIDIpO1xuICAgICAgICBpZiAoc3ByaXRlLnJlcGVhdCkge1xuICAgICAgICAgIGZyYW1lID0gZnJhbWUgJSBhbmltYXRpb24ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHNwcml0ZV9rZXkgPSBhbmltYXRpb25bZnJhbWVdO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGdldCBzcHJpdGUgcmVmZXJlbmNlIHBvc2l0aW9uc1xuICAgIHZhciBzcHJpdGVfcmVmID0gdGhpcy5jLnNwcml0ZXNbc3ByaXRlX2tleV07XG4gICAgaWYgKCFzcHJpdGVfcmVmKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnZXQgbmV3IHBvc2l0aW9uIHRvIGRyYXcgb25cbiAgICB2YXIgc2l6ZSA9IHNwcml0ZV9yZWYuc2l6ZTtcbiAgICB2YXIgcG9zID0gLShzaXplIC8gMik7XG5cbiAgICAvLyBmbG9hdCBlZmZlY3RcbiAgICB2YXIgeV9hZGQgPSAwO1xuICAgIGlmIChzcHJpdGUuZmxvYXQpIHtcbiAgICAgIHlfYWRkID0gY29zKCh0aGlzLmNvcmUuc3RhdGUuZnJhbWUgLSBzcHJpdGUuZnJhbWUpIC8gNCkgKiAyO1xuICAgIH1cblxuICAgIC8vIGRyYXcgaXRcbiAgICB0aGlzLmNhbnZhcy5jb250LnNhdmUoKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZShzY3JlZW5fcG9zaXRpb24ueCwgc2NyZWVuX3Bvc2l0aW9uLnkgKyB5X2FkZCk7XG4gICAgaWYgKHNwcml0ZS5hbmdsZSAhPT0gMCkge1xuICAgICAgdGhpcy5jYW52YXMuY29udC5yb3RhdGUoKHNwcml0ZS5hbmdsZSAqIE1hdGguUEkpIC8gMTgwKTtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoXG4gICAgICB0aGlzLmltZy5zcHJpdGVzLFxuICAgICAgc3ByaXRlX3JlZi54LFxuICAgICAgc3ByaXRlX3JlZi55LFxuICAgICAgc2l6ZSxcbiAgICAgIHNpemUsXG4gICAgICBwb3MsXG4gICAgICBwb3MsXG4gICAgICBzaXplLFxuICAgICAgc2l6ZVxuICAgICk7XG4gICAgdGhpcy5jYW52YXMuY29udC50cmFuc2xhdGUoXG4gICAgICAtc2NyZWVuX3Bvc2l0aW9uLngsXG4gICAgICAtKHNjcmVlbl9wb3NpdGlvbi55ICsgeV9hZGQpXG4gICAgKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnJlc3RvcmUoKTtcbiAgfVxufTtcbiJdfQ==

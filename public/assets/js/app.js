var config = config || {};
config.animations = {
  "ant-body-hit": [
    "ant-body-hit-1",
    "ant-body-hit-2",
    "ant-body-hit-1",
    "ant-body-hit-3"
  ],
  "ant-body-still-left": ["ant-body-walk-left-1"],
  "ant-body-still-right": ["ant-body-walk-right-1"],
  "ant-body-walk-left": [
    "ant-body-walk-left-2",
    "ant-body-walk-left-3",
    "ant-body-walk-left-4",
    "ant-body-walk-left-5"
  ],
  "ant-body-walk-right": [
    "ant-body-walk-right-2",
    "ant-body-walk-right-3",
    "ant-body-walk-right-4",
    "ant-body-walk-right-5"
  ],
  "ant-head-left": [
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-1",
    "ant-head-left-2",
    "ant-head-left-3",
    "ant-head-left-2"
  ],
  "ant-head-right": [
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-1",
    "ant-head-right-2",
    "ant-head-right-3",
    "ant-head-right-2"
  ],
  "ant-head-hit": ["ant-head-hit-1", "ant-head-hit-2", "ant-head-hit-3"],
  "ant-weapon-bazooka-left": ["ant-weapon-bazooka-left"],
  "ant-weapon-bazooka-right": ["ant-weapon-bazooka-right"],
  "ant-weapon-laser-left": ["ant-weapon-laser-left"],
  "ant-weapon-laser-right": ["ant-weapon-laser-right"],
  "ant-weapon-throw-left": ["ant-weapon-throw-left-1"],
  "ant-weapon-throw-fire-left": [
    "ant-weapon-throw-left-2",
    "ant-weapon-throw-left-3",
    "ant-weapon-throw-left-4",
    "ant-weapon-throw-left-5",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1",
    "ant-weapon-throw-left-1"
  ],
  "ant-weapon-throw-right": ["ant-weapon-throw-right-1"],
  "ant-weapon-throw-fire-right": [
    "ant-weapon-throw-right-2",
    "ant-weapon-throw-right-3",
    "ant-weapon-throw-right-4",
    "ant-weapon-throw-right-5",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1",
    "ant-weapon-throw-right-1"
  ],
  "ant-weapon-dig-left": ["ant-weapon-dig-left-1"],
  "ant-weapon-dig-fire-left": [
    "ant-weapon-dig-left-2",
    "ant-weapon-dig-left-3",
    "ant-weapon-dig-left-4"
  ],
  "ant-weapon-dig-right": ["ant-weapon-dig-right-1"],
  "ant-weapon-dig-fire-right": [
    "ant-weapon-dig-right-2",
    "ant-weapon-dig-right-3",
    "ant-weapon-dig-right-4"
  ],
  "ant-ghost": [
    "ant-ghost-1",
    "ant-ghost-1",
    "ant-ghost-2",
    "ant-ghost-2",
    "ant-ghost-3",
    "ant-ghost-3",
    "ant-ghost-2",
    "ant-ghost-2"
  ],
  "bubble-blue": [
    "ball-blue-1",
    "ball-blue-2",
    "ball-blue-3",
    "ball-blue-4",
    "ball-blue-5"
  ],
  "explosion-l": [
    "explosion-l-1",
    "explosion-l-2",
    "explosion-l-3",
    "explosion-l-4",
    "explosion-l-5",
    "explosion-l-6",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion2-l": [
    "explosion2-l-1",
    "explosion2-l-2",
    "explosion2-l-3",
    "explosion2-l-4",
    "explosion2-l-5",
    "explosion2-l-6",
    "explosion2-l-7",
    "explosion2-l-8"
  ],
  "explosion-green-l": [
    "explosion-green-l-1",
    "explosion-green-l-2",
    "explosion-green-l-3",
    "explosion-green-l-4",
    "explosion-green-l-5",
    "explosion-green-l-6",
    "explosion-green-l-7",
    "explosion-green-l-8"
  ],
  "explosion-laser-blue": [
    "explosion-laser-blue-1",
    "explosion-laser-blue-2",
    "explosion-laser-blue-3",
    "explosion-laser-blue-4",
    "explosion-laser-blue-5"
  ],
  flame: ["flame-1", "flame-2", "flame-3", "flame-4", "flame-5"],
  "flame-large": [
    "flame-large-1",
    "flame-large-2",
    "flame-large-3",
    "flame-large-4",
    "flame-large-5",
    "flame-large-6"
  ],
  focus: [
    "focus-1",
    "focus-2",
    "focus-3",
    "focus-4",
    "focus-5",
    "focus-6",
    "focus-7",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8",
    "focus-8"
  ],
  "gem-green": [
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-1",
    "gem-green-2",
    "gem-green-3",
    "gem-green-4"
  ],
  "gem-blue": [
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-1",
    "gem-blue-2",
    "gem-blue-3",
    "gem-blue-4"
  ],
  "gem-red": [
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-1",
    "gem-red-2",
    "gem-red-3",
    "gem-red-4"
  ],
  "gem-purple": [
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-1",
    "gem-purple-2",
    "gem-purple-3",
    "gem-purple-4"
  ],
  "gem-silver": [
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-1",
    "gem-silver-2",
    "gem-silver-3",
    "gem-silver-4"
  ],
  "grenade-armed": [
    "grenade-green",
    "grenade-red",
    "grenade-red",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green",
    "grenade-green"
  ],
  "mine-active": [
    "mine-red",
    "mine-red",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey",
    "mine-grey"
  ],
  "smoke-green": [
    "smoke-green-1",
    "smoke-green-2",
    "smoke-green-3",
    "smoke-green-4",
    "smoke-green-5",
    "smoke-green-6",
    "smoke-green-7",
    "smoke-green-8"
  ],
  teleport: [
    "teleport-1",
    "teleport-2",
    "teleport-3",
    "teleport-4",
    "teleport-5",
    "teleport-6",
    "teleport-7"
  ],
  vortex: [
    "vortex-1",
    "vortex-2",
    "vortex-3",
    "vortex-4",
    "vortex-5",
    "vortex-6",
    "vortex-7",
    "vortex-8",
    "vortex-10",
    "vortex-11"
  ]
};

var config = config || {};
config.mapgen = {
  land_type: [
    {
      edge: 1,
      bg: "dirt",
      fg: "rock",
      decorations: {
        "1": [
          {
            x: 432,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 468,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 504,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 540,
            y: 0,
            w: 36,
            h: 72
          },
          {
            x: 576,
            y: 0,
            w: 36,
            h: 72
          }
        ],
        "2": [
          {
            x: 0,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 72,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 144,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 216,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 288,
            y: 0,
            w: 72,
            h: 72
          },
          {
            x: 360,
            y: 0,
            w: 72,
            h: 72
          }
        ]
      }
    }
  ]
};

var config = config || {};
config.names = [
  "Dave Lister",
  "Ace Rimmer",
  "Queeg 500",
  "Abradolf Lincler",
  "Beardless Riker",
  "The Ant With No Name",
  "Al Capone",
  "The Queen",
  "Mickey Eyes"
];

var config = config || {};
config.objects = {
  default: {
    size: 1,
    weight: 0,
    bounce: 0.4,
    timeout: 0,
    damage: 30,
    knock: 1,
    spawn: false,
    player_lock: false,
    launch_distance: 2,
    destroy_ground: true,
    stop: 0,
    ignore_level_damage: false,
    events: {
      frame: "",
      ground: "",
      object: "",
      explosion: "",
      die: ""
    },
    object_events: {},
    speed: {
      max_gravity: 30,
      max: 40,
      move: 4,
      jump: 10
    },
    cluster: {
      circle: true,
      object: "grenade",
      speed: 2,
      count: 6
    },
    animation: {
      explosion: "explosion-l",
      sprite: "",
      air_spin: false,
      air_float: false,
      static_angle: false,
      ground: false
    },
    audio: {
      explosion: "explosion",
      bounce: "donk",
      hit: "",
      air: "",
      walk: "walk"
    },
    labels: {
      player_health: false,
      player_name: false,
      timeout: false
    },
    trails: {
      count: 0,
      speed: 0.6,
      offset_x: 0,
      offset_y: 0,
      timeout: 0,
      rotate: false,
      move: true,
      sprite: ""
    }
  },
  player: {
    size: 12,
    weight: 0.7,
    bounce: 0.7,
    events: {
      ground: "player_bounce",
      explosion: "hit_receive"
    },
    object_events: {
      crate: "collect",
      medpack: "collect",
      "gem-1": "collect",
      "gem-5": "collect",
      "gem-20": "collect",
      "gem-50": "collect",
      "gem-200": "collect",
      vortex: "collect"
    },
    animation: {
      sprite: "ant-body",
      air_spin: false,
      ground: false
    },
    audio: {
      bounce: "doink",
      explosion: "pop"
    },
    labels: {
      player_health: true,
      player_name: true
    }
  },
  player_missile: {
    size: 12,
    weight: 0.7,
    damage: 50,
    events: {
      ground: ["bounce_explode", "spawn_ghost"],
      explosion: ["bounce_explode", "spawn_ghost"]
    },
    object_events: {
      player: ["bounce_explode", "spawn_ghost"]
    },
    animation: {
      sprite: "ant-bomb",
      air_spin: true
    },
    labels: {
      player_name: true
    },
    trails: {
      count: 2,
      speed: 0.6,
      timeout: 10,
      sprite: "ball-red"
    }
  },
  player_ghost: {
    size: 12,
    weight: 0,
    damage: 1,
    knock: 0,
    events: {
      object: "hit_receive",
      explosion: "hit_receive"
    },
    object_events: {
      player: "hit_give"
    },
    speed: {
      max: 2.5,
      move: 0.3
    },
    animation: {
      sprite: "ant-ghost",
      air_float: true
    },
    labels: {
      player_name: true
    }
  },
  crate: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-weapon",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-blue"
    }
  },
  medpack: {
    size: 16,
    spawn: true,
    animation: {
      sprite: "crate-health",
      air_float: true
    },
    trails: {
      count: 2,
      speed: 1,
      timeout: 30,
      rotate: false,
      move: true,
      sprite: "ball-red"
    }
  },
  "gem-1": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-green",
      static_angle: true,
      air_float: true
    }
  },
  "gem-5": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-blue",
      static_angle: true,
      air_float: true
    }
  },
  "gem-20": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-red",
      static_angle: true,
      air_float: true
    }
  },
  "gem-50": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-purple",
      static_angle: true,
      air_float: true
    }
  },
  "gem-200": {
    size: 18,
    spawn: true,
    stop: 10,
    animation: {
      sprite: "gem-silver",
      static_angle: true,
      air_float: true
    }
  },
  vortex: {
    size: 22,
    animation: {
      sprite: "vortex"
    }
  },
  target: {
    size: 22,
    damage: 0,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion-laser-blue",
      sprite: "target",
      air_float: true
    },
    audio: {
      explosion: "pop",
      air: "none"
    }
  },
  nuclear: {
    size: 22,
    damage: 100,
    spawn: true,
    events: {
      object: "die",
      explosion: "die",
      die: "explode"
    },
    animation: {
      explosion: "explosion-green-l",
      sprite: "nuclear",
      air_float: true
    },
    audio: {
      explosion: "explosion_gas",
      air: "none"
    }
  },
  mine: {
    size: 58,
    damage: 80,
    events: {
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "mine",
      air_float: true
    }
  },
  "asteroid-small": {
    size: 15,
    weight: 1,
    damage: 40,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-small",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 10,
      sprite: "flame"
    }
  },
  "asteroid-large": {
    size: 34,
    weight: 1,
    damage: 80,
    events: {
      object: "die",
      ground: "die",
      explosion: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    cluster: {
      circle: true,
      object: "asteroid-small",
      speed: 16,
      count: 3
    },
    animation: {
      explosion: "explosion2-l",
      sprite: "asteroid-large",
      air_spin: true
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      speed: 0.6,
      offset_x: -5,
      timeout: 20,
      sprite: "flame"
    }
  },
  dig: {
    size: 2,
    weight: 0,
    damage: 16,
    timeout: 6,
    ignore_level_damage: true,
    events: {
      ground: ["destroy", "drag_player", "die"]
    }
  },
  punch: {
    size: 20,
    weight: 0,
    damage: 16,
    timeout: 26,
    player_lock: true,
    stop: 24,
    events: {
      ground: "slide"
    },
    object_events: {
      player: "hit_give"
    },
    animation: {
      sprite: "flame-large"
    },
    audio: {
      air: "fly",
      bounce: "doink",
      hit: "punch"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  laser: {
    size: 24,
    weight: 0,
    timeout: 20,
    damage: 30,
    destroy_ground: false,
    events: {
      ground: "die",
      object: "none",
      die: "none"
    },
    object_events: {
      player: ["explode", "die"],
      player_ghost: ["hit_give", "die"]
    },
    animation: {
      sprite: "laser-blue",
      explosion: "explosion-laser-blue"
    },
    audio: {
      explosion: "explosion_laser"
    },
    trails: {
      count: 1,
      speed: 0,
      timeout: 10,
      rotate: false,
      move: false,
      sprite: "bubble-blue"
    }
  },
  bazooka: {
    size: 6,
    weight: 0.7,
    timeout: 300,
    damage: 70,
    events: {
      ground: "die",
      object: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "bazooka-shell"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      speed: 1.5,
      offset_x: -10,
      offset_y: 0,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  },
  grenade: {
    size: 4,
    weight: 0.7,
    timeout: 72,
    damage: 50,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "explode"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "grenade-armed"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "countdown"
    },
    trails: {
      count: 1,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-green"
    }
  },
  pumpkin: {
    size: 10,
    weight: 1,
    timeout: 120,
    damage: 70,
    events: {
      ground: "bounce",
      object: "bounce",
      explosion: "bounce",
      die: "cluster"
    },
    object_events: {
      player: "bounce"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin"
    },
    labels: {
      timeout: true
    },
    audio: {
      air: "spooky"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      rotate: true,
      sprite: "bat"
    },
    cluster: {
      circle: false,
      object: "pumpkin_slice",
      speed: 15,
      count: 3
    }
  },
  pumpkin_slice: {
    size: 6,
    weight: 1,
    timeout: 200,
    damage: 30,
    events: {
      ground: "die",
      explosion: "die",
      die: "explode"
    },
    object_events: {
      player: "die"
    },
    animation: {
      air_spin: true,
      sprite: "pumpkin-slice"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 2,
      timeout: 20,
      rotate: false,
      move: true,
      sprite: "ball-orange"
    }
  },
  paingiver: {
    size: 20,
    weight: 1,
    damage: 50,
    cluster: {
      circle: false,
      object: "grenade",
      speed: 15,
      count: 3
    },
    events: {
      ground: "die",
      die: "cluster"
    },
    object_events: {
      player: "die"
    },
    animation: {
      sprite: "rocket"
    },
    audio: {
      air: "fly"
    },
    trails: {
      count: 1,
      timeout: 10,
      rotate: false,
      move: true,
      sprite: "flame"
    }
  }
};

// prep objects
config.object_refs = [];
for (key in config.objects) {
  config.object_refs.push(key);
  config.objects[key] = deepmerge(config.objects.default, config.objects[key], {
    arrayMerge: dont_merge
  });
}

var config = config || {};
config.sprites = {
  "ball-blue": {
    size: 48,
    x: 192,
    y: 1056
  },
  "ball-green": {
    size: 48,
    x: 240,
    y: 1056
  },
  "ball-orange": {
    size: 48,
    x: 288,
    y: 1056
  },
  "ball-red": {
    size: 48,
    x: 336,
    y: 1056
  },
  "ball-silver": {
    size: 48,
    x: 384,
    y: 1056
  },
  bat: {
    size: 48,
    x: 432,
    y: 1056
  },
  "flame-1": {
    size: 48,
    x: 480,
    y: 1056
  },
  "flame-2": {
    size: 48,
    x: 528,
    y: 1056
  },
  "flame-3": {
    size: 48,
    x: 576,
    y: 1056
  },
  "flame-4": {
    size: 48,
    x: 624,
    y: 1056
  },
  "flame-5": {
    size: 48,
    x: 672,
    y: 1056
  },
  "mine-grey": {
    size: 48,
    x: 720,
    y: 1056
  },
  "mine-red": {
    size: 48,
    x: 768,
    y: 1056
  },
  "pumpkin-slice": {
    size: 48,
    x: 816,
    y: 1056
  },
  pumpkin: {
    size: 48,
    x: 864,
    y: 1056
  },
  "star-blue": {
    size: 48,
    x: 912,
    y: 1056
  },
  "ant-body-air-left": {
    size: 48,
    x: 960,
    y: 1056
  },
  "ant-body-air-right": {
    size: 48,
    x: 1008,
    y: 1056
  },
  "ant-body-hit-1": {
    size: 48,
    x: 1056,
    y: 1056
  },
  "ant-body-hit-2": {
    size: 48,
    x: 1120,
    y: 0
  },
  "ant-body-hit-3": {
    size: 48,
    x: 1120,
    y: 48
  },
  "ant-body-superman-left": {
    size: 48,
    x: 1120,
    y: 96
  },
  "ant-body-superman-right": {
    size: 48,
    x: 1120,
    y: 144
  },
  "ant-body-walk-left-1": {
    size: 48,
    x: 1120,
    y: 192
  },
  "ant-body-walk-left-2": {
    size: 48,
    x: 1120,
    y: 240
  },
  "ant-body-walk-left-3": {
    size: 48,
    x: 1120,
    y: 288
  },
  "ant-body-walk-left-4": {
    size: 48,
    x: 1120,
    y: 336
  },
  "ant-body-walk-left-5": {
    size: 48,
    x: 1120,
    y: 384
  },
  "ant-body-walk-right-1": {
    size: 48,
    x: 1120,
    y: 432
  },
  "ant-body-walk-right-2": {
    size: 48,
    x: 1120,
    y: 480
  },
  "ant-body-walk-right-3": {
    size: 48,
    x: 1120,
    y: 528
  },
  "ant-body-walk-right-4": {
    size: 48,
    x: 1120,
    y: 576
  },
  "ant-body-walk-right-5": {
    size: 48,
    x: 1120,
    y: 624
  },
  "ant-bomb": {
    size: 48,
    x: 1120,
    y: 672
  },
  "ant-ghost-1": {
    size: 64,
    x: 576,
    y: 960
  },
  "ant-ghost-2": {
    size: 64,
    x: 640,
    y: 960
  },
  "ant-ghost-3": {
    size: 64,
    x: 704,
    y: 960
  },
  "ant-head-hit-1": {
    size: 64,
    x: 768,
    y: 960
  },
  "ant-head-hit-2": {
    size: 64,
    x: 832,
    y: 960
  },
  "ant-head-hit-3": {
    size: 64,
    x: 896,
    y: 960
  },
  "ant-head-left-1": {
    size: 64,
    x: 960,
    y: 960
  },
  "ant-head-left-2": {
    size: 64,
    x: 1056,
    y: 0
  },
  "ant-head-left-3": {
    size: 64,
    x: 1056,
    y: 64
  },
  "ant-head-right-1": {
    size: 64,
    x: 1056,
    y: 128
  },
  "ant-head-right-2": {
    size: 64,
    x: 1056,
    y: 192
  },
  "ant-head-right-3": {
    size: 64,
    x: 1056,
    y: 256
  },
  "ant-weapon-bazooka-left": {
    size: 64,
    x: 1056,
    y: 320
  },
  "ant-weapon-bazooka-right": {
    size: 64,
    x: 1056,
    y: 384
  },
  "ant-weapon-dig-left-1": {
    size: 64,
    x: 1056,
    y: 448
  },
  "ant-weapon-dig-left-2": {
    size: 64,
    x: 1056,
    y: 512
  },
  "ant-weapon-dig-left-3": {
    size: 64,
    x: 1056,
    y: 576
  },
  "ant-weapon-dig-left-4": {
    size: 64,
    x: 1056,
    y: 640
  },
  "ant-weapon-dig-right-1": {
    size: 64,
    x: 1056,
    y: 704
  },
  "ant-weapon-dig-right-2": {
    size: 64,
    x: 1056,
    y: 768
  },
  "ant-weapon-dig-right-3": {
    size: 64,
    x: 1056,
    y: 832
  },
  "ant-weapon-dig-right-4": {
    size: 64,
    x: 1056,
    y: 896
  },
  "ant-weapon-laser-left": {
    size: 64,
    x: 1056,
    y: 960
  },
  "ant-weapon-laser-right": {
    size: 64,
    x: 0,
    y: 1056
  },
  "ant-weapon-punch-left": {
    size: 64,
    x: 64,
    y: 1056
  },
  "ant-weapon-punch-right": {
    size: 64,
    x: 128,
    y: 1056
  },
  "ant-weapon-throw-left-1": {
    size: 48,
    x: 1120,
    y: 720
  },
  "ant-weapon-throw-left-2": {
    size: 48,
    x: 1120,
    y: 768
  },
  "ant-weapon-throw-left-3": {
    size: 48,
    x: 1120,
    y: 816
  },
  "ant-weapon-throw-left-4": {
    size: 48,
    x: 1120,
    y: 864
  },
  "ant-weapon-throw-left-5": {
    size: 48,
    x: 1120,
    y: 912
  },
  "ant-weapon-throw-right-1": {
    size: 48,
    x: 1120,
    y: 960
  },
  "ant-weapon-throw-right-2": {
    size: 48,
    x: 1120,
    y: 1008
  },
  "ant-weapon-throw-right-3": {
    size: 48,
    x: 1120,
    y: 1056
  },
  "ant-weapon-throw-right-4": {
    size: 48,
    x: 0,
    y: 1120
  },
  "ant-weapon-throw-right-5": {
    size: 48,
    x: 48,
    y: 1120
  },
  "armoury-dig": {
    size: 48,
    x: 96,
    y: 1120
  },
  "armoury-extinguishe": {
    size: 48,
    x: 144,
    y: 1120
  },
  "armoury-laser-blue": {
    size: 48,
    x: 192,
    y: 1120
  },
  "armoury-laser-red": {
    size: 48,
    x: 240,
    y: 1120
  },
  "armoury-punch": {
    size: 48,
    x: 288,
    y: 1120
  },
  "arrow-blue": {
    size: 48,
    x: 336,
    y: 1120
  },
  "arrow-green": {
    size: 48,
    x: 384,
    y: 1120
  },
  "arrow-grey": {
    size: 48,
    x: 432,
    y: 1120
  },
  "arrow-purple": {
    size: 48,
    x: 480,
    y: 1120
  },
  "arrow-red": {
    size: 48,
    x: 528,
    y: 1120
  },
  "asteroid-1": {
    size: 96,
    x: 0,
    y: 768
  },
  "asteroid-2": {
    size: 96,
    x: 96,
    y: 768
  },
  "ball-blue-1": {
    size: 24,
    x: 1056,
    y: 1024
  },
  "ball-blue-2": {
    size: 24,
    x: 1080,
    y: 1024
  },
  "ball-blue-3": {
    size: 24,
    x: 1024,
    y: 960
  },
  "ball-blue-4": {
    size: 24,
    x: 1024,
    y: 984
  },
  "ball-blue-5": {
    size: 24,
    x: 576,
    y: 1024
  },
  "bazooka-shell": {
    size: 48,
    x: 576,
    y: 1120
  },
  "crate-health": {
    size: 48,
    x: 624,
    y: 1120
  },
  "crate-weapon": {
    size: 48,
    x: 672,
    y: 1120
  },
  crosshair: {
    size: 48,
    x: 720,
    y: 1120
  },
  "explosion-green-l-1": {
    size: 192,
    x: 0,
    y: 0
  },
  "explosion-green-l-2": {
    size: 192,
    x: 192,
    y: 0
  },
  "explosion-green-l-3": {
    size: 192,
    x: 0,
    y: 192
  },
  "explosion-green-l-4": {
    size: 192,
    x: 192,
    y: 192
  },
  "explosion-green-l-5": {
    size: 192,
    x: 384,
    y: 0
  },
  "explosion-green-l-6": {
    size: 192,
    x: 384,
    y: 192
  },
  "explosion-green-l-7": {
    size: 192,
    x: 0,
    y: 384
  },
  "explosion-green-l-8": {
    size: 192,
    x: 192,
    y: 384
  },
  "explosion-l-1": {
    size: 192,
    x: 384,
    y: 384
  },
  "explosion-l-2": {
    size: 192,
    x: 576,
    y: 0
  },
  "explosion-l-3": {
    size: 192,
    x: 576,
    y: 192
  },
  "explosion-l-4": {
    size: 192,
    x: 576,
    y: 384
  },
  "explosion-l-5": {
    size: 192,
    x: 0,
    y: 576
  },
  "explosion-l-6": {
    size: 192,
    x: 192,
    y: 576
  },
  "explosion-l-7": {
    size: 192,
    x: 384,
    y: 576
  },
  "explosion-laser-blue-1": {
    size: 96,
    x: 192,
    y: 768
  },
  "explosion-laser-blue-2": {
    size: 96,
    x: 288,
    y: 768
  },
  "explosion-laser-blue-3": {
    size: 96,
    x: 384,
    y: 768
  },
  "explosion-laser-blue-4": {
    size: 96,
    x: 480,
    y: 768
  },
  "explosion-laser-blue-5": {
    size: 96,
    x: 576,
    y: 768
  },
  "explosion2-l-1": {
    size: 96,
    x: 672,
    y: 768
  },
  "explosion2-l-2": {
    size: 96,
    x: 768,
    y: 768
  },
  "explosion2-l-3": {
    size: 96,
    x: 864,
    y: 768
  },
  "explosion2-l-4": {
    size: 192,
    x: 576,
    y: 576
  },
  "explosion2-l-5": {
    size: 192,
    x: 768,
    y: 0
  },
  "explosion2-l-6": {
    size: 192,
    x: 768,
    y: 192
  },
  "explosion2-l-7": {
    size: 192,
    x: 768,
    y: 384
  },
  "explosion2-l-8": {
    size: 192,
    x: 768,
    y: 576
  },
  extinguisher: {
    size: 48,
    x: 768,
    y: 1120
  },
  "flame-large-1": {
    size: 96,
    x: 0,
    y: 864
  },
  "flame-large-2": {
    size: 96,
    x: 96,
    y: 864
  },
  "flame-large-3": {
    size: 96,
    x: 192,
    y: 864
  },
  "flame-large-4": {
    size: 96,
    x: 288,
    y: 864
  },
  "flame-large-5": {
    size: 96,
    x: 384,
    y: 864
  },
  "flame-large-6": {
    size: 96,
    x: 480,
    y: 864
  },
  "focus-1": {
    size: 96,
    x: 576,
    y: 864
  },
  "focus-2": {
    size: 96,
    x: 672,
    y: 864
  },
  "focus-3": {
    size: 96,
    x: 768,
    y: 864
  },
  "focus-4": {
    size: 96,
    x: 864,
    y: 864
  },
  "focus-5": {
    size: 96,
    x: 960,
    y: 0
  },
  "focus-6": {
    size: 96,
    x: 960,
    y: 96
  },
  "focus-7": {
    size: 96,
    x: 960,
    y: 192
  },
  "focus-8": {
    size: 96,
    x: 960,
    y: 288
  },
  "gem-blue-1": {
    size: 48,
    x: 816,
    y: 1120
  },
  "gem-blue-2": {
    size: 48,
    x: 864,
    y: 1120
  },
  "gem-blue-3": {
    size: 48,
    x: 912,
    y: 1120
  },
  "gem-blue-4": {
    size: 48,
    x: 960,
    y: 1120
  },
  "gem-green-1": {
    size: 48,
    x: 1008,
    y: 1120
  },
  "gem-green-2": {
    size: 48,
    x: 1056,
    y: 1120
  },
  "gem-green-3": {
    size: 48,
    x: 1104,
    y: 1120
  },
  "gem-green-4": {
    size: 48,
    x: 1168,
    y: 0
  },
  "gem-purple-1": {
    size: 48,
    x: 1168,
    y: 48
  },
  "gem-purple-2": {
    size: 48,
    x: 1168,
    y: 96
  },
  "gem-purple-3": {
    size: 48,
    x: 1168,
    y: 144
  },
  "gem-purple-4": {
    size: 48,
    x: 1168,
    y: 192
  },
  "gem-red-1": {
    size: 48,
    x: 1168,
    y: 240
  },
  "gem-red-2": {
    size: 48,
    x: 1168,
    y: 288
  },
  "gem-red-3": {
    size: 48,
    x: 1168,
    y: 336
  },
  "gem-red-4": {
    size: 48,
    x: 1168,
    y: 384
  },
  "gem-silver-1": {
    size: 48,
    x: 1168,
    y: 432
  },
  "gem-silver-2": {
    size: 48,
    x: 1168,
    y: 480
  },
  "gem-silver-3": {
    size: 48,
    x: 1168,
    y: 528
  },
  "gem-silver-4": {
    size: 48,
    x: 1168,
    y: 576
  },
  "grenade-green": {
    size: 48,
    x: 1168,
    y: 624
  },
  "grenade-red": {
    size: 48,
    x: 1168,
    y: 672
  },
  "laser-blue": {
    size: 48,
    x: 1168,
    y: 720
  },
  "laser-red": {
    size: 48,
    x: 1168,
    y: 768
  },
  nuclear: {
    size: 96,
    x: 960,
    y: 384
  },
  rocket: {
    size: 48,
    x: 1168,
    y: 816
  },
  smoke: {
    size: 24,
    x: 600,
    y: 1024
  },
  target: {
    size: 48,
    x: 48,
    y: 1168
  },
  "teleport-1": {
    size: 48,
    x: 1168,
    y: 864
  },
  "teleport-2": {
    size: 48,
    x: 1168,
    y: 912
  },
  "teleport-3": {
    size: 48,
    x: 1168,
    y: 960
  },
  "teleport-4": {
    size: 48,
    x: 1168,
    y: 1008
  },
  "teleport-5": {
    size: 48,
    x: 1168,
    y: 1056
  },
  "teleport-6": {
    size: 48,
    x: 1168,
    y: 1104
  },
  "teleport-7": {
    size: 48,
    x: 0,
    y: 1168
  },
  "vortex-1": {
    size: 96,
    x: 960,
    y: 480
  },
  "vortex-10": {
    size: 96,
    x: 960,
    y: 576
  },
  "vortex-11": {
    size: 96,
    x: 960,
    y: 672
  },
  "vortex-2": {
    size: 96,
    x: 960,
    y: 768
  },
  "vortex-3": {
    size: 96,
    x: 960,
    y: 864
  },
  "vortex-4": {
    size: 96,
    x: 0,
    y: 960
  },
  "vortex-5": {
    size: 96,
    x: 96,
    y: 960
  },
  "vortex-6": {
    size: 96,
    x: 192,
    y: 960
  },
  "vortex-7": {
    size: 96,
    x: 288,
    y: 960
  },
  "vortex-8": {
    size: 96,
    x: 384,
    y: 960
  },
  "vortex-9": {
    size: 96,
    x: 480,
    y: 960
  }
};

var config = config || {};
config.weapons = {
  default: {
    title: "",
    armoury_sprite: "",
    sprite: "",
    fire_audio: "",
    fire_sprite: "",
    fire_body_sprite: "",
    fire_angle_lock: false,
    auto_follow: false,
    require_walk: false,
    speed: 0,
    object: "",
    cooldown: 0,
    recoil: 0,
    inertia: 0
  },
  dig: {
    title: "Dig",
    armoury_sprite: "armoury-dig",
    sprite: "dig",
    fire_sprite: "dig-fire",
    fire_body_sprite: "walk",
    fire_angle_lock: true,
    speed: 3,
    object: "dig",
    cooldown: 10
  },
  phaser: {
    title: "Phaser",
    armoury_sprite: "armoury-laser-blue",
    sprite: "laser",
    fire_audio: "shoot_laser",
    speed: 30,
    object: "laser",
    cooldown: 6,
    recoil: 0.1,
    inertia: 0.5
  },
  bazookoid: {
    title: "Bazookoid",
    armoury_sprite: "bazooka-shell",
    sprite: "bazooka",
    fire_audio: "shoot",
    auto_follow: true,
    speed: 24,
    object: "bazooka",
    cooldown: 40,
    recoil: 0.2,
    inertia: 0.5
  },
  grenade: {
    title: "Grenade",
    armoury_sprite: "grenade-green",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 24,
    object: "grenade",
    cooldown: 30,
    recoil: 0,
    inertia: 0.5
  },
  punch: {
    title: "Fire Punch",
    armoury_sprite: "armoury-punch",
    sprite: "punch",
    fire_audio: "throw",
    fire_body_sprite: "superman",
    speed: 24,
    object: "punch",
    cooldown: 120,
    recoil: 0,
    inertia: 0.5
  },
  pumpkin: {
    title: "Pumpkin",
    armoury_sprite: "pumpkin",
    sprite: "throw",
    fire_audio: "throw",
    fire_sprite: "throw-fire",
    auto_follow: true,
    speed: 30,
    object: "pumpkin",
    cooldown: 48,
    recoil: 0,
    inertia: 0.5
  },
  paingiver: {
    title: "Paingiver 2000",
    armoury_sprite: "rocket",
    sprite: "bazooka",
    fire_audio: "shoot",
    speed: 24,
    object: "paingiver",
    cooldown: 10,
    recoil: 0.4,
    inertia: 0.5
  }
};

// prep weapons
for (key in config.weapons) {
  config.weapons[key] = deepmerge(config.weapons.default, config.weapons[key], {
    arrayMerge: dont_merge
  });
}

/* ========================================================================
    Actions
 ========================================================================== */

/* Perform action
	---------------------------------------- */

core.prototype.action = function(player_id, action) {
  var response = { success: false };
  var player = this.state.players[player_id];
  var obj = this.state.objects["player-" + player_id];
  if (!player || !action || !obj) {
    return response;
  }

  var locked_obj = this.state.objects[player.locked];

  // players can do stuff
  if (!player.dead && !locked_obj && player.hit === 0) {
    // run them
    if (action.action === "move") {
      response = this.action_move(response, player, obj, action);
    }
    if (action.action === "jump") {
      response = this.action_jump(response, player, obj, action);
    }
    if (action.action === "shoot") {
      response = this.action_shoot(response, player, obj, action);
    }
  }

  response.x = obj.x;
  response.y = obj.y;
  response.speed_x = obj.speed_x;
  response.speed_y = obj.speed_y;
  response.frame = this.state.frame;

  // return status
  return response;
};

/* Walking
	---------------------------------------- */

core.prototype.action_move = function(response, player, obj, action) {
  response.type = "walk";

  if (obj.grounded) {
    var speed = this.scheme.levels.speed[player.level] || obj.c.speed.move;
    var speed = action.speed || speed;
    var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, action.angle, speed);
    if (walk.move) {
      if (this.action_walk_move(obj, walk.path)) {
        // record player event
        player.events.push({ frame: this.state.frame, type: "walk" });

        // return success
        response.success = true;
      }
    }
  }

  return response;
};

/* Walking in a direction
	---------------------------------------- */

core.prototype.action_walk_dir = function(obj, dir, speed) {
  var speed = speed || obj.c.speed.move;

  // get initial path
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 0, speed);

  if (walk.direction != dir) {
    walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 180, speed);
    if (walk.direction != dir) {
      walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 90, speed);
      if (walk.direction != dir) {
        walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, 270, speed);
        if (walk.direction != dir) {
          return;
        }
      }
    }
  }
  if (!walk.move) {
    return;
  }

  this.action_walk_move(obj, walk.path);
};

/* Walk moving
	---------------------------------------- */

core.prototype.action_walk_move = function(obj, path) {
  // go through the course
  var x1 = obj.x;
  var y1 = obj.y;
  for (var i = 1; i < path.length; i++) {
    var point = path[i];

    // check object collisions
    var col = this.collisions(obj, point.x, point.y);
    if (col) {
      return;
    }

    obj.x = point.x;
    obj.y = point.y;
    obj.moved = true;
  }

  if (obj.moved) {
    return true;
  }
};

/* Jumping
	---------------------------------------- */

core.prototype.action_jump = function(response, player, obj, action) {
  response.type = "jump";

  if (obj.grounded && player.cooldown === 0) {
    var speed = this.scheme.levels.jump[player.level] || obj.c.speed.jump;
    var xy = xy_speed(action.angle, speed);
    obj.speed_x = xy.x.fixed();
    obj.speed_y = xy.y.fixed();
    if (this.physics_move(obj)) {
      // set grounding
      obj.grounded = false;

      // set cooldown
      player.cooldown = 7;

      // record player event
      player.events.push({ frame: this.state.frame, type: "jump" });

      // return success
      response.success = true;
    }
  }

  return response;
};

/* Shooting weapon
	---------------------------------------- */

core.prototype.action_shoot = function(response, player, obj, action) {
  response.type = "shoot";

  // if waiting for cooldown
  // is not real weapon
  // do we need to walk
  // check armoury count
  var weapon = this.c.weapons[action.weapon];
  if (
    (player.cooldown === 0 && !weapon) ||
    (weapon.require_walk && !obj.grounded) ||
    player.armoury[action.weapon] === 0
  ) {
    return response;
  }

  // crate the object
  var speed = xy_speed(action.angle, weapon.speed);
  var shot_obj = this.create_object({
    type: weapon.object,
    player_id: player.id,
    x: obj.x,
    y: obj.y,
    speed_x: (speed.x + obj.speed_x * weapon.inertia).fixed(),
    speed_y: (speed.y + obj.speed_y * weapon.inertia).fixed()
  });

  // set player recoil
  if (!obj.grounded) {
    obj.speed_x += (-speed.x * weapon.recoil).fixed();
    obj.speed_y += (-speed.y * weapon.recoil).fixed();
  }

  // set armoury values
  this.update_player_armoury(player.id, action.weapon, -1);

  // set cooldown
  player.cooldown = weapon.cooldown;

  // set player lock
  if (shot_obj.c.player_lock) {
    player.locked = shot_obj.key;
  }

  // record player event
  player.events.push({
    frame: this.state.frame,
    type: "shoot",
    obj: shot_obj.key,
    weapon: action.weapon
  });

  // return success
  response.success = true;
  return response;
};

/* ========================================================================
    Collisions
 ========================================================================== */

/* Run single collision check
	---------------------------------------- */

core.prototype.collisions = function(obj, x, y) {
  // check collision with ground
  if (this.map.i(round(x), round(y))) {
    var event = this.event(obj, "ground", null);
    if (event) {
      return event;
    }
  }

  // check collisions with other objects
  for (var key in this.state.objects) {
    if (obj.key === key) {
      continue;
    }
    if (this.collision_obj(obj, x, y, this.state.objects[key])) {
      return true;
    }
  }

  return false;
};

/* Run object collision check
	---------------------------------------- */

core.prototype.collision_obj = function(obj, x, y, check_obj) {
  // if no collision
  if (
    this.collision_check(
      x,
      y,
      check_obj.x,
      check_obj.y,
      obj.c.size,
      check_obj.c.size
    )
  ) {
    return;
  }

  // prevent hits on parent players for a short time or if they're player locked
  if (
    check_obj.type === "player" &&
    check_obj.player_id === obj.player_id &&
    (this.state.frame < obj.frame + 15 || obj.c.player_lock)
  ) {
    return;
  }

  // prevent clusters hitting each other for a short time
  if (
    check_obj.frame === obj.frame &&
    check_obj.player_id === obj.player_id &&
    this.state.frame < obj.frame + 60
  ) {
    return;
  }

  // trigger basic object collision event
  if (this.event(obj, "object", check_obj)) {
    return true;
  }

  // trigger specific object collision event
  var event = obj.c.object_events[check_obj.type];
  if (event) {
    if (this.run_event(obj, event, check_obj)) {
      return true;
    }
  }
};

/* Collision Maths
	---------------------------------------- */

core.prototype.collision_check = function(x1, y1, x2, y2, s1, s2) {
  return this.map.get_distance(x1, y1, x2, y2) > s1 + s2;
};

/* ========================================================================
    Core
 ========================================================================== */

/* create core object
	---------------------------------------- */

function core(config, scheme, map, gravity_map) {
  // config
  this.c = config;
  this.scheme = scheme;
  this.map = new core_map(map, scheme, gravity_map);

  // crate chance table
  this.crate_list = [];
  for (var key in this.scheme.weapons) {
    for (var i = 0; i < this.scheme.weapons[key].crate_chance; i++) {
      this.crate_list.push(key);
    }
  }

  // armoury reference table
  this.armoury_refs = [];
  for (key in this.scheme.weapons) {
    this.armoury_refs.push(key);
  }
}

/* Set a blank state
	---------------------------------------- */

core.prototype.blank_state = function() {
  return {
    frame: 0,
    explosions: {},
    objects: {},
    players: {},
    events: []
  };
};

/* Run every frame
	---------------------------------------- */

core.prototype.frame = function() {
  this.frame_explosions();
  this.frame_players();
  this.frame_objects();
};

/* ========================================================================
    Events
 ========================================================================== */

/* Run a specific type of event
	---------------------------------------- */

core.prototype.event = function(obj, type, collided_obj) {
  var event = obj.c.events[type];
  if (!event) {
    return;
  }
  return this.run_event(obj, event, collided_obj, type);
};

/* Run a specific event
	---------------------------------------- */

core.prototype.run_event = function(obj, event, collided_obj, type) {
  // handle arrays of events
  if (Array.isArray(event)) {
    var stop = false;
    for (var i = 0; i < event.length; i++) {
      var stop2 = this.run_event(obj, event[i], collided_obj, type);
      stop = stop2 ? true : stop;
    }
    return stop;
  }

  // run event function
  if (event === "die") {
    return this.event_die(obj, collided_obj, type);
  } else if (event === "kill") {
    return this.event_kill(obj, collided_obj);
  } else if (event === "explode") {
    return this.event_explode(obj);
  } else if (event === "hit_give") {
    return this.event_hit_give(obj, collided_obj, type);
  } else if (event === "hit_receive") {
    return this.event_hit_receive(obj, collided_obj, type);
  } else if (event === "destroy") {
    return this.event_destroy(obj);
  } else if (event === "cluster") {
    return this.event_cluster(obj);
  } else if (event === "bounce") {
    return this.event_bounce(obj, collided_obj, type);
  } else if (event === "bounce_explode") {
    return this.event_bounce_explode(obj, collided_obj, type);
  } else if (event === "stick") {
    return this.event_stick(obj);
  } else if (event === "slide") {
    return this.event_slide(obj);
  } else if (event === "player_bounce") {
    return this.event_player_bounce(obj, collided_obj, type);
  } else if (event === "drag_player") {
    return this.event_drag_player(obj);
  } else if (event === "spawn_ghost") {
    return this.event_spawn_ghost(obj);
  } else if (event === "collect") {
    return this.event_collect(obj, collided_obj);
  }
};

/* Object die
	---------------------------------------- */

core.prototype.event_die = function(obj, collided_obj, type) {
  // die event
  this.event(obj, "die");

  // check for destroy events
  if (this.scheme.events.destroy) {
    if (this.scheme.events.destroy[obj.id]) {
      this.state.events.push(this.scheme.events.destroy[obj.id]);
    }
  }

  // delete the object
  delete this.state.objects[obj.key];

  return true;
};

/* Object kill
	---------------------------------------- */

core.prototype.event_kill = function(obj, collided_obj) {
  // destroy it
  this.run_event(collided_obj, "die");
};

/* Explode
	---------------------------------------- */

core.prototype.event_explode = function(obj) {
  // create explosion object
  this.create_explosion({
    player_id: obj.player_id,
    x: obj.x,
    y: obj.y,
    parent: obj.key,
    parent_type: obj.type
  });
};

/* Give a hit
	---------------------------------------- */

core.prototype.event_hit_give = function(obj, collided_obj, type) {
  return this.run_event(collided_obj, "hit_receive", obj, type);
};

/* Receive a hit
	---------------------------------------- */

core.prototype.event_hit_receive = function(obj, collided_obj, type) {
  // prevent instant hits
  if (obj.hits) {
    for (var key in obj.hits) {
      if (key === collided_obj.key) {
        return;
      }
    }
  }

  // calculate direction and distance it came from
  var angle = this.map.get_heading(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );
  var distance = this.map.get_distance(
    obj.x,
    obj.y,
    collided_obj.x,
    collided_obj.y
  );

  // get damage values from collided object
  var damage = this.get_damage(collided_obj);
  var knock = collided_obj.c.knock;
  if (collided_obj.type === "explosion") {
    damage *= max(0, (damage * 2 - distance) / (damage * 2));
  }

  // ignore if there's no damage
  if (damage === 0) {
    return;
  }

  // knock object
  if (knock > 0) {
    var xy = xy_speed(angle, damage);
    obj.speed_x -= xy.x.fixed();
    obj.speed_y -= xy.y.fixed();
    obj.grounded = false;
  }

  // are we hitting player
  if (obj.type === "player") {
    this.player_health_add(obj.player_id, -round(damage));
    var player = this.state.players[obj.player_id];
    if (player) {
      player.hit = damage * 2;
    }
  }

  // sound effect
  if (collided_obj.c.audio.hit) {
    this.state.events.push({
      type: "sound",
      x: obj.x,
      y: obj.y,
      sound: collided_obj.c.audio.hit
    });
  }

  // set hits
  if (!obj.hits) {
    obj.hits = {};
  }
  obj.hits[collided_obj.key] = true;
};

/* Destroy ground
	---------------------------------------- */

core.prototype.event_destroy = function(obj) {
  // limit to once per frame
  if (obj.destroyed) {
    return;
  }
  obj.destroyed = true;

  var damage = this.get_damage(obj);

  // record ground damage
  this.state.events.push({
    type: "ground_damage",
    frame: this.state.frame,
    dig: true,
    x: obj.x,
    y: obj.y,
    radius: damage
  });
};

/* Object bounce
	---------------------------------------- */

core.prototype.event_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  // check speed
  var speed = get_speed(obj.speed_x, obj.speed_y);
  var check_speed = speed * obj.c.bounce;
  if (check_speed < 1) {
    obj.speed_x = 0;
    obj.speed_y = 0;
    return true;
  }

  // get new direction angle
  var direction = get_angle(obj.speed_x, obj.speed_y);
  var surface_angle = 0;

  // get angle from ground
  if (type === "ground") {
    var walk = this.map.walk(round(obj.x), round(obj.y), 0, 0, direction, 6);
    if (walk.move) {
      surface_angle = walk.angle;
    }
  }

  // get angle from object
  else {
    var heading = this.map.get_heading(
      obj.x,
      obj.y,
      collided_obj.x,
      collided_obj.y
    );
    surface_angle = angle_add(heading, 90);
  }

  // reflect direction angle with collision angle
  var reflection = (direction - surface_angle) * 2;
  var new_angle = angle_add(direction, -reflection);

  // transform main velocity towards new angle
  var new_speed = xy_speed(new_angle, check_speed);
  obj.speed_x = new_speed.x.fixed();
  obj.speed_y = new_speed.y.fixed();

  // record bounce event
  if (speed > 2) {
    this.state.events.push({
      type: "bounce",
      x: obj.x,
      y: obj.y,
      obj: obj.key
    });
  }

  return true;
};

/* Object stick to ground
	---------------------------------------- */

core.prototype.event_stick = function(obj) {
  obj.grounded = true;
  obj.speed_x = 0;
  obj.speed_y = 0;
  return true;
};

/* Object slide
	---------------------------------------- */

core.prototype.event_slide = function(obj) {
  var angle = get_angle(obj.speed_x, obj.speed_y);
  var walk = this.map.walk(obj.x, obj.y, obj.x, obj.y, angle, obj.speed_left);
  if (walk.move) {
    this.action_walk_move(obj, walk.path);
  }
  return true;
};

/* Player bounce
	---------------------------------------- */

core.prototype.event_player_bounce = function(obj, collided_obj, type) {
  // if grounded dont do anything
  if (obj.grounded) {
    return true;
  }

  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }
  var speed = get_speed(obj.speed_x, obj.speed_y);

  var max_speed = this.scheme.levels.jump[player.level] || 0;
  max_speed += 10;
  if (player.hit > 0 || speed > max_speed) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "stick");
  }
};

/* Drag player
	---------------------------------------- */

core.prototype.event_drag_player = function(obj) {
  var player_obj = this.state.objects["player-" + obj.player_id];
  if (!player_obj) {
    return;
  }

  player_obj.speed_x = obj.speed_x;
  player_obj.speed_y = obj.speed_y;
  player_obj.dragged = true;
};

/* First Destroy
	---------------------------------------- */

core.prototype.event_bounce_explode = function(obj, collided_obj, type) {
  if (obj.frame + 10 > this.state.frame) {
    return this.run_event(obj, "bounce", collided_obj, type);
  } else {
    return this.run_event(obj, "explode");
  }
};

/* Spawn player ghost
	---------------------------------------- */

core.prototype.event_spawn_ghost = function(obj) {
  // transform object into ghost
  obj.type = "player_ghost";
  obj.c = this.c.objects["player_ghost"];
  obj.speed_x = 0;
  obj.speed_y = 0;
};

/* Clusters
	---------------------------------------- */

core.prototype.event_cluster = function(obj) {
  // set off explosions
  this.run_event(obj, "explode");

  // get cluster constants
  var cluster = obj.c.cluster;

  // get opposite angle of gravity
  var angle = this.map.get_gravity_angle(obj.x, obj.y);
  angle = angle_add(angle, 135);

  // go through clusters
  var range = cluster.circle ? 360 - 360 / cluster.count : 90;
  var angle_diff = range / (cluster.count - 1);
  for (var i = 0; i < cluster.count; i++) {
    // create cluster objects
    var launch_angle = angle_add(angle, i * angle_diff);
    var speed = xy_speed(launch_angle, cluster.speed);

    // create cluster object
    this.create_object({
      type: cluster.object,
      id: obj.id,
      data: i + 1,
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: speed.x.fixed(),
      speed_y: speed.y.fixed()
    });
  }

  return true;
};

/* Collect Crate
	---------------------------------------- */

core.prototype.event_collect = function(obj, collided_obj) {
  // prep event to send to game
  var event = {
    type: "collect",
    obj: collided_obj.key,
    player_id: obj.player_id
  };
  var player = this.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // crate
  if (collided_obj.type === "crate") {
    var count = this.scheme.weapons[collided_obj.data].crate_count;
    count = count === -1 ? "infinite" : count;
    this.update_player_armoury(obj.player_id, collided_obj.data, count);
    event.collected = "crate";
    event.weapon = collided_obj.data;
    event.count = count;
    player.events.push({
      frame: this.state.frame,
      type: "crate",
      obj: collided_obj.key
    });
  }

  // medpack
  else if (collided_obj.type === "medpack") {
    this.player_health_add(obj.player_id, this.scheme.drops.medpack.add);
    event.collected = "medpack";
    player.events.push({
      frame: this.state.frame,
      type: "medpack",
      obj: collided_obj.key
    });
  }

  // gems
  else if (collided_obj.type === "gem-1") {
    this.player_score_add(obj.player_id, 1);
    event.collected = "gem";
    event.n = 1;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-5") {
    this.player_score_add(obj.player_id, 5);
    event.collected = "gem";
    event.n = 5;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-20") {
    this.player_score_add(obj.player_id, 20);
    event.collected = "gem";
    event.n = 20;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-50") {
    this.player_score_add(obj.player_id, 50);
    event.collected = "gem";
    event.n = 50;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  } else if (collided_obj.type === "gem-200") {
    this.player_score_add(obj.player_id, 200);
    event.collected = "gem";
    event.n = 200;
    player.events.push({
      frame: this.state.frame,
      type: "gem",
      obj: collided_obj.key
    });
  }

  // record event
  this.state.events.push(event);

  // kill object
  this.run_event(collided_obj, "die", obj, "collect");

  // check for collection events
  if (this.scheme.events.collect) {
    if (this.scheme.events.collect[collided_obj.id]) {
      this.state.events.push(this.scheme.events.collect[collided_obj.id]);
    }
  }

  return false;
};

/* ========================================================================
    Explosions
 ========================================================================== */

/* Create an explosion
	---------------------------------------- */

core.prototype.create_explosion = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "explosion",
    player_id: "",
    frame: state_ref.frame,
    x: 0,
    y: 0,
    parent: "",
    parent_type: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.parent_type];

  // add to state objects
  state_ref.explosions[obj.parent] = obj;
};

/* Check all existing explosions
	---------------------------------------- */

core.prototype.frame_explosions = function() {
  // go through all explosions
  for (var key in this.state.explosions) {
    var explode = this.state.explosions[key];

    // if expired remove
    if (this.state.frame > explode.frame + 40) {
      delete this.state.explosions[key];
    }

    // if exploding this frame run
    if (this.state.frame === explode.frame + 1) {
      this.run_explosion(explode);
    }
  }
};

/* Run an explosion
	---------------------------------------- */

core.prototype.run_explosion = function(explode) {
  // if no damage
  if (!explode.c.damage) {
    return;
  }

  // calculate additional player damage
  var damage = this.get_damage(explode);

  // check collisions
  for (key in this.state.objects) {
    var obj = this.state.objects[key];

    // if object was just made
    if (this.state.frame < obj.frame + 2) {
      continue;
    }

    // run collision check
    if (
      !this.collision_check(
        obj.x,
        obj.y,
        explode.x,
        explode.y,
        obj.c.size,
        damage * 2
      )
    ) {
      this.event(obj, "explosion", explode);
    }
  }

  // record ground damage
  var ptype = this.c.objects[explode.parent_type];
  if (ptype && ptype.destroy_ground) {
    this.state.events.push({
      type: "ground_damage",
      frame: this.state.frame,
      x: explode.x,
      y: explode.y,
      radius: damage
    });
  }
};

/* ========================================================================
    Objects
 ========================================================================== */

/* Create a new game object
	---------------------------------------- */

core.prototype.create_object = function(props, state) {
  var state_ref = state || this.state;

  var obj = {
    type: "",
    player_id: "",
    id: "",
    frame: state_ref.frame,
    grounded: false,
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    data: ""
  };
  obj = deepmerge(obj, props);
  obj.c = this.c.objects[obj.type];
  var key_type = obj.type;

  // set key
  if (
    obj.type === "player" ||
    obj.type === "player_ghost" ||
    obj.type === "player_missile"
  ) {
    obj.key = "player-" + obj.player_id;
  } else {
    obj.key =
      obj.type +
      "-" +
      obj.player_id +
      "-" +
      obj.id +
      "-" +
      obj.frame +
      "-" +
      obj.data;
  }

  // add to state objects
  state_ref.objects[obj.key] = obj;

  // return it
  return obj;
};

/* Snap object to another object
	---------------------------------------- */

core.prototype.snap_object = function(obj1, obj2) {
  obj1.grounded = obj2.grounded;
  obj1.x = obj2.x;
  obj1.y = obj2.y;
  obj1.speed_x = obj2.speed_x;
  obj1.speed_y = obj2.speed_y;
};

/* Run through object frame events
	---------------------------------------- */

core.prototype.frame_objects = function() {
  // run through all objects
  for (var key in this.state.objects) {
    this.frame_object(this.state.objects[key]);
  }

  // check for player lock
  for (var key in this.state.players) {
    this.frame_player_lock(this.state.players[key]);
  }
};

core.prototype.frame_object = function(obj) {
  if (!obj) {
    return;
  }
  obj.destroyed = false;

  // stopping
  if (obj.c.stop > 0 && this.state.frame > obj.frame + obj.c.stop) {
    obj.speed_x = 0;
    obj.speed_y = 0;
  }

  // timeout
  if (obj.c.timeout > 0 && obj.frame + obj.c.timeout <= this.state.frame) {
    this.run_event(obj, "die");
    return;
  }

  // run physics on object
  this.physics(obj);

  // events
  this.event(obj, "frame");
};

/* Spawns
	---------------------------------------- */

core.prototype.spawn = function(props) {
  // weapon crate contents
  if (props.type == "crate") {
    if (this.crate_list.length < 1) {
      return;
    }
    props.data = this.crate_list[rand(0, this.crate_list.length)];
  }

  // do we have a set position
  if (!props.x && !props.y) {
    var pos = this.map.air_find_spot();
    props.x = pos.x;
    props.y = pos.y;
  }

  return this.create_object(props);
};

/* ========================================================================
    Physics
 ========================================================================== */

/* Run air physics
	---------------------------------------- */

core.prototype.physics = function(obj) {
  // are we still grounded
  if (obj.grounded) {
    if (!this.map.ground_pixel(round(obj.x), round(obj.y))) {
      obj.grounded = false;
    }
  }

  // run the main physics
  if (!obj.grounded) {
    this.physics_gravity(obj);
    this.physics_move(obj);
  }
};

/* Calculate gravity
	---------------------------------------- */

core.prototype.physics_gravity = function(obj) {
  // if no weight
  if (obj.c.weight <= 0) {
    return;
  }

  // get gravity values
  var gravity = this.map.get_gravity(round(obj.x), round(obj.y));

  // adjust speed
  this.physics_adjust_speed(
    obj,
    gravity.x,
    gravity.y,
    obj.c.speed.max_gravity,
    obj.c.weight
  );
};

/* Adjust speed of object
	---------------------------------------- */

core.prototype.physics_adjust_speed = function(
  obj,
  new_speed_x,
  new_speed_y,
  max_speed,
  weight
) {
  var angle = get_angle(new_speed_x, new_speed_y);
  var max_speed = xy_speed(angle, max_speed);
  var speed_add_x = new_speed_x * weight;
  var speed_add_y = new_speed_y * weight;
  var diff_x = max_speed.x - obj.speed_x;
  var diff_y = max_speed.y - obj.speed_y;

  // only add speed up to the limit without bringing it down
  if (max_speed.x < 0) {
    obj.speed_x += max(speed_add_x, min(0, diff_x));
  } else {
    obj.speed_x += min(speed_add_x, max(0, diff_x));
  }
  if (max_speed.y < 0) {
    obj.speed_y += max(speed_add_y, min(0, diff_y));
  } else {
    obj.speed_y += min(speed_add_y, max(0, diff_y));
  }

  obj.speed_x = obj.speed_x.fixed();
  obj.speed_y = obj.speed_y.fixed();
};

/* Do the movement
	---------------------------------------- */

core.prototype.physics_move = function(obj) {
  // check speed
  var speed_limit = check_speed(obj.speed_x, obj.speed_y, obj.c.speed.max);
  obj.speed_x = speed_limit.x.fixed();
  obj.speed_y = speed_limit.y.fixed();

  // plot a course
  var course = plot_course(obj.x, obj.y, obj.speed_x, obj.speed_y);

  // if no course
  if (!course.move) {
    this.collisions(obj, obj.x, obj.y);
    return;
  }

  // move through course
  var moved = false;
  for (var i = 1; i < course.points.length; i++) {
    // remaining movement points left
    obj.speed_left = course.points.length - i;

    var point = course.points[i];
    var nx = this.map.loop_x(round(point.x));
    var ny = this.map.loop_y(round(point.y));

    // collisions
    var collision = this.collisions(obj, nx, ny);
    if (collision) {
      break;
    }

    // move object
    obj.x = nx;
    obj.y = ny;
    moved = true;
  }

  return moved;
};

/* ========================================================================
    Players
 ========================================================================== */

/* Create a new player
	---------------------------------------- */

core.prototype.create_player = function(props, state) {
  if (typeof props.id === "undefined") {
    return;
  }

  var state_ref = state || this.state;

  // set up object
  var obj = {
    id: "",
    level: 0,
    score: 0,
    dead: false,
    health: this.scheme.levels.health[0],
    cooldown: 0,
    hit: 0,
    weapon: "",
    locked: "",
    events: [],
    armoury: {}
  };
  obj = deepmerge(obj, props);
  obj.id = parseInt(obj.id);

  // set level
  this.player_level(obj.id);

  // add to state objects
  state_ref.players[obj.id] = obj;

  return obj;
};

/* Remove player
	---------------------------------------- */

core.prototype.remove_player = function(player_id) {
  if (!this.state.players[player_id]) {
    return;
  }

  delete this.state.objects["player-" + player_id];
  delete this.state.players[player_id];
};

/* Start the player
	---------------------------------------- */

core.prototype.init_player = function(player_id, state) {
  player_id = parseInt(player_id);
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // player values
  player.level = 0;
  player.score = 0;
  player.dead = false;
  player.health = this.scheme.levels.health[0];
  player.cooldown = 0;
  player.events = [];

  // armoury
  var armoury = {};
  for (var key in this.scheme.weapons) {
    armoury[key] = this.scheme.weapons[key].start_count;
  }
  player.armoury = armoury;

  // merge with an external state
  if (state) {
    this.state.players[player_id] = deepmerge(player, state);
  }

  // set level
  this.player_level(player_id);

  // object values
  var obj = this.state.objects["player-" + player_id];
  if (!obj) {
    return;
  }
  if (this.scheme.spawn.length > 0) {
    var pos = this.scheme.spawn[rand(0, this.scheme.spawn.length)];
  } else {
    var pos = this.map.air_find_spot();
  }
  obj.type = "player";
  obj.grounded = false;
  obj.x = pos.x;
  obj.y = pos.y;
  obj.speed_x = 0;
  obj.speed_y = 0;
  obj.c = this.c.objects["player"];
};

/* Update armoury
	---------------------------------------- */

core.prototype.update_player_armoury = function(player_id, weapon, count) {
  var player = this.state.players[player_id];
  if (!player) {
    return;
  }

  // if infinite or if zero and taking away
  var old_count = player.armoury[weapon];
  if (!is_numeric(old_count)) {
    return false;
  }
  if (old_count === -1) {
    return true;
  }
  if (old_count === 0 && count < 1) {
    return false;
  }

  // if infinite
  if (count === "infinite") {
    player.armoury[weapon] = -1;
  } else {
    player.armoury[weapon] += count;
  }

  // record event
  this.state.events.push({
    type: "armoury",
    player_id: player_id,
    weapon: weapon
  });

  return true;
};

/* Add health to player
	---------------------------------------- */

core.prototype.player_health_add = function(player_id, health, no_message) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // no health enabled
  if (!this.scheme.health) {
    return;
  }

  // add it
  player.health += health;
  player.health = min(player.health, this.scheme.levels.health[player.level]);

  // are we dead
  if (player.health <= 0) {
    this.player_die(player_id);
  }

  // set event
  if (!no_message) {
    this.state.events.push({
      type: "player_health",
      id: player_id,
      health: health
    });
  }
};

/* Add score to player
	---------------------------------------- */

core.prototype.player_score_add = function(player_id, score) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // add it
  player.score += score;

  // set level
  this.player_level(player_id);

  // set event
  this.state.events.push({
    type: "player_score",
    id: player_id,
    score: score
  });
};

/* Set player level
	---------------------------------------- */

core.prototype.player_level = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  // go through levels
  var level = 0;
  for (var i = 0; i < this.scheme.levels.score.length; i++) {
    if (this.scheme.levels.score[i] <= player.score) {
      level = i;
    }
  }
  player.level = level;
};

/* Player die
	---------------------------------------- */

core.prototype.player_die = function(player_id) {
  var player = this.state.players[player_id];
  if (!player || player.dead) {
    return;
  }

  player.dead = true;

  var obj = this.state.objects["player-" + player_id];
  obj.type = "player_missile";
  obj.c = this.c.objects["player_missile"];

  // figure out gems to spawn
  var n = max(round(player.score / 2), 3);
  var gems = [];
  while (n > 200) {
    gems.push(200);
    n -= 200;
  }
  while (n > 50) {
    gems.push(50);
    n -= 50;
  }
  while (n > 20) {
    gems.push(20);
    n -= 20;
  }
  while (n > 5) {
    gems.push(5);
    n -= 5;
  }
  while (n > 1) {
    gems.push(1);
    n -= 1;
  }

  // spawn them
  var angle_inc = round(360 / gems.length);
  for (var i = 0; i < gems.length; i++) {
    var n = ((i % 3) + 1) * 2;
    var xy = xy_speed(angle_inc * i, n);
    this.create_object({
      type: "gem-" + gems[i],
      player_id: obj.player_id,
      x: obj.x,
      y: obj.y,
      speed_x: xy.x.fixed(),
      speed_y: xy.y.fixed(),
      data: i + 1
    });
  }
};

/* Run through players
	---------------------------------------- */

core.prototype.frame_players = function(ignore) {
  // run through all objects
  for (var key in this.state.players) {
    if (parseInt(key) !== ignore) {
      this.frame_player(this.state.players[key]);
    }
  }
};

core.prototype.frame_player = function(player) {
  if (!player) {
    return;
  }

  // cooldown
  if (player.cooldown > 0) {
    player.cooldown--;
  }

  // hit
  if (player.hit > 0) {
    player.hit--;
  }

  // health regen
  if (this.state.frame % 24 === 0) {
    if (player.health < this.scheme.levels.health[player.level]) {
      this.player_health_add(player.id, 2, true);
    }
  }

  // remove old events
  for (var i = 0; i < player.events.length; i++) {
    if (this.state.frame > player.events[i].frame + 18) {
      player.events.splice(i, 1);
    }
  }
};

/* Run through player locked objects
	---------------------------------------- */

core.prototype.frame_player_lock = function(player) {
  var player_obj = this.state.objects["player-" + player.id];
  var obj = this.state.objects[player.locked];
  if (player_obj && obj) {
    player_obj.x = obj.x;
    player_obj.y = obj.y;
    player_obj.speed_x = obj.speed_x;
    player_obj.speed_y = obj.speed_y;
  } else {
    player.locked = "";
  }
};

/* Get damage modifiers from player
	---------------------------------------- */

core.prototype.get_damage = function(obj) {
  var damage = obj.c.damage;
  var player = this.state.players[obj.player_id];
  if (player && damage !== 0 && !obj.c.ignore_level_damage) {
    var level = this.scheme.levels.damage[player.level];
    if (level) {
      damage += level;
    }
  }
  return damage;
};

/* ========================================================================
    State management
 ========================================================================== */

/* Get state
	---------------------------------------- */

core.prototype.pack_state = function(state) {
  // players
  var players = [];
  for (var id in state.players) {
    players.push(this.pack_player(state.players[id]));
  }

  // go through objects
  var objects = [];
  for (var key in state.objects) {
    objects.push(this.pack_object(state.objects[key]));
  }

  // go through explosions
  var explosions = [];
  for (key in state.explosions) {
    explosions.push(this.pack_explosion(state.explosions[key]));
  }

  return (
    players.join("#") + "+" + objects.join("#") + "+" + explosions.join("#")
  );
};

/* Set state
	---------------------------------------- */

core.prototype.unpack_state = function(str) {
  // blank state
  var state = this.blank_state();

  // run through state string
  var split = str.split("+");
  for (var i = 0; i < split.length; i++) {
    if (split[i]) {
      var split2 = split[i].split("#");
      for (var j = 0; j < split2.length; j++) {
        if (i == 0) {
          this.unpack_player(state, split2[j]);
        }
        if (i == 1) {
          this.unpack_object(state, split2[j]);
        }
        if (i == 2) {
          this.unpack_explosion(state, split2[j]);
        }
      }
    }
  }

  return state;
};

/* Players
	---------------------------------------- */

core.prototype.pack_player = function(obj) {
  // prep basic values
  var dead = obj.dead ? "1" : "";
  var weapon = this.armoury_refs.indexOf(obj.weapon);

  // prep armoury
  var armoury = [];
  for (var key in obj.armoury) {
    armoury.push(obj.armoury[key]);
  }
  armoury = armoury.join("$");

  // prep events
  var events = [];
  for (var i = 0; i < obj.events.length; i++) {
    var event = obj.events[i];
    if (event.type === "walk") {
      events.push(event.frame + "~0");
    }
    if (event.type === "jump") {
      events.push(event.frame + "~1");
    }
    if (event.type === "shoot") {
      events.push(event.frame + "~2~" + event.obj + "~" + event.weapon);
    }
    if (event.type === "crate") {
      events.push(event.frame + "~3~" + event.obj);
    }
    if (event.type === "medpack") {
      events.push(event.frame + "~4~" + event.obj);
    }
    if (event.type === "gem") {
      events.push(event.frame + "~5~" + event.obj);
    }
  }
  events = events.join("$");

  // return player string
  var arr = [
    obj.id,
    obj.level,
    obj.score,
    dead,
    obj.health,
    obj.cooldown,
    obj.hit,
    obj.locked,
    armoury,
    weapon,
    events
  ];
  return arr.join("/");
};

core.prototype.unpack_player = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.id = parseInt(split[0]);
  props.level = parseInt(split[1]);
  props.score = parseInt(split[2]);
  props.dead = split[3] === "1" ? true : false;
  props.health = parseInt(split[4]);
  props.cooldown = parseInt(split[5]);
  props.hit = parseInt(split[6]);
  props.locked = split[7];

  // prep armoury
  props.armoury = {};
  var split2 = split[8].split("$");
  for (var i = 0; i < split2.length; i++) {
    var key = this.armoury_refs[i];
    props.armoury[key] = parseInt(split2[i]);
  }

  // weapon
  var wep = parseInt(split[9]);
  if (wep !== -1) {
    props.weapon = this.armoury_refs[wep];
  }

  // prep events
  props.events = [];
  var split2 = split[10].split("$");
  for (var i = 0; i < split2.length; i++) {
    var split3 = split2[i].split("~");
    var obj = { frame: parseInt(split3[0]) };
    if (split3[1] === "0") {
      obj.type = "walk";
    }
    if (split3[1] === "1") {
      obj.type = "jump";
    }
    if (split3[1] === "2") {
      obj.type = "shoot";
      obj.obj = split3[2];
      obj.weapon = split3[3];
    }
    if (split3[1] === "3") {
      obj.type = "crate";
      obj.obj = split3[2];
    }
    if (split3[1] === "4") {
      obj.type = "medpack";
      obj.obj = split3[2];
    }
    if (split3[1] === "5") {
      obj.type = "gem";
      obj.obj = split3[2];
    }
    if (obj) {
      props.events.push(obj);
    }
  }

  // make it
  this.create_player(props, state);
};

/* Objects
	---------------------------------------- */

core.prototype.pack_object = function(obj) {
  var grounded = obj.grounded ? "1" : "";
  var arr = [
    obj.type,
    obj.player_id,
    obj.id,
    obj.frame,
    grounded,
    obj.x,
    obj.y,
    obj.speed_x,
    obj.speed_y,
    obj.data
  ];
  return arr.join("/");
};

core.prototype.unpack_object = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.type = split[0];
  props.player_id = parseInt(split[1]);
  props.id = split[2];
  props.frame = parseInt(split[3]);
  props.grounded = split[4] === "1" ? true : false;
  props.x = parseFloat(split[5]);
  props.y = parseFloat(split[6]);
  props.speed_x = parseFloat(split[7]);
  props.speed_y = parseFloat(split[8]);
  props.data = split[9];

  this.create_object(props, state);
};

/* Explosions
	---------------------------------------- */

core.prototype.pack_explosion = function(obj) {
  var arr = [
    obj.player_id,
    obj.frame,
    obj.x,
    obj.y,
    obj.parent,
    obj.parent_type
  ];
  return arr.join("/");
};

core.prototype.unpack_explosion = function(state, str) {
  var split = str.split("/");
  var props = {};
  props.player_id = parseInt(split[0]);
  props.frame = parseInt(split[1]);
  props.x = parseFloat(split[2]);
  props.y = parseFloat(split[3]);
  props.parent = split[4];
  props.parent_type = split[5];

  this.create_explosion(props, state);
};

function isMergeableObject(val) {
  var nonNullObject = val && typeof val === "object";

  return (
    nonNullObject &&
    Object.prototype.toString.call(val) !== "[object RegExp]" &&
    Object.prototype.toString.call(val) !== "[object Date]"
  );
}

function emptyTarget(val) {
  return Array.isArray(val) ? [] : {};
}

function cloneIfNecessary(value, optionsArgument) {
  var clone = optionsArgument && optionsArgument.clone === true;
  return clone && isMergeableObject(value)
    ? deepmerge(emptyTarget(value), value, optionsArgument)
    : value;
}

function defaultArrayMerge(target, source, optionsArgument) {
  var destination = target.slice();
  source.forEach(function(e, i) {
    if (typeof destination[i] === "undefined") {
      destination[i] = cloneIfNecessary(e, optionsArgument);
    } else if (isMergeableObject(e)) {
      destination[i] = deepmerge(target[i], e, optionsArgument);
    } else if (target.indexOf(e) === -1) {
      destination.push(cloneIfNecessary(e, optionsArgument));
    }
  });
  return destination;
}

function mergeObject(target, source, optionsArgument) {
  var destination = {};
  if (isMergeableObject(target)) {
    Object.keys(target).forEach(function(key) {
      destination[key] = cloneIfNecessary(target[key], optionsArgument);
    });
  }
  Object.keys(source).forEach(function(key) {
    if (!isMergeableObject(source[key]) || !target[key]) {
      destination[key] = cloneIfNecessary(source[key], optionsArgument);
    } else {
      destination[key] = deepmerge(target[key], source[key], optionsArgument);
    }
  });
  return destination;
}

function deepmerge(target, source, optionsArgument) {
  var array = Array.isArray(source);
  var options = optionsArgument || { arrayMerge: defaultArrayMerge };
  var arrayMerge = options.arrayMerge || defaultArrayMerge;

  if (array) {
    return Array.isArray(target)
      ? arrayMerge(target, source, optionsArgument)
      : cloneIfNecessary(source, optionsArgument);
  } else {
    return mergeObject(target, source, optionsArgument);
  }
}

deepmerge.all = function deepmergeAll(array, optionsArgument) {
  if (!Array.isArray(array) || array.length < 2) {
    throw new Error(
      "first argument should be an array with at least two elements"
    );
  }

  // we are sure there are at least 2 values, so it is safe to have no initial value
  return array.reduce(function(prev, next) {
    return deepmerge(prev, next, optionsArgument);
  });
};

/* ========================================================================
    Math Functions
 ========================================================================== */

/* Shorten "Math" functions
	---------------------------------------- */

function cos(n) {
  return Math.cos(n);
}
function sin(n) {
  return Math.sin(n);
}
function pow(n) {
  return Math.pow(n);
}
function abs(n) {
  return Math.abs(n);
}
function sqr(n) {
  return Math.pow(n, 2);
}
function sqrt(n) {
  return Math.sqrt(n);
}
function round(n) {
  return Math.round(n);
}
function floor(n) {
  return Math.floor(n);
}
function ceil(n) {
  return Math.ceil(n);
}
function atan2(n1, n2) {
  return Math.atan2(n1, n2);
}
function min(n1, n2) {
  return Math.min(n1, n2);
}
function max(n1, n2) {
  return Math.max(n1, n2);
}
function rand(n1, n2) {
  return floor(Math.random() * n2) + n1;
}
var pi = Math.PI;

/* Fix number to decimal places
	---------------------------------------- */

Number.prototype.fixed = function(n) {
  n = n || 2;
  return parseFloat(this.toFixed(n));
};

/* Add preceding zeroes to number
	---------------------------------------- */

function preceding_zeroes(n, length) {
  var length = length || 2;
  var n = n.toString();
  while (n.length < length) {
    n = "0" + n;
  }
  return n;
}

/* Is number
	---------------------------------------- */

function is_numeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

/* Get distance between two points
	---------------------------------------- */

function get_speed(sx, sy) {
  return round(sqrt(sqr(sx) + sqr(sy)));
}

function get_distance(x1, y1, x2, y2) {
  var dx = x2 - x1,
    dy = y2 - y1;
  return get_speed(dx, dy);
}

/* Check speed limit
	---------------------------------------- */

function check_speed(sx, sy, speed) {
  var d = get_distance(0, 0, sx, sy),
    ns = {
      x: sx,
      y: sy,
      total: d
    };
  if (speed < d) {
    var multi = speed / d;
    ns.x = sx * multi;
    ns.y = sy * multi;
    ns.total = speed;
  }
  return ns;
}

/* Get Heading Angle From X and Y Speed
	// 0 = left, 360 = left
	---------------------------------------- */

function get_angle(sx, sy) {
  return (((atan2(sy, sx) * 180) / pi) % 360) + 180;
}

function get_heading(x1, y1, x2, y2) {
  var xs = x2 - x1,
    ys = y2 - y1;
  return get_angle(xs, ys);
}

/* Get X and Y speed from heading and velocity
	---------------------------------------- */

function xy_speed(angle, speed) {
  var a = angle_add(angle, 180),
    r = (a / 180) * pi;
  return {
    x: speed * cos(r),
    y: speed * sin(r)
  };
}

/* Get X and Y offset from heading and velocity
	---------------------------------------- */

function xy_offset(angle, sx, sy) {
  var xy1 = xy_speed(angle, sx);
  var xy2 = xy_speed(angle_add(angle, 90), sy);
  return {
    x: xy1.x + xy2.x,
    y: xy1.y + xy2.y
  };
}

/* Get difference between two numbers in a loop
	---------------------------------------- */

function n_diff(current, target, bottom, top) {
  if (current == target) {
    return 0;
  }

  var scale = abs(top - bottom), // get total size of the loop
    c_current = current - bottom, // correct current for negative numbers
    c_target = target - bottom, // correct target for negative numbers
    n1 = (c_target + scale - c_current) % scale, // get difference when adding
    n2 = (c_current + scale - c_target) % scale; // get difference when subtracting

  // return smallest distance
  if (n1 < n2) {
    return n1;
  } else {
    return -n2;
  }
}

/* Auto loop a number
	---------------------------------------- */

function n_loop(n, bottom, top) {
  var difference = abs(top - bottom);
  while (n <= bottom) {
    n += difference;
  }
  while (n > top) {
    n -= difference;
  }
  return n;
}

/* Add to a number without overflowing up or down from min/max
	---------------------------------------- */

function n_add(n1, n2, t1, t2) {
  var dif = abs(t2 - t1),
    na = n1 + n2;
  while (na < t1) {
    na += dif;
  }
  while (na >= t2) {
    na -= dif;
  }
  return na;
}

/* Add to an angle without overflowing up or down from 0-360
	---------------------------------------- */

function angle_add(angle, add) {
  if (!angle) {
    angle = 0;
  }
  return n_add(angle, add, 0, 360);
}

/* Move number towards a new number with loop
	---------------------------------------- */

function increment_num(current, target, bottom, top, speed) {
  var diff = n_diff(current, target, bottom, top); // get shortest route to number
  move = min(abs(diff) / 10, 4) * speed; // calculate how much to move

  // if difference is less then movement, return target
  if (abs(diff) < move) {
    return target;
  }

  // add or subtract movement
  move = diff < 0 ? -move : move;
  return n_add(current, move, bottom, top);
}

/* Move angle towards a new angle
	---------------------------------------- */

function increment_angle(old_angle, new_angle, speed) {
  return increment_num(old_angle, new_angle, 0, 360, speed);
}

/* If a point is within a circle
	---------------------------------------- */

function in_circle(x, y, cx, cy, radius) {
  return get_distance(x, y, cx, cy) < radius;
}

/* Plot a course
	---------------------------------------- */

function plot_course(x, y, sx, sy, extend) {
  // get initial speed
  var extend = extend ? extend : 0,
    speed = get_speed(sx, sy);

  // if no distance then do nothing
  if (speed == 0) {
    return { move: false };
  }

  // calculate increments
  var increment_x = sx / speed,
    increment_y = sy / speed,
    new_x = x - increment_x * extend,
    new_y = y - increment_y * extend,
    points = [{ x: new_x, y: new_y }];

  // iterate through path and record points
  for (var i = 0; i < speed + extend * 2; i++) {
    (new_x += increment_x), (new_y += increment_y);
    points.push({
      x: new_x,
      y: new_y
    });
  }

  // return point array
  return {
    move: true,
    points: points
  };
}

/* translate co-ordinates by an angle
	---------------------------------------- */

function rotate_coords(x, y, cx, cy, angle) {
  var r = (pi / 180) * angle;
  return {
    x: cos(r) * (x - cx) + sin(r) * (y - cy) + cx,
    y: cos(r) * (y - cy) - sin(r) * (x - cx) + cy
  };
}

/* ========================================================================
    Misc Functions
 ========================================================================== */

/* Duplicate object
	---------------------------------------- */

function duplicate_obj(obj) {
  return JSON.parse(JSON.stringify(obj));
}

/* Prevent array merging
	---------------------------------------- */

function dont_merge(destination, source) {
  if (!source) {
    return destination;
  } else {
    return source;
  }
}

/* Add space to a string
	---------------------------------------- */

function str_space(str) {
  var new_str = "";
  for (var i = 0; i < str.length; i++) {
    var add = i == str.length - 1 ? "" : "\u200A";
    new_str += str[i] + add;
  }
  return new_str;
}

/* Log multiple values
	---------------------------------------- */

function clog(
  s1,
  s2,
  s3,
  s4,
  s5,
  s6,
  s7,
  s8,
  s9,
  s10,
  s11,
  s12,
  s13,
  s14,
  s15
) {
  var str = s1;
  if (s2 != undefined) {
    str += " | " + s2;
  }
  if (s3 != undefined) {
    str += " | " + s3;
  }
  if (s4 != undefined) {
    str += " | " + s4;
  }
  if (s5 != undefined) {
    str += " | " + s5;
  }
  if (s6 != undefined) {
    str += " | " + s6;
  }
  if (s7 != undefined) {
    str += " | " + s7;
  }
  if (s8 != undefined) {
    str += " | " + s8;
  }
  if (s9 != undefined) {
    str += " | " + s9;
  }
  if (s10 != undefined) {
    str += " | " + s10;
  }
  if (s11 != undefined) {
    str += " | " + s11;
  }
  if (s12 != undefined) {
    str += " | " + s12;
  }
  if (s13 != undefined) {
    str += " | " + s13;
  }
  if (s14 != undefined) {
    str += " | " + s14;
  }
  if (s15 != undefined) {
    str += " | " + s15;
  }
  console.log(str);
}

var schemes = schemes || {};
schemes.deathmatch = {
  title: "Deathmatch",
  time_limit: 0,
  destroy_land: true,
  gravity: 2,
  score: true,
  drops: {
    crate: {
      time: 100,
      max: 1
    },
    medpack: {
      time: 100,
      add: 30,
      max: 1
    },
    "gem-1": {
      time: 100,
      max: 5
    },
    "gem-5": {
      time: 150,
      max: 1
    },
    "gem-20": {
      time: 500,
      max: 1
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 5,
      crate_chance: 1,
      crate_count: 5
    },
    paingiver: {
      start_count: 20,
      crate_chance: 1,
      crate_count: 5
    }
  },
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1900,
    h: 1400,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

var schemes = schemes || {};
schemes.default = {
  title: "",
  description: "",
  time_limit: 0,
  show_time: false,
  destroy_land: true,
  gravity_type: "land",
  gravity: 1,
  stars: {},
  score: false,
  health: true,
  levels: {
    score: [
      0,
      10,
      25,
      40,
      60,
      90,
      120,
      150,
      200,
      250,
      300,
      360,
      420,
      490,
      570,
      650,
      720,
      810,
      900,
      1000
    ],
    health: [
      100,
      120,
      120,
      120,
      140,
      140,
      140,
      140,
      160,
      180,
      200,
      200,
      200,
      200,
      220,
      220,
      220,
      220,
      240,
      300
    ],
    damage: [
      0,
      10,
      10,
      15,
      15,
      15,
      15,
      20,
      20,
      25,
      25,
      25,
      30,
      30,
      30,
      30,
      35,
      35,
      35,
      50
    ],
    speed: [
      4,
      6,
      8,
      8,
      8,
      8,
      10,
      10,
      10,
      12,
      12,
      12,
      12,
      14,
      14,
      14,
      14,
      16,
      16,
      20
    ],
    jump: [
      10,
      12,
      12,
      12,
      12,
      15,
      15,
      15,
      15,
      18,
      18,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      20,
      25
    ]
  },
  drops: {
    crate: {
      time: 0,
      max: 20
    },
    medpack: {
      time: 0,
      add: 30,
      max: 50
    },
    nuclear: {
      time: 0,
      max: 20
    },
    target: {
      time: 0,
      max: 100
    },
    asteroid_center: {
      time: 0,
      increase_frequency: false,
      max: 30
    },
    "gem-1": {
      time: 0,
      max: 20
    }
  },
  weapons: {
    dig: {
      start_count: -1,
      crate_chance: 0,
      crate_count: -1
    },
    phaser: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    bazookoid: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    grenade: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    punch: {
      start_count: 0,
      crate_chance: 0,
      crate_count: -1
    },
    pumpkin: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 1
    },
    paingiver: {
      start_count: 0,
      crate_chance: 0,
      crate_count: 10
    }
  },
  armoury: [
    "dig",
    "phaser",
    "bazookoid",
    "grenade",
    "punch",
    "pumpkin",
    "paingiver"
  ],
  arrows: {
    nuclear: "green",
    player: "red",
    target: "blue",
    "asteroid-small": "grey",
    "asteroid-large": "grey",
    vortex: "purple",
    crate: "blue"
  },
  spawn: [],
  mapgen: {
    type: "random",
    src: "",
    gap: 20,
    w: 1000,
    h: 1000,
    blobs: [],
    decorations: true,
    small_blobs: 5,
    large_blobs: 3
  },
  events: {
    frame: {},
    collect: {},
    destroy: {},
    timeout: {},
    destroy_obj_type: {},
    destroy_obj_player: {}
  }
};

/* ========================================================================
	Map Generator
	Blobs
 ========================================================================== */

/* Draw a blob
	---------------------------------------- */

function mapgen_blob(img, config, decorations, radius, type) {
  this.size = 36;
  this.img = img;
  this.c = config;

  // get land type
  var type = type || Math.floor(Math.random() * this.c.land_type.length);
  this.ref = this.c.land_type[type];

  // set up main anchor points
  var anchors = [];
  var points = Math.floor(radius / 2) + 4;
  var spike = Math.floor(radius / 2) + 2;
  for (var p = 0; p < points; p++) {
    var new_radius =
      Math.max(radius - Math.floor(Math.random() * spike), 1) + 1;
    var x =
      radius + Math.floor(new_radius * Math.cos((2 * Math.PI * p) / points));
    var y =
      radius + Math.floor(new_radius * Math.sin((2 * Math.PI * p) / points));
    anchors.push({ x: x, y: y });
  }

  // draw shape to canvas
  var size = radius * 2 + 1;
  var shape = mapgen_canvas(size, size);
  this.draw_path(shape, anchors);

  // build array of land or not tiles
  var pixels = shape.cont.getImageData(0, 0, shape.w, shape.h);
  this.land = [];
  for (var y = 0; y < size; y++) {
    this.land[y] = [];
    for (var x = 0; x < size; x++) {
      var i = (y * size + x) * 4 + 3;
      this.land[y][x] = pixels.data[i] > 30 ? 1 : 0;
    }
  }

  // build tile array and assign corners and land
  this.tiles = [];
  for (var y = 0; y < size; y++) {
    this.tiles[y] = [];
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] = this.set_corner_tile(y, x);
    }
  }

  // assign pixels a tile value
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      this.tiles[y][x] =
        this.tiles[y][x] === 12 ? this.set_land_tile(y, x) : this.tiles[y][x];
    }
  }

  // draw them
  var wh = (size + 4) * this.size;
  this.alpha = mapgen_canvas(wh, wh);
  this.edge = mapgen_canvas(wh, wh);
  this.bg = mapgen_canvas(wh, wh);
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      var tile = this.tiles[y][x];
      if (tile === -1) {
        continue;
      }

      // draw it
      var x1 = (x + 2) * this.size;
      var y1 = (y + 2) * this.size;
      this.draw_to_canvas(this.alpha.cont, x1, y1, tile, 0);
      this.draw_to_canvas(this.edge.cont, x1, y1, tile, this.ref.edge);

      if (decorations) {
        this.draw_decoration(this.bg.cont, x, y, tile);
      }
    }
  }

  // draw rest of fg
  var fg = mapgen_pattern(this.alpha.canv, this.img[this.ref.fg]);
  fg.cont.drawImage(this.edge.canv, 0, 0);

  // draw dirt bg
  var fg_dirt = mapgen_pattern(fg.canv, this.img[this.ref.bg]);
  this.bg.cont.drawImage(fg_dirt.canv, 0, 0);

  // export
  return {
    fg: fg,
    bg: this.bg
  };
}

/* Draw an alpha path
	---------------------------------------- */

mapgen_blob.prototype.draw_path = function(canv, path) {
  // start paths on canvases
  canv.cont.beginPath();
  canv.cont.moveTo(path[0].x, path[0].y);

  // go through path
  for (var i = 1; i < path.length - 1; i++) {
    // get next point to curve around
    var point1 = path[i],
      point2 = path[i + 1],
      qx,
      qy;

    // get curve values
    if (i < path.length - 1) {
      qx = (point1.x + point2.x) / 2;
      qy = (point1.y + point2.y) / 2;
    } else {
      qx = point2.x;
      qy = point2.y;
    }

    // draw curve to path
    canv.cont.quadraticCurveTo(point1.x, point1.y, qx, qy);
  }

  // rejoin the beginning of the path and fill
  canv.cont.lineTo(path[0].x, path[0].y);
  canv.cont.fill();
};

/* Draw a decoration
	---------------------------------------- */

mapgen_blob.prototype.draw_decoration = function(cont, x, y, tile) {
  // are we drawing one
  if (tile > 7 || Math.floor(Math.random() * 2) !== 0) {
    return;
  }

  // can we do doubles
  var double = false;
  if (tile === 0 && this.is_type(y, x + 1, 0)) {
    double = true;
  }
  if (tile === 1 && this.is_type(y, x - 1, 1)) {
    double = true;
  }
  if (tile === 2 && this.is_type(y - 1, x, 2)) {
    double = true;
  }
  if (tile === 3 && this.is_type(y + 1, x, 3)) {
    double = true;
  }
  if (tile === 4 && this.is_type(y - 1, x + 1, 4)) {
    double = true;
  }
  if (tile === 5 && this.is_type(y + 1, x + 1, 5)) {
    double = true;
  }
  if (tile === 6 && this.is_type(y - 1, x - 1, 6)) {
    double = true;
  }
  if (tile === 7 && this.is_type(y + 1, x - 1, 7)) {
    double = true;
  }

  // choose source
  var source = this.ref.decorations[1];
  if (double && Math.floor(Math.random() * 2) === 0) {
    source = this.ref.decorations[2];
  } else {
    double = false;
  }

  // choose decoration
  var i = Math.floor(Math.random() * source.length);
  var ref = source[i];

  // get position to draw it
  var half = this.size / 2;
  var x1 = (x + 2) * this.size;
  var y1 = (y + 2) * this.size;
  var angle = 0;
  if (tile === 1) {
    x1 += this.size;
    y1 += this.size;
    angle = 180;
  }
  if (tile === 2) {
    y1 += this.size;
    angle = 270;
  }
  if (tile === 3) {
    x1 += this.size;
    angle = 90;
  }
  if (tile === 4) {
    y1 += this.size;
    angle = 315;
  }
  if (tile === 5) {
    angle = 45;
  }
  if (tile === 6) {
    x1 += this.size;
    y1 += this.size;
    angle = 225;
  }
  if (tile === 7) {
    x1 += this.size;
    angle = 135;
  }

  // draw that shit
  var x_add = double ? this.size : 0;
  cont.save();
  cont.translate(x1, y1);
  cont.rotate((angle * Math.PI) / 180);
  cont.drawImage(
    this.img.decorations,
    ref.x,
    ref.y,
    ref.w,
    ref.h,
    0,
    -ref.h + 5,
    ref.w,
    ref.h
  );
  cont.translate(-x1, -y1);
  cont.restore();
};

/* Draw a tile to a canvas
	---------------------------------------- */

mapgen_blob.prototype.draw_to_canvas = function(cont, x, y, tile, key) {
  var ts = this.size;
  cont.save();
  cont.translate(x, y);
  cont.drawImage(this.img.edge, tile * ts, key * ts, ts, ts, 0, 0, ts, ts);
  cont.translate(-y, -y);
  cont.restore();
};

/* Get corner and land tiles
	---------------------------------------- */

mapgen_blob.prototype.set_corner_tile = function(y, x) {
  var tile = -1;

  //land
  if (this.is_land(y, x)) {
    tile = 12;

    // not land
  } else {
    // corners
    if (
      !this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 4;
    } else if (
      !this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 5;
    } else if (
      this.is_land(y - 1, x) &&
      !this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      this.is_land(y, x + 1)
    ) {
      tile = 6;
    } else if (
      this.is_land(y - 1, x) &&
      this.is_land(y, x - 1) &&
      !this.is_land(y + 1, x) &&
      !this.is_land(y, x + 1)
    ) {
      tile = 7;
    }
  }

  return tile;
};

/* Set land tile types
	---------------------------------------- */

mapgen_blob.prototype.set_land_tile = function(y, x) {
  var tile = 12;

  // corners
  if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 4;
  } else if (
    !this.is_land(y - 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y, x - 1) &&
    this.is_land_or_corner(y + 1, x) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 5;
  } else if (
    !this.is_land(y, x - 1) &&
    !this.is_land(y + 1, x) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x + 1) &&
    !this.is_corner(y, x - 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 6;
  } else if (
    !this.is_land(y + 1, x) &&
    !this.is_land(y, x + 1) &&
    this.is_land_or_corner(y - 1, x) &&
    this.is_land_or_corner(y, x - 1) &&
    !this.is_corner(y, x + 1) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 7;

    // flat edges
  } else if (
    !this.is_land(y - 1, x) &&
    this.is_land(y + 1, x) &&
    !this.is_corner(y - 1, x)
  ) {
    tile = 0;
  } else if (
    !this.is_land(y + 1, x) &&
    this.is_land(y - 1, x) &&
    !this.is_corner(y + 1, x)
  ) {
    tile = 1;
  } else if (
    !this.is_land(y, x - 1) &&
    this.is_land(y, x + 1) &&
    !this.is_corner(y, x - 1)
  ) {
    tile = 2;
  } else if (
    !this.is_land(y, x + 1) &&
    this.is_land(y, x - 1) &&
    !this.is_corner(y, x + 1)
  ) {
    tile = 3;

    // inside corners
  } else if (this.is_type(y + 1, x, 7) || this.is_type(y, x + 1, 7)) {
    tile = 8;
  } else if (this.is_type(y + 1, x, 6) || this.is_type(y, x - 1, 6)) {
    tile = 9;
  } else if (this.is_type(y - 1, x, 5) || this.is_type(y, x + 1, 5)) {
    tile = 10;
  } else if (this.is_type(y - 1, x, 4) || this.is_type(y, x - 1, 4)) {
    tile = 11;
  }

  return tile;
};

/* Check arrays for values
	---------------------------------------- */

mapgen_blob.prototype.is_land_or_corner = function(y, x) {
  if (this.is_corner(y, x) || this.is_land(y, x)) {
    return true;
  }
};

mapgen_blob.prototype.is_corner = function(y, x) {
  return this.check_arr(this.tiles, y, x, [4, 5, 6, 7]);
};

mapgen_blob.prototype.is_type = function(y, x, type) {
  return this.check_arr(this.tiles, y, x, [type]);
};

mapgen_blob.prototype.is_land = function(y, x) {
  return this.check_arr(this.land, y, x, [1]);
};

mapgen_blob.prototype.check_arr = function(arr, y, x, checks) {
  if (y < 0 || y >= arr.length || x < 0 || x >= arr[0].length) {
    return false;
  }
  for (var i = 0; i < checks.length; i++) {
    if (arr[y][x] == checks[i]) {
      return true;
    }
  }
};

/* ========================================================================
	Map Generator
	Make Canvas
 ========================================================================== */

/* Set up a new canvas
	---------------------------------------- */

function mapgen_canvas(w, h) {
  var obj = {};
  if ("undefined" != typeof global) {
    obj.canv = new canvas();
  } else {
    obj.canv = document.createElement("canvas");
  }
  obj.cont = obj.canv.getContext("2d");
  obj.canv.width = w;
  obj.canv.height = h;
  obj.cont.fillStyle = "#fff";
  obj.w = w;
  obj.h = h;
  return obj;
}

/* Draw a pattern to a canvas
	---------------------------------------- */

function mapgen_pattern(alpha, pattern) {
  var canv = mapgen_canvas(alpha.width, alpha.height);
  if (typeof pattern !== "string") {
    pattern = canv.cont.createPattern(pattern, "repeat");
  }
  canv.cont.fillStyle = pattern;
  canv.cont.fillRect(0, 0, alpha.width, alpha.height);
  canv.cont.globalCompositeOperation = "destination-in";
  canv.cont.drawImage(alpha, 0, 0);
  canv.cont.globalCompositeOperation = "normal";

  return canv;
}

/* ========================================================================
	Map Generator
	------------
	Config:
	w           // width of map
	h           // height of map
	crust       // thickness of outer crust on land
	blobs       // initial blobs
	center_blob // size of center blob of land, 0 for none
	small_blobs // number of random small circles of land
	large_blobs // number of random large circles of land
	-----------
 ========================================================================== */

/* Server side only
	---------------------------------------- */

if ("undefined" != typeof global) {
  var fs = require("fs");
}

/* New Map Generation
	---------------------------------------- */

function mapgen(img, config, scheme, map_img) {
  this.size = 36;
  this.img = img;
  this.c = config;
  this.scheme = scheme;

  // choose type
  if (this.scheme.type == "random") {
    return this.draw_random();
  }
  if (this.scheme.type == "image") {
    return this.draw_image(map_img);
  }
}

/* Draw image
	---------------------------------------- */

mapgen.prototype.draw_image = function(map_img) {
  var fg = mapgen_canvas(
    map_img.width + this.scheme.gap * 2,
    map_img.height + this.scheme.gap * 2
  );
  fg.cont.drawImage(map_img, this.scheme.gap, this.scheme.gap);
  var bg = mapgen_pattern(fg.canv, this.img.dirt);
  return { fg: fg, bg: bg };
};

/* Draw random
	---------------------------------------- */

mapgen.prototype.draw_random = function() {
  // setup
  this.blobs = JSON.parse(JSON.stringify(this.scheme.blobs));
  this.bg = mapgen_canvas(this.scheme.w, this.scheme.h);
  this.fg = mapgen_canvas(this.scheme.w, this.scheme.h);

  // generate some random large circles
  for (var i = 0; i < this.scheme.large_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 4, 6);
  }

  // generate some random small circles
  for (var i = 0; i < this.scheme.small_blobs; i++) {
    this.blobs = this.get_circle(this.blobs, 1, 3);
  }

  // go through each blob
  for (var i = 0; i < this.blobs.length; i++) {
    var blob = this.blobs[i];

    // create the blobs
    var bg = new mapgen_blob(this.img, this.c, false, blob.r + 4, blob.type);
    var fg = new mapgen_blob(
      this.img,
      this.c,
      this.scheme.decorations,
      blob.r,
      blob.type
    );

    // combine the backgrounds
    var wh = fg.fg.canv.width;
    var new_bg = mapgen_canvas(wh, wh);
    new_bg.cont.drawImage(bg.fg.canv, wh * 0.1, wh * 0.1, wh * 0.8, wh * 0.8);
    new_bg.cont.globalCompositeOperation = "source-atop";
    new_bg.cont.fillStyle = "rgba(0,0,0,0.8)";
    new_bg.cont.fillRect(0, 0, wh, wh);
    new_bg.cont.globalCompositeOperation = "normal";
    new_bg.cont.drawImage(fg.bg.canv, 0, 0);

    // draw it to main canvas
    this.bg.cont.drawImage(new_bg.canv, blob.x - wh / 2, blob.y - wh / 2);
    this.fg.cont.drawImage(fg.fg.canv, blob.x - wh / 2, blob.y - wh / 2);
  }

  // return it
  return {
    bg: this.bg,
    fg: this.fg
  };
};

/* Get a far away circle
	---------------------------------------- */

mapgen.prototype.get_circle = function(arr, min_radius, max_radius) {
  // generate many circles and find furthest away
  var distance = 0;
  var circle = null;

  for (var i = 0; i < 20; i++) {
    // make new circle
    var test_circle = this.circle(min_radius, max_radius);
    var smallest_distance = 999999;

    // find shortest distance from all other circles
    for (var j = 0; j < arr.length; j++) {
      var dx = arr[j].x - test_circle.x;
      var dy = arr[j].y - test_circle.y;
      var test_distance = Math.round(
        Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))
      );
      smallest_distance =
        test_distance < smallest_distance ? test_distance : smallest_distance;
    }

    // if is the largest distance record this as furthest
    if (distance < smallest_distance) {
      distance = smallest_distance;
      circle = test_circle;
    }
  }

  // add furthest away circle to new array
  arr.push(circle);
  return arr;
};

/* Generate a random circle
	---------------------------------------- */

mapgen.prototype.circle = function(min_radius, max_radius) {
  var r = Math.floor(Math.random() * max_radius) + min_radius;
  var gap = (r + 2) * this.size + this.scheme.gap;
  var x = Math.floor(Math.random() * (this.scheme.w - gap * 2)) + gap;
  var y = Math.floor(Math.random() * (this.scheme.h - gap * 2)) + gap;
  return {
    r: r,
    x: x,
    y: y
  };
};

/* ========================================================================
	Map Gravity
 ========================================================================== */

/* Set up gravity
	----------------------------------------- */

core_map.prototype.init_gravity = function(gravity_map) {
  this.weight = this.scheme.gravity || 1;
  this.gravity_type = this.scheme.gravity_type || "land";

  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // set values
  this.gravity = {
    w: 0,
    h: 0,
    map: [],
    scale: 24,
    reach: 18
  };

  if (gravity_map) {
    this.gravity.map = JSON.parse(gravity_map);
    this.gravity.w = this.gravity.map[0].length;
    this.gravity.h = this.gravity.map.length;
  } else {
    this.init_gravity_map();
  }
};

/* Generate gravity map
	---------------------------------------- */

core_map.prototype.init_gravity_map = function() {
  // set size of new gravity grid
  this.gravity.w = ceil(this.w / this.gravity.scale);
  this.gravity.h = ceil(this.h / this.gravity.scale);

  // generate map array
  var new_arr = [];
  for (var y = 0; y < this.gravity.h; y++) {
    this.gravity.map[y] = [];
    for (var x = 0; x < this.gravity.w; x++) {
      this.gravity.map[y].push([0, 0, 0]);
    }
  }

  // do the calculating
  this.action_gravity_generate(0, 0, this.w, this.h);
};

/* Apply new gravity calculations to a set of pixels
	---------------------------------------- */

core_map.prototype.action_gravity_generate = function(x, y, w, h) {
  // calculate which tiles are affected
  var x1 = max(0, min(floor(x / this.gravity.scale), this.gravity.w));
  var y1 = max(0, min(floor(y / this.gravity.scale), this.gravity.h));
  var x2 = max(0, min(floor((x + w) / this.gravity.scale), this.gravity.w));
  var y2 = max(0, min(floor((y + h) / this.gravity.scale), this.gravity.h));

  // get the weight of all affected tiles
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      this.gravity.map[y3][x3][0] = this.get_tile_weight(x3, y3);
    }
  }

  // calculate surrounding tiles
  var x1 = max(0, min(x1 - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y1 - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x2 + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y2 + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var xy = this.get_tile_gravity(x3, y3);
      this.gravity.map[y3][x3][1] = xy.x;
      this.gravity.map[y3][x3][2] = xy.y;
    }
  }
};

/* Get weight of a tile in the gravity map
	---------------------------------------- */

core_map.prototype.get_tile_weight = function(x, y) {
  // limit x and y to within the area
  var y1 = max(0, min(y * this.gravity.scale, this.h));
  var x1 = max(0, min(x * this.gravity.scale, this.w));
  var y2 = max(0, min(y * this.gravity.scale + this.gravity.scale, this.h));
  var x2 = max(0, min(x * this.gravity.scale + this.gravity.scale, this.w));

  // go through the grid of pixels
  var c = 0;
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      var id = this.i(x3, y3);
      if (id == 1 || id == 2) {
        c += 1;
      }
      if (id == 3) {
        c += 3;
      }
    }
  }
  return c;
};

/* Get gravity of a tile from the weight of surrounding tiles
	---------------------------------------- */

core_map.prototype.get_tile_gravity = function(x, y) {
  // calculate surrounding tiles
  var wx = 0;
  var wy = 0;
  var x1 = max(0, min(x - this.gravity.reach, this.gravity.w));
  var y1 = max(0, min(y - this.gravity.reach, this.gravity.h));
  var x2 = max(0, min(x + this.gravity.reach, this.gravity.w));
  var y2 = max(0, min(y + this.gravity.reach, this.gravity.h));

  // go through surrounding tiles to get gravity
  for (var y3 = y1; y3 < y2; y3++) {
    for (var x3 = x1; x3 < x2; x3++) {
      wx += (x3 - x) * this.gravity.map[y3][x3][0];
      wy += (y3 - y) * this.gravity.map[y3][x3][0];
    }
  }

  wx = round(wx / 5000 / this.gravity.reach) / 60;
  wy = round(wy / 5000 / this.gravity.reach) / 60;

  return {
    x: wx,
    y: wy
  };
};

/* Reset gravity from destruction event
	---------------------------------------- */

core_map.prototype.gravity_event_recalculate = function(x, y, radius) {
  // if we are not using land gravity
  if (this.scheme.gravity_type !== "land") {
    return;
  }

  // recalculate gravity
  var x1 = round(x - radius);
  var y1 = round(y - radius);
  var size = round(radius * 2 + 1);
  this.action_gravity_generate(x1, y1, size, size);
};

/* Return gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity = function(x, y) {
  // flat
  if (this.scheme.gravity_type === "flat") {
    return { x: 0, y: this.weight };
  }

  // map
  if (this.scheme.gravity_type === "land") {
    var x1 = max(0, min(round(x / this.gravity.scale), this.gravity.w - 1));
    var y1 = max(0, min(round(y / this.gravity.scale), this.gravity.h - 1));
    var obj = this.gravity.map[y1][x1];
    return {
      x: min(obj[1], 1) * this.weight,
      y: min(obj[2], 1) * this.weight
    };
  }
};

/* Return the angle of gravity for co-ordinates
	---------------------------------------- */

core_map.prototype.get_gravity_angle = function(x, y) {
  var grav = this.get_gravity(x, y);
  var a1 = get_angle(grav.x, grav.y);
  return a1;
};

/* ========================================================================
	Map Ground Checkers
 ========================================================================== */

/* Get array of offsets to check in an angles direction
	---------------------------------------- */

core_map.prototype.get_angle_offsets = function(a) {
  if (a > 22 && a <= 67) {
    return [[-1, -1], [0, -1], [-1, 0], [1, -1], [-1, 1], [1, 0], [0, 1]];
  } // up left
  if (a > 67 && a <= 112) {
    return [[0, -1], [-1, -1], [1, -1], [-1, 0], [1, 0], [-1, 1], [1, 1]];
  } // up
  if (a > 112 && a <= 157) {
    return [[1, -1], [0, -1], [1, 0], [-1, -1], [1, 1], [-1, 0], [0, 1]];
  } // up right
  if (a > 157 && a <= 202) {
    return [[1, 0], [1, -1], [1, 1], [0, -1], [0, 1], [-1, -1], [-1, 1]];
  } // right
  if (a > 202 && a <= 247) {
    return [[1, 1], [1, 0], [0, 1], [1, -1], [-1, 1], [0, -1], [-1, 0]];
  } // down right
  if (a > 247 && a <= 292) {
    return [[0, 1], [-1, 1], [1, 1], [-1, 0], [1, 0], [-1, -1], [1, -1]];
  } // down
  if (a > 292 && a <= 337) {
    return [[-1, 1], [-1, 0], [0, 1], [-1, -1], [1, 1], [0, -1], [1, 0]];
  } // down left
  if (a > 337 || a <= 22) {
    return [[-1, 0], [-1, -1], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 1]];
  } // left
};

/* Calculate walk path by angle
	---------------------------------------- */

core_map.prototype.walk = function(x, y, px, py, angle, speed) {
  // get neighboring pixels
  var offsets = this.get_angle_offsets(angle);

  // record old position
  var ox = x;
  var oy = y;

  // record result
  var result = {
    move: false, // we are moving
    angle: 0, // actual angle of movement
    path: [] // recorded coordinates
  };

  // go through number of movements per frame
  for (var i = 0; i < speed; i++) {
    var moved = false;

    // go through directional pixels to check based on angle of path
    for (var j = 0; j < offsets.length; j++) {
      // co-ordinates we're checking
      var x1 = x + offsets[j][0];
      var y1 = y + offsets[j][1];

      // if is previous location, land or not an edge
      if ((x1 == px && y1 == py) || !this.ground_pixel(x1, y1)) {
        continue;
      }

      // set new position
      px = x;
      py = y;
      x = x1;
      y = y1;
      result.move = true;
      result.angle = get_heading(ox, oy, x, y);
      result.path.push({ x: x1, y: y1 });

      var moved = true;
      break;
    }

    // if movement failed
    if (!moved) {
      break;
    }
  }

  // set direction left or right
  result.direction = this.ground_dir(ox, oy, x, y);

  return result;
};

/* Check a pixel is next to ground
	---------------------------------------- */

core_map.prototype.ground_pixel = function(x, y) {
  // if we have hit ground
  if (this.i(x, y)) {
    return false;
  }

  var trigger = false,
    off = [
      [0, -1],
      [-1, 0],
      [1, 0],
      [0, 1],
      [-1, -1],
      [-1, 1],
      [1, 1],
      [1, -1]
    ];

  for (var i = 0; i < off.length; i++) {
    // go through offsets
    var x1 = x + off[i][0]; // new x coordinate
    var y1 = y + off[i][1]; // new y coordinate
    if (this.i(x1, y1)) {
      // if pixel is land
      trigger = true; // we did it
      break;
    }
  }

  return trigger;
};

/* Calculate left or right movement
	//
	// calculates direction of land from a line of movement
	// 1. rotate line coords 90 degrees
	// 2. if the top part of the new line has more land then we are moving right
	// 3. if the bottom part we are moving left
	// 4. bananas, all of it
	---------------------------------------- */

core_map.prototype.ground_dir = function(x1, y1, x2, y2) {
  // rotate co-ordinated 90 degrees to point into the ground we're on
  var center_x = x1 + (x2 - x1) / 2;
  var center_y = y1 + (y2 - y1) / 2;
  var rotated_1 = rotate_coords(x1, y1, center_x, center_y, 90);
  var rotated_2 = rotate_coords(x2, y2, center_x, center_y, 90);

  // plot a course of co-ordinates to check
  var speed_x = this.get_distance_x(rotated_1.x, rotated_2.x);
  var speed_y = this.get_distance_y(rotated_1.y, rotated_2.y);
  var plotted = plot_course(rotated_1.x, rotated_1.y, speed_x, speed_y, 8);
  if (!plotted.move) {
    return "right";
  }

  // go through course and count which side has more land on it
  var count_left = 0,
    count_right = 0;
  for (var i = 0; i < plotted.points.length; i++) {
    var point = plotted.points[i];
    if (this.i(round(point.x), round(point.y))) {
      if (i < plotted.points.length / 2) {
        count_right++;
      } else {
        count_left++;
      }
    }
  }
  return count_left > count_right ? "left" : "right";
};

/* Set values in a circle in the ground array
	---------------------------------------- */

core_map.prototype.set_circle = function(x, y, radius, type) {
  // get boundaries
  var x1 = max(round(x - radius), 0);
  var x2 = min(round(x + radius), this.w - 1);
  var y1 = max(round(y - radius), 0);
  var y2 = min(round(y + radius), this.h - 1);

  // loop through co-ordinates
  for (var ly = y1; ly <= y2; ly++) {
    for (var lx = x1; lx <= x2; lx++) {
      if (in_circle(lx, ly, x, y, radius)) {
        this.i_set(lx, ly, type);
      }
    }
  }
};

/* Set block of cells from arr
	---------------------------------------- */

core_map.prototype.set_block_from_arr = function(x, y, arr) {
  for (var ly = 0; ly < arr.length; ly++) {
    for (var lx = 0; lx < arr[ly].length; lx++) {
      this.i_set(x + lx, y + ly, arr[ly][lx]);
    }
  }
};

/* Get block of cells
	---------------------------------------- */

core_map.prototype.get_block = function(x, y, w, h) {
  var response = [];

  // loop through co-ordinates
  for (var ly = 0; ly < h; ly++) {
    response[ly] = [];
    for (var lx = 0; lx < w; lx++) {
      response[ly][lx] = this.i(lx + x, ly + y);
    }
  }

  return response;
};

/* Find nearby ground spot
	---------------------------------------- */

core_map.prototype.find_ground_nearby = function(x, y) {
  var x1 = round(x);
  var y1 = round(y);

  // already on ground
  if (this.ground_pixel(x1, y1)) {
    return { x: x1, y: y1 };
  }

  var spiral_1 = 0;
  var spiral_2 = 1;
  var inc = 1;
  var dir = true;

  for (var i = 0; i < 450; i++) {
    x1 += dir ? inc : 0;
    y1 += !dir ? inc : 0;
    spiral_1++;
    if (spiral_1 == spiral_2) {
      spiral_1 = 0;
      if ((dir = !dir)) {
        inc = inc == 1 ? -1 : 1;
        spiral_2++;
      }
    }

    // check point for ground pixels
    if (this.ground_pixel(x1, y1)) {
      return { x: x1, y: y1 };
    }
  }
  return false;
};

/* Get random empty spot
	---------------------------------------- */

core_map.prototype.air_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if air pixel
    if (id == 0) {
      return { x: x, y: y };
    }

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* Get random ground spot
	---------------------------------------- */

core_map.prototype.ground_find_spot = function() {
  var limit = 500;
  var n = 0;

  while (n < limit) {
    var x = rand(0, this.w),
      y = rand(0, this.h),
      id = this.i(x, y);

    // if not land pixel
    if (id !== 1 && id !== 2) {
      continue;
    }

    // plot course to random angle
    var angle = rand(0, 360);
    for (var i = 0; i < 100; i++) {}

    // count up
    n++;
  }

  // failed to find a spot
  return false;
};

/* ========================================================================
    Map
 ========================================================================== */

// create map object
function core_map(canv, scheme, gravity_map) {
  // Server side only
  if ("undefined" != typeof global) {
    var canvas = require("canvas");
  }

  this.scheme = scheme;

  // set dimensions
  this.w = canv.canv.width;
  this.h = canv.canv.height;

  // get pixels
  var pixels = canv.cont.getImageData(0, 0, this.w, this.h);
  var length = Math.floor(pixels.data.length / 4);

  // create 8 bit alpha array
  // 0. air
  // 1. destructible land
  // 2. indestructible land
  // 3. sun
  this.arr = new Int8Array(length);
  for (var i = 0; i < length; i++) {
    if (pixels.data[i * 4 + 3] > 30) {
      this.arr[i] = 1;
    }
  }

  // set up gravity
  this.init_gravity(gravity_map);
}

/* Get and set array co-ordinate values
	---------------------------------------- */

core_map.prototype.i_get = function(x, y) {
  var x2 = this.loop_x(x);
  var y2 = this.loop_y(y);
  return y2 * this.w + x2;
};

core_map.prototype.i = function(x, y) {
  var i = this.i_get(x, y);
  if (i == null) {
    return 0;
  } else {
    return this.arr[i];
  }
};

core_map.prototype.i_set = function(x, y, val) {
  var i = this.i_get(x, y);
  if (i) {
    this.arr[i] = val;
  }
};

/* Get distance between two points in looping area
	---------------------------------------- */

core_map.prototype.get_distance = function(x1, y1, x2, y2) {
  var x = this.get_distance_x(x1, x2);
  var y = this.get_distance_y(y1, y2);
  return get_speed(x, y);
};

core_map.prototype.get_distance_x = function(x1, x2) {
  return n_diff(x1, x2, 0, this.w);
};
core_map.prototype.get_distance_y = function(y1, y2) {
  return n_diff(y1, y2, 0, this.h);
};

/* Get heading between two points in looping area
	---------------------------------------- */

core_map.prototype.get_heading = function(x1, y1, x2, y2) {
  var x = n_diff(x1, x2, 0, this.w);
  var y = n_diff(y1, y2, 0, this.h);
  return get_angle(x, y);
};

/* Get looping co-ordinate
	---------------------------------------- */

core_map.prototype.loop_x = function(x) {
  return n_loop(x, 0, this.w - 1);
};

core_map.prototype.loop_y = function(y) {
  return n_loop(y, 0, this.h - 1);
};

/* ========================================================================
    App
 ========================================================================== */

const url = new URL(window.location);
const watch = !!url.searchParams.get("watch");

function app() {
  var self = this;
  this.assets_url = ASSETS;
  this.assets = {};
  this.started = false;
  this.watch = watch;
  this.nickname = "the watcher";

  this.sockets = new SocketConnection(function(event) {
    self.run_event(event);
  });
  this.init_interface();

  this.input = new input(function(event) {
    self.run_event(event);
  });
  this.audio = new audio();

  this.init_settings();

  if (this.watch || singlePlayer) {
    this.load_room();
  } else {
    this.init_start();
  }
}

/* Load room
    ---------------------------------------- */

app.prototype.load_room = function() {
  if (this.start) {
    hide(this.start);
  }
  show(this.loading);

  // load assets
  var self = this;
  new loader(
    this.assets_url,
    {
      img: {
        sprites: "/images/sprites/sprites.png",
        bg: "/images/textures/space.jpg"
      },
      audio: {
        bleep1: "/audio/bleep1.mp3",
        bloop1: "/audio/bloop1.mp3",
        bloop2: "/audio/bloop2.mp3",
        bing: "/audio/bing.mp3",
        dig: "/audio/dig.mp3",
        doink: "/audio/doink.mp3",
        donk: "/audio/donk.mp3",
        explosion: "/audio/explosion.mp3",
        explosion_gas: "/audio/explosion_gas.mp3",
        explosion_laser: "/audio/explosion_laser.mp3",
        homing: "/audio/homing.mp3",
        fly: "/audio/fly.mp3",
        countdown: "/audio/countdown.mp3",
        jump: "/audio/jump.mp3",
        levelup: "/audio/levelup.mp3",
        locknload: "/audio/locknload.mp3",
        phase: "/audio/phase.mp3",
        pop: "/audio/pop.mp3",
        punch: "/audio/punch.mp3",
        shoot: "/audio/shoot.mp3",
        shoot_laser: "/audio/shoot_laser.mp3",
        throw: "/audio/throw.mp3",
        spooky: "/audio/spooky.mp3",
        walk: "/audio/walk.mp3"
      }
    },
    function(assets) {
      self.init_room(assets);
    }
  );
};

/* Start the app
    ---------------------------------------- */

app.prototype.init_room = function(assets) {
  hide(this.loading);

  this.started = true;
  this.assets = assets;
  this.audio.add_buffers(assets.audio);

  if (singlePlayer) {
    this.room = new demo(
      this.assets,
      this.assets_url,
      this.audio,
      this.input,
      "Demo name"
    );
  } else {
    this.room = new multiplayer(
      this.assets,
      this.assets_url,
      this.audio,
      this.input,
      this.nickname,
      this.watch,
      this.run_event,
      this.sockets,
      new onboarding()
    );
    if (this.watch) {
      this.sockets.message_send("watcher", []);
    } else {
      this.nickname = this.check_name(this.nickname);
      this.sockets.message_send("send_name", [this.nickname]);
    }
  }
  append(this.div, this.room.div);
};

window.onload = function() {
  new app();
};

/* ========================================================================
    App
    Events
 ========================================================================== */

/* Events
    ---------------------------------------- */

app.prototype.run_event = function(event) {
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // show and hide menu
  if (event.type == "show_menu") {
    show(this.menu);
  } else if (event.type == "hide_menu") {
    hide(this.menu);

    // if game is full
  } else if (event.type === "full") {
    hide(this.loading);
    show(this.game_full);
    if (this.room && this.room.connecting) {
      hide(this.room.connecting);
    }

    // show the controls screen
  } else if (event.type == "show_settings") {
    this.toggle_settings_screen();

    // send event down a level
  } else {
    if (this.room) {
      this.room.run_event(event);
    }
  }
};

/* ========================================================================
    App Interface
 ========================================================================== */

app.prototype.init_interface = function() {
  this.div = element({ id: "projectants", class: "app" });
  append(document.body, this.div);

  // game full
  this.game_full = element({
    class: "cont_center",
    text: "Oh dear, this room is very full!<br><br><br></div>"
  });
  this.button_new_game = element({
    type: "button",
    class: "button red",
    text: "Find A New One"
  });
  append(this.div, this.game_full);
  append(this.game_full, this.button_new_game);
  hide(this.game_full);

  // find new room
  this.button_new_game.onclick = function() {
    window.location = "/";
  };

  // limit game aspect ratio
  var ratio = this.div.offsetWidth / this.div.offsetHeight;
  this.div.style.width =
    ratio > 1.8
      ? round(this.div.offsetHeight * 1.8) + "px"
      : this.div.offsetWidth + "px";
  this.div.style.height =
    ratio < 1 ? this.div.offsetWidth + "px" : this.div.offsetHeight + "px";

  // loading
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);
};

/* ========================================================================
    App
    Settings
 ========================================================================== */

/* Start settings screen
    ---------------------------------------- */

app.prototype.init_settings = function() {
  var self = this;

  // corner button
  this.icon_settings = element({ class: "settings" });
  this.icon_settings_img = element({
    type: "img",
    src: this.assets_url + "/images/cog.png"
  });
  append(this.div, this.icon_settings);
  append(this.icon_settings, this.icon_settings_img);

  this.settings_visible = false;
  this.icon_settings_img.onclick = function() {
    self.toggle_settings_screen();
  };

  this.icon_settings_fullscreen = element({
    type: "img",
    src: this.assets_url + "/images/fullscreen.png"
  });
  append(this.icon_settings, this.icon_settings_fullscreen);
  this.icon_settings_fullscreen.onclick = function() {
    document.body.requestFullscreen();
  };




  // box
  this.div_settings = element({ class: "full full_bg" });
  this.div_settings_cont = element({
    class: "cont_center div_controls",
    text: "<div class='top_message'>Settings</div>"
  });
  append(this.div, this.div_settings);
  append(this.div_settings, this.div_settings_cont);
  hide(this.div_settings);

  // volume
  this.div_volume = element({ text: "<h2>Volume</h2>" });
  this.input_volume = element({ type: "input" });
  this.input_volume.type = "range";
  this.input_volume.setAttribute("min", 0);
  this.input_volume.setAttribute("max", 1);
  this.input_volume.setAttribute("step", 0.1);
  this.input_volume.value = this.audio.volume;
  append(this.div_settings_cont, this.div_volume);
  append(this.div_volume, this.input_volume);

  this.input_volume.onchange = function(e) {
    self.audio.set_global_volume(this.value);
  };

  // controls
  var ctext = "<h2>Controls (Mouse + Keyboard)</h2>";
  ctext += "<dl>";
  ctext += "<dt>Move</dt><dd>Left Click</dd>";
  ctext += "<dt>Jump</dt><dd>Spacebar</dd>";
  ctext += "<dt>Shoot</dt><dd>Right Click / Alt + Left Click</dd>";
  ctext += "<dt>Select Weapon</dt><dd>1-9 / Scroll Wheel</dd>";
  ctext += "<dt>Follow Weapons</dt><dd>F</dd>";
  ctext += "<dt>Free Cam</dt><dd>Middle Click</dd>";
  ctext += "</dl>";
  ctext += "<h2>Controls (Touchscreen)</h2>";
  ctext += "<dl>";
  ctext += "<dt>Move</dt><dd>Tap</dd>";
  ctext += "<dt>Shoot</dt><dd>Double Tap</dd>";
  ctext += "<dt>Jump</dt><dd>Two finger tap</dd>";
  ctext += "</dl>";

  this.div_controls = element({ text: ctext });
  append(this.div_settings_cont, this.div_controls);

  // close button
  this.div_settings_buttons = element({ class: "buttons" });
  this.button_close_settings = element({ type: "button", text: "Close" });
  append(this.div_settings_cont, this.div_settings_buttons);
  append(this.div_settings_buttons, this.button_close_settings);

  this.button_close_settings.onclick = function() {
    self.settings_visible = false;
    hide(self.div_settings);
  };
};

app.prototype.toggle_settings_screen = function() {
  if ((this.settings_visible = !this.settings_visible)) {
    this.audio.play("bleep1", 0.8);
    show(this.div_settings);
  } else {
    hide(this.div_settings);
  }
};

/* ========================================================================
    App
    Start Screen
 ========================================================================== */

app.prototype.init_start = function() {
  var self = this;

  // get a new or stored nickname
  this.nickname = config.names[rand(0, config.names.length - 1)];
  if (typeof Storage !== "undefined") {
    var lsname = localStorage.getItem("pants_nn");
    if (config.names.indexOf(lsname) === -1) {
      this.nickname = lsname || this.nickname;
    }
  }

  this.start = element({ class: "start" });
  var logo = element({
    type: "img",
    class: "logo",
    src: this.assets_url + "/images/logo.png"
  });
  var instructions = element({
    type: "ul",
    class: "fade",
    text:
      "<li>Collect gems to get stronger</li><li>Destroy the enemy to get their gems!</li><li>Click to Move</li><li>Alt + Click or Right Click to Shoot</li>"
  });
  this.input_name = element({
    type: "input",
    intype: "text",
    value: this.nickname,
    maxlength: 20
  });
  this.button_start = element({
    type: "button",
    class: "break",
    text: "Play Now"
  });

  append(this.div, this.start);
  append(this.start, logo);
  append(this.start, instructions);
  append(this.start, this.input_name);
  append(this.start, this.button_start);

  // start up the app
  this.button_start.onclick = function() {
    self.load_room();
  };
};

/* Check name
    ---------------------------------------- */

app.prototype.check_name = function() {
  var new_name = this.nickname;
  if (this.input_name) {
    new_name = this.input_name.value;
  }
  new_name = new_name.length > 20 ? new_name.substring(0, 20) : new_name;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_nn", new_name);
  }
  return new_name;
};

/* ========================================================================
    Missions
 ========================================================================== */

function demo(assets, assets_url, audio, input, name) {
  // setup
  this.assets = assets;
  this.assets_url = assets_url;
  this.audio = audio;
  this.input = input;
  this.name = name;
  this.active = false;
  this.player_id = 0;
  this.players_ref = {
    "0": {
      user_id: 0,
      name: name,
      level: 0
    }
  };
  this.scheme = deepmerge(schemes.default, schemes.deathmatch);
  this.div = element({ class: "full" });

  var self = this;
  new loader(
    this.assets_url,
    {
      img: {
        edge: "/images/sprites/edge.png",
        decorations: "/images/sprites/decorations.png",
        dirt: "/images/textures/dirt.png",
        rock: "/images/textures/rock.png"
      }
    },
    function(assets) {
      self.loaded(assets.img);
    }
  );
}

/* Start demo
---------------------------------------- */

demo.prototype.loaded = function(img) {
  // get the map
  this.map = new mapgen(img, config.mapgen, this.scheme.mapgen);
  this.map.fg.cont.globalCompositeOperation = "destination-out";

  // start up game object
  this.game = new game(
    this.assets,
    this.audio,
    this.input,
    this.scheme,
    this.map,
    this.players_ref,
    this.player_id
  );
  append(this.div, this.game.div);

  this.game.core.create_player({ id: this.player_id });
  this.game.core.create_object({ type: "player", player_id: this.player_id });
  this.game.core.init_player(this.player_id);

  this.game.start(0);
  this.game.player.armoury = duplicate_obj(
    this.game.core.state.players[this.player_id].armoury
  );
  this.game.set_armoury();

  this.loop_start();
};

/* ========================================================================
    Multiplayer
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

demo.prototype.run_event = function(event) {
  if (!event) {
    return;
  }

  // handle arrays of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // run events
  if (event.type === "player_death") {
    this.event_player_death(event);
  }

  // send event down a level
  else if (this.game) {
    this.game.run_event(event);
  }
};

/* Player death
  ---------------------------------------- */

demo.prototype.event_player_death = function(event) {
  if (this.initialised) {
    console.log("died");
  }
};

/* ========================================================================
    Mulitplayer
    Frames
 ========================================================================== */

/* Start/stop loop
    ---------------------------------------- */

demo.prototype.loop_start = function(start_frame) {
  // close any open loops
  this.loop_stop();

  // set loop vars
  this.start_frame = start_frame || 0;
  this.frames = this.start_frame;
  this.start_time = new Date().getTime();
  this.drop_positions = {};

  var self = this;
  this.interval = setInterval(function() {
    self.frame();
  }, 24);
};

demo.prototype.loop_stop = function() {
  clearInterval(this.interval);
};

/* Frame process
---------------------------------------- */

demo.prototype.frame = function() {
  this.frames++;

  // do drops
  var counts = this.object_counts();
  for (var type in this.scheme.drops) {
    var time = this.scheme.drops[type].time;
    if (time < 1 || counts[type] >= this.scheme.drops[type].max) {
      continue;
    }
    if (this.frames % time === 0) {
      var props = { type: type };
      var obj = this.game.core.spawn(props);
      this.game.create_object(obj);
    }
  }

  // check for level ups
  for (var id in this.players_ref) {
    var player = this.players_ref[id];
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    if (player.level !== core_player.level) {
      this.run_event({
        type: "player_level",
        id: parseInt(id),
        prev: player.level,
        new: core_player.level
      });
      this.players_ref[id].level = core_player.level;
    }
  }

  var action = this.game.player && this.game.get_input();
  this.game.frame_core(this.frames, action);
  this.run_event(this.game.core.state.events);
  this.game.frame_display();
};

/* Object counts
    ---------------------------------------- */

demo.prototype.object_counts = function() {
  var counts = {};
  for (var key in this.game.core.state.objects) {
    var obj = this.game.core.state.objects[key];
    if (!counts[obj.type]) {
      counts[obj.type] = 0;
    }
    counts[obj.type]++;
  }
  return counts;
};

/* ========================================================================
    Game
    Alert Messages
 ========================================================================== */

/* Set up alert div
    ---------------------------------------- */

game.prototype.init_alert = function() {
  this.div_alert = element({ class: "alert" });
  append(this.div, this.div_alert);
  this.alert_text = "";
  this.alert_count = 0;
};

/* Set alert
    ---------------------------------------- */

game.prototype.set_alert = function(text, col, count) {
  this.alert_count = count || 60;
  this.div_alert.className = "alert";
  this.div_alert.innerHTML = text;
  if (col) {
    add_class(this.div_alert, col);
  }
  show(this.div_alert);
};

/* Run alert
    ---------------------------------------- */

game.prototype.run_alert = function() {
  // do countdowns
  if (this.alert_count > 0) {
    this.alert_count--;
    if (this.alert_count == 0) {
      this.div_alert.innerHTML = "";
      hide(this.div_alert);
    }
  }
};

/* ========================================================================
    Game
    Armoury
 ========================================================================== */

/* Build armoury interface
    ---------------------------------------- */

game.prototype.init_armoury = function() {
  // selected weapon
  this.current_weapon = "";

  // detonation cooldown
  this.detonation_cooldown = 0;

  // create divs
  this.armoury = {
    div: element({ class: "armoury box" }),
    title: element({ class: "title" }),
    player: element({ class: "player_weapon hex-button" }),
    weapons: {},
    show_icon: false,
    show_icon_frame: null
  };
  append(this.div, this.armoury.div);
  append(this.div, this.armoury.player);
  hide(this.armoury.player);

  // go through armoury layout
  var self = this;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var type = this.scheme.armoury[i];

    // create elements
    this.armoury.weapons[type] = {
      box: element({ class: "hex-button weapon", data: type }),
      sprite: element({ class: "sprite" }),
      count: element({ class: "count" }),
      player_icon: element({ class: "icon sprite" }),
      i: i,
      active: false
    };
    append(this.armoury.div, this.armoury.weapons[type].box);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].sprite);
    append(this.armoury.weapons[type].box, this.armoury.weapons[type].count);
    append(this.armoury.player, this.armoury.weapons[type].player_icon);
    hide(this.armoury.weapons[type].player_icon);

    // set sprite background position
    var weapon = this.c.weapons[type];
    var sprite = this.c.sprites[weapon.armoury_sprite];
    if (!sprite) {
      continue;
    }
    var offset = ceil((sprite.size - 48) / 2);
    var x = -sprite.x - offset;
    var y = -sprite.y - offset;
    var pos = x - 1 + "px " + y + "px, 0 0";
    this.armoury.weapons[type].sprite.style.backgroundPosition = pos;
    this.armoury.weapons[type].player_icon.style.backgroundPosition = pos;

    // set element events
    this.armoury.weapons[type].box.onclick = function() {
      self.weapon_select(this.dataset.data);
    };
  }

  append(this.armoury.div, this.armoury.title);
  hide(this.armoury.div);
};

/* Initialise armoury with core data
	---------------------------------------- */

game.prototype.set_armoury = function() {
  // set display for all weapons
  for (type in this.armoury.weapons) {
    this.set_weapon(type);
  }

  // select weapon
  if (
    !this.current_weapon ||
    !this.armoury.weapons[this.current_weapon].active
  ) {
    this.weapon_select_n(0);
  }
};

/* Select weapon
	---------------------------------------- */

game.prototype.weapon_select = function(type, no_highlight) {
  // if same weapon or none left
  if (
    !this.player ||
    this.current_weapon === type ||
    this.player.armoury[type] === 0
  ) {
    return;
  }

  // do the change
  for (var key in this.armoury.weapons) {
    remove_class(this.armoury.weapons[key].box, "selected");
    hide(this.armoury.weapons[key].player_icon);
  }
  add_class(this.armoury.weapons[type].box, "selected");
  this.current_weapon = type;
  this.armoury.title.innerHTML = this.c.weapons[type].title;

  // auto following weapon
  var wep = this.c.weapons[type];
  if (
    (wep.auto_follow && !this.weapon_follow) ||
    (!wep.auto_follow && this.weapon_follow)
  ) {
    this.toggle_weapon_follow();
  }

  if (!no_highlight) {
    // play noise
    this.audio.play("bleep1", 0.8);

    // show icon
    this.armoury.show_icon = true;
    this.armoury.show_icon_frame = this.core.state.frame;
    show(this.armoury.weapons[type].player_icon);
    show(this.armoury.player);
  }

  return type;
};

/* Select weapon by position in armoury
	---------------------------------------- */

game.prototype.weapon_select_n = function(n) {
  // if is too big
  if (n >= this.scheme.armoury.length) {
    return;
  }

  // go through columns
  var n2 = 0;
  for (var i = 0; i < this.scheme.armoury.length; i++) {
    var weapon = this.scheme.armoury[i];
    var active = false;
    if (this.armoury.weapons[weapon].active) {
      active = true;
      if (n2 === n && weapon !== this.current_weapon) {
        return this.weapon_select(weapon);
      }
    }

    // increase count of actual columns
    n2 = active ? n2 + 1 : n2;
  }

  return false;
};

/* Select weapon by scrolling
	---------------------------------------- */

game.prototype.weapon_scroll = function(down) {
  // if we don't have a selected weapon
  var current = this.armoury.weapons[this.current_weapon];
  if (!current) {
    return;
  }

  for (var i = 1; i < this.scheme.armoury.length; i++) {
    var i_down = down ? this.scheme.armoury.length - i : i;
    var new_i = n_loop(current.i + i_down, -1, this.scheme.armoury.length - 1);
    var weapon = this.scheme.armoury[new_i];
    if (this.armoury.weapons[weapon].active) {
      this.weapon_select(weapon);
      return weapon;
    }
  }
};

/* Change to weapon
	---------------------------------------- */

game.prototype.set_weapon = function(type) {
  if (!this.player) {
    return;
  }

  var count = this.player.armoury[type];
  this.armoury.weapons[type].count.innerHTML = count;

  if (count == -1) {
    this.armoury.weapons[type].active = true;
    show(this.armoury.weapons[type].box);
    hide(this.armoury.weapons[type].count);
  } else {
    if (count < 1) {
      this.armoury.weapons[type].active = false;
      hide(this.armoury.weapons[type].box);
      if (type == this.current_weapon) {
        this.weapon_select_n(0);
      }
    } else {
      this.armoury.weapons[type].active = true;
      show(this.armoury.weapons[type].box);
    }
  }

  if (!this.current_weapon) {
    this.weapon_select_n(0);
  }
  this.display_armoury();
};

/* Show armoury or not
	---------------------------------------- */

game.prototype.display_armoury = function() {
  var show_it = false;
  var even = false;
  if (this.player) {
    for (key in this.player.armoury) {
      if (this.player.armoury[key] > 0 || this.player.armoury[key] == -1) {
        show_it = true;
        even = !even;
      }
      this.armoury.weapons[key].box.style.marginTop = even ? "26px" : "0px";
    }
  }
  if (show_it) {
    show(this.armoury.div);
  } else {
    hide(this.armoury.div);
  }
};

/* Run every frame
	---------------------------------------- */

game.prototype.run_armoury = function() {
  // turn off icon
  if (
    this.armoury.show_icon &&
    this.core.state.frame > this.armoury.show_icon_frame + 30
  ) {
    this.armoury.show_icon = false;
    hide(this.armoury.player);
  }
};

/* ========================================================================
    Game
    Audio
 ========================================================================== */

/* Set up audio objects
    ---------------------------------------- */

game.prototype.init_audio = function() {
  // objects with repeating sounds
  this.audio_objs = {};

  // weapon loops
  this.audio_weapons = {};

  // set up power up sound
  this.power_up_audio_on = false;
};

/* Check all game objects with audio objects
    ---------------------------------------- */

game.prototype.run_audio = function() {
  // remove old audio objects
  for (key in this.audio_objs) {
    if (!this.core.state.objects[key]) {
      if (this.audio_objs[key]) {
        this.audio_objs[key].gain.disconnect();
        this.audio_objs[key] = null;
      }
    }
  }

  // objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];

    // what noise should be playing
    var audio_key = null;
    if (obj.grounded && obj.animate && obj.actioned) {
      audio_key = obj.c.audio.walk;
    } else {
      audio_key = obj.c.audio.air;
    }

    var volume = this.get_dist_volume(obj.x, obj.y);
    var audio_obj = this.audio_objs[key];

    // if there is an audio file playing
    if (audio_obj) {
      // change its volume
      this.audio.set_volume(audio_obj, volume);

      // disconnect it
      if (volume <= 0 || audio_obj.audio_key != audio_key || !audio_key) {
        audio_obj.gain.disconnect();
        this.audio_objs[key] = null;
      }

      // if there is not an audio file playing
    } else {
      if (audio_key) {
        this.audio_objs[key] = this.audio.play(audio_key, volume, true);
      }
    }
  }
};

/* Set a weapon shot sound effect
    ---------------------------------------- */

game.prototype.play_weapon_audio = function(props) {
  var weapon = this.c.weapons[props.weapon];
  if (!weapon) {
    return;
  }
  if (!this.audio.buffers[weapon.fire_audio]) {
    return;
  }

  // get volume
  var volume = this.get_dist_volume(props.x, props.y);
  this.audio.play(weapon.fire_audio, volume);
};

/* Get distance volume
    ---------------------------------------- */

game.prototype.get_dist_volume = function(x, y) {
  var distance = this.core.map.get_distance(x, y, this.camera.x, this.camera.y);
  var volume = (1200 - distance) / 1200;
  volume *= volume;
  return volume;
};

/* ========================================================================
    Game
    Crosshair
 ========================================================================== */

/* Set up crosshair
	---------------------------------------- */

game.prototype.init_crosshair = function() {
  this.crosshair = 0;
  this.crosshair_source = "button";
};

/* Calculate crosshair from cursor position
	---------------------------------------- */

game.prototype.run_crosshair = function() {
  if (!this.player || this.player.dead || !this.player_obj) {
    return;
  }
  var obj = this.core.state.objects[this.player_obj.key];
  if (!obj) {
    return;
  }

  this.crosshair = this.core.map.get_heading(
    obj.x,
    obj.y,
    this.cursor.x,
    this.cursor.y
  );

  // // calculate from cursor
  // if (this.crosshair_source == "cursor") {
  // 	this.crosshair = this.core.map.get_heading(obj.x, obj.y, this.cursor.x, this.cursor.y);

  // // calculate from buttons
  // } else
  // if (this.crosshair_source == "button") {

  // 	// calculate angle of crosshair
  // 	var angle = -1;
  // 	if (this.input.actions.move_up) {
  // 		angle = 90;
  // 		if (this.input.actions.move_right) { angle = 135; }
  // 		if (this.input.actions.move_left) { angle = 45; }
  // 	} else
  // 	if (this.input.actions.move_down) {
  // 		angle = 270;
  // 		if (this.input.actions.move_right) { angle = 225; }
  // 		if (this.input.actions.move_left) { angle = 305; }
  // 	} else {
  // 		if (this.input.actions.move_right) { angle = 180; }
  // 		if (this.input.actions.move_left) { angle = 0; }
  // 	}
  // 	if (angle !== -1) {
  // 		this.crosshair = increment_angle(this.crosshair, angle, 4);
  // 	}
  // }
};

/* ========================================================================
    Game
    Decorations
 ========================================================================== */

/* Create decoration
    ---------------------------------------- */

game.prototype.create_decoration = function(props) {
  var obj = {
    frame: this.core.state.frame,
    type: "",
    id: "",
    x: 0,
    y: 0,
    speed_x: 0,
    speed_y: 0,
    timeout: 0,
    angle: 0,
    repeat: true,
    sprite: ""
  };
  obj = deepmerge(obj, props);
  obj.key =
    obj.frame + "-" + obj.x + "-" + obj.y + "-" + obj.sprite + "-" + obj.id;
  this.decorations[obj.key] = obj;
};

/* Run decorations
    ---------------------------------------- */

game.prototype.run_decorations = function() {
  // create trails from objects
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.trails.count === 0) {
      continue;
    }
    this.create_trail(obj, obj.c.trails);
  }

  // go through all decorations
  for (var key in this.decorations) {
    var dec = this.decorations[key];

    // do timeout
    dec.timeout--;
    if (dec.timeout < 1) {
      delete this.decorations[key];
      continue;
    }

    // move
    dec.x = this.core.map.loop_x(dec.x + dec.speed_x).fixed();
    dec.y = this.core.map.loop_y(dec.y + dec.speed_y).fixed();
  }
};

/* Create trails
	---------------------------------------- */

game.prototype.create_trail = function(obj, trails) {
  // create the trails
  for (var i = 0; i < trails.count; i++) {
    var args = {
      id: i,
      sprite: trails.sprite,
      timeout: trails.timeout,
      x: obj.dx,
      y: obj.dy
    };
    if (trails.rotate) {
      args.angle = rand(0, 360);
    } else {
      args.angle = angle_add(get_angle(-obj.speed_x, -obj.speed_y), 90);
      args.x -= obj.speed_x;
      args.y -= obj.speed_y;
      if (trails.offset_x || trails.offset_y) {
        var xyx = xy_speed(angle_add(args.angle, 90), trails.offset_x);
        var xyy = xy_speed(angle_add(args.angle, 180), trails.offset_y);
        args.x += xyx.x + xyy.x;
        args.y += xyx.y + xyy.y;
      }
    }
    if (trails.move) {
      var move_angle = rand(0, 360);
      var xy = xy_speed(move_angle, trails.speed);
      args.speed_x = -xy.x;
      args.speed_y = -xy.y;
    }
    this.create_decoration(args);
  }
};

/* ========================================================================
    Game
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

game.prototype.run_events = function(events) {
  // events from scheme
  var f_event = this.scheme.events.frame[this.core.current_frame];
  if (f_event) {
    this.run_event(f_event);
  }
};

game.prototype.run_event = function(event) {
  // handle array of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
  }

  // run event
  if (event.type === "weapon_select") {
    this.weapon_select_n(event.n);
  } else if (event.type === "weapon_scroll") {
    this.weapon_scroll(event.down);
  } else if (event.type === "switch_watcher_camera") {
    this.switch_watcher_camera();
  } else if (event.type === "follow_weapon") {
    this.toggle_weapon_follow(true);
  } else if (event.type === "follow_mouse") {
    this.toggle_mouse_follow();
  } else if (event.type === "ground_damage") {
    this.run_event_ground_damage(event);
  } else if (event.type === "screen_shake") {
    this.run_event_screen_shake(event);
  } else if (event.type === "player_health") {
    this.run_event_player_health(event);
  } else if (event.type === "player_level") {
    this.run_event_player_level(event);
  } else if (event.type === "explosion") {
    this.run_event_explosion(event);
  } else if (event.type === "armoury") {
    this.run_event_armoury(event);
  } else if (event.type === "bounce") {
    this.run_event_bounce(event);
  } else if (event.type === "sound") {
    this.run_event_sound(event);
  } else if (event.type === "target") {
    this.run_event_target(event);
  } else if (event.type === "spawn") {
    this.run_event_spawn(event);
  } else if (event.type === "focus") {
    this.run_event_focus(event);
  } else if (event.type === "alert") {
    this.run_event_alert(event);
  } else if (event.type === "collect") {
    this.run_event_collect(event);
  }
};

/* Ground Damage
    ---------------------------------------- */

game.prototype.run_event_ground_damage = function(event) {
  // are we destroying land
  if (!this.scheme.destroy_land) {
    return;
  }

  // damage the ground
  this.core.map.set_circle(event.x, event.y, event.radius, 0);
  this.destroy_land(event.x, event.y, event.radius);
  // this.core.map.gravity_event_recalculate(event.x, event.y, event.radius);

  // do the dig noise and smoke trails
  if (event.dig) {
    this.run_event_sound({ x: event.x, y: event.y, sound: "dig" });
    this.create_trail(
      { dx: event.x, dy: event.y },
      {
        count: 7,
        sprite: "smoke",
        timeout: 20,
        rotate: true,
        move: true,
        speed: 1
      }
    );
  }
};

/* Screen Shake
    ---------------------------------------- */

game.prototype.run_event_screen_shake = function(event) {
  var distance = this.core.map.get_distance(
    event.x,
    event.y,
    this.camera.x,
    this.camera.y
  );
  if (distance < event.radius * 2) {
    this.camera.shake_frame = this.core.state.frame;
    this.camera.shake_size = (distance - event.radius) / 4;
  }
};

/* Health
    ---------------------------------------- */

game.prototype.run_event_player_health = function(event) {
  var obj = this.core.state.objects["player-" + event.id];
  if (obj) {
    var text = String.fromCharCode(9829) + " " + event.health;
    this.create_message(obj, "#ff9999", text, 22);
  }
};

/* Level
    ---------------------------------------- */

game.prototype.run_event_player_level = function(event) {
  var obj = this.core.state.objects["player-" + event.id];

  // is this us
  if (this.player_id === event.id) {
    this.set_score();

    // set alert
    if (event.new > event.prev) {
      var lv = this.scheme.levels;
      var n1 = event.new;
      var n2 = event.prev;
      var benefits = "";
      if (lv.health[n1] > lv.health[n2]) {
        benefits += "<br>+" + (lv.health[n1] - lv.health[n2]) + " max health";
      }
      if (lv.damage[n1] > lv.damage[n2]) {
        benefits += "<br>+" + (lv.damage[n1] - lv.damage[n2]) + " damage";
      }
      if (lv.speed[n1] > lv.speed[n2]) {
        benefits += "<br>+" + (lv.speed[n1] - lv.speed[n2]) + " speed";
      }
      if (lv.jump[n1] > lv.jump[n2]) {
        benefits += "<br>+" + (lv.jump[n1] - lv.jump[n2]) + " jump power";
      }
      var text =
        "<small>You have reached</small><br><span class='large'>Level " +
        (event.new + 1) +
        "</span><small class='blue'>" +
        benefits +
        "</small>";
      this.set_alert(text, "#eeeeee", 150);
    }
  }

  // do the flourish
  if (event.new > event.prev) {
    this.create_message(obj, "#eee", "lvl " + (event.new + 1), 30, -30);
    this.run_event_sound({ x: obj.x, y: obj.y, sound: "levelup" });
    this.create_trail(obj, {
      count: 7,
      sprite: "star-blue",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 1.5
    });
    this.create_trail(obj, {
      count: 7,
      sprite: "ball-red",
      timeout: 30,
      rotate: true,
      move: true,
      speed: 2
    });
  }
};

/* Explosion
    ---------------------------------------- */

game.prototype.run_event_explosion = function(event) {
  // focus camera if we were following it
  if (this.weapon_following === event.key) {
    this.camera.focus = this.core.state.frame;
    this.camera.focus_time = 30;
    this.camera.fx = event.x;
    this.camera.fy = event.y;
  }
};

/* Armoury
    ---------------------------------------- */

game.prototype.run_event_armoury = function(event) {
  if (event.player_id == this.player_id) {
    this.set_weapon(event.weapon);
  }
};

/* Bounce
    ---------------------------------------- */

game.prototype.run_event_bounce = function(event) {
  var obj = this.core.state.objects[event.obj];
  if (!obj) {
    return;
  }
  var sound = obj.c.audio.bounce;
  if (sound) {
    this.run_event_sound({ x: event.x, y: event.y, sound: sound });
  }
};

/* Sound
    ---------------------------------------- */

game.prototype.run_event_sound = function(event) {
  var volume = this.get_dist_volume(event.x, event.y);
  if (volume > 0) {
    this.audio.play(event.sound, volume);
  }
};

/* Set a target on the map
    ---------------------------------------- */

game.prototype.run_event_target = function(event) {
  this.create_decoration({
    sprite: "focus",
    timeout: event.time,
    x: event.x,
    y: event.y,
    repeat: false
  });
  this.audio.play("homing", 1);
};

/* Spawn Objects
    ---------------------------------------- */

game.prototype.run_event_spawn = function(event) {
  this.create_object(event.args, true);

  event.args.time = 30;
  if (event.target) {
    this.run_event_target(event.args);
  }
  if (event.focus) {
    this.run_event_focus(event.args);
  }
};

/* Focus Camera
    ---------------------------------------- */

game.prototype.run_event_focus = function(event) {
  this.camera.focus = this.core.state.frame;
  this.camera.focus_time = event.time;
  this.camera.fx = event.x;
  this.camera.fy = event.y;
  if (event.target) {
    this.run_event_target(event);
  }
};

/* Show alert
    ---------------------------------------- */

game.prototype.run_event_alert = function(event) {
  this.set_alert(event.text, "#eeeeee", event.time);
};

/* Crate Grab
    ---------------------------------------- */

game.prototype.run_event_collect = function(event) {
  // is this not us
  if (event.player_id !== this.player_id) {
    return;
  }

  // get our object
  var obj = this.core.state.objects["player-" + event.player_id];
  if (!obj) {
    return;
  }

  // crates
  if (event.collected === "crate") {
    var weapon = this.c.weapons[event.weapon];
    this.create_message(
      obj,
      "#eeeeee",
      "+" + event.count + " " + weapon.title,
      18
    );
  }

  // gems
  if (event.collected === "gem") {
    this.set_score();
    this.create_message(obj, "#aaff99", "+" + event.n, 22);
  }
};

/* ========================================================================
    Game
    Explosions
 ========================================================================== */

/* Check for explosions
    ---------------------------------------- */

game.prototype.run_explosions = function() {
  // run through all explosions
  for (var key in this.core.state.explosions) {
    var explode_state = this.core.state.explosions[key];
    var explode_sprite = this.explosions[key];

    // if it's not started
    if (!explode_sprite) {
      var type = this.c.objects[explode_state.parent_type];
      if (!type) {
        continue;
      }

      // create sprite reference
      this.explosions[key] = {
        sprite: type.animation.explosion,
        frame: this.core.state.frame,
        x: explode_state.x,
        y: explode_state.y
      };

      // run sound effect
      if (type.audio.explosion) {
        this.run_event_sound({
          sound: type.audio.explosion,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      // run screen shake
      if (type.damage > 0) {
        this.run_event_screen_shake({
          radius: type.damage,
          x: explode_state.x,
          y: explode_state.y
        });
      }

      continue;
    }

    // match position
    explode_sprite.x = explode_sprite.x;
    explode_sprite.y = explode_sprite.y;
  }

  // remove explosions
  for (var key in this.explosions) {
    if (this.core.state.frame > this.explosions[key].frame + 60) {
      delete this.explosions[key];
    }
  }
};

/* ========================================================================
    Game
 ========================================================================== */

function game(
  assets,
  audio,
  input,
  scheme,
  map,
  players,
  player_id,
  top_event,
  onboarding
) {
  // args
  this.c = config;
  this.img = assets.img;
  this.audio = audio;
  this.input = input;
  this.scheme = scheme;
  this.map = map;
  this.players = players;
  this.player_id = player_id;
  this.leader = null;
  this.top_event = top_event;
  this.onboarding = onboarding;

  // game running
  this.active = false;
  this.last_frame = 0;

  // main div
  this.div = element({ class: "game full" });
  this.game_area = element({ id: "game_input" });
  append(this.div, this.game_area);

  // set up game modules
  this.init_crosshair();
  this.init_canvas();
  this.init_armoury();
  this.init_map();
  this.init_camera();
  this.init_background();
  this.init_time();
  this.init_score();
  this.init_alert();
  this.init_audio();

  // things to display
  this.objects = {};
  this.explosions = {};
  this.decorations = {};
  this.actions = {};
  this.sprites = [];
  this.messages = [];
  this.labels = {};

  // wait period before on fired weapon immediately after
  this.detonation_cooldown = 0;

  // create core
  this.core = new core(this.c, this.scheme, this.map.fg, this.map.gravity_map);
  this.core.state = this.core.blank_state();
  this.core.state = this.core.state;
}

/* Init game
    ---------------------------------------- */

game.prototype.start = function(frame) {
  // mark player events
  this.player_events = {};

  // set game status to active
  this.active = true;

  // set player obj
  this.set_this_player_refs();
  this.set_score();

  // set initial camera
  if (this.player) {
    this.camera.x = this.player_obj.x;
    this.camera.y = this.player_obj.y;
  }
};

/* Run core
    ---------------------------------------- */

game.prototype.frame_core = function(frame, actions) {
  // set up this state
  this.core.state.frame = frame;
  this.core.state.events = [];
  var response = this.core.action(this.player_id, actions);

  // run player actions
  this.run_players_events();

  // run this state
  this.core.frame();

  // return the input response
  return response;
};

/* Run display
    ---------------------------------------- */

game.prototype.frame_display = function() {
  this.run_objects();
  this.run_crosshair();
  this.run_camera();
  this.run_explosions();
  this.run_decorations();
  this.run_labels();
  this.run_canvas();
  this.run_audio();
  this.run_time();
  this.run_alert();
  this.run_armoury();

  // detonation cooldown
  this.detonation_cooldown -= this.detonation_cooldown > 0 ? 1 : 0;
};

/* ========================================================================
	Game
	Input
 ========================================================================== */

/* Get current core action input
	---------------------------------------- */

game.prototype.get_input = function() {
  // is the game active and does it have a player
  if (!this.active || !this.player || this.player.dead) {
    return;
  }

  // set source of crosshair movement
  if (
    this.input.active("move_up") ||
    this.input.active("move_down") ||
    this.input.active("move_left") ||
    this.input.active("move_right")
  ) {
    this.crosshair_source = "button";
  } else {
    if (this.input.cursor_moved) {
      this.crosshair_source = "cursor";
    }
  }
  this.input.cursor_moved = false;

  // get player actions
  var active = false;
  var response = {
    action: "none",
    angle: round(this.crosshair)
  };

  // weapon keys
  var shoot_key = false;
  var fire_weapon = false;
  var weapon = this.c.weapons[this.current_weapon];
  if (weapon && this.detonation_cooldown === 0 && this.input.active("shoot")) {
    // abandon a followed weapon
    if (this.core.state.objects[this.weapon_following]) {
      this.detonation_cooldown = 15;
      this.weapon_following = "";

      // normal firing
    } else {
      // on screen
      var pos = this.screen_position(
        this.player_obj.x,
        this.player_obj.y,
        this.player_obj.c.size
      );
      if (!pos.on_screen) {
        return;
      }

      // cooldown
      if (this.player.cooldown > 0) {
        return;
      }

      var weapon = this.c.weapons[this.current_weapon];
      if (!weapon) {
        return;
      }
      if (weapon.power_up && this.power_up < 60) {
        this.power_up++;
      } else {
        fire_weapon = true;
      }
    }
  } else {
    this.powered = false;
    if (this.power_up > 0) {
      fire_weapon = true;
    } else {
      this.power_up = 0;
    }
  }

  // fire weapon
  if (fire_weapon) {
    this.powered = true;
    response.action = "shoot";
    response.power = this.power_up;
    response.weapon = this.current_weapon;
    active = true;
    this.power_up = 0;
  }

  // walking restricted actions
  if (this.player_obj.grounded && !active) {
    // arrow key movement
    var arrow_angle = -1;
    if (this.input.active("move_up")) {
      arrow_angle = 90;
      if (this.input.active("move_right")) {
        arrow_angle = 135;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 45;
      }
    } else if (this.input.active("move_down")) {
      arrow_angle = 270;
      if (this.input.active("move_right")) {
        arrow_angle = 225;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 305;
      }
    } else {
      if (this.input.active("move_right")) {
        arrow_angle = 180;
      }
      if (this.input.active("move_left")) {
        arrow_angle = 0;
      }
    }
    if (arrow_angle !== -1) {
      response.action = "move";
      response.angle = arrow_angle;
      active = true;
    }

    // move crosshair key
    if (this.input.active("move")) {
      response.action = "move";
      active = true;
    }

    // jumping
    if (this.input.active("jump")) {
      response.action = "jump";
      active = true;
    }
  }

  // cancel mouse follow if doing stuff
  if (active) {
    this.cancel_mouse_follow();
  }

  if (!active) {
    return false;
  }

  // set the onboarding
  this.onboarding && this.onboarding.set(response.action);

  return response;
};

/* ========================================================================
    Game
    Run Objects
 ========================================================================== */

/* Start objects
	---------------------------------------- */

game.prototype.create_object = function(props, spawn) {
  // use existing props to make new core object
  var obj = this.core.create_object(props);

  // previous position
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = false;
  obj.px2 = obj.x;
  obj.py2 = obj.y;

  // display values
  obj.heading = 0;
  obj.hide = 0;
  obj.barrel_angle = 0;
  obj.actioned = false;
  obj.player_locked = false;

  // display position
  obj.dx = obj.x;
  obj.dy = obj.y;
  obj.ds = 0;

  // check for shoot events
  this.set_shot_object(obj);

  // previous display position
  obj.pdx = obj.x;
  obj.pdy = obj.y;

  // spawn
  if (obj.c.spawn || spawn) {
    // hide new object for x frames
    obj.hide = 9;

    // add a spawn decoration over top
    this.create_decoration({
      x: obj.x,
      y: obj.y,
      timeout: 16,
      repeat: false,
      type: "spawn",
      sprite: "teleport"
    });

    // play spawn sound
    this.run_event_sound({
      sound: "phase",
      x: obj.x,
      y: obj.y
    });
  }

  return obj;
};

/* Set a shot items new location
	---------------------------------------- */

game.prototype.set_shot_object = function(obj) {
  // check for a player
  var player = this.core.state.players[obj.player_id];
  if (!player) {
    return;
  }

  // check for an action
  for (var i = 0; i < player.events.length; i++) {
    var act = player.events[i];
    if (act.obj === obj.key) {
      obj.hide = 100;
    }
  }
};

/* Run objects
	---------------------------------------- */

game.prototype.run_objects = function() {
  // check for player locked objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.player_lock) {
      var player = this.core.state.objects["player-" + obj.player_id];
      if (player) {
        player.player_locked = true;
      }
    }
  }

  for (var key in this.core.state.objects) {
    this.run_object(this.core.state.objects[key]);
  }
};

game.prototype.run_object = function(obj) {
  // snap immediately if us
  if (obj.player_id === this.player_id) {
    obj.dx = obj.x;
    obj.dy = obj.y;

    // prevent bobbling
    if (obj.x === obj.px2 && obj.y === obj.py2) {
      obj.dx = obj.pdx;
      obj.dy = obj.pdy;
    }

    // interpolate others
  } else {
    // get max speed of movement
    if (!obj.actioned) {
      obj.ds = get_speed(obj.speed_x, obj.speed_y);
    }

    // interpolate
    var dist_x = this.core.map.get_distance_x(obj.dx, obj.x);
    var dist_y = this.core.map.get_distance_y(obj.dy, obj.y);
    var max_speed = this.core.map.get_distance(obj.dx, obj.dy, obj.x, obj.y);
    var speed = max(max_speed / 4, min(max_speed, obj.ds));
    var move = check_speed(dist_x, dist_y, speed);
    obj.dx = this.core.map.loop_x(obj.dx + round(move.x));
    obj.dy = this.core.map.loop_y(obj.dy + round(move.y));
  }

  // have we moved
  var moved = obj.pdx !== obj.dx || obj.pdy !== obj.dy;

  // set heading and barrel angle
  if (moved) {
    obj.heading = this.core.map.get_heading(obj.pdx, obj.pdy, obj.dx, obj.dy);
    obj.barrel_angle = increment_angle(obj.barrel_angle, obj.heading, 3);
  }

  // is us
  if (obj.player_id === this.player_id) {
    obj.barrel_angle = obj.player_locked ? obj.heading : this.crosshair;
  }

  // if we have just landed set initial angle
  if (obj.grounded && !obj.pg) {
    var angle = get_angle(obj.speed_x, obj.speed_y);
    var walk = this.core.map.walk(obj.x, obj.y, obj.px, obj.py, angle, 6);
    if (walk.move) {
      obj.angle = walk.angle;
      obj.direction = walk.direction;
      obj.px = obj.x;
      obj.py = obj.y;
      obj.animate = false;
    }
  }

  // if walking
  else if (obj.grounded) {
    // set the display values
    var dist_x = this.core.map.get_distance_x(obj.pdx, obj.dx);
    var dist_y = this.core.map.get_distance_y(obj.pdy, obj.dy);
    var amount_moved = get_speed(dist_x, dist_y);
    if (amount_moved > 3) {
      obj.animate = true;
      obj.direction = this.core.map.ground_dir(
        obj.pdx,
        obj.pdy,
        obj.dx,
        obj.dy
      );
      obj.angle = obj.heading;
    } else {
      obj.animate = obj.c.animation.ground;
    }

    // set sprites
    var suffix = obj.animate ? "-walk-" : "-still-";
    obj.sprite_key = obj.c.animation.sprite + suffix + obj.direction;
    obj.display_angle =
      obj.direction === "left" ? obj.angle : angle_add(obj.angle, 180);

    // not walking
  } else {
    obj.sprite_key = obj.c.animation.sprite;
    obj.animate = true;

    // players
    var player = this.core.state.players[obj.player_id];
    if (obj.type === "player" && player.hit === 0) {
      obj.direction =
        obj.barrel_angle >= 90 && obj.barrel_angle < 270 ? "right" : "left";
      obj.sprite_key += "-air-" + obj.direction;
      obj.display_angle =
        obj.direction === "left"
          ? obj.barrel_angle
          : angle_add(obj.barrel_angle, 180);
    }

    // spinning in the air
    else if (obj.c.animation.air_spin) {
      var ground = this.core.map.ground_pixel(round(obj.dx), round(obj.dy));
      var speed = get_speed(obj.speed_x, obj.speed_y);
      var n = ground ? 0 : 1;
      var angle_adding = moved ? speed * 2 : n;
      obj.display_angle = angle_add(obj.display_angle, angle_adding);

      // pointing towards trajectory
    } else {
      if (round(abs(obj.speed_x) === 0) && round(abs(obj.speed_y) === 0)) {
        if (obj.c.animation.air_spin) {
          obj.display_angle = angle_add(obj.display_angle, 2);
        }
      } else {
        obj.display_angle = angle_add(
          get_angle(-obj.speed_x, -obj.speed_y),
          90
        );
      }
    }
  }

  // static angle flag
  if (obj.c.animation.static_angle) {
    obj.display_angle = 0;
  }

  // weapon just fired flags
  if (obj.fire_sprite_count) {
    obj.fire_sprite_count--;
  }
  if (obj.fire_angle_lock_count) {
    obj.direction = obj.fire_direction;
    obj.display_angle =
      obj.direction === "left"
        ? obj.fire_angle_lock
        : angle_add(obj.fire_angle_lock, 180);
    obj.fire_angle_lock_count--;
  }
  if (obj.fire_body_sprite_count) {
    obj.sprite_key = obj.fire_body_sprite + "-" + obj.direction;
    obj.animate = true;
    obj.fire_body_sprite_count--;
  }

  // previous position
  obj.px2 = obj.px;
  obj.py2 = obj.py;
  obj.px = obj.x;
  obj.py = obj.y;
  obj.pg = obj.grounded;
  obj.pdx = obj.dx;
  obj.pdy = obj.dy;
  obj.player_locked = false;
};

/* ========================================================================
    Game
    Run Players
 ========================================================================== */

/* Start this player
	---------------------------------------- */

game.prototype.init_player = function(player, preserve_events, remove_events) {
  var new_player;

  // use sources
  if (player) {
    var core_player = this.core.state.players[player.id];
    if (preserve_events && core_player) {
      player.events = core_player.events.concat(player.events);
    }
    new_player = this.core.create_player(player);
    if (remove_events) {
      new_player.events = [];
    }

    // create new
  } else {
    new_player = this.core.create_player({ id: this.player_id });
    this.create_object({ type: "player", player_id: this.player_id });
    this.core.init_player(this.player_id);
  }

  // set this player
  if (new_player.id === this.player_id) {
    this.player = new_player;
    this.set_armoury();
  }
};

/* Resolve players from other states
	---------------------------------------- */

game.prototype.run_players_events = function(players) {
  // clear object actioned events
  for (var key in this.core.state.objects) {
    this.core.state.objects[key].actioned = false;
  }

  // run player events
  for (var key in this.core.state.players) {
    this.run_player_events(this.core.state.players[key]);
  }

  // remove old events
  for (var id in this.player_events) {
    for (var key in this.player_events[id]) {
      if (this.core.state.frame > this.player_events[id][key] + 30) {
        delete this.player_events[id][key];
      }
    }
  }
};

game.prototype.run_player_events = function(player) {
  // init player events
  if (!this.player_events[player.id]) {
    this.player_events[player.id] = {};
  }

  // go through events
  for (var i = 0; i < player.events.length; i++) {
    var event = player.events[i];
    var key = event.frame + "-" + event.type;
    if (!this.player_events[key]) {
      this.player_event(player, event);
      this.player_events[key] = this.core.state.frame;
      break;
    }
  }
};

/* Player action
	---------------------------------------- */

game.prototype.player_event = function(player, event) {
  // is there isn't an action
  if (!event) {
    return;
  }

  // get player object
  var obj = this.core.state.objects["player-" + player.id];
  if (!obj) {
    return;
  }

  // mark object as having performed an action
  obj.actioned = true;

  // movement
  if (event.type === "walk") {
    obj.ds = this.scheme.levels.speed[player.level] || obj.c.speed.move;
  }

  // jump
  if (event.type === "jump") {
    obj.ds = this.scheme.levels.jump[player.level] || obj.c.speed.jump;

    // play jump sound
    this.run_event_sound({
      sound: "jump",
      x: obj.x,
      y: obj.y
    });
  }

  // shooting
  if (event.type === "shoot") {
    var weapon = this.c.weapons[event.weapon];
    var weapon_obj = this.c.objects[weapon.object];

    // are we firing the weapon
    if (obj.player_id === this.player_id) {
      this.detonation_cooldown = min(20, weapon.cooldown);
      this.weapon_following = this.weapon_follow ? event.obj : "";

      // other players shots
    } else {
      var shot_obj = this.core.state.objects[event.obj];
      if (shot_obj) {
        shot_obj.hide = 0;
        shot_obj.dx = obj.dx;
        shot_obj.dy = obj.dy;
        obj.barrel_angle = this.core.map.get_heading(
          obj.x,
          obj.y,
          shot_obj.x,
          shot_obj.y
        );
      }
    }

    // if we are not a player and auto follow weapons
    if (this.player_id === null) {
      if (obj.player_id === parseInt(this.leader) && weapon.auto_follow) {
        this.weapon_following = event.obj;
      }
    }

    // weapon just fired sprite
    if (weapon.fire_sprite) {
      var sprite_key = "ant-weapon-" + weapon.fire_sprite;
      var animation = this.c.animations[sprite_key + "-left"];
      obj.fire_sprite = sprite_key;
      obj.fire_sprite_count = animation ? animation.length + 1 : 1;
      obj.fire_sprite_frame = this.core.state.frame;
    }

    // weapon body sprite
    if (weapon.fire_body_sprite) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_body_sprite = "ant-body-" + weapon.fire_body_sprite;
      obj.fire_body_sprite_count = cool;
    }

    // weapon angle lock
    if (weapon.fire_angle_lock) {
      var cool = weapon_obj.timeout
        ? weapon_obj.timeout + 5
        : weapon.cooldown + 5;
      obj.fire_direction = obj.direction;
      obj.fire_angle_lock = obj.barrel_angle;
      obj.fire_angle_lock_count = cool;
    }

    // play sound effect
    this.play_weapon_audio({
      x: obj.dx,
      y: obj.dy,
      player_id: obj.player_id,
      weapon: event.weapon
    });
  }

  // collect a crate or medpack
  if (event.type === "crate" || event.type === "medpack") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "locknload"
    });
  }

  // collected a gem
  if (event.type === "gem") {
    // remove the object
    if (this.core.state.objects[event.obj]) {
      delete this.core.state.objects[event.obj];
    }

    // play sound effect
    this.run_event_sound({
      x: obj.x,
      y: obj.y,
      sound: "bing"
    });
  }
};

/* Set this player references
	---------------------------------------- */

game.prototype.set_this_player_refs = function() {
  // set player ref
  if (this.core.state.players[this.player_id]) {
    this.player = this.core.state.players[this.player_id];
  }

  // set object ref
  if (this.core.state.objects["player-" + this.player_id]) {
    this.player_obj = this.core.state.objects["player-" + this.player_id];
  }
};

/* ========================================================================
    Game
    Scores
 ========================================================================== */

/* Build score interface
    ---------------------------------------- */

game.prototype.init_score = function() {
  if (!this.scheme.score) {
    return;
  }

  this.div_score = element({ class: "score" });
  append(this.div, this.div_score);

  this.div_score_gem = element({ class: "gem" });
  this.div_score_text = element({ class: "text" });
  append(this.div_score, this.div_score_gem);
  append(this.div_score, this.div_score_text);

  // are we doing levels
  if (this.scheme.levels) {
    this.div_score_bar = element({ class: "bar" });
    this.div_score_bar_in = element({ class: "bar-inner" });
    this.div_score_level = element({ class: "level hex-button", text: " LVL" });
    this.div_score_level_num = element({ class: "level-num", text: "1" });
    append(this.div_score, this.div_score_bar);
    append(this.div_score_bar, this.div_score_bar_in);
    append(this.div_score, this.div_score_level);
    append(this.div_score_level, this.div_score_level_num);
  }
};

/* Set score interface
    ---------------------------------------- */

game.prototype.set_score = function() {
  if (!this.scheme.score) {
    return;
  }
  if (!this.player) {
    hide(this.div_score);
    return;
  } else {
    show(this.div_score);
  }

  this.div_score_text.innerHTML = this.player.score;
  if (this.scheme.levels) {
    this.div_score_level_num.innerHTML = this.player.level + 1;

    // do exp bar
    var width = 0;
    var this_level = this.scheme.levels.score[this.player.level];
    var next_level = this.scheme.levels.score[this.player.level + 1];
    if (this_level && next_level) {
      width = (
        ((this.player.score - this_level) / (next_level - this_level)) *
        94
      ).fixed();
    }
    this.div_score_bar_in.style.width = width + "%";
  }
};

/* ========================================================================
    Game
    Timer
 ========================================================================== */

/* Build time interface
    ---------------------------------------- */

game.prototype.init_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  // time divs
  this.div_time = element({ class: "time" });
  this.div_timeout = element({ class: "timeout" });
  append(this.div, this.div_time);
  append(this.div, this.div_timeout);
  hide(this.div_timeout);

  this.display_time = "";
};

/* Run the time interface
    ---------------------------------------- */

game.prototype.run_time = function() {
  if (!this.scheme.show_time) {
    return;
  }

  var secs;

  // counting up
  if (this.scheme.time_limit === 0) {
    secs = floor(this.core.state.frame / 24);

    // counting down
  } else {
    var dif = this.scheme.time_limit - this.core.state.frame;
    secs = ceil(dif / 24);

    // timeout
    if (dif === 240) {
      show(this.div_timeout);
    }
    if (dif <= 240 && dif % 24 === 0 && dif > 1) {
      this.audio.play("bloop2", 0.5);
    }
    if (dif === 1) {
      hide(this.div_timeout);
    }
    if (secs <= 10) {
      if (dif % 24 === 0 && secs >= 1) {
        this.div_timeout.innerHTML = secs;
      }
      if (dif === 96) {
        this.audio.play("timeout", 0.8);
      }
    }
  }

  // do time
  var new_time = "0:00";
  if (secs > 0) {
    var minutes = floor(secs / 60),
      seconds = (secs - minutes * 60).toString();
    seconds = seconds.length < 2 ? "0" + seconds : seconds;
    new_time = minutes + ":" + seconds;
  }
  if (this.display_time !== new_time) {
    this.display_time = new_time;
    this.div_time.innerHTML = new_time;
  }
};

/* ========================================================================
	Audio
 ========================================================================== */

window.AudioContext = window.AudioContext || window.webkitAudioContext;

function audio(assets_url) {
  var self = this;

  this.cont = new AudioContext();
  this.buffers = {};
  this.repeaters = {};
  this.volume = 0.1;
  this.stored_volume = 0.1;

  // button hover swish events
  this.button_hover = null;
  document.onmousemove = function(e) {
    if (self.volume == 0) {
      return;
    }
    if (
      e.target.classList.contains("button") ||
      e.target.tagName.toLowerCase() == "button"
    ) {
      if (
        e.target != self.button_hover &&
        !e.target.classList.contains("disabled")
      ) {
        self.button_hover = e.target;
        self.play("bloop1", 1);
      }
    } else {
      self.button_hover = null;
    }
  };
}

/* Set volume
	---------------------------------------- */

audio.prototype.set_global_volume = function(vol) {
  this.volume = vol;
};

/* Add buffers
	---------------------------------------- */

audio.prototype.add_buffers = function(buffers) {
  this.buffers = Object.assign(this.buffers, buffers);
};

/* Play a file
	---------------------------------------- */

audio.prototype.play = function(key, volume, repeat) {
  // if no sound effect
  if (!this.buffers[key]) {
    return;
  }

  // if we're not active
  if (!document.hasFocus() && key !== "join") {
    return;
  }

  var obj = {};
  obj.audio_key = key;
  obj.gain = this.cont.createGain();
  obj.source = this.cont.createBufferSource();
  obj.source.buffer = this.buffers[key];
  obj.source.connect(obj.gain);
  obj.gain.connect(this.cont.destination);
  obj.source.loop = repeat;
  obj.source.start(0);

  this.set_volume(obj, volume);

  return obj;
};

/* Set volume
	---------------------------------------- */

audio.prototype.set_volume = function(obj, volume) {
  if (!obj) {
    return;
  }
  volume = !volume ? 0 : min(volume, 1);
  obj.gain.gain.value = (volume * this.volume).fixed();
};

/* Stop playing audio
	---------------------------------------- */

audio.prototype.stop = function(obj) {
  this.cont.close();
  this.cont = new AudioContext();
};

/* ========================================================================
	Element Functions
 ========================================================================== */

function element(props) {
  // create the element
  var type = props.type ? props.type : "div",
    el = document.createElement(type);

  // set properties
  if (props.id) {
    el.id = props.id;
  }
  if (props.src) {
    el.src = props.src;
  }
  if (props.intype) {
    el.type = props.intype;
  }
  if (props.class) {
    el.className = props.class;
  }
  if (props.text) {
    el.innerHTML = props.text;
  }
  if (props.value) {
    el.value = props.value;
  }
  if (props.data) {
    el.dataset.data = props.data;
  }
  if (props.placeholder) {
    el.placeholder = props.placeholder;
  }
  if (props.maxlength) {
    el.maxLength = props.maxlength;
  }
  if (props.href) {
    el.href = props.href;
  }

  return el;
}

function select(id) {
  return document.getElementById(id);
}

function hide(el) {
  el.style.display = "none";
}

function show(el) {
  el.style.display = "block";
}

function remove(el) {
  el.parentNode.removeChild(el);
}

function empty(el) {
  while (el.firstChild) {
    el.removeChild(el.firstChild);
  }
}

function append(parent, child) {
  parent.appendChild(child);
}

function add_class(el, class_name) {
  var split = el.className.split(" ");
  if (!split.includes(class_name)) {
    split.push(class_name);
  }
  el.className = split.join(" ");
}

function remove_class(el, class_name) {
  var split = el.className.split(" "),
    i = split.indexOf(class_name);
  if (i != -1) {
    split.splice(i, 1);
  }
  el.className = split.join(" ");
}

function display_time(frames) {
  var secs = floor(frames / 30);
  var minutes = floor(secs / 60);
  var seconds = (secs - minutes * 60).toString();
  seconds = seconds.length < 2 ? "0" + seconds : seconds;
  return minutes + ":" + seconds;
}

function debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, br) {
  var e = select("debug");
  if (br) {
    e.innerHTML += "<br>";
  } else {
    e.innerHTML = "";
  }
  if (s1 != undefined) {
    e.innerHTML += s1;
  }
  if (s2 != undefined) {
    e.innerHTML += " | " + s2;
  }
  if (s3 != undefined) {
    e.innerHTML += " | " + s3;
  }
  if (s4 != undefined) {
    e.innerHTML += " | " + s4;
  }
  if (s5 != undefined) {
    e.innerHTML += " | " + s5;
  }
  if (s6 != undefined) {
    e.innerHTML += " | " + s6;
  }
  if (s7 != undefined) {
    e.innerHTML += " | " + s7;
  }
  if (s8 != undefined) {
    e.innerHTML += " | " + s8;
  }
  if (s9 != undefined) {
    e.innerHTML += " | " + s9;
  }
}

function debugbr(s1, s2, s3, s4, s5, s6, s7, s8, s9) {
  debug(s1, s2, s3, s4, s5, s6, s7, s8, s9, true);
}

/* ========================================================================
	Input
 ========================================================================== */

function input(callback) {
  var self = this;
  this.callback = callback;

  // default action keys
  this.action_keys = {
    move: ["0"], // click
    shoot: ["2", ["0", "17"], ["0", "18"], ["0", "91"]], // click, ctrl, alt, cmd
    jump: ["32"], // space
    switch_watcher_camera: ["80"], // p
    follow_weapon: ["70"], // f
    follow_mouse: ["1"], // middle click
    // move_left: ["37", "65"], // left, a
    // move_up: ["38", "87"], // up, w
    // move_right: ["39", "68"], // right, d
    // move_down: ["40", "83"], // down, s
    show_settings: ["27", "13"], // esc, enter
    weapon_select_1: ["49"], // 1
    weapon_select_2: ["50"], // 2
    weapon_select_3: ["51"], // 3
    weapon_select_4: ["52"], // 4
    weapon_select_5: ["53"], // 5
    weapon_select_6: ["54"], // 6
    weapon_select_7: ["55"], // 7
    weapon_select_8: ["56"], // 8
    weapon_select_9: ["57"] // 9
  };

  // set up reference for pressed key codes
  this.key_codes = {};

  // cursor
  this.cursor_moved = false;
  this.cursor = { x: 0, y: 0 };

  // set cursor points
  document.body.onmousemove = function(e) {
    if (e.target.id === "game_input") {
      self.input_cursor(e.clientX, e.clientY);
    }
  };

  // prevent default right click behaviour
  document.body.oncontextmenu = function(e) {
    e.preventDefault();
    return false;
  };

  // manage click events
  document.body.onmousedown = function(e) {
    if (e.target.id === "game_input") {
      self.input_button(e.button, "down");
    }
    if (e.button == 1) {
      e.preventDefault();
      return false;
    }
  };
  document.body.onmouseup = function(e) {
    self.input_button(e.button, "up");
  };

  this.singleTapped = false;
  this.doubleTapped = false;
  this.waitingForDouble = false;
  this.twoFingerTap = false;

  document.body.ontouchstart = function(e) {
    if (e.target.id === "game_input") {
      var touch = e.touches[e.touches.length - 1];
      self.input_cursor(touch.clientX, touch.clientY);
      self.singleTapped = true;
      console.log(e.touches.length);
      if (e.touches.length > 1) {
        self.twoFingerTap = true;
      }
      if (self.waitingForDouble) {
          self.doubleTapped = true;
          setTimeout(function() {
            self.doubleTapped = false;
          }, 20);
      } else {
        self.waitingForDouble = true;
      }
      setTimeout(function() {
        self.waitingForDouble = false;
      }, 300);
    }
  }

  document.body.ontouchend = function(e) {
    self.singleTapped = false;
    self.twoFingerTap = false;
  }

  document.body.ontouchmove = function(e) {
    if (e.target.id === "game_input") {
      var touch = e.touches[e.touches.length - 1];
      self.input_cursor(touch.clientX, touch.clientY);
    }
  }

  // self.input_cursor(e.clientX, e.clientY);

  // manage touch events


  // mouse wheel
  // if ("onmousewheel" in document.body) {
  //   document.body.onmousewheel = function(e) {
  //     e.preventDefault && e.preventDefault();
  //     e.returnValue = false;
  //     e = e || window.event;
  //     self.scroll_wheel(e);
  //     return false;
  //   };
  // } else {
  //   document.body.addEventListener("DOMMouseScroll", function(e) {
  //     self.scroll_wheel(e);
  //   });
  // }

  // manage keyboard events
  document.body.onkeydown = function(e) {
    self.input_button(e.keyCode, "down");
  };
  document.body.onkeyup = function(e) {
    self.input_button(e.keyCode, "up");
  };

  // turn off input when window is not focused
  window.onblur = function() {
    self.input_reset();
  };
}

/* Is an action active
	---------------------------------------- */

input.prototype.active = function(type) {
  // touch
  if (type === 'jump' && this.twoFingerTap) {
    return true;
  }
  if (type === 'shoot' && this.doubleTapped) {
    return true;
  }
  if (type === 'move' && this.singleTapped) {
    return true;
  }

  // mouse keyboard
  const action = this.action_keys[type];
  if (!action) {
    return;
  }
  for (let i = 0; i < action.length; i++) {
    const codes = action[i];
    if (Array.isArray(codes)) {
      let trigger = true;
      for (let i2 = 0; i2 < codes.length; i2++) {
        const code = codes[i2];
        if (!this.key_codes[code]) {
          trigger = false;
        }
      }
      if (trigger) {
        return true;
      }
    } else {
      if (this.key_codes[codes]) {
        return true;
      }
    }
  }
};

/* Find the action of a code
	---------------------------------------- */

input.prototype.find_action = function(code) {
  const actions = [];
  for (let key in this.action_keys) {
    for (let i = 0; i < this.action_keys[key].length; i++) {
      const codes = this.action_keys[key][i];
      if (!Array.isArray(codes) && String(codes) === String(code)) {
        const obj = { type: key };
        // if (key == "show_settings") {
        //   if (this.actions.shoot) {
        //     return [];
        //   }
        // }

        // please don't tell anybody I did this
        if (key == "weapon_select_1") {
          obj.type = "weapon_select";
          obj.n = 0;
        }
        if (key == "weapon_select_2") {
          obj.type = "weapon_select";
          obj.n = 1;
        }
        if (key == "weapon_select_3") {
          obj.type = "weapon_select";
          obj.n = 2;
        }
        if (key == "weapon_select_4") {
          obj.type = "weapon_select";
          obj.n = 3;
        }
        if (key == "weapon_select_5") {
          obj.type = "weapon_select";
          obj.n = 4;
        }
        if (key == "weapon_select_6") {
          obj.type = "weapon_select";
          obj.n = 5;
        }
        if (key == "weapon_select_7") {
          obj.type = "weapon_select";
          obj.n = 6;
        }
        if (key == "weapon_select_8") {
          obj.type = "weapon_select";
          obj.n = 7;
        }
        if (key == "weapon_select_9") {
          obj.type = "weapon_select";
          obj.n = 8;
        }
        actions.push(obj);
      }
    }
  }
  return actions;
};

/* Process input events
	---------------------------------------- */

input.prototype.input_button = function(code, type) {
  // ignore input on a text box
  if (document.activeElement.tagName.toLowerCase() === "input") {
    return;
  }

  if (type == "up") {
    this.key_codes[code] = false;
  }
  if (type == "down") {
    this.key_codes[code] = true;
    const actions = this.find_action(code);
    for (let i = 0; i < actions.length; i++) {
      this.callback(actions[i]);
    }
  }
};

/* Cursor move
    ---------------------------------------- */

input.prototype.input_cursor = function(x, y) {
  this.cursor_moved = true;
  this.cursor.x = x;
  this.cursor.y = y;
};

/* Scroll wheel
    ---------------------------------------- */

input.prototype.scroll_wheel = function(e) {
  // normalize delta for cross browser
  var d = e.detail,
    w = e.wheelDelta,
    d = d ? (w && (f = w / d) ? d / f : -d / 1.35) : w / 120;

  // up or down
  var down = d < 0 ? true : false;

  // event
  this.callback({ type: "weapon_scroll", down: down });
};

/* Reset actions
    ---------------------------------------- */

input.prototype.input_reset = function() {
  for (key in this.key_codes) {
    this.key_codes[key] = false;
  }
};

/* ========================================================================
	Asset Loader
 ========================================================================== */

function loader(assets_url, assets, onload) {
  var self = this;

  // set up loading values
  this.onload = onload;
  this.output = {};
  this.loaded = 0;
  this.count = 0;
  for (var type in assets) {
    this.count += Object.keys(assets[type]).length;
    this.output[type] = {};
  }

  // set up audio
  if (assets.audio) {
    if (Object.keys(assets.audio).length > 0) {
      this.audio_context = new AudioContext();
    }
  }

  // do the loading
  for (var type in assets) {
    for (var key in assets[type]) {
      var url = assets_url + assets[type][key];
      if (type == "json") {
        this.json(url, type, key);
      }
      if (type == "img") {
        this.image(url, type, key);
      }
      if (type == "audio") {
        this.audio(url, type, key);
      }
    }
  }
}

/* Load JSON
	---------------------------------------- */

loader.prototype.json = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.overrideMimeType("application/json");
  request.open("GET", url, true);
  request.onreadystatechange = function() {
    if (request.readyState == 4 && request.status == "200") {
      var response = JSON.parse(request.responseText);
      self.output[type][key] = response;
      self.check_loaded();
    }
  };
  request.send(null);
};

/* Load Image
	---------------------------------------- */

loader.prototype.image = function(url, type, key) {
  var self = this;

  this.output[type][key] = new Image();
  this.output[type][key].src = url;

  // when image is loaded
  this.output[type][key].onload = function() {
    self.check_loaded();
  };
};

/* Load Audio
	---------------------------------------- */

loader.prototype.audio = function(url, type, key) {
  var self = this;

  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.responseType = "arraybuffer";
  request.onload = function() {
    self.audio_context.decodeAudioData(request.response, function(buffer) {
      if (buffer) {
        var file = self.audio_context.createBufferSource();
        file.buffer = buffer;
        file.connect(self.audio_context.destination);

        var gain = self.audio_context.createGain();
        file.connect(gain);
        gain.connect(self.audio_context.destination);

        file.loop = true;

        // gain.gain.value = 1;
        // file.start(0);

        // this.files[key] = this.cont.createBufferSource();
        // this.files[key].buffer = files[key];
        // this.files[key].connect(this.cont.destination);

        // // set up gain node
        // this.gain[key] = this.cont.createGain();
        // this.files[key].connect(this.gain[key]);
        // this.gain[key].connect(this.cont.destination);

        self.output.audio[key] = buffer;
        self.check_loaded();
      }
    });
  };
  request.send(null);
};

/* Check Assets Are Loaded
	---------------------------------------- */

loader.prototype.check_loaded = function() {
  this.loaded++;

  // if we are not ready yet
  if (this.count <= this.loaded) {
    this.onload(this.output);
  }
};

/* ========================================================================
    Onboarding
 ========================================================================== */

function onboarding() {
  this.count = 0;
  this.done = false;
  this.action = {
    move: false,
    jump: false,
    shoot: false
  };

  if (typeof Storage !== "undefined") {
    this.count = localStorage.getItem("pants_onboarding") || 0;
    this.done = this.count > 1;
  }
}

/* Trigger onboardingness
	---------------------------------------- */

onboarding.prototype.set = function(type) {
  if (this.done) {
    return;
  }
  this.action[type] = true;
  for (let key in this.action) {
    if (!this.action[key]) {
      return;
    }
  }
  this.done = true;
  if (typeof Storage !== "undefined") {
    localStorage.setItem("pants_onboarding", this.count + 1);
  }
};

/* ========================================================================
    Socket Messages
    handle connection and message data to and from the server
 ========================================================================== */

function SocketConnection(callback) {
  var self = this;

  // socket connection
  if (!io.on) {
    return;
  }
  this.io = io(DOMAIN + ":" + PORT);
  this.io.on("message", function(message) {
    self.message_receive(message);
  });
  this.io.on("disconnect", function() {
    callback({ type: "wait_for_connection" });
  });

  this.callback = callback;

  // ids
  this.message_receive_ids = [
    "full",
    "connected",
    "player_join",
    "player_leave",
    "game_wait",
    "game_start",
    "game_end",
    "game_state",
    "ping"
  ];

  this.message_send_ids = [
    "watcher",
    "send_name",
    "player_input",
    "weapon_selected",
    "respawn",
    "ping"
  ];

  // string separator
  this.message_separator = "|";
}

/* Send messages to server
	---------------------------------------- */

SocketConnection.prototype.message_send = function(type, props) {
  var i = this.message_send_ids.indexOf(type);

  // if not a valid message
  if (i === "undefined") {
    return;
  }

  // send message
  var self = this;
  var message = i + this.message_separator + props.join(this.message_separator);
  if (this.lag) {
    setTimeout(function() {
      self.io.send(message);
    }, this.lag);
  } else {
    this.io.send(message);
  }
};

/* Receive messages from server
	---------------------------------------- */

SocketConnection.prototype.message_receive = function(message) {
  // get type of message from id
  var split = message.split(this.message_separator);
  var id = parseInt(split[0]);

  // if not valid id
  if (!this.message_receive_ids[id]) {
    return;
  }
  var type = this.message_receive_ids[id];
  var event = { type: type };

  // prepare information for event handler
  if (type === "full") {
  } else if (type === "connected") {
    event.player_id = split[1] === "null" ? null : parseInt(split[1]);
    event.name = split[2];
    event.players = split[3];
    event.scheme = split[4];
  } else if (type === "player_join") {
    event.user_id = split[1];
    event.name = split[2];
    event.player_id = parseInt(split[3]);
  } else if (type === "player_leave") {
    event.user_id = split[1];
  } else if (type === "game_wait") {
  } else if (type === "game_start") {
    event.reset_players = parseInt(split[1]);
    event.bg_str = split[2];
    event.fg_str = split[3];
    event.gravity_map = split[4];
  } else if (type === "game_end") {
  } else if (type === "game_state") {
    event.frames = parseInt(split[1]);
    event.state = split[2];
    event.responses = split[3];
    event.damages = split[4];
  } else if (type === "ping") {
    event.frame = parseInt(split[1]);
  }

  // run event
  this.callback(event);
};

/* ========================================================================
    Multiplayer
    Player Deaths
 ========================================================================== */

/* Check if we're dead
    ---------------------------------------- */

multiplayer.prototype.frame_dead = function() {
  // not ready for any death stuff
  if (!this.game || !this.game.core || !this.game.player) {
    return;
  }

  // count up to deadness
  if (this.game.player.dead) {
    if (!this.dead) {
      if (this.wait_for_dead < 48) {
        this.wait_for_dead++;
      } else {
        this.death();
      }
    }
  } else {
    this.wait_for_dead = 0;
    if (this.dead) {
      this.respawn();
    }
  }

  // deadness
  if (this.dead) {
    if (this.wait_for_respawn > 0) {
      this.wait_for_respawn--;
      if (this.wait_for_respawn === 0) {
        this.div_dead_countdown.innerHTML = "Click to respawn";
        remove_class(this.button_respawn, "disabled");
      } else {
        this.div_dead_countdown.innerHTML =
          "Respawn in " + ceil(this.wait_for_respawn / 24) + " seconds";
      }
    }
  }
};

/* We have died
    ---------------------------------------- */

multiplayer.prototype.death = function() {
  this.dead = true;
  this.wait_for_dead = 0;
  this.wait_for_respawn = 96;

  hide(this.div_dead_text);
  add_class(this.button_respawn, "disabled");
  show(this.div_dead);
};

/* Respawn triggered
    ---------------------------------------- */

multiplayer.prototype.respawn = function() {
  this.dead = false;
  hide(this.div_dead);
};

/* ========================================================================
    Multiplayer
    Events
 ========================================================================== */

/* Run events
    ---------------------------------------- */

multiplayer.prototype.run_event = function(event) {
  if (!event) {
    return;
  }

  // handle arrays of events
  if (Array.isArray(event)) {
    for (var i = 0; i < event.length; i++) {
      this.run_event(event[i]);
    }
    return;
  }

  // run events
  if (event.type === "full") {
    this.game_full();
  } else if (event.type === "connected") {
    this.connected(event);
  } else if (event.type === "wait_for_connection") {
    this.wait_for_connection();
  } else if (event.type === "player_join") {
    this.player_join(event);
  } else if (event.type === "player_leave") {
    this.player_leave(event);
  } else if (event.type === "game_wait") {
  } else if (event.type === "game_start") {
    this.game_start(event);
  } else if (event.type === "game_end") {
    this.game_end(event);
  } else if (event.type === "game_state") {
    this.game_state_received(event);
  } else if (event.type === "collect") {
    this.event_collect(event);
  } else if (event.type === "ground_damage") {
    this.event_ground_damage(event);
  } else if (event.type === "player_death") {
    this.event_player_death(event);
  } else if (event.type === "weapon_selected") {
    this.sockets.message_send("weapon_selected", [event.weapon]);
  } else if (event.type === "ping") {
    this.event_ping(event);
  }

  // send event down a level
  else if (this.game) {
    this.game.run_event(event);
  }
};

/* Collected item
    ---------------------------------------- */

multiplayer.prototype.event_collect = function(event) {
  if (this.initialised) {
    // wait to recreate
    this.wait_to_create[event.obj] = this.game.core.state.frame;

    // run client collection events
    this.game.run_event(event);

    // run players interface
    this.players_interface();
  }
};

/* Player death
    ---------------------------------------- */

multiplayer.prototype.event_player_death = function(event) {
  // only use server events
  if (!event.from_server) {
    return;
  }

  // run it
  if (this.initialised) {
    this.player_death(event);
  }
};

/* Ping
    ---------------------------------------- */

multiplayer.prototype.event_ping = function(event) {
  // did we request this
  if (!this.pings[event.frame]) {
    return;
  }

  var now = new Date().getTime();

  // record end time for ping
  this.pings[event.frame].end = now;

  // go through all pings
  var ping_count = 0;
  var ping_total = 0;
  for (var frame in this.pings) {
    var ping = this.pings[frame];

    // remove old ones
    if (ping.end && ping.end + 10000 < now) {
      delete this.pings[frame];
      continue;
    }

    // calculate average
    ping_total += ping.end - ping.start;
    ping_count++;
  }

  // show ping
  this.div_ping.innerHTML = round(ping_total / ping_count);
};

/* ========================================================================
    Mulitplayer
    Frames
 ========================================================================== */

/* Start/stop loop
    ---------------------------------------- */

multiplayer.prototype.loop_start = function(start_frame) {
  // close any open loops
  this.loop_stop();

  // set loop vars
  this.start_frame = start_frame || 0;
  this.frames = this.start_frame;
  this.start_time = new Date().getTime();

  var self = this;
  this.interval = setInterval(function() {
    self.run_tick();
  }, 10);
};

multiplayer.prototype.loop_stop = function() {
  clearInterval(this.interval);
};

/* Run tick
    ---------------------------------------- */

multiplayer.prototype.run_tick = function() {
  // calculate number of frames since game start
  var now = new Date().getTime();
  var frames =
    this.start_frame + Math.floor((now - this.start_time) / this.ms_loop);

  // get number of remaining steps
  var frame_difference = frames - this.frames;

  // waiting
  if (frame_difference < 1) {
    return;
  }

  // too much lag
  if (frame_difference > 10) {
    this.loop_start();
    // console.log("tick lag | " + frame_difference);
    return;
  }

  // go through frames to process
  for (var i = 0; i < frame_difference; i++) {
    this.frame();
  }

  // run display loop
  this.game.frame_display();

  // record time this was done
  this.fpses.push(new Date().getTime());
  if (this.fpses.length > 72) {
    this.div_fps.innerHTML = round(
      (3000 / (this.fpses[72] - this.fpses[0])) * this.fps
    );
    this.fpses.splice(0, 1);
  }
};

/* Frame process
    ---------------------------------------- */

multiplayer.prototype.frame = function() {
  // increment frame count
  this.frames++;

  // store input
  if (this.game.player) {
    var action = this.game.get_input();
    if (action) {
      this.store_input[this.frames] = action;
      this.send_input(action);
    }
  }

  // run frame
  this.frame_run(this.frames);

  // remove old states
  this.remove_old_states();

  // run ground damage checks
  this.frame_ground();

  // run death frames
  this.frame_dead();

  // run players interface
  if (this.frames % 48 === 0) {
    this.players_interface();
  }

  // run ping
  if (this.frames % 12 === 0) {
    this.sockets.message_send("ping", [this.frames]);
    this.pings[this.frames] = { start: new Date().getTime() };
  }
};

/* Frame run
    ---------------------------------------- */

multiplayer.prototype.frame_run = function(frame) {
  // run core and store response
  var response = this.game.frame_core(frame, this.store_input[frame]);
  if (response.success) {
    this.store_responses.push(response);
  }

  // events
  this.run_event(this.game.core.state.events);

  // unpack any stored server state for this frame
  if (this.store_packet[frame]) {
    this.set_game_state(this.store_packet[frame]);
    delete this.store_packet[frame];
  }

  // record game state
  this.store_state[frame] = {
    frames: frame,
    state: this.game.core.pack_state(this.game.core.state)
  };
};

/* Remove old states
    ---------------------------------------- */

multiplayer.prototype.remove_old_states = function() {
  for (var frame in this.store_packet) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_packet[frame];
    }
  }
  for (var frame in this.store_state) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_state[frame];
    }
  }
  for (var frame in this.store_input) {
    if (parseInt(frame) + 50 < this.frames) {
      delete this.store_input[frame];
    }
  }
  for (var i = 0; i < this.store_responses.length; i++) {
    if (this.store_responses[i].frame + 50 < this.frames) {
      this.store_responses.splice(i, 1);
    }
  }
};

/* ========================================================================
    Mulitplayer
    Ground Damage
 ========================================================================== */

/* Damage the ground event
    ---------------------------------------- */

multiplayer.prototype.event_ground_damage = function(event) {
  var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

  // did we already have this happen
  if (this.ground_events[key]) {
    return;
  }

  // get boundaries
  var x1 = max(round(event.x - event.radius), 0);
  var x2 = min(round(event.x + event.radius), this.game.core.map.w - 1);
  var y1 = max(round(event.y - event.radius), 0);
  var y2 = min(round(event.y + event.radius), this.game.core.map.h - 1);
  var w = x2 - x1;
  var h = y2 - y1;

  // get array from the map
  var arr = this.game.core.map.get_block(x1, y1, w, h);

  // get piece of the map
  var canv = this.game.get_land_block(x1, y1, w, h);

  // store backed up damage
  this.ground_temp[key] = {
    frame: event.frame,
    x: x1,
    y: y1,
    arr: arr,
    canv: canv
  };

  // store the event itself
  this.ground_events[key] = duplicate_obj(event);
  this.ground_events[key].done = true;

  // run the event
  this.game.run_event(event);
};

/* Check ground damage events
    ---------------------------------------- */

multiplayer.prototype.frame_ground = function() {
  // go through all checks
  for (var key in this.ground_temp) {
    if (this.frames > this.ground_temp[key].frame + 40) {
      clog("damage not confirmed");
      this.undo_ground_damage(this.ground_temp[key], key);
      delete this.ground_temp[key];
      delete this.ground_events[key];
    }
  }

  // go through all events
  for (var key in this.ground_events) {
    var event = this.ground_events[key];
    if (this.frames >= event.frame) {
      if (!event.done) {
        this.game.run_event(event);
        this.ground_events[key].done = true;
      }
    }
    if (this.frames > this.ground_events[key].frame + 50) {
      delete this.ground_events[key];
    }
  }
};

/* Undo ground damage
    ---------------------------------------- */

multiplayer.prototype.undo_ground_damage = function(damage, d_key) {
  // restore it
  this.game.core.map.set_block_from_arr(damage.x, damage.y, damage.arr);
  this.game.draw_land_block(damage.x, damage.y, damage.canv);

  // redo any other events that happened since
  for (var key in this.ground_events) {
    if (d_key === key) {
      continue;
    }
    this.game.run_event(this.ground_events[key]);
  }
};

/* Server response
    ---------------------------------------- */

multiplayer.prototype.resolve_ground = function(str) {
  if (!str) {
    return;
  }

  // unpack damages
  var split = str.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    var event = {
      type: "ground_damage",
      frame: parseInt(split2[0]),
      x: parseFloat(split2[1]),
      y: parseFloat(split2[2]),
      radius: parseFloat(split2[3]),
      dig: split2[4] === "1"
    };
    var key = event.frame + "-" + event.x + "-" + event.y + "-" + event.radius;

    // confirm already done damage
    if (this.ground_temp[key]) {
      delete this.ground_temp[key];

      // wait to perform it
    } else {
      this.ground_events[key] = event;
    }
  }
};

/* ========================================================================
    Multiplayer
    Interface
 ========================================================================== */

/* Init interface
    ---------------------------------------- */

multiplayer.prototype.init_interface = function() {
  // loading screen
  this.loading = element({
    class: "cont_center",
    text: "Loading...<br><br><div class='loader'></div>"
  });
  append(this.div, this.loading);
  hide(this.loading);

  // between games screen
  this.between_games = element({
    class: "cont_center",
    text: "Dimension jump in progress!<br><br><div class='loader'></div>"
  });
  append(this.div, this.between_games);
  hide(this.between_games);

  // performance
  this.div_ping = element({ class: "ping" });
  this.div_fps = element({ class: "fps" });
  append(this.div, this.div_ping);
  append(this.div, this.div_fps);

  // dead div
  this.div_dead = element({ class: "full full_bg" });
  this.div_dead_cont = element({
    class: "cont_center red",
    text: "<h3>You have died!</h3>"
  });
  this.div_dead_text = element({
    type: "p",
    text: "You were killed in action."
  });
  this.div_dead_countdown = element({ type: "p", class: "grey" });
  this.div_dead_buttons = element({ class: "buttons" });
  this.button_respawn = element({
    type: "button",
    class: "button red disabled",
    text: "Respawn"
  });
  append(this.div, this.div_dead);
  append(this.div_dead, this.div_dead_cont);
  append(this.div_dead_cont, this.div_dead_text);
  append(this.div_dead_cont, this.div_dead_countdown);
  append(this.div_dead_cont, this.div_dead_buttons);
  append(this.div_dead_buttons, this.button_respawn);
  hide(this.div_dead);

  // game full screen
  this.full = element({
    class: "cont_center",
    text:
      "Game server full. Please try again later...<br><br><div class='loader'></div>"
  });
  append(this.div, this.full);
  hide(this.full);

  // respawn on click
  var self = this;
  this.button_respawn.onclick = function() {
    if (self.wait_for_respawn === 0) {
      self.sockets.message_send("respawn", []);
    }
  };

  // players
  this.div_players = element({ class: "players" });
  this.table_players = element({ type: "table" });
  append(this.div, this.div_players);
  append(this.div_players, this.table_players);
};

/* ========================================================================
    App
 ========================================================================== */

function multiplayer(
  assets,
  assets_url,
  audio,
  input,
  name,
  watcher,
  run_event,
  sockets,
  onboarding
) {
  // setup
  this.assets = assets;
  this.assets_url = assets_url;
  this.audio = audio;
  this.input = input;
  this.name = name;
  this.watcher = watcher;
  this.top_event = run_event;
  this.sockets = sockets;
  this.scheme = null;
  this.lag = 0;
  this.onboarding = onboarding;

  // loop
  this.fps = 24;
  this.ms_loop = Math.floor(1000 / this.fps);
  this.ms_tick = 10;
  this.active = false;

  // main divs
  this.div = element({ class: "full" });
  this.connecting = element({
    class: "cont_center",
    text: "Waiting for connection...<br><br><div class='loader'></div>"
  });
  append(this.div, this.connecting);

  // set up interface
  this.init_interface();

  // when joining a game record any incoming events for later use
  this.initial_game_events = [];
}

/* Wait for connection
    ---------------------------------------- */

multiplayer.prototype.wait_for_connection = function(event) {
  this.loop_stop();
  hide(this.between_games);
  hide(this.loading);
  hide(this.div_dead);
  show(this.connecting);
};

/* Connected
    ---------------------------------------- */

multiplayer.prototype.connected = function(event) {
  // set up scheme
  this.scheme = deepmerge(schemes.default, schemes[event.scheme]);

  // active values
  this.name = event.name;
  this.player_id = event.player_id;
  this.player_count = 0;
  this.players = {};
  this.players_ref = {};

  // go through string of players
  var split = event.players.split("+");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("/");
    this.init_player({
      user_id: split2[0],
      name: split2[1],
      player_id: parseInt(split2[2])
    });
  }

  // run the player interface
  this.players_interface();
};

/* Start game
    ---------------------------------------- */

multiplayer.prototype.game_start = function(event) {
  this.loading_start = true;
  this.initialised = false;
  this.gravity_map = event.gravity_map;

  this.game_close();

  // reset scores
  if (event.reset_players) {
    for (var id in this.players) {
      this.players[id].level = 0;
      this.players[id].score = 0;
    }
    this.players_interface();
  }

  // stored game states and actions
  this.store_packet = {};
  this.store_state = {};
  this.store_input = {};
  this.store_responses = [];

  // ground damage
  this.ground_temp = {};
  this.ground_events = {};

  // objects that we are waiting on for server confirmation
  this.wait_to_destroy = {};
  this.wait_to_create = {};

  // performance
  this.pings = {};
  this.fpses = [];

  // load the map from data url
  var self = this;
  new loader(
    "",
    {
      img: {
        bg: event.bg_str,
        fg: event.fg_str
      }
    },
    function(assets) {
      self.game_start_loaded(assets.img);
    }
  );
};

multiplayer.prototype.game_start_loaded = function(map) {
  // set up map
  var new_map = {
    fg: mapgen_canvas(map.fg.width, map.fg.height),
    bg: mapgen_canvas(map.bg.width, map.bg.height),
    gravity_map: this.gravity_map
  };
  new_map.fg.cont.drawImage(map.fg, 0, 0);
  new_map.bg.cont.drawImage(map.bg, 0, 0);

  // start up game object
  this.game = new game(
    this.assets,
    this.audio,
    this.input,
    this.scheme,
    new_map,
    this.players_ref,
    this.player_id,
    this.top_event,
    this.onboarding
  );
  append(this.div, this.game.div);

  // finished loading
  this.loading_start = false;
};

/* Init game
    ---------------------------------------- */

multiplayer.prototype.init_game = function(event) {
  if (!this.game || !this.game.core) {
    return;
  }

  // show interface
  hide(this.between_games);
  hide(this.div_dead);
  hide(this.connecting);
  hide(this.loading);

  // stop game
  this.loop_stop();

  // prepare state
  this.set_game_state(event, true);

  // start game
  this.game.start(event.frames);
  this.status = "active";

  // last frame a server packet was received
  this.last_packet = event.frames;
  this.disconnected = false;

  // run initial events
  this.run_event(this.initial_game_events);
  this.initial_game_events = [];
  this.initialised = true;

  // start loop
  this.loop_start(event.frames);
};

/* Close game
    ---------------------------------------- */

multiplayer.prototype.game_close = function(event) {
  this.loop_stop();
  if (this.game) {
    remove(this.game.div);
    delete this.game;
  }
};

/* End Game
    ---------------------------------------- */

multiplayer.prototype.game_end = function(event) {
  // stop game
  this.loop_stop();

  // stop audio
  this.audio.stop();

  // show loading screen
  hide(this.loading);
  hide(this.div_dead);
  hide(this.connecting);
  show(this.between_games);
};

/* Send input to server
    ---------------------------------------- */

multiplayer.prototype.send_input = function(action) {
  var arr = [this.frames, action.action, action.angle];
  if (action.action === "shoot") {
    arr.push(action.weapon);
  }
  this.sockets.message_send("player_input", arr);
};

/* ========================================================================
    Room Players
 ========================================================================== */

/* Create player objects
    ---------------------------------------- */

multiplayer.prototype.init_player = function(props) {
  // add player to array
  this.player_count++;
  this.players[props.user_id] = {
    name: props.name,
    id: props.player_id
  };

  // set players reference
  this.players_ref[props.player_id] = {
    user_id: props.user_id,
    name: props.name,
    level: 0
  };
};

/* Draw players interface
    ---------------------------------------- */

multiplayer.prototype.players_interface = function() {
  // are we good and active
  if (!this.initialised || !this.game.core.state.players) {
    return;
  }

  // show players
  var str = "";
  var sortable = this.players_sort();
  if (!sortable) {
    return;
  }

  // set leader id
  this.game.leader = parseInt(sortable[0].id);

  str = "<thead><th></th><th>lvl</th><th>score</th></thead>";
  for (var i = 0; i < sortable.length; i++) {
    var player = sortable[i];
    var tr_class = "";
    if (player.id == this.player_id) {
      tr_class += "highlight ";
    }
    if (player.dead) {
      tr_class += "dead ";
    }
    str +=
      "<tr class='" +
      tr_class +
      "''><td>" +
      player.name +
      "</td><td class='red'>" +
      (player.level + 1) +
      "</td><td class='green'>" +
      player.score +
      "</td></tr>";
  }

  // check for level ups
  for (var id in this.players_ref) {
    var player = this.players_ref[id];
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    if (player.level !== core_player.level) {
      this.run_event({
        type: "player_level",
        id: parseInt(id),
        prev: player.level,
        new: core_player.level
      });
      this.players_ref[id].level = core_player.level;
    }
  }

  // set content
  this.table_players.innerHTML = str;
};

/* Sort players by score
    ---------------------------------------- */

multiplayer.prototype.players_sort = function() {
  var sortable = [];
  for (var id in this.players_ref) {
    var core_player = this.game.core.state.players[id];
    if (!core_player) {
      continue;
    }
    sortable.push({
      id: id,
      name: this.players_ref[id].name,
      level: core_player.level,
      score: core_player.score,
      dead: core_player.dead
    });
  }
  sortable.sort(function(a, b) {
    return b.score - a.score;
  });
  return sortable;
};

/* Player has joined
    ---------------------------------------- */

multiplayer.prototype.player_join = function(event) {
  this.init_player(event, true);
  this.audio.play("join", 1);
};

/* Player left
    ---------------------------------------- */

multiplayer.prototype.player_leave = function(event) {
  if (!this.players[event.user_id]) {
    return;
  }

  var id = this.players[event.user_id].player_id;
  delete this.players_ref[id];
  delete this.players[event.user_id];
  this.player_count--;

  // remove from game
  if (this.game && this.game.core) {
    this.game.core.remove_player(id);
  }
};

/* ========================================================================
    Game States
 ========================================================================== */

/* Receive game state from server
    ---------------------------------------- */

multiplayer.prototype.game_state_received = function(event) {
  // if we are loading
  if (this.loading_start) {
    return;
  }

  // start the game
  if (!this.initialised || this.disconnected) {
    this.initialised = true;
    this.init_game(event);
    return;
  }

  var diff = event.frames - this.frames;

  // if we are too quick
  if (diff < 0) {
    // console.log("client too fast");
    this.init_game(event);
    return;
  }

  // if it's too far behind resync
  if (diff > 9) {
    // console.log("resync");
    this.init_game(event);
    return;
  }

  // apply the state
  if (event.frames === this.frames) {
    this.set_game_state(event);
  } else {
    this.store_packet[event.frames] = duplicate_obj(event);
  }
};

/* Set game state
    ---------------------------------------- */

multiplayer.prototype.set_game_state = function(event, ignore_res) {
  // run damages
  this.resolve_ground(event.damages);

  // unpack the state
  var state = this.game.core.unpack_state(event.state);

  // set players
  this.resolve_players(state, ignore_res);

  // set this player
  if (!ignore_res) {
    this.resolve_this_player(state, event.responses);
  }

  // set objects
  this.resolve_objects(state.objects, event.frames);

  // set explosions
  this.resolve_explosions(state.explosions, event.frames);

  // set game player references
  this.game.set_this_player_refs();
};

/* Resolve players
    ---------------------------------------- */

multiplayer.prototype.resolve_players = function(state, ignore_res) {
  // set all other players
  for (var key in state.players) {
    if (parseInt(key) !== this.player_id || ignore_res) {
      this.game.init_player(state.players[key], true);
    }
  }

  // remove players
  for (var key in this.game.core.state.players) {
    if (!state.players[key]) {
      this.game.core.remove_player(key);
    }
  }
};

/* Resolve this player
    ---------------------------------------- */

multiplayer.prototype.resolve_this_player = function(state, responses) {
  // prep server state objects
  var server_player = state.players[this.player_id];
  var server_obj = state.objects["player-" + this.player_id];
  if (!server_player || !server_obj) {
    return;
  }

  // prep server responses
  var server_responses = [];
  var split = responses.split("$");
  for (var i = 0; i < split.length; i++) {
    var split2 = split[i].split("~");
    server_responses.push({
      frame: parseInt(split2[0]),
      success: split2[1] === "1",
      x: parseFloat(split2[2]),
      y: parseFloat(split2[3]),
      speed_x: parseFloat(split2[4]),
      speed_y: parseFloat(split2[5]),
      type: split2[6]
    });
  }

  // check player weapon
  if (server_player.weapon !== this.game.current_weapon) {
    this.sockets.message_send("weapon_selected", [this.game.current_weapon]);
  }

  // if we have no more actions
  if (this.store_responses.length === 0) {
    this.game.player.level = server_player.level;
    this.game.player.score = server_player.score;
    this.game.player.dead = server_player.dead;
    this.game.player.health = server_player.health;
    this.game.player.cooldown = server_player.cooldown;
    this.game.player.armoury = duplicate_obj(server_player.armoury);
    this.game.set_armoury();
  }

  // resolve our player
  for (var i = 0; i < this.store_responses.length; i++) {
    var client_response = this.store_responses[i];

    // go through action responses
    for (var j = 0; j < server_responses.length; j++) {
      var server_response = server_responses[j];

      // correct frame
      if (client_response.frame === server_response.frame) {
        // compare the response
        if (
          client_response.success === server_response.success &&
          client_response.x === server_response.x &&
          client_response.y === server_response.y &&
          client_response.speed_x === server_response.speed_x &&
          client_response.speed_y === server_response.speed_y
        ) {
          // clog("act success", server_response.frame, this.frames, server_response.type, client_response.x, server_response.x, client_response.y, server_response.y);
        } else {
          // resync the player
          clog(
            "act fail",
            server_response.frame,
            this.frames,
            server_response.type,
            client_response.x,
            server_response.x,
            client_response.y,
            server_response.y
          );
          if (!this.resync_this_player(server_response)) {
            this.game.init_player(server_player, false, true);
            this.game.create_object(server_obj);
            return;
          }
        }
        server_responses.splice(j, 1);
        this.store_responses.splice(i, 1);
        i--;
        break;
      }
    }
  }
};

/* Sync this player
    ---------------------------------------- */

multiplayer.prototype.resync_this_player = function(server_response) {
  // how far back is this
  var frame = server_response.frame;
  var frame_difference = this.frames - frame;

  // if it's too far back
  // if we have no state to roll back to
  if (frame_difference > 20 || !this.store_state[frame]) {
    // console.log("sync too far back | " + frame_difference);
    return false;
  }

  // reset game state
  this.set_game_state(this.store_state[frame], true);

  // reset player
  this.store_responses = [];
  this.game.player_obj.x = server_response.x;
  this.game.player_obj.y = server_response.y;
  this.game.player_obj.speed_x = server_response.speed_x;
  this.game.player_obj.speed_y = server_response.speed_y;

  // run all frames up to this point
  for (var i = 1; i <= frame_difference; i++) {
    this.frame_run(frame + i);
  }

  return true;
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_objects = function(objects, frame) {
  // check for uncreated objects
  for (var key in objects) {
    if (!this.game.core.state.objects[key]) {
      if (!this.wait_to_create[key] || this.wait_to_create[key] + 40 < frame) {
        delete this.wait_to_create[key];
        this.game.create_object(objects[key]);
      }
    }
  }

  // if there's no corresponding server object
  for (var key in this.game.core.state.objects) {
    if (!objects[key]) {
      // give them a delay
      if (!this.wait_to_destroy[key]) {
        this.wait_to_destroy[key] = frame + 40;
        continue;

        // remove when delay has expired
      } else if (this.wait_to_destroy[key] < frame) {
        delete this.game.core.state.objects[key];
        delete this.wait_to_destroy[key];
      }
    }
  }

  // match up objects
  for (var key in this.game.core.state.objects) {
    // if our player and waiting for action responses
    if (key === "player-" + this.player_id) {
      if (this.store_responses.length !== 0) {
        continue;
      }
    }

    var obj = this.game.core.state.objects[key];
    var res_obj = objects[key];

    // ignore any objects with no reference
    if (!res_obj) {
      continue;
    }

    // match values
    if (obj.type !== res_obj.type) {
      obj.type = res_obj.type;
      obj.c = this.game.c.objects[obj.type];
    }
    obj.grounded = res_obj.grounded;

    // if grounded or us
    if (obj.grounded || obj.player_id === this.player_id) {
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;

      // set interpolation position
    } else if (!obj.actioned) {
      obj.ghost = frame;
      obj.gx = obj.x;
      obj.gy = obj.y;
      obj.x = res_obj.x;
      obj.y = res_obj.y;
      obj.speed_x = res_obj.speed_x;
      obj.speed_y = res_obj.speed_y;
    }
  }
};

/* Resolve objects
    ---------------------------------------- */

multiplayer.prototype.resolve_explosions = function(explosions, frame) {
  // check for uncreated explosions
  for (var key in explosions) {
    if (!this.game.core.state.explosions[key]) {
      this.game.core.create_explosion(explosions[key]);

      // ensure correct position
    } else {
      this.game.core.state.explosions[key].x = explosions[key].x;
      this.game.core.state.explosions[key].y = explosions[key].y;
    }
  }
};

/* ========================================================================
    Game
    Tracker Arrows
 ========================================================================== */

/* Run the arrows
    ---------------------------------------- */

game.prototype.run_arrows = function() {
  for (var type in this.scheme.arrows) {
    var arrow = this.scheme.arrows[type];
    if (!arrow) {
      continue;
    }

    // find closest thing
    var lowest = 99999;
    var closest_obj = null;
    for (var key in this.core.state.objects) {
      var obj = this.core.state.objects[key];
      if (obj.type === "player" && obj.player_id === this.player_id) {
        continue;
      }
      if (obj.type === type) {
        var dist = this.core.map.get_distance(
          obj.x,
          obj.y,
          this.camera.x,
          this.camera.y
        );
        if (dist < lowest) {
          lowest = dist;
          closest_obj = obj;
        }
      }
    }
    if (!closest_obj) {
      continue;
    }

    // get screen position
    var pos = this.screen_position(closest_obj.x, closest_obj.y, 80);
    if (pos.on_screen) {
      continue;
    }

    // show an arrow
    var angle = this.core.map.get_heading(
      this.camera.x,
      this.camera.y,
      closest_obj.x,
      closest_obj.y
    );
    var dist = min(lowest, min(this.canvas.cx, this.canvas.cy)) - 22;
    var xy = xy_speed(angle, dist);
    this.sprites.push({
      type: "arrow-" + arrow,
      x: round(this.camera.x + xy.x),
      y: round(this.camera.y + xy.y),
      angle: angle_add(angle, 270)
    });
  }
};

/* ========================================================================
    Game
    Background Layer
 ========================================================================== */

/* Set up background
    ---------------------------------------- */

game.prototype.init_background = function() {
  this.bg = {};
  this.bg.parallax = 0.5;
  this.bg.x = 0;
  this.bg.y = 0;
  this.bg.w = this.img.bg.width;
  this.bg.h = this.img.bg.height;
  this.bg.pattern = this.canvas.cont.createPattern(this.img.bg, "repeat");
};

/* Draw the background
	---------------------------------------- */

game.prototype.draw_background = function() {
  // how much have we moved by
  var dx =
      this.core.map.get_distance_x(this.camera.x, this.camera.px) *
      this.bg.parallax,
    dy =
      this.core.map.get_distance_y(this.camera.y, this.camera.py) *
      this.bg.parallax;

  // add movement multiplied by parallax degree
  this.bg.x = n_loop(this.bg.x + dx, 0, this.bg.w);
  this.bg.y = n_loop(this.bg.y + dy, 0, this.bg.h);

  // draw it
  var size = max(this.canvas.h, this.canvas.w);
  this.canvas.cont.translate(
    this.bg.x + this.camera.sx,
    this.bg.y + this.camera.sy
  );
  this.canvas.cont.fillStyle = this.bg.pattern;
  this.canvas.cont.fillRect(-size, -size, size * 3, size * 3);
  this.canvas.cont.translate(
    -(this.bg.x + this.camera.sx),
    -(this.bg.y + this.camera.sy)
  );
};

/* ========================================================================
    Game
    Camera Position
 ========================================================================== */

/* Set up camera position
	---------------------------------------- */

game.prototype.init_camera = function() {
  this.camera = {};
  this.camera.x = round(this.map.fg.canv.width / 2);
  this.camera.y = round(this.map.fg.canv.height / 2);
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  // watcher follow player
  this.camera.watch_follow = "leader";
  this.camera.watch_follow_player = "";

  // camera weapon
  this.camera_weapon_key = null;

  // camera shake on hit
  this.camera.shake_frame = null;
  this.camera.sx = 0;
  this.camera.sy = 0;

  // camera focus event
  this.camera.focus = null;
  this.camera.focus_time = 0;
  this.camera.fx = 0;
  this.camera.fy = 0;

  // cursor
  this.cursor = { x: 0, y: 0 };

  // weapon following
  this.weapon_follow = false;
  this.weapon_following = "";
};

/* Switch watcher camera
	---------------------------------------- */

game.prototype.switch_watcher_camera = function() {
  if (!watch) {
    return;
  }
  var keys = Object.keys(this.players);
  var index = keys.indexOf(this.camera.watch_follow_player);
  if (index !== -1) {
    if (index === keys.length - 1) {
      this.camera.watch_follow_player = null;
      this.camera.watch_follow = "leader";
      this.set_alert("Following the Leader", "#ccffcc", 100);
      return;
    } else {
      this.camera.watch_follow_player = keys[index + 1];
    }
  } else {
    this.camera.watch_follow_player = keys[0];
  }
  console.log(this.camera.watch_follow_player);
  var player = this.players[this.camera.watch_follow_player];
  this.camera.watch_follow = "player";
  this.set_alert("Following " + player.name, "#eeeeee", 100);
};

/* Calculate current camera position
	---------------------------------------- */

game.prototype.run_camera = function() {
  // stop following if hit
  if (this.weapon_following && this.player && this.player.hit > 0) {
    this.weapon_following = "";
  }

  // set previous position
  this.camera.px = this.camera.x;
  this.camera.py = this.camera.y;

  var x, y, move;

  // set fallback camera
  var watch_player_id = 0;
  if (this.camera.watch_follow === "leader") {
    watch_player_id = this.leader;
  } else if (this.camera.watch_follow === "player") {
    watch_player_id = this.camera.watch_follow_player;
  }

  // find object to follow
  var follow_obj = this.core.state.objects[this.weapon_following];
  var watch_obj = this.core.state.objects["player-" + watch_player_id];
  if (follow_obj) {
    x = follow_obj.dx;
    y = follow_obj.dy;
    move = 30;
  } else if (this.player_obj) {
    x = this.player_obj.dx;
    y = this.player_obj.dy;
    move = 60;
  } else if (watch_obj) {
    x = watch_obj.dx;
    y = watch_obj.dy;
    move = 30;
  }

  // go to focus event
  if (
    this.camera.focus != null &&
    this.camera.focus < this.core.state.frame &&
    this.camera.focus + this.camera.focus_time > this.core.state.frame
  ) {
    x = this.camera.fx;
    y = this.camera.fy;
    move = 100;

    // follow cursor
  } else if (this.mouse_follow || !move) {
    x = this.cursor.x;
    y = this.cursor.y;
    move =
      this.core.map.get_distance(this.camera.x, this.camera.y, x, y) * 0.05;
  }

  // move towards new position
  if (move) {
    var dx = this.core.map.get_distance_x(this.camera.x, x);
    var dy = this.core.map.get_distance_y(this.camera.y, y);
    var limit = check_speed(dx, dy, move);
    this.camera.x = this.core.map.loop_x(round(this.camera.x + limit.x));
    this.camera.y = this.core.map.loop_y(round(this.camera.y + limit.y));
  }

  // add screen shake
  this.camera.sx = 0;
  this.camera.sy = 0;
  var diff = this.camera.shake_frame
    ? this.core.state.frame - this.camera.shake_frame
    : 0;
  if (diff < 15 && diff > 0) {
    this.camera.sx = cos((diff / 2.5 - 1.5) * pi) * this.camera.shake_size;
    this.camera.sy = sin((diff / 3 - 1) * pi) * this.camera.shake_size;
  }

  // fix cursor input
  this.cursor_map();
};

/* Toggle weapon following
	---------------------------------------- */

game.prototype.toggle_weapon_follow = function(message) {
  this.weapon_follow = !this.weapon_follow;

  if (message) {
    var text = "on";
    if (!this.weapon_follow) {
      text = "off";
      this.weapon_following = "";
    }
    text = "Follow weapons " + text;
    this.set_alert(text, "#eee");
  }
};

/* Toggle mouse following
	---------------------------------------- */

game.prototype.toggle_mouse_follow = function() {
  this.mouse_follow = !this.mouse_follow;
  var text = this.mouse_follow ? "on" : "off";
  text = "Free cam " + text;
  this.set_alert(text, "#eee");
};

game.prototype.cancel_mouse_follow = function() {
  if (this.mouse_follow) {
    this.toggle_mouse_follow();
  }
};

/* Calculate cursor position on map
	---------------------------------------- */

game.prototype.cursor_map = function() {
  var scale_x = this.canvas.canv.offsetWidth / this.canvas.w;
  var scale_y = this.canvas.canv.offsetHeight / this.canvas.h;
  var x1 =
    this.camera.x +
    round((this.input.cursor.x - round(innerWidth / 2)) * scale_x);
  var y1 =
    this.camera.y +
    round((this.input.cursor.y - round(innerHeight / 2)) * scale_y);
  this.cursor.x = this.core.map.loop_x(round(x1));
  this.cursor.y = this.core.map.loop_y(round(y1));
};

/* Screen position of a co-ordinate
	---------------------------------------- */

game.prototype.screen_position = function(x, y, size) {
  var x1 =
      this.canvas.cx +
      this.core.map.get_distance_x(this.camera.x - this.camera.sx, x),
    y1 =
      this.canvas.cy +
      this.core.map.get_distance_y(this.camera.y - this.camera.sy, y),
    on_screen =
      x1 > -size &&
      x1 < this.canvas.w + size &&
      y1 > -size &&
      y1 < this.canvas.h + size;

  return {
    x: x1,
    y: y1,
    on_screen: on_screen
  };
};

/* ========================================================================
    Game
    Main Canvas
 ========================================================================== */

/* Set up canvas
    ---------------------------------------- */

game.prototype.init_canvas = function() {
  // set up main canvas dimensions and position
  var d = select("projectants");
  this.canvas = {};

  // limit game size
  this.canvas.w = d.offsetWidth;
  this.canvas.h = d.offsetHeight;
  if (this.canvas.h < 800) {
    this.canvas.w = round(this.canvas.w * (800 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (800 / this.canvas.h));
  }
  if (this.canvas.h > 1000) {
    this.canvas.w = round(this.canvas.w * (1000 / this.canvas.h));
    this.canvas.h = round(this.canvas.h * (1000 / this.canvas.h));
  }
  this.canvas.cx = round(this.canvas.w / 2);
  this.canvas.cy = round(this.canvas.h / 2);

  // initialise main canvas
  this.canvas.canv = element({ type: "canvas" });
  this.canvas.canv.style.position = "relative";
  this.canvas.cont = this.canvas.canv.getContext("2d");
  this.canvas.canv.width = this.canvas.w;
  this.canvas.canv.height = this.canvas.h;

  append(this.div, this.canvas.canv);
};

/* Frame rendering
    ---------------------------------------- */

game.prototype.run_canvas = function() {
  // clear the canvas
  this.canvas.cont.clearRect(0, 0, this.w, this.h);

  // do the drawing
  this.draw_background();
  this.draw_map();
  this.draw_sprites();
  this.draw_labels();
  this.draw_messages();

  // clear sprites
  this.sprites = [];
};

/* ========================================================================
    Game
    Object Labels
 ========================================================================== */

/* Manage labels
	---------------------------------------- */

game.prototype.run_labels = function() {
  // create labels
  for (key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.c.labels && !this.labels[key]) {
      this.labels[key] = {};
      for (type in obj.c.labels) {
        if (obj.c.labels[type]) {
          this.create_label(this.labels[key], type, key);
        }
      }
    }
  }

  // run through labels
  for (key in this.labels) {
    var obj = this.core.state.objects[key];
    if (!obj) {
      delete this.labels[key];
      continue;
    }
    for (type in this.labels[key]) {
      this.set_label(this.labels[key][type], obj);
    }
  }
};

/* Create label
	---------------------------------------- */

game.prototype.create_label = function(ref, type, key) {
  // check health is active
  if (type === "player_health" && !this.scheme.health) {
    return;
  }

  // create and add to ref object
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  ref[type] = { canv: canv, cont: cont, text: "", key: key, type: type };
};

/* Set label
	---------------------------------------- */

game.prototype.set_label = function(label, obj) {
  // position
  if (label.type === "position") {
    this.set_label_text(label, obj.x + " | " + obj.y);
  }

  // player name
  else if (label.type === "player_name") {
    var player = this.players[obj.player_id];
    if (player) {
      this.set_label_text(label, player.name);
    } else {
      delete this.labels[label.key][label.type];
      return;
    }
  }

  // health bar
  else if (label.type === "player_health") {
    this.set_label_health(label, obj.player_id);
  }

  // timeout
  else if (label.type === "timeout") {
    this.set_label_text(
      label,
      ceil((obj.c.timeout - (this.core.state.frame - obj.frame)) / 24)
    );
  }
};

/* Set text label
	---------------------------------------- */

game.prototype.set_label_text = function(label, text) {
  // prep text
  text = String(text);
  text = str_space(text);

  // if there's no change to text
  if (label.text === text) {
    return;
  }

  // draw text
  label.w = label.cont.measureText(text).width + 9;
  label.h = 18;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.restore();
  label.cont.clearRect(0, 0, label.canv.width, label.canv.height);
  label.cont.font = "12px 'Orbitron'";
  label.cont.fillStyle = "#000";
  label.cont.filter = "drop-shadow(0 2px 4px #000)";
  label.cont.fillText(text, 4, 14 + 0.5);
  label.cont.fillStyle = "#ddd";
  label.cont.fillText(text, 4, 12 + 0.5);
  label.cont.save();
};

/* Set health label
	---------------------------------------- */

game.prototype.set_label_health = function(label, player_id) {
  if (!this.scheme.health) {
    return;
  }

  var player = this.core.state.players[player_id];
  if (!player) {
    delete this.labels[label.key][label.type];
    return;
  }

  // are we doing anything at all
  var level = this.scheme.levels.health[player.level];
  if (!level) {
    return;
  }

  // is it the same
  var text = player.health + " / " + level;
  if (text === label.text) {
    return;
  }
  label.text = text;

  // draw label
  label.w = round(level / 2) + 6;
  label.h = 8;
  label.canv.width = label.w;
  label.canv.height = label.h;
  label.cont.fillStyle = "rgba(255,255,255,0.1)";
  label.cont.fillRect(0, 0, label.w, label.h);
  label.cont.fillStyle = "rgba(0,0,0,0.8)";
  label.cont.fillRect(1, 1, label.w - 2, label.h - 2);
  label.cont.fillStyle = "#e41a1a";
  label.cont.fillRect(3, 3, round(player.health / 2), 2);

  // are we hiding it
  label.hide = player.dead;
};

/* Draw labels
	---------------------------------------- */

game.prototype.draw_labels = function() {
  // go through all labels
  for (key in this.labels) {
    // ignore empties or hiddens
    if (!this.labels[key]) {
      continue;
    }

    // get screen position of object
    var obj = this.core.state.objects[key];
    var position = this.screen_position(obj.dx, obj.dy, 50);

    // ignore too far away objects
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var n = 0;
    for (type in this.labels[key]) {
      var label = this.labels[key][type];
      if (label.hide) {
        continue;
      }
      var x = round(position.x - label.w / 2) + 0;
      var y =
        round(position.y - label.h / 2 - obj.c.size * 2 - (label.h - 5) * n) -
        20;
      this.canvas.cont.drawImage(label.canv, x, y);
      n++;
    }
  }
};

/* ========================================================================
    Game
    Map Graphics
 ========================================================================== */

/* Set up the map canvases
	---------------------------------------- */

game.prototype.init_map = function() {
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* Draw the map
	---------------------------------------- */

game.prototype.draw_map = function() {
  var x = this.canvas.cx - this.camera.x + this.camera.sx;
  var y = this.canvas.cy - this.camera.y + this.camera.sy;

  // draw layers
  this.draw_repeating_layer(this.map.bg.canv, x, y);
  this.draw_repeating_layer(this.map.fg.canv, x, y);
};

/* Draw layer canvas repeating on all sides
	---------------------------------------- */

game.prototype.draw_repeating_layer = function(canv, x, y) {
  this.canvas.cont.drawImage(canv, x - canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x, y - canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y - canv.height);
  this.canvas.cont.drawImage(canv, x - canv.width, y);
  this.canvas.cont.drawImage(canv, x + canv.width, y);
  this.canvas.cont.drawImage(canv, x - canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y + canv.height);
  this.canvas.cont.drawImage(canv, x + canv.width, y + canv.height);
  this.canvas.cont.drawImage(canv, x, y);
};

/* Destroy land on the map
	---------------------------------------- */

game.prototype.destroy_land = function(x, y, size) {
  this.map.fg.cont.beginPath();
  this.map.fg.cont.arc(x, y, size, 0, 2 * pi);
  this.map.fg.cont.fill();
};

/* Get a piece of land
	---------------------------------------- */

game.prototype.get_land_block = function(x, y, w, h) {
  var canv = element({ type: "canvas" });
  var cont = canv.getContext("2d");
  canv.width = w;
  canv.height = h;
  cont.drawImage(this.map.fg.canv, x, y, w, h, 0, 0, w, h);

  return canv;
};

/* Draw piece of land
	---------------------------------------- */

game.prototype.draw_land_block = function(x, y, canv) {
  this.map.fg.cont.globalCompositeOperation = "normal";
  this.map.fg.cont.drawImage(canv, x, y);
  this.map.fg.cont.globalCompositeOperation = "destination-out";
};

/* ========================================================================
    Game
    Object Messages
 ========================================================================== */

/* Draw the messages
	---------------------------------------- */

game.prototype.draw_messages = function() {
  // go through messages
  for (var i = 0; i < this.messages.length; i++) {
    var message = this.messages[i];

    // increment time
    message.time++;
    if (message.time > 40) {
      this.messages.splice(i, 1);
      continue;
    }

    // get screen position of message
    var position = this.screen_position(message.x, message.y, 50);

    // ignore too far away messages
    if (!position.on_screen) {
      continue;
    }

    // go through labels
    var x = round(position.x - message.w / 2) + 0.5;
    var y = round(position.y - message.h / 2) - 30.5 - message.time;

    this.canvas.cont.save();
    this.canvas.cont.translate(0, 0);
    this.canvas.cont.drawImage(message.canv, x, y);
    this.canvas.cont.restore();
  }
};

/* Look for changes in health
	---------------------------------------- */

game.prototype.create_message = function(obj, col, text, size, y_offset) {
  // set up canvas
  var message = {};
  message.canv = element({ type: "canvas" });
  message.cont = message.canv.getContext("2d");

  // draw text
  text = str_space(text);
  message.cont.font = size + "px Orbitron";
  message.w = round(message.cont.measureText(text).width) + 8;
  message.h = size + 4;
  message.canv.width = message.w;
  message.canv.height = message.h;
  message.cont.font = size + "px Orbitron";
  // message.cont.fillStyle = "#000";
  // message.cont.fillText(text, 3.5, size + 0.5);
  message.cont.fillStyle = col;
  message.cont.fillText(text, 3.5, size + 0.5);

  // set position
  var y_offset = y_offset || 0;
  message.x = obj.x;
  message.y = obj.y + y_offset;
  message.time = 0;

  // add to array
  this.messages.push(message);
};

/* ========================================================================
    Game
    Sprites
 ========================================================================== */

/* Run sprites
	---------------------------------------- */

game.prototype.draw_sprites = function() {
  this.sprites = [];

  // objects
  for (var key in this.core.state.objects) {
    var obj = this.core.state.objects[key];
    if (obj.hide > 0) {
      obj.hide--;
      continue;
    }
    if (obj.type === "player") {
      var player = this.core.state.players[obj.player_id];
      if (player) {
        if (player.hit > 0) {
          this.draw_player_hit_sprites(obj, player.hit);
        } else {
          this.draw_player_sprites(obj, player);
        }
      }
      continue;
    }
    var args = {
      frame: obj.frame,
      type: obj.sprite_key,
      x: obj.dx,
      y: obj.dy,
      angle: obj.display_angle,
      animate: obj.animate,
      float: obj.c.animation.air_float,
      repeat: true
    };
    this.sprites.unshift(args);
  }

  // explosions
  for (var key in this.explosions) {
    var obj = this.explosions[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      animate: true
    };
    this.sprites.push(args);
  }

  // decorations
  for (var key in this.decorations) {
    var obj = this.decorations[key];
    var args = {
      frame: obj.frame,
      type: obj.sprite,
      x: obj.x,
      y: obj.y,
      angle: obj.angle,
      animate: true,
      repeat: obj.repeat
    };
    this.sprites.unshift(args);
  }

  // get arrows
  this.run_arrows();

  // draw them
  this.draw_sprites_canv();
};

/* Player sprites
	---------------------------------------- */

game.prototype.draw_player_sprites = function(obj, player) {
  var w =
    this.player_id === obj.player_id ? this.current_weapon : player.weapon;
  var weapon = this.c.weapons[w];

  // body
  this.sprites.push({
    frame: obj.frame,
    type: obj.sprite_key,
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // get head direction and angle
  var head_dir = obj.direction;
  if (obj.grounded) {
    var diff = n_diff(
      obj.barrel_angle,
      angle_add(obj.display_angle, 90),
      0,
      360
    );
    head_dir = diff >= -180 && diff < 0 ? "right" : "left";
  }
  var head_angle =
    head_dir === "right" ? angle_add(obj.barrel_angle, 180) : obj.barrel_angle;

  // weapons
  var weapon_sprite = "";
  if (weapon && weapon.sprite) {
    var weapon_sprite = weapon.sprite;
    var weapon_frame = 0;
    var throwing = weapon.sprite === "throw";

    // just fired sprites
    if (obj.fire_sprite_count) {
      weapon_sprite = weapon.fire_sprite;
      weapon_frame = obj.fire_sprite_frame;
      throwing = false;
    }

    // add the weapon sprite
    this.sprites.push({
      type: "ant-weapon-" + weapon_sprite + "-" + head_dir,
      x: this.core.map.loop_x(obj.dx),
      y: this.core.map.loop_y(obj.dy),
      frame: weapon_frame,
      animate: true,
      repeat: true,
      angle: head_angle
    });
  }

  // head
  this.sprites.push({
    type: "ant-head-" + head_dir,
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: head_angle
  });

  // add a throw weapon
  if (throwing) {
    var tobj = this.c.objects[weapon.object];
    var tsprite = tobj.animation.sprite;
    var toff_x = xy_speed(obj.barrel_angle, -16);
    var toff_y = xy_speed(angle_add(head_angle, 90), 14);
    this.sprites.push({
      type: tsprite,
      x: this.core.map.loop_x(obj.dx + toff_x.x + toff_y.x),
      y: this.core.map.loop_y(obj.dy + toff_x.y + toff_y.y),
      animate: false,
      angle: angle_add(obj.barrel_angle, 90)
    });
  }

  // // set crosshair
  // if (this.player_id === obj.player_id) {
  // 	var offx = xy_speed(angle, 50 + weapon.offset_x);
  // 	var offy = xy_speed(offset_angle, 7);
  // 	this.sprites.push({
  // 		type: "crosshair",
  // 		x: round(obj.dx + offx.x + offy.x),
  // 		y: round(obj.dy + offx.y + offy.y),
  // 		angle: angle_add(this.crosshair, 180)
  // 	});
  // }
};

/* Player hit sprites
	---------------------------------------- */

game.prototype.draw_player_hit_sprites = function(obj, hit) {
  // body
  this.sprites.push({
    frame: obj.frame,
    type: hit < 15 ? "ant-body-air-left" : "ant-body-hit",
    x: obj.dx,
    y: obj.dy,
    angle: obj.display_angle,
    animate: obj.animate,
    repeat: true
  });

  // head
  this.sprites.push({
    type: hit < 15 ? "ant-head-left" : "ant-head-hit",
    x: this.core.map.loop_x(obj.dx),
    y: this.core.map.loop_y(obj.dy),
    animate: true,
    repeat: true,
    angle: obj.display_angle
  });
};

/* Draw sprites on the canvas
	---------------------------------------- */

game.prototype.draw_sprites_canv = function() {
  for (var i = 0; i < this.sprites.length; i++) {
    var sprite = this.sprites[i];

    // get position on screen
    var screen_position = this.screen_position(sprite.x, sprite.y, 48);
    if (!screen_position.on_screen) {
      continue;
    }

    // get sprite key
    var sprite_key = sprite.type;
    var animation = this.c.animations[sprite_key];
    if (animation) {
      sprite_key = animation[0];
      if (sprite.animate) {
        var frame = sprite.frame || 0;
        frame = floor((this.core.state.frame - frame) / 2);
        if (sprite.repeat) {
          frame = frame % animation.length;
        }
        sprite_key = animation[frame];
      }
    }

    // get sprite reference positions
    var sprite_ref = this.c.sprites[sprite_key];
    if (!sprite_ref) {
      continue;
    }

    // get new position to draw on
    var size = sprite_ref.size;
    var pos = -(size / 2);

    // float effect
    var y_add = 0;
    if (sprite.float) {
      y_add = cos((this.core.state.frame - sprite.frame) / 4) * 2;
    }

    // draw it
    this.canvas.cont.save();
    this.canvas.cont.translate(screen_position.x, screen_position.y + y_add);
    if (sprite.angle !== 0) {
      this.canvas.cont.rotate((sprite.angle * Math.PI) / 180);
    }
    this.canvas.cont.drawImage(
      this.img.sprites,
      sprite_ref.x,
      sprite_ref.y,
      size,
      size,
      pos,
      pos,
      size,
      size
    );
    this.canvas.cont.translate(
      -screen_position.x,
      -(screen_position.y + y_add)
    );
    this.canvas.cont.restore();
  }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9hbmltYXRpb25zLmpzIiwiY29uZmlnL21hcGdlbi5qcyIsImNvbmZpZy9uYW1lcy5qcyIsImNvbmZpZy9vYmplY3RzLmpzIiwiY29uZmlnL3Nwcml0ZXMuanMiLCJjb25maWcvd2VhcG9ucy5qcyIsImVuZ2luZS9hY3Rpb25zLmpzIiwiZW5naW5lL2NvbGxpc2lvbnMuanMiLCJlbmdpbmUvY29yZS5qcyIsImVuZ2luZS9ldmVudHMuanMiLCJlbmdpbmUvZXhwbG9zaW9ucy5qcyIsImVuZ2luZS9vYmplY3RzLmpzIiwiZW5naW5lL3BoeXNpY3MuanMiLCJlbmdpbmUvcGxheWVycy5qcyIsImVuZ2luZS9zdGF0ZXMuanMiLCJoZWxwZXJzL2RlZXBtZXJnZS5qcyIsImhlbHBlcnMvbWF0aC5qcyIsImhlbHBlcnMvbWlzYy5qcyIsInNjaGVtZXMvZGVhdGhtYXRjaC5qcyIsInNjaGVtZXMvZGVmYXVsdC5qcyIsIm1hcGdlbi9ibG9icy5qcyIsIm1hcGdlbi9jYW52YXMuanMiLCJtYXBnZW4vbWFwZ2VuLmpzIiwiZW5naW5lL21hcC9ncmF2aXR5LmpzIiwiZW5naW5lL21hcC9ncm91bmQuanMiLCJlbmdpbmUvbWFwL21hcC5qcyIsImFwcC5qcyIsImV2ZW50cy5qcyIsImludGVyZmFjZS5qcyIsInNldHRpbmdzLmpzIiwic3RhcnQuanMiLCJkZW1vL2RlbW8uanMiLCJkZW1vL2V2ZW50cy5qcyIsImRlbW8vZnJhbWVzLmpzIiwiZ2FtZS9hbGVydC5qcyIsImdhbWUvYXJtb3VyeS5qcyIsImdhbWUvYXVkaW8uanMiLCJnYW1lL2Nyb3NzaGFpci5qcyIsImdhbWUvZGVjb3JhdGlvbnMuanMiLCJnYW1lL2V2ZW50cy5qcyIsImdhbWUvZXhwbG9zaW9ucy5qcyIsImdhbWUvZ2FtZS5qcyIsImdhbWUvaW5wdXQuanMiLCJnYW1lL29iamVjdHMuanMiLCJnYW1lL3BsYXllcnMuanMiLCJnYW1lL3Njb3JlLmpzIiwiZ2FtZS90aW1lLmpzIiwibW9kdWxlcy9hdWRpby5qcyIsIm1vZHVsZXMvZWxlbWVudHMuanMiLCJtb2R1bGVzL2lucHV0LmpzIiwibW9kdWxlcy9sb2FkZXIuanMiLCJtb2R1bGVzL29uYm9hcmRpbmcuanMiLCJtb2R1bGVzL3NvY2tldHMuanMiLCJtdWx0aXBsYXllci9kZWF0aHMuanMiLCJtdWx0aXBsYXllci9ldmVudHMuanMiLCJtdWx0aXBsYXllci9mcmFtZXMuanMiLCJtdWx0aXBsYXllci9ncm91bmQuanMiLCJtdWx0aXBsYXllci9pbnRlcmZhY2UuanMiLCJtdWx0aXBsYXllci9tdWx0aXBsYXllci5qcyIsIm11bHRpcGxheWVyL3BsYXllcnMuanMiLCJtdWx0aXBsYXllci9zdGF0ZXMuanMiLCJnYW1lL2NhbnZhcy9hcnJvd3MuanMiLCJnYW1lL2NhbnZhcy9iYWNrZ3JvdW5kLmpzIiwiZ2FtZS9jYW52YXMvY2FtZXJhLmpzIiwiZ2FtZS9jYW52YXMvY2FudmFzLmpzIiwiZ2FtZS9jYW52YXMvbGFiZWxzLmpzIiwiZ2FtZS9jYW52YXMvbWFwLmpzIiwiZ2FtZS9jYW52YXMvbWVzc2FnZXMuanMiLCJnYW1lL2NhbnZhcy9zcHJpdGVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0bEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdjRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9lQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5WkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDalRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdlNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcuYW5pbWF0aW9ucyA9IHtcbiAgXCJhbnQtYm9keS1oaXRcIjogW1xuICAgIFwiYW50LWJvZHktaGl0LTFcIixcbiAgICBcImFudC1ib2R5LWhpdC0yXCIsXG4gICAgXCJhbnQtYm9keS1oaXQtMVwiLFxuICAgIFwiYW50LWJvZHktaGl0LTNcIlxuICBdLFxuICBcImFudC1ib2R5LXN0aWxsLWxlZnRcIjogW1wiYW50LWJvZHktd2Fsay1sZWZ0LTFcIl0sXG4gIFwiYW50LWJvZHktc3RpbGwtcmlnaHRcIjogW1wiYW50LWJvZHktd2Fsay1yaWdodC0xXCJdLFxuICBcImFudC1ib2R5LXdhbGstbGVmdFwiOiBbXG4gICAgXCJhbnQtYm9keS13YWxrLWxlZnQtMlwiLFxuICAgIFwiYW50LWJvZHktd2Fsay1sZWZ0LTNcIixcbiAgICBcImFudC1ib2R5LXdhbGstbGVmdC00XCIsXG4gICAgXCJhbnQtYm9keS13YWxrLWxlZnQtNVwiXG4gIF0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodFwiOiBbXG4gICAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTJcIixcbiAgICBcImFudC1ib2R5LXdhbGstcmlnaHQtM1wiLFxuICAgIFwiYW50LWJvZHktd2Fsay1yaWdodC00XCIsXG4gICAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTVcIlxuICBdLFxuICBcImFudC1oZWFkLWxlZnRcIjogW1xuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0xXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTFcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMVwiLFxuICAgIFwiYW50LWhlYWQtbGVmdC0yXCIsXG4gICAgXCJhbnQtaGVhZC1sZWZ0LTNcIixcbiAgICBcImFudC1oZWFkLWxlZnQtMlwiXG4gIF0sXG4gIFwiYW50LWhlYWQtcmlnaHRcIjogW1xuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMVwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMlwiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtM1wiLFxuICAgIFwiYW50LWhlYWQtcmlnaHQtMlwiXG4gIF0sXG4gIFwiYW50LWhlYWQtaGl0XCI6IFtcImFudC1oZWFkLWhpdC0xXCIsIFwiYW50LWhlYWQtaGl0LTJcIiwgXCJhbnQtaGVhZC1oaXQtM1wiXSxcbiAgXCJhbnQtd2VhcG9uLWJhem9va2EtbGVmdFwiOiBbXCJhbnQtd2VhcG9uLWJhem9va2EtbGVmdFwiXSxcbiAgXCJhbnQtd2VhcG9uLWJhem9va2EtcmlnaHRcIjogW1wiYW50LXdlYXBvbi1iYXpvb2thLXJpZ2h0XCJdLFxuICBcImFudC13ZWFwb24tbGFzZXItbGVmdFwiOiBbXCJhbnQtd2VhcG9uLWxhc2VyLWxlZnRcIl0sXG4gIFwiYW50LXdlYXBvbi1sYXNlci1yaWdodFwiOiBbXCJhbnQtd2VhcG9uLWxhc2VyLXJpZ2h0XCJdLFxuICBcImFudC13ZWFwb24tdGhyb3ctbGVmdFwiOiBbXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiXSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWZpcmUtbGVmdFwiOiBbXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMlwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTNcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC00XCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1sZWZ0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctbGVmdC0xXCJcbiAgXSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0XCI6IFtcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiXSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWZpcmUtcmlnaHRcIjogW1xuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0yXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTNcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtNFwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC01XCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiLFxuICAgIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0xXCIsXG4gICAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIixcbiAgICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtMVwiXG4gIF0sXG4gIFwiYW50LXdlYXBvbi1kaWctbGVmdFwiOiBbXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTFcIl0sXG4gIFwiYW50LXdlYXBvbi1kaWctZmlyZS1sZWZ0XCI6IFtcbiAgICBcImFudC13ZWFwb24tZGlnLWxlZnQtMlwiLFxuICAgIFwiYW50LXdlYXBvbi1kaWctbGVmdC0zXCIsXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTRcIlxuICBdLFxuICBcImFudC13ZWFwb24tZGlnLXJpZ2h0XCI6IFtcImFudC13ZWFwb24tZGlnLXJpZ2h0LTFcIl0sXG4gIFwiYW50LXdlYXBvbi1kaWctZmlyZS1yaWdodFwiOiBbXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0yXCIsXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0zXCIsXG4gICAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC00XCJcbiAgXSxcbiAgXCJhbnQtZ2hvc3RcIjogW1xuICAgIFwiYW50LWdob3N0LTFcIixcbiAgICBcImFudC1naG9zdC0xXCIsXG4gICAgXCJhbnQtZ2hvc3QtMlwiLFxuICAgIFwiYW50LWdob3N0LTJcIixcbiAgICBcImFudC1naG9zdC0zXCIsXG4gICAgXCJhbnQtZ2hvc3QtM1wiLFxuICAgIFwiYW50LWdob3N0LTJcIixcbiAgICBcImFudC1naG9zdC0yXCJcbiAgXSxcbiAgXCJidWJibGUtYmx1ZVwiOiBbXG4gICAgXCJiYWxsLWJsdWUtMVwiLFxuICAgIFwiYmFsbC1ibHVlLTJcIixcbiAgICBcImJhbGwtYmx1ZS0zXCIsXG4gICAgXCJiYWxsLWJsdWUtNFwiLFxuICAgIFwiYmFsbC1ibHVlLTVcIlxuICBdLFxuICBcImV4cGxvc2lvbi1sXCI6IFtcbiAgICBcImV4cGxvc2lvbi1sLTFcIixcbiAgICBcImV4cGxvc2lvbi1sLTJcIixcbiAgICBcImV4cGxvc2lvbi1sLTNcIixcbiAgICBcImV4cGxvc2lvbi1sLTRcIixcbiAgICBcImV4cGxvc2lvbi1sLTVcIixcbiAgICBcImV4cGxvc2lvbi1sLTZcIixcbiAgICBcImV4cGxvc2lvbjItbC01XCIsXG4gICAgXCJleHBsb3Npb24yLWwtNlwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTdcIixcbiAgICBcImV4cGxvc2lvbjItbC04XCJcbiAgXSxcbiAgXCJleHBsb3Npb24yLWxcIjogW1xuICAgIFwiZXhwbG9zaW9uMi1sLTFcIixcbiAgICBcImV4cGxvc2lvbjItbC0yXCIsXG4gICAgXCJleHBsb3Npb24yLWwtM1wiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTRcIixcbiAgICBcImV4cGxvc2lvbjItbC01XCIsXG4gICAgXCJleHBsb3Npb24yLWwtNlwiLFxuICAgIFwiZXhwbG9zaW9uMi1sLTdcIixcbiAgICBcImV4cGxvc2lvbjItbC04XCJcbiAgXSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbFwiOiBbXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC0xXCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC0yXCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC0zXCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC00XCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC01XCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC02XCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC03XCIsXG4gICAgXCJleHBsb3Npb24tZ3JlZW4tbC04XCJcbiAgXSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZVwiOiBbXG4gICAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0xXCIsXG4gICAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0yXCIsXG4gICAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0zXCIsXG4gICAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS00XCIsXG4gICAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS01XCJcbiAgXSxcbiAgZmxhbWU6IFtcImZsYW1lLTFcIiwgXCJmbGFtZS0yXCIsIFwiZmxhbWUtM1wiLCBcImZsYW1lLTRcIiwgXCJmbGFtZS01XCJdLFxuICBcImZsYW1lLWxhcmdlXCI6IFtcbiAgICBcImZsYW1lLWxhcmdlLTFcIixcbiAgICBcImZsYW1lLWxhcmdlLTJcIixcbiAgICBcImZsYW1lLWxhcmdlLTNcIixcbiAgICBcImZsYW1lLWxhcmdlLTRcIixcbiAgICBcImZsYW1lLWxhcmdlLTVcIixcbiAgICBcImZsYW1lLWxhcmdlLTZcIlxuICBdLFxuICBmb2N1czogW1xuICAgIFwiZm9jdXMtMVwiLFxuICAgIFwiZm9jdXMtMlwiLFxuICAgIFwiZm9jdXMtM1wiLFxuICAgIFwiZm9jdXMtNFwiLFxuICAgIFwiZm9jdXMtNVwiLFxuICAgIFwiZm9jdXMtNlwiLFxuICAgIFwiZm9jdXMtN1wiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiLFxuICAgIFwiZm9jdXMtOFwiXG4gIF0sXG4gIFwiZ2VtLWdyZWVuXCI6IFtcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0xXCIsXG4gICAgXCJnZW0tZ3JlZW4tMVwiLFxuICAgIFwiZ2VtLWdyZWVuLTFcIixcbiAgICBcImdlbS1ncmVlbi0yXCIsXG4gICAgXCJnZW0tZ3JlZW4tM1wiLFxuICAgIFwiZ2VtLWdyZWVuLTRcIlxuICBdLFxuICBcImdlbS1ibHVlXCI6IFtcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTFcIixcbiAgICBcImdlbS1ibHVlLTJcIixcbiAgICBcImdlbS1ibHVlLTNcIixcbiAgICBcImdlbS1ibHVlLTRcIlxuICBdLFxuICBcImdlbS1yZWRcIjogW1xuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0xXCIsXG4gICAgXCJnZW0tcmVkLTFcIixcbiAgICBcImdlbS1yZWQtMVwiLFxuICAgIFwiZ2VtLXJlZC0yXCIsXG4gICAgXCJnZW0tcmVkLTNcIixcbiAgICBcImdlbS1yZWQtNFwiXG4gIF0sXG4gIFwiZ2VtLXB1cnBsZVwiOiBbXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTFcIixcbiAgICBcImdlbS1wdXJwbGUtMVwiLFxuICAgIFwiZ2VtLXB1cnBsZS0xXCIsXG4gICAgXCJnZW0tcHVycGxlLTJcIixcbiAgICBcImdlbS1wdXJwbGUtM1wiLFxuICAgIFwiZ2VtLXB1cnBsZS00XCJcbiAgXSxcbiAgXCJnZW0tc2lsdmVyXCI6IFtcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMVwiLFxuICAgIFwiZ2VtLXNpbHZlci0xXCIsXG4gICAgXCJnZW0tc2lsdmVyLTFcIixcbiAgICBcImdlbS1zaWx2ZXItMlwiLFxuICAgIFwiZ2VtLXNpbHZlci0zXCIsXG4gICAgXCJnZW0tc2lsdmVyLTRcIlxuICBdLFxuICBcImdyZW5hZGUtYXJtZWRcIjogW1xuICAgIFwiZ3JlbmFkZS1ncmVlblwiLFxuICAgIFwiZ3JlbmFkZS1yZWRcIixcbiAgICBcImdyZW5hZGUtcmVkXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCIsXG4gICAgXCJncmVuYWRlLWdyZWVuXCJcbiAgXSxcbiAgXCJtaW5lLWFjdGl2ZVwiOiBbXG4gICAgXCJtaW5lLXJlZFwiLFxuICAgIFwibWluZS1yZWRcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiLFxuICAgIFwibWluZS1ncmV5XCIsXG4gICAgXCJtaW5lLWdyZXlcIixcbiAgICBcIm1pbmUtZ3JleVwiXG4gIF0sXG4gIFwic21va2UtZ3JlZW5cIjogW1xuICAgIFwic21va2UtZ3JlZW4tMVwiLFxuICAgIFwic21va2UtZ3JlZW4tMlwiLFxuICAgIFwic21va2UtZ3JlZW4tM1wiLFxuICAgIFwic21va2UtZ3JlZW4tNFwiLFxuICAgIFwic21va2UtZ3JlZW4tNVwiLFxuICAgIFwic21va2UtZ3JlZW4tNlwiLFxuICAgIFwic21va2UtZ3JlZW4tN1wiLFxuICAgIFwic21va2UtZ3JlZW4tOFwiXG4gIF0sXG4gIHRlbGVwb3J0OiBbXG4gICAgXCJ0ZWxlcG9ydC0xXCIsXG4gICAgXCJ0ZWxlcG9ydC0yXCIsXG4gICAgXCJ0ZWxlcG9ydC0zXCIsXG4gICAgXCJ0ZWxlcG9ydC00XCIsXG4gICAgXCJ0ZWxlcG9ydC01XCIsXG4gICAgXCJ0ZWxlcG9ydC02XCIsXG4gICAgXCJ0ZWxlcG9ydC03XCJcbiAgXSxcbiAgdm9ydGV4OiBbXG4gICAgXCJ2b3J0ZXgtMVwiLFxuICAgIFwidm9ydGV4LTJcIixcbiAgICBcInZvcnRleC0zXCIsXG4gICAgXCJ2b3J0ZXgtNFwiLFxuICAgIFwidm9ydGV4LTVcIixcbiAgICBcInZvcnRleC02XCIsXG4gICAgXCJ2b3J0ZXgtN1wiLFxuICAgIFwidm9ydGV4LThcIixcbiAgICBcInZvcnRleC0xMFwiLFxuICAgIFwidm9ydGV4LTExXCJcbiAgXVxufTtcbiIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcubWFwZ2VuID0ge1xuICBsYW5kX3R5cGU6IFtcbiAgICB7XG4gICAgICBlZGdlOiAxLFxuICAgICAgYmc6IFwiZGlydFwiLFxuICAgICAgZmc6IFwicm9ja1wiLFxuICAgICAgZGVjb3JhdGlvbnM6IHtcbiAgICAgICAgXCIxXCI6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA0MzIsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogMzYsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNDY4LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDUwNCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiAzNixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA1NDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogMzYsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogNTc2LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDM2LFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIFwiMlwiOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiA3MixcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiAxNDQsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogMjE2LFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHc6IDcyLFxuICAgICAgICAgICAgaDogNzJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDI4OCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB3OiA3MixcbiAgICAgICAgICAgIGg6IDcyXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB4OiAzNjAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdzogNzIsXG4gICAgICAgICAgICBoOiA3MlxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIH1cbiAgXVxufTtcbiIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcubmFtZXMgPSBbXG4gIFwiRGF2ZSBMaXN0ZXJcIixcbiAgXCJBY2UgUmltbWVyXCIsXG4gIFwiUXVlZWcgNTAwXCIsXG4gIFwiQWJyYWRvbGYgTGluY2xlclwiLFxuICBcIkJlYXJkbGVzcyBSaWtlclwiLFxuICBcIlRoZSBBbnQgV2l0aCBObyBOYW1lXCIsXG4gIFwiQWwgQ2Fwb25lXCIsXG4gIFwiVGhlIFF1ZWVuXCIsXG4gIFwiTWlja2V5IEV5ZXNcIlxuXTtcbiIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcub2JqZWN0cyA9IHtcbiAgZGVmYXVsdDoge1xuICAgIHNpemU6IDEsXG4gICAgd2VpZ2h0OiAwLFxuICAgIGJvdW5jZTogMC40LFxuICAgIHRpbWVvdXQ6IDAsXG4gICAgZGFtYWdlOiAzMCxcbiAgICBrbm9jazogMSxcbiAgICBzcGF3bjogZmFsc2UsXG4gICAgcGxheWVyX2xvY2s6IGZhbHNlLFxuICAgIGxhdW5jaF9kaXN0YW5jZTogMixcbiAgICBkZXN0cm95X2dyb3VuZDogdHJ1ZSxcbiAgICBzdG9wOiAwLFxuICAgIGlnbm9yZV9sZXZlbF9kYW1hZ2U6IGZhbHNlLFxuICAgIGV2ZW50czoge1xuICAgICAgZnJhbWU6IFwiXCIsXG4gICAgICBncm91bmQ6IFwiXCIsXG4gICAgICBvYmplY3Q6IFwiXCIsXG4gICAgICBleHBsb3Npb246IFwiXCIsXG4gICAgICBkaWU6IFwiXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHt9LFxuICAgIHNwZWVkOiB7XG4gICAgICBtYXhfZ3Jhdml0eTogMzAsXG4gICAgICBtYXg6IDQwLFxuICAgICAgbW92ZTogNCxcbiAgICAgIGp1bXA6IDEwXG4gICAgfSxcbiAgICBjbHVzdGVyOiB7XG4gICAgICBjaXJjbGU6IHRydWUsXG4gICAgICBvYmplY3Q6IFwiZ3JlbmFkZVwiLFxuICAgICAgc3BlZWQ6IDIsXG4gICAgICBjb3VudDogNlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uLWxcIixcbiAgICAgIHNwcml0ZTogXCJcIixcbiAgICAgIGFpcl9zcGluOiBmYWxzZSxcbiAgICAgIGFpcl9mbG9hdDogZmFsc2UsXG4gICAgICBzdGF0aWNfYW5nbGU6IGZhbHNlLFxuICAgICAgZ3JvdW5kOiBmYWxzZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb25cIixcbiAgICAgIGJvdW5jZTogXCJkb25rXCIsXG4gICAgICBoaXQ6IFwiXCIsXG4gICAgICBhaXI6IFwiXCIsXG4gICAgICB3YWxrOiBcIndhbGtcIlxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICBwbGF5ZXJfaGVhbHRoOiBmYWxzZSxcbiAgICAgIHBsYXllcl9uYW1lOiBmYWxzZSxcbiAgICAgIHRpbWVvdXQ6IGZhbHNlXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAwLFxuICAgICAgc3BlZWQ6IDAuNixcbiAgICAgIG9mZnNldF94OiAwLFxuICAgICAgb2Zmc2V0X3k6IDAsXG4gICAgICB0aW1lb3V0OiAwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiXCJcbiAgICB9XG4gIH0sXG4gIHBsYXllcjoge1xuICAgIHNpemU6IDEyLFxuICAgIHdlaWdodDogMC43LFxuICAgIGJvdW5jZTogMC43LFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcInBsYXllcl9ib3VuY2VcIixcbiAgICAgIGV4cGxvc2lvbjogXCJoaXRfcmVjZWl2ZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBjcmF0ZTogXCJjb2xsZWN0XCIsXG4gICAgICBtZWRwYWNrOiBcImNvbGxlY3RcIixcbiAgICAgIFwiZ2VtLTFcIjogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS01XCI6IFwiY29sbGVjdFwiLFxuICAgICAgXCJnZW0tMjBcIjogXCJjb2xsZWN0XCIsXG4gICAgICBcImdlbS01MFwiOiBcImNvbGxlY3RcIixcbiAgICAgIFwiZ2VtLTIwMFwiOiBcImNvbGxlY3RcIixcbiAgICAgIHZvcnRleDogXCJjb2xsZWN0XCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImFudC1ib2R5XCIsXG4gICAgICBhaXJfc3BpbjogZmFsc2UsXG4gICAgICBncm91bmQ6IGZhbHNlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYm91bmNlOiBcImRvaW5rXCIsXG4gICAgICBleHBsb3Npb246IFwicG9wXCJcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgcGxheWVyX2hlYWx0aDogdHJ1ZSxcbiAgICAgIHBsYXllcl9uYW1lOiB0cnVlXG4gICAgfVxuICB9LFxuICBwbGF5ZXJfbWlzc2lsZToge1xuICAgIHNpemU6IDEyLFxuICAgIHdlaWdodDogMC43LFxuICAgIGRhbWFnZTogNTAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFtcImJvdW5jZV9leHBsb2RlXCIsIFwic3Bhd25fZ2hvc3RcIl0sXG4gICAgICBleHBsb3Npb246IFtcImJvdW5jZV9leHBsb2RlXCIsIFwic3Bhd25fZ2hvc3RcIl1cbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogW1wiYm91bmNlX2V4cGxvZGVcIiwgXCJzcGF3bl9naG9zdFwiXVxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiYW50LWJvbWJcIixcbiAgICAgIGFpcl9zcGluOiB0cnVlXG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHBsYXllcl9uYW1lOiB0cnVlXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgc3BlZWQ6IDAuNixcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgc3ByaXRlOiBcImJhbGwtcmVkXCJcbiAgICB9XG4gIH0sXG4gIHBsYXllcl9naG9zdDoge1xuICAgIHNpemU6IDEyLFxuICAgIHdlaWdodDogMCxcbiAgICBkYW1hZ2U6IDEsXG4gICAga25vY2s6IDAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiaGl0X3JlY2VpdmVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJoaXRfcmVjZWl2ZVwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiaGl0X2dpdmVcIlxuICAgIH0sXG4gICAgc3BlZWQ6IHtcbiAgICAgIG1heDogMi41LFxuICAgICAgbW92ZTogMC4zXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJhbnQtZ2hvc3RcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICBwbGF5ZXJfbmFtZTogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgY3JhdGU6IHtcbiAgICBzaXplOiAxNixcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJjcmF0ZS13ZWFwb25cIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAxLFxuICAgICAgdGltZW91dDogMzAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYWxsLWJsdWVcIlxuICAgIH1cbiAgfSxcbiAgbWVkcGFjazoge1xuICAgIHNpemU6IDE2LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImNyYXRlLWhlYWx0aFwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgc3BlZWQ6IDEsXG4gICAgICB0aW1lb3V0OiAzMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImJhbGwtcmVkXCJcbiAgICB9XG4gIH0sXG4gIFwiZ2VtLTFcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1ncmVlblwiLFxuICAgICAgc3RhdGljX2FuZ2xlOiB0cnVlLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICBcImdlbS01XCI6IHtcbiAgICBzaXplOiAxOCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBzdG9wOiAxMCxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJnZW0tYmx1ZVwiLFxuICAgICAgc3RhdGljX2FuZ2xlOiB0cnVlLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICBcImdlbS0yMFwiOiB7XG4gICAgc2l6ZTogMTgsXG4gICAgc3Bhd246IHRydWUsXG4gICAgc3RvcDogMTAsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZ2VtLXJlZFwiLFxuICAgICAgc3RhdGljX2FuZ2xlOiB0cnVlLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICBcImdlbS01MFwiOiB7XG4gICAgc2l6ZTogMTgsXG4gICAgc3Bhd246IHRydWUsXG4gICAgc3RvcDogMTAsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiZ2VtLXB1cnBsZVwiLFxuICAgICAgc3RhdGljX2FuZ2xlOiB0cnVlLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfVxuICB9LFxuICBcImdlbS0yMDBcIjoge1xuICAgIHNpemU6IDE4LFxuICAgIHNwYXduOiB0cnVlLFxuICAgIHN0b3A6IDEwLFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImdlbS1zaWx2ZXJcIixcbiAgICAgIHN0YXRpY19hbmdsZTogdHJ1ZSxcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH1cbiAgfSxcbiAgdm9ydGV4OiB7XG4gICAgc2l6ZTogMjIsXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwidm9ydGV4XCJcbiAgICB9XG4gIH0sXG4gIHRhcmdldDoge1xuICAgIHNpemU6IDIyLFxuICAgIGRhbWFnZTogMCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBldmVudHM6IHtcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBleHBsb3Npb246IFwiZXhwbG9zaW9uLWxhc2VyLWJsdWVcIixcbiAgICAgIHNwcml0ZTogXCJ0YXJnZXRcIixcbiAgICAgIGFpcl9mbG9hdDogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGV4cGxvc2lvbjogXCJwb3BcIixcbiAgICAgIGFpcjogXCJub25lXCJcbiAgICB9XG4gIH0sXG4gIG51Y2xlYXI6IHtcbiAgICBzaXplOiAyMixcbiAgICBkYW1hZ2U6IDEwMCxcbiAgICBzcGF3bjogdHJ1ZSxcbiAgICBldmVudHM6IHtcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbi1ncmVlbi1sXCIsXG4gICAgICBzcHJpdGU6IFwibnVjbGVhclwiLFxuICAgICAgYWlyX2Zsb2F0OiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbl9nYXNcIixcbiAgICAgIGFpcjogXCJub25lXCJcbiAgICB9XG4gIH0sXG4gIG1pbmU6IHtcbiAgICBzaXplOiA1OCxcbiAgICBkYW1hZ2U6IDgwLFxuICAgIGV2ZW50czoge1xuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJtaW5lXCIsXG4gICAgICBhaXJfZmxvYXQ6IHRydWVcbiAgICB9XG4gIH0sXG4gIFwiYXN0ZXJvaWQtc21hbGxcIjoge1xuICAgIHNpemU6IDE1LFxuICAgIHdlaWdodDogMSxcbiAgICBkYW1hZ2U6IDQwLFxuICAgIGV2ZW50czoge1xuICAgICAgb2JqZWN0OiBcImRpZVwiLFxuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24yLWxcIixcbiAgICAgIHNwcml0ZTogXCJhc3Rlcm9pZC1zbWFsbFwiLFxuICAgICAgYWlyX3NwaW46IHRydWVcbiAgICB9LFxuICAgIGF1ZGlvOiB7XG4gICAgICBhaXI6IFwiZmx5XCJcbiAgICB9LFxuICAgIHRyYWlsczoge1xuICAgICAgY291bnQ6IDIsXG4gICAgICBzcGVlZDogMC42LFxuICAgICAgb2Zmc2V0X3g6IC01LFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfSxcbiAgXCJhc3Rlcm9pZC1sYXJnZVwiOiB7XG4gICAgc2l6ZTogMzQsXG4gICAgd2VpZ2h0OiAxLFxuICAgIGRhbWFnZTogODAsXG4gICAgZXZlbnRzOiB7XG4gICAgICBvYmplY3Q6IFwiZGllXCIsXG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBleHBsb3Npb246IFwiZGllXCIsXG4gICAgICBkaWU6IFwiY2x1c3RlclwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGNsdXN0ZXI6IHtcbiAgICAgIGNpcmNsZTogdHJ1ZSxcbiAgICAgIG9iamVjdDogXCJhc3Rlcm9pZC1zbWFsbFwiLFxuICAgICAgc3BlZWQ6IDE2LFxuICAgICAgY291bnQ6IDNcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbjItbFwiLFxuICAgICAgc3ByaXRlOiBcImFzdGVyb2lkLWxhcmdlXCIsXG4gICAgICBhaXJfc3BpbjogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHNwZWVkOiAwLjYsXG4gICAgICBvZmZzZXRfeDogLTUsXG4gICAgICB0aW1lb3V0OiAyMCxcbiAgICAgIHNwcml0ZTogXCJmbGFtZVwiXG4gICAgfVxuICB9LFxuICBkaWc6IHtcbiAgICBzaXplOiAyLFxuICAgIHdlaWdodDogMCxcbiAgICBkYW1hZ2U6IDE2LFxuICAgIHRpbWVvdXQ6IDYsXG4gICAgaWdub3JlX2xldmVsX2RhbWFnZTogdHJ1ZSxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogW1wiZGVzdHJveVwiLCBcImRyYWdfcGxheWVyXCIsIFwiZGllXCJdXG4gICAgfVxuICB9LFxuICBwdW5jaDoge1xuICAgIHNpemU6IDIwLFxuICAgIHdlaWdodDogMCxcbiAgICBkYW1hZ2U6IDE2LFxuICAgIHRpbWVvdXQ6IDI2LFxuICAgIHBsYXllcl9sb2NrOiB0cnVlLFxuICAgIHN0b3A6IDI0LFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcInNsaWRlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJoaXRfZ2l2ZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIHNwcml0ZTogXCJmbGFtZS1sYXJnZVwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiLFxuICAgICAgYm91bmNlOiBcImRvaW5rXCIsXG4gICAgICBoaXQ6IFwicHVuY2hcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHNwZWVkOiAxLjUsXG4gICAgICBvZmZzZXRfeDogLTEwLFxuICAgICAgb2Zmc2V0X3k6IDAsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcImZsYW1lXCJcbiAgICB9XG4gIH0sXG4gIGxhc2VyOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgd2VpZ2h0OiAwLFxuICAgIHRpbWVvdXQ6IDIwLFxuICAgIGRhbWFnZTogMzAsXG4gICAgZGVzdHJveV9ncm91bmQ6IGZhbHNlLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgb2JqZWN0OiBcIm5vbmVcIixcbiAgICAgIGRpZTogXCJub25lXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogW1wiZXhwbG9kZVwiLCBcImRpZVwiXSxcbiAgICAgIHBsYXllcl9naG9zdDogW1wiaGl0X2dpdmVcIiwgXCJkaWVcIl1cbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcImxhc2VyLWJsdWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJleHBsb3Npb24tbGFzZXItYmx1ZVwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgZXhwbG9zaW9uOiBcImV4cGxvc2lvbl9sYXNlclwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgc3BlZWQ6IDAsXG4gICAgICB0aW1lb3V0OiAxMCxcbiAgICAgIHJvdGF0ZTogZmFsc2UsXG4gICAgICBtb3ZlOiBmYWxzZSxcbiAgICAgIHNwcml0ZTogXCJidWJibGUtYmx1ZVwiXG4gICAgfVxuICB9LFxuICBiYXpvb2thOiB7XG4gICAgc2l6ZTogNixcbiAgICB3ZWlnaHQ6IDAuNyxcbiAgICB0aW1lb3V0OiAzMDAsXG4gICAgZGFtYWdlOiA3MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJkaWVcIixcbiAgICAgIG9iamVjdDogXCJkaWVcIixcbiAgICAgIGV4cGxvc2lvbjogXCJkaWVcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJkaWVcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBzcHJpdGU6IFwiYmF6b29rYS1zaGVsbFwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgc3BlZWQ6IDEuNSxcbiAgICAgIG9mZnNldF94OiAtMTAsXG4gICAgICBvZmZzZXRfeTogMCxcbiAgICAgIHRpbWVvdXQ6IDEwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiZmxhbWVcIlxuICAgIH1cbiAgfSxcbiAgZ3JlbmFkZToge1xuICAgIHNpemU6IDQsXG4gICAgd2VpZ2h0OiAwLjcsXG4gICAgdGltZW91dDogNzIsXG4gICAgZGFtYWdlOiA1MCxcbiAgICBldmVudHM6IHtcbiAgICAgIGdyb3VuZDogXCJib3VuY2VcIixcbiAgICAgIG9iamVjdDogXCJib3VuY2VcIixcbiAgICAgIGV4cGxvc2lvbjogXCJib3VuY2VcIixcbiAgICAgIGRpZTogXCJleHBsb2RlXCJcbiAgICB9LFxuICAgIG9iamVjdF9ldmVudHM6IHtcbiAgICAgIHBsYXllcjogXCJib3VuY2VcIlxuICAgIH0sXG4gICAgYW5pbWF0aW9uOiB7XG4gICAgICBhaXJfc3BpbjogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJncmVuYWRlLWFybWVkXCJcbiAgICB9LFxuICAgIGxhYmVsczoge1xuICAgICAgdGltZW91dDogdHJ1ZVxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJjb3VudGRvd25cIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1ncmVlblwiXG4gICAgfVxuICB9LFxuICBwdW1wa2luOiB7XG4gICAgc2l6ZTogMTAsXG4gICAgd2VpZ2h0OiAxLFxuICAgIHRpbWVvdXQ6IDEyMCxcbiAgICBkYW1hZ2U6IDcwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImJvdW5jZVwiLFxuICAgICAgb2JqZWN0OiBcImJvdW5jZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImJvdW5jZVwiLFxuICAgICAgZGllOiBcImNsdXN0ZXJcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImJvdW5jZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGFpcl9zcGluOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcInB1bXBraW5cIlxuICAgIH0sXG4gICAgbGFiZWxzOiB7XG4gICAgICB0aW1lb3V0OiB0cnVlXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcInNwb29reVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAyLFxuICAgICAgdGltZW91dDogMjAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHJvdGF0ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJiYXRcIlxuICAgIH0sXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiBmYWxzZSxcbiAgICAgIG9iamVjdDogXCJwdW1wa2luX3NsaWNlXCIsXG4gICAgICBzcGVlZDogMTUsXG4gICAgICBjb3VudDogM1xuICAgIH1cbiAgfSxcbiAgcHVtcGtpbl9zbGljZToge1xuICAgIHNpemU6IDYsXG4gICAgd2VpZ2h0OiAxLFxuICAgIHRpbWVvdXQ6IDIwMCxcbiAgICBkYW1hZ2U6IDMwLFxuICAgIGV2ZW50czoge1xuICAgICAgZ3JvdW5kOiBcImRpZVwiLFxuICAgICAgZXhwbG9zaW9uOiBcImRpZVwiLFxuICAgICAgZGllOiBcImV4cGxvZGVcIlxuICAgIH0sXG4gICAgb2JqZWN0X2V2ZW50czoge1xuICAgICAgcGxheWVyOiBcImRpZVwiXG4gICAgfSxcbiAgICBhbmltYXRpb246IHtcbiAgICAgIGFpcl9zcGluOiB0cnVlLFxuICAgICAgc3ByaXRlOiBcInB1bXBraW4tc2xpY2VcIlxuICAgIH0sXG4gICAgYXVkaW86IHtcbiAgICAgIGFpcjogXCJmbHlcIlxuICAgIH0sXG4gICAgdHJhaWxzOiB7XG4gICAgICBjb3VudDogMixcbiAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgcm90YXRlOiBmYWxzZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcHJpdGU6IFwiYmFsbC1vcmFuZ2VcIlxuICAgIH1cbiAgfSxcbiAgcGFpbmdpdmVyOiB7XG4gICAgc2l6ZTogMjAsXG4gICAgd2VpZ2h0OiAxLFxuICAgIGRhbWFnZTogNTAsXG4gICAgY2x1c3Rlcjoge1xuICAgICAgY2lyY2xlOiBmYWxzZSxcbiAgICAgIG9iamVjdDogXCJncmVuYWRlXCIsXG4gICAgICBzcGVlZDogMTUsXG4gICAgICBjb3VudDogM1xuICAgIH0sXG4gICAgZXZlbnRzOiB7XG4gICAgICBncm91bmQ6IFwiZGllXCIsXG4gICAgICBkaWU6IFwiY2x1c3RlclwiXG4gICAgfSxcbiAgICBvYmplY3RfZXZlbnRzOiB7XG4gICAgICBwbGF5ZXI6IFwiZGllXCJcbiAgICB9LFxuICAgIGFuaW1hdGlvbjoge1xuICAgICAgc3ByaXRlOiBcInJvY2tldFwiXG4gICAgfSxcbiAgICBhdWRpbzoge1xuICAgICAgYWlyOiBcImZseVwiXG4gICAgfSxcbiAgICB0cmFpbHM6IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgdGltZW91dDogMTAsXG4gICAgICByb3RhdGU6IGZhbHNlLFxuICAgICAgbW92ZTogdHJ1ZSxcbiAgICAgIHNwcml0ZTogXCJmbGFtZVwiXG4gICAgfVxuICB9XG59O1xuXG4vLyBwcmVwIG9iamVjdHNcbmNvbmZpZy5vYmplY3RfcmVmcyA9IFtdO1xuZm9yIChrZXkgaW4gY29uZmlnLm9iamVjdHMpIHtcbiAgY29uZmlnLm9iamVjdF9yZWZzLnB1c2goa2V5KTtcbiAgY29uZmlnLm9iamVjdHNba2V5XSA9IGRlZXBtZXJnZShjb25maWcub2JqZWN0cy5kZWZhdWx0LCBjb25maWcub2JqZWN0c1trZXldLCB7XG4gICAgYXJyYXlNZXJnZTogZG9udF9tZXJnZVxuICB9KTtcbn1cbiIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcuc3ByaXRlcyA9IHtcbiAgXCJiYWxsLWJsdWVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDE5MixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYmFsbC1ncmVlblwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjQwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYWxsLW9yYW5nZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjg4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYWxsLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzM2LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJiYWxsLXNpbHZlclwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMzg0LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgYmF0OiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDMyLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJmbGFtZS0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA0ODAsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImZsYW1lLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDUyOCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiZmxhbWUtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNTc2LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJmbGFtZS00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA2MjQsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImZsYW1lLTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDY3MixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwibWluZS1ncmV5XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA3MjAsXG4gICAgeTogMTA1NlxuICB9LFxuICBcIm1pbmUtcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA3NjgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcInB1bXBraW4tc2xpY2VcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDgxNixcbiAgICB5OiAxMDU2XG4gIH0sXG4gIHB1bXBraW46IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA4NjQsXG4gICAgeTogMTA1NlxuICB9LFxuICBcInN0YXItYmx1ZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTEyLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtYm9keS1haXItbGVmdFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogOTYwLFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtYm9keS1haXItcmlnaHRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDEwMDgsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC1ib2R5LWhpdC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtYm9keS1oaXQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiYW50LWJvZHktaGl0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNDhcbiAgfSxcbiAgXCJhbnQtYm9keS1zdXBlcm1hbi1sZWZ0XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDk2XG4gIH0sXG4gIFwiYW50LWJvZHktc3VwZXJtYW4tcmlnaHRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMTQ0XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMjQwXG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMjg4XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0LTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMzM2XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1sZWZ0LTVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDQzMlxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA0ODBcbiAgfSxcbiAgXCJhbnQtYm9keS13YWxrLXJpZ2h0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogNTI4XG4gIH0sXG4gIFwiYW50LWJvZHktd2Fsay1yaWdodC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDU3NlxuICB9LFxuICBcImFudC1ib2R5LXdhbGstcmlnaHQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA2MjRcbiAgfSxcbiAgXCJhbnQtYm9tYlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA2NzJcbiAgfSxcbiAgXCJhbnQtZ2hvc3QtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNTc2LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1naG9zdC0yXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA2NDAsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWdob3N0LTNcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDcwNCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtaGVhZC1oaXQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogNzY4LFxuICAgIHk6IDk2MFxuICB9LFxuICBcImFudC1oZWFkLWhpdC0yXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA4MzIsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LWhlYWQtaGl0LTNcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDg5NixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtaGVhZC1sZWZ0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDk2MCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJhbnQtaGVhZC1sZWZ0LTJcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMFxuICB9LFxuICBcImFudC1oZWFkLWxlZnQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA2NFxuICB9LFxuICBcImFudC1oZWFkLXJpZ2h0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMTI4XG4gIH0sXG4gIFwiYW50LWhlYWQtcmlnaHQtMlwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJhbnQtaGVhZC1yaWdodC0zXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDI1NlxuICB9LFxuICBcImFudC13ZWFwb24tYmF6b29rYS1sZWZ0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDMyMFxuICB9LFxuICBcImFudC13ZWFwb24tYmF6b29rYS1yaWdodFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTFcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNDQ4XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctbGVmdC0yXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDUxMlxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLWxlZnQtM1wiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1sZWZ0LTRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogNjQwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtMVwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA3MDRcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWRpZy1yaWdodC0yXCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImFudC13ZWFwb24tZGlnLXJpZ2h0LTNcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogODMyXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1kaWctcmlnaHQtNFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTA1NixcbiAgICB5OiA4OTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLWxhc2VyLWxlZnRcIjoge1xuICAgIHNpemU6IDY0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi1sYXNlci1yaWdodFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1wdW5jaC1sZWZ0XCI6IHtcbiAgICBzaXplOiA2NCxcbiAgICB4OiA2NCxcbiAgICB5OiAxMDU2XG4gIH0sXG4gIFwiYW50LXdlYXBvbi1wdW5jaC1yaWdodFwiOiB7XG4gICAgc2l6ZTogNjQsXG4gICAgeDogMTI4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA3MjBcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA4MTZcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LWxlZnQtNVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEyMCxcbiAgICB5OiA5MTJcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTIwLFxuICAgIHk6IDEwMDhcbiAgfSxcbiAgXCJhbnQtd2VhcG9uLXRocm93LXJpZ2h0LTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExMjAsXG4gICAgeTogMTA1NlxuICB9LFxuICBcImFudC13ZWFwb24tdGhyb3ctcmlnaHQtNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYW50LXdlYXBvbi10aHJvdy1yaWdodC01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA0OCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJtb3VyeS1kaWdcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDk2LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcm1vdXJ5LWV4dGluZ3Vpc2hlXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxNDQsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFybW91cnktbGFzZXItYmx1ZVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTkyLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcm1vdXJ5LWxhc2VyLXJlZFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMjQwLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcm1vdXJ5LXB1bmNoXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAyODgsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFycm93LWJsdWVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDMzNixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJyb3ctZ3JlZW5cIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDM4NCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJyb3ctZ3JleVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNDMyLFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJhcnJvdy1wdXJwbGVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQ4MCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiYXJyb3ctcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA1MjgsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImFzdGVyb2lkLTFcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDAsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiYXN0ZXJvaWQtMlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiYmFsbC1ibHVlLTFcIjoge1xuICAgIHNpemU6IDI0LFxuICAgIHg6IDEwNTYsXG4gICAgeTogMTAyNFxuICB9LFxuICBcImJhbGwtYmx1ZS0yXCI6IHtcbiAgICBzaXplOiAyNCxcbiAgICB4OiAxMDgwLFxuICAgIHk6IDEwMjRcbiAgfSxcbiAgXCJiYWxsLWJsdWUtM1wiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTAyNCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJiYWxsLWJsdWUtNFwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogMTAyNCxcbiAgICB5OiA5ODRcbiAgfSxcbiAgXCJiYWxsLWJsdWUtNVwiOiB7XG4gICAgc2l6ZTogMjQsXG4gICAgeDogNTc2LFxuICAgIHk6IDEwMjRcbiAgfSxcbiAgXCJiYXpvb2thLXNoZWxsXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA1NzYsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImNyYXRlLWhlYWx0aFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNjI0LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJjcmF0ZS13ZWFwb25cIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDY3MixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIGNyb3NzaGFpcjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDcyMCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtMVwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDAsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTJcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMFxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTNcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDE5MlxuICB9LFxuICBcImV4cGxvc2lvbi1ncmVlbi1sLTRcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtNVwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiAwXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWdyZWVuLWwtNlwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC03XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJleHBsb3Npb24tZ3JlZW4tbC04XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogMTkyLFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTFcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAzODQsXG4gICAgeTogMzg0XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtMlwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDU3NixcbiAgICB5OiAwXG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtM1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDU3NixcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24tbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImV4cGxvc2lvbi1sLTVcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAwLFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbi1sLTZcIjoge1xuICAgIHNpemU6IDE5MixcbiAgICB4OiAxOTIsXG4gICAgeTogNTc2XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDM4NCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAxOTIsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtMlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMjg4LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbi1sYXNlci1ibHVlLTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDM4NCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24tbGFzZXItYmx1ZS00XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA0ODAsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uLWxhc2VyLWJsdWUtNVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNTc2LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbjItbC0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA2NzIsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwiZXhwbG9zaW9uMi1sLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDc2OCxcbiAgICB5OiA3NjhcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtM1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogODY0LFxuICAgIHk6IDc2OFxuICB9LFxuICBcImV4cGxvc2lvbjItbC00XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNTc2LFxuICAgIHk6IDU3NlxuICB9LFxuICBcImV4cGxvc2lvbjItbC01XCI6IHtcbiAgICBzaXplOiAxOTIsXG4gICAgeDogNzY4LFxuICAgIHk6IDBcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtNlwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiAxOTJcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtN1wiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiAzODRcbiAgfSxcbiAgXCJleHBsb3Npb24yLWwtOFwiOiB7XG4gICAgc2l6ZTogMTkyLFxuICAgIHg6IDc2OCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgZXh0aW5ndWlzaGVyOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogNzY4LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAwLFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTJcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDE5MixcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmbGFtZS1sYXJnZS00XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAyODgsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZmxhbWUtbGFyZ2UtNVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMzg0LFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZsYW1lLWxhcmdlLTZcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDQ4MCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmb2N1cy0xXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA1NzYsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZm9jdXMtMlwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogNjcyLFxuICAgIHk6IDg2NFxuICB9LFxuICBcImZvY3VzLTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDc2OCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJmb2N1cy00XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA4NjQsXG4gICAgeTogODY0XG4gIH0sXG4gIFwiZm9jdXMtNVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDBcbiAgfSxcbiAgXCJmb2N1cy02XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogOTZcbiAgfSxcbiAgXCJmb2N1cy03XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZm9jdXMtOFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDI4OFxuICB9LFxuICBcImdlbS1ibHVlLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDgxNixcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWJsdWUtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogODY0LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tYmx1ZS0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiA5MTIsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ibHVlLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDk2MCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWdyZWVuLTFcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDEwMDgsXG4gICAgeTogMTEyMFxuICB9LFxuICBcImdlbS1ncmVlbi0yXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMDU2LFxuICAgIHk6IDExMjBcbiAgfSxcbiAgXCJnZW0tZ3JlZW4tM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTEwNCxcbiAgICB5OiAxMTIwXG4gIH0sXG4gIFwiZ2VtLWdyZWVuLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMFxuICB9LFxuICBcImdlbS1wdXJwbGUtMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA0OFxuICB9LFxuICBcImdlbS1wdXJwbGUtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA5NlxuICB9LFxuICBcImdlbS1wdXJwbGUtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAxNDRcbiAgfSxcbiAgXCJnZW0tcHVycGxlLTRcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMTkyXG4gIH0sXG4gIFwiZ2VtLXJlZC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDI0MFxuICB9LFxuICBcImdlbS1yZWQtMlwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiAyODhcbiAgfSxcbiAgXCJnZW0tcmVkLTNcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogMzM2XG4gIH0sXG4gIFwiZ2VtLXJlZC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDM4NFxuICB9LFxuICBcImdlbS1zaWx2ZXItMVwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA0MzJcbiAgfSxcbiAgXCJnZW0tc2lsdmVyLTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNDgwXG4gIH0sXG4gIFwiZ2VtLXNpbHZlci0zXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDUyOFxuICB9LFxuICBcImdlbS1zaWx2ZXItNFwiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA1NzZcbiAgfSxcbiAgXCJncmVuYWRlLWdyZWVuXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDYyNFxuICB9LFxuICBcImdyZW5hZGUtcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDY3MlxuICB9LFxuICBcImxhc2VyLWJsdWVcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogNzIwXG4gIH0sXG4gIFwibGFzZXItcmVkXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDc2OFxuICB9LFxuICBudWNsZWFyOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDM4NFxuICB9LFxuICByb2NrZXQ6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDgxNlxuICB9LFxuICBzbW9rZToge1xuICAgIHNpemU6IDI0LFxuICAgIHg6IDYwMCxcbiAgICB5OiAxMDI0XG4gIH0sXG4gIHRhcmdldDoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDQ4LFxuICAgIHk6IDExNjhcbiAgfSxcbiAgXCJ0ZWxlcG9ydC0xXCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDg2NFxuICB9LFxuICBcInRlbGVwb3J0LTJcIjoge1xuICAgIHNpemU6IDQ4LFxuICAgIHg6IDExNjgsXG4gICAgeTogOTEyXG4gIH0sXG4gIFwidGVsZXBvcnQtM1wiOiB7XG4gICAgc2l6ZTogNDgsXG4gICAgeDogMTE2OCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJ0ZWxlcG9ydC00XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDEwMDhcbiAgfSxcbiAgXCJ0ZWxlcG9ydC01XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDEwNTZcbiAgfSxcbiAgXCJ0ZWxlcG9ydC02XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAxMTY4LFxuICAgIHk6IDExMDRcbiAgfSxcbiAgXCJ0ZWxlcG9ydC03XCI6IHtcbiAgICBzaXplOiA0OCxcbiAgICB4OiAwLFxuICAgIHk6IDExNjhcbiAgfSxcbiAgXCJ2b3J0ZXgtMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDQ4MFxuICB9LFxuICBcInZvcnRleC0xMFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDU3NlxuICB9LFxuICBcInZvcnRleC0xMVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYwLFxuICAgIHk6IDY3MlxuICB9LFxuICBcInZvcnRleC0yXCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiA5NjAsXG4gICAgeTogNzY4XG4gIH0sXG4gIFwidm9ydGV4LTNcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDk2MCxcbiAgICB5OiA4NjRcbiAgfSxcbiAgXCJ2b3J0ZXgtNFwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMCxcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJ2b3J0ZXgtNVwiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogOTYsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwidm9ydGV4LTZcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDE5MixcbiAgICB5OiA5NjBcbiAgfSxcbiAgXCJ2b3J0ZXgtN1wiOiB7XG4gICAgc2l6ZTogOTYsXG4gICAgeDogMjg4LFxuICAgIHk6IDk2MFxuICB9LFxuICBcInZvcnRleC04XCI6IHtcbiAgICBzaXplOiA5NixcbiAgICB4OiAzODQsXG4gICAgeTogOTYwXG4gIH0sXG4gIFwidm9ydGV4LTlcIjoge1xuICAgIHNpemU6IDk2LFxuICAgIHg6IDQ4MCxcbiAgICB5OiA5NjBcbiAgfVxufTtcbiIsInZhciBjb25maWcgPSBjb25maWcgfHwge307XG5jb25maWcud2VhcG9ucyA9IHtcbiAgZGVmYXVsdDoge1xuICAgIHRpdGxlOiBcIlwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcIlwiLFxuICAgIHNwcml0ZTogXCJcIixcbiAgICBmaXJlX2F1ZGlvOiBcIlwiLFxuICAgIGZpcmVfc3ByaXRlOiBcIlwiLFxuICAgIGZpcmVfYm9keV9zcHJpdGU6IFwiXCIsXG4gICAgZmlyZV9hbmdsZV9sb2NrOiBmYWxzZSxcbiAgICBhdXRvX2ZvbGxvdzogZmFsc2UsXG4gICAgcmVxdWlyZV93YWxrOiBmYWxzZSxcbiAgICBzcGVlZDogMCxcbiAgICBvYmplY3Q6IFwiXCIsXG4gICAgY29vbGRvd246IDAsXG4gICAgcmVjb2lsOiAwLFxuICAgIGluZXJ0aWE6IDBcbiAgfSxcbiAgZGlnOiB7XG4gICAgdGl0bGU6IFwiRGlnXCIsXG4gICAgYXJtb3VyeV9zcHJpdGU6IFwiYXJtb3VyeS1kaWdcIixcbiAgICBzcHJpdGU6IFwiZGlnXCIsXG4gICAgZmlyZV9zcHJpdGU6IFwiZGlnLWZpcmVcIixcbiAgICBmaXJlX2JvZHlfc3ByaXRlOiBcIndhbGtcIixcbiAgICBmaXJlX2FuZ2xlX2xvY2s6IHRydWUsXG4gICAgc3BlZWQ6IDMsXG4gICAgb2JqZWN0OiBcImRpZ1wiLFxuICAgIGNvb2xkb3duOiAxMFxuICB9LFxuICBwaGFzZXI6IHtcbiAgICB0aXRsZTogXCJQaGFzZXJcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJhcm1vdXJ5LWxhc2VyLWJsdWVcIixcbiAgICBzcHJpdGU6IFwibGFzZXJcIixcbiAgICBmaXJlX2F1ZGlvOiBcInNob290X2xhc2VyXCIsXG4gICAgc3BlZWQ6IDMwLFxuICAgIG9iamVjdDogXCJsYXNlclwiLFxuICAgIGNvb2xkb3duOiA2LFxuICAgIHJlY29pbDogMC4xLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBiYXpvb2tvaWQ6IHtcbiAgICB0aXRsZTogXCJCYXpvb2tvaWRcIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJiYXpvb2thLXNoZWxsXCIsXG4gICAgc3ByaXRlOiBcImJhem9va2FcIixcbiAgICBmaXJlX2F1ZGlvOiBcInNob290XCIsXG4gICAgYXV0b19mb2xsb3c6IHRydWUsXG4gICAgc3BlZWQ6IDI0LFxuICAgIG9iamVjdDogXCJiYXpvb2thXCIsXG4gICAgY29vbGRvd246IDQwLFxuICAgIHJlY29pbDogMC4yLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBncmVuYWRlOiB7XG4gICAgdGl0bGU6IFwiR3JlbmFkZVwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImdyZW5hZGUtZ3JlZW5cIixcbiAgICBzcHJpdGU6IFwidGhyb3dcIixcbiAgICBmaXJlX2F1ZGlvOiBcInRocm93XCIsXG4gICAgZmlyZV9zcHJpdGU6IFwidGhyb3ctZmlyZVwiLFxuICAgIGF1dG9fZm9sbG93OiB0cnVlLFxuICAgIHNwZWVkOiAyNCxcbiAgICBvYmplY3Q6IFwiZ3JlbmFkZVwiLFxuICAgIGNvb2xkb3duOiAzMCxcbiAgICByZWNvaWw6IDAsXG4gICAgaW5lcnRpYTogMC41XG4gIH0sXG4gIHB1bmNoOiB7XG4gICAgdGl0bGU6IFwiRmlyZSBQdW5jaFwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcImFybW91cnktcHVuY2hcIixcbiAgICBzcHJpdGU6IFwicHVuY2hcIixcbiAgICBmaXJlX2F1ZGlvOiBcInRocm93XCIsXG4gICAgZmlyZV9ib2R5X3Nwcml0ZTogXCJzdXBlcm1hblwiLFxuICAgIHNwZWVkOiAyNCxcbiAgICBvYmplY3Q6IFwicHVuY2hcIixcbiAgICBjb29sZG93bjogMTIwLFxuICAgIHJlY29pbDogMCxcbiAgICBpbmVydGlhOiAwLjVcbiAgfSxcbiAgcHVtcGtpbjoge1xuICAgIHRpdGxlOiBcIlB1bXBraW5cIixcbiAgICBhcm1vdXJ5X3Nwcml0ZTogXCJwdW1wa2luXCIsXG4gICAgc3ByaXRlOiBcInRocm93XCIsXG4gICAgZmlyZV9hdWRpbzogXCJ0aHJvd1wiLFxuICAgIGZpcmVfc3ByaXRlOiBcInRocm93LWZpcmVcIixcbiAgICBhdXRvX2ZvbGxvdzogdHJ1ZSxcbiAgICBzcGVlZDogMzAsXG4gICAgb2JqZWN0OiBcInB1bXBraW5cIixcbiAgICBjb29sZG93bjogNDgsXG4gICAgcmVjb2lsOiAwLFxuICAgIGluZXJ0aWE6IDAuNVxuICB9LFxuICBwYWluZ2l2ZXI6IHtcbiAgICB0aXRsZTogXCJQYWluZ2l2ZXIgMjAwMFwiLFxuICAgIGFybW91cnlfc3ByaXRlOiBcInJvY2tldFwiLFxuICAgIHNwcml0ZTogXCJiYXpvb2thXCIsXG4gICAgZmlyZV9hdWRpbzogXCJzaG9vdFwiLFxuICAgIHNwZWVkOiAyNCxcbiAgICBvYmplY3Q6IFwicGFpbmdpdmVyXCIsXG4gICAgY29vbGRvd246IDEwLFxuICAgIHJlY29pbDogMC40LFxuICAgIGluZXJ0aWE6IDAuNVxuICB9XG59O1xuXG4vLyBwcmVwIHdlYXBvbnNcbmZvciAoa2V5IGluIGNvbmZpZy53ZWFwb25zKSB7XG4gIGNvbmZpZy53ZWFwb25zW2tleV0gPSBkZWVwbWVyZ2UoY29uZmlnLndlYXBvbnMuZGVmYXVsdCwgY29uZmlnLndlYXBvbnNba2V5XSwge1xuICAgIGFycmF5TWVyZ2U6IGRvbnRfbWVyZ2VcbiAgfSk7XG59XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBY3Rpb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUGVyZm9ybSBhY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb24gPSBmdW5jdGlvbihwbGF5ZXJfaWQsIGFjdGlvbikge1xuICB2YXIgcmVzcG9uc2UgPSB7IHN1Y2Nlc3M6IGZhbHNlIH07XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgdmFyIG9iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8ICFhY3Rpb24gfHwgIW9iaikge1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIHZhciBsb2NrZWRfb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW3BsYXllci5sb2NrZWRdO1xuXG4gIC8vIHBsYXllcnMgY2FuIGRvIHN0dWZmXG4gIGlmICghcGxheWVyLmRlYWQgJiYgIWxvY2tlZF9vYmogJiYgcGxheWVyLmhpdCA9PT0gMCkge1xuICAgIC8vIHJ1biB0aGVtXG4gICAgaWYgKGFjdGlvbi5hY3Rpb24gPT09IFwibW92ZVwiKSB7XG4gICAgICByZXNwb25zZSA9IHRoaXMuYWN0aW9uX21vdmUocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYWN0aW9uLmFjdGlvbiA9PT0gXCJqdW1wXCIpIHtcbiAgICAgIHJlc3BvbnNlID0gdGhpcy5hY3Rpb25fanVtcChyZXNwb25zZSwgcGxheWVyLCBvYmosIGFjdGlvbik7XG4gICAgfVxuICAgIGlmIChhY3Rpb24uYWN0aW9uID09PSBcInNob290XCIpIHtcbiAgICAgIHJlc3BvbnNlID0gdGhpcy5hY3Rpb25fc2hvb3QocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pO1xuICAgIH1cbiAgfVxuXG4gIHJlc3BvbnNlLnggPSBvYmoueDtcbiAgcmVzcG9uc2UueSA9IG9iai55O1xuICByZXNwb25zZS5zcGVlZF94ID0gb2JqLnNwZWVkX3g7XG4gIHJlc3BvbnNlLnNwZWVkX3kgPSBvYmouc3BlZWRfeTtcbiAgcmVzcG9uc2UuZnJhbWUgPSB0aGlzLnN0YXRlLmZyYW1lO1xuXG4gIC8vIHJldHVybiBzdGF0dXNcbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogV2Fsa2luZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbl9tb3ZlID0gZnVuY3Rpb24ocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pIHtcbiAgcmVzcG9uc2UudHlwZSA9IFwid2Fsa1wiO1xuXG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICB2YXIgc3BlZWQgPSB0aGlzLnNjaGVtZS5sZXZlbHMuc3BlZWRbcGxheWVyLmxldmVsXSB8fCBvYmouYy5zcGVlZC5tb3ZlO1xuICAgIHZhciBzcGVlZCA9IGFjdGlvbi5zcGVlZCB8fCBzcGVlZDtcbiAgICB2YXIgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIGFjdGlvbi5hbmdsZSwgc3BlZWQpO1xuICAgIGlmICh3YWxrLm1vdmUpIHtcbiAgICAgIGlmICh0aGlzLmFjdGlvbl93YWxrX21vdmUob2JqLCB3YWxrLnBhdGgpKSB7XG4gICAgICAgIC8vIHJlY29yZCBwbGF5ZXIgZXZlbnRcbiAgICAgICAgcGxheWVyLmV2ZW50cy5wdXNoKHsgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsIHR5cGU6IFwid2Fsa1wiIH0pO1xuXG4gICAgICAgIC8vIHJldHVybiBzdWNjZXNzXG4gICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFdhbGtpbmcgaW4gYSBkaXJlY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fd2Fsa19kaXIgPSBmdW5jdGlvbihvYmosIGRpciwgc3BlZWQpIHtcbiAgdmFyIHNwZWVkID0gc3BlZWQgfHwgb2JqLmMuc3BlZWQubW92ZTtcblxuICAvLyBnZXQgaW5pdGlhbCBwYXRoXG4gIHZhciB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgMCwgc3BlZWQpO1xuXG4gIGlmICh3YWxrLmRpcmVjdGlvbiAhPSBkaXIpIHtcbiAgICB3YWxrID0gdGhpcy5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai54LCBvYmoueSwgMTgwLCBzcGVlZCk7XG4gICAgaWYgKHdhbGsuZGlyZWN0aW9uICE9IGRpcikge1xuICAgICAgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIDkwLCBzcGVlZCk7XG4gICAgICBpZiAod2Fsay5kaXJlY3Rpb24gIT0gZGlyKSB7XG4gICAgICAgIHdhbGsgPSB0aGlzLm1hcC53YWxrKG9iai54LCBvYmoueSwgb2JqLngsIG9iai55LCAyNzAsIHNwZWVkKTtcbiAgICAgICAgaWYgKHdhbGsuZGlyZWN0aW9uICE9IGRpcikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoIXdhbGsubW92ZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuYWN0aW9uX3dhbGtfbW92ZShvYmosIHdhbGsucGF0aCk7XG59O1xuXG4vKiBXYWxrIG1vdmluZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmFjdGlvbl93YWxrX21vdmUgPSBmdW5jdGlvbihvYmosIHBhdGgpIHtcbiAgLy8gZ28gdGhyb3VnaCB0aGUgY291cnNlXG4gIHZhciB4MSA9IG9iai54O1xuICB2YXIgeTEgPSBvYmoueTtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHBvaW50ID0gcGF0aFtpXTtcblxuICAgIC8vIGNoZWNrIG9iamVjdCBjb2xsaXNpb25zXG4gICAgdmFyIGNvbCA9IHRoaXMuY29sbGlzaW9ucyhvYmosIHBvaW50LngsIHBvaW50LnkpO1xuICAgIGlmIChjb2wpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBvYmoueCA9IHBvaW50Lng7XG4gICAgb2JqLnkgPSBwb2ludC55O1xuICAgIG9iai5tb3ZlZCA9IHRydWU7XG4gIH1cblxuICBpZiAob2JqLm1vdmVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn07XG5cbi8qIEp1bXBpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5hY3Rpb25fanVtcCA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBwbGF5ZXIsIG9iaiwgYWN0aW9uKSB7XG4gIHJlc3BvbnNlLnR5cGUgPSBcImp1bXBcIjtcblxuICBpZiAob2JqLmdyb3VuZGVkICYmIHBsYXllci5jb29sZG93biA9PT0gMCkge1xuICAgIHZhciBzcGVlZCA9IHRoaXMuc2NoZW1lLmxldmVscy5qdW1wW3BsYXllci5sZXZlbF0gfHwgb2JqLmMuc3BlZWQuanVtcDtcbiAgICB2YXIgeHkgPSB4eV9zcGVlZChhY3Rpb24uYW5nbGUsIHNwZWVkKTtcbiAgICBvYmouc3BlZWRfeCA9IHh5LnguZml4ZWQoKTtcbiAgICBvYmouc3BlZWRfeSA9IHh5LnkuZml4ZWQoKTtcbiAgICBpZiAodGhpcy5waHlzaWNzX21vdmUob2JqKSkge1xuICAgICAgLy8gc2V0IGdyb3VuZGluZ1xuICAgICAgb2JqLmdyb3VuZGVkID0gZmFsc2U7XG5cbiAgICAgIC8vIHNldCBjb29sZG93blxuICAgICAgcGxheWVyLmNvb2xkb3duID0gNztcblxuICAgICAgLy8gcmVjb3JkIHBsYXllciBldmVudFxuICAgICAgcGxheWVyLmV2ZW50cy5wdXNoKHsgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsIHR5cGU6IFwianVtcFwiIH0pO1xuXG4gICAgICAvLyByZXR1cm4gc3VjY2Vzc1xuICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogU2hvb3Rpbmcgd2VhcG9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuYWN0aW9uX3Nob290ID0gZnVuY3Rpb24ocmVzcG9uc2UsIHBsYXllciwgb2JqLCBhY3Rpb24pIHtcbiAgcmVzcG9uc2UudHlwZSA9IFwic2hvb3RcIjtcblxuICAvLyBpZiB3YWl0aW5nIGZvciBjb29sZG93blxuICAvLyBpcyBub3QgcmVhbCB3ZWFwb25cbiAgLy8gZG8gd2UgbmVlZCB0byB3YWxrXG4gIC8vIGNoZWNrIGFybW91cnkgY291bnRcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW2FjdGlvbi53ZWFwb25dO1xuICBpZiAoXG4gICAgKHBsYXllci5jb29sZG93biA9PT0gMCAmJiAhd2VhcG9uKSB8fFxuICAgICh3ZWFwb24ucmVxdWlyZV93YWxrICYmICFvYmouZ3JvdW5kZWQpIHx8XG4gICAgcGxheWVyLmFybW91cnlbYWN0aW9uLndlYXBvbl0gPT09IDBcbiAgKSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgLy8gY3JhdGUgdGhlIG9iamVjdFxuICB2YXIgc3BlZWQgPSB4eV9zcGVlZChhY3Rpb24uYW5nbGUsIHdlYXBvbi5zcGVlZCk7XG4gIHZhciBzaG90X29iaiA9IHRoaXMuY3JlYXRlX29iamVjdCh7XG4gICAgdHlwZTogd2VhcG9uLm9iamVjdCxcbiAgICBwbGF5ZXJfaWQ6IHBsYXllci5pZCxcbiAgICB4OiBvYmoueCxcbiAgICB5OiBvYmoueSxcbiAgICBzcGVlZF94OiAoc3BlZWQueCArIG9iai5zcGVlZF94ICogd2VhcG9uLmluZXJ0aWEpLmZpeGVkKCksXG4gICAgc3BlZWRfeTogKHNwZWVkLnkgKyBvYmouc3BlZWRfeSAqIHdlYXBvbi5pbmVydGlhKS5maXhlZCgpXG4gIH0pO1xuXG4gIC8vIHNldCBwbGF5ZXIgcmVjb2lsXG4gIGlmICghb2JqLmdyb3VuZGVkKSB7XG4gICAgb2JqLnNwZWVkX3ggKz0gKC1zcGVlZC54ICogd2VhcG9uLnJlY29pbCkuZml4ZWQoKTtcbiAgICBvYmouc3BlZWRfeSArPSAoLXNwZWVkLnkgKiB3ZWFwb24ucmVjb2lsKS5maXhlZCgpO1xuICB9XG5cbiAgLy8gc2V0IGFybW91cnkgdmFsdWVzXG4gIHRoaXMudXBkYXRlX3BsYXllcl9hcm1vdXJ5KHBsYXllci5pZCwgYWN0aW9uLndlYXBvbiwgLTEpO1xuXG4gIC8vIHNldCBjb29sZG93blxuICBwbGF5ZXIuY29vbGRvd24gPSB3ZWFwb24uY29vbGRvd247XG5cbiAgLy8gc2V0IHBsYXllciBsb2NrXG4gIGlmIChzaG90X29iai5jLnBsYXllcl9sb2NrKSB7XG4gICAgcGxheWVyLmxvY2tlZCA9IHNob3Rfb2JqLmtleTtcbiAgfVxuXG4gIC8vIHJlY29yZCBwbGF5ZXIgZXZlbnRcbiAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICB0eXBlOiBcInNob290XCIsXG4gICAgb2JqOiBzaG90X29iai5rZXksXG4gICAgd2VhcG9uOiBhY3Rpb24ud2VhcG9uXG4gIH0pO1xuXG4gIC8vIHJldHVybiBzdWNjZXNzXG4gIHJlc3BvbnNlLnN1Y2Nlc3MgPSB0cnVlO1xuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQ29sbGlzaW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBzaW5nbGUgY29sbGlzaW9uIGNoZWNrXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY29sbGlzaW9ucyA9IGZ1bmN0aW9uKG9iaiwgeCwgeSkge1xuICAvLyBjaGVjayBjb2xsaXNpb24gd2l0aCBncm91bmRcbiAgaWYgKHRoaXMubWFwLmkocm91bmQoeCksIHJvdW5kKHkpKSkge1xuICAgIHZhciBldmVudCA9IHRoaXMuZXZlbnQob2JqLCBcImdyb3VuZFwiLCBudWxsKTtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIHJldHVybiBldmVudDtcbiAgICB9XG4gIH1cblxuICAvLyBjaGVjayBjb2xsaXNpb25zIHdpdGggb3RoZXIgb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zdGF0ZS5vYmplY3RzKSB7XG4gICAgaWYgKG9iai5rZXkgPT09IGtleSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbGxpc2lvbl9vYmoob2JqLCB4LCB5LCB0aGlzLnN0YXRlLm9iamVjdHNba2V5XSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qIFJ1biBvYmplY3QgY29sbGlzaW9uIGNoZWNrXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY29sbGlzaW9uX29iaiA9IGZ1bmN0aW9uKG9iaiwgeCwgeSwgY2hlY2tfb2JqKSB7XG4gIC8vIGlmIG5vIGNvbGxpc2lvblxuICBpZiAoXG4gICAgdGhpcy5jb2xsaXNpb25fY2hlY2soXG4gICAgICB4LFxuICAgICAgeSxcbiAgICAgIGNoZWNrX29iai54LFxuICAgICAgY2hlY2tfb2JqLnksXG4gICAgICBvYmouYy5zaXplLFxuICAgICAgY2hlY2tfb2JqLmMuc2l6ZVxuICAgIClcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcHJldmVudCBoaXRzIG9uIHBhcmVudCBwbGF5ZXJzIGZvciBhIHNob3J0IHRpbWUgb3IgaWYgdGhleSdyZSBwbGF5ZXIgbG9ja2VkXG4gIGlmIChcbiAgICBjaGVja19vYmoudHlwZSA9PT0gXCJwbGF5ZXJcIiAmJlxuICAgIGNoZWNrX29iai5wbGF5ZXJfaWQgPT09IG9iai5wbGF5ZXJfaWQgJiZcbiAgICAodGhpcy5zdGF0ZS5mcmFtZSA8IG9iai5mcmFtZSArIDE1IHx8IG9iai5jLnBsYXllcl9sb2NrKVxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBwcmV2ZW50IGNsdXN0ZXJzIGhpdHRpbmcgZWFjaCBvdGhlciBmb3IgYSBzaG9ydCB0aW1lXG4gIGlmIChcbiAgICBjaGVja19vYmouZnJhbWUgPT09IG9iai5mcmFtZSAmJlxuICAgIGNoZWNrX29iai5wbGF5ZXJfaWQgPT09IG9iai5wbGF5ZXJfaWQgJiZcbiAgICB0aGlzLnN0YXRlLmZyYW1lIDwgb2JqLmZyYW1lICsgNjBcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gdHJpZ2dlciBiYXNpYyBvYmplY3QgY29sbGlzaW9uIGV2ZW50XG4gIGlmICh0aGlzLmV2ZW50KG9iaiwgXCJvYmplY3RcIiwgY2hlY2tfb2JqKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gdHJpZ2dlciBzcGVjaWZpYyBvYmplY3QgY29sbGlzaW9uIGV2ZW50XG4gIHZhciBldmVudCA9IG9iai5jLm9iamVjdF9ldmVudHNbY2hlY2tfb2JqLnR5cGVdO1xuICBpZiAoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5ydW5fZXZlbnQob2JqLCBldmVudCwgY2hlY2tfb2JqKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG59O1xuXG4vKiBDb2xsaXNpb24gTWF0aHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jb2xsaXNpb25fY2hlY2sgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5MiwgczEsIHMyKSB7XG4gIHJldHVybiB0aGlzLm1hcC5nZXRfZGlzdGFuY2UoeDEsIHkxLCB4MiwgeTIpID4gczEgKyBzMjtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBDb3JlXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogY3JlYXRlIGNvcmUgb2JqZWN0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gY29yZShjb25maWcsIHNjaGVtZSwgbWFwLCBncmF2aXR5X21hcCkge1xuICAvLyBjb25maWdcbiAgdGhpcy5jID0gY29uZmlnO1xuICB0aGlzLnNjaGVtZSA9IHNjaGVtZTtcbiAgdGhpcy5tYXAgPSBuZXcgY29yZV9tYXAobWFwLCBzY2hlbWUsIGdyYXZpdHlfbWFwKTtcblxuICAvLyBjcmF0ZSBjaGFuY2UgdGFibGVcbiAgdGhpcy5jcmF0ZV9saXN0ID0gW107XG4gIGZvciAodmFyIGtleSBpbiB0aGlzLnNjaGVtZS53ZWFwb25zKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS53ZWFwb25zW2tleV0uY3JhdGVfY2hhbmNlOyBpKyspIHtcbiAgICAgIHRoaXMuY3JhdGVfbGlzdC5wdXNoKGtleSk7XG4gICAgfVxuICB9XG5cbiAgLy8gYXJtb3VyeSByZWZlcmVuY2UgdGFibGVcbiAgdGhpcy5hcm1vdXJ5X3JlZnMgPSBbXTtcbiAgZm9yIChrZXkgaW4gdGhpcy5zY2hlbWUud2VhcG9ucykge1xuICAgIHRoaXMuYXJtb3VyeV9yZWZzLnB1c2goa2V5KTtcbiAgfVxufVxuXG4vKiBTZXQgYSBibGFuayBzdGF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmJsYW5rX3N0YXRlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB7XG4gICAgZnJhbWU6IDAsXG4gICAgZXhwbG9zaW9uczoge30sXG4gICAgb2JqZWN0czoge30sXG4gICAgcGxheWVyczoge30sXG4gICAgZXZlbnRzOiBbXVxuICB9O1xufTtcblxuLyogUnVuIGV2ZXJ5IGZyYW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZnJhbWUgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5mcmFtZV9leHBsb3Npb25zKCk7XG4gIHRoaXMuZnJhbWVfcGxheWVycygpO1xuICB0aGlzLmZyYW1lX29iamVjdHMoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBFdmVudHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gYSBzcGVjaWZpYyB0eXBlIG9mIGV2ZW50XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnQgPSBmdW5jdGlvbihvYmosIHR5cGUsIGNvbGxpZGVkX29iaikge1xuICB2YXIgZXZlbnQgPSBvYmouYy5ldmVudHNbdHlwZV07XG4gIGlmICghZXZlbnQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgZXZlbnQsIGNvbGxpZGVkX29iaiwgdHlwZSk7XG59O1xuXG4vKiBSdW4gYSBzcGVjaWZpYyBldmVudFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnJ1bl9ldmVudCA9IGZ1bmN0aW9uKG9iaiwgZXZlbnQsIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBoYW5kbGUgYXJyYXlzIG9mIGV2ZW50c1xuICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHtcbiAgICB2YXIgc3RvcCA9IGZhbHNlO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnQubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzdG9wMiA9IHRoaXMucnVuX2V2ZW50KG9iaiwgZXZlbnRbaV0sIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gICAgICBzdG9wID0gc3RvcDIgPyB0cnVlIDogc3RvcDtcbiAgICB9XG4gICAgcmV0dXJuIHN0b3A7XG4gIH1cblxuICAvLyBydW4gZXZlbnQgZnVuY3Rpb25cbiAgaWYgKGV2ZW50ID09PSBcImRpZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfZGllKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJraWxsXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9raWxsKG9iaiwgY29sbGlkZWRfb2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJleHBsb2RlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9leHBsb2RlKG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiaGl0X2dpdmVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2hpdF9naXZlKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJoaXRfcmVjZWl2ZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfaGl0X3JlY2VpdmUob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImRlc3Ryb3lcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2Rlc3Ryb3kob2JqKTtcbiAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJjbHVzdGVyXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9jbHVzdGVyKG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiYm91bmNlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9ib3VuY2Uob2JqLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcImJvdW5jZV9leHBsb2RlXCIpIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudF9ib3VuY2VfZXhwbG9kZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwic3RpY2tcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X3N0aWNrKG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwic2xpZGVcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X3NsaWRlKG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwicGxheWVyX2JvdW5jZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfcGxheWVyX2JvdW5jZShvYmosIGNvbGxpZGVkX29iaiwgdHlwZSk7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiZHJhZ19wbGF5ZXJcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X2RyYWdfcGxheWVyKG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwic3Bhd25fZ2hvc3RcIikge1xuICAgIHJldHVybiB0aGlzLmV2ZW50X3NwYXduX2dob3N0KG9iaik7XG4gIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiY29sbGVjdFwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRfY29sbGVjdChvYmosIGNvbGxpZGVkX29iaik7XG4gIH1cbn07XG5cbi8qIE9iamVjdCBkaWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9kaWUgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBkaWUgZXZlbnRcbiAgdGhpcy5ldmVudChvYmosIFwiZGllXCIpO1xuXG4gIC8vIGNoZWNrIGZvciBkZXN0cm95IGV2ZW50c1xuICBpZiAodGhpcy5zY2hlbWUuZXZlbnRzLmRlc3Ryb3kpIHtcbiAgICBpZiAodGhpcy5zY2hlbWUuZXZlbnRzLmRlc3Ryb3lbb2JqLmlkXSkge1xuICAgICAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh0aGlzLnNjaGVtZS5ldmVudHMuZGVzdHJveVtvYmouaWRdKTtcbiAgICB9XG4gIH1cblxuICAvLyBkZWxldGUgdGhlIG9iamVjdFxuICBkZWxldGUgdGhpcy5zdGF0ZS5vYmplY3RzW29iai5rZXldO1xuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogT2JqZWN0IGtpbGxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9raWxsID0gZnVuY3Rpb24ob2JqLCBjb2xsaWRlZF9vYmopIHtcbiAgLy8gZGVzdHJveSBpdFxuICB0aGlzLnJ1bl9ldmVudChjb2xsaWRlZF9vYmosIFwiZGllXCIpO1xufTtcblxuLyogRXhwbG9kZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2V4cGxvZGUgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gY3JlYXRlIGV4cGxvc2lvbiBvYmplY3RcbiAgdGhpcy5jcmVhdGVfZXhwbG9zaW9uKHtcbiAgICBwbGF5ZXJfaWQ6IG9iai5wbGF5ZXJfaWQsXG4gICAgeDogb2JqLngsXG4gICAgeTogb2JqLnksXG4gICAgcGFyZW50OiBvYmoua2V5LFxuICAgIHBhcmVudF90eXBlOiBvYmoudHlwZVxuICB9KTtcbn07XG5cbi8qIEdpdmUgYSBoaXRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9oaXRfZ2l2ZSA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIHJldHVybiB0aGlzLnJ1bl9ldmVudChjb2xsaWRlZF9vYmosIFwiaGl0X3JlY2VpdmVcIiwgb2JqLCB0eXBlKTtcbn07XG5cbi8qIFJlY2VpdmUgYSBoaXRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9oaXRfcmVjZWl2ZSA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIC8vIHByZXZlbnQgaW5zdGFudCBoaXRzXG4gIGlmIChvYmouaGl0cykge1xuICAgIGZvciAodmFyIGtleSBpbiBvYmouaGl0cykge1xuICAgICAgaWYgKGtleSA9PT0gY29sbGlkZWRfb2JqLmtleSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gY2FsY3VsYXRlIGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaXQgY2FtZSBmcm9tXG4gIHZhciBhbmdsZSA9IHRoaXMubWFwLmdldF9oZWFkaW5nKFxuICAgIG9iai54LFxuICAgIG9iai55LFxuICAgIGNvbGxpZGVkX29iai54LFxuICAgIGNvbGxpZGVkX29iai55XG4gICk7XG4gIHZhciBkaXN0YW5jZSA9IHRoaXMubWFwLmdldF9kaXN0YW5jZShcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICBjb2xsaWRlZF9vYmoueCxcbiAgICBjb2xsaWRlZF9vYmoueVxuICApO1xuXG4gIC8vIGdldCBkYW1hZ2UgdmFsdWVzIGZyb20gY29sbGlkZWQgb2JqZWN0XG4gIHZhciBkYW1hZ2UgPSB0aGlzLmdldF9kYW1hZ2UoY29sbGlkZWRfb2JqKTtcbiAgdmFyIGtub2NrID0gY29sbGlkZWRfb2JqLmMua25vY2s7XG4gIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJleHBsb3Npb25cIikge1xuICAgIGRhbWFnZSAqPSBtYXgoMCwgKGRhbWFnZSAqIDIgLSBkaXN0YW5jZSkgLyAoZGFtYWdlICogMikpO1xuICB9XG5cbiAgLy8gaWdub3JlIGlmIHRoZXJlJ3Mgbm8gZGFtYWdlXG4gIGlmIChkYW1hZ2UgPT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBrbm9jayBvYmplY3RcbiAgaWYgKGtub2NrID4gMCkge1xuICAgIHZhciB4eSA9IHh5X3NwZWVkKGFuZ2xlLCBkYW1hZ2UpO1xuICAgIG9iai5zcGVlZF94IC09IHh5LnguZml4ZWQoKTtcbiAgICBvYmouc3BlZWRfeSAtPSB4eS55LmZpeGVkKCk7XG4gICAgb2JqLmdyb3VuZGVkID0gZmFsc2U7XG4gIH1cblxuICAvLyBhcmUgd2UgaGl0dGluZyBwbGF5ZXJcbiAgaWYgKG9iai50eXBlID09PSBcInBsYXllclwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfaGVhbHRoX2FkZChvYmoucGxheWVyX2lkLCAtcm91bmQoZGFtYWdlKSk7XG4gICAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICBpZiAocGxheWVyKSB7XG4gICAgICBwbGF5ZXIuaGl0ID0gZGFtYWdlICogMjtcbiAgICB9XG4gIH1cblxuICAvLyBzb3VuZCBlZmZlY3RcbiAgaWYgKGNvbGxpZGVkX29iai5jLmF1ZGlvLmhpdCkge1xuICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgICAgdHlwZTogXCJzb3VuZFwiLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNvdW5kOiBjb2xsaWRlZF9vYmouYy5hdWRpby5oaXRcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHNldCBoaXRzXG4gIGlmICghb2JqLmhpdHMpIHtcbiAgICBvYmouaGl0cyA9IHt9O1xuICB9XG4gIG9iai5oaXRzW2NvbGxpZGVkX29iai5rZXldID0gdHJ1ZTtcbn07XG5cbi8qIERlc3Ryb3kgZ3JvdW5kXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfZGVzdHJveSA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBsaW1pdCB0byBvbmNlIHBlciBmcmFtZVxuICBpZiAob2JqLmRlc3Ryb3llZCkge1xuICAgIHJldHVybjtcbiAgfVxuICBvYmouZGVzdHJveWVkID0gdHJ1ZTtcblxuICB2YXIgZGFtYWdlID0gdGhpcy5nZXRfZGFtYWdlKG9iaik7XG5cbiAgLy8gcmVjb3JkIGdyb3VuZCBkYW1hZ2VcbiAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgdHlwZTogXCJncm91bmRfZGFtYWdlXCIsXG4gICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgZGlnOiB0cnVlLFxuICAgIHg6IG9iai54LFxuICAgIHk6IG9iai55LFxuICAgIHJhZGl1czogZGFtYWdlXG4gIH0pO1xufTtcblxuLyogT2JqZWN0IGJvdW5jZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2JvdW5jZSA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIC8vIGlmIGdyb3VuZGVkIGRvbnQgZG8gYW55dGhpbmdcbiAgaWYgKG9iai5ncm91bmRlZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gY2hlY2sgc3BlZWRcbiAgdmFyIHNwZWVkID0gZ2V0X3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gIHZhciBjaGVja19zcGVlZCA9IHNwZWVkICogb2JqLmMuYm91bmNlO1xuICBpZiAoY2hlY2tfc3BlZWQgPCAxKSB7XG4gICAgb2JqLnNwZWVkX3ggPSAwO1xuICAgIG9iai5zcGVlZF95ID0gMDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIGdldCBuZXcgZGlyZWN0aW9uIGFuZ2xlXG4gIHZhciBkaXJlY3Rpb24gPSBnZXRfYW5nbGUob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgdmFyIHN1cmZhY2VfYW5nbGUgPSAwO1xuXG4gIC8vIGdldCBhbmdsZSBmcm9tIGdyb3VuZFxuICBpZiAodHlwZSA9PT0gXCJncm91bmRcIikge1xuICAgIHZhciB3YWxrID0gdGhpcy5tYXAud2Fsayhyb3VuZChvYmoueCksIHJvdW5kKG9iai55KSwgMCwgMCwgZGlyZWN0aW9uLCA2KTtcbiAgICBpZiAod2Fsay5tb3ZlKSB7XG4gICAgICBzdXJmYWNlX2FuZ2xlID0gd2Fsay5hbmdsZTtcbiAgICB9XG4gIH1cblxuICAvLyBnZXQgYW5nbGUgZnJvbSBvYmplY3RcbiAgZWxzZSB7XG4gICAgdmFyIGhlYWRpbmcgPSB0aGlzLm1hcC5nZXRfaGVhZGluZyhcbiAgICAgIG9iai54LFxuICAgICAgb2JqLnksXG4gICAgICBjb2xsaWRlZF9vYmoueCxcbiAgICAgIGNvbGxpZGVkX29iai55XG4gICAgKTtcbiAgICBzdXJmYWNlX2FuZ2xlID0gYW5nbGVfYWRkKGhlYWRpbmcsIDkwKTtcbiAgfVxuXG4gIC8vIHJlZmxlY3QgZGlyZWN0aW9uIGFuZ2xlIHdpdGggY29sbGlzaW9uIGFuZ2xlXG4gIHZhciByZWZsZWN0aW9uID0gKGRpcmVjdGlvbiAtIHN1cmZhY2VfYW5nbGUpICogMjtcbiAgdmFyIG5ld19hbmdsZSA9IGFuZ2xlX2FkZChkaXJlY3Rpb24sIC1yZWZsZWN0aW9uKTtcblxuICAvLyB0cmFuc2Zvcm0gbWFpbiB2ZWxvY2l0eSB0b3dhcmRzIG5ldyBhbmdsZVxuICB2YXIgbmV3X3NwZWVkID0geHlfc3BlZWQobmV3X2FuZ2xlLCBjaGVja19zcGVlZCk7XG4gIG9iai5zcGVlZF94ID0gbmV3X3NwZWVkLnguZml4ZWQoKTtcbiAgb2JqLnNwZWVkX3kgPSBuZXdfc3BlZWQueS5maXhlZCgpO1xuXG4gIC8vIHJlY29yZCBib3VuY2UgZXZlbnRcbiAgaWYgKHNwZWVkID4gMikge1xuICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgICAgdHlwZTogXCJib3VuY2VcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnksXG4gICAgICBvYmo6IG9iai5rZXlcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogT2JqZWN0IHN0aWNrIHRvIGdyb3VuZFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X3N0aWNrID0gZnVuY3Rpb24ob2JqKSB7XG4gIG9iai5ncm91bmRlZCA9IHRydWU7XG4gIG9iai5zcGVlZF94ID0gMDtcbiAgb2JqLnNwZWVkX3kgPSAwO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIE9iamVjdCBzbGlkZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X3NsaWRlID0gZnVuY3Rpb24ob2JqKSB7XG4gIHZhciBhbmdsZSA9IGdldF9hbmdsZShvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICB2YXIgd2FsayA9IHRoaXMubWFwLndhbGsob2JqLngsIG9iai55LCBvYmoueCwgb2JqLnksIGFuZ2xlLCBvYmouc3BlZWRfbGVmdCk7XG4gIGlmICh3YWxrLm1vdmUpIHtcbiAgICB0aGlzLmFjdGlvbl93YWxrX21vdmUob2JqLCB3YWxrLnBhdGgpO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogUGxheWVyIGJvdW5jZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X3BsYXllcl9ib3VuY2UgPSBmdW5jdGlvbihvYmosIGNvbGxpZGVkX29iaiwgdHlwZSkge1xuICAvLyBpZiBncm91bmRlZCBkb250IGRvIGFueXRoaW5nXG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBzcGVlZCA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuXG4gIHZhciBtYXhfc3BlZWQgPSB0aGlzLnNjaGVtZS5sZXZlbHMuanVtcFtwbGF5ZXIubGV2ZWxdIHx8IDA7XG4gIG1heF9zcGVlZCArPSAxMDtcbiAgaWYgKHBsYXllci5oaXQgPiAwIHx8IHNwZWVkID4gbWF4X3NwZWVkKSB7XG4gICAgcmV0dXJuIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJib3VuY2VcIiwgY29sbGlkZWRfb2JqLCB0eXBlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdGhpcy5ydW5fZXZlbnQob2JqLCBcInN0aWNrXCIpO1xuICB9XG59O1xuXG4vKiBEcmFnIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2RyYWdfcGxheWVyID0gZnVuY3Rpb24ob2JqKSB7XG4gIHZhciBwbGF5ZXJfb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgb2JqLnBsYXllcl9pZF07XG4gIGlmICghcGxheWVyX29iaikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHBsYXllcl9vYmouc3BlZWRfeCA9IG9iai5zcGVlZF94O1xuICBwbGF5ZXJfb2JqLnNwZWVkX3kgPSBvYmouc3BlZWRfeTtcbiAgcGxheWVyX29iai5kcmFnZ2VkID0gdHJ1ZTtcbn07XG5cbi8qIEZpcnN0IERlc3Ryb3lcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5ldmVudF9ib3VuY2VfZXhwbG9kZSA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqLCB0eXBlKSB7XG4gIGlmIChvYmouZnJhbWUgKyAxMCA+IHRoaXMuc3RhdGUuZnJhbWUpIHtcbiAgICByZXR1cm4gdGhpcy5ydW5fZXZlbnQob2JqLCBcImJvdW5jZVwiLCBjb2xsaWRlZF9vYmosIHR5cGUpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLnJ1bl9ldmVudChvYmosIFwiZXhwbG9kZVwiKTtcbiAgfVxufTtcblxuLyogU3Bhd24gcGxheWVyIGdob3N0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfc3Bhd25fZ2hvc3QgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gdHJhbnNmb3JtIG9iamVjdCBpbnRvIGdob3N0XG4gIG9iai50eXBlID0gXCJwbGF5ZXJfZ2hvc3RcIjtcbiAgb2JqLmMgPSB0aGlzLmMub2JqZWN0c1tcInBsYXllcl9naG9zdFwiXTtcbiAgb2JqLnNwZWVkX3ggPSAwO1xuICBvYmouc3BlZWRfeSA9IDA7XG59O1xuXG4vKiBDbHVzdGVyc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmV2ZW50X2NsdXN0ZXIgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gc2V0IG9mZiBleHBsb3Npb25zXG4gIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJleHBsb2RlXCIpO1xuXG4gIC8vIGdldCBjbHVzdGVyIGNvbnN0YW50c1xuICB2YXIgY2x1c3RlciA9IG9iai5jLmNsdXN0ZXI7XG5cbiAgLy8gZ2V0IG9wcG9zaXRlIGFuZ2xlIG9mIGdyYXZpdHlcbiAgdmFyIGFuZ2xlID0gdGhpcy5tYXAuZ2V0X2dyYXZpdHlfYW5nbGUob2JqLngsIG9iai55KTtcbiAgYW5nbGUgPSBhbmdsZV9hZGQoYW5nbGUsIDEzNSk7XG5cbiAgLy8gZ28gdGhyb3VnaCBjbHVzdGVyc1xuICB2YXIgcmFuZ2UgPSBjbHVzdGVyLmNpcmNsZSA/IDM2MCAtIDM2MCAvIGNsdXN0ZXIuY291bnQgOiA5MDtcbiAgdmFyIGFuZ2xlX2RpZmYgPSByYW5nZSAvIChjbHVzdGVyLmNvdW50IC0gMSk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2x1c3Rlci5jb3VudDsgaSsrKSB7XG4gICAgLy8gY3JlYXRlIGNsdXN0ZXIgb2JqZWN0c1xuICAgIHZhciBsYXVuY2hfYW5nbGUgPSBhbmdsZV9hZGQoYW5nbGUsIGkgKiBhbmdsZV9kaWZmKTtcbiAgICB2YXIgc3BlZWQgPSB4eV9zcGVlZChsYXVuY2hfYW5nbGUsIGNsdXN0ZXIuc3BlZWQpO1xuXG4gICAgLy8gY3JlYXRlIGNsdXN0ZXIgb2JqZWN0XG4gICAgdGhpcy5jcmVhdGVfb2JqZWN0KHtcbiAgICAgIHR5cGU6IGNsdXN0ZXIub2JqZWN0LFxuICAgICAgaWQ6IG9iai5pZCxcbiAgICAgIGRhdGE6IGkgKyAxLFxuICAgICAgcGxheWVyX2lkOiBvYmoucGxheWVyX2lkLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNwZWVkX3g6IHNwZWVkLnguZml4ZWQoKSxcbiAgICAgIHNwZWVkX3k6IHNwZWVkLnkuZml4ZWQoKVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBDb2xsZWN0IENyYXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZXZlbnRfY29sbGVjdCA9IGZ1bmN0aW9uKG9iaiwgY29sbGlkZWRfb2JqKSB7XG4gIC8vIHByZXAgZXZlbnQgdG8gc2VuZCB0byBnYW1lXG4gIHZhciBldmVudCA9IHtcbiAgICB0eXBlOiBcImNvbGxlY3RcIixcbiAgICBvYmo6IGNvbGxpZGVkX29iai5rZXksXG4gICAgcGxheWVyX2lkOiBvYmoucGxheWVyX2lkXG4gIH07XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gIGlmICghcGxheWVyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY3JhdGVcbiAgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImNyYXRlXCIpIHtcbiAgICB2YXIgY291bnQgPSB0aGlzLnNjaGVtZS53ZWFwb25zW2NvbGxpZGVkX29iai5kYXRhXS5jcmF0ZV9jb3VudDtcbiAgICBjb3VudCA9IGNvdW50ID09PSAtMSA/IFwiaW5maW5pdGVcIiA6IGNvdW50O1xuICAgIHRoaXMudXBkYXRlX3BsYXllcl9hcm1vdXJ5KG9iai5wbGF5ZXJfaWQsIGNvbGxpZGVkX29iai5kYXRhLCBjb3VudCk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJjcmF0ZVwiO1xuICAgIGV2ZW50LndlYXBvbiA9IGNvbGxpZGVkX29iai5kYXRhO1xuICAgIGV2ZW50LmNvdW50ID0gY291bnQ7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJjcmF0ZVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH1cblxuICAvLyBtZWRwYWNrXG4gIGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcIm1lZHBhY2tcIikge1xuICAgIHRoaXMucGxheWVyX2hlYWx0aF9hZGQob2JqLnBsYXllcl9pZCwgdGhpcy5zY2hlbWUuZHJvcHMubWVkcGFjay5hZGQpO1xuICAgIGV2ZW50LmNvbGxlY3RlZCA9IFwibWVkcGFja1wiO1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwibWVkcGFja1wiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH1cblxuICAvLyBnZW1zXG4gIGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS0xXCIpIHtcbiAgICB0aGlzLnBsYXllcl9zY29yZV9hZGQob2JqLnBsYXllcl9pZCwgMSk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gMTtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZ2VtLTVcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCA1KTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcImdlbVwiO1xuICAgIGV2ZW50Lm4gPSA1O1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiZ2VtXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb2xsaWRlZF9vYmoudHlwZSA9PT0gXCJnZW0tMjBcIikge1xuICAgIHRoaXMucGxheWVyX3Njb3JlX2FkZChvYmoucGxheWVyX2lkLCAyMCk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gMjA7XG4gICAgcGxheWVyLmV2ZW50cy5wdXNoKHtcbiAgICAgIGZyYW1lOiB0aGlzLnN0YXRlLmZyYW1lLFxuICAgICAgdHlwZTogXCJnZW1cIixcbiAgICAgIG9iajogY29sbGlkZWRfb2JqLmtleVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbGxpZGVkX29iai50eXBlID09PSBcImdlbS01MFwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfc2NvcmVfYWRkKG9iai5wbGF5ZXJfaWQsIDUwKTtcbiAgICBldmVudC5jb2xsZWN0ZWQgPSBcImdlbVwiO1xuICAgIGV2ZW50Lm4gPSA1MDtcbiAgICBwbGF5ZXIuZXZlbnRzLnB1c2goe1xuICAgICAgZnJhbWU6IHRoaXMuc3RhdGUuZnJhbWUsXG4gICAgICB0eXBlOiBcImdlbVwiLFxuICAgICAgb2JqOiBjb2xsaWRlZF9vYmoua2V5XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29sbGlkZWRfb2JqLnR5cGUgPT09IFwiZ2VtLTIwMFwiKSB7XG4gICAgdGhpcy5wbGF5ZXJfc2NvcmVfYWRkKG9iai5wbGF5ZXJfaWQsIDIwMCk7XG4gICAgZXZlbnQuY29sbGVjdGVkID0gXCJnZW1cIjtcbiAgICBldmVudC5uID0gMjAwO1xuICAgIHBsYXllci5ldmVudHMucHVzaCh7XG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHR5cGU6IFwiZ2VtXCIsXG4gICAgICBvYmo6IGNvbGxpZGVkX29iai5rZXlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHJlY29yZCBldmVudFxuICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKGV2ZW50KTtcblxuICAvLyBraWxsIG9iamVjdFxuICB0aGlzLnJ1bl9ldmVudChjb2xsaWRlZF9vYmosIFwiZGllXCIsIG9iaiwgXCJjb2xsZWN0XCIpO1xuXG4gIC8vIGNoZWNrIGZvciBjb2xsZWN0aW9uIGV2ZW50c1xuICBpZiAodGhpcy5zY2hlbWUuZXZlbnRzLmNvbGxlY3QpIHtcbiAgICBpZiAodGhpcy5zY2hlbWUuZXZlbnRzLmNvbGxlY3RbY29sbGlkZWRfb2JqLmlkXSkge1xuICAgICAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh0aGlzLnNjaGVtZS5ldmVudHMuY29sbGVjdFtjb2xsaWRlZF9vYmouaWRdKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgRXhwbG9zaW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBhbiBleHBsb3Npb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5jcmVhdGVfZXhwbG9zaW9uID0gZnVuY3Rpb24ocHJvcHMsIHN0YXRlKSB7XG4gIHZhciBzdGF0ZV9yZWYgPSBzdGF0ZSB8fCB0aGlzLnN0YXRlO1xuXG4gIHZhciBvYmogPSB7XG4gICAgdHlwZTogXCJleHBsb3Npb25cIixcbiAgICBwbGF5ZXJfaWQ6IFwiXCIsXG4gICAgZnJhbWU6IHN0YXRlX3JlZi5mcmFtZSxcbiAgICB4OiAwLFxuICAgIHk6IDAsXG4gICAgcGFyZW50OiBcIlwiLFxuICAgIHBhcmVudF90eXBlOiBcIlwiXG4gIH07XG4gIG9iaiA9IGRlZXBtZXJnZShvYmosIHByb3BzKTtcbiAgb2JqLmMgPSB0aGlzLmMub2JqZWN0c1tvYmoucGFyZW50X3R5cGVdO1xuXG4gIC8vIGFkZCB0byBzdGF0ZSBvYmplY3RzXG4gIHN0YXRlX3JlZi5leHBsb3Npb25zW29iai5wYXJlbnRdID0gb2JqO1xufTtcblxuLyogQ2hlY2sgYWxsIGV4aXN0aW5nIGV4cGxvc2lvbnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5mcmFtZV9leHBsb3Npb25zID0gZnVuY3Rpb24oKSB7XG4gIC8vIGdvIHRocm91Z2ggYWxsIGV4cGxvc2lvbnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUuZXhwbG9zaW9ucykge1xuICAgIHZhciBleHBsb2RlID0gdGhpcy5zdGF0ZS5leHBsb3Npb25zW2tleV07XG5cbiAgICAvLyBpZiBleHBpcmVkIHJlbW92ZVxuICAgIGlmICh0aGlzLnN0YXRlLmZyYW1lID4gZXhwbG9kZS5mcmFtZSArIDQwKSB7XG4gICAgICBkZWxldGUgdGhpcy5zdGF0ZS5leHBsb3Npb25zW2tleV07XG4gICAgfVxuXG4gICAgLy8gaWYgZXhwbG9kaW5nIHRoaXMgZnJhbWUgcnVuXG4gICAgaWYgKHRoaXMuc3RhdGUuZnJhbWUgPT09IGV4cGxvZGUuZnJhbWUgKyAxKSB7XG4gICAgICB0aGlzLnJ1bl9leHBsb3Npb24oZXhwbG9kZSk7XG4gICAgfVxuICB9XG59O1xuXG4vKiBSdW4gYW4gZXhwbG9zaW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucnVuX2V4cGxvc2lvbiA9IGZ1bmN0aW9uKGV4cGxvZGUpIHtcbiAgLy8gaWYgbm8gZGFtYWdlXG4gIGlmICghZXhwbG9kZS5jLmRhbWFnZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNhbGN1bGF0ZSBhZGRpdGlvbmFsIHBsYXllciBkYW1hZ2VcbiAgdmFyIGRhbWFnZSA9IHRoaXMuZ2V0X2RhbWFnZShleHBsb2RlKTtcblxuICAvLyBjaGVjayBjb2xsaXNpb25zXG4gIGZvciAoa2V5IGluIHRoaXMuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLnN0YXRlLm9iamVjdHNba2V5XTtcblxuICAgIC8vIGlmIG9iamVjdCB3YXMganVzdCBtYWRlXG4gICAgaWYgKHRoaXMuc3RhdGUuZnJhbWUgPCBvYmouZnJhbWUgKyAyKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBydW4gY29sbGlzaW9uIGNoZWNrXG4gICAgaWYgKFxuICAgICAgIXRoaXMuY29sbGlzaW9uX2NoZWNrKFxuICAgICAgICBvYmoueCxcbiAgICAgICAgb2JqLnksXG4gICAgICAgIGV4cGxvZGUueCxcbiAgICAgICAgZXhwbG9kZS55LFxuICAgICAgICBvYmouYy5zaXplLFxuICAgICAgICBkYW1hZ2UgKiAyXG4gICAgICApXG4gICAgKSB7XG4gICAgICB0aGlzLmV2ZW50KG9iaiwgXCJleHBsb3Npb25cIiwgZXhwbG9kZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gcmVjb3JkIGdyb3VuZCBkYW1hZ2VcbiAgdmFyIHB0eXBlID0gdGhpcy5jLm9iamVjdHNbZXhwbG9kZS5wYXJlbnRfdHlwZV07XG4gIGlmIChwdHlwZSAmJiBwdHlwZS5kZXN0cm95X2dyb3VuZCkge1xuICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgICAgdHlwZTogXCJncm91bmRfZGFtYWdlXCIsXG4gICAgICBmcmFtZTogdGhpcy5zdGF0ZS5mcmFtZSxcbiAgICAgIHg6IGV4cGxvZGUueCxcbiAgICAgIHk6IGV4cGxvZGUueSxcbiAgICAgIHJhZGl1czogZGFtYWdlXG4gICAgfSk7XG4gIH1cbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBPYmplY3RzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ3JlYXRlIGEgbmV3IGdhbWUgb2JqZWN0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuY3JlYXRlX29iamVjdCA9IGZ1bmN0aW9uKHByb3BzLCBzdGF0ZSkge1xuICB2YXIgc3RhdGVfcmVmID0gc3RhdGUgfHwgdGhpcy5zdGF0ZTtcblxuICB2YXIgb2JqID0ge1xuICAgIHR5cGU6IFwiXCIsXG4gICAgcGxheWVyX2lkOiBcIlwiLFxuICAgIGlkOiBcIlwiLFxuICAgIGZyYW1lOiBzdGF0ZV9yZWYuZnJhbWUsXG4gICAgZ3JvdW5kZWQ6IGZhbHNlLFxuICAgIHg6IDAsXG4gICAgeTogMCxcbiAgICBzcGVlZF94OiAwLFxuICAgIHNwZWVkX3k6IDAsXG4gICAgZGF0YTogXCJcIlxuICB9O1xuICBvYmogPSBkZWVwbWVyZ2Uob2JqLCBwcm9wcyk7XG4gIG9iai5jID0gdGhpcy5jLm9iamVjdHNbb2JqLnR5cGVdO1xuICB2YXIga2V5X3R5cGUgPSBvYmoudHlwZTtcblxuICAvLyBzZXQga2V5XG4gIGlmIChcbiAgICBvYmoudHlwZSA9PT0gXCJwbGF5ZXJcIiB8fFxuICAgIG9iai50eXBlID09PSBcInBsYXllcl9naG9zdFwiIHx8XG4gICAgb2JqLnR5cGUgPT09IFwicGxheWVyX21pc3NpbGVcIlxuICApIHtcbiAgICBvYmoua2V5ID0gXCJwbGF5ZXItXCIgKyBvYmoucGxheWVyX2lkO1xuICB9IGVsc2Uge1xuICAgIG9iai5rZXkgPVxuICAgICAgb2JqLnR5cGUgK1xuICAgICAgXCItXCIgK1xuICAgICAgb2JqLnBsYXllcl9pZCArXG4gICAgICBcIi1cIiArXG4gICAgICBvYmouaWQgK1xuICAgICAgXCItXCIgK1xuICAgICAgb2JqLmZyYW1lICtcbiAgICAgIFwiLVwiICtcbiAgICAgIG9iai5kYXRhO1xuICB9XG5cbiAgLy8gYWRkIHRvIHN0YXRlIG9iamVjdHNcbiAgc3RhdGVfcmVmLm9iamVjdHNbb2JqLmtleV0gPSBvYmo7XG5cbiAgLy8gcmV0dXJuIGl0XG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBTbmFwIG9iamVjdCB0byBhbm90aGVyIG9iamVjdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnNuYXBfb2JqZWN0ID0gZnVuY3Rpb24ob2JqMSwgb2JqMikge1xuICBvYmoxLmdyb3VuZGVkID0gb2JqMi5ncm91bmRlZDtcbiAgb2JqMS54ID0gb2JqMi54O1xuICBvYmoxLnkgPSBvYmoyLnk7XG4gIG9iajEuc3BlZWRfeCA9IG9iajIuc3BlZWRfeDtcbiAgb2JqMS5zcGVlZF95ID0gb2JqMi5zcGVlZF95O1xufTtcblxuLyogUnVuIHRocm91Z2ggb2JqZWN0IGZyYW1lIGV2ZW50c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmZyYW1lX29iamVjdHMgPSBmdW5jdGlvbigpIHtcbiAgLy8gcnVuIHRocm91Z2ggYWxsIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUub2JqZWN0cykge1xuICAgIHRoaXMuZnJhbWVfb2JqZWN0KHRoaXMuc3RhdGUub2JqZWN0c1trZXldKTtcbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBwbGF5ZXIgbG9ja1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgdGhpcy5mcmFtZV9wbGF5ZXJfbG9jayh0aGlzLnN0YXRlLnBsYXllcnNba2V5XSk7XG4gIH1cbn07XG5cbmNvcmUucHJvdG90eXBlLmZyYW1lX29iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuICBvYmouZGVzdHJveWVkID0gZmFsc2U7XG5cbiAgLy8gc3RvcHBpbmdcbiAgaWYgKG9iai5jLnN0b3AgPiAwICYmIHRoaXMuc3RhdGUuZnJhbWUgPiBvYmouZnJhbWUgKyBvYmouYy5zdG9wKSB7XG4gICAgb2JqLnNwZWVkX3ggPSAwO1xuICAgIG9iai5zcGVlZF95ID0gMDtcbiAgfVxuXG4gIC8vIHRpbWVvdXRcbiAgaWYgKG9iai5jLnRpbWVvdXQgPiAwICYmIG9iai5mcmFtZSArIG9iai5jLnRpbWVvdXQgPD0gdGhpcy5zdGF0ZS5mcmFtZSkge1xuICAgIHRoaXMucnVuX2V2ZW50KG9iaiwgXCJkaWVcIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcnVuIHBoeXNpY3Mgb24gb2JqZWN0XG4gIHRoaXMucGh5c2ljcyhvYmopO1xuXG4gIC8vIGV2ZW50c1xuICB0aGlzLmV2ZW50KG9iaiwgXCJmcmFtZVwiKTtcbn07XG5cbi8qIFNwYXduc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnNwYXduID0gZnVuY3Rpb24ocHJvcHMpIHtcbiAgLy8gd2VhcG9uIGNyYXRlIGNvbnRlbnRzXG4gIGlmIChwcm9wcy50eXBlID09IFwiY3JhdGVcIikge1xuICAgIGlmICh0aGlzLmNyYXRlX2xpc3QubGVuZ3RoIDwgMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBwcm9wcy5kYXRhID0gdGhpcy5jcmF0ZV9saXN0W3JhbmQoMCwgdGhpcy5jcmF0ZV9saXN0Lmxlbmd0aCldO1xuICB9XG5cbiAgLy8gZG8gd2UgaGF2ZSBhIHNldCBwb3NpdGlvblxuICBpZiAoIXByb3BzLnggJiYgIXByb3BzLnkpIHtcbiAgICB2YXIgcG9zID0gdGhpcy5tYXAuYWlyX2ZpbmRfc3BvdCgpO1xuICAgIHByb3BzLnggPSBwb3MueDtcbiAgICBwcm9wcy55ID0gcG9zLnk7XG4gIH1cblxuICByZXR1cm4gdGhpcy5jcmVhdGVfb2JqZWN0KHByb3BzKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBQaHlzaWNzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIGFpciBwaHlzaWNzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGh5c2ljcyA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBhcmUgd2Ugc3RpbGwgZ3JvdW5kZWRcbiAgaWYgKG9iai5ncm91bmRlZCkge1xuICAgIGlmICghdGhpcy5tYXAuZ3JvdW5kX3BpeGVsKHJvdW5kKG9iai54KSwgcm91bmQob2JqLnkpKSkge1xuICAgICAgb2JqLmdyb3VuZGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIHRoZSBtYWluIHBoeXNpY3NcbiAgaWYgKCFvYmouZ3JvdW5kZWQpIHtcbiAgICB0aGlzLnBoeXNpY3NfZ3Jhdml0eShvYmopO1xuICAgIHRoaXMucGh5c2ljc19tb3ZlKG9iaik7XG4gIH1cbn07XG5cbi8qIENhbGN1bGF0ZSBncmF2aXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGh5c2ljc19ncmF2aXR5ID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIGlmIG5vIHdlaWdodFxuICBpZiAob2JqLmMud2VpZ2h0IDw9IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnZXQgZ3Jhdml0eSB2YWx1ZXNcbiAgdmFyIGdyYXZpdHkgPSB0aGlzLm1hcC5nZXRfZ3Jhdml0eShyb3VuZChvYmoueCksIHJvdW5kKG9iai55KSk7XG5cbiAgLy8gYWRqdXN0IHNwZWVkXG4gIHRoaXMucGh5c2ljc19hZGp1c3Rfc3BlZWQoXG4gICAgb2JqLFxuICAgIGdyYXZpdHkueCxcbiAgICBncmF2aXR5LnksXG4gICAgb2JqLmMuc3BlZWQubWF4X2dyYXZpdHksXG4gICAgb2JqLmMud2VpZ2h0XG4gICk7XG59O1xuXG4vKiBBZGp1c3Qgc3BlZWQgb2Ygb2JqZWN0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGh5c2ljc19hZGp1c3Rfc3BlZWQgPSBmdW5jdGlvbihcbiAgb2JqLFxuICBuZXdfc3BlZWRfeCxcbiAgbmV3X3NwZWVkX3ksXG4gIG1heF9zcGVlZCxcbiAgd2VpZ2h0XG4pIHtcbiAgdmFyIGFuZ2xlID0gZ2V0X2FuZ2xlKG5ld19zcGVlZF94LCBuZXdfc3BlZWRfeSk7XG4gIHZhciBtYXhfc3BlZWQgPSB4eV9zcGVlZChhbmdsZSwgbWF4X3NwZWVkKTtcbiAgdmFyIHNwZWVkX2FkZF94ID0gbmV3X3NwZWVkX3ggKiB3ZWlnaHQ7XG4gIHZhciBzcGVlZF9hZGRfeSA9IG5ld19zcGVlZF95ICogd2VpZ2h0O1xuICB2YXIgZGlmZl94ID0gbWF4X3NwZWVkLnggLSBvYmouc3BlZWRfeDtcbiAgdmFyIGRpZmZfeSA9IG1heF9zcGVlZC55IC0gb2JqLnNwZWVkX3k7XG5cbiAgLy8gb25seSBhZGQgc3BlZWQgdXAgdG8gdGhlIGxpbWl0IHdpdGhvdXQgYnJpbmdpbmcgaXQgZG93blxuICBpZiAobWF4X3NwZWVkLnggPCAwKSB7XG4gICAgb2JqLnNwZWVkX3ggKz0gbWF4KHNwZWVkX2FkZF94LCBtaW4oMCwgZGlmZl94KSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqLnNwZWVkX3ggKz0gbWluKHNwZWVkX2FkZF94LCBtYXgoMCwgZGlmZl94KSk7XG4gIH1cbiAgaWYgKG1heF9zcGVlZC55IDwgMCkge1xuICAgIG9iai5zcGVlZF95ICs9IG1heChzcGVlZF9hZGRfeSwgbWluKDAsIGRpZmZfeSkpO1xuICB9IGVsc2Uge1xuICAgIG9iai5zcGVlZF95ICs9IG1pbihzcGVlZF9hZGRfeSwgbWF4KDAsIGRpZmZfeSkpO1xuICB9XG5cbiAgb2JqLnNwZWVkX3ggPSBvYmouc3BlZWRfeC5maXhlZCgpO1xuICBvYmouc3BlZWRfeSA9IG9iai5zcGVlZF95LmZpeGVkKCk7XG59O1xuXG4vKiBEbyB0aGUgbW92ZW1lbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5waHlzaWNzX21vdmUgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gY2hlY2sgc3BlZWRcbiAgdmFyIHNwZWVkX2xpbWl0ID0gY2hlY2tfc3BlZWQob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95LCBvYmouYy5zcGVlZC5tYXgpO1xuICBvYmouc3BlZWRfeCA9IHNwZWVkX2xpbWl0LnguZml4ZWQoKTtcbiAgb2JqLnNwZWVkX3kgPSBzcGVlZF9saW1pdC55LmZpeGVkKCk7XG5cbiAgLy8gcGxvdCBhIGNvdXJzZVxuICB2YXIgY291cnNlID0gcGxvdF9jb3Vyc2Uob2JqLngsIG9iai55LCBvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuXG4gIC8vIGlmIG5vIGNvdXJzZVxuICBpZiAoIWNvdXJzZS5tb3ZlKSB7XG4gICAgdGhpcy5jb2xsaXNpb25zKG9iaiwgb2JqLngsIG9iai55KTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBtb3ZlIHRocm91Z2ggY291cnNlXG4gIHZhciBtb3ZlZCA9IGZhbHNlO1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGNvdXJzZS5wb2ludHMubGVuZ3RoOyBpKyspIHtcbiAgICAvLyByZW1haW5pbmcgbW92ZW1lbnQgcG9pbnRzIGxlZnRcbiAgICBvYmouc3BlZWRfbGVmdCA9IGNvdXJzZS5wb2ludHMubGVuZ3RoIC0gaTtcblxuICAgIHZhciBwb2ludCA9IGNvdXJzZS5wb2ludHNbaV07XG4gICAgdmFyIG54ID0gdGhpcy5tYXAubG9vcF94KHJvdW5kKHBvaW50LngpKTtcbiAgICB2YXIgbnkgPSB0aGlzLm1hcC5sb29wX3kocm91bmQocG9pbnQueSkpO1xuXG4gICAgLy8gY29sbGlzaW9uc1xuICAgIHZhciBjb2xsaXNpb24gPSB0aGlzLmNvbGxpc2lvbnMob2JqLCBueCwgbnkpO1xuICAgIGlmIChjb2xsaXNpb24pIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIG1vdmUgb2JqZWN0XG4gICAgb2JqLnggPSBueDtcbiAgICBvYmoueSA9IG55O1xuICAgIG1vdmVkID0gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBtb3ZlZDtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBQbGF5ZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ3JlYXRlIGEgbmV3IHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmNyZWF0ZV9wbGF5ZXIgPSBmdW5jdGlvbihwcm9wcywgc3RhdGUpIHtcbiAgaWYgKHR5cGVvZiBwcm9wcy5pZCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzdGF0ZV9yZWYgPSBzdGF0ZSB8fCB0aGlzLnN0YXRlO1xuXG4gIC8vIHNldCB1cCBvYmplY3RcbiAgdmFyIG9iaiA9IHtcbiAgICBpZDogXCJcIixcbiAgICBsZXZlbDogMCxcbiAgICBzY29yZTogMCxcbiAgICBkZWFkOiBmYWxzZSxcbiAgICBoZWFsdGg6IHRoaXMuc2NoZW1lLmxldmVscy5oZWFsdGhbMF0sXG4gICAgY29vbGRvd246IDAsXG4gICAgaGl0OiAwLFxuICAgIHdlYXBvbjogXCJcIixcbiAgICBsb2NrZWQ6IFwiXCIsXG4gICAgZXZlbnRzOiBbXSxcbiAgICBhcm1vdXJ5OiB7fVxuICB9O1xuICBvYmogPSBkZWVwbWVyZ2Uob2JqLCBwcm9wcyk7XG4gIG9iai5pZCA9IHBhcnNlSW50KG9iai5pZCk7XG5cbiAgLy8gc2V0IGxldmVsXG4gIHRoaXMucGxheWVyX2xldmVsKG9iai5pZCk7XG5cbiAgLy8gYWRkIHRvIHN0YXRlIG9iamVjdHNcbiAgc3RhdGVfcmVmLnBsYXllcnNbb2JqLmlkXSA9IG9iajtcblxuICByZXR1cm4gb2JqO1xufTtcblxuLyogUmVtb3ZlIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnJlbW92ZV9wbGF5ZXIgPSBmdW5jdGlvbihwbGF5ZXJfaWQpIHtcbiAgaWYgKCF0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGRlbGV0ZSB0aGlzLnN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyBwbGF5ZXJfaWRdO1xuICBkZWxldGUgdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG59O1xuXG4vKiBTdGFydCB0aGUgcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuaW5pdF9wbGF5ZXIgPSBmdW5jdGlvbihwbGF5ZXJfaWQsIHN0YXRlKSB7XG4gIHBsYXllcl9pZCA9IHBhcnNlSW50KHBsYXllcl9pZCk7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBwbGF5ZXIgdmFsdWVzXG4gIHBsYXllci5sZXZlbCA9IDA7XG4gIHBsYXllci5zY29yZSA9IDA7XG4gIHBsYXllci5kZWFkID0gZmFsc2U7XG4gIHBsYXllci5oZWFsdGggPSB0aGlzLnNjaGVtZS5sZXZlbHMuaGVhbHRoWzBdO1xuICBwbGF5ZXIuY29vbGRvd24gPSAwO1xuICBwbGF5ZXIuZXZlbnRzID0gW107XG5cbiAgLy8gYXJtb3VyeVxuICB2YXIgYXJtb3VyeSA9IHt9O1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zY2hlbWUud2VhcG9ucykge1xuICAgIGFybW91cnlba2V5XSA9IHRoaXMuc2NoZW1lLndlYXBvbnNba2V5XS5zdGFydF9jb3VudDtcbiAgfVxuICBwbGF5ZXIuYXJtb3VyeSA9IGFybW91cnk7XG5cbiAgLy8gbWVyZ2Ugd2l0aCBhbiBleHRlcm5hbCBzdGF0ZVxuICBpZiAoc3RhdGUpIHtcbiAgICB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXSA9IGRlZXBtZXJnZShwbGF5ZXIsIHN0YXRlKTtcbiAgfVxuXG4gIC8vIHNldCBsZXZlbFxuICB0aGlzLnBsYXllcl9sZXZlbChwbGF5ZXJfaWQpO1xuXG4gIC8vIG9iamVjdCB2YWx1ZXNcbiAgdmFyIG9iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllcl9pZF07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICh0aGlzLnNjaGVtZS5zcGF3bi5sZW5ndGggPiAwKSB7XG4gICAgdmFyIHBvcyA9IHRoaXMuc2NoZW1lLnNwYXduW3JhbmQoMCwgdGhpcy5zY2hlbWUuc3Bhd24ubGVuZ3RoKV07XG4gIH0gZWxzZSB7XG4gICAgdmFyIHBvcyA9IHRoaXMubWFwLmFpcl9maW5kX3Nwb3QoKTtcbiAgfVxuICBvYmoudHlwZSA9IFwicGxheWVyXCI7XG4gIG9iai5ncm91bmRlZCA9IGZhbHNlO1xuICBvYmoueCA9IHBvcy54O1xuICBvYmoueSA9IHBvcy55O1xuICBvYmouc3BlZWRfeCA9IDA7XG4gIG9iai5zcGVlZF95ID0gMDtcbiAgb2JqLmMgPSB0aGlzLmMub2JqZWN0c1tcInBsYXllclwiXTtcbn07XG5cbi8qIFVwZGF0ZSBhcm1vdXJ5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUudXBkYXRlX3BsYXllcl9hcm1vdXJ5ID0gZnVuY3Rpb24ocGxheWVyX2lkLCB3ZWFwb24sIGNvdW50KSB7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpZiBpbmZpbml0ZSBvciBpZiB6ZXJvIGFuZCB0YWtpbmcgYXdheVxuICB2YXIgb2xkX2NvdW50ID0gcGxheWVyLmFybW91cnlbd2VhcG9uXTtcbiAgaWYgKCFpc19udW1lcmljKG9sZF9jb3VudCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKG9sZF9jb3VudCA9PT0gLTEpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAob2xkX2NvdW50ID09PSAwICYmIGNvdW50IDwgMSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIGlmIGluZmluaXRlXG4gIGlmIChjb3VudCA9PT0gXCJpbmZpbml0ZVwiKSB7XG4gICAgcGxheWVyLmFybW91cnlbd2VhcG9uXSA9IC0xO1xuICB9IGVsc2Uge1xuICAgIHBsYXllci5hcm1vdXJ5W3dlYXBvbl0gKz0gY291bnQ7XG4gIH1cblxuICAvLyByZWNvcmQgZXZlbnRcbiAgdGhpcy5zdGF0ZS5ldmVudHMucHVzaCh7XG4gICAgdHlwZTogXCJhcm1vdXJ5XCIsXG4gICAgcGxheWVyX2lkOiBwbGF5ZXJfaWQsXG4gICAgd2VhcG9uOiB3ZWFwb25cbiAgfSk7XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiBBZGQgaGVhbHRoIHRvIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBsYXllcl9oZWFsdGhfYWRkID0gZnVuY3Rpb24ocGxheWVyX2lkLCBoZWFsdGgsIG5vX21lc3NhZ2UpIHtcbiAgdmFyIHBsYXllciA9IHRoaXMuc3RhdGUucGxheWVyc1twbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllciB8fCBwbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIG5vIGhlYWx0aCBlbmFibGVkXG4gIGlmICghdGhpcy5zY2hlbWUuaGVhbHRoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYWRkIGl0XG4gIHBsYXllci5oZWFsdGggKz0gaGVhbHRoO1xuICBwbGF5ZXIuaGVhbHRoID0gbWluKHBsYXllci5oZWFsdGgsIHRoaXMuc2NoZW1lLmxldmVscy5oZWFsdGhbcGxheWVyLmxldmVsXSk7XG5cbiAgLy8gYXJlIHdlIGRlYWRcbiAgaWYgKHBsYXllci5oZWFsdGggPD0gMCkge1xuICAgIHRoaXMucGxheWVyX2RpZShwbGF5ZXJfaWQpO1xuICB9XG5cbiAgLy8gc2V0IGV2ZW50XG4gIGlmICghbm9fbWVzc2FnZSkge1xuICAgIHRoaXMuc3RhdGUuZXZlbnRzLnB1c2goe1xuICAgICAgdHlwZTogXCJwbGF5ZXJfaGVhbHRoXCIsXG4gICAgICBpZDogcGxheWVyX2lkLFxuICAgICAgaGVhbHRoOiBoZWFsdGhcbiAgICB9KTtcbiAgfVxufTtcblxuLyogQWRkIHNjb3JlIHRvIHBsYXllclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBsYXllcl9zY29yZV9hZGQgPSBmdW5jdGlvbihwbGF5ZXJfaWQsIHNjb3JlKSB7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIgfHwgcGxheWVyLmRlYWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBhZGQgaXRcbiAgcGxheWVyLnNjb3JlICs9IHNjb3JlO1xuXG4gIC8vIHNldCBsZXZlbFxuICB0aGlzLnBsYXllcl9sZXZlbChwbGF5ZXJfaWQpO1xuXG4gIC8vIHNldCBldmVudFxuICB0aGlzLnN0YXRlLmV2ZW50cy5wdXNoKHtcbiAgICB0eXBlOiBcInBsYXllcl9zY29yZVwiLFxuICAgIGlkOiBwbGF5ZXJfaWQsXG4gICAgc2NvcmU6IHNjb3JlXG4gIH0pO1xufTtcblxuLyogU2V0IHBsYXllciBsZXZlbFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnBsYXllcl9sZXZlbCA9IGZ1bmN0aW9uKHBsYXllcl9pZCkge1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW3BsYXllcl9pZF07XG4gIGlmICghcGxheWVyIHx8IHBsYXllci5kZWFkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBsZXZlbHNcbiAgdmFyIGxldmVsID0gMDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5sZXZlbHMuc2NvcmUubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlW2ldIDw9IHBsYXllci5zY29yZSkge1xuICAgICAgbGV2ZWwgPSBpO1xuICAgIH1cbiAgfVxuICBwbGF5ZXIubGV2ZWwgPSBsZXZlbDtcbn07XG5cbi8qIFBsYXllciBkaWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wbGF5ZXJfZGllID0gZnVuY3Rpb24ocGxheWVyX2lkKSB7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIgfHwgcGxheWVyLmRlYWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBwbGF5ZXIuZGVhZCA9IHRydWU7XG5cbiAgdmFyIG9iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHBsYXllcl9pZF07XG4gIG9iai50eXBlID0gXCJwbGF5ZXJfbWlzc2lsZVwiO1xuICBvYmouYyA9IHRoaXMuYy5vYmplY3RzW1wicGxheWVyX21pc3NpbGVcIl07XG5cbiAgLy8gZmlndXJlIG91dCBnZW1zIHRvIHNwYXduXG4gIHZhciBuID0gbWF4KHJvdW5kKHBsYXllci5zY29yZSAvIDIpLCAzKTtcbiAgdmFyIGdlbXMgPSBbXTtcbiAgd2hpbGUgKG4gPiAyMDApIHtcbiAgICBnZW1zLnB1c2goMjAwKTtcbiAgICBuIC09IDIwMDtcbiAgfVxuICB3aGlsZSAobiA+IDUwKSB7XG4gICAgZ2Vtcy5wdXNoKDUwKTtcbiAgICBuIC09IDUwO1xuICB9XG4gIHdoaWxlIChuID4gMjApIHtcbiAgICBnZW1zLnB1c2goMjApO1xuICAgIG4gLT0gMjA7XG4gIH1cbiAgd2hpbGUgKG4gPiA1KSB7XG4gICAgZ2Vtcy5wdXNoKDUpO1xuICAgIG4gLT0gNTtcbiAgfVxuICB3aGlsZSAobiA+IDEpIHtcbiAgICBnZW1zLnB1c2goMSk7XG4gICAgbiAtPSAxO1xuICB9XG5cbiAgLy8gc3Bhd24gdGhlbVxuICB2YXIgYW5nbGVfaW5jID0gcm91bmQoMzYwIC8gZ2Vtcy5sZW5ndGgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGdlbXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgbiA9ICgoaSAlIDMpICsgMSkgKiAyO1xuICAgIHZhciB4eSA9IHh5X3NwZWVkKGFuZ2xlX2luYyAqIGksIG4pO1xuICAgIHRoaXMuY3JlYXRlX29iamVjdCh7XG4gICAgICB0eXBlOiBcImdlbS1cIiArIGdlbXNbaV0sXG4gICAgICBwbGF5ZXJfaWQ6IG9iai5wbGF5ZXJfaWQsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgc3BlZWRfeDogeHkueC5maXhlZCgpLFxuICAgICAgc3BlZWRfeTogeHkueS5maXhlZCgpLFxuICAgICAgZGF0YTogaSArIDFcbiAgICB9KTtcbiAgfVxufTtcblxuLyogUnVuIHRocm91Z2ggcGxheWVyc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmZyYW1lX3BsYXllcnMgPSBmdW5jdGlvbihpZ25vcmUpIHtcbiAgLy8gcnVuIHRocm91Z2ggYWxsIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuc3RhdGUucGxheWVycykge1xuICAgIGlmIChwYXJzZUludChrZXkpICE9PSBpZ25vcmUpIHtcbiAgICAgIHRoaXMuZnJhbWVfcGxheWVyKHRoaXMuc3RhdGUucGxheWVyc1trZXldKTtcbiAgICB9XG4gIH1cbn07XG5cbmNvcmUucHJvdG90eXBlLmZyYW1lX3BsYXllciA9IGZ1bmN0aW9uKHBsYXllcikge1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNvb2xkb3duXG4gIGlmIChwbGF5ZXIuY29vbGRvd24gPiAwKSB7XG4gICAgcGxheWVyLmNvb2xkb3duLS07XG4gIH1cblxuICAvLyBoaXRcbiAgaWYgKHBsYXllci5oaXQgPiAwKSB7XG4gICAgcGxheWVyLmhpdC0tO1xuICB9XG5cbiAgLy8gaGVhbHRoIHJlZ2VuXG4gIGlmICh0aGlzLnN0YXRlLmZyYW1lICUgMjQgPT09IDApIHtcbiAgICBpZiAocGxheWVyLmhlYWx0aCA8IHRoaXMuc2NoZW1lLmxldmVscy5oZWFsdGhbcGxheWVyLmxldmVsXSkge1xuICAgICAgdGhpcy5wbGF5ZXJfaGVhbHRoX2FkZChwbGF5ZXIuaWQsIDIsIHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJlbW92ZSBvbGQgZXZlbnRzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIGlmICh0aGlzLnN0YXRlLmZyYW1lID4gcGxheWVyLmV2ZW50c1tpXS5mcmFtZSArIDE4KSB7XG4gICAgICBwbGF5ZXIuZXZlbnRzLnNwbGljZShpLCAxKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFJ1biB0aHJvdWdoIHBsYXllciBsb2NrZWQgb2JqZWN0c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLmZyYW1lX3BsYXllcl9sb2NrID0gZnVuY3Rpb24ocGxheWVyKSB7XG4gIHZhciBwbGF5ZXJfb2JqID0gdGhpcy5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyLmlkXTtcbiAgdmFyIG9iaiA9IHRoaXMuc3RhdGUub2JqZWN0c1twbGF5ZXIubG9ja2VkXTtcbiAgaWYgKHBsYXllcl9vYmogJiYgb2JqKSB7XG4gICAgcGxheWVyX29iai54ID0gb2JqLng7XG4gICAgcGxheWVyX29iai55ID0gb2JqLnk7XG4gICAgcGxheWVyX29iai5zcGVlZF94ID0gb2JqLnNwZWVkX3g7XG4gICAgcGxheWVyX29iai5zcGVlZF95ID0gb2JqLnNwZWVkX3k7XG4gIH0gZWxzZSB7XG4gICAgcGxheWVyLmxvY2tlZCA9IFwiXCI7XG4gIH1cbn07XG5cbi8qIEdldCBkYW1hZ2UgbW9kaWZpZXJzIGZyb20gcGxheWVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUuZ2V0X2RhbWFnZSA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgZGFtYWdlID0gb2JqLmMuZGFtYWdlO1xuICB2YXIgcGxheWVyID0gdGhpcy5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAocGxheWVyICYmIGRhbWFnZSAhPT0gMCAmJiAhb2JqLmMuaWdub3JlX2xldmVsX2RhbWFnZSkge1xuICAgIHZhciBsZXZlbCA9IHRoaXMuc2NoZW1lLmxldmVscy5kYW1hZ2VbcGxheWVyLmxldmVsXTtcbiAgICBpZiAobGV2ZWwpIHtcbiAgICAgIGRhbWFnZSArPSBsZXZlbDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRhbWFnZTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBTdGF0ZSBtYW5hZ2VtZW50XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogR2V0IHN0YXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGFja19zdGF0ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIC8vIHBsYXllcnNcbiAgdmFyIHBsYXllcnMgPSBbXTtcbiAgZm9yICh2YXIgaWQgaW4gc3RhdGUucGxheWVycykge1xuICAgIHBsYXllcnMucHVzaCh0aGlzLnBhY2tfcGxheWVyKHN0YXRlLnBsYXllcnNbaWRdKSk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIG9iamVjdHNcbiAgdmFyIG9iamVjdHMgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIHN0YXRlLm9iamVjdHMpIHtcbiAgICBvYmplY3RzLnB1c2godGhpcy5wYWNrX29iamVjdChzdGF0ZS5vYmplY3RzW2tleV0pKTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZXhwbG9zaW9uc1xuICB2YXIgZXhwbG9zaW9ucyA9IFtdO1xuICBmb3IgKGtleSBpbiBzdGF0ZS5leHBsb3Npb25zKSB7XG4gICAgZXhwbG9zaW9ucy5wdXNoKHRoaXMucGFja19leHBsb3Npb24oc3RhdGUuZXhwbG9zaW9uc1trZXldKSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIHBsYXllcnMuam9pbihcIiNcIikgKyBcIitcIiArIG9iamVjdHMuam9pbihcIiNcIikgKyBcIitcIiArIGV4cGxvc2lvbnMuam9pbihcIiNcIilcbiAgKTtcbn07XG5cbi8qIFNldCBzdGF0ZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmUucHJvdG90eXBlLnVucGFja19zdGF0ZSA9IGZ1bmN0aW9uKHN0cikge1xuICAvLyBibGFuayBzdGF0ZVxuICB2YXIgc3RhdGUgPSB0aGlzLmJsYW5rX3N0YXRlKCk7XG5cbiAgLy8gcnVuIHRocm91Z2ggc3RhdGUgc3RyaW5nXG4gIHZhciBzcGxpdCA9IHN0ci5zcGxpdChcIitcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoc3BsaXRbaV0pIHtcbiAgICAgIHZhciBzcGxpdDIgPSBzcGxpdFtpXS5zcGxpdChcIiNcIik7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNwbGl0Mi5sZW5ndGg7IGorKykge1xuICAgICAgICBpZiAoaSA9PSAwKSB7XG4gICAgICAgICAgdGhpcy51bnBhY2tfcGxheWVyKHN0YXRlLCBzcGxpdDJbal0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpID09IDEpIHtcbiAgICAgICAgICB0aGlzLnVucGFja19vYmplY3Qoc3RhdGUsIHNwbGl0MltqXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkgPT0gMikge1xuICAgICAgICAgIHRoaXMudW5wYWNrX2V4cGxvc2lvbihzdGF0ZSwgc3BsaXQyW2pdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn07XG5cbi8qIFBsYXllcnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wYWNrX3BsYXllciA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBwcmVwIGJhc2ljIHZhbHVlc1xuICB2YXIgZGVhZCA9IG9iai5kZWFkID8gXCIxXCIgOiBcIlwiO1xuICB2YXIgd2VhcG9uID0gdGhpcy5hcm1vdXJ5X3JlZnMuaW5kZXhPZihvYmoud2VhcG9uKTtcblxuICAvLyBwcmVwIGFybW91cnlcbiAgdmFyIGFybW91cnkgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIG9iai5hcm1vdXJ5KSB7XG4gICAgYXJtb3VyeS5wdXNoKG9iai5hcm1vdXJ5W2tleV0pO1xuICB9XG4gIGFybW91cnkgPSBhcm1vdXJ5LmpvaW4oXCIkXCIpO1xuXG4gIC8vIHByZXAgZXZlbnRzXG4gIHZhciBldmVudHMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGV2ZW50ID0gb2JqLmV2ZW50c1tpXTtcbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3YWxrXCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+MFwiKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwianVtcFwiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjFcIik7XG4gICAgfVxuICAgIGlmIChldmVudC50eXBlID09PSBcInNob290XCIpIHtcbiAgICAgIGV2ZW50cy5wdXNoKGV2ZW50LmZyYW1lICsgXCJ+Mn5cIiArIGV2ZW50Lm9iaiArIFwiflwiICsgZXZlbnQud2VhcG9uKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwiY3JhdGVcIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn4zflwiICsgZXZlbnQub2JqKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwibWVkcGFja1wiKSB7XG4gICAgICBldmVudHMucHVzaChldmVudC5mcmFtZSArIFwifjR+XCIgKyBldmVudC5vYmopO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJnZW1cIikge1xuICAgICAgZXZlbnRzLnB1c2goZXZlbnQuZnJhbWUgKyBcIn41flwiICsgZXZlbnQub2JqKTtcbiAgICB9XG4gIH1cbiAgZXZlbnRzID0gZXZlbnRzLmpvaW4oXCIkXCIpO1xuXG4gIC8vIHJldHVybiBwbGF5ZXIgc3RyaW5nXG4gIHZhciBhcnIgPSBbXG4gICAgb2JqLmlkLFxuICAgIG9iai5sZXZlbCxcbiAgICBvYmouc2NvcmUsXG4gICAgZGVhZCxcbiAgICBvYmouaGVhbHRoLFxuICAgIG9iai5jb29sZG93bixcbiAgICBvYmouaGl0LFxuICAgIG9iai5sb2NrZWQsXG4gICAgYXJtb3VyeSxcbiAgICB3ZWFwb24sXG4gICAgZXZlbnRzXG4gIF07XG4gIHJldHVybiBhcnIuam9pbihcIi9cIik7XG59O1xuXG5jb3JlLnByb3RvdHlwZS51bnBhY2tfcGxheWVyID0gZnVuY3Rpb24oc3RhdGUsIHN0cikge1xuICB2YXIgc3BsaXQgPSBzdHIuc3BsaXQoXCIvXCIpO1xuICB2YXIgcHJvcHMgPSB7fTtcbiAgcHJvcHMuaWQgPSBwYXJzZUludChzcGxpdFswXSk7XG4gIHByb3BzLmxldmVsID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICBwcm9wcy5zY29yZSA9IHBhcnNlSW50KHNwbGl0WzJdKTtcbiAgcHJvcHMuZGVhZCA9IHNwbGl0WzNdID09PSBcIjFcIiA/IHRydWUgOiBmYWxzZTtcbiAgcHJvcHMuaGVhbHRoID0gcGFyc2VJbnQoc3BsaXRbNF0pO1xuICBwcm9wcy5jb29sZG93biA9IHBhcnNlSW50KHNwbGl0WzVdKTtcbiAgcHJvcHMuaGl0ID0gcGFyc2VJbnQoc3BsaXRbNl0pO1xuICBwcm9wcy5sb2NrZWQgPSBzcGxpdFs3XTtcblxuICAvLyBwcmVwIGFybW91cnlcbiAgcHJvcHMuYXJtb3VyeSA9IHt9O1xuICB2YXIgc3BsaXQyID0gc3BsaXRbOF0uc3BsaXQoXCIkXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Mi5sZW5ndGg7IGkrKykge1xuICAgIHZhciBrZXkgPSB0aGlzLmFybW91cnlfcmVmc1tpXTtcbiAgICBwcm9wcy5hcm1vdXJ5W2tleV0gPSBwYXJzZUludChzcGxpdDJbaV0pO1xuICB9XG5cbiAgLy8gd2VhcG9uXG4gIHZhciB3ZXAgPSBwYXJzZUludChzcGxpdFs5XSk7XG4gIGlmICh3ZXAgIT09IC0xKSB7XG4gICAgcHJvcHMud2VhcG9uID0gdGhpcy5hcm1vdXJ5X3JlZnNbd2VwXTtcbiAgfVxuXG4gIC8vIHByZXAgZXZlbnRzXG4gIHByb3BzLmV2ZW50cyA9IFtdO1xuICB2YXIgc3BsaXQyID0gc3BsaXRbMTBdLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdDIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc3BsaXQzID0gc3BsaXQyW2ldLnNwbGl0KFwiflwiKTtcbiAgICB2YXIgb2JqID0geyBmcmFtZTogcGFyc2VJbnQoc3BsaXQzWzBdKSB9O1xuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiMFwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwid2Fsa1wiO1xuICAgIH1cbiAgICBpZiAoc3BsaXQzWzFdID09PSBcIjFcIikge1xuICAgICAgb2JqLnR5cGUgPSBcImp1bXBcIjtcbiAgICB9XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCIyXCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJzaG9vdFwiO1xuICAgICAgb2JqLm9iaiA9IHNwbGl0M1syXTtcbiAgICAgIG9iai53ZWFwb24gPSBzcGxpdDNbM107XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiM1wiKSB7XG4gICAgICBvYmoudHlwZSA9IFwiY3JhdGVcIjtcbiAgICAgIG9iai5vYmogPSBzcGxpdDNbMl07XG4gICAgfVxuICAgIGlmIChzcGxpdDNbMV0gPT09IFwiNFwiKSB7XG4gICAgICBvYmoudHlwZSA9IFwibWVkcGFja1wiO1xuICAgICAgb2JqLm9iaiA9IHNwbGl0M1syXTtcbiAgICB9XG4gICAgaWYgKHNwbGl0M1sxXSA9PT0gXCI1XCIpIHtcbiAgICAgIG9iai50eXBlID0gXCJnZW1cIjtcbiAgICAgIG9iai5vYmogPSBzcGxpdDNbMl07XG4gICAgfVxuICAgIGlmIChvYmopIHtcbiAgICAgIHByb3BzLmV2ZW50cy5wdXNoKG9iaik7XG4gICAgfVxuICB9XG5cbiAgLy8gbWFrZSBpdFxuICB0aGlzLmNyZWF0ZV9wbGF5ZXIocHJvcHMsIHN0YXRlKTtcbn07XG5cbi8qIE9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlLnByb3RvdHlwZS5wYWNrX29iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgZ3JvdW5kZWQgPSBvYmouZ3JvdW5kZWQgPyBcIjFcIiA6IFwiXCI7XG4gIHZhciBhcnIgPSBbXG4gICAgb2JqLnR5cGUsXG4gICAgb2JqLnBsYXllcl9pZCxcbiAgICBvYmouaWQsXG4gICAgb2JqLmZyYW1lLFxuICAgIGdyb3VuZGVkLFxuICAgIG9iai54LFxuICAgIG9iai55LFxuICAgIG9iai5zcGVlZF94LFxuICAgIG9iai5zcGVlZF95LFxuICAgIG9iai5kYXRhXG4gIF07XG4gIHJldHVybiBhcnIuam9pbihcIi9cIik7XG59O1xuXG5jb3JlLnByb3RvdHlwZS51bnBhY2tfb2JqZWN0ID0gZnVuY3Rpb24oc3RhdGUsIHN0cikge1xuICB2YXIgc3BsaXQgPSBzdHIuc3BsaXQoXCIvXCIpO1xuICB2YXIgcHJvcHMgPSB7fTtcbiAgcHJvcHMudHlwZSA9IHNwbGl0WzBdO1xuICBwcm9wcy5wbGF5ZXJfaWQgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gIHByb3BzLmlkID0gc3BsaXRbMl07XG4gIHByb3BzLmZyYW1lID0gcGFyc2VJbnQoc3BsaXRbM10pO1xuICBwcm9wcy5ncm91bmRlZCA9IHNwbGl0WzRdID09PSBcIjFcIiA/IHRydWUgOiBmYWxzZTtcbiAgcHJvcHMueCA9IHBhcnNlRmxvYXQoc3BsaXRbNV0pO1xuICBwcm9wcy55ID0gcGFyc2VGbG9hdChzcGxpdFs2XSk7XG4gIHByb3BzLnNwZWVkX3ggPSBwYXJzZUZsb2F0KHNwbGl0WzddKTtcbiAgcHJvcHMuc3BlZWRfeSA9IHBhcnNlRmxvYXQoc3BsaXRbOF0pO1xuICBwcm9wcy5kYXRhID0gc3BsaXRbOV07XG5cbiAgdGhpcy5jcmVhdGVfb2JqZWN0KHByb3BzLCBzdGF0ZSk7XG59O1xuXG4vKiBFeHBsb3Npb25zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZS5wcm90b3R5cGUucGFja19leHBsb3Npb24gPSBmdW5jdGlvbihvYmopIHtcbiAgdmFyIGFyciA9IFtcbiAgICBvYmoucGxheWVyX2lkLFxuICAgIG9iai5mcmFtZSxcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICBvYmoucGFyZW50LFxuICAgIG9iai5wYXJlbnRfdHlwZVxuICBdO1xuICByZXR1cm4gYXJyLmpvaW4oXCIvXCIpO1xufTtcblxuY29yZS5wcm90b3R5cGUudW5wYWNrX2V4cGxvc2lvbiA9IGZ1bmN0aW9uKHN0YXRlLCBzdHIpIHtcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiL1wiKTtcbiAgdmFyIHByb3BzID0ge307XG4gIHByb3BzLnBsYXllcl9pZCA9IHBhcnNlSW50KHNwbGl0WzBdKTtcbiAgcHJvcHMuZnJhbWUgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gIHByb3BzLnggPSBwYXJzZUZsb2F0KHNwbGl0WzJdKTtcbiAgcHJvcHMueSA9IHBhcnNlRmxvYXQoc3BsaXRbM10pO1xuICBwcm9wcy5wYXJlbnQgPSBzcGxpdFs0XTtcbiAgcHJvcHMucGFyZW50X3R5cGUgPSBzcGxpdFs1XTtcblxuICB0aGlzLmNyZWF0ZV9leHBsb3Npb24ocHJvcHMsIHN0YXRlKTtcbn07XG4iLCJmdW5jdGlvbiBpc01lcmdlYWJsZU9iamVjdCh2YWwpIHtcbiAgdmFyIG5vbk51bGxPYmplY3QgPSB2YWwgJiYgdHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIjtcblxuICByZXR1cm4gKFxuICAgIG5vbk51bGxPYmplY3QgJiZcbiAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKSAhPT0gXCJbb2JqZWN0IFJlZ0V4cF1cIiAmJlxuICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWwpICE9PSBcIltvYmplY3QgRGF0ZV1cIlxuICApO1xufVxuXG5mdW5jdGlvbiBlbXB0eVRhcmdldCh2YWwpIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsKSA/IFtdIDoge307XG59XG5cbmZ1bmN0aW9uIGNsb25lSWZOZWNlc3NhcnkodmFsdWUsIG9wdGlvbnNBcmd1bWVudCkge1xuICB2YXIgY2xvbmUgPSBvcHRpb25zQXJndW1lbnQgJiYgb3B0aW9uc0FyZ3VtZW50LmNsb25lID09PSB0cnVlO1xuICByZXR1cm4gY2xvbmUgJiYgaXNNZXJnZWFibGVPYmplY3QodmFsdWUpXG4gICAgPyBkZWVwbWVyZ2UoZW1wdHlUYXJnZXQodmFsdWUpLCB2YWx1ZSwgb3B0aW9uc0FyZ3VtZW50KVxuICAgIDogdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRBcnJheU1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zQXJndW1lbnQpIHtcbiAgdmFyIGRlc3RpbmF0aW9uID0gdGFyZ2V0LnNsaWNlKCk7XG4gIHNvdXJjZS5mb3JFYWNoKGZ1bmN0aW9uKGUsIGkpIHtcbiAgICBpZiAodHlwZW9mIGRlc3RpbmF0aW9uW2ldID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBkZXN0aW5hdGlvbltpXSA9IGNsb25lSWZOZWNlc3NhcnkoZSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgICB9IGVsc2UgaWYgKGlzTWVyZ2VhYmxlT2JqZWN0KGUpKSB7XG4gICAgICBkZXN0aW5hdGlvbltpXSA9IGRlZXBtZXJnZSh0YXJnZXRbaV0sIGUsIG9wdGlvbnNBcmd1bWVudCk7XG4gICAgfSBlbHNlIGlmICh0YXJnZXQuaW5kZXhPZihlKSA9PT0gLTEpIHtcbiAgICAgIGRlc3RpbmF0aW9uLnB1c2goY2xvbmVJZk5lY2Vzc2FyeShlLCBvcHRpb25zQXJndW1lbnQpKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZGVzdGluYXRpb247XG59XG5cbmZ1bmN0aW9uIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zQXJndW1lbnQpIHtcbiAgdmFyIGRlc3RpbmF0aW9uID0ge307XG4gIGlmIChpc01lcmdlYWJsZU9iamVjdCh0YXJnZXQpKSB7XG4gICAgT2JqZWN0LmtleXModGFyZ2V0KS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgZGVzdGluYXRpb25ba2V5XSA9IGNsb25lSWZOZWNlc3NhcnkodGFyZ2V0W2tleV0sIG9wdGlvbnNBcmd1bWVudCk7XG4gICAgfSk7XG4gIH1cbiAgT2JqZWN0LmtleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGlmICghaXNNZXJnZWFibGVPYmplY3Qoc291cmNlW2tleV0pIHx8ICF0YXJnZXRba2V5XSkge1xuICAgICAgZGVzdGluYXRpb25ba2V5XSA9IGNsb25lSWZOZWNlc3Nhcnkoc291cmNlW2tleV0sIG9wdGlvbnNBcmd1bWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBkZWVwbWVyZ2UodGFyZ2V0W2tleV0sIHNvdXJjZVtrZXldLCBvcHRpb25zQXJndW1lbnQpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBkZXN0aW5hdGlvbjtcbn1cblxuZnVuY3Rpb24gZGVlcG1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zQXJndW1lbnQpIHtcbiAgdmFyIGFycmF5ID0gQXJyYXkuaXNBcnJheShzb3VyY2UpO1xuICB2YXIgb3B0aW9ucyA9IG9wdGlvbnNBcmd1bWVudCB8fCB7IGFycmF5TWVyZ2U6IGRlZmF1bHRBcnJheU1lcmdlIH07XG4gIHZhciBhcnJheU1lcmdlID0gb3B0aW9ucy5hcnJheU1lcmdlIHx8IGRlZmF1bHRBcnJheU1lcmdlO1xuXG4gIGlmIChhcnJheSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHRhcmdldClcbiAgICAgID8gYXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KVxuICAgICAgOiBjbG9uZUlmTmVjZXNzYXJ5KHNvdXJjZSwgb3B0aW9uc0FyZ3VtZW50KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbWVyZ2VPYmplY3QodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnNBcmd1bWVudCk7XG4gIH1cbn1cblxuZGVlcG1lcmdlLmFsbCA9IGZ1bmN0aW9uIGRlZXBtZXJnZUFsbChhcnJheSwgb3B0aW9uc0FyZ3VtZW50KSB7XG4gIGlmICghQXJyYXkuaXNBcnJheShhcnJheSkgfHwgYXJyYXkubGVuZ3RoIDwgMikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiZmlyc3QgYXJndW1lbnQgc2hvdWxkIGJlIGFuIGFycmF5IHdpdGggYXQgbGVhc3QgdHdvIGVsZW1lbnRzXCJcbiAgICApO1xuICB9XG5cbiAgLy8gd2UgYXJlIHN1cmUgdGhlcmUgYXJlIGF0IGxlYXN0IDIgdmFsdWVzLCBzbyBpdCBpcyBzYWZlIHRvIGhhdmUgbm8gaW5pdGlhbCB2YWx1ZVxuICByZXR1cm4gYXJyYXkucmVkdWNlKGZ1bmN0aW9uKHByZXYsIG5leHQpIHtcbiAgICByZXR1cm4gZGVlcG1lcmdlKHByZXYsIG5leHQsIG9wdGlvbnNBcmd1bWVudCk7XG4gIH0pO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1hdGggRnVuY3Rpb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2hvcnRlbiBcIk1hdGhcIiBmdW5jdGlvbnNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBjb3Mobikge1xuICByZXR1cm4gTWF0aC5jb3Mobik7XG59XG5mdW5jdGlvbiBzaW4obikge1xuICByZXR1cm4gTWF0aC5zaW4obik7XG59XG5mdW5jdGlvbiBwb3cobikge1xuICByZXR1cm4gTWF0aC5wb3cobik7XG59XG5mdW5jdGlvbiBhYnMobikge1xuICByZXR1cm4gTWF0aC5hYnMobik7XG59XG5mdW5jdGlvbiBzcXIobikge1xuICByZXR1cm4gTWF0aC5wb3cobiwgMik7XG59XG5mdW5jdGlvbiBzcXJ0KG4pIHtcbiAgcmV0dXJuIE1hdGguc3FydChuKTtcbn1cbmZ1bmN0aW9uIHJvdW5kKG4pIHtcbiAgcmV0dXJuIE1hdGgucm91bmQobik7XG59XG5mdW5jdGlvbiBmbG9vcihuKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKG4pO1xufVxuZnVuY3Rpb24gY2VpbChuKSB7XG4gIHJldHVybiBNYXRoLmNlaWwobik7XG59XG5mdW5jdGlvbiBhdGFuMihuMSwgbjIpIHtcbiAgcmV0dXJuIE1hdGguYXRhbjIobjEsIG4yKTtcbn1cbmZ1bmN0aW9uIG1pbihuMSwgbjIpIHtcbiAgcmV0dXJuIE1hdGgubWluKG4xLCBuMik7XG59XG5mdW5jdGlvbiBtYXgobjEsIG4yKSB7XG4gIHJldHVybiBNYXRoLm1heChuMSwgbjIpO1xufVxuZnVuY3Rpb24gcmFuZChuMSwgbjIpIHtcbiAgcmV0dXJuIGZsb29yKE1hdGgucmFuZG9tKCkgKiBuMikgKyBuMTtcbn1cbnZhciBwaSA9IE1hdGguUEk7XG5cbi8qIEZpeCBudW1iZXIgdG8gZGVjaW1hbCBwbGFjZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5OdW1iZXIucHJvdG90eXBlLmZpeGVkID0gZnVuY3Rpb24obikge1xuICBuID0gbiB8fCAyO1xuICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLnRvRml4ZWQobikpO1xufTtcblxuLyogQWRkIHByZWNlZGluZyB6ZXJvZXMgdG8gbnVtYmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gcHJlY2VkaW5nX3plcm9lcyhuLCBsZW5ndGgpIHtcbiAgdmFyIGxlbmd0aCA9IGxlbmd0aCB8fCAyO1xuICB2YXIgbiA9IG4udG9TdHJpbmcoKTtcbiAgd2hpbGUgKG4ubGVuZ3RoIDwgbGVuZ3RoKSB7XG4gICAgbiA9IFwiMFwiICsgbjtcbiAgfVxuICByZXR1cm4gbjtcbn1cblxuLyogSXMgbnVtYmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gaXNfbnVtZXJpYyhuKSB7XG4gIHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdChuKSkgJiYgaXNGaW5pdGUobik7XG59XG5cbi8qIEdldCBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBnZXRfc3BlZWQoc3gsIHN5KSB7XG4gIHJldHVybiByb3VuZChzcXJ0KHNxcihzeCkgKyBzcXIoc3kpKSk7XG59XG5cbmZ1bmN0aW9uIGdldF9kaXN0YW5jZSh4MSwgeTEsIHgyLCB5Mikge1xuICB2YXIgZHggPSB4MiAtIHgxLFxuICAgIGR5ID0geTIgLSB5MTtcbiAgcmV0dXJuIGdldF9zcGVlZChkeCwgZHkpO1xufVxuXG4vKiBDaGVjayBzcGVlZCBsaW1pdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGNoZWNrX3NwZWVkKHN4LCBzeSwgc3BlZWQpIHtcbiAgdmFyIGQgPSBnZXRfZGlzdGFuY2UoMCwgMCwgc3gsIHN5KSxcbiAgICBucyA9IHtcbiAgICAgIHg6IHN4LFxuICAgICAgeTogc3ksXG4gICAgICB0b3RhbDogZFxuICAgIH07XG4gIGlmIChzcGVlZCA8IGQpIHtcbiAgICB2YXIgbXVsdGkgPSBzcGVlZCAvIGQ7XG4gICAgbnMueCA9IHN4ICogbXVsdGk7XG4gICAgbnMueSA9IHN5ICogbXVsdGk7XG4gICAgbnMudG90YWwgPSBzcGVlZDtcbiAgfVxuICByZXR1cm4gbnM7XG59XG5cbi8qIEdldCBIZWFkaW5nIEFuZ2xlIEZyb20gWCBhbmQgWSBTcGVlZFxuXHQvLyAwID0gbGVmdCwgMzYwID0gbGVmdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGdldF9hbmdsZShzeCwgc3kpIHtcbiAgcmV0dXJuICgoKGF0YW4yKHN5LCBzeCkgKiAxODApIC8gcGkpICUgMzYwKSArIDE4MDtcbn1cblxuZnVuY3Rpb24gZ2V0X2hlYWRpbmcoeDEsIHkxLCB4MiwgeTIpIHtcbiAgdmFyIHhzID0geDIgLSB4MSxcbiAgICB5cyA9IHkyIC0geTE7XG4gIHJldHVybiBnZXRfYW5nbGUoeHMsIHlzKTtcbn1cblxuLyogR2V0IFggYW5kIFkgc3BlZWQgZnJvbSBoZWFkaW5nIGFuZCB2ZWxvY2l0eVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHh5X3NwZWVkKGFuZ2xlLCBzcGVlZCkge1xuICB2YXIgYSA9IGFuZ2xlX2FkZChhbmdsZSwgMTgwKSxcbiAgICByID0gKGEgLyAxODApICogcGk7XG4gIHJldHVybiB7XG4gICAgeDogc3BlZWQgKiBjb3MociksXG4gICAgeTogc3BlZWQgKiBzaW4ocilcbiAgfTtcbn1cblxuLyogR2V0IFggYW5kIFkgb2Zmc2V0IGZyb20gaGVhZGluZyBhbmQgdmVsb2NpdHlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiB4eV9vZmZzZXQoYW5nbGUsIHN4LCBzeSkge1xuICB2YXIgeHkxID0geHlfc3BlZWQoYW5nbGUsIHN4KTtcbiAgdmFyIHh5MiA9IHh5X3NwZWVkKGFuZ2xlX2FkZChhbmdsZSwgOTApLCBzeSk7XG4gIHJldHVybiB7XG4gICAgeDogeHkxLnggKyB4eTIueCxcbiAgICB5OiB4eTEueSArIHh5Mi55XG4gIH07XG59XG5cbi8qIEdldCBkaWZmZXJlbmNlIGJldHdlZW4gdHdvIG51bWJlcnMgaW4gYSBsb29wXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gbl9kaWZmKGN1cnJlbnQsIHRhcmdldCwgYm90dG9tLCB0b3ApIHtcbiAgaWYgKGN1cnJlbnQgPT0gdGFyZ2V0KSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICB2YXIgc2NhbGUgPSBhYnModG9wIC0gYm90dG9tKSwgLy8gZ2V0IHRvdGFsIHNpemUgb2YgdGhlIGxvb3BcbiAgICBjX2N1cnJlbnQgPSBjdXJyZW50IC0gYm90dG9tLCAvLyBjb3JyZWN0IGN1cnJlbnQgZm9yIG5lZ2F0aXZlIG51bWJlcnNcbiAgICBjX3RhcmdldCA9IHRhcmdldCAtIGJvdHRvbSwgLy8gY29ycmVjdCB0YXJnZXQgZm9yIG5lZ2F0aXZlIG51bWJlcnNcbiAgICBuMSA9IChjX3RhcmdldCArIHNjYWxlIC0gY19jdXJyZW50KSAlIHNjYWxlLCAvLyBnZXQgZGlmZmVyZW5jZSB3aGVuIGFkZGluZ1xuICAgIG4yID0gKGNfY3VycmVudCArIHNjYWxlIC0gY190YXJnZXQpICUgc2NhbGU7IC8vIGdldCBkaWZmZXJlbmNlIHdoZW4gc3VidHJhY3RpbmdcblxuICAvLyByZXR1cm4gc21hbGxlc3QgZGlzdGFuY2VcbiAgaWYgKG4xIDwgbjIpIHtcbiAgICByZXR1cm4gbjE7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIC1uMjtcbiAgfVxufVxuXG4vKiBBdXRvIGxvb3AgYSBudW1iZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBuX2xvb3AobiwgYm90dG9tLCB0b3ApIHtcbiAgdmFyIGRpZmZlcmVuY2UgPSBhYnModG9wIC0gYm90dG9tKTtcbiAgd2hpbGUgKG4gPD0gYm90dG9tKSB7XG4gICAgbiArPSBkaWZmZXJlbmNlO1xuICB9XG4gIHdoaWxlIChuID4gdG9wKSB7XG4gICAgbiAtPSBkaWZmZXJlbmNlO1xuICB9XG4gIHJldHVybiBuO1xufVxuXG4vKiBBZGQgdG8gYSBudW1iZXIgd2l0aG91dCBvdmVyZmxvd2luZyB1cCBvciBkb3duIGZyb20gbWluL21heFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG5fYWRkKG4xLCBuMiwgdDEsIHQyKSB7XG4gIHZhciBkaWYgPSBhYnModDIgLSB0MSksXG4gICAgbmEgPSBuMSArIG4yO1xuICB3aGlsZSAobmEgPCB0MSkge1xuICAgIG5hICs9IGRpZjtcbiAgfVxuICB3aGlsZSAobmEgPj0gdDIpIHtcbiAgICBuYSAtPSBkaWY7XG4gIH1cbiAgcmV0dXJuIG5hO1xufVxuXG4vKiBBZGQgdG8gYW4gYW5nbGUgd2l0aG91dCBvdmVyZmxvd2luZyB1cCBvciBkb3duIGZyb20gMC0zNjBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBhbmdsZV9hZGQoYW5nbGUsIGFkZCkge1xuICBpZiAoIWFuZ2xlKSB7XG4gICAgYW5nbGUgPSAwO1xuICB9XG4gIHJldHVybiBuX2FkZChhbmdsZSwgYWRkLCAwLCAzNjApO1xufVxuXG4vKiBNb3ZlIG51bWJlciB0b3dhcmRzIGEgbmV3IG51bWJlciB3aXRoIGxvb3Bcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBpbmNyZW1lbnRfbnVtKGN1cnJlbnQsIHRhcmdldCwgYm90dG9tLCB0b3AsIHNwZWVkKSB7XG4gIHZhciBkaWZmID0gbl9kaWZmKGN1cnJlbnQsIHRhcmdldCwgYm90dG9tLCB0b3ApOyAvLyBnZXQgc2hvcnRlc3Qgcm91dGUgdG8gbnVtYmVyXG4gIG1vdmUgPSBtaW4oYWJzKGRpZmYpIC8gMTAsIDQpICogc3BlZWQ7IC8vIGNhbGN1bGF0ZSBob3cgbXVjaCB0byBtb3ZlXG5cbiAgLy8gaWYgZGlmZmVyZW5jZSBpcyBsZXNzIHRoZW4gbW92ZW1lbnQsIHJldHVybiB0YXJnZXRcbiAgaWYgKGFicyhkaWZmKSA8IG1vdmUpIHtcbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9XG5cbiAgLy8gYWRkIG9yIHN1YnRyYWN0IG1vdmVtZW50XG4gIG1vdmUgPSBkaWZmIDwgMCA/IC1tb3ZlIDogbW92ZTtcbiAgcmV0dXJuIG5fYWRkKGN1cnJlbnQsIG1vdmUsIGJvdHRvbSwgdG9wKTtcbn1cblxuLyogTW92ZSBhbmdsZSB0b3dhcmRzIGEgbmV3IGFuZ2xlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gaW5jcmVtZW50X2FuZ2xlKG9sZF9hbmdsZSwgbmV3X2FuZ2xlLCBzcGVlZCkge1xuICByZXR1cm4gaW5jcmVtZW50X251bShvbGRfYW5nbGUsIG5ld19hbmdsZSwgMCwgMzYwLCBzcGVlZCk7XG59XG5cbi8qIElmIGEgcG9pbnQgaXMgd2l0aGluIGEgY2lyY2xlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gaW5fY2lyY2xlKHgsIHksIGN4LCBjeSwgcmFkaXVzKSB7XG4gIHJldHVybiBnZXRfZGlzdGFuY2UoeCwgeSwgY3gsIGN5KSA8IHJhZGl1cztcbn1cblxuLyogUGxvdCBhIGNvdXJzZVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHBsb3RfY291cnNlKHgsIHksIHN4LCBzeSwgZXh0ZW5kKSB7XG4gIC8vIGdldCBpbml0aWFsIHNwZWVkXG4gIHZhciBleHRlbmQgPSBleHRlbmQgPyBleHRlbmQgOiAwLFxuICAgIHNwZWVkID0gZ2V0X3NwZWVkKHN4LCBzeSk7XG5cbiAgLy8gaWYgbm8gZGlzdGFuY2UgdGhlbiBkbyBub3RoaW5nXG4gIGlmIChzcGVlZCA9PSAwKSB7XG4gICAgcmV0dXJuIHsgbW92ZTogZmFsc2UgfTtcbiAgfVxuXG4gIC8vIGNhbGN1bGF0ZSBpbmNyZW1lbnRzXG4gIHZhciBpbmNyZW1lbnRfeCA9IHN4IC8gc3BlZWQsXG4gICAgaW5jcmVtZW50X3kgPSBzeSAvIHNwZWVkLFxuICAgIG5ld194ID0geCAtIGluY3JlbWVudF94ICogZXh0ZW5kLFxuICAgIG5ld195ID0geSAtIGluY3JlbWVudF95ICogZXh0ZW5kLFxuICAgIHBvaW50cyA9IFt7IHg6IG5ld194LCB5OiBuZXdfeSB9XTtcblxuICAvLyBpdGVyYXRlIHRocm91Z2ggcGF0aCBhbmQgcmVjb3JkIHBvaW50c1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWVkICsgZXh0ZW5kICogMjsgaSsrKSB7XG4gICAgKG5ld194ICs9IGluY3JlbWVudF94KSwgKG5ld195ICs9IGluY3JlbWVudF95KTtcbiAgICBwb2ludHMucHVzaCh7XG4gICAgICB4OiBuZXdfeCxcbiAgICAgIHk6IG5ld195XG4gICAgfSk7XG4gIH1cblxuICAvLyByZXR1cm4gcG9pbnQgYXJyYXlcbiAgcmV0dXJuIHtcbiAgICBtb3ZlOiB0cnVlLFxuICAgIHBvaW50czogcG9pbnRzXG4gIH07XG59XG5cbi8qIHRyYW5zbGF0ZSBjby1vcmRpbmF0ZXMgYnkgYW4gYW5nbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiByb3RhdGVfY29vcmRzKHgsIHksIGN4LCBjeSwgYW5nbGUpIHtcbiAgdmFyIHIgPSAocGkgLyAxODApICogYW5nbGU7XG4gIHJldHVybiB7XG4gICAgeDogY29zKHIpICogKHggLSBjeCkgKyBzaW4ocikgKiAoeSAtIGN5KSArIGN4LFxuICAgIHk6IGNvcyhyKSAqICh5IC0gY3kpIC0gc2luKHIpICogKHggLSBjeCkgKyBjeVxuICB9O1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTWlzYyBGdW5jdGlvbnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBEdXBsaWNhdGUgb2JqZWN0XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gZHVwbGljYXRlX29iaihvYmopIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7XG59XG5cbi8qIFByZXZlbnQgYXJyYXkgbWVyZ2luZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGRvbnRfbWVyZ2UoZGVzdGluYXRpb24sIHNvdXJjZSkge1xuICBpZiAoIXNvdXJjZSkge1xuICAgIHJldHVybiBkZXN0aW5hdGlvbjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc291cmNlO1xuICB9XG59XG5cbi8qIEFkZCBzcGFjZSB0byBhIHN0cmluZ1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIHN0cl9zcGFjZShzdHIpIHtcbiAgdmFyIG5ld19zdHIgPSBcIlwiO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgIHZhciBhZGQgPSBpID09IHN0ci5sZW5ndGggLSAxID8gXCJcIiA6IFwiXFx1MjAwQVwiO1xuICAgIG5ld19zdHIgKz0gc3RyW2ldICsgYWRkO1xuICB9XG4gIHJldHVybiBuZXdfc3RyO1xufVxuXG4vKiBMb2cgbXVsdGlwbGUgdmFsdWVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gY2xvZyhcbiAgczEsXG4gIHMyLFxuICBzMyxcbiAgczQsXG4gIHM1LFxuICBzNixcbiAgczcsXG4gIHM4LFxuICBzOSxcbiAgczEwLFxuICBzMTEsXG4gIHMxMixcbiAgczEzLFxuICBzMTQsXG4gIHMxNVxuKSB7XG4gIHZhciBzdHIgPSBzMTtcbiAgaWYgKHMyICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczI7XG4gIH1cbiAgaWYgKHMzICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczM7XG4gIH1cbiAgaWYgKHM0ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczQ7XG4gIH1cbiAgaWYgKHM1ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczU7XG4gIH1cbiAgaWYgKHM2ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczY7XG4gIH1cbiAgaWYgKHM3ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczc7XG4gIH1cbiAgaWYgKHM4ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczg7XG4gIH1cbiAgaWYgKHM5ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczk7XG4gIH1cbiAgaWYgKHMxMCAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxMDtcbiAgfVxuICBpZiAoczExICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczExO1xuICB9XG4gIGlmIChzMTIgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTI7XG4gIH1cbiAgaWYgKHMxMyAhPSB1bmRlZmluZWQpIHtcbiAgICBzdHIgKz0gXCIgfCBcIiArIHMxMztcbiAgfVxuICBpZiAoczE0ICE9IHVuZGVmaW5lZCkge1xuICAgIHN0ciArPSBcIiB8IFwiICsgczE0O1xuICB9XG4gIGlmIChzMTUgIT0gdW5kZWZpbmVkKSB7XG4gICAgc3RyICs9IFwiIHwgXCIgKyBzMTU7XG4gIH1cbiAgY29uc29sZS5sb2coc3RyKTtcbn1cbiIsInZhciBzY2hlbWVzID0gc2NoZW1lcyB8fCB7fTtcbnNjaGVtZXMuZGVhdGhtYXRjaCA9IHtcbiAgdGl0bGU6IFwiRGVhdGhtYXRjaFwiLFxuICB0aW1lX2xpbWl0OiAwLFxuICBkZXN0cm95X2xhbmQ6IHRydWUsXG4gIGdyYXZpdHk6IDIsXG4gIHNjb3JlOiB0cnVlLFxuICBkcm9wczoge1xuICAgIGNyYXRlOiB7XG4gICAgICB0aW1lOiAxMDAsXG4gICAgICBtYXg6IDFcbiAgICB9LFxuICAgIG1lZHBhY2s6IHtcbiAgICAgIHRpbWU6IDEwMCxcbiAgICAgIGFkZDogMzAsXG4gICAgICBtYXg6IDFcbiAgICB9LFxuICAgIFwiZ2VtLTFcIjoge1xuICAgICAgdGltZTogMTAwLFxuICAgICAgbWF4OiA1XG4gICAgfSxcbiAgICBcImdlbS01XCI6IHtcbiAgICAgIHRpbWU6IDE1MCxcbiAgICAgIG1heDogMVxuICAgIH0sXG4gICAgXCJnZW0tMjBcIjoge1xuICAgICAgdGltZTogNTAwLFxuICAgICAgbWF4OiAxXG4gICAgfVxuICB9LFxuICB3ZWFwb25zOiB7XG4gICAgZGlnOiB7XG4gICAgICBzdGFydF9jb3VudDogLTEsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHBoYXNlcjoge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBiYXpvb2tvaWQ6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAtMSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgZ3JlbmFkZToge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBwdW5jaDoge1xuICAgICAgc3RhcnRfY291bnQ6IC0xLFxuICAgICAgY3JhdGVfY2hhbmNlOiAwLFxuICAgICAgY3JhdGVfY291bnQ6IC0xXG4gICAgfSxcbiAgICBwdW1wa2luOiB7XG4gICAgICBzdGFydF9jb3VudDogNSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMSxcbiAgICAgIGNyYXRlX2NvdW50OiA1XG4gICAgfSxcbiAgICBwYWluZ2l2ZXI6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAyMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMSxcbiAgICAgIGNyYXRlX2NvdW50OiA1XG4gICAgfVxuICB9LFxuICBtYXBnZW46IHtcbiAgICB0eXBlOiBcInJhbmRvbVwiLFxuICAgIHNyYzogXCJcIixcbiAgICBnYXA6IDIwLFxuICAgIHc6IDE5MDAsXG4gICAgaDogMTQwMCxcbiAgICBibG9iczogW10sXG4gICAgZGVjb3JhdGlvbnM6IHRydWUsXG4gICAgc21hbGxfYmxvYnM6IDUsXG4gICAgbGFyZ2VfYmxvYnM6IDNcbiAgfSxcbiAgZXZlbnRzOiB7XG4gICAgZnJhbWU6IHt9LFxuICAgIGNvbGxlY3Q6IHt9LFxuICAgIGRlc3Ryb3k6IHt9LFxuICAgIHRpbWVvdXQ6IHt9LFxuICAgIGRlc3Ryb3lfb2JqX3R5cGU6IHt9LFxuICAgIGRlc3Ryb3lfb2JqX3BsYXllcjoge31cbiAgfVxufTtcbiIsInZhciBzY2hlbWVzID0gc2NoZW1lcyB8fCB7fTtcbnNjaGVtZXMuZGVmYXVsdCA9IHtcbiAgdGl0bGU6IFwiXCIsXG4gIGRlc2NyaXB0aW9uOiBcIlwiLFxuICB0aW1lX2xpbWl0OiAwLFxuICBzaG93X3RpbWU6IGZhbHNlLFxuICBkZXN0cm95X2xhbmQ6IHRydWUsXG4gIGdyYXZpdHlfdHlwZTogXCJsYW5kXCIsXG4gIGdyYXZpdHk6IDEsXG4gIHN0YXJzOiB7fSxcbiAgc2NvcmU6IGZhbHNlLFxuICBoZWFsdGg6IHRydWUsXG4gIGxldmVsczoge1xuICAgIHNjb3JlOiBbXG4gICAgICAwLFxuICAgICAgMTAsXG4gICAgICAyNSxcbiAgICAgIDQwLFxuICAgICAgNjAsXG4gICAgICA5MCxcbiAgICAgIDEyMCxcbiAgICAgIDE1MCxcbiAgICAgIDIwMCxcbiAgICAgIDI1MCxcbiAgICAgIDMwMCxcbiAgICAgIDM2MCxcbiAgICAgIDQyMCxcbiAgICAgIDQ5MCxcbiAgICAgIDU3MCxcbiAgICAgIDY1MCxcbiAgICAgIDcyMCxcbiAgICAgIDgxMCxcbiAgICAgIDkwMCxcbiAgICAgIDEwMDBcbiAgICBdLFxuICAgIGhlYWx0aDogW1xuICAgICAgMTAwLFxuICAgICAgMTIwLFxuICAgICAgMTIwLFxuICAgICAgMTIwLFxuICAgICAgMTQwLFxuICAgICAgMTQwLFxuICAgICAgMTQwLFxuICAgICAgMTQwLFxuICAgICAgMTYwLFxuICAgICAgMTgwLFxuICAgICAgMjAwLFxuICAgICAgMjAwLFxuICAgICAgMjAwLFxuICAgICAgMjAwLFxuICAgICAgMjIwLFxuICAgICAgMjIwLFxuICAgICAgMjIwLFxuICAgICAgMjIwLFxuICAgICAgMjQwLFxuICAgICAgMzAwXG4gICAgXSxcbiAgICBkYW1hZ2U6IFtcbiAgICAgIDAsXG4gICAgICAxMCxcbiAgICAgIDEwLFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjUsXG4gICAgICAyNSxcbiAgICAgIDI1LFxuICAgICAgMzAsXG4gICAgICAzMCxcbiAgICAgIDMwLFxuICAgICAgMzAsXG4gICAgICAzNSxcbiAgICAgIDM1LFxuICAgICAgMzUsXG4gICAgICA1MFxuICAgIF0sXG4gICAgc3BlZWQ6IFtcbiAgICAgIDQsXG4gICAgICA2LFxuICAgICAgOCxcbiAgICAgIDgsXG4gICAgICA4LFxuICAgICAgOCxcbiAgICAgIDEwLFxuICAgICAgMTAsXG4gICAgICAxMCxcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTQsXG4gICAgICAxNCxcbiAgICAgIDE0LFxuICAgICAgMTQsXG4gICAgICAxNixcbiAgICAgIDE2LFxuICAgICAgMjBcbiAgICBdLFxuICAgIGp1bXA6IFtcbiAgICAgIDEwLFxuICAgICAgMTIsXG4gICAgICAxMixcbiAgICAgIDEyLFxuICAgICAgMTIsXG4gICAgICAxNSxcbiAgICAgIDE1LFxuICAgICAgMTUsXG4gICAgICAxNSxcbiAgICAgIDE4LFxuICAgICAgMTgsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjAsXG4gICAgICAyMCxcbiAgICAgIDIwLFxuICAgICAgMjVcbiAgICBdXG4gIH0sXG4gIGRyb3BzOiB7XG4gICAgY3JhdGU6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDIwXG4gICAgfSxcbiAgICBtZWRwYWNrOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgYWRkOiAzMCxcbiAgICAgIG1heDogNTBcbiAgICB9LFxuICAgIG51Y2xlYXI6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDIwXG4gICAgfSxcbiAgICB0YXJnZXQ6IHtcbiAgICAgIHRpbWU6IDAsXG4gICAgICBtYXg6IDEwMFxuICAgIH0sXG4gICAgYXN0ZXJvaWRfY2VudGVyOiB7XG4gICAgICB0aW1lOiAwLFxuICAgICAgaW5jcmVhc2VfZnJlcXVlbmN5OiBmYWxzZSxcbiAgICAgIG1heDogMzBcbiAgICB9LFxuICAgIFwiZ2VtLTFcIjoge1xuICAgICAgdGltZTogMCxcbiAgICAgIG1heDogMjBcbiAgICB9XG4gIH0sXG4gIHdlYXBvbnM6IHtcbiAgICBkaWc6IHtcbiAgICAgIHN0YXJ0X2NvdW50OiAtMSxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgcGhhc2VyOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgYmF6b29rb2lkOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgZ3JlbmFkZToge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogLTFcbiAgICB9LFxuICAgIHB1bmNoOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAtMVxuICAgIH0sXG4gICAgcHVtcGtpbjoge1xuICAgICAgc3RhcnRfY291bnQ6IDAsXG4gICAgICBjcmF0ZV9jaGFuY2U6IDAsXG4gICAgICBjcmF0ZV9jb3VudDogMVxuICAgIH0sXG4gICAgcGFpbmdpdmVyOiB7XG4gICAgICBzdGFydF9jb3VudDogMCxcbiAgICAgIGNyYXRlX2NoYW5jZTogMCxcbiAgICAgIGNyYXRlX2NvdW50OiAxMFxuICAgIH1cbiAgfSxcbiAgYXJtb3VyeTogW1xuICAgIFwiZGlnXCIsXG4gICAgXCJwaGFzZXJcIixcbiAgICBcImJhem9va29pZFwiLFxuICAgIFwiZ3JlbmFkZVwiLFxuICAgIFwicHVuY2hcIixcbiAgICBcInB1bXBraW5cIixcbiAgICBcInBhaW5naXZlclwiXG4gIF0sXG4gIGFycm93czoge1xuICAgIG51Y2xlYXI6IFwiZ3JlZW5cIixcbiAgICBwbGF5ZXI6IFwicmVkXCIsXG4gICAgdGFyZ2V0OiBcImJsdWVcIixcbiAgICBcImFzdGVyb2lkLXNtYWxsXCI6IFwiZ3JleVwiLFxuICAgIFwiYXN0ZXJvaWQtbGFyZ2VcIjogXCJncmV5XCIsXG4gICAgdm9ydGV4OiBcInB1cnBsZVwiLFxuICAgIGNyYXRlOiBcImJsdWVcIlxuICB9LFxuICBzcGF3bjogW10sXG4gIG1hcGdlbjoge1xuICAgIHR5cGU6IFwicmFuZG9tXCIsXG4gICAgc3JjOiBcIlwiLFxuICAgIGdhcDogMjAsXG4gICAgdzogMTAwMCxcbiAgICBoOiAxMDAwLFxuICAgIGJsb2JzOiBbXSxcbiAgICBkZWNvcmF0aW9uczogdHJ1ZSxcbiAgICBzbWFsbF9ibG9iczogNSxcbiAgICBsYXJnZV9ibG9iczogM1xuICB9LFxuICBldmVudHM6IHtcbiAgICBmcmFtZToge30sXG4gICAgY29sbGVjdDoge30sXG4gICAgZGVzdHJveToge30sXG4gICAgdGltZW91dDoge30sXG4gICAgZGVzdHJveV9vYmpfdHlwZToge30sXG4gICAgZGVzdHJveV9vYmpfcGxheWVyOiB7fVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdE1hcCBHZW5lcmF0b3Jcblx0QmxvYnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBEcmF3IGEgYmxvYlxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbl9ibG9iKGltZywgY29uZmlnLCBkZWNvcmF0aW9ucywgcmFkaXVzLCB0eXBlKSB7XG4gIHRoaXMuc2l6ZSA9IDM2O1xuICB0aGlzLmltZyA9IGltZztcbiAgdGhpcy5jID0gY29uZmlnO1xuXG4gIC8vIGdldCBsYW5kIHR5cGVcbiAgdmFyIHR5cGUgPSB0eXBlIHx8IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuYy5sYW5kX3R5cGUubGVuZ3RoKTtcbiAgdGhpcy5yZWYgPSB0aGlzLmMubGFuZF90eXBlW3R5cGVdO1xuXG4gIC8vIHNldCB1cCBtYWluIGFuY2hvciBwb2ludHNcbiAgdmFyIGFuY2hvcnMgPSBbXTtcbiAgdmFyIHBvaW50cyA9IE1hdGguZmxvb3IocmFkaXVzIC8gMikgKyA0O1xuICB2YXIgc3Bpa2UgPSBNYXRoLmZsb29yKHJhZGl1cyAvIDIpICsgMjtcbiAgZm9yICh2YXIgcCA9IDA7IHAgPCBwb2ludHM7IHArKykge1xuICAgIHZhciBuZXdfcmFkaXVzID1cbiAgICAgIE1hdGgubWF4KHJhZGl1cyAtIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNwaWtlKSwgMSkgKyAxO1xuICAgIHZhciB4ID1cbiAgICAgIHJhZGl1cyArIE1hdGguZmxvb3IobmV3X3JhZGl1cyAqIE1hdGguY29zKCgyICogTWF0aC5QSSAqIHApIC8gcG9pbnRzKSk7XG4gICAgdmFyIHkgPVxuICAgICAgcmFkaXVzICsgTWF0aC5mbG9vcihuZXdfcmFkaXVzICogTWF0aC5zaW4oKDIgKiBNYXRoLlBJICogcCkgLyBwb2ludHMpKTtcbiAgICBhbmNob3JzLnB1c2goeyB4OiB4LCB5OiB5IH0pO1xuICB9XG5cbiAgLy8gZHJhdyBzaGFwZSB0byBjYW52YXNcbiAgdmFyIHNpemUgPSByYWRpdXMgKiAyICsgMTtcbiAgdmFyIHNoYXBlID0gbWFwZ2VuX2NhbnZhcyhzaXplLCBzaXplKTtcbiAgdGhpcy5kcmF3X3BhdGgoc2hhcGUsIGFuY2hvcnMpO1xuXG4gIC8vIGJ1aWxkIGFycmF5IG9mIGxhbmQgb3Igbm90IHRpbGVzXG4gIHZhciBwaXhlbHMgPSBzaGFwZS5jb250LmdldEltYWdlRGF0YSgwLCAwLCBzaGFwZS53LCBzaGFwZS5oKTtcbiAgdGhpcy5sYW5kID0gW107XG4gIGZvciAodmFyIHkgPSAwOyB5IDwgc2l6ZTsgeSsrKSB7XG4gICAgdGhpcy5sYW5kW3ldID0gW107XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzaXplOyB4KyspIHtcbiAgICAgIHZhciBpID0gKHkgKiBzaXplICsgeCkgKiA0ICsgMztcbiAgICAgIHRoaXMubGFuZFt5XVt4XSA9IHBpeGVscy5kYXRhW2ldID4gMzAgPyAxIDogMDtcbiAgICB9XG4gIH1cblxuICAvLyBidWlsZCB0aWxlIGFycmF5IGFuZCBhc3NpZ24gY29ybmVycyBhbmQgbGFuZFxuICB0aGlzLnRpbGVzID0gW107XG4gIGZvciAodmFyIHkgPSAwOyB5IDwgc2l6ZTsgeSsrKSB7XG4gICAgdGhpcy50aWxlc1t5XSA9IFtdO1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCsrKSB7XG4gICAgICB0aGlzLnRpbGVzW3ldW3hdID0gdGhpcy5zZXRfY29ybmVyX3RpbGUoeSwgeCk7XG4gICAgfVxuICB9XG5cbiAgLy8gYXNzaWduIHBpeGVscyBhIHRpbGUgdmFsdWVcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCBzaXplOyB5KyspIHtcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNpemU7IHgrKykge1xuICAgICAgdGhpcy50aWxlc1t5XVt4XSA9XG4gICAgICAgIHRoaXMudGlsZXNbeV1beF0gPT09IDEyID8gdGhpcy5zZXRfbGFuZF90aWxlKHksIHgpIDogdGhpcy50aWxlc1t5XVt4XTtcbiAgICB9XG4gIH1cblxuICAvLyBkcmF3IHRoZW1cbiAgdmFyIHdoID0gKHNpemUgKyA0KSAqIHRoaXMuc2l6ZTtcbiAgdGhpcy5hbHBoYSA9IG1hcGdlbl9jYW52YXMod2gsIHdoKTtcbiAgdGhpcy5lZGdlID0gbWFwZ2VuX2NhbnZhcyh3aCwgd2gpO1xuICB0aGlzLmJnID0gbWFwZ2VuX2NhbnZhcyh3aCwgd2gpO1xuICBmb3IgKHZhciB5ID0gMDsgeSA8IHNpemU7IHkrKykge1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCsrKSB7XG4gICAgICB2YXIgdGlsZSA9IHRoaXMudGlsZXNbeV1beF07XG4gICAgICBpZiAodGlsZSA9PT0gLTEpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIGRyYXcgaXRcbiAgICAgIHZhciB4MSA9ICh4ICsgMikgKiB0aGlzLnNpemU7XG4gICAgICB2YXIgeTEgPSAoeSArIDIpICogdGhpcy5zaXplO1xuICAgICAgdGhpcy5kcmF3X3RvX2NhbnZhcyh0aGlzLmFscGhhLmNvbnQsIHgxLCB5MSwgdGlsZSwgMCk7XG4gICAgICB0aGlzLmRyYXdfdG9fY2FudmFzKHRoaXMuZWRnZS5jb250LCB4MSwgeTEsIHRpbGUsIHRoaXMucmVmLmVkZ2UpO1xuXG4gICAgICBpZiAoZGVjb3JhdGlvbnMpIHtcbiAgICAgICAgdGhpcy5kcmF3X2RlY29yYXRpb24odGhpcy5iZy5jb250LCB4LCB5LCB0aWxlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBkcmF3IHJlc3Qgb2YgZmdcbiAgdmFyIGZnID0gbWFwZ2VuX3BhdHRlcm4odGhpcy5hbHBoYS5jYW52LCB0aGlzLmltZ1t0aGlzLnJlZi5mZ10pO1xuICBmZy5jb250LmRyYXdJbWFnZSh0aGlzLmVkZ2UuY2FudiwgMCwgMCk7XG5cbiAgLy8gZHJhdyBkaXJ0IGJnXG4gIHZhciBmZ19kaXJ0ID0gbWFwZ2VuX3BhdHRlcm4oZmcuY2FudiwgdGhpcy5pbWdbdGhpcy5yZWYuYmddKTtcbiAgdGhpcy5iZy5jb250LmRyYXdJbWFnZShmZ19kaXJ0LmNhbnYsIDAsIDApO1xuXG4gIC8vIGV4cG9ydFxuICByZXR1cm4ge1xuICAgIGZnOiBmZyxcbiAgICBiZzogdGhpcy5iZ1xuICB9O1xufVxuXG4vKiBEcmF3IGFuIGFscGhhIHBhdGhcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuZHJhd19wYXRoID0gZnVuY3Rpb24oY2FudiwgcGF0aCkge1xuICAvLyBzdGFydCBwYXRocyBvbiBjYW52YXNlc1xuICBjYW52LmNvbnQuYmVnaW5QYXRoKCk7XG4gIGNhbnYuY29udC5tb3ZlVG8ocGF0aFswXS54LCBwYXRoWzBdLnkpO1xuXG4gIC8vIGdvIHRocm91Z2ggcGF0aFxuICBmb3IgKHZhciBpID0gMTsgaSA8IHBhdGgubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgLy8gZ2V0IG5leHQgcG9pbnQgdG8gY3VydmUgYXJvdW5kXG4gICAgdmFyIHBvaW50MSA9IHBhdGhbaV0sXG4gICAgICBwb2ludDIgPSBwYXRoW2kgKyAxXSxcbiAgICAgIHF4LFxuICAgICAgcXk7XG5cbiAgICAvLyBnZXQgY3VydmUgdmFsdWVzXG4gICAgaWYgKGkgPCBwYXRoLmxlbmd0aCAtIDEpIHtcbiAgICAgIHF4ID0gKHBvaW50MS54ICsgcG9pbnQyLngpIC8gMjtcbiAgICAgIHF5ID0gKHBvaW50MS55ICsgcG9pbnQyLnkpIC8gMjtcbiAgICB9IGVsc2Uge1xuICAgICAgcXggPSBwb2ludDIueDtcbiAgICAgIHF5ID0gcG9pbnQyLnk7XG4gICAgfVxuXG4gICAgLy8gZHJhdyBjdXJ2ZSB0byBwYXRoXG4gICAgY2Fudi5jb250LnF1YWRyYXRpY0N1cnZlVG8ocG9pbnQxLngsIHBvaW50MS55LCBxeCwgcXkpO1xuICB9XG5cbiAgLy8gcmVqb2luIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHBhdGggYW5kIGZpbGxcbiAgY2Fudi5jb250LmxpbmVUbyhwYXRoWzBdLngsIHBhdGhbMF0ueSk7XG4gIGNhbnYuY29udC5maWxsKCk7XG59O1xuXG4vKiBEcmF3IGEgZGVjb3JhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5kcmF3X2RlY29yYXRpb24gPSBmdW5jdGlvbihjb250LCB4LCB5LCB0aWxlKSB7XG4gIC8vIGFyZSB3ZSBkcmF3aW5nIG9uZVxuICBpZiAodGlsZSA+IDcgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgIT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjYW4gd2UgZG8gZG91Ymxlc1xuICB2YXIgZG91YmxlID0gZmFsc2U7XG4gIGlmICh0aWxlID09PSAwICYmIHRoaXMuaXNfdHlwZSh5LCB4ICsgMSwgMCkpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSAxICYmIHRoaXMuaXNfdHlwZSh5LCB4IC0gMSwgMSkpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSAyICYmIHRoaXMuaXNfdHlwZSh5IC0gMSwgeCwgMikpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSAzICYmIHRoaXMuaXNfdHlwZSh5ICsgMSwgeCwgMykpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSA0ICYmIHRoaXMuaXNfdHlwZSh5IC0gMSwgeCArIDEsIDQpKSB7XG4gICAgZG91YmxlID0gdHJ1ZTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNSAmJiB0aGlzLmlzX3R5cGUoeSArIDEsIHggKyAxLCA1KSkge1xuICAgIGRvdWJsZSA9IHRydWU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDYgJiYgdGhpcy5pc190eXBlKHkgLSAxLCB4IC0gMSwgNikpIHtcbiAgICBkb3VibGUgPSB0cnVlO1xuICB9XG4gIGlmICh0aWxlID09PSA3ICYmIHRoaXMuaXNfdHlwZSh5ICsgMSwgeCAtIDEsIDcpKSB7XG4gICAgZG91YmxlID0gdHJ1ZTtcbiAgfVxuXG4gIC8vIGNob29zZSBzb3VyY2VcbiAgdmFyIHNvdXJjZSA9IHRoaXMucmVmLmRlY29yYXRpb25zWzFdO1xuICBpZiAoZG91YmxlICYmIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpID09PSAwKSB7XG4gICAgc291cmNlID0gdGhpcy5yZWYuZGVjb3JhdGlvbnNbMl07XG4gIH0gZWxzZSB7XG4gICAgZG91YmxlID0gZmFsc2U7XG4gIH1cblxuICAvLyBjaG9vc2UgZGVjb3JhdGlvblxuICB2YXIgaSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNvdXJjZS5sZW5ndGgpO1xuICB2YXIgcmVmID0gc291cmNlW2ldO1xuXG4gIC8vIGdldCBwb3NpdGlvbiB0byBkcmF3IGl0XG4gIHZhciBoYWxmID0gdGhpcy5zaXplIC8gMjtcbiAgdmFyIHgxID0gKHggKyAyKSAqIHRoaXMuc2l6ZTtcbiAgdmFyIHkxID0gKHkgKyAyKSAqIHRoaXMuc2l6ZTtcbiAgdmFyIGFuZ2xlID0gMDtcbiAgaWYgKHRpbGUgPT09IDEpIHtcbiAgICB4MSArPSB0aGlzLnNpemU7XG4gICAgeTEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMTgwO1xuICB9XG4gIGlmICh0aWxlID09PSAyKSB7XG4gICAgeTEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gMjcwO1xuICB9XG4gIGlmICh0aWxlID09PSAzKSB7XG4gICAgeDEgKz0gdGhpcy5zaXplO1xuICAgIGFuZ2xlID0gOTA7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDQpIHtcbiAgICB5MSArPSB0aGlzLnNpemU7XG4gICAgYW5nbGUgPSAzMTU7XG4gIH1cbiAgaWYgKHRpbGUgPT09IDUpIHtcbiAgICBhbmdsZSA9IDQ1O1xuICB9XG4gIGlmICh0aWxlID09PSA2KSB7XG4gICAgeDEgKz0gdGhpcy5zaXplO1xuICAgIHkxICs9IHRoaXMuc2l6ZTtcbiAgICBhbmdsZSA9IDIyNTtcbiAgfVxuICBpZiAodGlsZSA9PT0gNykge1xuICAgIHgxICs9IHRoaXMuc2l6ZTtcbiAgICBhbmdsZSA9IDEzNTtcbiAgfVxuXG4gIC8vIGRyYXcgdGhhdCBzaGl0XG4gIHZhciB4X2FkZCA9IGRvdWJsZSA/IHRoaXMuc2l6ZSA6IDA7XG4gIGNvbnQuc2F2ZSgpO1xuICBjb250LnRyYW5zbGF0ZSh4MSwgeTEpO1xuICBjb250LnJvdGF0ZSgoYW5nbGUgKiBNYXRoLlBJKSAvIDE4MCk7XG4gIGNvbnQuZHJhd0ltYWdlKFxuICAgIHRoaXMuaW1nLmRlY29yYXRpb25zLFxuICAgIHJlZi54LFxuICAgIHJlZi55LFxuICAgIHJlZi53LFxuICAgIHJlZi5oLFxuICAgIDAsXG4gICAgLXJlZi5oICsgNSxcbiAgICByZWYudyxcbiAgICByZWYuaFxuICApO1xuICBjb250LnRyYW5zbGF0ZSgteDEsIC15MSk7XG4gIGNvbnQucmVzdG9yZSgpO1xufTtcblxuLyogRHJhdyBhIHRpbGUgdG8gYSBjYW52YXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuZHJhd190b19jYW52YXMgPSBmdW5jdGlvbihjb250LCB4LCB5LCB0aWxlLCBrZXkpIHtcbiAgdmFyIHRzID0gdGhpcy5zaXplO1xuICBjb250LnNhdmUoKTtcbiAgY29udC50cmFuc2xhdGUoeCwgeSk7XG4gIGNvbnQuZHJhd0ltYWdlKHRoaXMuaW1nLmVkZ2UsIHRpbGUgKiB0cywga2V5ICogdHMsIHRzLCB0cywgMCwgMCwgdHMsIHRzKTtcbiAgY29udC50cmFuc2xhdGUoLXksIC15KTtcbiAgY29udC5yZXN0b3JlKCk7XG59O1xuXG4vKiBHZXQgY29ybmVyIGFuZCBsYW5kIHRpbGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLnNldF9jb3JuZXJfdGlsZSA9IGZ1bmN0aW9uKHksIHgpIHtcbiAgdmFyIHRpbGUgPSAtMTtcblxuICAvL2xhbmRcbiAgaWYgKHRoaXMuaXNfbGFuZCh5LCB4KSkge1xuICAgIHRpbGUgPSAxMjtcblxuICAgIC8vIG5vdCBsYW5kXG4gIH0gZWxzZSB7XG4gICAgLy8gY29ybmVyc1xuICAgIGlmIChcbiAgICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDQ7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgICF0aGlzLmlzX2xhbmQoeSAtIDEsIHgpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgICB0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDU7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHkgKyAxLCB4KSAmJlxuICAgICAgdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDY7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAgIHRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAgICF0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKVxuICAgICkge1xuICAgICAgdGlsZSA9IDc7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRpbGU7XG59O1xuXG4vKiBTZXQgbGFuZCB0aWxlIHR5cGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLnNldF9sYW5kX3RpbGUgPSBmdW5jdGlvbih5LCB4KSB7XG4gIHZhciB0aWxlID0gMTI7XG5cbiAgLy8gY29ybmVyc1xuICBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5IC0gMSwgeCkgJiZcbiAgICAhdGhpcy5pc19sYW5kKHksIHggLSAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSArIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCAtIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgLSAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gNDtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4IC0gMSkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHkgKyAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5LCB4ICsgMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSAtIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSA1O1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSwgeCAtIDEpICYmXG4gICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICB0aGlzLmlzX2xhbmRfb3JfY29ybmVyKHkgLSAxLCB4KSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSwgeCArIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHksIHggLSAxKSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5ICsgMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDY7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZF9vcl9jb3JuZXIoeSAtIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kX29yX2Nvcm5lcih5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCArIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHkgKyAxLCB4KVxuICApIHtcbiAgICB0aWxlID0gNztcblxuICAgIC8vIGZsYXQgZWRnZXNcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgIHRoaXMuaXNfbGFuZCh5ICsgMSwgeCkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSAtIDEsIHgpXG4gICkge1xuICAgIHRpbGUgPSAwO1xuICB9IGVsc2UgaWYgKFxuICAgICF0aGlzLmlzX2xhbmQoeSArIDEsIHgpICYmXG4gICAgdGhpcy5pc19sYW5kKHkgLSAxLCB4KSAmJlxuICAgICF0aGlzLmlzX2Nvcm5lcih5ICsgMSwgeClcbiAgKSB7XG4gICAgdGlsZSA9IDE7XG4gIH0gZWxzZSBpZiAoXG4gICAgIXRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICB0aGlzLmlzX2xhbmQoeSwgeCArIDEpICYmXG4gICAgIXRoaXMuaXNfY29ybmVyKHksIHggLSAxKVxuICApIHtcbiAgICB0aWxlID0gMjtcbiAgfSBlbHNlIGlmIChcbiAgICAhdGhpcy5pc19sYW5kKHksIHggKyAxKSAmJlxuICAgIHRoaXMuaXNfbGFuZCh5LCB4IC0gMSkgJiZcbiAgICAhdGhpcy5pc19jb3JuZXIoeSwgeCArIDEpXG4gICkge1xuICAgIHRpbGUgPSAzO1xuXG4gICAgLy8gaW5zaWRlIGNvcm5lcnNcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSArIDEsIHgsIDcpIHx8IHRoaXMuaXNfdHlwZSh5LCB4ICsgMSwgNykpIHtcbiAgICB0aWxlID0gODtcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSArIDEsIHgsIDYpIHx8IHRoaXMuaXNfdHlwZSh5LCB4IC0gMSwgNikpIHtcbiAgICB0aWxlID0gOTtcbiAgfSBlbHNlIGlmICh0aGlzLmlzX3R5cGUoeSAtIDEsIHgsIDUpIHx8IHRoaXMuaXNfdHlwZSh5LCB4ICsgMSwgNSkpIHtcbiAgICB0aWxlID0gMTA7XG4gIH0gZWxzZSBpZiAodGhpcy5pc190eXBlKHkgLSAxLCB4LCA0KSB8fCB0aGlzLmlzX3R5cGUoeSwgeCAtIDEsIDQpKSB7XG4gICAgdGlsZSA9IDExO1xuICB9XG5cbiAgcmV0dXJuIHRpbGU7XG59O1xuXG4vKiBDaGVjayBhcnJheXMgZm9yIHZhbHVlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc19sYW5kX29yX2Nvcm5lciA9IGZ1bmN0aW9uKHksIHgpIHtcbiAgaWYgKHRoaXMuaXNfY29ybmVyKHksIHgpIHx8IHRoaXMuaXNfbGFuZCh5LCB4KSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG5tYXBnZW5fYmxvYi5wcm90b3R5cGUuaXNfY29ybmVyID0gZnVuY3Rpb24oeSwgeCkge1xuICByZXR1cm4gdGhpcy5jaGVja19hcnIodGhpcy50aWxlcywgeSwgeCwgWzQsIDUsIDYsIDddKTtcbn07XG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc190eXBlID0gZnVuY3Rpb24oeSwgeCwgdHlwZSkge1xuICByZXR1cm4gdGhpcy5jaGVja19hcnIodGhpcy50aWxlcywgeSwgeCwgW3R5cGVdKTtcbn07XG5cbm1hcGdlbl9ibG9iLnByb3RvdHlwZS5pc19sYW5kID0gZnVuY3Rpb24oeSwgeCkge1xuICByZXR1cm4gdGhpcy5jaGVja19hcnIodGhpcy5sYW5kLCB5LCB4LCBbMV0pO1xufTtcblxubWFwZ2VuX2Jsb2IucHJvdG90eXBlLmNoZWNrX2FyciA9IGZ1bmN0aW9uKGFyciwgeSwgeCwgY2hlY2tzKSB7XG4gIGlmICh5IDwgMCB8fCB5ID49IGFyci5sZW5ndGggfHwgeCA8IDAgfHwgeCA+PSBhcnJbMF0ubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2hlY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGFyclt5XVt4XSA9PSBjaGVja3NbaV0pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR2VuZXJhdG9yXG5cdE1ha2UgQ2FudmFzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGEgbmV3IGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbl9jYW52YXModywgaCkge1xuICB2YXIgb2JqID0ge307XG4gIGlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBnbG9iYWwpIHtcbiAgICBvYmouY2FudiA9IG5ldyBjYW52YXMoKTtcbiAgfSBlbHNlIHtcbiAgICBvYmouY2FudiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIH1cbiAgb2JqLmNvbnQgPSBvYmouY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG4gIG9iai5jYW52LndpZHRoID0gdztcbiAgb2JqLmNhbnYuaGVpZ2h0ID0gaDtcbiAgb2JqLmNvbnQuZmlsbFN0eWxlID0gXCIjZmZmXCI7XG4gIG9iai53ID0gdztcbiAgb2JqLmggPSBoO1xuICByZXR1cm4gb2JqO1xufVxuXG4vKiBEcmF3IGEgcGF0dGVybiB0byBhIGNhbnZhc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG1hcGdlbl9wYXR0ZXJuKGFscGhhLCBwYXR0ZXJuKSB7XG4gIHZhciBjYW52ID0gbWFwZ2VuX2NhbnZhcyhhbHBoYS53aWR0aCwgYWxwaGEuaGVpZ2h0KTtcbiAgaWYgKHR5cGVvZiBwYXR0ZXJuICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcGF0dGVybiA9IGNhbnYuY29udC5jcmVhdGVQYXR0ZXJuKHBhdHRlcm4sIFwicmVwZWF0XCIpO1xuICB9XG4gIGNhbnYuY29udC5maWxsU3R5bGUgPSBwYXR0ZXJuO1xuICBjYW52LmNvbnQuZmlsbFJlY3QoMCwgMCwgYWxwaGEud2lkdGgsIGFscGhhLmhlaWdodCk7XG4gIGNhbnYuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcImRlc3RpbmF0aW9uLWluXCI7XG4gIGNhbnYuY29udC5kcmF3SW1hZ2UoYWxwaGEsIDAsIDApO1xuICBjYW52LmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJub3JtYWxcIjtcblxuICByZXR1cm4gY2Fudjtcbn1cbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR2VuZXJhdG9yXG5cdC0tLS0tLS0tLS0tLVxuXHRDb25maWc6XG5cdHcgICAgICAgICAgIC8vIHdpZHRoIG9mIG1hcFxuXHRoICAgICAgICAgICAvLyBoZWlnaHQgb2YgbWFwXG5cdGNydXN0ICAgICAgIC8vIHRoaWNrbmVzcyBvZiBvdXRlciBjcnVzdCBvbiBsYW5kXG5cdGJsb2JzICAgICAgIC8vIGluaXRpYWwgYmxvYnNcblx0Y2VudGVyX2Jsb2IgLy8gc2l6ZSBvZiBjZW50ZXIgYmxvYiBvZiBsYW5kLCAwIGZvciBub25lXG5cdHNtYWxsX2Jsb2JzIC8vIG51bWJlciBvZiByYW5kb20gc21hbGwgY2lyY2xlcyBvZiBsYW5kXG5cdGxhcmdlX2Jsb2JzIC8vIG51bWJlciBvZiByYW5kb20gbGFyZ2UgY2lyY2xlcyBvZiBsYW5kXG5cdC0tLS0tLS0tLS0tXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2VydmVyIHNpZGUgb25seVxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBnbG9iYWwpIHtcbiAgdmFyIGZzID0gcmVxdWlyZShcImZzXCIpO1xufVxuXG4vKiBOZXcgTWFwIEdlbmVyYXRpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBtYXBnZW4oaW1nLCBjb25maWcsIHNjaGVtZSwgbWFwX2ltZykge1xuICB0aGlzLnNpemUgPSAzNjtcbiAgdGhpcy5pbWcgPSBpbWc7XG4gIHRoaXMuYyA9IGNvbmZpZztcbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG5cbiAgLy8gY2hvb3NlIHR5cGVcbiAgaWYgKHRoaXMuc2NoZW1lLnR5cGUgPT0gXCJyYW5kb21cIikge1xuICAgIHJldHVybiB0aGlzLmRyYXdfcmFuZG9tKCk7XG4gIH1cbiAgaWYgKHRoaXMuc2NoZW1lLnR5cGUgPT0gXCJpbWFnZVwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZHJhd19pbWFnZShtYXBfaW1nKTtcbiAgfVxufVxuXG4vKiBEcmF3IGltYWdlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuLnByb3RvdHlwZS5kcmF3X2ltYWdlID0gZnVuY3Rpb24obWFwX2ltZykge1xuICB2YXIgZmcgPSBtYXBnZW5fY2FudmFzKFxuICAgIG1hcF9pbWcud2lkdGggKyB0aGlzLnNjaGVtZS5nYXAgKiAyLFxuICAgIG1hcF9pbWcuaGVpZ2h0ICsgdGhpcy5zY2hlbWUuZ2FwICogMlxuICApO1xuICBmZy5jb250LmRyYXdJbWFnZShtYXBfaW1nLCB0aGlzLnNjaGVtZS5nYXAsIHRoaXMuc2NoZW1lLmdhcCk7XG4gIHZhciBiZyA9IG1hcGdlbl9wYXR0ZXJuKGZnLmNhbnYsIHRoaXMuaW1nLmRpcnQpO1xuICByZXR1cm4geyBmZzogZmcsIGJnOiBiZyB9O1xufTtcblxuLyogRHJhdyByYW5kb21cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmRyYXdfcmFuZG9tID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldHVwXG4gIHRoaXMuYmxvYnMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuc2NoZW1lLmJsb2JzKSk7XG4gIHRoaXMuYmcgPSBtYXBnZW5fY2FudmFzKHRoaXMuc2NoZW1lLncsIHRoaXMuc2NoZW1lLmgpO1xuICB0aGlzLmZnID0gbWFwZ2VuX2NhbnZhcyh0aGlzLnNjaGVtZS53LCB0aGlzLnNjaGVtZS5oKTtcblxuICAvLyBnZW5lcmF0ZSBzb21lIHJhbmRvbSBsYXJnZSBjaXJjbGVzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUubGFyZ2VfYmxvYnM7IGkrKykge1xuICAgIHRoaXMuYmxvYnMgPSB0aGlzLmdldF9jaXJjbGUodGhpcy5ibG9icywgNCwgNik7XG4gIH1cblxuICAvLyBnZW5lcmF0ZSBzb21lIHJhbmRvbSBzbWFsbCBjaXJjbGVzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUuc21hbGxfYmxvYnM7IGkrKykge1xuICAgIHRoaXMuYmxvYnMgPSB0aGlzLmdldF9jaXJjbGUodGhpcy5ibG9icywgMSwgMyk7XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGVhY2ggYmxvYlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmxvYnMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgYmxvYiA9IHRoaXMuYmxvYnNbaV07XG5cbiAgICAvLyBjcmVhdGUgdGhlIGJsb2JzXG4gICAgdmFyIGJnID0gbmV3IG1hcGdlbl9ibG9iKHRoaXMuaW1nLCB0aGlzLmMsIGZhbHNlLCBibG9iLnIgKyA0LCBibG9iLnR5cGUpO1xuICAgIHZhciBmZyA9IG5ldyBtYXBnZW5fYmxvYihcbiAgICAgIHRoaXMuaW1nLFxuICAgICAgdGhpcy5jLFxuICAgICAgdGhpcy5zY2hlbWUuZGVjb3JhdGlvbnMsXG4gICAgICBibG9iLnIsXG4gICAgICBibG9iLnR5cGVcbiAgICApO1xuXG4gICAgLy8gY29tYmluZSB0aGUgYmFja2dyb3VuZHNcbiAgICB2YXIgd2ggPSBmZy5mZy5jYW52LndpZHRoO1xuICAgIHZhciBuZXdfYmcgPSBtYXBnZW5fY2FudmFzKHdoLCB3aCk7XG4gICAgbmV3X2JnLmNvbnQuZHJhd0ltYWdlKGJnLmZnLmNhbnYsIHdoICogMC4xLCB3aCAqIDAuMSwgd2ggKiAwLjgsIHdoICogMC44KTtcbiAgICBuZXdfYmcuY29udC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1hdG9wXCI7XG4gICAgbmV3X2JnLmNvbnQuZmlsbFN0eWxlID0gXCJyZ2JhKDAsMCwwLDAuOClcIjtcbiAgICBuZXdfYmcuY29udC5maWxsUmVjdCgwLCAwLCB3aCwgd2gpO1xuICAgIG5ld19iZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwibm9ybWFsXCI7XG4gICAgbmV3X2JnLmNvbnQuZHJhd0ltYWdlKGZnLmJnLmNhbnYsIDAsIDApO1xuXG4gICAgLy8gZHJhdyBpdCB0byBtYWluIGNhbnZhc1xuICAgIHRoaXMuYmcuY29udC5kcmF3SW1hZ2UobmV3X2JnLmNhbnYsIGJsb2IueCAtIHdoIC8gMiwgYmxvYi55IC0gd2ggLyAyKTtcbiAgICB0aGlzLmZnLmNvbnQuZHJhd0ltYWdlKGZnLmZnLmNhbnYsIGJsb2IueCAtIHdoIC8gMiwgYmxvYi55IC0gd2ggLyAyKTtcbiAgfVxuXG4gIC8vIHJldHVybiBpdFxuICByZXR1cm4ge1xuICAgIGJnOiB0aGlzLmJnLFxuICAgIGZnOiB0aGlzLmZnXG4gIH07XG59O1xuXG4vKiBHZXQgYSBmYXIgYXdheSBjaXJjbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tYXBnZW4ucHJvdG90eXBlLmdldF9jaXJjbGUgPSBmdW5jdGlvbihhcnIsIG1pbl9yYWRpdXMsIG1heF9yYWRpdXMpIHtcbiAgLy8gZ2VuZXJhdGUgbWFueSBjaXJjbGVzIGFuZCBmaW5kIGZ1cnRoZXN0IGF3YXlcbiAgdmFyIGRpc3RhbmNlID0gMDtcbiAgdmFyIGNpcmNsZSA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAyMDsgaSsrKSB7XG4gICAgLy8gbWFrZSBuZXcgY2lyY2xlXG4gICAgdmFyIHRlc3RfY2lyY2xlID0gdGhpcy5jaXJjbGUobWluX3JhZGl1cywgbWF4X3JhZGl1cyk7XG4gICAgdmFyIHNtYWxsZXN0X2Rpc3RhbmNlID0gOTk5OTk5O1xuXG4gICAgLy8gZmluZCBzaG9ydGVzdCBkaXN0YW5jZSBmcm9tIGFsbCBvdGhlciBjaXJjbGVzXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBhcnIubGVuZ3RoOyBqKyspIHtcbiAgICAgIHZhciBkeCA9IGFycltqXS54IC0gdGVzdF9jaXJjbGUueDtcbiAgICAgIHZhciBkeSA9IGFycltqXS55IC0gdGVzdF9jaXJjbGUueTtcbiAgICAgIHZhciB0ZXN0X2Rpc3RhbmNlID0gTWF0aC5yb3VuZChcbiAgICAgICAgTWF0aC5zcXJ0KE1hdGgucG93KGR4LCAyKSArIE1hdGgucG93KGR5LCAyKSlcbiAgICAgICk7XG4gICAgICBzbWFsbGVzdF9kaXN0YW5jZSA9XG4gICAgICAgIHRlc3RfZGlzdGFuY2UgPCBzbWFsbGVzdF9kaXN0YW5jZSA/IHRlc3RfZGlzdGFuY2UgOiBzbWFsbGVzdF9kaXN0YW5jZTtcbiAgICB9XG5cbiAgICAvLyBpZiBpcyB0aGUgbGFyZ2VzdCBkaXN0YW5jZSByZWNvcmQgdGhpcyBhcyBmdXJ0aGVzdFxuICAgIGlmIChkaXN0YW5jZSA8IHNtYWxsZXN0X2Rpc3RhbmNlKSB7XG4gICAgICBkaXN0YW5jZSA9IHNtYWxsZXN0X2Rpc3RhbmNlO1xuICAgICAgY2lyY2xlID0gdGVzdF9jaXJjbGU7XG4gICAgfVxuICB9XG5cbiAgLy8gYWRkIGZ1cnRoZXN0IGF3YXkgY2lyY2xlIHRvIG5ldyBhcnJheVxuICBhcnIucHVzaChjaXJjbGUpO1xuICByZXR1cm4gYXJyO1xufTtcblxuLyogR2VuZXJhdGUgYSByYW5kb20gY2lyY2xlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubWFwZ2VuLnByb3RvdHlwZS5jaXJjbGUgPSBmdW5jdGlvbihtaW5fcmFkaXVzLCBtYXhfcmFkaXVzKSB7XG4gIHZhciByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4X3JhZGl1cykgKyBtaW5fcmFkaXVzO1xuICB2YXIgZ2FwID0gKHIgKyAyKSAqIHRoaXMuc2l6ZSArIHRoaXMuc2NoZW1lLmdhcDtcbiAgdmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5zY2hlbWUudyAtIGdhcCAqIDIpKSArIGdhcDtcbiAgdmFyIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5zY2hlbWUuaCAtIGdhcCAqIDIpKSArIGdhcDtcbiAgcmV0dXJuIHtcbiAgICByOiByLFxuICAgIHg6IHgsXG4gICAgeTogeVxuICB9O1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRNYXAgR3Jhdml0eVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBncmF2aXR5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5pbml0X2dyYXZpdHkgPSBmdW5jdGlvbihncmF2aXR5X21hcCkge1xuICB0aGlzLndlaWdodCA9IHRoaXMuc2NoZW1lLmdyYXZpdHkgfHwgMTtcbiAgdGhpcy5ncmF2aXR5X3R5cGUgPSB0aGlzLnNjaGVtZS5ncmF2aXR5X3R5cGUgfHwgXCJsYW5kXCI7XG5cbiAgaWYgKHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSAhPT0gXCJsYW5kXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZXQgdmFsdWVzXG4gIHRoaXMuZ3Jhdml0eSA9IHtcbiAgICB3OiAwLFxuICAgIGg6IDAsXG4gICAgbWFwOiBbXSxcbiAgICBzY2FsZTogMjQsXG4gICAgcmVhY2g6IDE4XG4gIH07XG5cbiAgaWYgKGdyYXZpdHlfbWFwKSB7XG4gICAgdGhpcy5ncmF2aXR5Lm1hcCA9IEpTT04ucGFyc2UoZ3Jhdml0eV9tYXApO1xuICAgIHRoaXMuZ3Jhdml0eS53ID0gdGhpcy5ncmF2aXR5Lm1hcFswXS5sZW5ndGg7XG4gICAgdGhpcy5ncmF2aXR5LmggPSB0aGlzLmdyYXZpdHkubWFwLmxlbmd0aDtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmluaXRfZ3Jhdml0eV9tYXAoKTtcbiAgfVxufTtcblxuLyogR2VuZXJhdGUgZ3Jhdml0eSBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuaW5pdF9ncmF2aXR5X21hcCA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZXQgc2l6ZSBvZiBuZXcgZ3Jhdml0eSBncmlkXG4gIHRoaXMuZ3Jhdml0eS53ID0gY2VpbCh0aGlzLncgLyB0aGlzLmdyYXZpdHkuc2NhbGUpO1xuICB0aGlzLmdyYXZpdHkuaCA9IGNlaWwodGhpcy5oIC8gdGhpcy5ncmF2aXR5LnNjYWxlKTtcblxuICAvLyBnZW5lcmF0ZSBtYXAgYXJyYXlcbiAgdmFyIG5ld19hcnIgPSBbXTtcbiAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmdyYXZpdHkuaDsgeSsrKSB7XG4gICAgdGhpcy5ncmF2aXR5Lm1hcFt5XSA9IFtdO1xuICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5ncmF2aXR5Lnc7IHgrKykge1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5XS5wdXNoKFswLCAwLCAwXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGhlIGNhbGN1bGF0aW5nXG4gIHRoaXMuYWN0aW9uX2dyYXZpdHlfZ2VuZXJhdGUoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xufTtcblxuLyogQXBwbHkgbmV3IGdyYXZpdHkgY2FsY3VsYXRpb25zIHRvIGEgc2V0IG9mIHBpeGVsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSA9IGZ1bmN0aW9uKHgsIHksIHcsIGgpIHtcbiAgLy8gY2FsY3VsYXRlIHdoaWNoIHRpbGVzIGFyZSBhZmZlY3RlZFxuICB2YXIgeDEgPSBtYXgoMCwgbWluKGZsb29yKHggLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTEgPSBtYXgoMCwgbWluKGZsb29yKHkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKGZsb29yKCh4ICsgdykgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudykpO1xuICB2YXIgeTIgPSBtYXgoMCwgbWluKGZsb29yKCh5ICsgaCkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCkpO1xuXG4gIC8vIGdldCB0aGUgd2VpZ2h0IG9mIGFsbCBhZmZlY3RlZCB0aWxlc1xuICBmb3IgKHZhciB5MyA9IHkxOyB5MyA8IHkyOyB5MysrKSB7XG4gICAgZm9yICh2YXIgeDMgPSB4MTsgeDMgPCB4MjsgeDMrKykge1xuICAgICAgdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdID0gdGhpcy5nZXRfdGlsZV93ZWlnaHQoeDMsIHkzKTtcbiAgICB9XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgc3Vycm91bmRpbmcgdGlsZXNcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4MSAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5MSAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcbiAgdmFyIHgyID0gbWF4KDAsIG1pbih4MiArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5MiArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcblxuICAvLyBnbyB0aHJvdWdoIHN1cnJvdW5kaW5nIHRpbGVzIHRvIGdldCBncmF2aXR5XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB2YXIgeHkgPSB0aGlzLmdldF90aWxlX2dyYXZpdHkoeDMsIHkzKTtcbiAgICAgIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVsxXSA9IHh5Lng7XG4gICAgICB0aGlzLmdyYXZpdHkubWFwW3kzXVt4M11bMl0gPSB4eS55O1xuICAgIH1cbiAgfVxufTtcblxuLyogR2V0IHdlaWdodCBvZiBhIHRpbGUgaW4gdGhlIGdyYXZpdHkgbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF90aWxlX3dlaWdodCA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gbGltaXQgeCBhbmQgeSB0byB3aXRoaW4gdGhlIGFyZWFcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5ICogdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLmgpKTtcbiAgdmFyIHgxID0gbWF4KDAsIG1pbih4ICogdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLncpKTtcbiAgdmFyIHkyID0gbWF4KDAsIG1pbih5ICogdGhpcy5ncmF2aXR5LnNjYWxlICsgdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLmgpKTtcbiAgdmFyIHgyID0gbWF4KDAsIG1pbih4ICogdGhpcy5ncmF2aXR5LnNjYWxlICsgdGhpcy5ncmF2aXR5LnNjYWxlLCB0aGlzLncpKTtcblxuICAvLyBnbyB0aHJvdWdoIHRoZSBncmlkIG9mIHBpeGVsc1xuICB2YXIgYyA9IDA7XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB2YXIgaWQgPSB0aGlzLmkoeDMsIHkzKTtcbiAgICAgIGlmIChpZCA9PSAxIHx8IGlkID09IDIpIHtcbiAgICAgICAgYyArPSAxO1xuICAgICAgfVxuICAgICAgaWYgKGlkID09IDMpIHtcbiAgICAgICAgYyArPSAzO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYztcbn07XG5cbi8qIEdldCBncmF2aXR5IG9mIGEgdGlsZSBmcm9tIHRoZSB3ZWlnaHQgb2Ygc3Vycm91bmRpbmcgdGlsZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X3RpbGVfZ3Jhdml0eSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gY2FsY3VsYXRlIHN1cnJvdW5kaW5nIHRpbGVzXG4gIHZhciB3eCA9IDA7XG4gIHZhciB3eSA9IDA7XG4gIHZhciB4MSA9IG1heCgwLCBtaW4oeCAtIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LncpKTtcbiAgdmFyIHkxID0gbWF4KDAsIG1pbih5IC0gdGhpcy5ncmF2aXR5LnJlYWNoLCB0aGlzLmdyYXZpdHkuaCkpO1xuICB2YXIgeDIgPSBtYXgoMCwgbWluKHggKyB0aGlzLmdyYXZpdHkucmVhY2gsIHRoaXMuZ3Jhdml0eS53KSk7XG4gIHZhciB5MiA9IG1heCgwLCBtaW4oeSArIHRoaXMuZ3Jhdml0eS5yZWFjaCwgdGhpcy5ncmF2aXR5LmgpKTtcblxuICAvLyBnbyB0aHJvdWdoIHN1cnJvdW5kaW5nIHRpbGVzIHRvIGdldCBncmF2aXR5XG4gIGZvciAodmFyIHkzID0geTE7IHkzIDwgeTI7IHkzKyspIHtcbiAgICBmb3IgKHZhciB4MyA9IHgxOyB4MyA8IHgyOyB4MysrKSB7XG4gICAgICB3eCArPSAoeDMgLSB4KSAqIHRoaXMuZ3Jhdml0eS5tYXBbeTNdW3gzXVswXTtcbiAgICAgIHd5ICs9ICh5MyAtIHkpICogdGhpcy5ncmF2aXR5Lm1hcFt5M11beDNdWzBdO1xuICAgIH1cbiAgfVxuXG4gIHd4ID0gcm91bmQod3ggLyA1MDAwIC8gdGhpcy5ncmF2aXR5LnJlYWNoKSAvIDYwO1xuICB3eSA9IHJvdW5kKHd5IC8gNTAwMCAvIHRoaXMuZ3Jhdml0eS5yZWFjaCkgLyA2MDtcblxuICByZXR1cm4ge1xuICAgIHg6IHd4LFxuICAgIHk6IHd5XG4gIH07XG59O1xuXG4vKiBSZXNldCBncmF2aXR5IGZyb20gZGVzdHJ1Y3Rpb24gZXZlbnRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3Jhdml0eV9ldmVudF9yZWNhbGN1bGF0ZSA9IGZ1bmN0aW9uKHgsIHksIHJhZGl1cykge1xuICAvLyBpZiB3ZSBhcmUgbm90IHVzaW5nIGxhbmQgZ3Jhdml0eVxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlICE9PSBcImxhbmRcIikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJlY2FsY3VsYXRlIGdyYXZpdHlcbiAgdmFyIHgxID0gcm91bmQoeCAtIHJhZGl1cyk7XG4gIHZhciB5MSA9IHJvdW5kKHkgLSByYWRpdXMpO1xuICB2YXIgc2l6ZSA9IHJvdW5kKHJhZGl1cyAqIDIgKyAxKTtcbiAgdGhpcy5hY3Rpb25fZ3Jhdml0eV9nZW5lcmF0ZSh4MSwgeTEsIHNpemUsIHNpemUpO1xufTtcblxuLyogUmV0dXJuIGdyYXZpdHkgZm9yIGNvLW9yZGluYXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZ3Jhdml0eSA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgLy8gZmxhdFxuICBpZiAodGhpcy5zY2hlbWUuZ3Jhdml0eV90eXBlID09PSBcImZsYXRcIikge1xuICAgIHJldHVybiB7IHg6IDAsIHk6IHRoaXMud2VpZ2h0IH07XG4gIH1cblxuICAvLyBtYXBcbiAgaWYgKHRoaXMuc2NoZW1lLmdyYXZpdHlfdHlwZSA9PT0gXCJsYW5kXCIpIHtcbiAgICB2YXIgeDEgPSBtYXgoMCwgbWluKHJvdW5kKHggLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkudyAtIDEpKTtcbiAgICB2YXIgeTEgPSBtYXgoMCwgbWluKHJvdW5kKHkgLyB0aGlzLmdyYXZpdHkuc2NhbGUpLCB0aGlzLmdyYXZpdHkuaCAtIDEpKTtcbiAgICB2YXIgb2JqID0gdGhpcy5ncmF2aXR5Lm1hcFt5MV1beDFdO1xuICAgIHJldHVybiB7XG4gICAgICB4OiBtaW4ob2JqWzFdLCAxKSAqIHRoaXMud2VpZ2h0LFxuICAgICAgeTogbWluKG9ialsyXSwgMSkgKiB0aGlzLndlaWdodFxuICAgIH07XG4gIH1cbn07XG5cbi8qIFJldHVybiB0aGUgYW5nbGUgb2YgZ3Jhdml0eSBmb3IgY28tb3JkaW5hdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9ncmF2aXR5X2FuZ2xlID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgZ3JhdiA9IHRoaXMuZ2V0X2dyYXZpdHkoeCwgeSk7XG4gIHZhciBhMSA9IGdldF9hbmdsZShncmF2LngsIGdyYXYueSk7XG4gIHJldHVybiBhMTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0TWFwIEdyb3VuZCBDaGVja2Vyc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEdldCBhcnJheSBvZiBvZmZzZXRzIHRvIGNoZWNrIGluIGFuIGFuZ2xlcyBkaXJlY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2FuZ2xlX29mZnNldHMgPSBmdW5jdGlvbihhKSB7XG4gIGlmIChhID4gMjIgJiYgYSA8PSA2Nykge1xuICAgIHJldHVybiBbWy0xLCAtMV0sIFswLCAtMV0sIFstMSwgMF0sIFsxLCAtMV0sIFstMSwgMV0sIFsxLCAwXSwgWzAsIDFdXTtcbiAgfSAvLyB1cCBsZWZ0XG4gIGlmIChhID4gNjcgJiYgYSA8PSAxMTIpIHtcbiAgICByZXR1cm4gW1swLCAtMV0sIFstMSwgLTFdLCBbMSwgLTFdLCBbLTEsIDBdLCBbMSwgMF0sIFstMSwgMV0sIFsxLCAxXV07XG4gIH0gLy8gdXBcbiAgaWYgKGEgPiAxMTIgJiYgYSA8PSAxNTcpIHtcbiAgICByZXR1cm4gW1sxLCAtMV0sIFswLCAtMV0sIFsxLCAwXSwgWy0xLCAtMV0sIFsxLCAxXSwgWy0xLCAwXSwgWzAsIDFdXTtcbiAgfSAvLyB1cCByaWdodFxuICBpZiAoYSA+IDE1NyAmJiBhIDw9IDIwMikge1xuICAgIHJldHVybiBbWzEsIDBdLCBbMSwgLTFdLCBbMSwgMV0sIFswLCAtMV0sIFswLCAxXSwgWy0xLCAtMV0sIFstMSwgMV1dO1xuICB9IC8vIHJpZ2h0XG4gIGlmIChhID4gMjAyICYmIGEgPD0gMjQ3KSB7XG4gICAgcmV0dXJuIFtbMSwgMV0sIFsxLCAwXSwgWzAsIDFdLCBbMSwgLTFdLCBbLTEsIDFdLCBbMCwgLTFdLCBbLTEsIDBdXTtcbiAgfSAvLyBkb3duIHJpZ2h0XG4gIGlmIChhID4gMjQ3ICYmIGEgPD0gMjkyKSB7XG4gICAgcmV0dXJuIFtbMCwgMV0sIFstMSwgMV0sIFsxLCAxXSwgWy0xLCAwXSwgWzEsIDBdLCBbLTEsIC0xXSwgWzEsIC0xXV07XG4gIH0gLy8gZG93blxuICBpZiAoYSA+IDI5MiAmJiBhIDw9IDMzNykge1xuICAgIHJldHVybiBbWy0xLCAxXSwgWy0xLCAwXSwgWzAsIDFdLCBbLTEsIC0xXSwgWzEsIDFdLCBbMCwgLTFdLCBbMSwgMF1dO1xuICB9IC8vIGRvd24gbGVmdFxuICBpZiAoYSA+IDMzNyB8fCBhIDw9IDIyKSB7XG4gICAgcmV0dXJuIFtbLTEsIDBdLCBbLTEsIC0xXSwgWy0xLCAxXSwgWzAsIC0xXSwgWzAsIDFdLCBbMSwgLTFdLCBbMSwgMV1dO1xuICB9IC8vIGxlZnRcbn07XG5cbi8qIENhbGN1bGF0ZSB3YWxrIHBhdGggYnkgYW5nbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUud2FsayA9IGZ1bmN0aW9uKHgsIHksIHB4LCBweSwgYW5nbGUsIHNwZWVkKSB7XG4gIC8vIGdldCBuZWlnaGJvcmluZyBwaXhlbHNcbiAgdmFyIG9mZnNldHMgPSB0aGlzLmdldF9hbmdsZV9vZmZzZXRzKGFuZ2xlKTtcblxuICAvLyByZWNvcmQgb2xkIHBvc2l0aW9uXG4gIHZhciBveCA9IHg7XG4gIHZhciBveSA9IHk7XG5cbiAgLy8gcmVjb3JkIHJlc3VsdFxuICB2YXIgcmVzdWx0ID0ge1xuICAgIG1vdmU6IGZhbHNlLCAvLyB3ZSBhcmUgbW92aW5nXG4gICAgYW5nbGU6IDAsIC8vIGFjdHVhbCBhbmdsZSBvZiBtb3ZlbWVudFxuICAgIHBhdGg6IFtdIC8vIHJlY29yZGVkIGNvb3JkaW5hdGVzXG4gIH07XG5cbiAgLy8gZ28gdGhyb3VnaCBudW1iZXIgb2YgbW92ZW1lbnRzIHBlciBmcmFtZVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWVkOyBpKyspIHtcbiAgICB2YXIgbW92ZWQgPSBmYWxzZTtcblxuICAgIC8vIGdvIHRocm91Z2ggZGlyZWN0aW9uYWwgcGl4ZWxzIHRvIGNoZWNrIGJhc2VkIG9uIGFuZ2xlIG9mIHBhdGhcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9mZnNldHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIC8vIGNvLW9yZGluYXRlcyB3ZSdyZSBjaGVja2luZ1xuICAgICAgdmFyIHgxID0geCArIG9mZnNldHNbal1bMF07XG4gICAgICB2YXIgeTEgPSB5ICsgb2Zmc2V0c1tqXVsxXTtcblxuICAgICAgLy8gaWYgaXMgcHJldmlvdXMgbG9jYXRpb24sIGxhbmQgb3Igbm90IGFuIGVkZ2VcbiAgICAgIGlmICgoeDEgPT0gcHggJiYgeTEgPT0gcHkpIHx8ICF0aGlzLmdyb3VuZF9waXhlbCh4MSwgeTEpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBzZXQgbmV3IHBvc2l0aW9uXG4gICAgICBweCA9IHg7XG4gICAgICBweSA9IHk7XG4gICAgICB4ID0geDE7XG4gICAgICB5ID0geTE7XG4gICAgICByZXN1bHQubW92ZSA9IHRydWU7XG4gICAgICByZXN1bHQuYW5nbGUgPSBnZXRfaGVhZGluZyhveCwgb3ksIHgsIHkpO1xuICAgICAgcmVzdWx0LnBhdGgucHVzaCh7IHg6IHgxLCB5OiB5MSB9KTtcblxuICAgICAgdmFyIG1vdmVkID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIGlmIG1vdmVtZW50IGZhaWxlZFxuICAgIGlmICghbW92ZWQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCBkaXJlY3Rpb24gbGVmdCBvciByaWdodFxuICByZXN1bHQuZGlyZWN0aW9uID0gdGhpcy5ncm91bmRfZGlyKG94LCBveSwgeCwgeSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8qIENoZWNrIGEgcGl4ZWwgaXMgbmV4dCB0byBncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ3JvdW5kX3BpeGVsID0gZnVuY3Rpb24oeCwgeSkge1xuICAvLyBpZiB3ZSBoYXZlIGhpdCBncm91bmRcbiAgaWYgKHRoaXMuaSh4LCB5KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciB0cmlnZ2VyID0gZmFsc2UsXG4gICAgb2ZmID0gW1xuICAgICAgWzAsIC0xXSxcbiAgICAgIFstMSwgMF0sXG4gICAgICBbMSwgMF0sXG4gICAgICBbMCwgMV0sXG4gICAgICBbLTEsIC0xXSxcbiAgICAgIFstMSwgMV0sXG4gICAgICBbMSwgMV0sXG4gICAgICBbMSwgLTFdXG4gICAgXTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IG9mZi5sZW5ndGg7IGkrKykge1xuICAgIC8vIGdvIHRocm91Z2ggb2Zmc2V0c1xuICAgIHZhciB4MSA9IHggKyBvZmZbaV1bMF07IC8vIG5ldyB4IGNvb3JkaW5hdGVcbiAgICB2YXIgeTEgPSB5ICsgb2ZmW2ldWzFdOyAvLyBuZXcgeSBjb29yZGluYXRlXG4gICAgaWYgKHRoaXMuaSh4MSwgeTEpKSB7XG4gICAgICAvLyBpZiBwaXhlbCBpcyBsYW5kXG4gICAgICB0cmlnZ2VyID0gdHJ1ZTsgLy8gd2UgZGlkIGl0XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJpZ2dlcjtcbn07XG5cbi8qIENhbGN1bGF0ZSBsZWZ0IG9yIHJpZ2h0IG1vdmVtZW50XG5cdC8vXG5cdC8vIGNhbGN1bGF0ZXMgZGlyZWN0aW9uIG9mIGxhbmQgZnJvbSBhIGxpbmUgb2YgbW92ZW1lbnRcblx0Ly8gMS4gcm90YXRlIGxpbmUgY29vcmRzIDkwIGRlZ3JlZXNcblx0Ly8gMi4gaWYgdGhlIHRvcCBwYXJ0IG9mIHRoZSBuZXcgbGluZSBoYXMgbW9yZSBsYW5kIHRoZW4gd2UgYXJlIG1vdmluZyByaWdodFxuXHQvLyAzLiBpZiB0aGUgYm90dG9tIHBhcnQgd2UgYXJlIG1vdmluZyBsZWZ0XG5cdC8vIDQuIGJhbmFuYXMsIGFsbCBvZiBpdFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5ncm91bmRfZGlyID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcbiAgLy8gcm90YXRlIGNvLW9yZGluYXRlZCA5MCBkZWdyZWVzIHRvIHBvaW50IGludG8gdGhlIGdyb3VuZCB3ZSdyZSBvblxuICB2YXIgY2VudGVyX3ggPSB4MSArICh4MiAtIHgxKSAvIDI7XG4gIHZhciBjZW50ZXJfeSA9IHkxICsgKHkyIC0geTEpIC8gMjtcbiAgdmFyIHJvdGF0ZWRfMSA9IHJvdGF0ZV9jb29yZHMoeDEsIHkxLCBjZW50ZXJfeCwgY2VudGVyX3ksIDkwKTtcbiAgdmFyIHJvdGF0ZWRfMiA9IHJvdGF0ZV9jb29yZHMoeDIsIHkyLCBjZW50ZXJfeCwgY2VudGVyX3ksIDkwKTtcblxuICAvLyBwbG90IGEgY291cnNlIG9mIGNvLW9yZGluYXRlcyB0byBjaGVja1xuICB2YXIgc3BlZWRfeCA9IHRoaXMuZ2V0X2Rpc3RhbmNlX3gocm90YXRlZF8xLngsIHJvdGF0ZWRfMi54KTtcbiAgdmFyIHNwZWVkX3kgPSB0aGlzLmdldF9kaXN0YW5jZV95KHJvdGF0ZWRfMS55LCByb3RhdGVkXzIueSk7XG4gIHZhciBwbG90dGVkID0gcGxvdF9jb3Vyc2Uocm90YXRlZF8xLngsIHJvdGF0ZWRfMS55LCBzcGVlZF94LCBzcGVlZF95LCA4KTtcbiAgaWYgKCFwbG90dGVkLm1vdmUpIHtcbiAgICByZXR1cm4gXCJyaWdodFwiO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBjb3Vyc2UgYW5kIGNvdW50IHdoaWNoIHNpZGUgaGFzIG1vcmUgbGFuZCBvbiBpdFxuICB2YXIgY291bnRfbGVmdCA9IDAsXG4gICAgY291bnRfcmlnaHQgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBsb3R0ZWQucG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHBvaW50ID0gcGxvdHRlZC5wb2ludHNbaV07XG4gICAgaWYgKHRoaXMuaShyb3VuZChwb2ludC54KSwgcm91bmQocG9pbnQueSkpKSB7XG4gICAgICBpZiAoaSA8IHBsb3R0ZWQucG9pbnRzLmxlbmd0aCAvIDIpIHtcbiAgICAgICAgY291bnRfcmlnaHQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvdW50X2xlZnQrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvdW50X2xlZnQgPiBjb3VudF9yaWdodCA/IFwibGVmdFwiIDogXCJyaWdodFwiO1xufTtcblxuLyogU2V0IHZhbHVlcyBpbiBhIGNpcmNsZSBpbiB0aGUgZ3JvdW5kIGFycmF5XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLnNldF9jaXJjbGUgPSBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHR5cGUpIHtcbiAgLy8gZ2V0IGJvdW5kYXJpZXNcbiAgdmFyIHgxID0gbWF4KHJvdW5kKHggLSByYWRpdXMpLCAwKTtcbiAgdmFyIHgyID0gbWluKHJvdW5kKHggKyByYWRpdXMpLCB0aGlzLncgLSAxKTtcbiAgdmFyIHkxID0gbWF4KHJvdW5kKHkgLSByYWRpdXMpLCAwKTtcbiAgdmFyIHkyID0gbWluKHJvdW5kKHkgKyByYWRpdXMpLCB0aGlzLmggLSAxKTtcblxuICAvLyBsb29wIHRocm91Z2ggY28tb3JkaW5hdGVzXG4gIGZvciAodmFyIGx5ID0geTE7IGx5IDw9IHkyOyBseSsrKSB7XG4gICAgZm9yICh2YXIgbHggPSB4MTsgbHggPD0geDI7IGx4KyspIHtcbiAgICAgIGlmIChpbl9jaXJjbGUobHgsIGx5LCB4LCB5LCByYWRpdXMpKSB7XG4gICAgICAgIHRoaXMuaV9zZXQobHgsIGx5LCB0eXBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIFNldCBibG9jayBvZiBjZWxscyBmcm9tIGFyclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5zZXRfYmxvY2tfZnJvbV9hcnIgPSBmdW5jdGlvbih4LCB5LCBhcnIpIHtcbiAgZm9yICh2YXIgbHkgPSAwOyBseSA8IGFyci5sZW5ndGg7IGx5KyspIHtcbiAgICBmb3IgKHZhciBseCA9IDA7IGx4IDwgYXJyW2x5XS5sZW5ndGg7IGx4KyspIHtcbiAgICAgIHRoaXMuaV9zZXQoeCArIGx4LCB5ICsgbHksIGFycltseV1bbHhdKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIEdldCBibG9jayBvZiBjZWxsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfYmxvY2sgPSBmdW5jdGlvbih4LCB5LCB3LCBoKSB7XG4gIHZhciByZXNwb25zZSA9IFtdO1xuXG4gIC8vIGxvb3AgdGhyb3VnaCBjby1vcmRpbmF0ZXNcbiAgZm9yICh2YXIgbHkgPSAwOyBseSA8IGg7IGx5KyspIHtcbiAgICByZXNwb25zZVtseV0gPSBbXTtcbiAgICBmb3IgKHZhciBseCA9IDA7IGx4IDwgdzsgbHgrKykge1xuICAgICAgcmVzcG9uc2VbbHldW2x4XSA9IHRoaXMuaShseCArIHgsIGx5ICsgeSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufTtcblxuLyogRmluZCBuZWFyYnkgZ3JvdW5kIHNwb3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZmluZF9ncm91bmRfbmVhcmJ5ID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgeDEgPSByb3VuZCh4KTtcbiAgdmFyIHkxID0gcm91bmQoeSk7XG5cbiAgLy8gYWxyZWFkeSBvbiBncm91bmRcbiAgaWYgKHRoaXMuZ3JvdW5kX3BpeGVsKHgxLCB5MSkpIHtcbiAgICByZXR1cm4geyB4OiB4MSwgeTogeTEgfTtcbiAgfVxuXG4gIHZhciBzcGlyYWxfMSA9IDA7XG4gIHZhciBzcGlyYWxfMiA9IDE7XG4gIHZhciBpbmMgPSAxO1xuICB2YXIgZGlyID0gdHJ1ZTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IDQ1MDsgaSsrKSB7XG4gICAgeDEgKz0gZGlyID8gaW5jIDogMDtcbiAgICB5MSArPSAhZGlyID8gaW5jIDogMDtcbiAgICBzcGlyYWxfMSsrO1xuICAgIGlmIChzcGlyYWxfMSA9PSBzcGlyYWxfMikge1xuICAgICAgc3BpcmFsXzEgPSAwO1xuICAgICAgaWYgKChkaXIgPSAhZGlyKSkge1xuICAgICAgICBpbmMgPSBpbmMgPT0gMSA/IC0xIDogMTtcbiAgICAgICAgc3BpcmFsXzIrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjaGVjayBwb2ludCBmb3IgZ3JvdW5kIHBpeGVsc1xuICAgIGlmICh0aGlzLmdyb3VuZF9waXhlbCh4MSwgeTEpKSB7XG4gICAgICByZXR1cm4geyB4OiB4MSwgeTogeTEgfTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyogR2V0IHJhbmRvbSBlbXB0eSBzcG90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmFpcl9maW5kX3Nwb3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGxpbWl0ID0gNTAwO1xuICB2YXIgbiA9IDA7XG5cbiAgd2hpbGUgKG4gPCBsaW1pdCkge1xuICAgIHZhciB4ID0gcmFuZCgwLCB0aGlzLncpLFxuICAgICAgeSA9IHJhbmQoMCwgdGhpcy5oKSxcbiAgICAgIGlkID0gdGhpcy5pKHgsIHkpO1xuXG4gICAgLy8gaWYgYWlyIHBpeGVsXG4gICAgaWYgKGlkID09IDApIHtcbiAgICAgIHJldHVybiB7IHg6IHgsIHk6IHkgfTtcbiAgICB9XG5cbiAgICAvLyBjb3VudCB1cFxuICAgIG4rKztcbiAgfVxuXG4gIC8vIGZhaWxlZCB0byBmaW5kIGEgc3BvdFxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiBHZXQgcmFuZG9tIGdyb3VuZCBzcG90XG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmdyb3VuZF9maW5kX3Nwb3QgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGxpbWl0ID0gNTAwO1xuICB2YXIgbiA9IDA7XG5cbiAgd2hpbGUgKG4gPCBsaW1pdCkge1xuICAgIHZhciB4ID0gcmFuZCgwLCB0aGlzLncpLFxuICAgICAgeSA9IHJhbmQoMCwgdGhpcy5oKSxcbiAgICAgIGlkID0gdGhpcy5pKHgsIHkpO1xuXG4gICAgLy8gaWYgbm90IGxhbmQgcGl4ZWxcbiAgICBpZiAoaWQgIT09IDEgJiYgaWQgIT09IDIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIHBsb3QgY291cnNlIHRvIHJhbmRvbSBhbmdsZVxuICAgIHZhciBhbmdsZSA9IHJhbmQoMCwgMzYwKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7fVxuXG4gICAgLy8gY291bnQgdXBcbiAgICBuKys7XG4gIH1cblxuICAvLyBmYWlsZWQgdG8gZmluZCBhIHNwb3RcbiAgcmV0dXJuIGZhbHNlO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1hcFxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8vIGNyZWF0ZSBtYXAgb2JqZWN0XG5mdW5jdGlvbiBjb3JlX21hcChjYW52LCBzY2hlbWUsIGdyYXZpdHlfbWFwKSB7XG4gIC8vIFNlcnZlciBzaWRlIG9ubHlcbiAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGdsb2JhbCkge1xuICAgIHZhciBjYW52YXMgPSByZXF1aXJlKFwiY2FudmFzXCIpO1xuICB9XG5cbiAgdGhpcy5zY2hlbWUgPSBzY2hlbWU7XG5cbiAgLy8gc2V0IGRpbWVuc2lvbnNcbiAgdGhpcy53ID0gY2Fudi5jYW52LndpZHRoO1xuICB0aGlzLmggPSBjYW52LmNhbnYuaGVpZ2h0O1xuXG4gIC8vIGdldCBwaXhlbHNcbiAgdmFyIHBpeGVscyA9IGNhbnYuY29udC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xuICB2YXIgbGVuZ3RoID0gTWF0aC5mbG9vcihwaXhlbHMuZGF0YS5sZW5ndGggLyA0KTtcblxuICAvLyBjcmVhdGUgOCBiaXQgYWxwaGEgYXJyYXlcbiAgLy8gMC4gYWlyXG4gIC8vIDEuIGRlc3RydWN0aWJsZSBsYW5kXG4gIC8vIDIuIGluZGVzdHJ1Y3RpYmxlIGxhbmRcbiAgLy8gMy4gc3VuXG4gIHRoaXMuYXJyID0gbmV3IEludDhBcnJheShsZW5ndGgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHBpeGVscy5kYXRhW2kgKiA0ICsgM10gPiAzMCkge1xuICAgICAgdGhpcy5hcnJbaV0gPSAxO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNldCB1cCBncmF2aXR5XG4gIHRoaXMuaW5pdF9ncmF2aXR5KGdyYXZpdHlfbWFwKTtcbn1cblxuLyogR2V0IGFuZCBzZXQgYXJyYXkgY28tb3JkaW5hdGUgdmFsdWVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmlfZ2V0ID0gZnVuY3Rpb24oeCwgeSkge1xuICB2YXIgeDIgPSB0aGlzLmxvb3BfeCh4KTtcbiAgdmFyIHkyID0gdGhpcy5sb29wX3koeSk7XG4gIHJldHVybiB5MiAqIHRoaXMudyArIHgyO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmkgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciBpID0gdGhpcy5pX2dldCh4LCB5KTtcbiAgaWYgKGkgPT0gbnVsbCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLmFycltpXTtcbiAgfVxufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmlfc2V0ID0gZnVuY3Rpb24oeCwgeSwgdmFsKSB7XG4gIHZhciBpID0gdGhpcy5pX2dldCh4LCB5KTtcbiAgaWYgKGkpIHtcbiAgICB0aGlzLmFycltpXSA9IHZhbDtcbiAgfVxufTtcblxuLyogR2V0IGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cyBpbiBsb29waW5nIGFyZWFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2Rpc3RhbmNlID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcbiAgdmFyIHggPSB0aGlzLmdldF9kaXN0YW5jZV94KHgxLCB4Mik7XG4gIHZhciB5ID0gdGhpcy5nZXRfZGlzdGFuY2VfeSh5MSwgeTIpO1xuICByZXR1cm4gZ2V0X3NwZWVkKHgsIHkpO1xufTtcblxuY29yZV9tYXAucHJvdG90eXBlLmdldF9kaXN0YW5jZV94ID0gZnVuY3Rpb24oeDEsIHgyKSB7XG4gIHJldHVybiBuX2RpZmYoeDEsIHgyLCAwLCB0aGlzLncpO1xufTtcbmNvcmVfbWFwLnByb3RvdHlwZS5nZXRfZGlzdGFuY2VfeSA9IGZ1bmN0aW9uKHkxLCB5Mikge1xuICByZXR1cm4gbl9kaWZmKHkxLCB5MiwgMCwgdGhpcy5oKTtcbn07XG5cbi8qIEdldCBoZWFkaW5nIGJldHdlZW4gdHdvIHBvaW50cyBpbiBsb29waW5nIGFyZWFcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb3JlX21hcC5wcm90b3R5cGUuZ2V0X2hlYWRpbmcgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5Mikge1xuICB2YXIgeCA9IG5fZGlmZih4MSwgeDIsIDAsIHRoaXMudyk7XG4gIHZhciB5ID0gbl9kaWZmKHkxLCB5MiwgMCwgdGhpcy5oKTtcbiAgcmV0dXJuIGdldF9hbmdsZSh4LCB5KTtcbn07XG5cbi8qIEdldCBsb29waW5nIGNvLW9yZGluYXRlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuY29yZV9tYXAucHJvdG90eXBlLmxvb3BfeCA9IGZ1bmN0aW9uKHgpIHtcbiAgcmV0dXJuIG5fbG9vcCh4LCAwLCB0aGlzLncgLSAxKTtcbn07XG5cbmNvcmVfbWFwLnByb3RvdHlwZS5sb29wX3kgPSBmdW5jdGlvbih5KSB7XG4gIHJldHVybiBuX2xvb3AoeSwgMCwgdGhpcy5oIC0gMSk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuY29uc3QgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24pO1xuY29uc3Qgd2F0Y2ggPSAhIXVybC5zZWFyY2hQYXJhbXMuZ2V0KFwid2F0Y2hcIik7XG5cbmZ1bmN0aW9uIGFwcCgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmFzc2V0c191cmwgPSBBU1NFVFM7XG4gIHRoaXMuYXNzZXRzID0ge307XG4gIHRoaXMuc3RhcnRlZCA9IGZhbHNlO1xuICB0aGlzLndhdGNoID0gd2F0Y2g7XG4gIHRoaXMubmlja25hbWUgPSBcInRoZSB3YXRjaGVyXCI7XG5cbiAgdGhpcy5zb2NrZXRzID0gbmV3IFNvY2tldENvbm5lY3Rpb24oZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBzZWxmLnJ1bl9ldmVudChldmVudCk7XG4gIH0pO1xuICB0aGlzLmluaXRfaW50ZXJmYWNlKCk7XG5cbiAgdGhpcy5pbnB1dCA9IG5ldyBpbnB1dChmdW5jdGlvbihldmVudCkge1xuICAgIHNlbGYucnVuX2V2ZW50KGV2ZW50KTtcbiAgfSk7XG4gIHRoaXMuYXVkaW8gPSBuZXcgYXVkaW8oKTtcblxuICB0aGlzLmluaXRfc2V0dGluZ3MoKTtcblxuICBpZiAodGhpcy53YXRjaCB8fCBzaW5nbGVQbGF5ZXIpIHtcbiAgICB0aGlzLmxvYWRfcm9vbSgpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuaW5pdF9zdGFydCgpO1xuICB9XG59XG5cbi8qIExvYWQgcm9vbVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuYXBwLnByb3RvdHlwZS5sb2FkX3Jvb20gPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuc3RhcnQpIHtcbiAgICBoaWRlKHRoaXMuc3RhcnQpO1xuICB9XG4gIHNob3codGhpcy5sb2FkaW5nKTtcblxuICAvLyBsb2FkIGFzc2V0c1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIG5ldyBsb2FkZXIoXG4gICAgdGhpcy5hc3NldHNfdXJsLFxuICAgIHtcbiAgICAgIGltZzoge1xuICAgICAgICBzcHJpdGVzOiBcIi9pbWFnZXMvc3ByaXRlcy9zcHJpdGVzLnBuZ1wiLFxuICAgICAgICBiZzogXCIvaW1hZ2VzL3RleHR1cmVzL3NwYWNlLmpwZ1wiXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgYmxlZXAxOiBcIi9hdWRpby9ibGVlcDEubXAzXCIsXG4gICAgICAgIGJsb29wMTogXCIvYXVkaW8vYmxvb3AxLm1wM1wiLFxuICAgICAgICBibG9vcDI6IFwiL2F1ZGlvL2Jsb29wMi5tcDNcIixcbiAgICAgICAgYmluZzogXCIvYXVkaW8vYmluZy5tcDNcIixcbiAgICAgICAgZGlnOiBcIi9hdWRpby9kaWcubXAzXCIsXG4gICAgICAgIGRvaW5rOiBcIi9hdWRpby9kb2luay5tcDNcIixcbiAgICAgICAgZG9uazogXCIvYXVkaW8vZG9uay5tcDNcIixcbiAgICAgICAgZXhwbG9zaW9uOiBcIi9hdWRpby9leHBsb3Npb24ubXAzXCIsXG4gICAgICAgIGV4cGxvc2lvbl9nYXM6IFwiL2F1ZGlvL2V4cGxvc2lvbl9nYXMubXAzXCIsXG4gICAgICAgIGV4cGxvc2lvbl9sYXNlcjogXCIvYXVkaW8vZXhwbG9zaW9uX2xhc2VyLm1wM1wiLFxuICAgICAgICBob21pbmc6IFwiL2F1ZGlvL2hvbWluZy5tcDNcIixcbiAgICAgICAgZmx5OiBcIi9hdWRpby9mbHkubXAzXCIsXG4gICAgICAgIGNvdW50ZG93bjogXCIvYXVkaW8vY291bnRkb3duLm1wM1wiLFxuICAgICAgICBqdW1wOiBcIi9hdWRpby9qdW1wLm1wM1wiLFxuICAgICAgICBsZXZlbHVwOiBcIi9hdWRpby9sZXZlbHVwLm1wM1wiLFxuICAgICAgICBsb2NrbmxvYWQ6IFwiL2F1ZGlvL2xvY2tubG9hZC5tcDNcIixcbiAgICAgICAgcGhhc2U6IFwiL2F1ZGlvL3BoYXNlLm1wM1wiLFxuICAgICAgICBwb3A6IFwiL2F1ZGlvL3BvcC5tcDNcIixcbiAgICAgICAgcHVuY2g6IFwiL2F1ZGlvL3B1bmNoLm1wM1wiLFxuICAgICAgICBzaG9vdDogXCIvYXVkaW8vc2hvb3QubXAzXCIsXG4gICAgICAgIHNob290X2xhc2VyOiBcIi9hdWRpby9zaG9vdF9sYXNlci5tcDNcIixcbiAgICAgICAgdGhyb3c6IFwiL2F1ZGlvL3Rocm93Lm1wM1wiLFxuICAgICAgICBzcG9va3k6IFwiL2F1ZGlvL3Nwb29reS5tcDNcIixcbiAgICAgICAgd2FsazogXCIvYXVkaW8vd2Fsay5tcDNcIlxuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24oYXNzZXRzKSB7XG4gICAgICBzZWxmLmluaXRfcm9vbShhc3NldHMpO1xuICAgIH1cbiAgKTtcbn07XG5cbi8qIFN0YXJ0IHRoZSBhcHBcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9yb29tID0gZnVuY3Rpb24oYXNzZXRzKSB7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcblxuICB0aGlzLnN0YXJ0ZWQgPSB0cnVlO1xuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hdWRpby5hZGRfYnVmZmVycyhhc3NldHMuYXVkaW8pO1xuXG4gIGlmIChzaW5nbGVQbGF5ZXIpIHtcbiAgICB0aGlzLnJvb20gPSBuZXcgZGVtbyhcbiAgICAgIHRoaXMuYXNzZXRzLFxuICAgICAgdGhpcy5hc3NldHNfdXJsLFxuICAgICAgdGhpcy5hdWRpbyxcbiAgICAgIHRoaXMuaW5wdXQsXG4gICAgICBcIkRlbW8gbmFtZVwiXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnJvb20gPSBuZXcgbXVsdGlwbGF5ZXIoXG4gICAgICB0aGlzLmFzc2V0cyxcbiAgICAgIHRoaXMuYXNzZXRzX3VybCxcbiAgICAgIHRoaXMuYXVkaW8sXG4gICAgICB0aGlzLmlucHV0LFxuICAgICAgdGhpcy5uaWNrbmFtZSxcbiAgICAgIHRoaXMud2F0Y2gsXG4gICAgICB0aGlzLnJ1bl9ldmVudCxcbiAgICAgIHRoaXMuc29ja2V0cyxcbiAgICAgIG5ldyBvbmJvYXJkaW5nKClcbiAgICApO1xuICAgIGlmICh0aGlzLndhdGNoKSB7XG4gICAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwid2F0Y2hlclwiLCBbXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmlja25hbWUgPSB0aGlzLmNoZWNrX25hbWUodGhpcy5uaWNrbmFtZSk7XG4gICAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwic2VuZF9uYW1lXCIsIFt0aGlzLm5pY2tuYW1lXSk7XG4gICAgfVxuICB9XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5yb29tLmRpdik7XG59O1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gIG5ldyBhcHAoKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiAgICBFdmVudHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBFdmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoZXZlbnRbaV0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzaG93IGFuZCBoaWRlIG1lbnVcbiAgaWYgKGV2ZW50LnR5cGUgPT0gXCJzaG93X21lbnVcIikge1xuICAgIHNob3codGhpcy5tZW51KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09IFwiaGlkZV9tZW51XCIpIHtcbiAgICBoaWRlKHRoaXMubWVudSk7XG5cbiAgICAvLyBpZiBnYW1lIGlzIGZ1bGxcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZ1bGxcIikge1xuICAgIGhpZGUodGhpcy5sb2FkaW5nKTtcbiAgICBzaG93KHRoaXMuZ2FtZV9mdWxsKTtcbiAgICBpZiAodGhpcy5yb29tICYmIHRoaXMucm9vbS5jb25uZWN0aW5nKSB7XG4gICAgICBoaWRlKHRoaXMucm9vbS5jb25uZWN0aW5nKTtcbiAgICB9XG5cbiAgICAvLyBzaG93IHRoZSBjb250cm9scyBzY3JlZW5cbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09IFwic2hvd19zZXR0aW5nc1wiKSB7XG4gICAgdGhpcy50b2dnbGVfc2V0dGluZ3Nfc2NyZWVuKCk7XG5cbiAgICAvLyBzZW5kIGV2ZW50IGRvd24gYSBsZXZlbFxuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLnJvb20pIHtcbiAgICAgIHRoaXMucm9vbS5ydW5fZXZlbnQoZXZlbnQpO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEFwcCBJbnRlcmZhY2VcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5hcHAucHJvdG90eXBlLmluaXRfaW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZGl2ID0gZWxlbWVudCh7IGlkOiBcInByb2plY3RhbnRzXCIsIGNsYXNzOiBcImFwcFwiIH0pO1xuICBhcHBlbmQoZG9jdW1lbnQuYm9keSwgdGhpcy5kaXYpO1xuXG4gIC8vIGdhbWUgZnVsbFxuICB0aGlzLmdhbWVfZnVsbCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyXCIsXG4gICAgdGV4dDogXCJPaCBkZWFyLCB0aGlzIHJvb20gaXMgdmVyeSBmdWxsITxicj48YnI+PGJyPjwvZGl2PlwiXG4gIH0pO1xuICB0aGlzLmJ1dHRvbl9uZXdfZ2FtZSA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnV0dG9uIHJlZFwiLFxuICAgIHRleHQ6IFwiRmluZCBBIE5ldyBPbmVcIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWVfZnVsbCk7XG4gIGFwcGVuZCh0aGlzLmdhbWVfZnVsbCwgdGhpcy5idXR0b25fbmV3X2dhbWUpO1xuICBoaWRlKHRoaXMuZ2FtZV9mdWxsKTtcblxuICAvLyBmaW5kIG5ldyByb29tXG4gIHRoaXMuYnV0dG9uX25ld19nYW1lLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB3aW5kb3cubG9jYXRpb24gPSBcIi9cIjtcbiAgfTtcblxuICAvLyBsaW1pdCBnYW1lIGFzcGVjdCByYXRpb1xuICB2YXIgcmF0aW8gPSB0aGlzLmRpdi5vZmZzZXRXaWR0aCAvIHRoaXMuZGl2Lm9mZnNldEhlaWdodDtcbiAgdGhpcy5kaXYuc3R5bGUud2lkdGggPVxuICAgIHJhdGlvID4gMS44XG4gICAgICA/IHJvdW5kKHRoaXMuZGl2Lm9mZnNldEhlaWdodCAqIDEuOCkgKyBcInB4XCJcbiAgICAgIDogdGhpcy5kaXYub2Zmc2V0V2lkdGggKyBcInB4XCI7XG4gIHRoaXMuZGl2LnN0eWxlLmhlaWdodCA9XG4gICAgcmF0aW8gPCAxID8gdGhpcy5kaXYub2Zmc2V0V2lkdGggKyBcInB4XCIgOiB0aGlzLmRpdi5vZmZzZXRIZWlnaHQgKyBcInB4XCI7XG5cbiAgLy8gbG9hZGluZ1xuICB0aGlzLmxvYWRpbmcgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiTG9hZGluZy4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gICAgU2V0dGluZ3NcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTdGFydCBzZXR0aW5ncyBzY3JlZW5cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuaW5pdF9zZXR0aW5ncyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgLy8gY29ybmVyIGJ1dHRvblxuICB0aGlzLmljb25fc2V0dGluZ3MgPSBlbGVtZW50KHsgY2xhc3M6IFwic2V0dGluZ3NcIiB9KTtcbiAgdGhpcy5pY29uX3NldHRpbmdzX2ltZyA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiaW1nXCIsXG4gICAgc3JjOiB0aGlzLmFzc2V0c191cmwgKyBcIi9pbWFnZXMvY29nLnBuZ1wiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuaWNvbl9zZXR0aW5ncyk7XG4gIGFwcGVuZCh0aGlzLmljb25fc2V0dGluZ3MsIHRoaXMuaWNvbl9zZXR0aW5nc19pbWcpO1xuXG4gIHRoaXMuc2V0dGluZ3NfdmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLmljb25fc2V0dGluZ3NfaW1nLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBzZWxmLnRvZ2dsZV9zZXR0aW5nc19zY3JlZW4oKTtcbiAgfTtcblxuICB0aGlzLmljb25fc2V0dGluZ3NfZnVsbHNjcmVlbiA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiaW1nXCIsXG4gICAgc3JjOiB0aGlzLmFzc2V0c191cmwgKyBcIi9pbWFnZXMvZnVsbHNjcmVlbi5wbmdcIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuaWNvbl9zZXR0aW5ncywgdGhpcy5pY29uX3NldHRpbmdzX2Z1bGxzY3JlZW4pO1xuICB0aGlzLmljb25fc2V0dGluZ3NfZnVsbHNjcmVlbi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgZG9jdW1lbnQuYm9keS5yZXF1ZXN0RnVsbHNjcmVlbigpO1xuICB9O1xuXG5cblxuXG4gIC8vIGJveFxuICB0aGlzLmRpdl9zZXR0aW5ncyA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsIGZ1bGxfYmdcIiB9KTtcbiAgdGhpcy5kaXZfc2V0dGluZ3NfY29udCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyIGRpdl9jb250cm9sc1wiLFxuICAgIHRleHQ6IFwiPGRpdiBjbGFzcz0ndG9wX21lc3NhZ2UnPlNldHRpbmdzPC9kaXY+XCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfc2V0dGluZ3MpO1xuICBhcHBlbmQodGhpcy5kaXZfc2V0dGluZ3MsIHRoaXMuZGl2X3NldHRpbmdzX2NvbnQpO1xuICBoaWRlKHRoaXMuZGl2X3NldHRpbmdzKTtcblxuICAvLyB2b2x1bWVcbiAgdGhpcy5kaXZfdm9sdW1lID0gZWxlbWVudCh7IHRleHQ6IFwiPGgyPlZvbHVtZTwvaDI+XCIgfSk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lID0gZWxlbWVudCh7IHR5cGU6IFwiaW5wdXRcIiB9KTtcbiAgdGhpcy5pbnB1dF92b2x1bWUudHlwZSA9IFwicmFuZ2VcIjtcbiAgdGhpcy5pbnB1dF92b2x1bWUuc2V0QXR0cmlidXRlKFwibWluXCIsIDApO1xuICB0aGlzLmlucHV0X3ZvbHVtZS5zZXRBdHRyaWJ1dGUoXCJtYXhcIiwgMSk7XG4gIHRoaXMuaW5wdXRfdm9sdW1lLnNldEF0dHJpYnV0ZShcInN0ZXBcIiwgMC4xKTtcbiAgdGhpcy5pbnB1dF92b2x1bWUudmFsdWUgPSB0aGlzLmF1ZGlvLnZvbHVtZTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2NvbnQsIHRoaXMuZGl2X3ZvbHVtZSk7XG4gIGFwcGVuZCh0aGlzLmRpdl92b2x1bWUsIHRoaXMuaW5wdXRfdm9sdW1lKTtcblxuICB0aGlzLmlucHV0X3ZvbHVtZS5vbmNoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmF1ZGlvLnNldF9nbG9iYWxfdm9sdW1lKHRoaXMudmFsdWUpO1xuICB9O1xuXG4gIC8vIGNvbnRyb2xzXG4gIHZhciBjdGV4dCA9IFwiPGgyPkNvbnRyb2xzIChNb3VzZSArIEtleWJvYXJkKTwvaDI+XCI7XG4gIGN0ZXh0ICs9IFwiPGRsPlwiO1xuICBjdGV4dCArPSBcIjxkdD5Nb3ZlPC9kdD48ZGQ+TGVmdCBDbGljazwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0Pkp1bXA8L2R0PjxkZD5TcGFjZWJhcjwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PlNob290PC9kdD48ZGQ+UmlnaHQgQ2xpY2sgLyBBbHQgKyBMZWZ0IENsaWNrPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8ZHQ+U2VsZWN0IFdlYXBvbjwvZHQ+PGRkPjEtOSAvIFNjcm9sbCBXaGVlbDwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PkZvbGxvdyBXZWFwb25zPC9kdD48ZGQ+RjwvZGQ+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0PkZyZWUgQ2FtPC9kdD48ZGQ+TWlkZGxlIENsaWNrPC9kZD5cIjtcbiAgY3RleHQgKz0gXCI8L2RsPlwiO1xuICBjdGV4dCArPSBcIjxoMj5Db250cm9scyAoVG91Y2hzY3JlZW4pPC9oMj5cIjtcbiAgY3RleHQgKz0gXCI8ZGw+XCI7XG4gIGN0ZXh0ICs9IFwiPGR0Pk1vdmU8L2R0PjxkZD5UYXA8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5TaG9vdDwvZHQ+PGRkPkRvdWJsZSBUYXA8L2RkPlwiO1xuICBjdGV4dCArPSBcIjxkdD5KdW1wPC9kdD48ZGQ+VHdvIGZpbmdlciB0YXA8L2RkPlwiO1xuICBjdGV4dCArPSBcIjwvZGw+XCI7XG5cbiAgdGhpcy5kaXZfY29udHJvbHMgPSBlbGVtZW50KHsgdGV4dDogY3RleHQgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19jb250LCB0aGlzLmRpdl9jb250cm9scyk7XG5cbiAgLy8gY2xvc2UgYnV0dG9uXG4gIHRoaXMuZGl2X3NldHRpbmdzX2J1dHRvbnMgPSBlbGVtZW50KHsgY2xhc3M6IFwiYnV0dG9uc1wiIH0pO1xuICB0aGlzLmJ1dHRvbl9jbG9zZV9zZXR0aW5ncyA9IGVsZW1lbnQoeyB0eXBlOiBcImJ1dHRvblwiLCB0ZXh0OiBcIkNsb3NlXCIgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdl9zZXR0aW5nc19jb250LCB0aGlzLmRpdl9zZXR0aW5nc19idXR0b25zKTtcbiAgYXBwZW5kKHRoaXMuZGl2X3NldHRpbmdzX2J1dHRvbnMsIHRoaXMuYnV0dG9uX2Nsb3NlX3NldHRpbmdzKTtcblxuICB0aGlzLmJ1dHRvbl9jbG9zZV9zZXR0aW5ncy5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5zZXR0aW5nc192aXNpYmxlID0gZmFsc2U7XG4gICAgaGlkZShzZWxmLmRpdl9zZXR0aW5ncyk7XG4gIH07XG59O1xuXG5hcHAucHJvdG90eXBlLnRvZ2dsZV9zZXR0aW5nc19zY3JlZW4gPSBmdW5jdGlvbigpIHtcbiAgaWYgKCh0aGlzLnNldHRpbmdzX3Zpc2libGUgPSAhdGhpcy5zZXR0aW5nc192aXNpYmxlKSkge1xuICAgIHRoaXMuYXVkaW8ucGxheShcImJsZWVwMVwiLCAwLjgpO1xuICAgIHNob3codGhpcy5kaXZfc2V0dGluZ3MpO1xuICB9IGVsc2Uge1xuICAgIGhpZGUodGhpcy5kaXZfc2V0dGluZ3MpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgQXBwXG4gICAgU3RhcnQgU2NyZWVuXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuYXBwLnByb3RvdHlwZS5pbml0X3N0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICAvLyBnZXQgYSBuZXcgb3Igc3RvcmVkIG5pY2tuYW1lXG4gIHRoaXMubmlja25hbWUgPSBjb25maWcubmFtZXNbcmFuZCgwLCBjb25maWcubmFtZXMubGVuZ3RoIC0gMSldO1xuICBpZiAodHlwZW9mIFN0b3JhZ2UgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB2YXIgbHNuYW1lID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJwYW50c19ublwiKTtcbiAgICBpZiAoY29uZmlnLm5hbWVzLmluZGV4T2YobHNuYW1lKSA9PT0gLTEpIHtcbiAgICAgIHRoaXMubmlja25hbWUgPSBsc25hbWUgfHwgdGhpcy5uaWNrbmFtZTtcbiAgICB9XG4gIH1cblxuICB0aGlzLnN0YXJ0ID0gZWxlbWVudCh7IGNsYXNzOiBcInN0YXJ0XCIgfSk7XG4gIHZhciBsb2dvID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJpbWdcIixcbiAgICBjbGFzczogXCJsb2dvXCIsXG4gICAgc3JjOiB0aGlzLmFzc2V0c191cmwgKyBcIi9pbWFnZXMvbG9nby5wbmdcIlxuICB9KTtcbiAgdmFyIGluc3RydWN0aW9ucyA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwidWxcIixcbiAgICBjbGFzczogXCJmYWRlXCIsXG4gICAgdGV4dDpcbiAgICAgIFwiPGxpPkNvbGxlY3QgZ2VtcyB0byBnZXQgc3Ryb25nZXI8L2xpPjxsaT5EZXN0cm95IHRoZSBlbmVteSB0byBnZXQgdGhlaXIgZ2VtcyE8L2xpPjxsaT5DbGljayB0byBNb3ZlPC9saT48bGk+QWx0ICsgQ2xpY2sgb3IgUmlnaHQgQ2xpY2sgdG8gU2hvb3Q8L2xpPlwiXG4gIH0pO1xuICB0aGlzLmlucHV0X25hbWUgPSBlbGVtZW50KHtcbiAgICB0eXBlOiBcImlucHV0XCIsXG4gICAgaW50eXBlOiBcInRleHRcIixcbiAgICB2YWx1ZTogdGhpcy5uaWNrbmFtZSxcbiAgICBtYXhsZW5ndGg6IDIwXG4gIH0pO1xuICB0aGlzLmJ1dHRvbl9zdGFydCA9IGVsZW1lbnQoe1xuICAgIHR5cGU6IFwiYnV0dG9uXCIsXG4gICAgY2xhc3M6IFwiYnJlYWtcIixcbiAgICB0ZXh0OiBcIlBsYXkgTm93XCJcbiAgfSk7XG5cbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLnN0YXJ0KTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIGxvZ28pO1xuICBhcHBlbmQodGhpcy5zdGFydCwgaW5zdHJ1Y3Rpb25zKTtcbiAgYXBwZW5kKHRoaXMuc3RhcnQsIHRoaXMuaW5wdXRfbmFtZSk7XG4gIGFwcGVuZCh0aGlzLnN0YXJ0LCB0aGlzLmJ1dHRvbl9zdGFydCk7XG5cbiAgLy8gc3RhcnQgdXAgdGhlIGFwcFxuICB0aGlzLmJ1dHRvbl9zdGFydC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5sb2FkX3Jvb20oKTtcbiAgfTtcbn07XG5cbi8qIENoZWNrIG5hbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmFwcC5wcm90b3R5cGUuY2hlY2tfbmFtZSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbmV3X25hbWUgPSB0aGlzLm5pY2tuYW1lO1xuICBpZiAodGhpcy5pbnB1dF9uYW1lKSB7XG4gICAgbmV3X25hbWUgPSB0aGlzLmlucHV0X25hbWUudmFsdWU7XG4gIH1cbiAgbmV3X25hbWUgPSBuZXdfbmFtZS5sZW5ndGggPiAyMCA/IG5ld19uYW1lLnN1YnN0cmluZygwLCAyMCkgOiBuZXdfbmFtZTtcbiAgaWYgKHR5cGVvZiBTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJwYW50c19ublwiLCBuZXdfbmFtZSk7XG4gIH1cbiAgcmV0dXJuIG5ld19uYW1lO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE1pc3Npb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gZGVtbyhhc3NldHMsIGFzc2V0c191cmwsIGF1ZGlvLCBpbnB1dCwgbmFtZSkge1xuICAvLyBzZXR1cFxuICB0aGlzLmFzc2V0cyA9IGFzc2V0cztcbiAgdGhpcy5hc3NldHNfdXJsID0gYXNzZXRzX3VybDtcbiAgdGhpcy5hdWRpbyA9IGF1ZGlvO1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gIHRoaXMucGxheWVyX2lkID0gMDtcbiAgdGhpcy5wbGF5ZXJzX3JlZiA9IHtcbiAgICBcIjBcIjoge1xuICAgICAgdXNlcl9pZDogMCxcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBsZXZlbDogMFxuICAgIH1cbiAgfTtcbiAgdGhpcy5zY2hlbWUgPSBkZWVwbWVyZ2Uoc2NoZW1lcy5kZWZhdWx0LCBzY2hlbWVzLmRlYXRobWF0Y2gpO1xuICB0aGlzLmRpdiA9IGVsZW1lbnQoeyBjbGFzczogXCJmdWxsXCIgfSk7XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBuZXcgbG9hZGVyKFxuICAgIHRoaXMuYXNzZXRzX3VybCxcbiAgICB7XG4gICAgICBpbWc6IHtcbiAgICAgICAgZWRnZTogXCIvaW1hZ2VzL3Nwcml0ZXMvZWRnZS5wbmdcIixcbiAgICAgICAgZGVjb3JhdGlvbnM6IFwiL2ltYWdlcy9zcHJpdGVzL2RlY29yYXRpb25zLnBuZ1wiLFxuICAgICAgICBkaXJ0OiBcIi9pbWFnZXMvdGV4dHVyZXMvZGlydC5wbmdcIixcbiAgICAgICAgcm9jazogXCIvaW1hZ2VzL3RleHR1cmVzL3JvY2sucG5nXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIGZ1bmN0aW9uKGFzc2V0cykge1xuICAgICAgc2VsZi5sb2FkZWQoYXNzZXRzLmltZyk7XG4gICAgfVxuICApO1xufVxuXG4vKiBTdGFydCBkZW1vXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmRlbW8ucHJvdG90eXBlLmxvYWRlZCA9IGZ1bmN0aW9uKGltZykge1xuICAvLyBnZXQgdGhlIG1hcFxuICB0aGlzLm1hcCA9IG5ldyBtYXBnZW4oaW1nLCBjb25maWcubWFwZ2VuLCB0aGlzLnNjaGVtZS5tYXBnZW4pO1xuICB0aGlzLm1hcC5mZy5jb250Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwiZGVzdGluYXRpb24tb3V0XCI7XG5cbiAgLy8gc3RhcnQgdXAgZ2FtZSBvYmplY3RcbiAgdGhpcy5nYW1lID0gbmV3IGdhbWUoXG4gICAgdGhpcy5hc3NldHMsXG4gICAgdGhpcy5hdWRpbyxcbiAgICB0aGlzLmlucHV0LFxuICAgIHRoaXMuc2NoZW1lLFxuICAgIHRoaXMubWFwLFxuICAgIHRoaXMucGxheWVyc19yZWYsXG4gICAgdGhpcy5wbGF5ZXJfaWRcbiAgKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWUuZGl2KTtcblxuICB0aGlzLmdhbWUuY29yZS5jcmVhdGVfcGxheWVyKHsgaWQ6IHRoaXMucGxheWVyX2lkIH0pO1xuICB0aGlzLmdhbWUuY29yZS5jcmVhdGVfb2JqZWN0KHsgdHlwZTogXCJwbGF5ZXJcIiwgcGxheWVyX2lkOiB0aGlzLnBsYXllcl9pZCB9KTtcbiAgdGhpcy5nYW1lLmNvcmUuaW5pdF9wbGF5ZXIodGhpcy5wbGF5ZXJfaWQpO1xuXG4gIHRoaXMuZ2FtZS5zdGFydCgwKTtcbiAgdGhpcy5nYW1lLnBsYXllci5hcm1vdXJ5ID0gZHVwbGljYXRlX29iaihcbiAgICB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXS5hcm1vdXJ5XG4gICk7XG4gIHRoaXMuZ2FtZS5zZXRfYXJtb3VyeSgpO1xuXG4gIHRoaXMubG9vcF9zdGFydCgpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bHRpcGxheWVyXG4gICAgRXZlbnRzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIGV2ZW50c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZGVtby5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKCFldmVudCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGhhbmRsZSBhcnJheXMgb2YgZXZlbnRzXG4gIGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnQubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMucnVuX2V2ZW50KGV2ZW50W2ldKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gcnVuIGV2ZW50c1xuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJwbGF5ZXJfZGVhdGhcIikge1xuICAgIHRoaXMuZXZlbnRfcGxheWVyX2RlYXRoKGV2ZW50KTtcbiAgfVxuXG4gIC8vIHNlbmQgZXZlbnQgZG93biBhIGxldmVsXG4gIGVsc2UgaWYgKHRoaXMuZ2FtZSkge1xuICAgIHRoaXMuZ2FtZS5ydW5fZXZlbnQoZXZlbnQpO1xuICB9XG59O1xuXG4vKiBQbGF5ZXIgZGVhdGhcbiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5kZW1vLnByb3RvdHlwZS5ldmVudF9wbGF5ZXJfZGVhdGggPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAodGhpcy5pbml0aWFsaXNlZCkge1xuICAgIGNvbnNvbGUubG9nKFwiZGllZFwiKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bGl0cGxheWVyXG4gICAgRnJhbWVzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQvc3RvcCBsb29wXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5kZW1vLnByb3RvdHlwZS5sb29wX3N0YXJ0ID0gZnVuY3Rpb24oc3RhcnRfZnJhbWUpIHtcbiAgLy8gY2xvc2UgYW55IG9wZW4gbG9vcHNcbiAgdGhpcy5sb29wX3N0b3AoKTtcblxuICAvLyBzZXQgbG9vcCB2YXJzXG4gIHRoaXMuc3RhcnRfZnJhbWUgPSBzdGFydF9mcmFtZSB8fCAwO1xuICB0aGlzLmZyYW1lcyA9IHRoaXMuc3RhcnRfZnJhbWU7XG4gIHRoaXMuc3RhcnRfdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICB0aGlzLmRyb3BfcG9zaXRpb25zID0ge307XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5mcmFtZSgpO1xuICB9LCAyNCk7XG59O1xuXG5kZW1vLnByb3RvdHlwZS5sb29wX3N0b3AgPSBmdW5jdGlvbigpIHtcbiAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbn07XG5cbi8qIEZyYW1lIHByb2Nlc3Ncbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZGVtby5wcm90b3R5cGUuZnJhbWUgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5mcmFtZXMrKztcblxuICAvLyBkbyBkcm9wc1xuICB2YXIgY291bnRzID0gdGhpcy5vYmplY3RfY291bnRzKCk7XG4gIGZvciAodmFyIHR5cGUgaW4gdGhpcy5zY2hlbWUuZHJvcHMpIHtcbiAgICB2YXIgdGltZSA9IHRoaXMuc2NoZW1lLmRyb3BzW3R5cGVdLnRpbWU7XG4gICAgaWYgKHRpbWUgPCAxIHx8IGNvdW50c1t0eXBlXSA+PSB0aGlzLnNjaGVtZS5kcm9wc1t0eXBlXS5tYXgpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAodGhpcy5mcmFtZXMgJSB0aW1lID09PSAwKSB7XG4gICAgICB2YXIgcHJvcHMgPSB7IHR5cGU6IHR5cGUgfTtcbiAgICAgIHZhciBvYmogPSB0aGlzLmdhbWUuY29yZS5zcGF3bihwcm9wcyk7XG4gICAgICB0aGlzLmdhbWUuY3JlYXRlX29iamVjdChvYmopO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBsZXZlbCB1cHNcbiAgZm9yICh2YXIgaWQgaW4gdGhpcy5wbGF5ZXJzX3JlZikge1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNfcmVmW2lkXTtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5wbGF5ZXJzW2lkXTtcbiAgICBpZiAoIWNvcmVfcGxheWVyKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHBsYXllci5sZXZlbCAhPT0gY29yZV9wbGF5ZXIubGV2ZWwpIHtcbiAgICAgIHRoaXMucnVuX2V2ZW50KHtcbiAgICAgICAgdHlwZTogXCJwbGF5ZXJfbGV2ZWxcIixcbiAgICAgICAgaWQ6IHBhcnNlSW50KGlkKSxcbiAgICAgICAgcHJldjogcGxheWVyLmxldmVsLFxuICAgICAgICBuZXc6IGNvcmVfcGxheWVyLmxldmVsXG4gICAgICB9KTtcbiAgICAgIHRoaXMucGxheWVyc19yZWZbaWRdLmxldmVsID0gY29yZV9wbGF5ZXIubGV2ZWw7XG4gICAgfVxuICB9XG5cbiAgdmFyIGFjdGlvbiA9IHRoaXMuZ2FtZS5wbGF5ZXIgJiYgdGhpcy5nYW1lLmdldF9pbnB1dCgpO1xuICB0aGlzLmdhbWUuZnJhbWVfY29yZSh0aGlzLmZyYW1lcywgYWN0aW9uKTtcbiAgdGhpcy5ydW5fZXZlbnQodGhpcy5nYW1lLmNvcmUuc3RhdGUuZXZlbnRzKTtcbiAgdGhpcy5nYW1lLmZyYW1lX2Rpc3BsYXkoKTtcbn07XG5cbi8qIE9iamVjdCBjb3VudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmRlbW8ucHJvdG90eXBlLm9iamVjdF9jb3VudHMgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGNvdW50cyA9IHt9O1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKCFjb3VudHNbb2JqLnR5cGVdKSB7XG4gICAgICBjb3VudHNbb2JqLnR5cGVdID0gMDtcbiAgICB9XG4gICAgY291bnRzW29iai50eXBlXSsrO1xuICB9XG4gIHJldHVybiBjb3VudHM7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEFsZXJ0IE1lc3NhZ2VzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU2V0IHVwIGFsZXJ0IGRpdlxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9hbGVydCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRpdl9hbGVydCA9IGVsZW1lbnQoeyBjbGFzczogXCJhbGVydFwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X2FsZXJ0KTtcbiAgdGhpcy5hbGVydF90ZXh0ID0gXCJcIjtcbiAgdGhpcy5hbGVydF9jb3VudCA9IDA7XG59O1xuXG4vKiBTZXQgYWxlcnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9hbGVydCA9IGZ1bmN0aW9uKHRleHQsIGNvbCwgY291bnQpIHtcbiAgdGhpcy5hbGVydF9jb3VudCA9IGNvdW50IHx8IDYwO1xuICB0aGlzLmRpdl9hbGVydC5jbGFzc05hbWUgPSBcImFsZXJ0XCI7XG4gIHRoaXMuZGl2X2FsZXJ0LmlubmVySFRNTCA9IHRleHQ7XG4gIGlmIChjb2wpIHtcbiAgICBhZGRfY2xhc3ModGhpcy5kaXZfYWxlcnQsIGNvbCk7XG4gIH1cbiAgc2hvdyh0aGlzLmRpdl9hbGVydCk7XG59O1xuXG4vKiBSdW4gYWxlcnRcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9hbGVydCA9IGZ1bmN0aW9uKCkge1xuICAvLyBkbyBjb3VudGRvd25zXG4gIGlmICh0aGlzLmFsZXJ0X2NvdW50ID4gMCkge1xuICAgIHRoaXMuYWxlcnRfY291bnQtLTtcbiAgICBpZiAodGhpcy5hbGVydF9jb3VudCA9PSAwKSB7XG4gICAgICB0aGlzLmRpdl9hbGVydC5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgaGlkZSh0aGlzLmRpdl9hbGVydCk7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEFybW91cnlcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBCdWlsZCBhcm1vdXJ5IGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9hcm1vdXJ5ID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNlbGVjdGVkIHdlYXBvblxuICB0aGlzLmN1cnJlbnRfd2VhcG9uID0gXCJcIjtcblxuICAvLyBkZXRvbmF0aW9uIGNvb2xkb3duXG4gIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA9IDA7XG5cbiAgLy8gY3JlYXRlIGRpdnNcbiAgdGhpcy5hcm1vdXJ5ID0ge1xuICAgIGRpdjogZWxlbWVudCh7IGNsYXNzOiBcImFybW91cnkgYm94XCIgfSksXG4gICAgdGl0bGU6IGVsZW1lbnQoeyBjbGFzczogXCJ0aXRsZVwiIH0pLFxuICAgIHBsYXllcjogZWxlbWVudCh7IGNsYXNzOiBcInBsYXllcl93ZWFwb24gaGV4LWJ1dHRvblwiIH0pLFxuICAgIHdlYXBvbnM6IHt9LFxuICAgIHNob3dfaWNvbjogZmFsc2UsXG4gICAgc2hvd19pY29uX2ZyYW1lOiBudWxsXG4gIH07XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5hcm1vdXJ5LmRpdik7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5hcm1vdXJ5LnBsYXllcik7XG4gIGhpZGUodGhpcy5hcm1vdXJ5LnBsYXllcik7XG5cbiAgLy8gZ28gdGhyb3VnaCBhcm1vdXJ5IGxheW91dFxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGg7IGkrKykge1xuICAgIHZhciB0eXBlID0gdGhpcy5zY2hlbWUuYXJtb3VyeVtpXTtcblxuICAgIC8vIGNyZWF0ZSBlbGVtZW50c1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdID0ge1xuICAgICAgYm94OiBlbGVtZW50KHsgY2xhc3M6IFwiaGV4LWJ1dHRvbiB3ZWFwb25cIiwgZGF0YTogdHlwZSB9KSxcbiAgICAgIHNwcml0ZTogZWxlbWVudCh7IGNsYXNzOiBcInNwcml0ZVwiIH0pLFxuICAgICAgY291bnQ6IGVsZW1lbnQoeyBjbGFzczogXCJjb3VudFwiIH0pLFxuICAgICAgcGxheWVyX2ljb246IGVsZW1lbnQoeyBjbGFzczogXCJpY29uIHNwcml0ZVwiIH0pLFxuICAgICAgaTogaSxcbiAgICAgIGFjdGl2ZTogZmFsc2VcbiAgICB9O1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkuZGl2LCB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gpO1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gsIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnNwcml0ZSk7XG4gICAgYXBwZW5kKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCwgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uY291bnQpO1xuICAgIGFwcGVuZCh0aGlzLmFybW91cnkucGxheWVyLCB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5wbGF5ZXJfaWNvbik7XG4gICAgaGlkZSh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5wbGF5ZXJfaWNvbik7XG5cbiAgICAvLyBzZXQgc3ByaXRlIGJhY2tncm91bmQgcG9zaXRpb25cbiAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbdHlwZV07XG4gICAgdmFyIHNwcml0ZSA9IHRoaXMuYy5zcHJpdGVzW3dlYXBvbi5hcm1vdXJ5X3Nwcml0ZV07XG4gICAgaWYgKCFzcHJpdGUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB2YXIgb2Zmc2V0ID0gY2VpbCgoc3ByaXRlLnNpemUgLSA0OCkgLyAyKTtcbiAgICB2YXIgeCA9IC1zcHJpdGUueCAtIG9mZnNldDtcbiAgICB2YXIgeSA9IC1zcHJpdGUueSAtIG9mZnNldDtcbiAgICB2YXIgcG9zID0geCAtIDEgKyBcInB4IFwiICsgeSArIFwicHgsIDAgMFwiO1xuICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnNwcml0ZS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb24gPSBwb3M7XG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0ucGxheWVyX2ljb24uc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gcG9zO1xuXG4gICAgLy8gc2V0IGVsZW1lbnQgZXZlbnRzXG4gICAgdGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94Lm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYud2VhcG9uX3NlbGVjdCh0aGlzLmRhdGFzZXQuZGF0YSk7XG4gICAgfTtcbiAgfVxuXG4gIGFwcGVuZCh0aGlzLmFybW91cnkuZGl2LCB0aGlzLmFybW91cnkudGl0bGUpO1xuICBoaWRlKHRoaXMuYXJtb3VyeS5kaXYpO1xufTtcblxuLyogSW5pdGlhbGlzZSBhcm1vdXJ5IHdpdGggY29yZSBkYXRhXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgLy8gc2V0IGRpc3BsYXkgZm9yIGFsbCB3ZWFwb25zXG4gIGZvciAodHlwZSBpbiB0aGlzLmFybW91cnkud2VhcG9ucykge1xuICAgIHRoaXMuc2V0X3dlYXBvbih0eXBlKTtcbiAgfVxuXG4gIC8vIHNlbGVjdCB3ZWFwb25cbiAgaWYgKFxuICAgICF0aGlzLmN1cnJlbnRfd2VhcG9uIHx8XG4gICAgIXRoaXMuYXJtb3VyeS53ZWFwb25zW3RoaXMuY3VycmVudF93ZWFwb25dLmFjdGl2ZVxuICApIHtcbiAgICB0aGlzLndlYXBvbl9zZWxlY3RfbigwKTtcbiAgfVxufTtcblxuLyogU2VsZWN0IHdlYXBvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLndlYXBvbl9zZWxlY3QgPSBmdW5jdGlvbih0eXBlLCBub19oaWdobGlnaHQpIHtcbiAgLy8gaWYgc2FtZSB3ZWFwb24gb3Igbm9uZSBsZWZ0XG4gIGlmIChcbiAgICAhdGhpcy5wbGF5ZXIgfHxcbiAgICB0aGlzLmN1cnJlbnRfd2VhcG9uID09PSB0eXBlIHx8XG4gICAgdGhpcy5wbGF5ZXIuYXJtb3VyeVt0eXBlXSA9PT0gMFxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBkbyB0aGUgY2hhbmdlXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmFybW91cnkud2VhcG9ucykge1xuICAgIHJlbW92ZV9jbGFzcyh0aGlzLmFybW91cnkud2VhcG9uc1trZXldLmJveCwgXCJzZWxlY3RlZFwiKTtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS53ZWFwb25zW2tleV0ucGxheWVyX2ljb24pO1xuICB9XG4gIGFkZF9jbGFzcyh0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5ib3gsIFwic2VsZWN0ZWRcIik7XG4gIHRoaXMuY3VycmVudF93ZWFwb24gPSB0eXBlO1xuICB0aGlzLmFybW91cnkudGl0bGUuaW5uZXJIVE1MID0gdGhpcy5jLndlYXBvbnNbdHlwZV0udGl0bGU7XG5cbiAgLy8gYXV0byBmb2xsb3dpbmcgd2VhcG9uXG4gIHZhciB3ZXAgPSB0aGlzLmMud2VhcG9uc1t0eXBlXTtcbiAgaWYgKFxuICAgICh3ZXAuYXV0b19mb2xsb3cgJiYgIXRoaXMud2VhcG9uX2ZvbGxvdykgfHxcbiAgICAoIXdlcC5hdXRvX2ZvbGxvdyAmJiB0aGlzLndlYXBvbl9mb2xsb3cpXG4gICkge1xuICAgIHRoaXMudG9nZ2xlX3dlYXBvbl9mb2xsb3coKTtcbiAgfVxuXG4gIGlmICghbm9faGlnaGxpZ2h0KSB7XG4gICAgLy8gcGxheSBub2lzZVxuICAgIHRoaXMuYXVkaW8ucGxheShcImJsZWVwMVwiLCAwLjgpO1xuXG4gICAgLy8gc2hvdyBpY29uXG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbiA9IHRydWU7XG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbl9mcmFtZSA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICBzaG93KHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLnBsYXllcl9pY29uKTtcbiAgICBzaG93KHRoaXMuYXJtb3VyeS5wbGF5ZXIpO1xuICB9XG5cbiAgcmV0dXJuIHR5cGU7XG59O1xuXG4vKiBTZWxlY3Qgd2VhcG9uIGJ5IHBvc2l0aW9uIGluIGFybW91cnlcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS53ZWFwb25fc2VsZWN0X24gPSBmdW5jdGlvbihuKSB7XG4gIC8vIGlmIGlzIHRvbyBiaWdcbiAgaWYgKG4gPj0gdGhpcy5zY2hlbWUuYXJtb3VyeS5sZW5ndGgpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBnbyB0aHJvdWdoIGNvbHVtbnNcbiAgdmFyIG4yID0gMDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjaGVtZS5hcm1vdXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuc2NoZW1lLmFybW91cnlbaV07XG4gICAgdmFyIGFjdGl2ZSA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmFybW91cnkud2VhcG9uc1t3ZWFwb25dLmFjdGl2ZSkge1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgIGlmIChuMiA9PT0gbiAmJiB3ZWFwb24gIT09IHRoaXMuY3VycmVudF93ZWFwb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2VhcG9uX3NlbGVjdCh3ZWFwb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGluY3JlYXNlIGNvdW50IG9mIGFjdHVhbCBjb2x1bW5zXG4gICAgbjIgPSBhY3RpdmUgPyBuMiArIDEgOiBuMjtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8qIFNlbGVjdCB3ZWFwb24gYnkgc2Nyb2xsaW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUud2VhcG9uX3Njcm9sbCA9IGZ1bmN0aW9uKGRvd24pIHtcbiAgLy8gaWYgd2UgZG9uJ3QgaGF2ZSBhIHNlbGVjdGVkIHdlYXBvblxuICB2YXIgY3VycmVudCA9IHRoaXMuYXJtb3VyeS53ZWFwb25zW3RoaXMuY3VycmVudF93ZWFwb25dO1xuICBpZiAoIWN1cnJlbnQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaV9kb3duID0gZG93biA/IHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoIC0gaSA6IGk7XG4gICAgdmFyIG5ld19pID0gbl9sb29wKGN1cnJlbnQuaSArIGlfZG93biwgLTEsIHRoaXMuc2NoZW1lLmFybW91cnkubGVuZ3RoIC0gMSk7XG4gICAgdmFyIHdlYXBvbiA9IHRoaXMuc2NoZW1lLmFybW91cnlbbmV3X2ldO1xuICAgIGlmICh0aGlzLmFybW91cnkud2VhcG9uc1t3ZWFwb25dLmFjdGl2ZSkge1xuICAgICAgdGhpcy53ZWFwb25fc2VsZWN0KHdlYXBvbik7XG4gICAgICByZXR1cm4gd2VhcG9uO1xuICAgIH1cbiAgfVxufTtcblxuLyogQ2hhbmdlIHRvIHdlYXBvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF93ZWFwb24gPSBmdW5jdGlvbih0eXBlKSB7XG4gIGlmICghdGhpcy5wbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY291bnQgPSB0aGlzLnBsYXllci5hcm1vdXJ5W3R5cGVdO1xuICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5jb3VudC5pbm5lckhUTUwgPSBjb3VudDtcblxuICBpZiAoY291bnQgPT0gLTEpIHtcbiAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5hY3RpdmUgPSB0cnVlO1xuICAgIHNob3codGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94KTtcbiAgICBoaWRlKHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmNvdW50KTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoY291bnQgPCAxKSB7XG4gICAgICB0aGlzLmFybW91cnkud2VhcG9uc1t0eXBlXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgIGhpZGUodGhpcy5hcm1vdXJ5LndlYXBvbnNbdHlwZV0uYm94KTtcbiAgICAgIGlmICh0eXBlID09IHRoaXMuY3VycmVudF93ZWFwb24pIHtcbiAgICAgICAgdGhpcy53ZWFwb25fc2VsZWN0X24oMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmFjdGl2ZSA9IHRydWU7XG4gICAgICBzaG93KHRoaXMuYXJtb3VyeS53ZWFwb25zW3R5cGVdLmJveCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCF0aGlzLmN1cnJlbnRfd2VhcG9uKSB7XG4gICAgdGhpcy53ZWFwb25fc2VsZWN0X24oMCk7XG4gIH1cbiAgdGhpcy5kaXNwbGF5X2FybW91cnkoKTtcbn07XG5cbi8qIFNob3cgYXJtb3VyeSBvciBub3Rcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kaXNwbGF5X2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNob3dfaXQgPSBmYWxzZTtcbiAgdmFyIGV2ZW4gPSBmYWxzZTtcbiAgaWYgKHRoaXMucGxheWVyKSB7XG4gICAgZm9yIChrZXkgaW4gdGhpcy5wbGF5ZXIuYXJtb3VyeSkge1xuICAgICAgaWYgKHRoaXMucGxheWVyLmFybW91cnlba2V5XSA+IDAgfHwgdGhpcy5wbGF5ZXIuYXJtb3VyeVtrZXldID09IC0xKSB7XG4gICAgICAgIHNob3dfaXQgPSB0cnVlO1xuICAgICAgICBldmVuID0gIWV2ZW47XG4gICAgICB9XG4gICAgICB0aGlzLmFybW91cnkud2VhcG9uc1trZXldLmJveC5zdHlsZS5tYXJnaW5Ub3AgPSBldmVuID8gXCIyNnB4XCIgOiBcIjBweFwiO1xuICAgIH1cbiAgfVxuICBpZiAoc2hvd19pdCkge1xuICAgIHNob3codGhpcy5hcm1vdXJ5LmRpdik7XG4gIH0gZWxzZSB7XG4gICAgaGlkZSh0aGlzLmFybW91cnkuZGl2KTtcbiAgfVxufTtcblxuLyogUnVuIGV2ZXJ5IGZyYW1lXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2FybW91cnkgPSBmdW5jdGlvbigpIHtcbiAgLy8gdHVybiBvZmYgaWNvblxuICBpZiAoXG4gICAgdGhpcy5hcm1vdXJ5LnNob3dfaWNvbiAmJlxuICAgIHRoaXMuY29yZS5zdGF0ZS5mcmFtZSA+IHRoaXMuYXJtb3VyeS5zaG93X2ljb25fZnJhbWUgKyAzMFxuICApIHtcbiAgICB0aGlzLmFybW91cnkuc2hvd19pY29uID0gZmFsc2U7XG4gICAgaGlkZSh0aGlzLmFybW91cnkucGxheWVyKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBBdWRpb1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBhdWRpbyBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2F1ZGlvID0gZnVuY3Rpb24oKSB7XG4gIC8vIG9iamVjdHMgd2l0aCByZXBlYXRpbmcgc291bmRzXG4gIHRoaXMuYXVkaW9fb2JqcyA9IHt9O1xuXG4gIC8vIHdlYXBvbiBsb29wc1xuICB0aGlzLmF1ZGlvX3dlYXBvbnMgPSB7fTtcblxuICAvLyBzZXQgdXAgcG93ZXIgdXAgc291bmRcbiAgdGhpcy5wb3dlcl91cF9hdWRpb19vbiA9IGZhbHNlO1xufTtcblxuLyogQ2hlY2sgYWxsIGdhbWUgb2JqZWN0cyB3aXRoIGF1ZGlvIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9hdWRpbyA9IGZ1bmN0aW9uKCkge1xuICAvLyByZW1vdmUgb2xkIGF1ZGlvIG9iamVjdHNcbiAgZm9yIChrZXkgaW4gdGhpcy5hdWRpb19vYmpzKSB7XG4gICAgaWYgKCF0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldKSB7XG4gICAgICBpZiAodGhpcy5hdWRpb19vYmpzW2tleV0pIHtcbiAgICAgICAgdGhpcy5hdWRpb19vYmpzW2tleV0uZ2Fpbi5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRoaXMuYXVkaW9fb2Jqc1trZXldID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBvYmplY3RzXG4gIGZvciAoa2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG5cbiAgICAvLyB3aGF0IG5vaXNlIHNob3VsZCBiZSBwbGF5aW5nXG4gICAgdmFyIGF1ZGlvX2tleSA9IG51bGw7XG4gICAgaWYgKG9iai5ncm91bmRlZCAmJiBvYmouYW5pbWF0ZSAmJiBvYmouYWN0aW9uZWQpIHtcbiAgICAgIGF1ZGlvX2tleSA9IG9iai5jLmF1ZGlvLndhbGs7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF1ZGlvX2tleSA9IG9iai5jLmF1ZGlvLmFpcjtcbiAgICB9XG5cbiAgICB2YXIgdm9sdW1lID0gdGhpcy5nZXRfZGlzdF92b2x1bWUob2JqLngsIG9iai55KTtcbiAgICB2YXIgYXVkaW9fb2JqID0gdGhpcy5hdWRpb19vYmpzW2tleV07XG5cbiAgICAvLyBpZiB0aGVyZSBpcyBhbiBhdWRpbyBmaWxlIHBsYXlpbmdcbiAgICBpZiAoYXVkaW9fb2JqKSB7XG4gICAgICAvLyBjaGFuZ2UgaXRzIHZvbHVtZVxuICAgICAgdGhpcy5hdWRpby5zZXRfdm9sdW1lKGF1ZGlvX29iaiwgdm9sdW1lKTtcblxuICAgICAgLy8gZGlzY29ubmVjdCBpdFxuICAgICAgaWYgKHZvbHVtZSA8PSAwIHx8IGF1ZGlvX29iai5hdWRpb19rZXkgIT0gYXVkaW9fa2V5IHx8ICFhdWRpb19rZXkpIHtcbiAgICAgICAgYXVkaW9fb2JqLmdhaW4uZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLmF1ZGlvX29ianNba2V5XSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRoZXJlIGlzIG5vdCBhbiBhdWRpbyBmaWxlIHBsYXlpbmdcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGF1ZGlvX2tleSkge1xuICAgICAgICB0aGlzLmF1ZGlvX29ianNba2V5XSA9IHRoaXMuYXVkaW8ucGxheShhdWRpb19rZXksIHZvbHVtZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKiBTZXQgYSB3ZWFwb24gc2hvdCBzb3VuZCBlZmZlY3RcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnBsYXlfd2VhcG9uX2F1ZGlvID0gZnVuY3Rpb24ocHJvcHMpIHtcbiAgdmFyIHdlYXBvbiA9IHRoaXMuYy53ZWFwb25zW3Byb3BzLndlYXBvbl07XG4gIGlmICghd2VhcG9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghdGhpcy5hdWRpby5idWZmZXJzW3dlYXBvbi5maXJlX2F1ZGlvXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCB2b2x1bWVcbiAgdmFyIHZvbHVtZSA9IHRoaXMuZ2V0X2Rpc3Rfdm9sdW1lKHByb3BzLngsIHByb3BzLnkpO1xuICB0aGlzLmF1ZGlvLnBsYXkod2VhcG9uLmZpcmVfYXVkaW8sIHZvbHVtZSk7XG59O1xuXG4vKiBHZXQgZGlzdGFuY2Ugdm9sdW1lXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5nZXRfZGlzdF92b2x1bWUgPSBmdW5jdGlvbih4LCB5KSB7XG4gIHZhciBkaXN0YW5jZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlKHgsIHksIHRoaXMuY2FtZXJhLngsIHRoaXMuY2FtZXJhLnkpO1xuICB2YXIgdm9sdW1lID0gKDEyMDAgLSBkaXN0YW5jZSkgLyAxMjAwO1xuICB2b2x1bWUgKj0gdm9sdW1lO1xuICByZXR1cm4gdm9sdW1lO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBDcm9zc2hhaXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgY3Jvc3NoYWlyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9jcm9zc2hhaXIgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jcm9zc2hhaXIgPSAwO1xuICB0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPSBcImJ1dHRvblwiO1xufTtcblxuLyogQ2FsY3VsYXRlIGNyb3NzaGFpciBmcm9tIGN1cnNvciBwb3NpdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9jcm9zc2hhaXIgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLnBsYXllciB8fCB0aGlzLnBsYXllci5kZWFkIHx8ICF0aGlzLnBsYXllcl9vYmopIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW3RoaXMucGxheWVyX29iai5rZXldO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuY3Jvc3NoYWlyID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhcbiAgICBvYmoueCxcbiAgICBvYmoueSxcbiAgICB0aGlzLmN1cnNvci54LFxuICAgIHRoaXMuY3Vyc29yLnlcbiAgKTtcblxuICAvLyAvLyBjYWxjdWxhdGUgZnJvbSBjdXJzb3JcbiAgLy8gaWYgKHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9PSBcImN1cnNvclwiKSB7XG4gIC8vIFx0dGhpcy5jcm9zc2hhaXIgPSB0aGlzLmNvcmUubWFwLmdldF9oZWFkaW5nKG9iai54LCBvYmoueSwgdGhpcy5jdXJzb3IueCwgdGhpcy5jdXJzb3IueSk7XG5cbiAgLy8gLy8gY2FsY3VsYXRlIGZyb20gYnV0dG9uc1xuICAvLyB9IGVsc2VcbiAgLy8gaWYgKHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9PSBcImJ1dHRvblwiKSB7XG5cbiAgLy8gXHQvLyBjYWxjdWxhdGUgYW5nbGUgb2YgY3Jvc3NoYWlyXG4gIC8vIFx0dmFyIGFuZ2xlID0gLTE7XG4gIC8vIFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3VwKSB7XG4gIC8vIFx0XHRhbmdsZSA9IDkwO1xuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3JpZ2h0KSB7IGFuZ2xlID0gMTM1OyB9XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfbGVmdCkgeyBhbmdsZSA9IDQ1OyB9XG4gIC8vIFx0fSBlbHNlXG4gIC8vIFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX2Rvd24pIHtcbiAgLy8gXHRcdGFuZ2xlID0gMjcwO1xuICAvLyBcdFx0aWYgKHRoaXMuaW5wdXQuYWN0aW9ucy5tb3ZlX3JpZ2h0KSB7IGFuZ2xlID0gMjI1OyB9XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfbGVmdCkgeyBhbmdsZSA9IDMwNTsgfVxuICAvLyBcdH0gZWxzZSB7XG4gIC8vIFx0XHRpZiAodGhpcy5pbnB1dC5hY3Rpb25zLm1vdmVfcmlnaHQpIHsgYW5nbGUgPSAxODA7IH1cbiAgLy8gXHRcdGlmICh0aGlzLmlucHV0LmFjdGlvbnMubW92ZV9sZWZ0KSB7IGFuZ2xlID0gMDsgfVxuICAvLyBcdH1cbiAgLy8gXHRpZiAoYW5nbGUgIT09IC0xKSB7XG4gIC8vIFx0XHR0aGlzLmNyb3NzaGFpciA9IGluY3JlbWVudF9hbmdsZSh0aGlzLmNyb3NzaGFpciwgYW5nbGUsIDQpO1xuICAvLyBcdH1cbiAgLy8gfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBEZWNvcmF0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIENyZWF0ZSBkZWNvcmF0aW9uXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfZGVjb3JhdGlvbiA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gIHZhciBvYmogPSB7XG4gICAgZnJhbWU6IHRoaXMuY29yZS5zdGF0ZS5mcmFtZSxcbiAgICB0eXBlOiBcIlwiLFxuICAgIGlkOiBcIlwiLFxuICAgIHg6IDAsXG4gICAgeTogMCxcbiAgICBzcGVlZF94OiAwLFxuICAgIHNwZWVkX3k6IDAsXG4gICAgdGltZW91dDogMCxcbiAgICBhbmdsZTogMCxcbiAgICByZXBlYXQ6IHRydWUsXG4gICAgc3ByaXRlOiBcIlwiXG4gIH07XG4gIG9iaiA9IGRlZXBtZXJnZShvYmosIHByb3BzKTtcbiAgb2JqLmtleSA9XG4gICAgb2JqLmZyYW1lICsgXCItXCIgKyBvYmoueCArIFwiLVwiICsgb2JqLnkgKyBcIi1cIiArIG9iai5zcHJpdGUgKyBcIi1cIiArIG9iai5pZDtcbiAgdGhpcy5kZWNvcmF0aW9uc1tvYmoua2V5XSA9IG9iajtcbn07XG5cbi8qIFJ1biBkZWNvcmF0aW9uc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2RlY29yYXRpb25zID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNyZWF0ZSB0cmFpbHMgZnJvbSBvYmplY3RzXG4gIGZvciAoa2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgaWYgKG9iai5jLnRyYWlscy5jb3VudCA9PT0gMCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlX3RyYWlsKG9iaiwgb2JqLmMudHJhaWxzKTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggYWxsIGRlY29yYXRpb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmRlY29yYXRpb25zKSB7XG4gICAgdmFyIGRlYyA9IHRoaXMuZGVjb3JhdGlvbnNba2V5XTtcblxuICAgIC8vIGRvIHRpbWVvdXRcbiAgICBkZWMudGltZW91dC0tO1xuICAgIGlmIChkZWMudGltZW91dCA8IDEpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmRlY29yYXRpb25zW2tleV07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBtb3ZlXG4gICAgZGVjLnggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChkZWMueCArIGRlYy5zcGVlZF94KS5maXhlZCgpO1xuICAgIGRlYy55ID0gdGhpcy5jb3JlLm1hcC5sb29wX3koZGVjLnkgKyBkZWMuc3BlZWRfeSkuZml4ZWQoKTtcbiAgfVxufTtcblxuLyogQ3JlYXRlIHRyYWlsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV90cmFpbCA9IGZ1bmN0aW9uKG9iaiwgdHJhaWxzKSB7XG4gIC8vIGNyZWF0ZSB0aGUgdHJhaWxzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhaWxzLmNvdW50OyBpKyspIHtcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgIGlkOiBpLFxuICAgICAgc3ByaXRlOiB0cmFpbHMuc3ByaXRlLFxuICAgICAgdGltZW91dDogdHJhaWxzLnRpbWVvdXQsXG4gICAgICB4OiBvYmouZHgsXG4gICAgICB5OiBvYmouZHlcbiAgICB9O1xuICAgIGlmICh0cmFpbHMucm90YXRlKSB7XG4gICAgICBhcmdzLmFuZ2xlID0gcmFuZCgwLCAzNjApO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcmdzLmFuZ2xlID0gYW5nbGVfYWRkKGdldF9hbmdsZSgtb2JqLnNwZWVkX3gsIC1vYmouc3BlZWRfeSksIDkwKTtcbiAgICAgIGFyZ3MueCAtPSBvYmouc3BlZWRfeDtcbiAgICAgIGFyZ3MueSAtPSBvYmouc3BlZWRfeTtcbiAgICAgIGlmICh0cmFpbHMub2Zmc2V0X3ggfHwgdHJhaWxzLm9mZnNldF95KSB7XG4gICAgICAgIHZhciB4eXggPSB4eV9zcGVlZChhbmdsZV9hZGQoYXJncy5hbmdsZSwgOTApLCB0cmFpbHMub2Zmc2V0X3gpO1xuICAgICAgICB2YXIgeHl5ID0geHlfc3BlZWQoYW5nbGVfYWRkKGFyZ3MuYW5nbGUsIDE4MCksIHRyYWlscy5vZmZzZXRfeSk7XG4gICAgICAgIGFyZ3MueCArPSB4eXgueCArIHh5eS54O1xuICAgICAgICBhcmdzLnkgKz0geHl4LnkgKyB4eXkueTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRyYWlscy5tb3ZlKSB7XG4gICAgICB2YXIgbW92ZV9hbmdsZSA9IHJhbmQoMCwgMzYwKTtcbiAgICAgIHZhciB4eSA9IHh5X3NwZWVkKG1vdmVfYW5nbGUsIHRyYWlscy5zcGVlZCk7XG4gICAgICBhcmdzLnNwZWVkX3ggPSAteHkueDtcbiAgICAgIGFyZ3Muc3BlZWRfeSA9IC14eS55O1xuICAgIH1cbiAgICB0aGlzLmNyZWF0ZV9kZWNvcmF0aW9uKGFyZ3MpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudHMgPSBmdW5jdGlvbihldmVudHMpIHtcbiAgLy8gZXZlbnRzIGZyb20gc2NoZW1lXG4gIHZhciBmX2V2ZW50ID0gdGhpcy5zY2hlbWUuZXZlbnRzLmZyYW1lW3RoaXMuY29yZS5jdXJyZW50X2ZyYW1lXTtcbiAgaWYgKGZfZXZlbnQpIHtcbiAgICB0aGlzLnJ1bl9ldmVudChmX2V2ZW50KTtcbiAgfVxufTtcblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gaGFuZGxlIGFycmF5IG9mIGV2ZW50c1xuICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnJ1bl9ldmVudChldmVudFtpXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIGV2ZW50XG4gIGlmIChldmVudC50eXBlID09PSBcIndlYXBvbl9zZWxlY3RcIikge1xuICAgIHRoaXMud2VhcG9uX3NlbGVjdF9uKGV2ZW50Lm4pO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwid2VhcG9uX3Njcm9sbFwiKSB7XG4gICAgdGhpcy53ZWFwb25fc2Nyb2xsKGV2ZW50LmRvd24pO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwic3dpdGNoX3dhdGNoZXJfY2FtZXJhXCIpIHtcbiAgICB0aGlzLnN3aXRjaF93YXRjaGVyX2NhbWVyYSgpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZm9sbG93X3dlYXBvblwiKSB7XG4gICAgdGhpcy50b2dnbGVfd2VhcG9uX2ZvbGxvdyh0cnVlKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZvbGxvd19tb3VzZVwiKSB7XG4gICAgdGhpcy50b2dnbGVfbW91c2VfZm9sbG93KCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJncm91bmRfZGFtYWdlXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9ncm91bmRfZGFtYWdlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInNjcmVlbl9zaGFrZVwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc2NyZWVuX3NoYWtlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9oZWFsdGhcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3BsYXllcl9oZWFsdGgoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2xldmVsXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9wbGF5ZXJfbGV2ZWwoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZXhwbG9zaW9uXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9leHBsb3Npb24oZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiYXJtb3VyeVwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfYXJtb3VyeShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJib3VuY2VcIikge1xuICAgIHRoaXMucnVuX2V2ZW50X2JvdW5jZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJzb3VuZFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwidGFyZ2V0XCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF90YXJnZXQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwic3Bhd25cIikge1xuICAgIHRoaXMucnVuX2V2ZW50X3NwYXduKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImZvY3VzXCIpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9mb2N1cyhldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJhbGVydFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfYWxlcnQoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiY29sbGVjdFwiKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfY29sbGVjdChldmVudCk7XG4gIH1cbn07XG5cbi8qIEdyb3VuZCBEYW1hZ2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9ncm91bmRfZGFtYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gYXJlIHdlIGRlc3Ryb3lpbmcgbGFuZFxuICBpZiAoIXRoaXMuc2NoZW1lLmRlc3Ryb3lfbGFuZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGRhbWFnZSB0aGUgZ3JvdW5kXG4gIHRoaXMuY29yZS5tYXAuc2V0X2NpcmNsZShldmVudC54LCBldmVudC55LCBldmVudC5yYWRpdXMsIDApO1xuICB0aGlzLmRlc3Ryb3lfbGFuZChldmVudC54LCBldmVudC55LCBldmVudC5yYWRpdXMpO1xuICAvLyB0aGlzLmNvcmUubWFwLmdyYXZpdHlfZXZlbnRfcmVjYWxjdWxhdGUoZXZlbnQueCwgZXZlbnQueSwgZXZlbnQucmFkaXVzKTtcblxuICAvLyBkbyB0aGUgZGlnIG5vaXNlIGFuZCBzbW9rZSB0cmFpbHNcbiAgaWYgKGV2ZW50LmRpZykge1xuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHsgeDogZXZlbnQueCwgeTogZXZlbnQueSwgc291bmQ6IFwiZGlnXCIgfSk7XG4gICAgdGhpcy5jcmVhdGVfdHJhaWwoXG4gICAgICB7IGR4OiBldmVudC54LCBkeTogZXZlbnQueSB9LFxuICAgICAge1xuICAgICAgICBjb3VudDogNyxcbiAgICAgICAgc3ByaXRlOiBcInNtb2tlXCIsXG4gICAgICAgIHRpbWVvdXQ6IDIwLFxuICAgICAgICByb3RhdGU6IHRydWUsXG4gICAgICAgIG1vdmU6IHRydWUsXG4gICAgICAgIHNwZWVkOiAxXG4gICAgICB9XG4gICAgKTtcbiAgfVxufTtcblxuLyogU2NyZWVuIFNoYWtlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfc2NyZWVuX3NoYWtlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIGRpc3RhbmNlID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2UoXG4gICAgZXZlbnQueCxcbiAgICBldmVudC55LFxuICAgIHRoaXMuY2FtZXJhLngsXG4gICAgdGhpcy5jYW1lcmEueVxuICApO1xuICBpZiAoZGlzdGFuY2UgPCBldmVudC5yYWRpdXMgKiAyKSB7XG4gICAgdGhpcy5jYW1lcmEuc2hha2VfZnJhbWUgPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgdGhpcy5jYW1lcmEuc2hha2Vfc2l6ZSA9IChkaXN0YW5jZSAtIGV2ZW50LnJhZGl1cykgLyA0O1xuICB9XG59O1xuXG4vKiBIZWFsdGhcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9wbGF5ZXJfaGVhbHRoID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgZXZlbnQuaWRdO1xuICBpZiAob2JqKSB7XG4gICAgdmFyIHRleHQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDk4MjkpICsgXCIgXCIgKyBldmVudC5oZWFsdGg7XG4gICAgdGhpcy5jcmVhdGVfbWVzc2FnZShvYmosIFwiI2ZmOTk5OVwiLCB0ZXh0LCAyMik7XG4gIH1cbn07XG5cbi8qIExldmVsXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfcGxheWVyX2xldmVsID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgZXZlbnQuaWRdO1xuXG4gIC8vIGlzIHRoaXMgdXNcbiAgaWYgKHRoaXMucGxheWVyX2lkID09PSBldmVudC5pZCkge1xuICAgIHRoaXMuc2V0X3Njb3JlKCk7XG5cbiAgICAvLyBzZXQgYWxlcnRcbiAgICBpZiAoZXZlbnQubmV3ID4gZXZlbnQucHJldikge1xuICAgICAgdmFyIGx2ID0gdGhpcy5zY2hlbWUubGV2ZWxzO1xuICAgICAgdmFyIG4xID0gZXZlbnQubmV3O1xuICAgICAgdmFyIG4yID0gZXZlbnQucHJldjtcbiAgICAgIHZhciBiZW5lZml0cyA9IFwiXCI7XG4gICAgICBpZiAobHYuaGVhbHRoW24xXSA+IGx2LmhlYWx0aFtuMl0pIHtcbiAgICAgICAgYmVuZWZpdHMgKz0gXCI8YnI+K1wiICsgKGx2LmhlYWx0aFtuMV0gLSBsdi5oZWFsdGhbbjJdKSArIFwiIG1heCBoZWFsdGhcIjtcbiAgICAgIH1cbiAgICAgIGlmIChsdi5kYW1hZ2VbbjFdID4gbHYuZGFtYWdlW24yXSkge1xuICAgICAgICBiZW5lZml0cyArPSBcIjxicj4rXCIgKyAobHYuZGFtYWdlW24xXSAtIGx2LmRhbWFnZVtuMl0pICsgXCIgZGFtYWdlXCI7XG4gICAgICB9XG4gICAgICBpZiAobHYuc3BlZWRbbjFdID4gbHYuc3BlZWRbbjJdKSB7XG4gICAgICAgIGJlbmVmaXRzICs9IFwiPGJyPitcIiArIChsdi5zcGVlZFtuMV0gLSBsdi5zcGVlZFtuMl0pICsgXCIgc3BlZWRcIjtcbiAgICAgIH1cbiAgICAgIGlmIChsdi5qdW1wW24xXSA+IGx2Lmp1bXBbbjJdKSB7XG4gICAgICAgIGJlbmVmaXRzICs9IFwiPGJyPitcIiArIChsdi5qdW1wW24xXSAtIGx2Lmp1bXBbbjJdKSArIFwiIGp1bXAgcG93ZXJcIjtcbiAgICAgIH1cbiAgICAgIHZhciB0ZXh0ID1cbiAgICAgICAgXCI8c21hbGw+WW91IGhhdmUgcmVhY2hlZDwvc21hbGw+PGJyPjxzcGFuIGNsYXNzPSdsYXJnZSc+TGV2ZWwgXCIgK1xuICAgICAgICAoZXZlbnQubmV3ICsgMSkgK1xuICAgICAgICBcIjwvc3Bhbj48c21hbGwgY2xhc3M9J2JsdWUnPlwiICtcbiAgICAgICAgYmVuZWZpdHMgK1xuICAgICAgICBcIjwvc21hbGw+XCI7XG4gICAgICB0aGlzLnNldF9hbGVydCh0ZXh0LCBcIiNlZWVlZWVcIiwgMTUwKTtcbiAgICB9XG4gIH1cblxuICAvLyBkbyB0aGUgZmxvdXJpc2hcbiAgaWYgKGV2ZW50Lm5ldyA+IGV2ZW50LnByZXYpIHtcbiAgICB0aGlzLmNyZWF0ZV9tZXNzYWdlKG9iaiwgXCIjZWVlXCIsIFwibHZsIFwiICsgKGV2ZW50Lm5ldyArIDEpLCAzMCwgLTMwKTtcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7IHg6IG9iai54LCB5OiBvYmoueSwgc291bmQ6IFwibGV2ZWx1cFwiIH0pO1xuICAgIHRoaXMuY3JlYXRlX3RyYWlsKG9iaiwge1xuICAgICAgY291bnQ6IDcsXG4gICAgICBzcHJpdGU6IFwic3Rhci1ibHVlXCIsXG4gICAgICB0aW1lb3V0OiAzMCxcbiAgICAgIHJvdGF0ZTogdHJ1ZSxcbiAgICAgIG1vdmU6IHRydWUsXG4gICAgICBzcGVlZDogMS41XG4gICAgfSk7XG4gICAgdGhpcy5jcmVhdGVfdHJhaWwob2JqLCB7XG4gICAgICBjb3VudDogNyxcbiAgICAgIHNwcml0ZTogXCJiYWxsLXJlZFwiLFxuICAgICAgdGltZW91dDogMzAsXG4gICAgICByb3RhdGU6IHRydWUsXG4gICAgICBtb3ZlOiB0cnVlLFxuICAgICAgc3BlZWQ6IDJcbiAgICB9KTtcbiAgfVxufTtcblxuLyogRXhwbG9zaW9uXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfZXhwbG9zaW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gZm9jdXMgY2FtZXJhIGlmIHdlIHdlcmUgZm9sbG93aW5nIGl0XG4gIGlmICh0aGlzLndlYXBvbl9mb2xsb3dpbmcgPT09IGV2ZW50LmtleSkge1xuICAgIHRoaXMuY2FtZXJhLmZvY3VzID0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHRoaXMuY2FtZXJhLmZvY3VzX3RpbWUgPSAzMDtcbiAgICB0aGlzLmNhbWVyYS5meCA9IGV2ZW50Lng7XG4gICAgdGhpcy5jYW1lcmEuZnkgPSBldmVudC55O1xuICB9XG59O1xuXG4vKiBBcm1vdXJ5XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfYXJtb3VyeSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmIChldmVudC5wbGF5ZXJfaWQgPT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICB0aGlzLnNldF93ZWFwb24oZXZlbnQud2VhcG9uKTtcbiAgfVxufTtcblxuLyogQm91bmNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfYm91bmNlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBzb3VuZCA9IG9iai5jLmF1ZGlvLmJvdW5jZTtcbiAgaWYgKHNvdW5kKSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoeyB4OiBldmVudC54LCB5OiBldmVudC55LCBzb3VuZDogc291bmQgfSk7XG4gIH1cbn07XG5cbi8qIFNvdW5kXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfc291bmQgPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgdm9sdW1lID0gdGhpcy5nZXRfZGlzdF92b2x1bWUoZXZlbnQueCwgZXZlbnQueSk7XG4gIGlmICh2b2x1bWUgPiAwKSB7XG4gICAgdGhpcy5hdWRpby5wbGF5KGV2ZW50LnNvdW5kLCB2b2x1bWUpO1xuICB9XG59O1xuXG4vKiBTZXQgYSB0YXJnZXQgb24gdGhlIG1hcFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X3RhcmdldCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuY3JlYXRlX2RlY29yYXRpb24oe1xuICAgIHNwcml0ZTogXCJmb2N1c1wiLFxuICAgIHRpbWVvdXQ6IGV2ZW50LnRpbWUsXG4gICAgeDogZXZlbnQueCxcbiAgICB5OiBldmVudC55LFxuICAgIHJlcGVhdDogZmFsc2VcbiAgfSk7XG4gIHRoaXMuYXVkaW8ucGxheShcImhvbWluZ1wiLCAxKTtcbn07XG5cbi8qIFNwYXduIE9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9ldmVudF9zcGF3biA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuY3JlYXRlX29iamVjdChldmVudC5hcmdzLCB0cnVlKTtcblxuICBldmVudC5hcmdzLnRpbWUgPSAzMDtcbiAgaWYgKGV2ZW50LnRhcmdldCkge1xuICAgIHRoaXMucnVuX2V2ZW50X3RhcmdldChldmVudC5hcmdzKTtcbiAgfVxuICBpZiAoZXZlbnQuZm9jdXMpIHtcbiAgICB0aGlzLnJ1bl9ldmVudF9mb2N1cyhldmVudC5hcmdzKTtcbiAgfVxufTtcblxuLyogRm9jdXMgQ2FtZXJhXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fZXZlbnRfZm9jdXMgPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmNhbWVyYS5mb2N1cyA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgdGhpcy5jYW1lcmEuZm9jdXNfdGltZSA9IGV2ZW50LnRpbWU7XG4gIHRoaXMuY2FtZXJhLmZ4ID0gZXZlbnQueDtcbiAgdGhpcy5jYW1lcmEuZnkgPSBldmVudC55O1xuICBpZiAoZXZlbnQudGFyZ2V0KSB7XG4gICAgdGhpcy5ydW5fZXZlbnRfdGFyZ2V0KGV2ZW50KTtcbiAgfVxufTtcblxuLyogU2hvdyBhbGVydFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2FsZXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5zZXRfYWxlcnQoZXZlbnQudGV4dCwgXCIjZWVlZWVlXCIsIGV2ZW50LnRpbWUpO1xufTtcblxuLyogQ3JhdGUgR3JhYlxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2V2ZW50X2NvbGxlY3QgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBpcyB0aGlzIG5vdCB1c1xuICBpZiAoZXZlbnQucGxheWVyX2lkICE9PSB0aGlzLnBsYXllcl9pZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdldCBvdXIgb2JqZWN0XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIGV2ZW50LnBsYXllcl9pZF07XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY3JhdGVzXG4gIGlmIChldmVudC5jb2xsZWN0ZWQgPT09IFwiY3JhdGVcIikge1xuICAgIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1tldmVudC53ZWFwb25dO1xuICAgIHRoaXMuY3JlYXRlX21lc3NhZ2UoXG4gICAgICBvYmosXG4gICAgICBcIiNlZWVlZWVcIixcbiAgICAgIFwiK1wiICsgZXZlbnQuY291bnQgKyBcIiBcIiArIHdlYXBvbi50aXRsZSxcbiAgICAgIDE4XG4gICAgKTtcbiAgfVxuXG4gIC8vIGdlbXNcbiAgaWYgKGV2ZW50LmNvbGxlY3RlZCA9PT0gXCJnZW1cIikge1xuICAgIHRoaXMuc2V0X3Njb3JlKCk7XG4gICAgdGhpcy5jcmVhdGVfbWVzc2FnZShvYmosIFwiI2FhZmY5OVwiLCBcIitcIiArIGV2ZW50Lm4sIDIyKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBFeHBsb3Npb25zXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogQ2hlY2sgZm9yIGV4cGxvc2lvbnNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9leHBsb3Npb25zID0gZnVuY3Rpb24oKSB7XG4gIC8vIHJ1biB0aHJvdWdoIGFsbCBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUuZXhwbG9zaW9ucykge1xuICAgIHZhciBleHBsb2RlX3N0YXRlID0gdGhpcy5jb3JlLnN0YXRlLmV4cGxvc2lvbnNba2V5XTtcbiAgICB2YXIgZXhwbG9kZV9zcHJpdGUgPSB0aGlzLmV4cGxvc2lvbnNba2V5XTtcblxuICAgIC8vIGlmIGl0J3Mgbm90IHN0YXJ0ZWRcbiAgICBpZiAoIWV4cGxvZGVfc3ByaXRlKSB7XG4gICAgICB2YXIgdHlwZSA9IHRoaXMuYy5vYmplY3RzW2V4cGxvZGVfc3RhdGUucGFyZW50X3R5cGVdO1xuICAgICAgaWYgKCF0eXBlKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBjcmVhdGUgc3ByaXRlIHJlZmVyZW5jZVxuICAgICAgdGhpcy5leHBsb3Npb25zW2tleV0gPSB7XG4gICAgICAgIHNwcml0ZTogdHlwZS5hbmltYXRpb24uZXhwbG9zaW9uLFxuICAgICAgICBmcmFtZTogdGhpcy5jb3JlLnN0YXRlLmZyYW1lLFxuICAgICAgICB4OiBleHBsb2RlX3N0YXRlLngsXG4gICAgICAgIHk6IGV4cGxvZGVfc3RhdGUueVxuICAgICAgfTtcblxuICAgICAgLy8gcnVuIHNvdW5kIGVmZmVjdFxuICAgICAgaWYgKHR5cGUuYXVkaW8uZXhwbG9zaW9uKSB7XG4gICAgICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgICAgICBzb3VuZDogdHlwZS5hdWRpby5leHBsb3Npb24sXG4gICAgICAgICAgeDogZXhwbG9kZV9zdGF0ZS54LFxuICAgICAgICAgIHk6IGV4cGxvZGVfc3RhdGUueVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gcnVuIHNjcmVlbiBzaGFrZVxuICAgICAgaWYgKHR5cGUuZGFtYWdlID4gMCkge1xuICAgICAgICB0aGlzLnJ1bl9ldmVudF9zY3JlZW5fc2hha2Uoe1xuICAgICAgICAgIHJhZGl1czogdHlwZS5kYW1hZ2UsXG4gICAgICAgICAgeDogZXhwbG9kZV9zdGF0ZS54LFxuICAgICAgICAgIHk6IGV4cGxvZGVfc3RhdGUueVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gbWF0Y2ggcG9zaXRpb25cbiAgICBleHBsb2RlX3Nwcml0ZS54ID0gZXhwbG9kZV9zcHJpdGUueDtcbiAgICBleHBsb2RlX3Nwcml0ZS55ID0gZXhwbG9kZV9zcHJpdGUueTtcbiAgfVxuXG4gIC8vIHJlbW92ZSBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmV4cGxvc2lvbnMpIHtcbiAgICBpZiAodGhpcy5jb3JlLnN0YXRlLmZyYW1lID4gdGhpcy5leHBsb3Npb25zW2tleV0uZnJhbWUgKyA2MCkge1xuICAgICAgZGVsZXRlIHRoaXMuZXhwbG9zaW9uc1trZXldO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBnYW1lKFxuICBhc3NldHMsXG4gIGF1ZGlvLFxuICBpbnB1dCxcbiAgc2NoZW1lLFxuICBtYXAsXG4gIHBsYXllcnMsXG4gIHBsYXllcl9pZCxcbiAgdG9wX2V2ZW50LFxuICBvbmJvYXJkaW5nXG4pIHtcbiAgLy8gYXJnc1xuICB0aGlzLmMgPSBjb25maWc7XG4gIHRoaXMuaW1nID0gYXNzZXRzLmltZztcbiAgdGhpcy5hdWRpbyA9IGF1ZGlvO1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMuc2NoZW1lID0gc2NoZW1lO1xuICB0aGlzLm1hcCA9IG1hcDtcbiAgdGhpcy5wbGF5ZXJzID0gcGxheWVycztcbiAgdGhpcy5wbGF5ZXJfaWQgPSBwbGF5ZXJfaWQ7XG4gIHRoaXMubGVhZGVyID0gbnVsbDtcbiAgdGhpcy50b3BfZXZlbnQgPSB0b3BfZXZlbnQ7XG4gIHRoaXMub25ib2FyZGluZyA9IG9uYm9hcmRpbmc7XG5cbiAgLy8gZ2FtZSBydW5uaW5nXG4gIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gIHRoaXMubGFzdF9mcmFtZSA9IDA7XG5cbiAgLy8gbWFpbiBkaXZcbiAgdGhpcy5kaXYgPSBlbGVtZW50KHsgY2xhc3M6IFwiZ2FtZSBmdWxsXCIgfSk7XG4gIHRoaXMuZ2FtZV9hcmVhID0gZWxlbWVudCh7IGlkOiBcImdhbWVfaW5wdXRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmdhbWVfYXJlYSk7XG5cbiAgLy8gc2V0IHVwIGdhbWUgbW9kdWxlc1xuICB0aGlzLmluaXRfY3Jvc3NoYWlyKCk7XG4gIHRoaXMuaW5pdF9jYW52YXMoKTtcbiAgdGhpcy5pbml0X2FybW91cnkoKTtcbiAgdGhpcy5pbml0X21hcCgpO1xuICB0aGlzLmluaXRfY2FtZXJhKCk7XG4gIHRoaXMuaW5pdF9iYWNrZ3JvdW5kKCk7XG4gIHRoaXMuaW5pdF90aW1lKCk7XG4gIHRoaXMuaW5pdF9zY29yZSgpO1xuICB0aGlzLmluaXRfYWxlcnQoKTtcbiAgdGhpcy5pbml0X2F1ZGlvKCk7XG5cbiAgLy8gdGhpbmdzIHRvIGRpc3BsYXlcbiAgdGhpcy5vYmplY3RzID0ge307XG4gIHRoaXMuZXhwbG9zaW9ucyA9IHt9O1xuICB0aGlzLmRlY29yYXRpb25zID0ge307XG4gIHRoaXMuYWN0aW9ucyA9IHt9O1xuICB0aGlzLnNwcml0ZXMgPSBbXTtcbiAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuICB0aGlzLmxhYmVscyA9IHt9O1xuXG4gIC8vIHdhaXQgcGVyaW9kIGJlZm9yZSBvbiBmaXJlZCB3ZWFwb24gaW1tZWRpYXRlbHkgYWZ0ZXJcbiAgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID0gMDtcblxuICAvLyBjcmVhdGUgY29yZVxuICB0aGlzLmNvcmUgPSBuZXcgY29yZSh0aGlzLmMsIHRoaXMuc2NoZW1lLCB0aGlzLm1hcC5mZywgdGhpcy5tYXAuZ3Jhdml0eV9tYXApO1xuICB0aGlzLmNvcmUuc3RhdGUgPSB0aGlzLmNvcmUuYmxhbmtfc3RhdGUoKTtcbiAgdGhpcy5jb3JlLnN0YXRlID0gdGhpcy5jb3JlLnN0YXRlO1xufVxuXG4vKiBJbml0IGdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oZnJhbWUpIHtcbiAgLy8gbWFyayBwbGF5ZXIgZXZlbnRzXG4gIHRoaXMucGxheWVyX2V2ZW50cyA9IHt9O1xuXG4gIC8vIHNldCBnYW1lIHN0YXR1cyB0byBhY3RpdmVcbiAgdGhpcy5hY3RpdmUgPSB0cnVlO1xuXG4gIC8vIHNldCBwbGF5ZXIgb2JqXG4gIHRoaXMuc2V0X3RoaXNfcGxheWVyX3JlZnMoKTtcbiAgdGhpcy5zZXRfc2NvcmUoKTtcblxuICAvLyBzZXQgaW5pdGlhbCBjYW1lcmFcbiAgaWYgKHRoaXMucGxheWVyKSB7XG4gICAgdGhpcy5jYW1lcmEueCA9IHRoaXMucGxheWVyX29iai54O1xuICAgIHRoaXMuY2FtZXJhLnkgPSB0aGlzLnBsYXllcl9vYmoueTtcbiAgfVxufTtcblxuLyogUnVuIGNvcmVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmZyYW1lX2NvcmUgPSBmdW5jdGlvbihmcmFtZSwgYWN0aW9ucykge1xuICAvLyBzZXQgdXAgdGhpcyBzdGF0ZVxuICB0aGlzLmNvcmUuc3RhdGUuZnJhbWUgPSBmcmFtZTtcbiAgdGhpcy5jb3JlLnN0YXRlLmV2ZW50cyA9IFtdO1xuICB2YXIgcmVzcG9uc2UgPSB0aGlzLmNvcmUuYWN0aW9uKHRoaXMucGxheWVyX2lkLCBhY3Rpb25zKTtcblxuICAvLyBydW4gcGxheWVyIGFjdGlvbnNcbiAgdGhpcy5ydW5fcGxheWVyc19ldmVudHMoKTtcblxuICAvLyBydW4gdGhpcyBzdGF0ZVxuICB0aGlzLmNvcmUuZnJhbWUoKTtcblxuICAvLyByZXR1cm4gdGhlIGlucHV0IHJlc3BvbnNlXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qIFJ1biBkaXNwbGF5XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5mcmFtZV9kaXNwbGF5ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucnVuX29iamVjdHMoKTtcbiAgdGhpcy5ydW5fY3Jvc3NoYWlyKCk7XG4gIHRoaXMucnVuX2NhbWVyYSgpO1xuICB0aGlzLnJ1bl9leHBsb3Npb25zKCk7XG4gIHRoaXMucnVuX2RlY29yYXRpb25zKCk7XG4gIHRoaXMucnVuX2xhYmVscygpO1xuICB0aGlzLnJ1bl9jYW52YXMoKTtcbiAgdGhpcy5ydW5fYXVkaW8oKTtcbiAgdGhpcy5ydW5fdGltZSgpO1xuICB0aGlzLnJ1bl9hbGVydCgpO1xuICB0aGlzLnJ1bl9hcm1vdXJ5KCk7XG5cbiAgLy8gZGV0b25hdGlvbiBjb29sZG93blxuICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gLT0gdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID4gMCA/IDEgOiAwO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRHYW1lXG5cdElucHV0XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogR2V0IGN1cnJlbnQgY29yZSBhY3Rpb24gaW5wdXRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5nZXRfaW5wdXQgPSBmdW5jdGlvbigpIHtcbiAgLy8gaXMgdGhlIGdhbWUgYWN0aXZlIGFuZCBkb2VzIGl0IGhhdmUgYSBwbGF5ZXJcbiAgaWYgKCF0aGlzLmFjdGl2ZSB8fCAhdGhpcy5wbGF5ZXIgfHwgdGhpcy5wbGF5ZXIuZGVhZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHNldCBzb3VyY2Ugb2YgY3Jvc3NoYWlyIG1vdmVtZW50XG4gIGlmIChcbiAgICB0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfdXBcIikgfHxcbiAgICB0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfZG93blwiKSB8fFxuICAgIHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9sZWZ0XCIpIHx8XG4gICAgdGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX3JpZ2h0XCIpXG4gICkge1xuICAgIHRoaXMuY3Jvc3NoYWlyX3NvdXJjZSA9IFwiYnV0dG9uXCI7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHRoaXMuaW5wdXQuY3Vyc29yX21vdmVkKSB7XG4gICAgICB0aGlzLmNyb3NzaGFpcl9zb3VyY2UgPSBcImN1cnNvclwiO1xuICAgIH1cbiAgfVxuICB0aGlzLmlucHV0LmN1cnNvcl9tb3ZlZCA9IGZhbHNlO1xuXG4gIC8vIGdldCBwbGF5ZXIgYWN0aW9uc1xuICB2YXIgYWN0aXZlID0gZmFsc2U7XG4gIHZhciByZXNwb25zZSA9IHtcbiAgICBhY3Rpb246IFwibm9uZVwiLFxuICAgIGFuZ2xlOiByb3VuZCh0aGlzLmNyb3NzaGFpcilcbiAgfTtcblxuICAvLyB3ZWFwb24ga2V5c1xuICB2YXIgc2hvb3Rfa2V5ID0gZmFsc2U7XG4gIHZhciBmaXJlX3dlYXBvbiA9IGZhbHNlO1xuICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbdGhpcy5jdXJyZW50X3dlYXBvbl07XG4gIGlmICh3ZWFwb24gJiYgdGhpcy5kZXRvbmF0aW9uX2Nvb2xkb3duID09PSAwICYmIHRoaXMuaW5wdXQuYWN0aXZlKFwic2hvb3RcIikpIHtcbiAgICAvLyBhYmFuZG9uIGEgZm9sbG93ZWQgd2VhcG9uXG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW3RoaXMud2VhcG9uX2ZvbGxvd2luZ10pIHtcbiAgICAgIHRoaXMuZGV0b25hdGlvbl9jb29sZG93biA9IDE1O1xuICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcblxuICAgICAgLy8gbm9ybWFsIGZpcmluZ1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBvbiBzY3JlZW5cbiAgICAgIHZhciBwb3MgPSB0aGlzLnNjcmVlbl9wb3NpdGlvbihcbiAgICAgICAgdGhpcy5wbGF5ZXJfb2JqLngsXG4gICAgICAgIHRoaXMucGxheWVyX29iai55LFxuICAgICAgICB0aGlzLnBsYXllcl9vYmouYy5zaXplXG4gICAgICApO1xuICAgICAgaWYgKCFwb3Mub25fc2NyZWVuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gY29vbGRvd25cbiAgICAgIGlmICh0aGlzLnBsYXllci5jb29sZG93biA+IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbdGhpcy5jdXJyZW50X3dlYXBvbl07XG4gICAgICBpZiAoIXdlYXBvbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAod2VhcG9uLnBvd2VyX3VwICYmIHRoaXMucG93ZXJfdXAgPCA2MCkge1xuICAgICAgICB0aGlzLnBvd2VyX3VwKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaXJlX3dlYXBvbiA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRoaXMucG93ZXJlZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnBvd2VyX3VwID4gMCkge1xuICAgICAgZmlyZV93ZWFwb24gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBvd2VyX3VwID0gMDtcbiAgICB9XG4gIH1cblxuICAvLyBmaXJlIHdlYXBvblxuICBpZiAoZmlyZV93ZWFwb24pIHtcbiAgICB0aGlzLnBvd2VyZWQgPSB0cnVlO1xuICAgIHJlc3BvbnNlLmFjdGlvbiA9IFwic2hvb3RcIjtcbiAgICByZXNwb25zZS5wb3dlciA9IHRoaXMucG93ZXJfdXA7XG4gICAgcmVzcG9uc2Uud2VhcG9uID0gdGhpcy5jdXJyZW50X3dlYXBvbjtcbiAgICBhY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMucG93ZXJfdXAgPSAwO1xuICB9XG5cbiAgLy8gd2Fsa2luZyByZXN0cmljdGVkIGFjdGlvbnNcbiAgaWYgKHRoaXMucGxheWVyX29iai5ncm91bmRlZCAmJiAhYWN0aXZlKSB7XG4gICAgLy8gYXJyb3cga2V5IG1vdmVtZW50XG4gICAgdmFyIGFycm93X2FuZ2xlID0gLTE7XG4gICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV91cFwiKSkge1xuICAgICAgYXJyb3dfYW5nbGUgPSA5MDtcbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAxMzU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSA0NTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwibW92ZV9kb3duXCIpKSB7XG4gICAgICBhcnJvd19hbmdsZSA9IDI3MDtcbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAyMjU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAzMDU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVfcmlnaHRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAxODA7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pbnB1dC5hY3RpdmUoXCJtb3ZlX2xlZnRcIikpIHtcbiAgICAgICAgYXJyb3dfYW5nbGUgPSAwO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYXJyb3dfYW5nbGUgIT09IC0xKSB7XG4gICAgICByZXNwb25zZS5hY3Rpb24gPSBcIm1vdmVcIjtcbiAgICAgIHJlc3BvbnNlLmFuZ2xlID0gYXJyb3dfYW5nbGU7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIG1vdmUgY3Jvc3NoYWlyIGtleVxuICAgIGlmICh0aGlzLmlucHV0LmFjdGl2ZShcIm1vdmVcIikpIHtcbiAgICAgIHJlc3BvbnNlLmFjdGlvbiA9IFwibW92ZVwiO1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBqdW1waW5nXG4gICAgaWYgKHRoaXMuaW5wdXQuYWN0aXZlKFwianVtcFwiKSkge1xuICAgICAgcmVzcG9uc2UuYWN0aW9uID0gXCJqdW1wXCI7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNhbmNlbCBtb3VzZSBmb2xsb3cgaWYgZG9pbmcgc3R1ZmZcbiAgaWYgKGFjdGl2ZSkge1xuICAgIHRoaXMuY2FuY2VsX21vdXNlX2ZvbGxvdygpO1xuICB9XG5cbiAgaWYgKCFhY3RpdmUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBzZXQgdGhlIG9uYm9hcmRpbmdcbiAgdGhpcy5vbmJvYXJkaW5nICYmIHRoaXMub25ib2FyZGluZy5zZXQocmVzcG9uc2UuYWN0aW9uKTtcblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFJ1biBPYmplY3RzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQgb2JqZWN0c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV9vYmplY3QgPSBmdW5jdGlvbihwcm9wcywgc3Bhd24pIHtcbiAgLy8gdXNlIGV4aXN0aW5nIHByb3BzIHRvIG1ha2UgbmV3IGNvcmUgb2JqZWN0XG4gIHZhciBvYmogPSB0aGlzLmNvcmUuY3JlYXRlX29iamVjdChwcm9wcyk7XG5cbiAgLy8gcHJldmlvdXMgcG9zaXRpb25cbiAgb2JqLnB4ID0gb2JqLng7XG4gIG9iai5weSA9IG9iai55O1xuICBvYmoucGcgPSBmYWxzZTtcbiAgb2JqLnB4MiA9IG9iai54O1xuICBvYmoucHkyID0gb2JqLnk7XG5cbiAgLy8gZGlzcGxheSB2YWx1ZXNcbiAgb2JqLmhlYWRpbmcgPSAwO1xuICBvYmouaGlkZSA9IDA7XG4gIG9iai5iYXJyZWxfYW5nbGUgPSAwO1xuICBvYmouYWN0aW9uZWQgPSBmYWxzZTtcbiAgb2JqLnBsYXllcl9sb2NrZWQgPSBmYWxzZTtcblxuICAvLyBkaXNwbGF5IHBvc2l0aW9uXG4gIG9iai5keCA9IG9iai54O1xuICBvYmouZHkgPSBvYmoueTtcbiAgb2JqLmRzID0gMDtcblxuICAvLyBjaGVjayBmb3Igc2hvb3QgZXZlbnRzXG4gIHRoaXMuc2V0X3Nob3Rfb2JqZWN0KG9iaik7XG5cbiAgLy8gcHJldmlvdXMgZGlzcGxheSBwb3NpdGlvblxuICBvYmoucGR4ID0gb2JqLng7XG4gIG9iai5wZHkgPSBvYmoueTtcblxuICAvLyBzcGF3blxuICBpZiAob2JqLmMuc3Bhd24gfHwgc3Bhd24pIHtcbiAgICAvLyBoaWRlIG5ldyBvYmplY3QgZm9yIHggZnJhbWVzXG4gICAgb2JqLmhpZGUgPSA5O1xuXG4gICAgLy8gYWRkIGEgc3Bhd24gZGVjb3JhdGlvbiBvdmVyIHRvcFxuICAgIHRoaXMuY3JlYXRlX2RlY29yYXRpb24oe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHRpbWVvdXQ6IDE2LFxuICAgICAgcmVwZWF0OiBmYWxzZSxcbiAgICAgIHR5cGU6IFwic3Bhd25cIixcbiAgICAgIHNwcml0ZTogXCJ0ZWxlcG9ydFwiXG4gICAgfSk7XG5cbiAgICAvLyBwbGF5IHNwYXduIHNvdW5kXG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgc291bmQ6IFwicGhhc2VcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnlcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKiBTZXQgYSBzaG90IGl0ZW1zIG5ldyBsb2NhdGlvblxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF9zaG90X29iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICAvLyBjaGVjayBmb3IgYSBwbGF5ZXJcbiAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICBpZiAoIXBsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNoZWNrIGZvciBhbiBhY3Rpb25cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbGF5ZXIuZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGFjdCA9IHBsYXllci5ldmVudHNbaV07XG4gICAgaWYgKGFjdC5vYmogPT09IG9iai5rZXkpIHtcbiAgICAgIG9iai5oaWRlID0gMTAwO1xuICAgIH1cbiAgfVxufTtcblxuLyogUnVuIG9iamVjdHNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fb2JqZWN0cyA9IGZ1bmN0aW9uKCkge1xuICAvLyBjaGVjayBmb3IgcGxheWVyIGxvY2tlZCBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmIChvYmouYy5wbGF5ZXJfbG9jaykge1xuICAgICAgdmFyIHBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgb2JqLnBsYXllcl9pZF07XG4gICAgICBpZiAocGxheWVyKSB7XG4gICAgICAgIHBsYXllci5wbGF5ZXJfbG9ja2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICB0aGlzLnJ1bl9vYmplY3QodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XSk7XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9vYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gc25hcCBpbW1lZGlhdGVseSBpZiB1c1xuICBpZiAob2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICBvYmouZHggPSBvYmoueDtcbiAgICBvYmouZHkgPSBvYmoueTtcblxuICAgIC8vIHByZXZlbnQgYm9iYmxpbmdcbiAgICBpZiAob2JqLnggPT09IG9iai5weDIgJiYgb2JqLnkgPT09IG9iai5weTIpIHtcbiAgICAgIG9iai5keCA9IG9iai5wZHg7XG4gICAgICBvYmouZHkgPSBvYmoucGR5O1xuICAgIH1cblxuICAgIC8vIGludGVycG9sYXRlIG90aGVyc1xuICB9IGVsc2Uge1xuICAgIC8vIGdldCBtYXggc3BlZWQgb2YgbW92ZW1lbnRcbiAgICBpZiAoIW9iai5hY3Rpb25lZCkge1xuICAgICAgb2JqLmRzID0gZ2V0X3NwZWVkKG9iai5zcGVlZF94LCBvYmouc3BlZWRfeSk7XG4gICAgfVxuXG4gICAgLy8gaW50ZXJwb2xhdGVcbiAgICB2YXIgZGlzdF94ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeChvYmouZHgsIG9iai54KTtcbiAgICB2YXIgZGlzdF95ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeShvYmouZHksIG9iai55KTtcbiAgICB2YXIgbWF4X3NwZWVkID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2Uob2JqLmR4LCBvYmouZHksIG9iai54LCBvYmoueSk7XG4gICAgdmFyIHNwZWVkID0gbWF4KG1heF9zcGVlZCAvIDQsIG1pbihtYXhfc3BlZWQsIG9iai5kcykpO1xuICAgIHZhciBtb3ZlID0gY2hlY2tfc3BlZWQoZGlzdF94LCBkaXN0X3ksIHNwZWVkKTtcbiAgICBvYmouZHggPSB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHggKyByb3VuZChtb3ZlLngpKTtcbiAgICBvYmouZHkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkgKyByb3VuZChtb3ZlLnkpKTtcbiAgfVxuXG4gIC8vIGhhdmUgd2UgbW92ZWRcbiAgdmFyIG1vdmVkID0gb2JqLnBkeCAhPT0gb2JqLmR4IHx8IG9iai5wZHkgIT09IG9iai5keTtcblxuICAvLyBzZXQgaGVhZGluZyBhbmQgYmFycmVsIGFuZ2xlXG4gIGlmIChtb3ZlZCkge1xuICAgIG9iai5oZWFkaW5nID0gdGhpcy5jb3JlLm1hcC5nZXRfaGVhZGluZyhvYmoucGR4LCBvYmoucGR5LCBvYmouZHgsIG9iai5keSk7XG4gICAgb2JqLmJhcnJlbF9hbmdsZSA9IGluY3JlbWVudF9hbmdsZShvYmouYmFycmVsX2FuZ2xlLCBvYmouaGVhZGluZywgMyk7XG4gIH1cblxuICAvLyBpcyB1c1xuICBpZiAob2JqLnBsYXllcl9pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICBvYmouYmFycmVsX2FuZ2xlID0gb2JqLnBsYXllcl9sb2NrZWQgPyBvYmouaGVhZGluZyA6IHRoaXMuY3Jvc3NoYWlyO1xuICB9XG5cbiAgLy8gaWYgd2UgaGF2ZSBqdXN0IGxhbmRlZCBzZXQgaW5pdGlhbCBhbmdsZVxuICBpZiAob2JqLmdyb3VuZGVkICYmICFvYmoucGcpIHtcbiAgICB2YXIgYW5nbGUgPSBnZXRfYW5nbGUob2JqLnNwZWVkX3gsIG9iai5zcGVlZF95KTtcbiAgICB2YXIgd2FsayA9IHRoaXMuY29yZS5tYXAud2FsayhvYmoueCwgb2JqLnksIG9iai5weCwgb2JqLnB5LCBhbmdsZSwgNik7XG4gICAgaWYgKHdhbGsubW92ZSkge1xuICAgICAgb2JqLmFuZ2xlID0gd2Fsay5hbmdsZTtcbiAgICAgIG9iai5kaXJlY3Rpb24gPSB3YWxrLmRpcmVjdGlvbjtcbiAgICAgIG9iai5weCA9IG9iai54O1xuICAgICAgb2JqLnB5ID0gb2JqLnk7XG4gICAgICBvYmouYW5pbWF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGlmIHdhbGtpbmdcbiAgZWxzZSBpZiAob2JqLmdyb3VuZGVkKSB7XG4gICAgLy8gc2V0IHRoZSBkaXNwbGF5IHZhbHVlc1xuICAgIHZhciBkaXN0X3ggPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV94KG9iai5wZHgsIG9iai5keCk7XG4gICAgdmFyIGRpc3RfeSA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlX3kob2JqLnBkeSwgb2JqLmR5KTtcbiAgICB2YXIgYW1vdW50X21vdmVkID0gZ2V0X3NwZWVkKGRpc3RfeCwgZGlzdF95KTtcbiAgICBpZiAoYW1vdW50X21vdmVkID4gMykge1xuICAgICAgb2JqLmFuaW1hdGUgPSB0cnVlO1xuICAgICAgb2JqLmRpcmVjdGlvbiA9IHRoaXMuY29yZS5tYXAuZ3JvdW5kX2RpcihcbiAgICAgICAgb2JqLnBkeCxcbiAgICAgICAgb2JqLnBkeSxcbiAgICAgICAgb2JqLmR4LFxuICAgICAgICBvYmouZHlcbiAgICAgICk7XG4gICAgICBvYmouYW5nbGUgPSBvYmouaGVhZGluZztcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqLmFuaW1hdGUgPSBvYmouYy5hbmltYXRpb24uZ3JvdW5kO1xuICAgIH1cblxuICAgIC8vIHNldCBzcHJpdGVzXG4gICAgdmFyIHN1ZmZpeCA9IG9iai5hbmltYXRlID8gXCItd2Fsay1cIiA6IFwiLXN0aWxsLVwiO1xuICAgIG9iai5zcHJpdGVfa2V5ID0gb2JqLmMuYW5pbWF0aW9uLnNwcml0ZSArIHN1ZmZpeCArIG9iai5kaXJlY3Rpb247XG4gICAgb2JqLmRpc3BsYXlfYW5nbGUgPVxuICAgICAgb2JqLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIgPyBvYmouYW5nbGUgOiBhbmdsZV9hZGQob2JqLmFuZ2xlLCAxODApO1xuXG4gICAgLy8gbm90IHdhbGtpbmdcbiAgfSBlbHNlIHtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5jLmFuaW1hdGlvbi5zcHJpdGU7XG4gICAgb2JqLmFuaW1hdGUgPSB0cnVlO1xuXG4gICAgLy8gcGxheWVyc1xuICAgIHZhciBwbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1tvYmoucGxheWVyX2lkXTtcbiAgICBpZiAob2JqLnR5cGUgPT09IFwicGxheWVyXCIgJiYgcGxheWVyLmhpdCA9PT0gMCkge1xuICAgICAgb2JqLmRpcmVjdGlvbiA9XG4gICAgICAgIG9iai5iYXJyZWxfYW5nbGUgPj0gOTAgJiYgb2JqLmJhcnJlbF9hbmdsZSA8IDI3MCA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICAgICAgb2JqLnNwcml0ZV9rZXkgKz0gXCItYWlyLVwiICsgb2JqLmRpcmVjdGlvbjtcbiAgICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgICAgb2JqLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCJcbiAgICAgICAgICA/IG9iai5iYXJyZWxfYW5nbGVcbiAgICAgICAgICA6IGFuZ2xlX2FkZChvYmouYmFycmVsX2FuZ2xlLCAxODApO1xuICAgIH1cblxuICAgIC8vIHNwaW5uaW5nIGluIHRoZSBhaXJcbiAgICBlbHNlIGlmIChvYmouYy5hbmltYXRpb24uYWlyX3NwaW4pIHtcbiAgICAgIHZhciBncm91bmQgPSB0aGlzLmNvcmUubWFwLmdyb3VuZF9waXhlbChyb3VuZChvYmouZHgpLCByb3VuZChvYmouZHkpKTtcbiAgICAgIHZhciBzcGVlZCA9IGdldF9zcGVlZChvYmouc3BlZWRfeCwgb2JqLnNwZWVkX3kpO1xuICAgICAgdmFyIG4gPSBncm91bmQgPyAwIDogMTtcbiAgICAgIHZhciBhbmdsZV9hZGRpbmcgPSBtb3ZlZCA/IHNwZWVkICogMiA6IG47XG4gICAgICBvYmouZGlzcGxheV9hbmdsZSA9IGFuZ2xlX2FkZChvYmouZGlzcGxheV9hbmdsZSwgYW5nbGVfYWRkaW5nKTtcblxuICAgICAgLy8gcG9pbnRpbmcgdG93YXJkcyB0cmFqZWN0b3J5XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyb3VuZChhYnMob2JqLnNwZWVkX3gpID09PSAwKSAmJiByb3VuZChhYnMob2JqLnNwZWVkX3kpID09PSAwKSkge1xuICAgICAgICBpZiAob2JqLmMuYW5pbWF0aW9uLmFpcl9zcGluKSB7XG4gICAgICAgICAgb2JqLmRpc3BsYXlfYW5nbGUgPSBhbmdsZV9hZGQob2JqLmRpc3BsYXlfYW5nbGUsIDIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmouZGlzcGxheV9hbmdsZSA9IGFuZ2xlX2FkZChcbiAgICAgICAgICBnZXRfYW5nbGUoLW9iai5zcGVlZF94LCAtb2JqLnNwZWVkX3kpLFxuICAgICAgICAgIDkwXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gc3RhdGljIGFuZ2xlIGZsYWdcbiAgaWYgKG9iai5jLmFuaW1hdGlvbi5zdGF0aWNfYW5nbGUpIHtcbiAgICBvYmouZGlzcGxheV9hbmdsZSA9IDA7XG4gIH1cblxuICAvLyB3ZWFwb24ganVzdCBmaXJlZCBmbGFnc1xuICBpZiAob2JqLmZpcmVfc3ByaXRlX2NvdW50KSB7XG4gICAgb2JqLmZpcmVfc3ByaXRlX2NvdW50LS07XG4gIH1cbiAgaWYgKG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQpIHtcbiAgICBvYmouZGlyZWN0aW9uID0gb2JqLmZpcmVfZGlyZWN0aW9uO1xuICAgIG9iai5kaXNwbGF5X2FuZ2xlID1cbiAgICAgIG9iai5kaXJlY3Rpb24gPT09IFwibGVmdFwiXG4gICAgICAgID8gb2JqLmZpcmVfYW5nbGVfbG9ja1xuICAgICAgICA6IGFuZ2xlX2FkZChvYmouZmlyZV9hbmdsZV9sb2NrLCAxODApO1xuICAgIG9iai5maXJlX2FuZ2xlX2xvY2tfY291bnQtLTtcbiAgfVxuICBpZiAob2JqLmZpcmVfYm9keV9zcHJpdGVfY291bnQpIHtcbiAgICBvYmouc3ByaXRlX2tleSA9IG9iai5maXJlX2JvZHlfc3ByaXRlICsgXCItXCIgKyBvYmouZGlyZWN0aW9uO1xuICAgIG9iai5hbmltYXRlID0gdHJ1ZTtcbiAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZV9jb3VudC0tO1xuICB9XG5cbiAgLy8gcHJldmlvdXMgcG9zaXRpb25cbiAgb2JqLnB4MiA9IG9iai5weDtcbiAgb2JqLnB5MiA9IG9iai5weTtcbiAgb2JqLnB4ID0gb2JqLng7XG4gIG9iai5weSA9IG9iai55O1xuICBvYmoucGcgPSBvYmouZ3JvdW5kZWQ7XG4gIG9iai5wZHggPSBvYmouZHg7XG4gIG9iai5wZHkgPSBvYmouZHk7XG4gIG9iai5wbGF5ZXJfbG9ja2VkID0gZmFsc2U7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFJ1biBQbGF5ZXJzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogU3RhcnQgdGhpcyBwbGF5ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X3BsYXllciA9IGZ1bmN0aW9uKHBsYXllciwgcHJlc2VydmVfZXZlbnRzLCByZW1vdmVfZXZlbnRzKSB7XG4gIHZhciBuZXdfcGxheWVyO1xuXG4gIC8vIHVzZSBzb3VyY2VzXG4gIGlmIChwbGF5ZXIpIHtcbiAgICB2YXIgY29yZV9wbGF5ZXIgPSB0aGlzLmNvcmUuc3RhdGUucGxheWVyc1twbGF5ZXIuaWRdO1xuICAgIGlmIChwcmVzZXJ2ZV9ldmVudHMgJiYgY29yZV9wbGF5ZXIpIHtcbiAgICAgIHBsYXllci5ldmVudHMgPSBjb3JlX3BsYXllci5ldmVudHMuY29uY2F0KHBsYXllci5ldmVudHMpO1xuICAgIH1cbiAgICBuZXdfcGxheWVyID0gdGhpcy5jb3JlLmNyZWF0ZV9wbGF5ZXIocGxheWVyKTtcbiAgICBpZiAocmVtb3ZlX2V2ZW50cykge1xuICAgICAgbmV3X3BsYXllci5ldmVudHMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgbmV3XG4gIH0gZWxzZSB7XG4gICAgbmV3X3BsYXllciA9IHRoaXMuY29yZS5jcmVhdGVfcGxheWVyKHsgaWQ6IHRoaXMucGxheWVyX2lkIH0pO1xuICAgIHRoaXMuY3JlYXRlX29iamVjdCh7IHR5cGU6IFwicGxheWVyXCIsIHBsYXllcl9pZDogdGhpcy5wbGF5ZXJfaWQgfSk7XG4gICAgdGhpcy5jb3JlLmluaXRfcGxheWVyKHRoaXMucGxheWVyX2lkKTtcbiAgfVxuXG4gIC8vIHNldCB0aGlzIHBsYXllclxuICBpZiAobmV3X3BsYXllci5pZCA9PT0gdGhpcy5wbGF5ZXJfaWQpIHtcbiAgICB0aGlzLnBsYXllciA9IG5ld19wbGF5ZXI7XG4gICAgdGhpcy5zZXRfYXJtb3VyeSgpO1xuICB9XG59O1xuXG4vKiBSZXNvbHZlIHBsYXllcnMgZnJvbSBvdGhlciBzdGF0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fcGxheWVyc19ldmVudHMgPSBmdW5jdGlvbihwbGF5ZXJzKSB7XG4gIC8vIGNsZWFyIG9iamVjdCBhY3Rpb25lZCBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XS5hY3Rpb25lZCA9IGZhbHNlO1xuICB9XG5cbiAgLy8gcnVuIHBsYXllciBldmVudHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzKSB7XG4gICAgdGhpcy5ydW5fcGxheWVyX2V2ZW50cyh0aGlzLmNvcmUuc3RhdGUucGxheWVyc1trZXldKTtcbiAgfVxuXG4gIC8vIHJlbW92ZSBvbGQgZXZlbnRzXG4gIGZvciAodmFyIGlkIGluIHRoaXMucGxheWVyX2V2ZW50cykge1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnBsYXllcl9ldmVudHNbaWRdKSB7XG4gICAgICBpZiAodGhpcy5jb3JlLnN0YXRlLmZyYW1lID4gdGhpcy5wbGF5ZXJfZXZlbnRzW2lkXVtrZXldICsgMzApIHtcbiAgICAgICAgZGVsZXRlIHRoaXMucGxheWVyX2V2ZW50c1tpZF1ba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmdhbWUucHJvdG90eXBlLnJ1bl9wbGF5ZXJfZXZlbnRzID0gZnVuY3Rpb24ocGxheWVyKSB7XG4gIC8vIGluaXQgcGxheWVyIGV2ZW50c1xuICBpZiAoIXRoaXMucGxheWVyX2V2ZW50c1twbGF5ZXIuaWRdKSB7XG4gICAgdGhpcy5wbGF5ZXJfZXZlbnRzW3BsYXllci5pZF0gPSB7fTtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZXZlbnRzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyLmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBldmVudCA9IHBsYXllci5ldmVudHNbaV07XG4gICAgdmFyIGtleSA9IGV2ZW50LmZyYW1lICsgXCItXCIgKyBldmVudC50eXBlO1xuICAgIGlmICghdGhpcy5wbGF5ZXJfZXZlbnRzW2tleV0pIHtcbiAgICAgIHRoaXMucGxheWVyX2V2ZW50KHBsYXllciwgZXZlbnQpO1xuICAgICAgdGhpcy5wbGF5ZXJfZXZlbnRzW2tleV0gPSB0aGlzLmNvcmUuc3RhdGUuZnJhbWU7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbn07XG5cbi8qIFBsYXllciBhY3Rpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5wbGF5ZXJfZXZlbnQgPSBmdW5jdGlvbihwbGF5ZXIsIGV2ZW50KSB7XG4gIC8vIGlzIHRoZXJlIGlzbid0IGFuIGFjdGlvblxuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IHBsYXllciBvYmplY3RcbiAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgcGxheWVyLmlkXTtcbiAgaWYgKCFvYmopIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBtYXJrIG9iamVjdCBhcyBoYXZpbmcgcGVyZm9ybWVkIGFuIGFjdGlvblxuICBvYmouYWN0aW9uZWQgPSB0cnVlO1xuXG4gIC8vIG1vdmVtZW50XG4gIGlmIChldmVudC50eXBlID09PSBcIndhbGtcIikge1xuICAgIG9iai5kcyA9IHRoaXMuc2NoZW1lLmxldmVscy5zcGVlZFtwbGF5ZXIubGV2ZWxdIHx8IG9iai5jLnNwZWVkLm1vdmU7XG4gIH1cblxuICAvLyBqdW1wXG4gIGlmIChldmVudC50eXBlID09PSBcImp1bXBcIikge1xuICAgIG9iai5kcyA9IHRoaXMuc2NoZW1lLmxldmVscy5qdW1wW3BsYXllci5sZXZlbF0gfHwgb2JqLmMuc3BlZWQuanVtcDtcblxuICAgIC8vIHBsYXkganVtcCBzb3VuZFxuICAgIHRoaXMucnVuX2V2ZW50X3NvdW5kKHtcbiAgICAgIHNvdW5kOiBcImp1bXBcIixcbiAgICAgIHg6IG9iai54LFxuICAgICAgeTogb2JqLnlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHNob290aW5nXG4gIGlmIChldmVudC50eXBlID09PSBcInNob290XCIpIHtcbiAgICB2YXIgd2VhcG9uID0gdGhpcy5jLndlYXBvbnNbZXZlbnQud2VhcG9uXTtcbiAgICB2YXIgd2VhcG9uX29iaiA9IHRoaXMuYy5vYmplY3RzW3dlYXBvbi5vYmplY3RdO1xuXG4gICAgLy8gYXJlIHdlIGZpcmluZyB0aGUgd2VhcG9uXG4gICAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgICB0aGlzLmRldG9uYXRpb25fY29vbGRvd24gPSBtaW4oMjAsIHdlYXBvbi5jb29sZG93bik7XG4gICAgICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSB0aGlzLndlYXBvbl9mb2xsb3cgPyBldmVudC5vYmogOiBcIlwiO1xuXG4gICAgICAvLyBvdGhlciBwbGF5ZXJzIHNob3RzXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBzaG90X29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gICAgICBpZiAoc2hvdF9vYmopIHtcbiAgICAgICAgc2hvdF9vYmouaGlkZSA9IDA7XG4gICAgICAgIHNob3Rfb2JqLmR4ID0gb2JqLmR4O1xuICAgICAgICBzaG90X29iai5keSA9IG9iai5keTtcbiAgICAgICAgb2JqLmJhcnJlbF9hbmdsZSA9IHRoaXMuY29yZS5tYXAuZ2V0X2hlYWRpbmcoXG4gICAgICAgICAgb2JqLngsXG4gICAgICAgICAgb2JqLnksXG4gICAgICAgICAgc2hvdF9vYmoueCxcbiAgICAgICAgICBzaG90X29iai55XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgYXJlIG5vdCBhIHBsYXllciBhbmQgYXV0byBmb2xsb3cgd2VhcG9uc1xuICAgIGlmICh0aGlzLnBsYXllcl9pZCA9PT0gbnVsbCkge1xuICAgICAgaWYgKG9iai5wbGF5ZXJfaWQgPT09IHBhcnNlSW50KHRoaXMubGVhZGVyKSAmJiB3ZWFwb24uYXV0b19mb2xsb3cpIHtcbiAgICAgICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gZXZlbnQub2JqO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHdlYXBvbiBqdXN0IGZpcmVkIHNwcml0ZVxuICAgIGlmICh3ZWFwb24uZmlyZV9zcHJpdGUpIHtcbiAgICAgIHZhciBzcHJpdGVfa2V5ID0gXCJhbnQtd2VhcG9uLVwiICsgd2VhcG9uLmZpcmVfc3ByaXRlO1xuICAgICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYy5hbmltYXRpb25zW3Nwcml0ZV9rZXkgKyBcIi1sZWZ0XCJdO1xuICAgICAgb2JqLmZpcmVfc3ByaXRlID0gc3ByaXRlX2tleTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZV9jb3VudCA9IGFuaW1hdGlvbiA/IGFuaW1hdGlvbi5sZW5ndGggKyAxIDogMTtcbiAgICAgIG9iai5maXJlX3Nwcml0ZV9mcmFtZSA9IHRoaXMuY29yZS5zdGF0ZS5mcmFtZTtcbiAgICB9XG5cbiAgICAvLyB3ZWFwb24gYm9keSBzcHJpdGVcbiAgICBpZiAod2VhcG9uLmZpcmVfYm9keV9zcHJpdGUpIHtcbiAgICAgIHZhciBjb29sID0gd2VhcG9uX29iai50aW1lb3V0XG4gICAgICAgID8gd2VhcG9uX29iai50aW1lb3V0ICsgNVxuICAgICAgICA6IHdlYXBvbi5jb29sZG93biArIDU7XG4gICAgICBvYmouZmlyZV9ib2R5X3Nwcml0ZSA9IFwiYW50LWJvZHktXCIgKyB3ZWFwb24uZmlyZV9ib2R5X3Nwcml0ZTtcbiAgICAgIG9iai5maXJlX2JvZHlfc3ByaXRlX2NvdW50ID0gY29vbDtcbiAgICB9XG5cbiAgICAvLyB3ZWFwb24gYW5nbGUgbG9ja1xuICAgIGlmICh3ZWFwb24uZmlyZV9hbmdsZV9sb2NrKSB7XG4gICAgICB2YXIgY29vbCA9IHdlYXBvbl9vYmoudGltZW91dFxuICAgICAgICA/IHdlYXBvbl9vYmoudGltZW91dCArIDVcbiAgICAgICAgOiB3ZWFwb24uY29vbGRvd24gKyA1O1xuICAgICAgb2JqLmZpcmVfZGlyZWN0aW9uID0gb2JqLmRpcmVjdGlvbjtcbiAgICAgIG9iai5maXJlX2FuZ2xlX2xvY2sgPSBvYmouYmFycmVsX2FuZ2xlO1xuICAgICAgb2JqLmZpcmVfYW5nbGVfbG9ja19jb3VudCA9IGNvb2w7XG4gICAgfVxuXG4gICAgLy8gcGxheSBzb3VuZCBlZmZlY3RcbiAgICB0aGlzLnBsYXlfd2VhcG9uX2F1ZGlvKHtcbiAgICAgIHg6IG9iai5keCxcbiAgICAgIHk6IG9iai5keSxcbiAgICAgIHBsYXllcl9pZDogb2JqLnBsYXllcl9pZCxcbiAgICAgIHdlYXBvbjogZXZlbnQud2VhcG9uXG4gICAgfSk7XG4gIH1cblxuICAvLyBjb2xsZWN0IGEgY3JhdGUgb3IgbWVkcGFja1xuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJjcmF0ZVwiIHx8IGV2ZW50LnR5cGUgPT09IFwibWVkcGFja1wiKSB7XG4gICAgLy8gcmVtb3ZlIHRoZSBvYmplY3RcbiAgICBpZiAodGhpcy5jb3JlLnN0YXRlLm9iamVjdHNbZXZlbnQub2JqXSkge1xuICAgICAgZGVsZXRlIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial07XG4gICAgfVxuXG4gICAgLy8gcGxheSBzb3VuZCBlZmZlY3RcbiAgICB0aGlzLnJ1bl9ldmVudF9zb3VuZCh7XG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgc291bmQ6IFwibG9ja25sb2FkXCJcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGNvbGxlY3RlZCBhIGdlbVxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJnZW1cIikge1xuICAgIC8vIHJlbW92ZSB0aGUgb2JqZWN0XG4gICAgaWYgKHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2V2ZW50Lm9ial0pIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tldmVudC5vYmpdO1xuICAgIH1cblxuICAgIC8vIHBsYXkgc291bmQgZWZmZWN0XG4gICAgdGhpcy5ydW5fZXZlbnRfc291bmQoe1xuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIHNvdW5kOiBcImJpbmdcIlxuICAgIH0pO1xuICB9XG59O1xuXG4vKiBTZXQgdGhpcyBwbGF5ZXIgcmVmZXJlbmNlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnNldF90aGlzX3BsYXllcl9yZWZzID0gZnVuY3Rpb24oKSB7XG4gIC8vIHNldCBwbGF5ZXIgcmVmXG4gIGlmICh0aGlzLmNvcmUuc3RhdGUucGxheWVyc1t0aGlzLnBsYXllcl9pZF0pIHtcbiAgICB0aGlzLnBsYXllciA9IHRoaXMuY29yZS5zdGF0ZS5wbGF5ZXJzW3RoaXMucGxheWVyX2lkXTtcbiAgfVxuXG4gIC8vIHNldCBvYmplY3QgcmVmXG4gIGlmICh0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHRoaXMucGxheWVyX2lkXSkge1xuICAgIHRoaXMucGxheWVyX29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW1wicGxheWVyLVwiICsgdGhpcy5wbGF5ZXJfaWRdO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFNjb3Jlc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIHNjb3JlIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9zY29yZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuc2NoZW1lLnNjb3JlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5kaXZfc2NvcmUgPSBlbGVtZW50KHsgY2xhc3M6IFwic2NvcmVcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9zY29yZSk7XG5cbiAgdGhpcy5kaXZfc2NvcmVfZ2VtID0gZWxlbWVudCh7IGNsYXNzOiBcImdlbVwiIH0pO1xuICB0aGlzLmRpdl9zY29yZV90ZXh0ID0gZWxlbWVudCh7IGNsYXNzOiBcInRleHRcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2X3Njb3JlLCB0aGlzLmRpdl9zY29yZV9nZW0pO1xuICBhcHBlbmQodGhpcy5kaXZfc2NvcmUsIHRoaXMuZGl2X3Njb3JlX3RleHQpO1xuXG4gIC8vIGFyZSB3ZSBkb2luZyBsZXZlbHNcbiAgaWYgKHRoaXMuc2NoZW1lLmxldmVscykge1xuICAgIHRoaXMuZGl2X3Njb3JlX2JhciA9IGVsZW1lbnQoeyBjbGFzczogXCJiYXJcIiB9KTtcbiAgICB0aGlzLmRpdl9zY29yZV9iYXJfaW4gPSBlbGVtZW50KHsgY2xhc3M6IFwiYmFyLWlubmVyXCIgfSk7XG4gICAgdGhpcy5kaXZfc2NvcmVfbGV2ZWwgPSBlbGVtZW50KHsgY2xhc3M6IFwibGV2ZWwgaGV4LWJ1dHRvblwiLCB0ZXh0OiBcIiBMVkxcIiB9KTtcbiAgICB0aGlzLmRpdl9zY29yZV9sZXZlbF9udW0gPSBlbGVtZW50KHsgY2xhc3M6IFwibGV2ZWwtbnVtXCIsIHRleHQ6IFwiMVwiIH0pO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfYmFyKTtcbiAgICBhcHBlbmQodGhpcy5kaXZfc2NvcmVfYmFyLCB0aGlzLmRpdl9zY29yZV9iYXJfaW4pO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZSwgdGhpcy5kaXZfc2NvcmVfbGV2ZWwpO1xuICAgIGFwcGVuZCh0aGlzLmRpdl9zY29yZV9sZXZlbCwgdGhpcy5kaXZfc2NvcmVfbGV2ZWxfbnVtKTtcbiAgfVxufTtcblxuLyogU2V0IHNjb3JlIGludGVyZmFjZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X3Njb3JlID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2NvcmUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLnBsYXllcikge1xuICAgIGhpZGUodGhpcy5kaXZfc2NvcmUpO1xuICAgIHJldHVybjtcbiAgfSBlbHNlIHtcbiAgICBzaG93KHRoaXMuZGl2X3Njb3JlKTtcbiAgfVxuXG4gIHRoaXMuZGl2X3Njb3JlX3RleHQuaW5uZXJIVE1MID0gdGhpcy5wbGF5ZXIuc2NvcmU7XG4gIGlmICh0aGlzLnNjaGVtZS5sZXZlbHMpIHtcbiAgICB0aGlzLmRpdl9zY29yZV9sZXZlbF9udW0uaW5uZXJIVE1MID0gdGhpcy5wbGF5ZXIubGV2ZWwgKyAxO1xuXG4gICAgLy8gZG8gZXhwIGJhclxuICAgIHZhciB3aWR0aCA9IDA7XG4gICAgdmFyIHRoaXNfbGV2ZWwgPSB0aGlzLnNjaGVtZS5sZXZlbHMuc2NvcmVbdGhpcy5wbGF5ZXIubGV2ZWxdO1xuICAgIHZhciBuZXh0X2xldmVsID0gdGhpcy5zY2hlbWUubGV2ZWxzLnNjb3JlW3RoaXMucGxheWVyLmxldmVsICsgMV07XG4gICAgaWYgKHRoaXNfbGV2ZWwgJiYgbmV4dF9sZXZlbCkge1xuICAgICAgd2lkdGggPSAoXG4gICAgICAgICgodGhpcy5wbGF5ZXIuc2NvcmUgLSB0aGlzX2xldmVsKSAvIChuZXh0X2xldmVsIC0gdGhpc19sZXZlbCkpICpcbiAgICAgICAgOTRcbiAgICAgICkuZml4ZWQoKTtcbiAgICB9XG4gICAgdGhpcy5kaXZfc2NvcmVfYmFyX2luLnN0eWxlLndpZHRoID0gd2lkdGggKyBcIiVcIjtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBUaW1lclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIEJ1aWxkIHRpbWUgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X3RpbWUgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLnNjaGVtZS5zaG93X3RpbWUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB0aW1lIGRpdnNcbiAgdGhpcy5kaXZfdGltZSA9IGVsZW1lbnQoeyBjbGFzczogXCJ0aW1lXCIgfSk7XG4gIHRoaXMuZGl2X3RpbWVvdXQgPSBlbGVtZW50KHsgY2xhc3M6IFwidGltZW91dFwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3RpbWUpO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3RpbWVvdXQpO1xuICBoaWRlKHRoaXMuZGl2X3RpbWVvdXQpO1xuXG4gIHRoaXMuZGlzcGxheV90aW1lID0gXCJcIjtcbn07XG5cbi8qIFJ1biB0aGUgdGltZSBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl90aW1lID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5zY2hlbWUuc2hvd190aW1lKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNlY3M7XG5cbiAgLy8gY291bnRpbmcgdXBcbiAgaWYgKHRoaXMuc2NoZW1lLnRpbWVfbGltaXQgPT09IDApIHtcbiAgICBzZWNzID0gZmxvb3IodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC8gMjQpO1xuXG4gICAgLy8gY291bnRpbmcgZG93blxuICB9IGVsc2Uge1xuICAgIHZhciBkaWYgPSB0aGlzLnNjaGVtZS50aW1lX2xpbWl0IC0gdGhpcy5jb3JlLnN0YXRlLmZyYW1lO1xuICAgIHNlY3MgPSBjZWlsKGRpZiAvIDI0KTtcblxuICAgIC8vIHRpbWVvdXRcbiAgICBpZiAoZGlmID09PSAyNDApIHtcbiAgICAgIHNob3codGhpcy5kaXZfdGltZW91dCk7XG4gICAgfVxuICAgIGlmIChkaWYgPD0gMjQwICYmIGRpZiAlIDI0ID09PSAwICYmIGRpZiA+IDEpIHtcbiAgICAgIHRoaXMuYXVkaW8ucGxheShcImJsb29wMlwiLCAwLjUpO1xuICAgIH1cbiAgICBpZiAoZGlmID09PSAxKSB7XG4gICAgICBoaWRlKHRoaXMuZGl2X3RpbWVvdXQpO1xuICAgIH1cbiAgICBpZiAoc2VjcyA8PSAxMCkge1xuICAgICAgaWYgKGRpZiAlIDI0ID09PSAwICYmIHNlY3MgPj0gMSkge1xuICAgICAgICB0aGlzLmRpdl90aW1lb3V0LmlubmVySFRNTCA9IHNlY3M7XG4gICAgICB9XG4gICAgICBpZiAoZGlmID09PSA5Nikge1xuICAgICAgICB0aGlzLmF1ZGlvLnBsYXkoXCJ0aW1lb3V0XCIsIDAuOCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gZG8gdGltZVxuICB2YXIgbmV3X3RpbWUgPSBcIjA6MDBcIjtcbiAgaWYgKHNlY3MgPiAwKSB7XG4gICAgdmFyIG1pbnV0ZXMgPSBmbG9vcihzZWNzIC8gNjApLFxuICAgICAgc2Vjb25kcyA9IChzZWNzIC0gbWludXRlcyAqIDYwKS50b1N0cmluZygpO1xuICAgIHNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA8IDIgPyBcIjBcIiArIHNlY29uZHMgOiBzZWNvbmRzO1xuICAgIG5ld190aW1lID0gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcbiAgfVxuICBpZiAodGhpcy5kaXNwbGF5X3RpbWUgIT09IG5ld190aW1lKSB7XG4gICAgdGhpcy5kaXNwbGF5X3RpbWUgPSBuZXdfdGltZTtcbiAgICB0aGlzLmRpdl90aW1lLmlubmVySFRNTCA9IG5ld190aW1lO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdEF1ZGlvXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxud2luZG93LkF1ZGlvQ29udGV4dCA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcblxuZnVuY3Rpb24gYXVkaW8oYXNzZXRzX3VybCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdGhpcy5jb250ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICB0aGlzLmJ1ZmZlcnMgPSB7fTtcbiAgdGhpcy5yZXBlYXRlcnMgPSB7fTtcbiAgdGhpcy52b2x1bWUgPSAwLjE7XG4gIHRoaXMuc3RvcmVkX3ZvbHVtZSA9IDAuMTtcblxuICAvLyBidXR0b24gaG92ZXIgc3dpc2ggZXZlbnRzXG4gIHRoaXMuYnV0dG9uX2hvdmVyID0gbnVsbDtcbiAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHNlbGYudm9sdW1lID09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYnV0dG9uXCIpIHx8XG4gICAgICBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gXCJidXR0b25cIlxuICAgICkge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldCAhPSBzZWxmLmJ1dHRvbl9ob3ZlciAmJlxuICAgICAgICAhZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZGlzYWJsZWRcIilcbiAgICAgICkge1xuICAgICAgICBzZWxmLmJ1dHRvbl9ob3ZlciA9IGUudGFyZ2V0O1xuICAgICAgICBzZWxmLnBsYXkoXCJibG9vcDFcIiwgMSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuYnV0dG9uX2hvdmVyID0gbnVsbDtcbiAgICB9XG4gIH07XG59XG5cbi8qIFNldCB2b2x1bWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuc2V0X2dsb2JhbF92b2x1bWUgPSBmdW5jdGlvbih2b2wpIHtcbiAgdGhpcy52b2x1bWUgPSB2b2w7XG59O1xuXG4vKiBBZGQgYnVmZmVyc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmF1ZGlvLnByb3RvdHlwZS5hZGRfYnVmZmVycyA9IGZ1bmN0aW9uKGJ1ZmZlcnMpIHtcbiAgdGhpcy5idWZmZXJzID0gT2JqZWN0LmFzc2lnbih0aGlzLmJ1ZmZlcnMsIGJ1ZmZlcnMpO1xufTtcblxuLyogUGxheSBhIGZpbGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKGtleSwgdm9sdW1lLCByZXBlYXQpIHtcbiAgLy8gaWYgbm8gc291bmQgZWZmZWN0XG4gIGlmICghdGhpcy5idWZmZXJzW2tleV0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpZiB3ZSdyZSBub3QgYWN0aXZlXG4gIGlmICghZG9jdW1lbnQuaGFzRm9jdXMoKSAmJiBrZXkgIT09IFwiam9pblwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG9iaiA9IHt9O1xuICBvYmouYXVkaW9fa2V5ID0ga2V5O1xuICBvYmouZ2FpbiA9IHRoaXMuY29udC5jcmVhdGVHYWluKCk7XG4gIG9iai5zb3VyY2UgPSB0aGlzLmNvbnQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gIG9iai5zb3VyY2UuYnVmZmVyID0gdGhpcy5idWZmZXJzW2tleV07XG4gIG9iai5zb3VyY2UuY29ubmVjdChvYmouZ2Fpbik7XG4gIG9iai5nYWluLmNvbm5lY3QodGhpcy5jb250LmRlc3RpbmF0aW9uKTtcbiAgb2JqLnNvdXJjZS5sb29wID0gcmVwZWF0O1xuICBvYmouc291cmNlLnN0YXJ0KDApO1xuXG4gIHRoaXMuc2V0X3ZvbHVtZShvYmosIHZvbHVtZSk7XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cbi8qIFNldCB2b2x1bWVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuc2V0X3ZvbHVtZSA9IGZ1bmN0aW9uKG9iaiwgdm9sdW1lKSB7XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZvbHVtZSA9ICF2b2x1bWUgPyAwIDogbWluKHZvbHVtZSwgMSk7XG4gIG9iai5nYWluLmdhaW4udmFsdWUgPSAodm9sdW1lICogdGhpcy52b2x1bWUpLmZpeGVkKCk7XG59O1xuXG4vKiBTdG9wIHBsYXlpbmcgYXVkaW9cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5hdWRpby5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKG9iaikge1xuICB0aGlzLmNvbnQuY2xvc2UoKTtcbiAgdGhpcy5jb250ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRFbGVtZW50IEZ1bmN0aW9uc1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIGVsZW1lbnQocHJvcHMpIHtcbiAgLy8gY3JlYXRlIHRoZSBlbGVtZW50XG4gIHZhciB0eXBlID0gcHJvcHMudHlwZSA/IHByb3BzLnR5cGUgOiBcImRpdlwiLFxuICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTtcblxuICAvLyBzZXQgcHJvcGVydGllc1xuICBpZiAocHJvcHMuaWQpIHtcbiAgICBlbC5pZCA9IHByb3BzLmlkO1xuICB9XG4gIGlmIChwcm9wcy5zcmMpIHtcbiAgICBlbC5zcmMgPSBwcm9wcy5zcmM7XG4gIH1cbiAgaWYgKHByb3BzLmludHlwZSkge1xuICAgIGVsLnR5cGUgPSBwcm9wcy5pbnR5cGU7XG4gIH1cbiAgaWYgKHByb3BzLmNsYXNzKSB7XG4gICAgZWwuY2xhc3NOYW1lID0gcHJvcHMuY2xhc3M7XG4gIH1cbiAgaWYgKHByb3BzLnRleHQpIHtcbiAgICBlbC5pbm5lckhUTUwgPSBwcm9wcy50ZXh0O1xuICB9XG4gIGlmIChwcm9wcy52YWx1ZSkge1xuICAgIGVsLnZhbHVlID0gcHJvcHMudmFsdWU7XG4gIH1cbiAgaWYgKHByb3BzLmRhdGEpIHtcbiAgICBlbC5kYXRhc2V0LmRhdGEgPSBwcm9wcy5kYXRhO1xuICB9XG4gIGlmIChwcm9wcy5wbGFjZWhvbGRlcikge1xuICAgIGVsLnBsYWNlaG9sZGVyID0gcHJvcHMucGxhY2Vob2xkZXI7XG4gIH1cbiAgaWYgKHByb3BzLm1heGxlbmd0aCkge1xuICAgIGVsLm1heExlbmd0aCA9IHByb3BzLm1heGxlbmd0aDtcbiAgfVxuICBpZiAocHJvcHMuaHJlZikge1xuICAgIGVsLmhyZWYgPSBwcm9wcy5ocmVmO1xuICB9XG5cbiAgcmV0dXJuIGVsO1xufVxuXG5mdW5jdGlvbiBzZWxlY3QoaWQpIHtcbiAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbn1cblxuZnVuY3Rpb24gaGlkZShlbCkge1xuICBlbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG59XG5cbmZ1bmN0aW9uIHNob3coZWwpIHtcbiAgZWwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlKGVsKSB7XG4gIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xufVxuXG5mdW5jdGlvbiBlbXB0eShlbCkge1xuICB3aGlsZSAoZWwuZmlyc3RDaGlsZCkge1xuICAgIGVsLnJlbW92ZUNoaWxkKGVsLmZpcnN0Q2hpbGQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFwcGVuZChwYXJlbnQsIGNoaWxkKSB7XG4gIHBhcmVudC5hcHBlbmRDaGlsZChjaGlsZCk7XG59XG5cbmZ1bmN0aW9uIGFkZF9jbGFzcyhlbCwgY2xhc3NfbmFtZSkge1xuICB2YXIgc3BsaXQgPSBlbC5jbGFzc05hbWUuc3BsaXQoXCIgXCIpO1xuICBpZiAoIXNwbGl0LmluY2x1ZGVzKGNsYXNzX25hbWUpKSB7XG4gICAgc3BsaXQucHVzaChjbGFzc19uYW1lKTtcbiAgfVxuICBlbC5jbGFzc05hbWUgPSBzcGxpdC5qb2luKFwiIFwiKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlX2NsYXNzKGVsLCBjbGFzc19uYW1lKSB7XG4gIHZhciBzcGxpdCA9IGVsLmNsYXNzTmFtZS5zcGxpdChcIiBcIiksXG4gICAgaSA9IHNwbGl0LmluZGV4T2YoY2xhc3NfbmFtZSk7XG4gIGlmIChpICE9IC0xKSB7XG4gICAgc3BsaXQuc3BsaWNlKGksIDEpO1xuICB9XG4gIGVsLmNsYXNzTmFtZSA9IHNwbGl0LmpvaW4oXCIgXCIpO1xufVxuXG5mdW5jdGlvbiBkaXNwbGF5X3RpbWUoZnJhbWVzKSB7XG4gIHZhciBzZWNzID0gZmxvb3IoZnJhbWVzIC8gMzApO1xuICB2YXIgbWludXRlcyA9IGZsb29yKHNlY3MgLyA2MCk7XG4gIHZhciBzZWNvbmRzID0gKHNlY3MgLSBtaW51dGVzICogNjApLnRvU3RyaW5nKCk7XG4gIHNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA8IDIgPyBcIjBcIiArIHNlY29uZHMgOiBzZWNvbmRzO1xuICByZXR1cm4gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcbn1cblxuZnVuY3Rpb24gZGVidWcoczEsIHMyLCBzMywgczQsIHM1LCBzNiwgczcsIHM4LCBzOSwgYnIpIHtcbiAgdmFyIGUgPSBzZWxlY3QoXCJkZWJ1Z1wiKTtcbiAgaWYgKGJyKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCI8YnI+XCI7XG4gIH0gZWxzZSB7XG4gICAgZS5pbm5lckhUTUwgPSBcIlwiO1xuICB9XG4gIGlmIChzMSAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBzMTtcbiAgfVxuICBpZiAoczIgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHMyO1xuICB9XG4gIGlmIChzMyAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczM7XG4gIH1cbiAgaWYgKHM0ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzNDtcbiAgfVxuICBpZiAoczUgIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM1O1xuICB9XG4gIGlmIChzNiAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczY7XG4gIH1cbiAgaWYgKHM3ICE9IHVuZGVmaW5lZCkge1xuICAgIGUuaW5uZXJIVE1MICs9IFwiIHwgXCIgKyBzNztcbiAgfVxuICBpZiAoczggIT0gdW5kZWZpbmVkKSB7XG4gICAgZS5pbm5lckhUTUwgKz0gXCIgfCBcIiArIHM4O1xuICB9XG4gIGlmIChzOSAhPSB1bmRlZmluZWQpIHtcbiAgICBlLmlubmVySFRNTCArPSBcIiB8IFwiICsgczk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZGVidWdicihzMSwgczIsIHMzLCBzNCwgczUsIHM2LCBzNywgczgsIHM5KSB7XG4gIGRlYnVnKHMxLCBzMiwgczMsIHM0LCBzNSwgczYsIHM3LCBzOCwgczksIHRydWUpO1xufVxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdElucHV0XG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuZnVuY3Rpb24gaW5wdXQoY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG5cbiAgLy8gZGVmYXVsdCBhY3Rpb24ga2V5c1xuICB0aGlzLmFjdGlvbl9rZXlzID0ge1xuICAgIG1vdmU6IFtcIjBcIl0sIC8vIGNsaWNrXG4gICAgc2hvb3Q6IFtcIjJcIiwgW1wiMFwiLCBcIjE3XCJdLCBbXCIwXCIsIFwiMThcIl0sIFtcIjBcIiwgXCI5MVwiXV0sIC8vIGNsaWNrLCBjdHJsLCBhbHQsIGNtZFxuICAgIGp1bXA6IFtcIjMyXCJdLCAvLyBzcGFjZVxuICAgIHN3aXRjaF93YXRjaGVyX2NhbWVyYTogW1wiODBcIl0sIC8vIHBcbiAgICBmb2xsb3dfd2VhcG9uOiBbXCI3MFwiXSwgLy8gZlxuICAgIGZvbGxvd19tb3VzZTogW1wiMVwiXSwgLy8gbWlkZGxlIGNsaWNrXG4gICAgLy8gbW92ZV9sZWZ0OiBbXCIzN1wiLCBcIjY1XCJdLCAvLyBsZWZ0LCBhXG4gICAgLy8gbW92ZV91cDogW1wiMzhcIiwgXCI4N1wiXSwgLy8gdXAsIHdcbiAgICAvLyBtb3ZlX3JpZ2h0OiBbXCIzOVwiLCBcIjY4XCJdLCAvLyByaWdodCwgZFxuICAgIC8vIG1vdmVfZG93bjogW1wiNDBcIiwgXCI4M1wiXSwgLy8gZG93biwgc1xuICAgIHNob3dfc2V0dGluZ3M6IFtcIjI3XCIsIFwiMTNcIl0sIC8vIGVzYywgZW50ZXJcbiAgICB3ZWFwb25fc2VsZWN0XzE6IFtcIjQ5XCJdLCAvLyAxXG4gICAgd2VhcG9uX3NlbGVjdF8yOiBbXCI1MFwiXSwgLy8gMlxuICAgIHdlYXBvbl9zZWxlY3RfMzogW1wiNTFcIl0sIC8vIDNcbiAgICB3ZWFwb25fc2VsZWN0XzQ6IFtcIjUyXCJdLCAvLyA0XG4gICAgd2VhcG9uX3NlbGVjdF81OiBbXCI1M1wiXSwgLy8gNVxuICAgIHdlYXBvbl9zZWxlY3RfNjogW1wiNTRcIl0sIC8vIDZcbiAgICB3ZWFwb25fc2VsZWN0Xzc6IFtcIjU1XCJdLCAvLyA3XG4gICAgd2VhcG9uX3NlbGVjdF84OiBbXCI1NlwiXSwgLy8gOFxuICAgIHdlYXBvbl9zZWxlY3RfOTogW1wiNTdcIl0gLy8gOVxuICB9O1xuXG4gIC8vIHNldCB1cCByZWZlcmVuY2UgZm9yIHByZXNzZWQga2V5IGNvZGVzXG4gIHRoaXMua2V5X2NvZGVzID0ge307XG5cbiAgLy8gY3Vyc29yXG4gIHRoaXMuY3Vyc29yX21vdmVkID0gZmFsc2U7XG4gIHRoaXMuY3Vyc29yID0geyB4OiAwLCB5OiAwIH07XG5cbiAgLy8gc2V0IGN1cnNvciBwb2ludHNcbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwiZ2FtZV9pbnB1dFwiKSB7XG4gICAgICBzZWxmLmlucHV0X2N1cnNvcihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgfVxuICB9O1xuXG4gIC8vIHByZXZlbnQgZGVmYXVsdCByaWdodCBjbGljayBiZWhhdmlvdXJcbiAgZG9jdW1lbnQuYm9keS5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLy8gbWFuYWdlIGNsaWNrIGV2ZW50c1xuICBkb2N1bWVudC5ib2R5Lm9ubW91c2Vkb3duID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5pZCA9PT0gXCJnYW1lX2lucHV0XCIpIHtcbiAgICAgIHNlbGYuaW5wdXRfYnV0dG9uKGUuYnV0dG9uLCBcImRvd25cIik7XG4gICAgfVxuICAgIGlmIChlLmJ1dHRvbiA9PSAxKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuICBkb2N1bWVudC5ib2R5Lm9ubW91c2V1cCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxmLmlucHV0X2J1dHRvbihlLmJ1dHRvbiwgXCJ1cFwiKTtcbiAgfTtcblxuICB0aGlzLnNpbmdsZVRhcHBlZCA9IGZhbHNlO1xuICB0aGlzLmRvdWJsZVRhcHBlZCA9IGZhbHNlO1xuICB0aGlzLndhaXRpbmdGb3JEb3VibGUgPSBmYWxzZTtcbiAgdGhpcy50d29GaW5nZXJUYXAgPSBmYWxzZTtcblxuICBkb2N1bWVudC5ib2R5Lm9udG91Y2hzdGFydCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwiZ2FtZV9pbnB1dFwiKSB7XG4gICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbZS50b3VjaGVzLmxlbmd0aCAtIDFdO1xuICAgICAgc2VsZi5pbnB1dF9jdXJzb3IodG91Y2guY2xpZW50WCwgdG91Y2guY2xpZW50WSk7XG4gICAgICBzZWxmLnNpbmdsZVRhcHBlZCA9IHRydWU7XG4gICAgICBjb25zb2xlLmxvZyhlLnRvdWNoZXMubGVuZ3RoKTtcbiAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICBzZWxmLnR3b0ZpbmdlclRhcCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoc2VsZi53YWl0aW5nRm9yRG91YmxlKSB7XG4gICAgICAgICAgc2VsZi5kb3VibGVUYXBwZWQgPSB0cnVlO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmRvdWJsZVRhcHBlZCA9IGZhbHNlO1xuICAgICAgICAgIH0sIDIwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYud2FpdGluZ0ZvckRvdWJsZSA9IHRydWU7XG4gICAgICB9XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLndhaXRpbmdGb3JEb3VibGUgPSBmYWxzZTtcbiAgICAgIH0sIDMwMCk7XG4gICAgfVxuICB9XG5cbiAgZG9jdW1lbnQuYm9keS5vbnRvdWNoZW5kID0gZnVuY3Rpb24oZSkge1xuICAgIHNlbGYuc2luZ2xlVGFwcGVkID0gZmFsc2U7XG4gICAgc2VsZi50d29GaW5nZXJUYXAgPSBmYWxzZTtcbiAgfVxuXG4gIGRvY3VtZW50LmJvZHkub250b3VjaG1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmlkID09PSBcImdhbWVfaW5wdXRcIikge1xuICAgICAgdmFyIHRvdWNoID0gZS50b3VjaGVzW2UudG91Y2hlcy5sZW5ndGggLSAxXTtcbiAgICAgIHNlbGYuaW5wdXRfY3Vyc29yKHRvdWNoLmNsaWVudFgsIHRvdWNoLmNsaWVudFkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHNlbGYuaW5wdXRfY3Vyc29yKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcblxuICAvLyBtYW5hZ2UgdG91Y2ggZXZlbnRzXG5cblxuICAvLyBtb3VzZSB3aGVlbFxuICAvLyBpZiAoXCJvbm1vdXNld2hlZWxcIiBpbiBkb2N1bWVudC5ib2R5KSB7XG4gIC8vICAgZG9jdW1lbnQuYm9keS5vbm1vdXNld2hlZWwgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgICBlLnByZXZlbnREZWZhdWx0ICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgLy8gICAgIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgLy8gICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgLy8gICAgIHNlbGYuc2Nyb2xsX3doZWVsKGUpO1xuICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAvLyAgIH07XG4gIC8vIH0gZWxzZSB7XG4gIC8vICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwiRE9NTW91c2VTY3JvbGxcIiwgZnVuY3Rpb24oZSkge1xuICAvLyAgICAgc2VsZi5zY3JvbGxfd2hlZWwoZSk7XG4gIC8vICAgfSk7XG4gIC8vIH1cblxuICAvLyBtYW5hZ2Uga2V5Ym9hcmQgZXZlbnRzXG4gIGRvY3VtZW50LmJvZHkub25rZXlkb3duID0gZnVuY3Rpb24oZSkge1xuICAgIHNlbGYuaW5wdXRfYnV0dG9uKGUua2V5Q29kZSwgXCJkb3duXCIpO1xuICB9O1xuICBkb2N1bWVudC5ib2R5Lm9ua2V5dXAgPSBmdW5jdGlvbihlKSB7XG4gICAgc2VsZi5pbnB1dF9idXR0b24oZS5rZXlDb2RlLCBcInVwXCIpO1xuICB9O1xuXG4gIC8vIHR1cm4gb2ZmIGlucHV0IHdoZW4gd2luZG93IGlzIG5vdCBmb2N1c2VkXG4gIHdpbmRvdy5vbmJsdXIgPSBmdW5jdGlvbigpIHtcbiAgICBzZWxmLmlucHV0X3Jlc2V0KCk7XG4gIH07XG59XG5cbi8qIElzIGFuIGFjdGlvbiBhY3RpdmVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuYWN0aXZlID0gZnVuY3Rpb24odHlwZSkge1xuICAvLyB0b3VjaFxuICBpZiAodHlwZSA9PT0gJ2p1bXAnICYmIHRoaXMudHdvRmluZ2VyVGFwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHR5cGUgPT09ICdzaG9vdCcgJiYgdGhpcy5kb3VibGVUYXBwZWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAodHlwZSA9PT0gJ21vdmUnICYmIHRoaXMuc2luZ2xlVGFwcGVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBtb3VzZSBrZXlib2FyZFxuICBjb25zdCBhY3Rpb24gPSB0aGlzLmFjdGlvbl9rZXlzW3R5cGVdO1xuICBpZiAoIWFjdGlvbikge1xuICAgIHJldHVybjtcbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdGlvbi5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNvZGVzID0gYWN0aW9uW2ldO1xuICAgIGlmIChBcnJheS5pc0FycmF5KGNvZGVzKSkge1xuICAgICAgbGV0IHRyaWdnZXIgPSB0cnVlO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGNvZGVzLmxlbmd0aDsgaTIrKykge1xuICAgICAgICBjb25zdCBjb2RlID0gY29kZXNbaTJdO1xuICAgICAgICBpZiAoIXRoaXMua2V5X2NvZGVzW2NvZGVdKSB7XG4gICAgICAgICAgdHJpZ2dlciA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodHJpZ2dlcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMua2V5X2NvZGVzW2NvZGVzXSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qIEZpbmQgdGhlIGFjdGlvbiBvZiBhIGNvZGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5pbnB1dC5wcm90b3R5cGUuZmluZF9hY3Rpb24gPSBmdW5jdGlvbihjb2RlKSB7XG4gIGNvbnN0IGFjdGlvbnMgPSBbXTtcbiAgZm9yIChsZXQga2V5IGluIHRoaXMuYWN0aW9uX2tleXMpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYWN0aW9uX2tleXNba2V5XS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY29kZXMgPSB0aGlzLmFjdGlvbl9rZXlzW2tleV1baV07XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY29kZXMpICYmIFN0cmluZyhjb2RlcykgPT09IFN0cmluZyhjb2RlKSkge1xuICAgICAgICBjb25zdCBvYmogPSB7IHR5cGU6IGtleSB9O1xuICAgICAgICAvLyBpZiAoa2V5ID09IFwic2hvd19zZXR0aW5nc1wiKSB7XG4gICAgICAgIC8vICAgaWYgKHRoaXMuYWN0aW9ucy5zaG9vdCkge1xuICAgICAgICAvLyAgICAgcmV0dXJuIFtdO1xuICAgICAgICAvLyAgIH1cbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIHBsZWFzZSBkb24ndCB0ZWxsIGFueWJvZHkgSSBkaWQgdGhpc1xuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF8xXCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF8yXCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF8zXCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF80XCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gMztcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF81XCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gNDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF82XCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gNTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF83XCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gNjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF84XCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gNztcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09IFwid2VhcG9uX3NlbGVjdF85XCIpIHtcbiAgICAgICAgICBvYmoudHlwZSA9IFwid2VhcG9uX3NlbGVjdFwiO1xuICAgICAgICAgIG9iai5uID0gODtcbiAgICAgICAgfVxuICAgICAgICBhY3Rpb25zLnB1c2gob2JqKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFjdGlvbnM7XG59O1xuXG4vKiBQcm9jZXNzIGlucHV0IGV2ZW50c1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5pbnB1dF9idXR0b24gPSBmdW5jdGlvbihjb2RlLCB0eXBlKSB7XG4gIC8vIGlnbm9yZSBpbnB1dCBvbiBhIHRleHQgYm94XG4gIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHR5cGUgPT0gXCJ1cFwiKSB7XG4gICAgdGhpcy5rZXlfY29kZXNbY29kZV0gPSBmYWxzZTtcbiAgfVxuICBpZiAodHlwZSA9PSBcImRvd25cIikge1xuICAgIHRoaXMua2V5X2NvZGVzW2NvZGVdID0gdHJ1ZTtcbiAgICBjb25zdCBhY3Rpb25zID0gdGhpcy5maW5kX2FjdGlvbihjb2RlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuY2FsbGJhY2soYWN0aW9uc1tpXSk7XG4gICAgfVxuICB9XG59O1xuXG4vKiBDdXJzb3IgbW92ZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuaW5wdXQucHJvdG90eXBlLmlucHV0X2N1cnNvciA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgdGhpcy5jdXJzb3JfbW92ZWQgPSB0cnVlO1xuICB0aGlzLmN1cnNvci54ID0geDtcbiAgdGhpcy5jdXJzb3IueSA9IHk7XG59O1xuXG4vKiBTY3JvbGwgd2hlZWxcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5zY3JvbGxfd2hlZWwgPSBmdW5jdGlvbihlKSB7XG4gIC8vIG5vcm1hbGl6ZSBkZWx0YSBmb3IgY3Jvc3MgYnJvd3NlclxuICB2YXIgZCA9IGUuZGV0YWlsLFxuICAgIHcgPSBlLndoZWVsRGVsdGEsXG4gICAgZCA9IGQgPyAodyAmJiAoZiA9IHcgLyBkKSA/IGQgLyBmIDogLWQgLyAxLjM1KSA6IHcgLyAxMjA7XG5cbiAgLy8gdXAgb3IgZG93blxuICB2YXIgZG93biA9IGQgPCAwID8gdHJ1ZSA6IGZhbHNlO1xuXG4gIC8vIGV2ZW50XG4gIHRoaXMuY2FsbGJhY2soeyB0eXBlOiBcIndlYXBvbl9zY3JvbGxcIiwgZG93bjogZG93biB9KTtcbn07XG5cbi8qIFJlc2V0IGFjdGlvbnNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmlucHV0LnByb3RvdHlwZS5pbnB1dF9yZXNldCA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKGtleSBpbiB0aGlzLmtleV9jb2Rlcykge1xuICAgIHRoaXMua2V5X2NvZGVzW2tleV0gPSBmYWxzZTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRBc3NldCBMb2FkZXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBsb2FkZXIoYXNzZXRzX3VybCwgYXNzZXRzLCBvbmxvYWQpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIC8vIHNldCB1cCBsb2FkaW5nIHZhbHVlc1xuICB0aGlzLm9ubG9hZCA9IG9ubG9hZDtcbiAgdGhpcy5vdXRwdXQgPSB7fTtcbiAgdGhpcy5sb2FkZWQgPSAwO1xuICB0aGlzLmNvdW50ID0gMDtcbiAgZm9yICh2YXIgdHlwZSBpbiBhc3NldHMpIHtcbiAgICB0aGlzLmNvdW50ICs9IE9iamVjdC5rZXlzKGFzc2V0c1t0eXBlXSkubGVuZ3RoO1xuICAgIHRoaXMub3V0cHV0W3R5cGVdID0ge307XG4gIH1cblxuICAvLyBzZXQgdXAgYXVkaW9cbiAgaWYgKGFzc2V0cy5hdWRpbykge1xuICAgIGlmIChPYmplY3Qua2V5cyhhc3NldHMuYXVkaW8pLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuYXVkaW9fY29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgICB9XG4gIH1cblxuICAvLyBkbyB0aGUgbG9hZGluZ1xuICBmb3IgKHZhciB0eXBlIGluIGFzc2V0cykge1xuICAgIGZvciAodmFyIGtleSBpbiBhc3NldHNbdHlwZV0pIHtcbiAgICAgIHZhciB1cmwgPSBhc3NldHNfdXJsICsgYXNzZXRzW3R5cGVdW2tleV07XG4gICAgICBpZiAodHlwZSA9PSBcImpzb25cIikge1xuICAgICAgICB0aGlzLmpzb24odXJsLCB0eXBlLCBrZXkpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT0gXCJpbWdcIikge1xuICAgICAgICB0aGlzLmltYWdlKHVybCwgdHlwZSwga2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09IFwiYXVkaW9cIikge1xuICAgICAgICB0aGlzLmF1ZGlvKHVybCwgdHlwZSwga2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLyogTG9hZCBKU09OXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubG9hZGVyLnByb3RvdHlwZS5qc29uID0gZnVuY3Rpb24odXJsLCB0eXBlLCBrZXkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHJlcXVlc3Qub3ZlcnJpZGVNaW1lVHlwZShcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gIHJlcXVlc3Qub3BlbihcIkdFVFwiLCB1cmwsIHRydWUpO1xuICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT0gNCAmJiByZXF1ZXN0LnN0YXR1cyA9PSBcIjIwMFwiKSB7XG4gICAgICB2YXIgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgICAgIHNlbGYub3V0cHV0W3R5cGVdW2tleV0gPSByZXNwb25zZTtcbiAgICAgIHNlbGYuY2hlY2tfbG9hZGVkKCk7XG4gICAgfVxuICB9O1xuICByZXF1ZXN0LnNlbmQobnVsbCk7XG59O1xuXG4vKiBMb2FkIEltYWdlXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubG9hZGVyLnByb3RvdHlwZS5pbWFnZSA9IGZ1bmN0aW9uKHVybCwgdHlwZSwga2V5KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICB0aGlzLm91dHB1dFt0eXBlXVtrZXldID0gbmV3IEltYWdlKCk7XG4gIHRoaXMub3V0cHV0W3R5cGVdW2tleV0uc3JjID0gdXJsO1xuXG4gIC8vIHdoZW4gaW1hZ2UgaXMgbG9hZGVkXG4gIHRoaXMub3V0cHV0W3R5cGVdW2tleV0ub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5jaGVja19sb2FkZWQoKTtcbiAgfTtcbn07XG5cbi8qIExvYWQgQXVkaW9cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5sb2FkZXIucHJvdG90eXBlLmF1ZGlvID0gZnVuY3Rpb24odXJsLCB0eXBlLCBrZXkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHJlcXVlc3Qub3BlbihcIkdFVFwiLCB1cmwsIHRydWUpO1xuICByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcbiAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICBzZWxmLmF1ZGlvX2NvbnRleHQuZGVjb2RlQXVkaW9EYXRhKHJlcXVlc3QucmVzcG9uc2UsIGZ1bmN0aW9uKGJ1ZmZlcikge1xuICAgICAgaWYgKGJ1ZmZlcikge1xuICAgICAgICB2YXIgZmlsZSA9IHNlbGYuYXVkaW9fY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgZmlsZS5idWZmZXIgPSBidWZmZXI7XG4gICAgICAgIGZpbGUuY29ubmVjdChzZWxmLmF1ZGlvX2NvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgIHZhciBnYWluID0gc2VsZi5hdWRpb19jb250ZXh0LmNyZWF0ZUdhaW4oKTtcbiAgICAgICAgZmlsZS5jb25uZWN0KGdhaW4pO1xuICAgICAgICBnYWluLmNvbm5lY3Qoc2VsZi5hdWRpb19jb250ZXh0LmRlc3RpbmF0aW9uKTtcblxuICAgICAgICBmaWxlLmxvb3AgPSB0cnVlO1xuXG4gICAgICAgIC8vIGdhaW4uZ2Fpbi52YWx1ZSA9IDE7XG4gICAgICAgIC8vIGZpbGUuc3RhcnQoMCk7XG5cbiAgICAgICAgLy8gdGhpcy5maWxlc1trZXldID0gdGhpcy5jb250LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICAvLyB0aGlzLmZpbGVzW2tleV0uYnVmZmVyID0gZmlsZXNba2V5XTtcbiAgICAgICAgLy8gdGhpcy5maWxlc1trZXldLmNvbm5lY3QodGhpcy5jb250LmRlc3RpbmF0aW9uKTtcblxuICAgICAgICAvLyAvLyBzZXQgdXAgZ2FpbiBub2RlXG4gICAgICAgIC8vIHRoaXMuZ2FpbltrZXldID0gdGhpcy5jb250LmNyZWF0ZUdhaW4oKTtcbiAgICAgICAgLy8gdGhpcy5maWxlc1trZXldLmNvbm5lY3QodGhpcy5nYWluW2tleV0pO1xuICAgICAgICAvLyB0aGlzLmdhaW5ba2V5XS5jb25uZWN0KHRoaXMuY29udC5kZXN0aW5hdGlvbik7XG5cbiAgICAgICAgc2VsZi5vdXRwdXQuYXVkaW9ba2V5XSA9IGJ1ZmZlcjtcbiAgICAgICAgc2VsZi5jaGVja19sb2FkZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcmVxdWVzdC5zZW5kKG51bGwpO1xufTtcblxuLyogQ2hlY2sgQXNzZXRzIEFyZSBMb2FkZWRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5sb2FkZXIucHJvdG90eXBlLmNoZWNrX2xvYWRlZCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmxvYWRlZCsrO1xuXG4gIC8vIGlmIHdlIGFyZSBub3QgcmVhZHkgeWV0XG4gIGlmICh0aGlzLmNvdW50IDw9IHRoaXMubG9hZGVkKSB7XG4gICAgdGhpcy5vbmxvYWQodGhpcy5vdXRwdXQpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgT25ib2FyZGluZ1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIG9uYm9hcmRpbmcoKSB7XG4gIHRoaXMuY291bnQgPSAwO1xuICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgdGhpcy5hY3Rpb24gPSB7XG4gICAgbW92ZTogZmFsc2UsXG4gICAganVtcDogZmFsc2UsXG4gICAgc2hvb3Q6IGZhbHNlXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgdGhpcy5jb3VudCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicGFudHNfb25ib2FyZGluZ1wiKSB8fCAwO1xuICAgIHRoaXMuZG9uZSA9IHRoaXMuY291bnQgPiAxO1xuICB9XG59XG5cbi8qIFRyaWdnZXIgb25ib2FyZGluZ25lc3Ncblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5vbmJvYXJkaW5nLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbih0eXBlKSB7XG4gIGlmICh0aGlzLmRvbmUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5hY3Rpb25bdHlwZV0gPSB0cnVlO1xuICBmb3IgKGxldCBrZXkgaW4gdGhpcy5hY3Rpb24pIHtcbiAgICBpZiAoIXRoaXMuYWN0aW9uW2tleV0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgdGhpcy5kb25lID0gdHJ1ZTtcbiAgaWYgKHR5cGVvZiBTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJwYW50c19vbmJvYXJkaW5nXCIsIHRoaXMuY291bnQgKyAxKTtcbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFNvY2tldCBNZXNzYWdlc1xuICAgIGhhbmRsZSBjb25uZWN0aW9uIGFuZCBtZXNzYWdlIGRhdGEgdG8gYW5kIGZyb20gdGhlIHNlcnZlclxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbmZ1bmN0aW9uIFNvY2tldENvbm5lY3Rpb24oY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIC8vIHNvY2tldCBjb25uZWN0aW9uXG4gIGlmICghaW8ub24pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5pbyA9IGlvKERPTUFJTiArIFwiOlwiICsgUE9SVCk7XG4gIHRoaXMuaW8ub24oXCJtZXNzYWdlXCIsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICBzZWxmLm1lc3NhZ2VfcmVjZWl2ZShtZXNzYWdlKTtcbiAgfSk7XG4gIHRoaXMuaW8ub24oXCJkaXNjb25uZWN0XCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGxiYWNrKHsgdHlwZTogXCJ3YWl0X2Zvcl9jb25uZWN0aW9uXCIgfSk7XG4gIH0pO1xuXG4gIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcblxuICAvLyBpZHNcbiAgdGhpcy5tZXNzYWdlX3JlY2VpdmVfaWRzID0gW1xuICAgIFwiZnVsbFwiLFxuICAgIFwiY29ubmVjdGVkXCIsXG4gICAgXCJwbGF5ZXJfam9pblwiLFxuICAgIFwicGxheWVyX2xlYXZlXCIsXG4gICAgXCJnYW1lX3dhaXRcIixcbiAgICBcImdhbWVfc3RhcnRcIixcbiAgICBcImdhbWVfZW5kXCIsXG4gICAgXCJnYW1lX3N0YXRlXCIsXG4gICAgXCJwaW5nXCJcbiAgXTtcblxuICB0aGlzLm1lc3NhZ2Vfc2VuZF9pZHMgPSBbXG4gICAgXCJ3YXRjaGVyXCIsXG4gICAgXCJzZW5kX25hbWVcIixcbiAgICBcInBsYXllcl9pbnB1dFwiLFxuICAgIFwid2VhcG9uX3NlbGVjdGVkXCIsXG4gICAgXCJyZXNwYXduXCIsXG4gICAgXCJwaW5nXCJcbiAgXTtcblxuICAvLyBzdHJpbmcgc2VwYXJhdG9yXG4gIHRoaXMubWVzc2FnZV9zZXBhcmF0b3IgPSBcInxcIjtcbn1cblxuLyogU2VuZCBtZXNzYWdlcyB0byBzZXJ2ZXJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5Tb2NrZXRDb25uZWN0aW9uLnByb3RvdHlwZS5tZXNzYWdlX3NlbmQgPSBmdW5jdGlvbih0eXBlLCBwcm9wcykge1xuICB2YXIgaSA9IHRoaXMubWVzc2FnZV9zZW5kX2lkcy5pbmRleE9mKHR5cGUpO1xuXG4gIC8vIGlmIG5vdCBhIHZhbGlkIG1lc3NhZ2VcbiAgaWYgKGkgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZW5kIG1lc3NhZ2VcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWVzc2FnZSA9IGkgKyB0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yICsgcHJvcHMuam9pbih0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yKTtcbiAgaWYgKHRoaXMubGFnKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuaW8uc2VuZChtZXNzYWdlKTtcbiAgICB9LCB0aGlzLmxhZyk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5pby5zZW5kKG1lc3NhZ2UpO1xuICB9XG59O1xuXG4vKiBSZWNlaXZlIG1lc3NhZ2VzIGZyb20gc2VydmVyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuU29ja2V0Q29ubmVjdGlvbi5wcm90b3R5cGUubWVzc2FnZV9yZWNlaXZlID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAvLyBnZXQgdHlwZSBvZiBtZXNzYWdlIGZyb20gaWRcbiAgdmFyIHNwbGl0ID0gbWVzc2FnZS5zcGxpdCh0aGlzLm1lc3NhZ2Vfc2VwYXJhdG9yKTtcbiAgdmFyIGlkID0gcGFyc2VJbnQoc3BsaXRbMF0pO1xuXG4gIC8vIGlmIG5vdCB2YWxpZCBpZFxuICBpZiAoIXRoaXMubWVzc2FnZV9yZWNlaXZlX2lkc1tpZF0pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHR5cGUgPSB0aGlzLm1lc3NhZ2VfcmVjZWl2ZV9pZHNbaWRdO1xuICB2YXIgZXZlbnQgPSB7IHR5cGU6IHR5cGUgfTtcblxuICAvLyBwcmVwYXJlIGluZm9ybWF0aW9uIGZvciBldmVudCBoYW5kbGVyXG4gIGlmICh0eXBlID09PSBcImZ1bGxcIikge1xuICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiY29ubmVjdGVkXCIpIHtcbiAgICBldmVudC5wbGF5ZXJfaWQgPSBzcGxpdFsxXSA9PT0gXCJudWxsXCIgPyBudWxsIDogcGFyc2VJbnQoc3BsaXRbMV0pO1xuICAgIGV2ZW50Lm5hbWUgPSBzcGxpdFsyXTtcbiAgICBldmVudC5wbGF5ZXJzID0gc3BsaXRbM107XG4gICAgZXZlbnQuc2NoZW1lID0gc3BsaXRbNF07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJwbGF5ZXJfam9pblwiKSB7XG4gICAgZXZlbnQudXNlcl9pZCA9IHNwbGl0WzFdO1xuICAgIGV2ZW50Lm5hbWUgPSBzcGxpdFsyXTtcbiAgICBldmVudC5wbGF5ZXJfaWQgPSBwYXJzZUludChzcGxpdFszXSk7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJwbGF5ZXJfbGVhdmVcIikge1xuICAgIGV2ZW50LnVzZXJfaWQgPSBzcGxpdFsxXTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImdhbWVfd2FpdFwiKSB7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX3N0YXJ0XCIpIHtcbiAgICBldmVudC5yZXNldF9wbGF5ZXJzID0gcGFyc2VJbnQoc3BsaXRbMV0pO1xuICAgIGV2ZW50LmJnX3N0ciA9IHNwbGl0WzJdO1xuICAgIGV2ZW50LmZnX3N0ciA9IHNwbGl0WzNdO1xuICAgIGV2ZW50LmdyYXZpdHlfbWFwID0gc3BsaXRbNF07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX2VuZFwiKSB7XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJnYW1lX3N0YXRlXCIpIHtcbiAgICBldmVudC5mcmFtZXMgPSBwYXJzZUludChzcGxpdFsxXSk7XG4gICAgZXZlbnQuc3RhdGUgPSBzcGxpdFsyXTtcbiAgICBldmVudC5yZXNwb25zZXMgPSBzcGxpdFszXTtcbiAgICBldmVudC5kYW1hZ2VzID0gc3BsaXRbNF07XG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJwaW5nXCIpIHtcbiAgICBldmVudC5mcmFtZSA9IHBhcnNlSW50KHNwbGl0WzFdKTtcbiAgfVxuXG4gIC8vIHJ1biBldmVudFxuICB0aGlzLmNhbGxiYWNrKGV2ZW50KTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWx0aXBsYXllclxuICAgIFBsYXllciBEZWF0aHNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDaGVjayBpZiB3ZSdyZSBkZWFkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWVfZGVhZCA9IGZ1bmN0aW9uKCkge1xuICAvLyBub3QgcmVhZHkgZm9yIGFueSBkZWF0aCBzdHVmZlxuICBpZiAoIXRoaXMuZ2FtZSB8fCAhdGhpcy5nYW1lLmNvcmUgfHwgIXRoaXMuZ2FtZS5wbGF5ZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb3VudCB1cCB0byBkZWFkbmVzc1xuICBpZiAodGhpcy5nYW1lLnBsYXllci5kZWFkKSB7XG4gICAgaWYgKCF0aGlzLmRlYWQpIHtcbiAgICAgIGlmICh0aGlzLndhaXRfZm9yX2RlYWQgPCA0OCkge1xuICAgICAgICB0aGlzLndhaXRfZm9yX2RlYWQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGVhdGgoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhpcy53YWl0X2Zvcl9kZWFkID0gMDtcbiAgICBpZiAodGhpcy5kZWFkKSB7XG4gICAgICB0aGlzLnJlc3Bhd24oKTtcbiAgICB9XG4gIH1cblxuICAvLyBkZWFkbmVzc1xuICBpZiAodGhpcy5kZWFkKSB7XG4gICAgaWYgKHRoaXMud2FpdF9mb3JfcmVzcGF3biA+IDApIHtcbiAgICAgIHRoaXMud2FpdF9mb3JfcmVzcGF3bi0tO1xuICAgICAgaWYgKHRoaXMud2FpdF9mb3JfcmVzcGF3biA9PT0gMCkge1xuICAgICAgICB0aGlzLmRpdl9kZWFkX2NvdW50ZG93bi5pbm5lckhUTUwgPSBcIkNsaWNrIHRvIHJlc3Bhd25cIjtcbiAgICAgICAgcmVtb3ZlX2NsYXNzKHRoaXMuYnV0dG9uX3Jlc3Bhd24sIFwiZGlzYWJsZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRpdl9kZWFkX2NvdW50ZG93bi5pbm5lckhUTUwgPVxuICAgICAgICAgIFwiUmVzcGF3biBpbiBcIiArIGNlaWwodGhpcy53YWl0X2Zvcl9yZXNwYXduIC8gMjQpICsgXCIgc2Vjb25kc1wiO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyogV2UgaGF2ZSBkaWVkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZGVhdGggPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5kZWFkID0gdHJ1ZTtcbiAgdGhpcy53YWl0X2Zvcl9kZWFkID0gMDtcbiAgdGhpcy53YWl0X2Zvcl9yZXNwYXduID0gOTY7XG5cbiAgaGlkZSh0aGlzLmRpdl9kZWFkX3RleHQpO1xuICBhZGRfY2xhc3ModGhpcy5idXR0b25fcmVzcGF3biwgXCJkaXNhYmxlZFwiKTtcbiAgc2hvdyh0aGlzLmRpdl9kZWFkKTtcbn07XG5cbi8qIFJlc3Bhd24gdHJpZ2dlcmVkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzcGF3biA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRlYWQgPSBmYWxzZTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBNdWx0aXBsYXllclxuICAgIEV2ZW50c1xuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFJ1biBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ydW5fZXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoIWV2ZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaGFuZGxlIGFycmF5cyBvZiBldmVudHNcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoZXZlbnRbaV0pO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBydW4gZXZlbnRzXG4gIGlmIChldmVudC50eXBlID09PSBcImZ1bGxcIikge1xuICAgIHRoaXMuZ2FtZV9mdWxsKCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJjb25uZWN0ZWRcIikge1xuICAgIHRoaXMuY29ubmVjdGVkKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcIndhaXRfZm9yX2Nvbm5lY3Rpb25cIikge1xuICAgIHRoaXMud2FpdF9mb3JfY29ubmVjdGlvbigpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2pvaW5cIikge1xuICAgIHRoaXMucGxheWVyX2pvaW4oZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwicGxheWVyX2xlYXZlXCIpIHtcbiAgICB0aGlzLnBsYXllcl9sZWF2ZShldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJnYW1lX3dhaXRcIikge1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ2FtZV9zdGFydFwiKSB7XG4gICAgdGhpcy5nYW1lX3N0YXJ0KGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdhbWVfZW5kXCIpIHtcbiAgICB0aGlzLmdhbWVfZW5kKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcImdhbWVfc3RhdGVcIikge1xuICAgIHRoaXMuZ2FtZV9zdGF0ZV9yZWNlaXZlZChldmVudCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJjb2xsZWN0XCIpIHtcbiAgICB0aGlzLmV2ZW50X2NvbGxlY3QoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwiZ3JvdW5kX2RhbWFnZVwiKSB7XG4gICAgdGhpcy5ldmVudF9ncm91bmRfZGFtYWdlKGV2ZW50KTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBsYXllcl9kZWF0aFwiKSB7XG4gICAgdGhpcy5ldmVudF9wbGF5ZXJfZGVhdGgoZXZlbnQpO1xuICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFwid2VhcG9uX3NlbGVjdGVkXCIpIHtcbiAgICB0aGlzLnNvY2tldHMubWVzc2FnZV9zZW5kKFwid2VhcG9uX3NlbGVjdGVkXCIsIFtldmVudC53ZWFwb25dKTtcbiAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBcInBpbmdcIikge1xuICAgIHRoaXMuZXZlbnRfcGluZyhldmVudCk7XG4gIH1cblxuICAvLyBzZW5kIGV2ZW50IGRvd24gYSBsZXZlbFxuICBlbHNlIGlmICh0aGlzLmdhbWUpIHtcbiAgICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcbiAgfVxufTtcblxuLyogQ29sbGVjdGVkIGl0ZW1cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ldmVudF9jb2xsZWN0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKHRoaXMuaW5pdGlhbGlzZWQpIHtcbiAgICAvLyB3YWl0IHRvIHJlY3JlYXRlXG4gICAgdGhpcy53YWl0X3RvX2NyZWF0ZVtldmVudC5vYmpdID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUuZnJhbWU7XG5cbiAgICAvLyBydW4gY2xpZW50IGNvbGxlY3Rpb24gZXZlbnRzXG4gICAgdGhpcy5nYW1lLnJ1bl9ldmVudChldmVudCk7XG5cbiAgICAvLyBydW4gcGxheWVycyBpbnRlcmZhY2VcbiAgICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG4gIH1cbn07XG5cbi8qIFBsYXllciBkZWF0aFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmV2ZW50X3BsYXllcl9kZWF0aCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIC8vIG9ubHkgdXNlIHNlcnZlciBldmVudHNcbiAgaWYgKCFldmVudC5mcm9tX3NlcnZlcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJ1biBpdFxuICBpZiAodGhpcy5pbml0aWFsaXNlZCkge1xuICAgIHRoaXMucGxheWVyX2RlYXRoKGV2ZW50KTtcbiAgfVxufTtcblxuLyogUGluZ1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmV2ZW50X3BpbmcgPSBmdW5jdGlvbihldmVudCkge1xuICAvLyBkaWQgd2UgcmVxdWVzdCB0aGlzXG4gIGlmICghdGhpcy5waW5nc1tldmVudC5mcmFtZV0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgLy8gcmVjb3JkIGVuZCB0aW1lIGZvciBwaW5nXG4gIHRoaXMucGluZ3NbZXZlbnQuZnJhbWVdLmVuZCA9IG5vdztcblxuICAvLyBnbyB0aHJvdWdoIGFsbCBwaW5nc1xuICB2YXIgcGluZ19jb3VudCA9IDA7XG4gIHZhciBwaW5nX3RvdGFsID0gMDtcbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5waW5ncykge1xuICAgIHZhciBwaW5nID0gdGhpcy5waW5nc1tmcmFtZV07XG5cbiAgICAvLyByZW1vdmUgb2xkIG9uZXNcbiAgICBpZiAocGluZy5lbmQgJiYgcGluZy5lbmQgKyAxMDAwMCA8IG5vdykge1xuICAgICAgZGVsZXRlIHRoaXMucGluZ3NbZnJhbWVdO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gY2FsY3VsYXRlIGF2ZXJhZ2VcbiAgICBwaW5nX3RvdGFsICs9IHBpbmcuZW5kIC0gcGluZy5zdGFydDtcbiAgICBwaW5nX2NvdW50Kys7XG4gIH1cblxuICAvLyBzaG93IHBpbmdcbiAgdGhpcy5kaXZfcGluZy5pbm5lckhUTUwgPSByb3VuZChwaW5nX3RvdGFsIC8gcGluZ19jb3VudCk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgTXVsaXRwbGF5ZXJcbiAgICBGcmFtZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTdGFydC9zdG9wIGxvb3BcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5sb29wX3N0YXJ0ID0gZnVuY3Rpb24oc3RhcnRfZnJhbWUpIHtcbiAgLy8gY2xvc2UgYW55IG9wZW4gbG9vcHNcbiAgdGhpcy5sb29wX3N0b3AoKTtcblxuICAvLyBzZXQgbG9vcCB2YXJzXG4gIHRoaXMuc3RhcnRfZnJhbWUgPSBzdGFydF9mcmFtZSB8fCAwO1xuICB0aGlzLmZyYW1lcyA9IHRoaXMuc3RhcnRfZnJhbWU7XG4gIHRoaXMuc3RhcnRfdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgIHNlbGYucnVuX3RpY2soKTtcbiAgfSwgMTApO1xufTtcblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmxvb3Bfc3RvcCA9IGZ1bmN0aW9uKCkge1xuICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xufTtcblxuLyogUnVuIHRpY2tcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5ydW5fdGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyBjYWxjdWxhdGUgbnVtYmVyIG9mIGZyYW1lcyBzaW5jZSBnYW1lIHN0YXJ0XG4gIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgdmFyIGZyYW1lcyA9XG4gICAgdGhpcy5zdGFydF9mcmFtZSArIE1hdGguZmxvb3IoKG5vdyAtIHRoaXMuc3RhcnRfdGltZSkgLyB0aGlzLm1zX2xvb3ApO1xuXG4gIC8vIGdldCBudW1iZXIgb2YgcmVtYWluaW5nIHN0ZXBzXG4gIHZhciBmcmFtZV9kaWZmZXJlbmNlID0gZnJhbWVzIC0gdGhpcy5mcmFtZXM7XG5cbiAgLy8gd2FpdGluZ1xuICBpZiAoZnJhbWVfZGlmZmVyZW5jZSA8IDEpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyB0b28gbXVjaCBsYWdcbiAgaWYgKGZyYW1lX2RpZmZlcmVuY2UgPiAxMCkge1xuICAgIHRoaXMubG9vcF9zdGFydCgpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwidGljayBsYWcgfCBcIiArIGZyYW1lX2RpZmZlcmVuY2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGdvIHRocm91Z2ggZnJhbWVzIHRvIHByb2Nlc3NcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBmcmFtZV9kaWZmZXJlbmNlOyBpKyspIHtcbiAgICB0aGlzLmZyYW1lKCk7XG4gIH1cblxuICAvLyBydW4gZGlzcGxheSBsb29wXG4gIHRoaXMuZ2FtZS5mcmFtZV9kaXNwbGF5KCk7XG5cbiAgLy8gcmVjb3JkIHRpbWUgdGhpcyB3YXMgZG9uZVxuICB0aGlzLmZwc2VzLnB1c2gobmV3IERhdGUoKS5nZXRUaW1lKCkpO1xuICBpZiAodGhpcy5mcHNlcy5sZW5ndGggPiA3Mikge1xuICAgIHRoaXMuZGl2X2Zwcy5pbm5lckhUTUwgPSByb3VuZChcbiAgICAgICgzMDAwIC8gKHRoaXMuZnBzZXNbNzJdIC0gdGhpcy5mcHNlc1swXSkpICogdGhpcy5mcHNcbiAgICApO1xuICAgIHRoaXMuZnBzZXMuc3BsaWNlKDAsIDEpO1xuICB9XG59O1xuXG4vKiBGcmFtZSBwcm9jZXNzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWUgPSBmdW5jdGlvbigpIHtcbiAgLy8gaW5jcmVtZW50IGZyYW1lIGNvdW50XG4gIHRoaXMuZnJhbWVzKys7XG5cbiAgLy8gc3RvcmUgaW5wdXRcbiAgaWYgKHRoaXMuZ2FtZS5wbGF5ZXIpIHtcbiAgICB2YXIgYWN0aW9uID0gdGhpcy5nYW1lLmdldF9pbnB1dCgpO1xuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgIHRoaXMuc3RvcmVfaW5wdXRbdGhpcy5mcmFtZXNdID0gYWN0aW9uO1xuICAgICAgdGhpcy5zZW5kX2lucHV0KGFjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgLy8gcnVuIGZyYW1lXG4gIHRoaXMuZnJhbWVfcnVuKHRoaXMuZnJhbWVzKTtcblxuICAvLyByZW1vdmUgb2xkIHN0YXRlc1xuICB0aGlzLnJlbW92ZV9vbGRfc3RhdGVzKCk7XG5cbiAgLy8gcnVuIGdyb3VuZCBkYW1hZ2UgY2hlY2tzXG4gIHRoaXMuZnJhbWVfZ3JvdW5kKCk7XG5cbiAgLy8gcnVuIGRlYXRoIGZyYW1lc1xuICB0aGlzLmZyYW1lX2RlYWQoKTtcblxuICAvLyBydW4gcGxheWVycyBpbnRlcmZhY2VcbiAgaWYgKHRoaXMuZnJhbWVzICUgNDggPT09IDApIHtcbiAgICB0aGlzLnBsYXllcnNfaW50ZXJmYWNlKCk7XG4gIH1cblxuICAvLyBydW4gcGluZ1xuICBpZiAodGhpcy5mcmFtZXMgJSAxMiA9PT0gMCkge1xuICAgIHRoaXMuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJwaW5nXCIsIFt0aGlzLmZyYW1lc10pO1xuICAgIHRoaXMucGluZ3NbdGhpcy5mcmFtZXNdID0geyBzdGFydDogbmV3IERhdGUoKS5nZXRUaW1lKCkgfTtcbiAgfVxufTtcblxuLyogRnJhbWUgcnVuXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZnJhbWVfcnVuID0gZnVuY3Rpb24oZnJhbWUpIHtcbiAgLy8gcnVuIGNvcmUgYW5kIHN0b3JlIHJlc3BvbnNlXG4gIHZhciByZXNwb25zZSA9IHRoaXMuZ2FtZS5mcmFtZV9jb3JlKGZyYW1lLCB0aGlzLnN0b3JlX2lucHV0W2ZyYW1lXSk7XG4gIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgdGhpcy5zdG9yZV9yZXNwb25zZXMucHVzaChyZXNwb25zZSk7XG4gIH1cblxuICAvLyBldmVudHNcbiAgdGhpcy5ydW5fZXZlbnQodGhpcy5nYW1lLmNvcmUuc3RhdGUuZXZlbnRzKTtcblxuICAvLyB1bnBhY2sgYW55IHN0b3JlZCBzZXJ2ZXIgc3RhdGUgZm9yIHRoaXMgZnJhbWVcbiAgaWYgKHRoaXMuc3RvcmVfcGFja2V0W2ZyYW1lXSkge1xuICAgIHRoaXMuc2V0X2dhbWVfc3RhdGUodGhpcy5zdG9yZV9wYWNrZXRbZnJhbWVdKTtcbiAgICBkZWxldGUgdGhpcy5zdG9yZV9wYWNrZXRbZnJhbWVdO1xuICB9XG5cbiAgLy8gcmVjb3JkIGdhbWUgc3RhdGVcbiAgdGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV0gPSB7XG4gICAgZnJhbWVzOiBmcmFtZSxcbiAgICBzdGF0ZTogdGhpcy5nYW1lLmNvcmUucGFja19zdGF0ZSh0aGlzLmdhbWUuY29yZS5zdGF0ZSlcbiAgfTtcbn07XG5cbi8qIFJlbW92ZSBvbGQgc3RhdGVzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVtb3ZlX29sZF9zdGF0ZXMgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5zdG9yZV9wYWNrZXQpIHtcbiAgICBpZiAocGFyc2VJbnQoZnJhbWUpICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgZGVsZXRlIHRoaXMuc3RvcmVfcGFja2V0W2ZyYW1lXTtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgZnJhbWUgaW4gdGhpcy5zdG9yZV9zdGF0ZSkge1xuICAgIGlmIChwYXJzZUludChmcmFtZSkgKyA1MCA8IHRoaXMuZnJhbWVzKSB7XG4gICAgICBkZWxldGUgdGhpcy5zdG9yZV9zdGF0ZVtmcmFtZV07XG4gICAgfVxuICB9XG4gIGZvciAodmFyIGZyYW1lIGluIHRoaXMuc3RvcmVfaW5wdXQpIHtcbiAgICBpZiAocGFyc2VJbnQoZnJhbWUpICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgZGVsZXRlIHRoaXMuc3RvcmVfaW5wdXRbZnJhbWVdO1xuICAgIH1cbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHRoaXMuc3RvcmVfcmVzcG9uc2VzW2ldLmZyYW1lICsgNTAgPCB0aGlzLmZyYW1lcykge1xuICAgICAgdGhpcy5zdG9yZV9yZXNwb25zZXMuc3BsaWNlKGksIDEpO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bGl0cGxheWVyXG4gICAgR3JvdW5kIERhbWFnZVxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIERhbWFnZSB0aGUgZ3JvdW5kIGV2ZW50XG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuZXZlbnRfZ3JvdW5kX2RhbWFnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBrZXkgPSBldmVudC5mcmFtZSArIFwiLVwiICsgZXZlbnQueCArIFwiLVwiICsgZXZlbnQueSArIFwiLVwiICsgZXZlbnQucmFkaXVzO1xuXG4gIC8vIGRpZCB3ZSBhbHJlYWR5IGhhdmUgdGhpcyBoYXBwZW5cbiAgaWYgKHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZ2V0IGJvdW5kYXJpZXNcbiAgdmFyIHgxID0gbWF4KHJvdW5kKGV2ZW50LnggLSBldmVudC5yYWRpdXMpLCAwKTtcbiAgdmFyIHgyID0gbWluKHJvdW5kKGV2ZW50LnggKyBldmVudC5yYWRpdXMpLCB0aGlzLmdhbWUuY29yZS5tYXAudyAtIDEpO1xuICB2YXIgeTEgPSBtYXgocm91bmQoZXZlbnQueSAtIGV2ZW50LnJhZGl1cyksIDApO1xuICB2YXIgeTIgPSBtaW4ocm91bmQoZXZlbnQueSArIGV2ZW50LnJhZGl1cyksIHRoaXMuZ2FtZS5jb3JlLm1hcC5oIC0gMSk7XG4gIHZhciB3ID0geDIgLSB4MTtcbiAgdmFyIGggPSB5MiAtIHkxO1xuXG4gIC8vIGdldCBhcnJheSBmcm9tIHRoZSBtYXBcbiAgdmFyIGFyciA9IHRoaXMuZ2FtZS5jb3JlLm1hcC5nZXRfYmxvY2soeDEsIHkxLCB3LCBoKTtcblxuICAvLyBnZXQgcGllY2Ugb2YgdGhlIG1hcFxuICB2YXIgY2FudiA9IHRoaXMuZ2FtZS5nZXRfbGFuZF9ibG9jayh4MSwgeTEsIHcsIGgpO1xuXG4gIC8vIHN0b3JlIGJhY2tlZCB1cCBkYW1hZ2VcbiAgdGhpcy5ncm91bmRfdGVtcFtrZXldID0ge1xuICAgIGZyYW1lOiBldmVudC5mcmFtZSxcbiAgICB4OiB4MSxcbiAgICB5OiB5MSxcbiAgICBhcnI6IGFycixcbiAgICBjYW52OiBjYW52XG4gIH07XG5cbiAgLy8gc3RvcmUgdGhlIGV2ZW50IGl0c2VsZlxuICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XSA9IGR1cGxpY2F0ZV9vYmooZXZlbnQpO1xuICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XS5kb25lID0gdHJ1ZTtcblxuICAvLyBydW4gdGhlIGV2ZW50XG4gIHRoaXMuZ2FtZS5ydW5fZXZlbnQoZXZlbnQpO1xufTtcblxuLyogQ2hlY2sgZ3JvdW5kIGRhbWFnZSBldmVudHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5mcmFtZV9ncm91bmQgPSBmdW5jdGlvbigpIHtcbiAgLy8gZ28gdGhyb3VnaCBhbGwgY2hlY2tzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdyb3VuZF90ZW1wKSB7XG4gICAgaWYgKHRoaXMuZnJhbWVzID4gdGhpcy5ncm91bmRfdGVtcFtrZXldLmZyYW1lICsgNDApIHtcbiAgICAgIGNsb2coXCJkYW1hZ2Ugbm90IGNvbmZpcm1lZFwiKTtcbiAgICAgIHRoaXMudW5kb19ncm91bmRfZGFtYWdlKHRoaXMuZ3JvdW5kX3RlbXBba2V5XSwga2V5KTtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF90ZW1wW2tleV07XG4gICAgICBkZWxldGUgdGhpcy5ncm91bmRfZXZlbnRzW2tleV07XG4gICAgfVxuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCBhbGwgZXZlbnRzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmdyb3VuZF9ldmVudHMpIHtcbiAgICB2YXIgZXZlbnQgPSB0aGlzLmdyb3VuZF9ldmVudHNba2V5XTtcbiAgICBpZiAodGhpcy5mcmFtZXMgPj0gZXZlbnQuZnJhbWUpIHtcbiAgICAgIGlmICghZXZlbnQuZG9uZSkge1xuICAgICAgICB0aGlzLmdhbWUucnVuX2V2ZW50KGV2ZW50KTtcbiAgICAgICAgdGhpcy5ncm91bmRfZXZlbnRzW2tleV0uZG9uZSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLmZyYW1lcyA+IHRoaXMuZ3JvdW5kX2V2ZW50c1trZXldLmZyYW1lICsgNTApIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF9ldmVudHNba2V5XTtcbiAgICB9XG4gIH1cbn07XG5cbi8qIFVuZG8gZ3JvdW5kIGRhbWFnZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnVuZG9fZ3JvdW5kX2RhbWFnZSA9IGZ1bmN0aW9uKGRhbWFnZSwgZF9rZXkpIHtcbiAgLy8gcmVzdG9yZSBpdFxuICB0aGlzLmdhbWUuY29yZS5tYXAuc2V0X2Jsb2NrX2Zyb21fYXJyKGRhbWFnZS54LCBkYW1hZ2UueSwgZGFtYWdlLmFycik7XG4gIHRoaXMuZ2FtZS5kcmF3X2xhbmRfYmxvY2soZGFtYWdlLngsIGRhbWFnZS55LCBkYW1hZ2UuY2Fudik7XG5cbiAgLy8gcmVkbyBhbnkgb3RoZXIgZXZlbnRzIHRoYXQgaGFwcGVuZWQgc2luY2VcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ3JvdW5kX2V2ZW50cykge1xuICAgIGlmIChkX2tleSA9PT0ga2V5KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgdGhpcy5nYW1lLnJ1bl9ldmVudCh0aGlzLmdyb3VuZF9ldmVudHNba2V5XSk7XG4gIH1cbn07XG5cbi8qIFNlcnZlciByZXNwb25zZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfZ3JvdW5kID0gZnVuY3Rpb24oc3RyKSB7XG4gIGlmICghc3RyKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gdW5wYWNrIGRhbWFnZXNcbiAgdmFyIHNwbGl0ID0gc3RyLnNwbGl0KFwiJFwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzcGxpdDIgPSBzcGxpdFtpXS5zcGxpdChcIn5cIik7XG4gICAgdmFyIGV2ZW50ID0ge1xuICAgICAgdHlwZTogXCJncm91bmRfZGFtYWdlXCIsXG4gICAgICBmcmFtZTogcGFyc2VJbnQoc3BsaXQyWzBdKSxcbiAgICAgIHg6IHBhcnNlRmxvYXQoc3BsaXQyWzFdKSxcbiAgICAgIHk6IHBhcnNlRmxvYXQoc3BsaXQyWzJdKSxcbiAgICAgIHJhZGl1czogcGFyc2VGbG9hdChzcGxpdDJbM10pLFxuICAgICAgZGlnOiBzcGxpdDJbNF0gPT09IFwiMVwiXG4gICAgfTtcbiAgICB2YXIga2V5ID0gZXZlbnQuZnJhbWUgKyBcIi1cIiArIGV2ZW50LnggKyBcIi1cIiArIGV2ZW50LnkgKyBcIi1cIiArIGV2ZW50LnJhZGl1cztcblxuICAgIC8vIGNvbmZpcm0gYWxyZWFkeSBkb25lIGRhbWFnZVxuICAgIGlmICh0aGlzLmdyb3VuZF90ZW1wW2tleV0pIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmdyb3VuZF90ZW1wW2tleV07XG5cbiAgICAgIC8vIHdhaXQgdG8gcGVyZm9ybSBpdFxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdyb3VuZF9ldmVudHNba2V5XSA9IGV2ZW50O1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIE11bHRpcGxheWVyXG4gICAgSW50ZXJmYWNlXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogSW5pdCBpbnRlcmZhY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5pbml0X2ludGVyZmFjZSA9IGZ1bmN0aW9uKCkge1xuICAvLyBsb2FkaW5nIHNjcmVlblxuICB0aGlzLmxvYWRpbmcgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiTG9hZGluZy4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmxvYWRpbmcpO1xuICBoaWRlKHRoaXMubG9hZGluZyk7XG5cbiAgLy8gYmV0d2VlbiBnYW1lcyBzY3JlZW5cbiAgdGhpcy5iZXR3ZWVuX2dhbWVzID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OiBcIkRpbWVuc2lvbiBqdW1wIGluIHByb2dyZXNzITxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmJldHdlZW5fZ2FtZXMpO1xuICBoaWRlKHRoaXMuYmV0d2Vlbl9nYW1lcyk7XG5cbiAgLy8gcGVyZm9ybWFuY2VcbiAgdGhpcy5kaXZfcGluZyA9IGVsZW1lbnQoeyBjbGFzczogXCJwaW5nXCIgfSk7XG4gIHRoaXMuZGl2X2ZwcyA9IGVsZW1lbnQoeyBjbGFzczogXCJmcHNcIiB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9waW5nKTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmRpdl9mcHMpO1xuXG4gIC8vIGRlYWQgZGl2XG4gIHRoaXMuZGl2X2RlYWQgPSBlbGVtZW50KHsgY2xhc3M6IFwiZnVsbCBmdWxsX2JnXCIgfSk7XG4gIHRoaXMuZGl2X2RlYWRfY29udCA9IGVsZW1lbnQoe1xuICAgIGNsYXNzOiBcImNvbnRfY2VudGVyIHJlZFwiLFxuICAgIHRleHQ6IFwiPGgzPllvdSBoYXZlIGRpZWQhPC9oMz5cIlxuICB9KTtcbiAgdGhpcy5kaXZfZGVhZF90ZXh0ID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJwXCIsXG4gICAgdGV4dDogXCJZb3Ugd2VyZSBraWxsZWQgaW4gYWN0aW9uLlwiXG4gIH0pO1xuICB0aGlzLmRpdl9kZWFkX2NvdW50ZG93biA9IGVsZW1lbnQoeyB0eXBlOiBcInBcIiwgY2xhc3M6IFwiZ3JleVwiIH0pO1xuICB0aGlzLmRpdl9kZWFkX2J1dHRvbnMgPSBlbGVtZW50KHsgY2xhc3M6IFwiYnV0dG9uc1wiIH0pO1xuICB0aGlzLmJ1dHRvbl9yZXNwYXduID0gZWxlbWVudCh7XG4gICAgdHlwZTogXCJidXR0b25cIixcbiAgICBjbGFzczogXCJidXR0b24gcmVkIGRpc2FibGVkXCIsXG4gICAgdGV4dDogXCJSZXNwYXduXCJcbiAgfSk7XG4gIGFwcGVuZCh0aGlzLmRpdiwgdGhpcy5kaXZfZGVhZCk7XG4gIGFwcGVuZCh0aGlzLmRpdl9kZWFkLCB0aGlzLmRpdl9kZWFkX2NvbnQpO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZF9jb250LCB0aGlzLmRpdl9kZWFkX3RleHQpO1xuICBhcHBlbmQodGhpcy5kaXZfZGVhZF9jb250LCB0aGlzLmRpdl9kZWFkX2NvdW50ZG93bik7XG4gIGFwcGVuZCh0aGlzLmRpdl9kZWFkX2NvbnQsIHRoaXMuZGl2X2RlYWRfYnV0dG9ucyk7XG4gIGFwcGVuZCh0aGlzLmRpdl9kZWFkX2J1dHRvbnMsIHRoaXMuYnV0dG9uX3Jlc3Bhd24pO1xuICBoaWRlKHRoaXMuZGl2X2RlYWQpO1xuXG4gIC8vIGdhbWUgZnVsbCBzY3JlZW5cbiAgdGhpcy5mdWxsID0gZWxlbWVudCh7XG4gICAgY2xhc3M6IFwiY29udF9jZW50ZXJcIixcbiAgICB0ZXh0OlxuICAgICAgXCJHYW1lIHNlcnZlciBmdWxsLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLi4uPGJyPjxicj48ZGl2IGNsYXNzPSdsb2FkZXInPjwvZGl2PlwiXG4gIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZnVsbCk7XG4gIGhpZGUodGhpcy5mdWxsKTtcblxuICAvLyByZXNwYXduIG9uIGNsaWNrXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5idXR0b25fcmVzcGF3bi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHNlbGYud2FpdF9mb3JfcmVzcGF3biA9PT0gMCkge1xuICAgICAgc2VsZi5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcInJlc3Bhd25cIiwgW10pO1xuICAgIH1cbiAgfTtcblxuICAvLyBwbGF5ZXJzXG4gIHRoaXMuZGl2X3BsYXllcnMgPSBlbGVtZW50KHsgY2xhc3M6IFwicGxheWVyc1wiIH0pO1xuICB0aGlzLnRhYmxlX3BsYXllcnMgPSBlbGVtZW50KHsgdHlwZTogXCJ0YWJsZVwiIH0pO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZGl2X3BsYXllcnMpO1xuICBhcHBlbmQodGhpcy5kaXZfcGxheWVycywgdGhpcy50YWJsZV9wbGF5ZXJzKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBBcHBcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5mdW5jdGlvbiBtdWx0aXBsYXllcihcbiAgYXNzZXRzLFxuICBhc3NldHNfdXJsLFxuICBhdWRpbyxcbiAgaW5wdXQsXG4gIG5hbWUsXG4gIHdhdGNoZXIsXG4gIHJ1bl9ldmVudCxcbiAgc29ja2V0cyxcbiAgb25ib2FyZGluZ1xuKSB7XG4gIC8vIHNldHVwXG4gIHRoaXMuYXNzZXRzID0gYXNzZXRzO1xuICB0aGlzLmFzc2V0c191cmwgPSBhc3NldHNfdXJsO1xuICB0aGlzLmF1ZGlvID0gYXVkaW87XG4gIHRoaXMuaW5wdXQgPSBpbnB1dDtcbiAgdGhpcy5uYW1lID0gbmFtZTtcbiAgdGhpcy53YXRjaGVyID0gd2F0Y2hlcjtcbiAgdGhpcy50b3BfZXZlbnQgPSBydW5fZXZlbnQ7XG4gIHRoaXMuc29ja2V0cyA9IHNvY2tldHM7XG4gIHRoaXMuc2NoZW1lID0gbnVsbDtcbiAgdGhpcy5sYWcgPSAwO1xuICB0aGlzLm9uYm9hcmRpbmcgPSBvbmJvYXJkaW5nO1xuXG4gIC8vIGxvb3BcbiAgdGhpcy5mcHMgPSAyNDtcbiAgdGhpcy5tc19sb29wID0gTWF0aC5mbG9vcigxMDAwIC8gdGhpcy5mcHMpO1xuICB0aGlzLm1zX3RpY2sgPSAxMDtcbiAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcblxuICAvLyBtYWluIGRpdnNcbiAgdGhpcy5kaXYgPSBlbGVtZW50KHsgY2xhc3M6IFwiZnVsbFwiIH0pO1xuICB0aGlzLmNvbm5lY3RpbmcgPSBlbGVtZW50KHtcbiAgICBjbGFzczogXCJjb250X2NlbnRlclwiLFxuICAgIHRleHQ6IFwiV2FpdGluZyBmb3IgY29ubmVjdGlvbi4uLjxicj48YnI+PGRpdiBjbGFzcz0nbG9hZGVyJz48L2Rpdj5cIlxuICB9KTtcbiAgYXBwZW5kKHRoaXMuZGl2LCB0aGlzLmNvbm5lY3RpbmcpO1xuXG4gIC8vIHNldCB1cCBpbnRlcmZhY2VcbiAgdGhpcy5pbml0X2ludGVyZmFjZSgpO1xuXG4gIC8vIHdoZW4gam9pbmluZyBhIGdhbWUgcmVjb3JkIGFueSBpbmNvbWluZyBldmVudHMgZm9yIGxhdGVyIHVzZVxuICB0aGlzLmluaXRpYWxfZ2FtZV9ldmVudHMgPSBbXTtcbn1cblxuLyogV2FpdCBmb3IgY29ubmVjdGlvblxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLndhaXRfZm9yX2Nvbm5lY3Rpb24gPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmxvb3Bfc3RvcCgpO1xuICBoaWRlKHRoaXMuYmV0d2Vlbl9nYW1lcyk7XG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcbiAgc2hvdyh0aGlzLmNvbm5lY3RpbmcpO1xufTtcblxuLyogQ29ubmVjdGVkXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuY29ubmVjdGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gc2V0IHVwIHNjaGVtZVxuICB0aGlzLnNjaGVtZSA9IGRlZXBtZXJnZShzY2hlbWVzLmRlZmF1bHQsIHNjaGVtZXNbZXZlbnQuc2NoZW1lXSk7XG5cbiAgLy8gYWN0aXZlIHZhbHVlc1xuICB0aGlzLm5hbWUgPSBldmVudC5uYW1lO1xuICB0aGlzLnBsYXllcl9pZCA9IGV2ZW50LnBsYXllcl9pZDtcbiAgdGhpcy5wbGF5ZXJfY291bnQgPSAwO1xuICB0aGlzLnBsYXllcnMgPSB7fTtcbiAgdGhpcy5wbGF5ZXJzX3JlZiA9IHt9O1xuXG4gIC8vIGdvIHRocm91Z2ggc3RyaW5nIG9mIHBsYXllcnNcbiAgdmFyIHNwbGl0ID0gZXZlbnQucGxheWVycy5zcGxpdChcIitcIik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXQubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc3BsaXQyID0gc3BsaXRbaV0uc3BsaXQoXCIvXCIpO1xuICAgIHRoaXMuaW5pdF9wbGF5ZXIoe1xuICAgICAgdXNlcl9pZDogc3BsaXQyWzBdLFxuICAgICAgbmFtZTogc3BsaXQyWzFdLFxuICAgICAgcGxheWVyX2lkOiBwYXJzZUludChzcGxpdDJbMl0pXG4gICAgfSk7XG4gIH1cblxuICAvLyBydW4gdGhlIHBsYXllciBpbnRlcmZhY2VcbiAgdGhpcy5wbGF5ZXJzX2ludGVyZmFjZSgpO1xufTtcblxuLyogU3RhcnQgZ2FtZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmdhbWVfc3RhcnQgPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLmxvYWRpbmdfc3RhcnQgPSB0cnVlO1xuICB0aGlzLmluaXRpYWxpc2VkID0gZmFsc2U7XG4gIHRoaXMuZ3Jhdml0eV9tYXAgPSBldmVudC5ncmF2aXR5X21hcDtcblxuICB0aGlzLmdhbWVfY2xvc2UoKTtcblxuICAvLyByZXNldCBzY29yZXNcbiAgaWYgKGV2ZW50LnJlc2V0X3BsYXllcnMpIHtcbiAgICBmb3IgKHZhciBpZCBpbiB0aGlzLnBsYXllcnMpIHtcbiAgICAgIHRoaXMucGxheWVyc1tpZF0ubGV2ZWwgPSAwO1xuICAgICAgdGhpcy5wbGF5ZXJzW2lkXS5zY29yZSA9IDA7XG4gICAgfVxuICAgIHRoaXMucGxheWVyc19pbnRlcmZhY2UoKTtcbiAgfVxuXG4gIC8vIHN0b3JlZCBnYW1lIHN0YXRlcyBhbmQgYWN0aW9uc1xuICB0aGlzLnN0b3JlX3BhY2tldCA9IHt9O1xuICB0aGlzLnN0b3JlX3N0YXRlID0ge307XG4gIHRoaXMuc3RvcmVfaW5wdXQgPSB7fTtcbiAgdGhpcy5zdG9yZV9yZXNwb25zZXMgPSBbXTtcblxuICAvLyBncm91bmQgZGFtYWdlXG4gIHRoaXMuZ3JvdW5kX3RlbXAgPSB7fTtcbiAgdGhpcy5ncm91bmRfZXZlbnRzID0ge307XG5cbiAgLy8gb2JqZWN0cyB0aGF0IHdlIGFyZSB3YWl0aW5nIG9uIGZvciBzZXJ2ZXIgY29uZmlybWF0aW9uXG4gIHRoaXMud2FpdF90b19kZXN0cm95ID0ge307XG4gIHRoaXMud2FpdF90b19jcmVhdGUgPSB7fTtcblxuICAvLyBwZXJmb3JtYW5jZVxuICB0aGlzLnBpbmdzID0ge307XG4gIHRoaXMuZnBzZXMgPSBbXTtcblxuICAvLyBsb2FkIHRoZSBtYXAgZnJvbSBkYXRhIHVybFxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIG5ldyBsb2FkZXIoXG4gICAgXCJcIixcbiAgICB7XG4gICAgICBpbWc6IHtcbiAgICAgICAgYmc6IGV2ZW50LmJnX3N0cixcbiAgICAgICAgZmc6IGV2ZW50LmZnX3N0clxuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24oYXNzZXRzKSB7XG4gICAgICBzZWxmLmdhbWVfc3RhcnRfbG9hZGVkKGFzc2V0cy5pbWcpO1xuICAgIH1cbiAgKTtcbn07XG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX3N0YXJ0X2xvYWRlZCA9IGZ1bmN0aW9uKG1hcCkge1xuICAvLyBzZXQgdXAgbWFwXG4gIHZhciBuZXdfbWFwID0ge1xuICAgIGZnOiBtYXBnZW5fY2FudmFzKG1hcC5mZy53aWR0aCwgbWFwLmZnLmhlaWdodCksXG4gICAgYmc6IG1hcGdlbl9jYW52YXMobWFwLmJnLndpZHRoLCBtYXAuYmcuaGVpZ2h0KSxcbiAgICBncmF2aXR5X21hcDogdGhpcy5ncmF2aXR5X21hcFxuICB9O1xuICBuZXdfbWFwLmZnLmNvbnQuZHJhd0ltYWdlKG1hcC5mZywgMCwgMCk7XG4gIG5ld19tYXAuYmcuY29udC5kcmF3SW1hZ2UobWFwLmJnLCAwLCAwKTtcblxuICAvLyBzdGFydCB1cCBnYW1lIG9iamVjdFxuICB0aGlzLmdhbWUgPSBuZXcgZ2FtZShcbiAgICB0aGlzLmFzc2V0cyxcbiAgICB0aGlzLmF1ZGlvLFxuICAgIHRoaXMuaW5wdXQsXG4gICAgdGhpcy5zY2hlbWUsXG4gICAgbmV3X21hcCxcbiAgICB0aGlzLnBsYXllcnNfcmVmLFxuICAgIHRoaXMucGxheWVyX2lkLFxuICAgIHRoaXMudG9wX2V2ZW50LFxuICAgIHRoaXMub25ib2FyZGluZ1xuICApO1xuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuZ2FtZS5kaXYpO1xuXG4gIC8vIGZpbmlzaGVkIGxvYWRpbmdcbiAgdGhpcy5sb2FkaW5nX3N0YXJ0ID0gZmFsc2U7XG59O1xuXG4vKiBJbml0IGdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5pbml0X2dhbWUgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoIXRoaXMuZ2FtZSB8fCAhdGhpcy5nYW1lLmNvcmUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzaG93IGludGVyZmFjZVxuICBoaWRlKHRoaXMuYmV0d2Vlbl9nYW1lcyk7XG4gIGhpZGUodGhpcy5kaXZfZGVhZCk7XG4gIGhpZGUodGhpcy5jb25uZWN0aW5nKTtcbiAgaGlkZSh0aGlzLmxvYWRpbmcpO1xuXG4gIC8vIHN0b3AgZ2FtZVxuICB0aGlzLmxvb3Bfc3RvcCgpO1xuXG4gIC8vIHByZXBhcmUgc3RhdGVcbiAgdGhpcy5zZXRfZ2FtZV9zdGF0ZShldmVudCwgdHJ1ZSk7XG5cbiAgLy8gc3RhcnQgZ2FtZVxuICB0aGlzLmdhbWUuc3RhcnQoZXZlbnQuZnJhbWVzKTtcbiAgdGhpcy5zdGF0dXMgPSBcImFjdGl2ZVwiO1xuXG4gIC8vIGxhc3QgZnJhbWUgYSBzZXJ2ZXIgcGFja2V0IHdhcyByZWNlaXZlZFxuICB0aGlzLmxhc3RfcGFja2V0ID0gZXZlbnQuZnJhbWVzO1xuICB0aGlzLmRpc2Nvbm5lY3RlZCA9IGZhbHNlO1xuXG4gIC8vIHJ1biBpbml0aWFsIGV2ZW50c1xuICB0aGlzLnJ1bl9ldmVudCh0aGlzLmluaXRpYWxfZ2FtZV9ldmVudHMpO1xuICB0aGlzLmluaXRpYWxfZ2FtZV9ldmVudHMgPSBbXTtcbiAgdGhpcy5pbml0aWFsaXNlZCA9IHRydWU7XG5cbiAgLy8gc3RhcnQgbG9vcFxuICB0aGlzLmxvb3Bfc3RhcnQoZXZlbnQuZnJhbWVzKTtcbn07XG5cbi8qIENsb3NlIGdhbWVcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX2Nsb3NlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5sb29wX3N0b3AoKTtcbiAgaWYgKHRoaXMuZ2FtZSkge1xuICAgIHJlbW92ZSh0aGlzLmdhbWUuZGl2KTtcbiAgICBkZWxldGUgdGhpcy5nYW1lO1xuICB9XG59O1xuXG4vKiBFbmQgR2FtZVxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLmdhbWVfZW5kID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gc3RvcCBnYW1lXG4gIHRoaXMubG9vcF9zdG9wKCk7XG5cbiAgLy8gc3RvcCBhdWRpb1xuICB0aGlzLmF1ZGlvLnN0b3AoKTtcblxuICAvLyBzaG93IGxvYWRpbmcgc2NyZWVuXG4gIGhpZGUodGhpcy5sb2FkaW5nKTtcbiAgaGlkZSh0aGlzLmRpdl9kZWFkKTtcbiAgaGlkZSh0aGlzLmNvbm5lY3RpbmcpO1xuICBzaG93KHRoaXMuYmV0d2Vlbl9nYW1lcyk7XG59O1xuXG4vKiBTZW5kIGlucHV0IHRvIHNlcnZlclxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnNlbmRfaW5wdXQgPSBmdW5jdGlvbihhY3Rpb24pIHtcbiAgdmFyIGFyciA9IFt0aGlzLmZyYW1lcywgYWN0aW9uLmFjdGlvbiwgYWN0aW9uLmFuZ2xlXTtcbiAgaWYgKGFjdGlvbi5hY3Rpb24gPT09IFwic2hvb3RcIikge1xuICAgIGFyci5wdXNoKGFjdGlvbi53ZWFwb24pO1xuICB9XG4gIHRoaXMuc29ja2V0cy5tZXNzYWdlX3NlbmQoXCJwbGF5ZXJfaW5wdXRcIiwgYXJyKTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBSb29tIFBsYXllcnNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBDcmVhdGUgcGxheWVyIG9iamVjdHNcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5pbml0X3BsYXllciA9IGZ1bmN0aW9uKHByb3BzKSB7XG4gIC8vIGFkZCBwbGF5ZXIgdG8gYXJyYXlcbiAgdGhpcy5wbGF5ZXJfY291bnQrKztcbiAgdGhpcy5wbGF5ZXJzW3Byb3BzLnVzZXJfaWRdID0ge1xuICAgIG5hbWU6IHByb3BzLm5hbWUsXG4gICAgaWQ6IHByb3BzLnBsYXllcl9pZFxuICB9O1xuXG4gIC8vIHNldCBwbGF5ZXJzIHJlZmVyZW5jZVxuICB0aGlzLnBsYXllcnNfcmVmW3Byb3BzLnBsYXllcl9pZF0gPSB7XG4gICAgdXNlcl9pZDogcHJvcHMudXNlcl9pZCxcbiAgICBuYW1lOiBwcm9wcy5uYW1lLFxuICAgIGxldmVsOiAwXG4gIH07XG59O1xuXG4vKiBEcmF3IHBsYXllcnMgaW50ZXJmYWNlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucGxheWVyc19pbnRlcmZhY2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gYXJlIHdlIGdvb2QgYW5kIGFjdGl2ZVxuICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQgfHwgIXRoaXMuZ2FtZS5jb3JlLnN0YXRlLnBsYXllcnMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzaG93IHBsYXllcnNcbiAgdmFyIHN0ciA9IFwiXCI7XG4gIHZhciBzb3J0YWJsZSA9IHRoaXMucGxheWVyc19zb3J0KCk7XG4gIGlmICghc29ydGFibGUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzZXQgbGVhZGVyIGlkXG4gIHRoaXMuZ2FtZS5sZWFkZXIgPSBwYXJzZUludChzb3J0YWJsZVswXS5pZCk7XG5cbiAgc3RyID0gXCI8dGhlYWQ+PHRoPjwvdGg+PHRoPmx2bDwvdGg+PHRoPnNjb3JlPC90aD48L3RoZWFkPlwiO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNvcnRhYmxlLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHBsYXllciA9IHNvcnRhYmxlW2ldO1xuICAgIHZhciB0cl9jbGFzcyA9IFwiXCI7XG4gICAgaWYgKHBsYXllci5pZCA9PSB0aGlzLnBsYXllcl9pZCkge1xuICAgICAgdHJfY2xhc3MgKz0gXCJoaWdobGlnaHQgXCI7XG4gICAgfVxuICAgIGlmIChwbGF5ZXIuZGVhZCkge1xuICAgICAgdHJfY2xhc3MgKz0gXCJkZWFkIFwiO1xuICAgIH1cbiAgICBzdHIgKz1cbiAgICAgIFwiPHRyIGNsYXNzPSdcIiArXG4gICAgICB0cl9jbGFzcyArXG4gICAgICBcIicnPjx0ZD5cIiArXG4gICAgICBwbGF5ZXIubmFtZSArXG4gICAgICBcIjwvdGQ+PHRkIGNsYXNzPSdyZWQnPlwiICtcbiAgICAgIChwbGF5ZXIubGV2ZWwgKyAxKSArXG4gICAgICBcIjwvdGQ+PHRkIGNsYXNzPSdncmVlbic+XCIgK1xuICAgICAgcGxheWVyLnNjb3JlICtcbiAgICAgIFwiPC90ZD48L3RyPlwiO1xuICB9XG5cbiAgLy8gY2hlY2sgZm9yIGxldmVsIHVwc1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLnBsYXllcnNfcmVmKSB7XG4gICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc19yZWZbaWRdO1xuICAgIHZhciBjb3JlX3BsYXllciA9IHRoaXMuZ2FtZS5jb3JlLnN0YXRlLnBsYXllcnNbaWRdO1xuICAgIGlmICghY29yZV9wbGF5ZXIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAocGxheWVyLmxldmVsICE9PSBjb3JlX3BsYXllci5sZXZlbCkge1xuICAgICAgdGhpcy5ydW5fZXZlbnQoe1xuICAgICAgICB0eXBlOiBcInBsYXllcl9sZXZlbFwiLFxuICAgICAgICBpZDogcGFyc2VJbnQoaWQpLFxuICAgICAgICBwcmV2OiBwbGF5ZXIubGV2ZWwsXG4gICAgICAgIG5ldzogY29yZV9wbGF5ZXIubGV2ZWxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5wbGF5ZXJzX3JlZltpZF0ubGV2ZWwgPSBjb3JlX3BsYXllci5sZXZlbDtcbiAgICB9XG4gIH1cblxuICAvLyBzZXQgY29udGVudFxuICB0aGlzLnRhYmxlX3BsYXllcnMuaW5uZXJIVE1MID0gc3RyO1xufTtcblxuLyogU29ydCBwbGF5ZXJzIGJ5IHNjb3JlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucGxheWVyc19zb3J0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzb3J0YWJsZSA9IFtdO1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLnBsYXllcnNfcmVmKSB7XG4gICAgdmFyIGNvcmVfcGxheWVyID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUucGxheWVyc1tpZF07XG4gICAgaWYgKCFjb3JlX3BsYXllcikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHNvcnRhYmxlLnB1c2goe1xuICAgICAgaWQ6IGlkLFxuICAgICAgbmFtZTogdGhpcy5wbGF5ZXJzX3JlZltpZF0ubmFtZSxcbiAgICAgIGxldmVsOiBjb3JlX3BsYXllci5sZXZlbCxcbiAgICAgIHNjb3JlOiBjb3JlX3BsYXllci5zY29yZSxcbiAgICAgIGRlYWQ6IGNvcmVfcGxheWVyLmRlYWRcbiAgICB9KTtcbiAgfVxuICBzb3J0YWJsZS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gIH0pO1xuICByZXR1cm4gc29ydGFibGU7XG59O1xuXG4vKiBQbGF5ZXIgaGFzIGpvaW5lZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnBsYXllcl9qb2luID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5pbml0X3BsYXllcihldmVudCwgdHJ1ZSk7XG4gIHRoaXMuYXVkaW8ucGxheShcImpvaW5cIiwgMSk7XG59O1xuXG4vKiBQbGF5ZXIgbGVmdFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnBsYXllcl9sZWF2ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmICghdGhpcy5wbGF5ZXJzW2V2ZW50LnVzZXJfaWRdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGlkID0gdGhpcy5wbGF5ZXJzW2V2ZW50LnVzZXJfaWRdLnBsYXllcl9pZDtcbiAgZGVsZXRlIHRoaXMucGxheWVyc19yZWZbaWRdO1xuICBkZWxldGUgdGhpcy5wbGF5ZXJzW2V2ZW50LnVzZXJfaWRdO1xuICB0aGlzLnBsYXllcl9jb3VudC0tO1xuXG4gIC8vIHJlbW92ZSBmcm9tIGdhbWVcbiAgaWYgKHRoaXMuZ2FtZSAmJiB0aGlzLmdhbWUuY29yZSkge1xuICAgIHRoaXMuZ2FtZS5jb3JlLnJlbW92ZV9wbGF5ZXIoaWQpO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZSBTdGF0ZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSZWNlaXZlIGdhbWUgc3RhdGUgZnJvbSBzZXJ2ZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbm11bHRpcGxheWVyLnByb3RvdHlwZS5nYW1lX3N0YXRlX3JlY2VpdmVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gaWYgd2UgYXJlIGxvYWRpbmdcbiAgaWYgKHRoaXMubG9hZGluZ19zdGFydCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHN0YXJ0IHRoZSBnYW1lXG4gIGlmICghdGhpcy5pbml0aWFsaXNlZCB8fCB0aGlzLmRpc2Nvbm5lY3RlZCkge1xuICAgIHRoaXMuaW5pdGlhbGlzZWQgPSB0cnVlO1xuICAgIHRoaXMuaW5pdF9nYW1lKGV2ZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZGlmZiA9IGV2ZW50LmZyYW1lcyAtIHRoaXMuZnJhbWVzO1xuXG4gIC8vIGlmIHdlIGFyZSB0b28gcXVpY2tcbiAgaWYgKGRpZmYgPCAwKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJjbGllbnQgdG9vIGZhc3RcIik7XG4gICAgdGhpcy5pbml0X2dhbWUoZXZlbnQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGlmIGl0J3MgdG9vIGZhciBiZWhpbmQgcmVzeW5jXG4gIGlmIChkaWZmID4gOSkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVzeW5jXCIpO1xuICAgIHRoaXMuaW5pdF9nYW1lKGV2ZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBhcHBseSB0aGUgc3RhdGVcbiAgaWYgKGV2ZW50LmZyYW1lcyA9PT0gdGhpcy5mcmFtZXMpIHtcbiAgICB0aGlzLnNldF9nYW1lX3N0YXRlKGV2ZW50KTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnN0b3JlX3BhY2tldFtldmVudC5mcmFtZXNdID0gZHVwbGljYXRlX29iaihldmVudCk7XG4gIH1cbn07XG5cbi8qIFNldCBnYW1lIHN0YXRlXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUuc2V0X2dhbWVfc3RhdGUgPSBmdW5jdGlvbihldmVudCwgaWdub3JlX3Jlcykge1xuICAvLyBydW4gZGFtYWdlc1xuICB0aGlzLnJlc29sdmVfZ3JvdW5kKGV2ZW50LmRhbWFnZXMpO1xuXG4gIC8vIHVucGFjayB0aGUgc3RhdGVcbiAgdmFyIHN0YXRlID0gdGhpcy5nYW1lLmNvcmUudW5wYWNrX3N0YXRlKGV2ZW50LnN0YXRlKTtcblxuICAvLyBzZXQgcGxheWVyc1xuICB0aGlzLnJlc29sdmVfcGxheWVycyhzdGF0ZSwgaWdub3JlX3Jlcyk7XG5cbiAgLy8gc2V0IHRoaXMgcGxheWVyXG4gIGlmICghaWdub3JlX3Jlcykge1xuICAgIHRoaXMucmVzb2x2ZV90aGlzX3BsYXllcihzdGF0ZSwgZXZlbnQucmVzcG9uc2VzKTtcbiAgfVxuXG4gIC8vIHNldCBvYmplY3RzXG4gIHRoaXMucmVzb2x2ZV9vYmplY3RzKHN0YXRlLm9iamVjdHMsIGV2ZW50LmZyYW1lcyk7XG5cbiAgLy8gc2V0IGV4cGxvc2lvbnNcbiAgdGhpcy5yZXNvbHZlX2V4cGxvc2lvbnMoc3RhdGUuZXhwbG9zaW9ucywgZXZlbnQuZnJhbWVzKTtcblxuICAvLyBzZXQgZ2FtZSBwbGF5ZXIgcmVmZXJlbmNlc1xuICB0aGlzLmdhbWUuc2V0X3RoaXNfcGxheWVyX3JlZnMoKTtcbn07XG5cbi8qIFJlc29sdmUgcGxheWVyc1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfcGxheWVycyA9IGZ1bmN0aW9uKHN0YXRlLCBpZ25vcmVfcmVzKSB7XG4gIC8vIHNldCBhbGwgb3RoZXIgcGxheWVyc1xuICBmb3IgKHZhciBrZXkgaW4gc3RhdGUucGxheWVycykge1xuICAgIGlmIChwYXJzZUludChrZXkpICE9PSB0aGlzLnBsYXllcl9pZCB8fCBpZ25vcmVfcmVzKSB7XG4gICAgICB0aGlzLmdhbWUuaW5pdF9wbGF5ZXIoc3RhdGUucGxheWVyc1trZXldLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvLyByZW1vdmUgcGxheWVyc1xuICBmb3IgKHZhciBrZXkgaW4gdGhpcy5nYW1lLmNvcmUuc3RhdGUucGxheWVycykge1xuICAgIGlmICghc3RhdGUucGxheWVyc1trZXldKSB7XG4gICAgICB0aGlzLmdhbWUuY29yZS5yZW1vdmVfcGxheWVyKGtleSk7XG4gICAgfVxuICB9XG59O1xuXG4vKiBSZXNvbHZlIHRoaXMgcGxheWVyXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzb2x2ZV90aGlzX3BsYXllciA9IGZ1bmN0aW9uKHN0YXRlLCByZXNwb25zZXMpIHtcbiAgLy8gcHJlcCBzZXJ2ZXIgc3RhdGUgb2JqZWN0c1xuICB2YXIgc2VydmVyX3BsYXllciA9IHN0YXRlLnBsYXllcnNbdGhpcy5wbGF5ZXJfaWRdO1xuICB2YXIgc2VydmVyX29iaiA9IHN0YXRlLm9iamVjdHNbXCJwbGF5ZXItXCIgKyB0aGlzLnBsYXllcl9pZF07XG4gIGlmICghc2VydmVyX3BsYXllciB8fCAhc2VydmVyX29iaikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHByZXAgc2VydmVyIHJlc3BvbnNlc1xuICB2YXIgc2VydmVyX3Jlc3BvbnNlcyA9IFtdO1xuICB2YXIgc3BsaXQgPSByZXNwb25zZXMuc3BsaXQoXCIkXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNwbGl0MiA9IHNwbGl0W2ldLnNwbGl0KFwiflwiKTtcbiAgICBzZXJ2ZXJfcmVzcG9uc2VzLnB1c2goe1xuICAgICAgZnJhbWU6IHBhcnNlSW50KHNwbGl0MlswXSksXG4gICAgICBzdWNjZXNzOiBzcGxpdDJbMV0gPT09IFwiMVwiLFxuICAgICAgeDogcGFyc2VGbG9hdChzcGxpdDJbMl0pLFxuICAgICAgeTogcGFyc2VGbG9hdChzcGxpdDJbM10pLFxuICAgICAgc3BlZWRfeDogcGFyc2VGbG9hdChzcGxpdDJbNF0pLFxuICAgICAgc3BlZWRfeTogcGFyc2VGbG9hdChzcGxpdDJbNV0pLFxuICAgICAgdHlwZTogc3BsaXQyWzZdXG4gICAgfSk7XG4gIH1cblxuICAvLyBjaGVjayBwbGF5ZXIgd2VhcG9uXG4gIGlmIChzZXJ2ZXJfcGxheWVyLndlYXBvbiAhPT0gdGhpcy5nYW1lLmN1cnJlbnRfd2VhcG9uKSB7XG4gICAgdGhpcy5zb2NrZXRzLm1lc3NhZ2Vfc2VuZChcIndlYXBvbl9zZWxlY3RlZFwiLCBbdGhpcy5nYW1lLmN1cnJlbnRfd2VhcG9uXSk7XG4gIH1cblxuICAvLyBpZiB3ZSBoYXZlIG5vIG1vcmUgYWN0aW9uc1xuICBpZiAodGhpcy5zdG9yZV9yZXNwb25zZXMubGVuZ3RoID09PSAwKSB7XG4gICAgdGhpcy5nYW1lLnBsYXllci5sZXZlbCA9IHNlcnZlcl9wbGF5ZXIubGV2ZWw7XG4gICAgdGhpcy5nYW1lLnBsYXllci5zY29yZSA9IHNlcnZlcl9wbGF5ZXIuc2NvcmU7XG4gICAgdGhpcy5nYW1lLnBsYXllci5kZWFkID0gc2VydmVyX3BsYXllci5kZWFkO1xuICAgIHRoaXMuZ2FtZS5wbGF5ZXIuaGVhbHRoID0gc2VydmVyX3BsYXllci5oZWFsdGg7XG4gICAgdGhpcy5nYW1lLnBsYXllci5jb29sZG93biA9IHNlcnZlcl9wbGF5ZXIuY29vbGRvd247XG4gICAgdGhpcy5nYW1lLnBsYXllci5hcm1vdXJ5ID0gZHVwbGljYXRlX29iaihzZXJ2ZXJfcGxheWVyLmFybW91cnkpO1xuICAgIHRoaXMuZ2FtZS5zZXRfYXJtb3VyeSgpO1xuICB9XG5cbiAgLy8gcmVzb2x2ZSBvdXIgcGxheWVyXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdG9yZV9yZXNwb25zZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY2xpZW50X3Jlc3BvbnNlID0gdGhpcy5zdG9yZV9yZXNwb25zZXNbaV07XG5cbiAgICAvLyBnbyB0aHJvdWdoIGFjdGlvbiByZXNwb25zZXNcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlcnZlcl9yZXNwb25zZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgIHZhciBzZXJ2ZXJfcmVzcG9uc2UgPSBzZXJ2ZXJfcmVzcG9uc2VzW2pdO1xuXG4gICAgICAvLyBjb3JyZWN0IGZyYW1lXG4gICAgICBpZiAoY2xpZW50X3Jlc3BvbnNlLmZyYW1lID09PSBzZXJ2ZXJfcmVzcG9uc2UuZnJhbWUpIHtcbiAgICAgICAgLy8gY29tcGFyZSB0aGUgcmVzcG9uc2VcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNsaWVudF9yZXNwb25zZS5zdWNjZXNzID09PSBzZXJ2ZXJfcmVzcG9uc2Uuc3VjY2VzcyAmJlxuICAgICAgICAgIGNsaWVudF9yZXNwb25zZS54ID09PSBzZXJ2ZXJfcmVzcG9uc2UueCAmJlxuICAgICAgICAgIGNsaWVudF9yZXNwb25zZS55ID09PSBzZXJ2ZXJfcmVzcG9uc2UueSAmJlxuICAgICAgICAgIGNsaWVudF9yZXNwb25zZS5zcGVlZF94ID09PSBzZXJ2ZXJfcmVzcG9uc2Uuc3BlZWRfeCAmJlxuICAgICAgICAgIGNsaWVudF9yZXNwb25zZS5zcGVlZF95ID09PSBzZXJ2ZXJfcmVzcG9uc2Uuc3BlZWRfeVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBjbG9nKFwiYWN0IHN1Y2Nlc3NcIiwgc2VydmVyX3Jlc3BvbnNlLmZyYW1lLCB0aGlzLmZyYW1lcywgc2VydmVyX3Jlc3BvbnNlLnR5cGUsIGNsaWVudF9yZXNwb25zZS54LCBzZXJ2ZXJfcmVzcG9uc2UueCwgY2xpZW50X3Jlc3BvbnNlLnksIHNlcnZlcl9yZXNwb25zZS55KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyByZXN5bmMgdGhlIHBsYXllclxuICAgICAgICAgIGNsb2coXG4gICAgICAgICAgICBcImFjdCBmYWlsXCIsXG4gICAgICAgICAgICBzZXJ2ZXJfcmVzcG9uc2UuZnJhbWUsXG4gICAgICAgICAgICB0aGlzLmZyYW1lcyxcbiAgICAgICAgICAgIHNlcnZlcl9yZXNwb25zZS50eXBlLFxuICAgICAgICAgICAgY2xpZW50X3Jlc3BvbnNlLngsXG4gICAgICAgICAgICBzZXJ2ZXJfcmVzcG9uc2UueCxcbiAgICAgICAgICAgIGNsaWVudF9yZXNwb25zZS55LFxuICAgICAgICAgICAgc2VydmVyX3Jlc3BvbnNlLnlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghdGhpcy5yZXN5bmNfdGhpc19wbGF5ZXIoc2VydmVyX3Jlc3BvbnNlKSkge1xuICAgICAgICAgICAgdGhpcy5nYW1lLmluaXRfcGxheWVyKHNlcnZlcl9wbGF5ZXIsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5jcmVhdGVfb2JqZWN0KHNlcnZlcl9vYmopO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzZXJ2ZXJfcmVzcG9uc2VzLnNwbGljZShqLCAxKTtcbiAgICAgICAgdGhpcy5zdG9yZV9yZXNwb25zZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICBpLS07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyogU3luYyB0aGlzIHBsYXllclxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc3luY190aGlzX3BsYXllciA9IGZ1bmN0aW9uKHNlcnZlcl9yZXNwb25zZSkge1xuICAvLyBob3cgZmFyIGJhY2sgaXMgdGhpc1xuICB2YXIgZnJhbWUgPSBzZXJ2ZXJfcmVzcG9uc2UuZnJhbWU7XG4gIHZhciBmcmFtZV9kaWZmZXJlbmNlID0gdGhpcy5mcmFtZXMgLSBmcmFtZTtcblxuICAvLyBpZiBpdCdzIHRvbyBmYXIgYmFja1xuICAvLyBpZiB3ZSBoYXZlIG5vIHN0YXRlIHRvIHJvbGwgYmFjayB0b1xuICBpZiAoZnJhbWVfZGlmZmVyZW5jZSA+IDIwIHx8ICF0aGlzLnN0b3JlX3N0YXRlW2ZyYW1lXSkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwic3luYyB0b28gZmFyIGJhY2sgfCBcIiArIGZyYW1lX2RpZmZlcmVuY2UpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIHJlc2V0IGdhbWUgc3RhdGVcbiAgdGhpcy5zZXRfZ2FtZV9zdGF0ZSh0aGlzLnN0b3JlX3N0YXRlW2ZyYW1lXSwgdHJ1ZSk7XG5cbiAgLy8gcmVzZXQgcGxheWVyXG4gIHRoaXMuc3RvcmVfcmVzcG9uc2VzID0gW107XG4gIHRoaXMuZ2FtZS5wbGF5ZXJfb2JqLnggPSBzZXJ2ZXJfcmVzcG9uc2UueDtcbiAgdGhpcy5nYW1lLnBsYXllcl9vYmoueSA9IHNlcnZlcl9yZXNwb25zZS55O1xuICB0aGlzLmdhbWUucGxheWVyX29iai5zcGVlZF94ID0gc2VydmVyX3Jlc3BvbnNlLnNwZWVkX3g7XG4gIHRoaXMuZ2FtZS5wbGF5ZXJfb2JqLnNwZWVkX3kgPSBzZXJ2ZXJfcmVzcG9uc2Uuc3BlZWRfeTtcblxuICAvLyBydW4gYWxsIGZyYW1lcyB1cCB0byB0aGlzIHBvaW50XG4gIGZvciAodmFyIGkgPSAxOyBpIDw9IGZyYW1lX2RpZmZlcmVuY2U7IGkrKykge1xuICAgIHRoaXMuZnJhbWVfcnVuKGZyYW1lICsgaSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qIFJlc29sdmUgb2JqZWN0c1xuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxubXVsdGlwbGF5ZXIucHJvdG90eXBlLnJlc29sdmVfb2JqZWN0cyA9IGZ1bmN0aW9uKG9iamVjdHMsIGZyYW1lKSB7XG4gIC8vIGNoZWNrIGZvciB1bmNyZWF0ZWQgb2JqZWN0c1xuICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0cykge1xuICAgIGlmICghdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0c1trZXldKSB7XG4gICAgICBpZiAoIXRoaXMud2FpdF90b19jcmVhdGVba2V5XSB8fCB0aGlzLndhaXRfdG9fY3JlYXRlW2tleV0gKyA0MCA8IGZyYW1lKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLndhaXRfdG9fY3JlYXRlW2tleV07XG4gICAgICAgIHRoaXMuZ2FtZS5jcmVhdGVfb2JqZWN0KG9iamVjdHNba2V5XSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gaWYgdGhlcmUncyBubyBjb3JyZXNwb25kaW5nIHNlcnZlciBvYmplY3RcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICBpZiAoIW9iamVjdHNba2V5XSkge1xuICAgICAgLy8gZ2l2ZSB0aGVtIGEgZGVsYXlcbiAgICAgIGlmICghdGhpcy53YWl0X3RvX2Rlc3Ryb3lba2V5XSkge1xuICAgICAgICB0aGlzLndhaXRfdG9fZGVzdHJveVtrZXldID0gZnJhbWUgKyA0MDtcbiAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgLy8gcmVtb3ZlIHdoZW4gZGVsYXkgaGFzIGV4cGlyZWRcbiAgICAgIH0gZWxzZSBpZiAodGhpcy53YWl0X3RvX2Rlc3Ryb3lba2V5XSA8IGZyYW1lKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmdhbWUuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgICAgIGRlbGV0ZSB0aGlzLndhaXRfdG9fZGVzdHJveVtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIG1hdGNoIHVwIG9iamVjdHNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLm9iamVjdHMpIHtcbiAgICAvLyBpZiBvdXIgcGxheWVyIGFuZCB3YWl0aW5nIGZvciBhY3Rpb24gcmVzcG9uc2VzXG4gICAgaWYgKGtleSA9PT0gXCJwbGF5ZXItXCIgKyB0aGlzLnBsYXllcl9pZCkge1xuICAgICAgaWYgKHRoaXMuc3RvcmVfcmVzcG9uc2VzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgb2JqID0gdGhpcy5nYW1lLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIHZhciByZXNfb2JqID0gb2JqZWN0c1trZXldO1xuXG4gICAgLy8gaWdub3JlIGFueSBvYmplY3RzIHdpdGggbm8gcmVmZXJlbmNlXG4gICAgaWYgKCFyZXNfb2JqKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBtYXRjaCB2YWx1ZXNcbiAgICBpZiAob2JqLnR5cGUgIT09IHJlc19vYmoudHlwZSkge1xuICAgICAgb2JqLnR5cGUgPSByZXNfb2JqLnR5cGU7XG4gICAgICBvYmouYyA9IHRoaXMuZ2FtZS5jLm9iamVjdHNbb2JqLnR5cGVdO1xuICAgIH1cbiAgICBvYmouZ3JvdW5kZWQgPSByZXNfb2JqLmdyb3VuZGVkO1xuXG4gICAgLy8gaWYgZ3JvdW5kZWQgb3IgdXNcbiAgICBpZiAob2JqLmdyb3VuZGVkIHx8IG9iai5wbGF5ZXJfaWQgPT09IHRoaXMucGxheWVyX2lkKSB7XG4gICAgICBvYmoueCA9IHJlc19vYmoueDtcbiAgICAgIG9iai55ID0gcmVzX29iai55O1xuICAgICAgb2JqLnNwZWVkX3ggPSByZXNfb2JqLnNwZWVkX3g7XG4gICAgICBvYmouc3BlZWRfeSA9IHJlc19vYmouc3BlZWRfeTtcblxuICAgICAgLy8gc2V0IGludGVycG9sYXRpb24gcG9zaXRpb25cbiAgICB9IGVsc2UgaWYgKCFvYmouYWN0aW9uZWQpIHtcbiAgICAgIG9iai5naG9zdCA9IGZyYW1lO1xuICAgICAgb2JqLmd4ID0gb2JqLng7XG4gICAgICBvYmouZ3kgPSBvYmoueTtcbiAgICAgIG9iai54ID0gcmVzX29iai54O1xuICAgICAgb2JqLnkgPSByZXNfb2JqLnk7XG4gICAgICBvYmouc3BlZWRfeCA9IHJlc19vYmouc3BlZWRfeDtcbiAgICAgIG9iai5zcGVlZF95ID0gcmVzX29iai5zcGVlZF95O1xuICAgIH1cbiAgfVxufTtcblxuLyogUmVzb2x2ZSBvYmplY3RzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tdWx0aXBsYXllci5wcm90b3R5cGUucmVzb2x2ZV9leHBsb3Npb25zID0gZnVuY3Rpb24oZXhwbG9zaW9ucywgZnJhbWUpIHtcbiAgLy8gY2hlY2sgZm9yIHVuY3JlYXRlZCBleHBsb3Npb25zXG4gIGZvciAodmFyIGtleSBpbiBleHBsb3Npb25zKSB7XG4gICAgaWYgKCF0aGlzLmdhbWUuY29yZS5zdGF0ZS5leHBsb3Npb25zW2tleV0pIHtcbiAgICAgIHRoaXMuZ2FtZS5jb3JlLmNyZWF0ZV9leHBsb3Npb24oZXhwbG9zaW9uc1trZXldKTtcblxuICAgICAgLy8gZW5zdXJlIGNvcnJlY3QgcG9zaXRpb25cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nYW1lLmNvcmUuc3RhdGUuZXhwbG9zaW9uc1trZXldLnggPSBleHBsb3Npb25zW2tleV0ueDtcbiAgICAgIHRoaXMuZ2FtZS5jb3JlLnN0YXRlLmV4cGxvc2lvbnNba2V5XS55ID0gZXhwbG9zaW9uc1trZXldLnk7XG4gICAgfVxuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFRyYWNrZXIgQXJyb3dzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogUnVuIHRoZSBhcnJvd3NcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9hcnJvd3MgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgdHlwZSBpbiB0aGlzLnNjaGVtZS5hcnJvd3MpIHtcbiAgICB2YXIgYXJyb3cgPSB0aGlzLnNjaGVtZS5hcnJvd3NbdHlwZV07XG4gICAgaWYgKCFhcnJvdykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZmluZCBjbG9zZXN0IHRoaW5nXG4gICAgdmFyIGxvd2VzdCA9IDk5OTk5O1xuICAgIHZhciBjbG9zZXN0X29iaiA9IG51bGw7XG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzKSB7XG4gICAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICAgIGlmIChvYmoudHlwZSA9PT0gXCJwbGF5ZXJcIiAmJiBvYmoucGxheWVyX2lkID09PSB0aGlzLnBsYXllcl9pZCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChvYmoudHlwZSA9PT0gdHlwZSkge1xuICAgICAgICB2YXIgZGlzdCA9IHRoaXMuY29yZS5tYXAuZ2V0X2Rpc3RhbmNlKFxuICAgICAgICAgIG9iai54LFxuICAgICAgICAgIG9iai55LFxuICAgICAgICAgIHRoaXMuY2FtZXJhLngsXG4gICAgICAgICAgdGhpcy5jYW1lcmEueVxuICAgICAgICApO1xuICAgICAgICBpZiAoZGlzdCA8IGxvd2VzdCkge1xuICAgICAgICAgIGxvd2VzdCA9IGRpc3Q7XG4gICAgICAgICAgY2xvc2VzdF9vYmogPSBvYmo7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFjbG9zZXN0X29iaikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHNjcmVlbiBwb3NpdGlvblxuICAgIHZhciBwb3MgPSB0aGlzLnNjcmVlbl9wb3NpdGlvbihjbG9zZXN0X29iai54LCBjbG9zZXN0X29iai55LCA4MCk7XG4gICAgaWYgKHBvcy5vbl9zY3JlZW4pIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIHNob3cgYW4gYXJyb3dcbiAgICB2YXIgYW5nbGUgPSB0aGlzLmNvcmUubWFwLmdldF9oZWFkaW5nKFxuICAgICAgdGhpcy5jYW1lcmEueCxcbiAgICAgIHRoaXMuY2FtZXJhLnksXG4gICAgICBjbG9zZXN0X29iai54LFxuICAgICAgY2xvc2VzdF9vYmoueVxuICAgICk7XG4gICAgdmFyIGRpc3QgPSBtaW4obG93ZXN0LCBtaW4odGhpcy5jYW52YXMuY3gsIHRoaXMuY2FudmFzLmN5KSkgLSAyMjtcbiAgICB2YXIgeHkgPSB4eV9zcGVlZChhbmdsZSwgZGlzdCk7XG4gICAgdGhpcy5zcHJpdGVzLnB1c2goe1xuICAgICAgdHlwZTogXCJhcnJvdy1cIiArIGFycm93LFxuICAgICAgeDogcm91bmQodGhpcy5jYW1lcmEueCArIHh5LngpLFxuICAgICAgeTogcm91bmQodGhpcy5jYW1lcmEueSArIHh5LnkpLFxuICAgICAgYW5nbGU6IGFuZ2xlX2FkZChhbmdsZSwgMjcwKVxuICAgIH0pO1xuICB9XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIEJhY2tncm91bmQgTGF5ZXJcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgYmFja2dyb3VuZFxuICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuaW5pdF9iYWNrZ3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuYmcgPSB7fTtcbiAgdGhpcy5iZy5wYXJhbGxheCA9IDAuNTtcbiAgdGhpcy5iZy54ID0gMDtcbiAgdGhpcy5iZy55ID0gMDtcbiAgdGhpcy5iZy53ID0gdGhpcy5pbWcuYmcud2lkdGg7XG4gIHRoaXMuYmcuaCA9IHRoaXMuaW1nLmJnLmhlaWdodDtcbiAgdGhpcy5iZy5wYXR0ZXJuID0gdGhpcy5jYW52YXMuY29udC5jcmVhdGVQYXR0ZXJuKHRoaXMuaW1nLmJnLCBcInJlcGVhdFwiKTtcbn07XG5cbi8qIERyYXcgdGhlIGJhY2tncm91bmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X2JhY2tncm91bmQgPSBmdW5jdGlvbigpIHtcbiAgLy8gaG93IG11Y2ggaGF2ZSB3ZSBtb3ZlZCBieVxuICB2YXIgZHggPVxuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeCh0aGlzLmNhbWVyYS54LCB0aGlzLmNhbWVyYS5weCkgKlxuICAgICAgdGhpcy5iZy5wYXJhbGxheCxcbiAgICBkeSA9XG4gICAgICB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV95KHRoaXMuY2FtZXJhLnksIHRoaXMuY2FtZXJhLnB5KSAqXG4gICAgICB0aGlzLmJnLnBhcmFsbGF4O1xuXG4gIC8vIGFkZCBtb3ZlbWVudCBtdWx0aXBsaWVkIGJ5IHBhcmFsbGF4IGRlZ3JlZVxuICB0aGlzLmJnLnggPSBuX2xvb3AodGhpcy5iZy54ICsgZHgsIDAsIHRoaXMuYmcudyk7XG4gIHRoaXMuYmcueSA9IG5fbG9vcCh0aGlzLmJnLnkgKyBkeSwgMCwgdGhpcy5iZy5oKTtcblxuICAvLyBkcmF3IGl0XG4gIHZhciBzaXplID0gbWF4KHRoaXMuY2FudmFzLmgsIHRoaXMuY2FudmFzLncpO1xuICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZShcbiAgICB0aGlzLmJnLnggKyB0aGlzLmNhbWVyYS5zeCxcbiAgICB0aGlzLmJnLnkgKyB0aGlzLmNhbWVyYS5zeVxuICApO1xuICB0aGlzLmNhbnZhcy5jb250LmZpbGxTdHlsZSA9IHRoaXMuYmcucGF0dGVybjtcbiAgdGhpcy5jYW52YXMuY29udC5maWxsUmVjdCgtc2l6ZSwgLXNpemUsIHNpemUgKiAzLCBzaXplICogMyk7XG4gIHRoaXMuY2FudmFzLmNvbnQudHJhbnNsYXRlKFxuICAgIC0odGhpcy5iZy54ICsgdGhpcy5jYW1lcmEuc3gpLFxuICAgIC0odGhpcy5iZy55ICsgdGhpcy5jYW1lcmEuc3kpXG4gICk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIENhbWVyYSBQb3NpdGlvblxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbi8qIFNldCB1cCBjYW1lcmEgcG9zaXRpb25cblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2NhbWVyYSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmNhbWVyYSA9IHt9O1xuICB0aGlzLmNhbWVyYS54ID0gcm91bmQodGhpcy5tYXAuZmcuY2Fudi53aWR0aCAvIDIpO1xuICB0aGlzLmNhbWVyYS55ID0gcm91bmQodGhpcy5tYXAuZmcuY2Fudi5oZWlnaHQgLyAyKTtcbiAgdGhpcy5jYW1lcmEucHggPSB0aGlzLmNhbWVyYS54O1xuICB0aGlzLmNhbWVyYS5weSA9IHRoaXMuY2FtZXJhLnk7XG5cbiAgLy8gd2F0Y2hlciBmb2xsb3cgcGxheWVyXG4gIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9IFwibGVhZGVyXCI7XG4gIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvd19wbGF5ZXIgPSBcIlwiO1xuXG4gIC8vIGNhbWVyYSB3ZWFwb25cbiAgdGhpcy5jYW1lcmFfd2VhcG9uX2tleSA9IG51bGw7XG5cbiAgLy8gY2FtZXJhIHNoYWtlIG9uIGhpdFxuICB0aGlzLmNhbWVyYS5zaGFrZV9mcmFtZSA9IG51bGw7XG4gIHRoaXMuY2FtZXJhLnN4ID0gMDtcbiAgdGhpcy5jYW1lcmEuc3kgPSAwO1xuXG4gIC8vIGNhbWVyYSBmb2N1cyBldmVudFxuICB0aGlzLmNhbWVyYS5mb2N1cyA9IG51bGw7XG4gIHRoaXMuY2FtZXJhLmZvY3VzX3RpbWUgPSAwO1xuICB0aGlzLmNhbWVyYS5meCA9IDA7XG4gIHRoaXMuY2FtZXJhLmZ5ID0gMDtcblxuICAvLyBjdXJzb3JcbiAgdGhpcy5jdXJzb3IgPSB7IHg6IDAsIHk6IDAgfTtcblxuICAvLyB3ZWFwb24gZm9sbG93aW5nXG4gIHRoaXMud2VhcG9uX2ZvbGxvdyA9IGZhbHNlO1xuICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSBcIlwiO1xufTtcblxuLyogU3dpdGNoIHdhdGNoZXIgY2FtZXJhXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc3dpdGNoX3dhdGNoZXJfY2FtZXJhID0gZnVuY3Rpb24oKSB7XG4gIGlmICghd2F0Y2gpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnBsYXllcnMpO1xuICB2YXIgaW5kZXggPSBrZXlzLmluZGV4T2YodGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllcik7XG4gIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICBpZiAoaW5kZXggPT09IGtleXMubGVuZ3RoIC0gMSkge1xuICAgICAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllciA9IG51bGw7XG4gICAgICB0aGlzLmNhbWVyYS53YXRjaF9mb2xsb3cgPSBcImxlYWRlclwiO1xuICAgICAgdGhpcy5zZXRfYWxlcnQoXCJGb2xsb3dpbmcgdGhlIExlYWRlclwiLCBcIiNjY2ZmY2NcIiwgMTAwKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllciA9IGtleXNbaW5kZXggKyAxXTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllciA9IGtleXNbMF07XG4gIH1cbiAgY29uc29sZS5sb2codGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllcik7XG4gIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllcl07XG4gIHRoaXMuY2FtZXJhLndhdGNoX2ZvbGxvdyA9IFwicGxheWVyXCI7XG4gIHRoaXMuc2V0X2FsZXJ0KFwiRm9sbG93aW5nIFwiICsgcGxheWVyLm5hbWUsIFwiI2VlZWVlZVwiLCAxMDApO1xufTtcblxuLyogQ2FsY3VsYXRlIGN1cnJlbnQgY2FtZXJhIHBvc2l0aW9uXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUucnVuX2NhbWVyYSA9IGZ1bmN0aW9uKCkge1xuICAvLyBzdG9wIGZvbGxvd2luZyBpZiBoaXRcbiAgaWYgKHRoaXMud2VhcG9uX2ZvbGxvd2luZyAmJiB0aGlzLnBsYXllciAmJiB0aGlzLnBsYXllci5oaXQgPiAwKSB7XG4gICAgdGhpcy53ZWFwb25fZm9sbG93aW5nID0gXCJcIjtcbiAgfVxuXG4gIC8vIHNldCBwcmV2aW91cyBwb3NpdGlvblxuICB0aGlzLmNhbWVyYS5weCA9IHRoaXMuY2FtZXJhLng7XG4gIHRoaXMuY2FtZXJhLnB5ID0gdGhpcy5jYW1lcmEueTtcblxuICB2YXIgeCwgeSwgbW92ZTtcblxuICAvLyBzZXQgZmFsbGJhY2sgY2FtZXJhXG4gIHZhciB3YXRjaF9wbGF5ZXJfaWQgPSAwO1xuICBpZiAodGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93ID09PSBcImxlYWRlclwiKSB7XG4gICAgd2F0Y2hfcGxheWVyX2lkID0gdGhpcy5sZWFkZXI7XG4gIH0gZWxzZSBpZiAodGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93ID09PSBcInBsYXllclwiKSB7XG4gICAgd2F0Y2hfcGxheWVyX2lkID0gdGhpcy5jYW1lcmEud2F0Y2hfZm9sbG93X3BsYXllcjtcbiAgfVxuXG4gIC8vIGZpbmQgb2JqZWN0IHRvIGZvbGxvd1xuICB2YXIgZm9sbG93X29iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW3RoaXMud2VhcG9uX2ZvbGxvd2luZ107XG4gIHZhciB3YXRjaF9vYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1tcInBsYXllci1cIiArIHdhdGNoX3BsYXllcl9pZF07XG4gIGlmIChmb2xsb3dfb2JqKSB7XG4gICAgeCA9IGZvbGxvd19vYmouZHg7XG4gICAgeSA9IGZvbGxvd19vYmouZHk7XG4gICAgbW92ZSA9IDMwO1xuICB9IGVsc2UgaWYgKHRoaXMucGxheWVyX29iaikge1xuICAgIHggPSB0aGlzLnBsYXllcl9vYmouZHg7XG4gICAgeSA9IHRoaXMucGxheWVyX29iai5keTtcbiAgICBtb3ZlID0gNjA7XG4gIH0gZWxzZSBpZiAod2F0Y2hfb2JqKSB7XG4gICAgeCA9IHdhdGNoX29iai5keDtcbiAgICB5ID0gd2F0Y2hfb2JqLmR5O1xuICAgIG1vdmUgPSAzMDtcbiAgfVxuXG4gIC8vIGdvIHRvIGZvY3VzIGV2ZW50XG4gIGlmIChcbiAgICB0aGlzLmNhbWVyYS5mb2N1cyAhPSBudWxsICYmXG4gICAgdGhpcy5jYW1lcmEuZm9jdXMgPCB0aGlzLmNvcmUuc3RhdGUuZnJhbWUgJiZcbiAgICB0aGlzLmNhbWVyYS5mb2N1cyArIHRoaXMuY2FtZXJhLmZvY3VzX3RpbWUgPiB0aGlzLmNvcmUuc3RhdGUuZnJhbWVcbiAgKSB7XG4gICAgeCA9IHRoaXMuY2FtZXJhLmZ4O1xuICAgIHkgPSB0aGlzLmNhbWVyYS5meTtcbiAgICBtb3ZlID0gMTAwO1xuXG4gICAgLy8gZm9sbG93IGN1cnNvclxuICB9IGVsc2UgaWYgKHRoaXMubW91c2VfZm9sbG93IHx8ICFtb3ZlKSB7XG4gICAgeCA9IHRoaXMuY3Vyc29yLng7XG4gICAgeSA9IHRoaXMuY3Vyc29yLnk7XG4gICAgbW92ZSA9XG4gICAgICB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZSh0aGlzLmNhbWVyYS54LCB0aGlzLmNhbWVyYS55LCB4LCB5KSAqIDAuMDU7XG4gIH1cblxuICAvLyBtb3ZlIHRvd2FyZHMgbmV3IHBvc2l0aW9uXG4gIGlmIChtb3ZlKSB7XG4gICAgdmFyIGR4ID0gdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeCh0aGlzLmNhbWVyYS54LCB4KTtcbiAgICB2YXIgZHkgPSB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV95KHRoaXMuY2FtZXJhLnksIHkpO1xuICAgIHZhciBsaW1pdCA9IGNoZWNrX3NwZWVkKGR4LCBkeSwgbW92ZSk7XG4gICAgdGhpcy5jYW1lcmEueCA9IHRoaXMuY29yZS5tYXAubG9vcF94KHJvdW5kKHRoaXMuY2FtZXJhLnggKyBsaW1pdC54KSk7XG4gICAgdGhpcy5jYW1lcmEueSA9IHRoaXMuY29yZS5tYXAubG9vcF95KHJvdW5kKHRoaXMuY2FtZXJhLnkgKyBsaW1pdC55KSk7XG4gIH1cblxuICAvLyBhZGQgc2NyZWVuIHNoYWtlXG4gIHRoaXMuY2FtZXJhLnN4ID0gMDtcbiAgdGhpcy5jYW1lcmEuc3kgPSAwO1xuICB2YXIgZGlmZiA9IHRoaXMuY2FtZXJhLnNoYWtlX2ZyYW1lXG4gICAgPyB0aGlzLmNvcmUuc3RhdGUuZnJhbWUgLSB0aGlzLmNhbWVyYS5zaGFrZV9mcmFtZVxuICAgIDogMDtcbiAgaWYgKGRpZmYgPCAxNSAmJiBkaWZmID4gMCkge1xuICAgIHRoaXMuY2FtZXJhLnN4ID0gY29zKChkaWZmIC8gMi41IC0gMS41KSAqIHBpKSAqIHRoaXMuY2FtZXJhLnNoYWtlX3NpemU7XG4gICAgdGhpcy5jYW1lcmEuc3kgPSBzaW4oKGRpZmYgLyAzIC0gMSkgKiBwaSkgKiB0aGlzLmNhbWVyYS5zaGFrZV9zaXplO1xuICB9XG5cbiAgLy8gZml4IGN1cnNvciBpbnB1dFxuICB0aGlzLmN1cnNvcl9tYXAoKTtcbn07XG5cbi8qIFRvZ2dsZSB3ZWFwb24gZm9sbG93aW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUudG9nZ2xlX3dlYXBvbl9mb2xsb3cgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gIHRoaXMud2VhcG9uX2ZvbGxvdyA9ICF0aGlzLndlYXBvbl9mb2xsb3c7XG5cbiAgaWYgKG1lc3NhZ2UpIHtcbiAgICB2YXIgdGV4dCA9IFwib25cIjtcbiAgICBpZiAoIXRoaXMud2VhcG9uX2ZvbGxvdykge1xuICAgICAgdGV4dCA9IFwib2ZmXCI7XG4gICAgICB0aGlzLndlYXBvbl9mb2xsb3dpbmcgPSBcIlwiO1xuICAgIH1cbiAgICB0ZXh0ID0gXCJGb2xsb3cgd2VhcG9ucyBcIiArIHRleHQ7XG4gICAgdGhpcy5zZXRfYWxlcnQodGV4dCwgXCIjZWVlXCIpO1xuICB9XG59O1xuXG4vKiBUb2dnbGUgbW91c2UgZm9sbG93aW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUudG9nZ2xlX21vdXNlX2ZvbGxvdyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm1vdXNlX2ZvbGxvdyA9ICF0aGlzLm1vdXNlX2ZvbGxvdztcbiAgdmFyIHRleHQgPSB0aGlzLm1vdXNlX2ZvbGxvdyA/IFwib25cIiA6IFwib2ZmXCI7XG4gIHRleHQgPSBcIkZyZWUgY2FtIFwiICsgdGV4dDtcbiAgdGhpcy5zZXRfYWxlcnQodGV4dCwgXCIjZWVlXCIpO1xufTtcblxuZ2FtZS5wcm90b3R5cGUuY2FuY2VsX21vdXNlX2ZvbGxvdyA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5tb3VzZV9mb2xsb3cpIHtcbiAgICB0aGlzLnRvZ2dsZV9tb3VzZV9mb2xsb3coKTtcbiAgfVxufTtcblxuLyogQ2FsY3VsYXRlIGN1cnNvciBwb3NpdGlvbiBvbiBtYXBcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jdXJzb3JfbWFwID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzY2FsZV94ID0gdGhpcy5jYW52YXMuY2Fudi5vZmZzZXRXaWR0aCAvIHRoaXMuY2FudmFzLnc7XG4gIHZhciBzY2FsZV95ID0gdGhpcy5jYW52YXMuY2Fudi5vZmZzZXRIZWlnaHQgLyB0aGlzLmNhbnZhcy5oO1xuICB2YXIgeDEgPVxuICAgIHRoaXMuY2FtZXJhLnggK1xuICAgIHJvdW5kKCh0aGlzLmlucHV0LmN1cnNvci54IC0gcm91bmQoaW5uZXJXaWR0aCAvIDIpKSAqIHNjYWxlX3gpO1xuICB2YXIgeTEgPVxuICAgIHRoaXMuY2FtZXJhLnkgK1xuICAgIHJvdW5kKCh0aGlzLmlucHV0LmN1cnNvci55IC0gcm91bmQoaW5uZXJIZWlnaHQgLyAyKSkgKiBzY2FsZV95KTtcbiAgdGhpcy5jdXJzb3IueCA9IHRoaXMuY29yZS5tYXAubG9vcF94KHJvdW5kKHgxKSk7XG4gIHRoaXMuY3Vyc29yLnkgPSB0aGlzLmNvcmUubWFwLmxvb3BfeShyb3VuZCh5MSkpO1xufTtcblxuLyogU2NyZWVuIHBvc2l0aW9uIG9mIGEgY28tb3JkaW5hdGVcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zY3JlZW5fcG9zaXRpb24gPSBmdW5jdGlvbih4LCB5LCBzaXplKSB7XG4gIHZhciB4MSA9XG4gICAgICB0aGlzLmNhbnZhcy5jeCArXG4gICAgICB0aGlzLmNvcmUubWFwLmdldF9kaXN0YW5jZV94KHRoaXMuY2FtZXJhLnggLSB0aGlzLmNhbWVyYS5zeCwgeCksXG4gICAgeTEgPVxuICAgICAgdGhpcy5jYW52YXMuY3kgK1xuICAgICAgdGhpcy5jb3JlLm1hcC5nZXRfZGlzdGFuY2VfeSh0aGlzLmNhbWVyYS55IC0gdGhpcy5jYW1lcmEuc3ksIHkpLFxuICAgIG9uX3NjcmVlbiA9XG4gICAgICB4MSA+IC1zaXplICYmXG4gICAgICB4MSA8IHRoaXMuY2FudmFzLncgKyBzaXplICYmXG4gICAgICB5MSA+IC1zaXplICYmXG4gICAgICB5MSA8IHRoaXMuY2FudmFzLmggKyBzaXplO1xuXG4gIHJldHVybiB7XG4gICAgeDogeDEsXG4gICAgeTogeTEsXG4gICAgb25fc2NyZWVuOiBvbl9zY3JlZW5cbiAgfTtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgTWFpbiBDYW52YXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgY2FudmFzXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5pbml0X2NhbnZhcyA9IGZ1bmN0aW9uKCkge1xuICAvLyBzZXQgdXAgbWFpbiBjYW52YXMgZGltZW5zaW9ucyBhbmQgcG9zaXRpb25cbiAgdmFyIGQgPSBzZWxlY3QoXCJwcm9qZWN0YW50c1wiKTtcbiAgdGhpcy5jYW52YXMgPSB7fTtcblxuICAvLyBsaW1pdCBnYW1lIHNpemVcbiAgdGhpcy5jYW52YXMudyA9IGQub2Zmc2V0V2lkdGg7XG4gIHRoaXMuY2FudmFzLmggPSBkLm9mZnNldEhlaWdodDtcbiAgaWYgKHRoaXMuY2FudmFzLmggPCA4MDApIHtcbiAgICB0aGlzLmNhbnZhcy53ID0gcm91bmQodGhpcy5jYW52YXMudyAqICg4MDAgLyB0aGlzLmNhbnZhcy5oKSk7XG4gICAgdGhpcy5jYW52YXMuaCA9IHJvdW5kKHRoaXMuY2FudmFzLmggKiAoODAwIC8gdGhpcy5jYW52YXMuaCkpO1xuICB9XG4gIGlmICh0aGlzLmNhbnZhcy5oID4gMTAwMCkge1xuICAgIHRoaXMuY2FudmFzLncgPSByb3VuZCh0aGlzLmNhbnZhcy53ICogKDEwMDAgLyB0aGlzLmNhbnZhcy5oKSk7XG4gICAgdGhpcy5jYW52YXMuaCA9IHJvdW5kKHRoaXMuY2FudmFzLmggKiAoMTAwMCAvIHRoaXMuY2FudmFzLmgpKTtcbiAgfVxuICB0aGlzLmNhbnZhcy5jeCA9IHJvdW5kKHRoaXMuY2FudmFzLncgLyAyKTtcbiAgdGhpcy5jYW52YXMuY3kgPSByb3VuZCh0aGlzLmNhbnZhcy5oIC8gMik7XG5cbiAgLy8gaW5pdGlhbGlzZSBtYWluIGNhbnZhc1xuICB0aGlzLmNhbnZhcy5jYW52ID0gZWxlbWVudCh7IHR5cGU6IFwiY2FudmFzXCIgfSk7XG4gIHRoaXMuY2FudmFzLmNhbnYuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG4gIHRoaXMuY2FudmFzLmNvbnQgPSB0aGlzLmNhbnZhcy5jYW52LmdldENvbnRleHQoXCIyZFwiKTtcbiAgdGhpcy5jYW52YXMuY2Fudi53aWR0aCA9IHRoaXMuY2FudmFzLnc7XG4gIHRoaXMuY2FudmFzLmNhbnYuaGVpZ2h0ID0gdGhpcy5jYW52YXMuaDtcblxuICBhcHBlbmQodGhpcy5kaXYsIHRoaXMuY2FudmFzLmNhbnYpO1xufTtcblxuLyogRnJhbWUgcmVuZGVyaW5nXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5ydW5fY2FudmFzID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNsZWFyIHRoZSBjYW52YXNcbiAgdGhpcy5jYW52YXMuY29udC5jbGVhclJlY3QoMCwgMCwgdGhpcy53LCB0aGlzLmgpO1xuXG4gIC8vIGRvIHRoZSBkcmF3aW5nXG4gIHRoaXMuZHJhd19iYWNrZ3JvdW5kKCk7XG4gIHRoaXMuZHJhd19tYXAoKTtcbiAgdGhpcy5kcmF3X3Nwcml0ZXMoKTtcbiAgdGhpcy5kcmF3X2xhYmVscygpO1xuICB0aGlzLmRyYXdfbWVzc2FnZXMoKTtcblxuICAvLyBjbGVhciBzcHJpdGVzXG4gIHRoaXMuc3ByaXRlcyA9IFtdO1xufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBPYmplY3QgTGFiZWxzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogTWFuYWdlIGxhYmVsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLnJ1bl9sYWJlbHMgPSBmdW5jdGlvbigpIHtcbiAgLy8gY3JlYXRlIGxhYmVsc1xuICBmb3IgKGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmIChvYmouYy5sYWJlbHMgJiYgIXRoaXMubGFiZWxzW2tleV0pIHtcbiAgICAgIHRoaXMubGFiZWxzW2tleV0gPSB7fTtcbiAgICAgIGZvciAodHlwZSBpbiBvYmouYy5sYWJlbHMpIHtcbiAgICAgICAgaWYgKG9iai5jLmxhYmVsc1t0eXBlXSkge1xuICAgICAgICAgIHRoaXMuY3JlYXRlX2xhYmVsKHRoaXMubGFiZWxzW2tleV0sIHR5cGUsIGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBydW4gdGhyb3VnaCBsYWJlbHNcbiAgZm9yIChrZXkgaW4gdGhpcy5sYWJlbHMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5jb3JlLnN0YXRlLm9iamVjdHNba2V5XTtcbiAgICBpZiAoIW9iaikge1xuICAgICAgZGVsZXRlIHRoaXMubGFiZWxzW2tleV07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgZm9yICh0eXBlIGluIHRoaXMubGFiZWxzW2tleV0pIHtcbiAgICAgIHRoaXMuc2V0X2xhYmVsKHRoaXMubGFiZWxzW2tleV1bdHlwZV0sIG9iaik7XG4gICAgfVxuICB9XG59O1xuXG4vKiBDcmVhdGUgbGFiZWxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5jcmVhdGVfbGFiZWwgPSBmdW5jdGlvbihyZWYsIHR5cGUsIGtleSkge1xuICAvLyBjaGVjayBoZWFsdGggaXMgYWN0aXZlXG4gIGlmICh0eXBlID09PSBcInBsYXllcl9oZWFsdGhcIiAmJiAhdGhpcy5zY2hlbWUuaGVhbHRoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY3JlYXRlIGFuZCBhZGQgdG8gcmVmIG9iamVjdFxuICB2YXIgY2FudiA9IGVsZW1lbnQoeyB0eXBlOiBcImNhbnZhc1wiIH0pO1xuICB2YXIgY29udCA9IGNhbnYuZ2V0Q29udGV4dChcIjJkXCIpO1xuICByZWZbdHlwZV0gPSB7IGNhbnY6IGNhbnYsIGNvbnQ6IGNvbnQsIHRleHQ6IFwiXCIsIGtleToga2V5LCB0eXBlOiB0eXBlIH07XG59O1xuXG4vKiBTZXQgbGFiZWxcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5zZXRfbGFiZWwgPSBmdW5jdGlvbihsYWJlbCwgb2JqKSB7XG4gIC8vIHBvc2l0aW9uXG4gIGlmIChsYWJlbC50eXBlID09PSBcInBvc2l0aW9uXCIpIHtcbiAgICB0aGlzLnNldF9sYWJlbF90ZXh0KGxhYmVsLCBvYmoueCArIFwiIHwgXCIgKyBvYmoueSk7XG4gIH1cblxuICAvLyBwbGF5ZXIgbmFtZVxuICBlbHNlIGlmIChsYWJlbC50eXBlID09PSBcInBsYXllcl9uYW1lXCIpIHtcbiAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW29iai5wbGF5ZXJfaWRdO1xuICAgIGlmIChwbGF5ZXIpIHtcbiAgICAgIHRoaXMuc2V0X2xhYmVsX3RleHQobGFiZWwsIHBsYXllci5uYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlIHRoaXMubGFiZWxzW2xhYmVsLmtleV1bbGFiZWwudHlwZV07XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgLy8gaGVhbHRoIGJhclxuICBlbHNlIGlmIChsYWJlbC50eXBlID09PSBcInBsYXllcl9oZWFsdGhcIikge1xuICAgIHRoaXMuc2V0X2xhYmVsX2hlYWx0aChsYWJlbCwgb2JqLnBsYXllcl9pZCk7XG4gIH1cblxuICAvLyB0aW1lb3V0XG4gIGVsc2UgaWYgKGxhYmVsLnR5cGUgPT09IFwidGltZW91dFwiKSB7XG4gICAgdGhpcy5zZXRfbGFiZWxfdGV4dChcbiAgICAgIGxhYmVsLFxuICAgICAgY2VpbCgob2JqLmMudGltZW91dCAtICh0aGlzLmNvcmUuc3RhdGUuZnJhbWUgLSBvYmouZnJhbWUpKSAvIDI0KVxuICAgICk7XG4gIH1cbn07XG5cbi8qIFNldCB0ZXh0IGxhYmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2xhYmVsX3RleHQgPSBmdW5jdGlvbihsYWJlbCwgdGV4dCkge1xuICAvLyBwcmVwIHRleHRcbiAgdGV4dCA9IFN0cmluZyh0ZXh0KTtcbiAgdGV4dCA9IHN0cl9zcGFjZSh0ZXh0KTtcblxuICAvLyBpZiB0aGVyZSdzIG5vIGNoYW5nZSB0byB0ZXh0XG4gIGlmIChsYWJlbC50ZXh0ID09PSB0ZXh0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gZHJhdyB0ZXh0XG4gIGxhYmVsLncgPSBsYWJlbC5jb250Lm1lYXN1cmVUZXh0KHRleHQpLndpZHRoICsgOTtcbiAgbGFiZWwuaCA9IDE4O1xuICBsYWJlbC5jYW52LndpZHRoID0gbGFiZWwudztcbiAgbGFiZWwuY2Fudi5oZWlnaHQgPSBsYWJlbC5oO1xuICBsYWJlbC5jb250LnJlc3RvcmUoKTtcbiAgbGFiZWwuY29udC5jbGVhclJlY3QoMCwgMCwgbGFiZWwuY2Fudi53aWR0aCwgbGFiZWwuY2Fudi5oZWlnaHQpO1xuICBsYWJlbC5jb250LmZvbnQgPSBcIjEycHggJ09yYml0cm9uJ1wiO1xuICBsYWJlbC5jb250LmZpbGxTdHlsZSA9IFwiIzAwMFwiO1xuICBsYWJlbC5jb250LmZpbHRlciA9IFwiZHJvcC1zaGFkb3coMCAycHggNHB4ICMwMDApXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFRleHQodGV4dCwgNCwgMTQgKyAwLjUpO1xuICBsYWJlbC5jb250LmZpbGxTdHlsZSA9IFwiI2RkZFwiO1xuICBsYWJlbC5jb250LmZpbGxUZXh0KHRleHQsIDQsIDEyICsgMC41KTtcbiAgbGFiZWwuY29udC5zYXZlKCk7XG59O1xuXG4vKiBTZXQgaGVhbHRoIGxhYmVsXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuc2V0X2xhYmVsX2hlYWx0aCA9IGZ1bmN0aW9uKGxhYmVsLCBwbGF5ZXJfaWQpIHtcbiAgaWYgKCF0aGlzLnNjaGVtZS5oZWFsdGgpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgcGxheWVyID0gdGhpcy5jb3JlLnN0YXRlLnBsYXllcnNbcGxheWVyX2lkXTtcbiAgaWYgKCFwbGF5ZXIpIHtcbiAgICBkZWxldGUgdGhpcy5sYWJlbHNbbGFiZWwua2V5XVtsYWJlbC50eXBlXTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBhcmUgd2UgZG9pbmcgYW55dGhpbmcgYXQgYWxsXG4gIHZhciBsZXZlbCA9IHRoaXMuc2NoZW1lLmxldmVscy5oZWFsdGhbcGxheWVyLmxldmVsXTtcbiAgaWYgKCFsZXZlbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGlzIGl0IHRoZSBzYW1lXG4gIHZhciB0ZXh0ID0gcGxheWVyLmhlYWx0aCArIFwiIC8gXCIgKyBsZXZlbDtcbiAgaWYgKHRleHQgPT09IGxhYmVsLnRleHQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgbGFiZWwudGV4dCA9IHRleHQ7XG5cbiAgLy8gZHJhdyBsYWJlbFxuICBsYWJlbC53ID0gcm91bmQobGV2ZWwgLyAyKSArIDY7XG4gIGxhYmVsLmggPSA4O1xuICBsYWJlbC5jYW52LndpZHRoID0gbGFiZWwudztcbiAgbGFiZWwuY2Fudi5oZWlnaHQgPSBsYWJlbC5oO1xuICBsYWJlbC5jb250LmZpbGxTdHlsZSA9IFwicmdiYSgyNTUsMjU1LDI1NSwwLjEpXCI7XG4gIGxhYmVsLmNvbnQuZmlsbFJlY3QoMCwgMCwgbGFiZWwudywgbGFiZWwuaCk7XG4gIGxhYmVsLmNvbnQuZmlsbFN0eWxlID0gXCJyZ2JhKDAsMCwwLDAuOClcIjtcbiAgbGFiZWwuY29udC5maWxsUmVjdCgxLCAxLCBsYWJlbC53IC0gMiwgbGFiZWwuaCAtIDIpO1xuICBsYWJlbC5jb250LmZpbGxTdHlsZSA9IFwiI2U0MWExYVwiO1xuICBsYWJlbC5jb250LmZpbGxSZWN0KDMsIDMsIHJvdW5kKHBsYXllci5oZWFsdGggLyAyKSwgMik7XG5cbiAgLy8gYXJlIHdlIGhpZGluZyBpdFxuICBsYWJlbC5oaWRlID0gcGxheWVyLmRlYWQ7XG59O1xuXG4vKiBEcmF3IGxhYmVsc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfbGFiZWxzID0gZnVuY3Rpb24oKSB7XG4gIC8vIGdvIHRocm91Z2ggYWxsIGxhYmVsc1xuICBmb3IgKGtleSBpbiB0aGlzLmxhYmVscykge1xuICAgIC8vIGlnbm9yZSBlbXB0aWVzIG9yIGhpZGRlbnNcbiAgICBpZiAoIXRoaXMubGFiZWxzW2tleV0pIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBzY3JlZW4gcG9zaXRpb24gb2Ygb2JqZWN0XG4gICAgdmFyIG9iaiA9IHRoaXMuY29yZS5zdGF0ZS5vYmplY3RzW2tleV07XG4gICAgdmFyIHBvc2l0aW9uID0gdGhpcy5zY3JlZW5fcG9zaXRpb24ob2JqLmR4LCBvYmouZHksIDUwKTtcblxuICAgIC8vIGlnbm9yZSB0b28gZmFyIGF3YXkgb2JqZWN0c1xuICAgIGlmICghcG9zaXRpb24ub25fc2NyZWVuKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBnbyB0aHJvdWdoIGxhYmVsc1xuICAgIHZhciBuID0gMDtcbiAgICBmb3IgKHR5cGUgaW4gdGhpcy5sYWJlbHNba2V5XSkge1xuICAgICAgdmFyIGxhYmVsID0gdGhpcy5sYWJlbHNba2V5XVt0eXBlXTtcbiAgICAgIGlmIChsYWJlbC5oaWRlKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdmFyIHggPSByb3VuZChwb3NpdGlvbi54IC0gbGFiZWwudyAvIDIpICsgMDtcbiAgICAgIHZhciB5ID1cbiAgICAgICAgcm91bmQocG9zaXRpb24ueSAtIGxhYmVsLmggLyAyIC0gb2JqLmMuc2l6ZSAqIDIgLSAobGFiZWwuaCAtIDUpICogbikgLVxuICAgICAgICAyMDtcbiAgICAgIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGxhYmVsLmNhbnYsIHgsIHkpO1xuICAgICAgbisrO1xuICAgIH1cbiAgfVxufTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIEdhbWVcbiAgICBNYXAgR3JhcGhpY3NcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBTZXQgdXAgdGhlIG1hcCBjYW52YXNlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmluaXRfbWFwID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMubWFwLmZnLmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJkZXN0aW5hdGlvbi1vdXRcIjtcbn07XG5cbi8qIERyYXcgdGhlIG1hcFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfbWFwID0gZnVuY3Rpb24oKSB7XG4gIHZhciB4ID0gdGhpcy5jYW52YXMuY3ggLSB0aGlzLmNhbWVyYS54ICsgdGhpcy5jYW1lcmEuc3g7XG4gIHZhciB5ID0gdGhpcy5jYW52YXMuY3kgLSB0aGlzLmNhbWVyYS55ICsgdGhpcy5jYW1lcmEuc3k7XG5cbiAgLy8gZHJhdyBsYXllcnNcbiAgdGhpcy5kcmF3X3JlcGVhdGluZ19sYXllcih0aGlzLm1hcC5iZy5jYW52LCB4LCB5KTtcbiAgdGhpcy5kcmF3X3JlcGVhdGluZ19sYXllcih0aGlzLm1hcC5mZy5jYW52LCB4LCB5KTtcbn07XG5cbi8qIERyYXcgbGF5ZXIgY2FudmFzIHJlcGVhdGluZyBvbiBhbGwgc2lkZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X3JlcGVhdGluZ19sYXllciA9IGZ1bmN0aW9uKGNhbnYsIHgsIHkpIHtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCAtIGNhbnYud2lkdGgsIHkgLSBjYW52LmhlaWdodCk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHgsIHkgLSBjYW52LmhlaWdodCk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggKyBjYW52LndpZHRoLCB5IC0gY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4IC0gY2Fudi53aWR0aCwgeSk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggKyBjYW52LndpZHRoLCB5KTtcbiAgdGhpcy5jYW52YXMuY29udC5kcmF3SW1hZ2UoY2FudiwgeCAtIGNhbnYud2lkdGgsIHkgKyBjYW52LmhlaWdodCk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHgsIHkgKyBjYW52LmhlaWdodCk7XG4gIHRoaXMuY2FudmFzLmNvbnQuZHJhd0ltYWdlKGNhbnYsIHggKyBjYW52LndpZHRoLCB5ICsgY2Fudi5oZWlnaHQpO1xuICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShjYW52LCB4LCB5KTtcbn07XG5cbi8qIERlc3Ryb3kgbGFuZCBvbiB0aGUgbWFwXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZGVzdHJveV9sYW5kID0gZnVuY3Rpb24oeCwgeSwgc2l6ZSkge1xuICB0aGlzLm1hcC5mZy5jb250LmJlZ2luUGF0aCgpO1xuICB0aGlzLm1hcC5mZy5jb250LmFyYyh4LCB5LCBzaXplLCAwLCAyICogcGkpO1xuICB0aGlzLm1hcC5mZy5jb250LmZpbGwoKTtcbn07XG5cbi8qIEdldCBhIHBpZWNlIG9mIGxhbmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5nZXRfbGFuZF9ibG9jayA9IGZ1bmN0aW9uKHgsIHksIHcsIGgpIHtcbiAgdmFyIGNhbnYgPSBlbGVtZW50KHsgdHlwZTogXCJjYW52YXNcIiB9KTtcbiAgdmFyIGNvbnQgPSBjYW52LmdldENvbnRleHQoXCIyZFwiKTtcbiAgY2Fudi53aWR0aCA9IHc7XG4gIGNhbnYuaGVpZ2h0ID0gaDtcbiAgY29udC5kcmF3SW1hZ2UodGhpcy5tYXAuZmcuY2FudiwgeCwgeSwgdywgaCwgMCwgMCwgdywgaCk7XG5cbiAgcmV0dXJuIGNhbnY7XG59O1xuXG4vKiBEcmF3IHBpZWNlIG9mIGxhbmRcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X2xhbmRfYmxvY2sgPSBmdW5jdGlvbih4LCB5LCBjYW52KSB7XG4gIHRoaXMubWFwLmZnLmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJub3JtYWxcIjtcbiAgdGhpcy5tYXAuZmcuY29udC5kcmF3SW1hZ2UoY2FudiwgeCwgeSk7XG4gIHRoaXMubWFwLmZnLmNvbnQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJkZXN0aW5hdGlvbi1vdXRcIjtcbn07XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBHYW1lXG4gICAgT2JqZWN0IE1lc3NhZ2VzXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuLyogRHJhdyB0aGUgbWVzc2FnZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X21lc3NhZ2VzID0gZnVuY3Rpb24oKSB7XG4gIC8vIGdvIHRocm91Z2ggbWVzc2FnZXNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIG1lc3NhZ2UgPSB0aGlzLm1lc3NhZ2VzW2ldO1xuXG4gICAgLy8gaW5jcmVtZW50IHRpbWVcbiAgICBtZXNzYWdlLnRpbWUrKztcbiAgICBpZiAobWVzc2FnZS50aW1lID4gNDApIHtcbiAgICAgIHRoaXMubWVzc2FnZXMuc3BsaWNlKGksIDEpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHNjcmVlbiBwb3NpdGlvbiBvZiBtZXNzYWdlXG4gICAgdmFyIHBvc2l0aW9uID0gdGhpcy5zY3JlZW5fcG9zaXRpb24obWVzc2FnZS54LCBtZXNzYWdlLnksIDUwKTtcblxuICAgIC8vIGlnbm9yZSB0b28gZmFyIGF3YXkgbWVzc2FnZXNcbiAgICBpZiAoIXBvc2l0aW9uLm9uX3NjcmVlbikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gZ28gdGhyb3VnaCBsYWJlbHNcbiAgICB2YXIgeCA9IHJvdW5kKHBvc2l0aW9uLnggLSBtZXNzYWdlLncgLyAyKSArIDAuNTtcbiAgICB2YXIgeSA9IHJvdW5kKHBvc2l0aW9uLnkgLSBtZXNzYWdlLmggLyAyKSAtIDMwLjUgLSBtZXNzYWdlLnRpbWU7XG5cbiAgICB0aGlzLmNhbnZhcy5jb250LnNhdmUoKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZSgwLCAwKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShtZXNzYWdlLmNhbnYsIHgsIHkpO1xuICAgIHRoaXMuY2FudmFzLmNvbnQucmVzdG9yZSgpO1xuICB9XG59O1xuXG4vKiBMb29rIGZvciBjaGFuZ2VzIGluIGhlYWx0aFxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmNyZWF0ZV9tZXNzYWdlID0gZnVuY3Rpb24ob2JqLCBjb2wsIHRleHQsIHNpemUsIHlfb2Zmc2V0KSB7XG4gIC8vIHNldCB1cCBjYW52YXNcbiAgdmFyIG1lc3NhZ2UgPSB7fTtcbiAgbWVzc2FnZS5jYW52ID0gZWxlbWVudCh7IHR5cGU6IFwiY2FudmFzXCIgfSk7XG4gIG1lc3NhZ2UuY29udCA9IG1lc3NhZ2UuY2Fudi5nZXRDb250ZXh0KFwiMmRcIik7XG5cbiAgLy8gZHJhdyB0ZXh0XG4gIHRleHQgPSBzdHJfc3BhY2UodGV4dCk7XG4gIG1lc3NhZ2UuY29udC5mb250ID0gc2l6ZSArIFwicHggT3JiaXRyb25cIjtcbiAgbWVzc2FnZS53ID0gcm91bmQobWVzc2FnZS5jb250Lm1lYXN1cmVUZXh0KHRleHQpLndpZHRoKSArIDg7XG4gIG1lc3NhZ2UuaCA9IHNpemUgKyA0O1xuICBtZXNzYWdlLmNhbnYud2lkdGggPSBtZXNzYWdlLnc7XG4gIG1lc3NhZ2UuY2Fudi5oZWlnaHQgPSBtZXNzYWdlLmg7XG4gIG1lc3NhZ2UuY29udC5mb250ID0gc2l6ZSArIFwicHggT3JiaXRyb25cIjtcbiAgLy8gbWVzc2FnZS5jb250LmZpbGxTdHlsZSA9IFwiIzAwMFwiO1xuICAvLyBtZXNzYWdlLmNvbnQuZmlsbFRleHQodGV4dCwgMy41LCBzaXplICsgMC41KTtcbiAgbWVzc2FnZS5jb250LmZpbGxTdHlsZSA9IGNvbDtcbiAgbWVzc2FnZS5jb250LmZpbGxUZXh0KHRleHQsIDMuNSwgc2l6ZSArIDAuNSk7XG5cbiAgLy8gc2V0IHBvc2l0aW9uXG4gIHZhciB5X29mZnNldCA9IHlfb2Zmc2V0IHx8IDA7XG4gIG1lc3NhZ2UueCA9IG9iai54O1xuICBtZXNzYWdlLnkgPSBvYmoueSArIHlfb2Zmc2V0O1xuICBtZXNzYWdlLnRpbWUgPSAwO1xuXG4gIC8vIGFkZCB0byBhcnJheVxuICB0aGlzLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG59O1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgR2FtZVxuICAgIFNwcml0ZXNcbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4vKiBSdW4gc3ByaXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmdhbWUucHJvdG90eXBlLmRyYXdfc3ByaXRlcyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnNwcml0ZXMgPSBbXTtcblxuICAvLyBvYmplY3RzXG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmNvcmUuc3RhdGUub2JqZWN0cykge1xuICAgIHZhciBvYmogPSB0aGlzLmNvcmUuc3RhdGUub2JqZWN0c1trZXldO1xuICAgIGlmIChvYmouaGlkZSA+IDApIHtcbiAgICAgIG9iai5oaWRlLS07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKG9iai50eXBlID09PSBcInBsYXllclwiKSB7XG4gICAgICB2YXIgcGxheWVyID0gdGhpcy5jb3JlLnN0YXRlLnBsYXllcnNbb2JqLnBsYXllcl9pZF07XG4gICAgICBpZiAocGxheWVyKSB7XG4gICAgICAgIGlmIChwbGF5ZXIuaGl0ID4gMCkge1xuICAgICAgICAgIHRoaXMuZHJhd19wbGF5ZXJfaGl0X3Nwcml0ZXMob2JqLCBwbGF5ZXIuaGl0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmRyYXdfcGxheWVyX3Nwcml0ZXMob2JqLCBwbGF5ZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgdmFyIGFyZ3MgPSB7XG4gICAgICBmcmFtZTogb2JqLmZyYW1lLFxuICAgICAgdHlwZTogb2JqLnNwcml0ZV9rZXksXG4gICAgICB4OiBvYmouZHgsXG4gICAgICB5OiBvYmouZHksXG4gICAgICBhbmdsZTogb2JqLmRpc3BsYXlfYW5nbGUsXG4gICAgICBhbmltYXRlOiBvYmouYW5pbWF0ZSxcbiAgICAgIGZsb2F0OiBvYmouYy5hbmltYXRpb24uYWlyX2Zsb2F0LFxuICAgICAgcmVwZWF0OiB0cnVlXG4gICAgfTtcbiAgICB0aGlzLnNwcml0ZXMudW5zaGlmdChhcmdzKTtcbiAgfVxuXG4gIC8vIGV4cGxvc2lvbnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZXhwbG9zaW9ucykge1xuICAgIHZhciBvYmogPSB0aGlzLmV4cGxvc2lvbnNba2V5XTtcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgIGZyYW1lOiBvYmouZnJhbWUsXG4gICAgICB0eXBlOiBvYmouc3ByaXRlLFxuICAgICAgeDogb2JqLngsXG4gICAgICB5OiBvYmoueSxcbiAgICAgIGFuaW1hdGU6IHRydWVcbiAgICB9O1xuICAgIHRoaXMuc3ByaXRlcy5wdXNoKGFyZ3MpO1xuICB9XG5cbiAgLy8gZGVjb3JhdGlvbnNcbiAgZm9yICh2YXIga2V5IGluIHRoaXMuZGVjb3JhdGlvbnMpIHtcbiAgICB2YXIgb2JqID0gdGhpcy5kZWNvcmF0aW9uc1trZXldO1xuICAgIHZhciBhcmdzID0ge1xuICAgICAgZnJhbWU6IG9iai5mcmFtZSxcbiAgICAgIHR5cGU6IG9iai5zcHJpdGUsXG4gICAgICB4OiBvYmoueCxcbiAgICAgIHk6IG9iai55LFxuICAgICAgYW5nbGU6IG9iai5hbmdsZSxcbiAgICAgIGFuaW1hdGU6IHRydWUsXG4gICAgICByZXBlYXQ6IG9iai5yZXBlYXRcbiAgICB9O1xuICAgIHRoaXMuc3ByaXRlcy51bnNoaWZ0KGFyZ3MpO1xuICB9XG5cbiAgLy8gZ2V0IGFycm93c1xuICB0aGlzLnJ1bl9hcnJvd3MoKTtcblxuICAvLyBkcmF3IHRoZW1cbiAgdGhpcy5kcmF3X3Nwcml0ZXNfY2FudigpO1xufTtcblxuLyogUGxheWVyIHNwcml0ZXNcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5nYW1lLnByb3RvdHlwZS5kcmF3X3BsYXllcl9zcHJpdGVzID0gZnVuY3Rpb24ob2JqLCBwbGF5ZXIpIHtcbiAgdmFyIHcgPVxuICAgIHRoaXMucGxheWVyX2lkID09PSBvYmoucGxheWVyX2lkID8gdGhpcy5jdXJyZW50X3dlYXBvbiA6IHBsYXllci53ZWFwb247XG4gIHZhciB3ZWFwb24gPSB0aGlzLmMud2VhcG9uc1t3XTtcblxuICAvLyBib2R5XG4gIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICBmcmFtZTogb2JqLmZyYW1lLFxuICAgIHR5cGU6IG9iai5zcHJpdGVfa2V5LFxuICAgIHg6IG9iai5keCxcbiAgICB5OiBvYmouZHksXG4gICAgYW5nbGU6IG9iai5kaXNwbGF5X2FuZ2xlLFxuICAgIGFuaW1hdGU6IG9iai5hbmltYXRlLFxuICAgIHJlcGVhdDogdHJ1ZVxuICB9KTtcblxuICAvLyBnZXQgaGVhZCBkaXJlY3Rpb24gYW5kIGFuZ2xlXG4gIHZhciBoZWFkX2RpciA9IG9iai5kaXJlY3Rpb247XG4gIGlmIChvYmouZ3JvdW5kZWQpIHtcbiAgICB2YXIgZGlmZiA9IG5fZGlmZihcbiAgICAgIG9iai5iYXJyZWxfYW5nbGUsXG4gICAgICBhbmdsZV9hZGQob2JqLmRpc3BsYXlfYW5nbGUsIDkwKSxcbiAgICAgIDAsXG4gICAgICAzNjBcbiAgICApO1xuICAgIGhlYWRfZGlyID0gZGlmZiA+PSAtMTgwICYmIGRpZmYgPCAwID8gXCJyaWdodFwiIDogXCJsZWZ0XCI7XG4gIH1cbiAgdmFyIGhlYWRfYW5nbGUgPVxuICAgIGhlYWRfZGlyID09PSBcInJpZ2h0XCIgPyBhbmdsZV9hZGQob2JqLmJhcnJlbF9hbmdsZSwgMTgwKSA6IG9iai5iYXJyZWxfYW5nbGU7XG5cbiAgLy8gd2VhcG9uc1xuICB2YXIgd2VhcG9uX3Nwcml0ZSA9IFwiXCI7XG4gIGlmICh3ZWFwb24gJiYgd2VhcG9uLnNwcml0ZSkge1xuICAgIHZhciB3ZWFwb25fc3ByaXRlID0gd2VhcG9uLnNwcml0ZTtcbiAgICB2YXIgd2VhcG9uX2ZyYW1lID0gMDtcbiAgICB2YXIgdGhyb3dpbmcgPSB3ZWFwb24uc3ByaXRlID09PSBcInRocm93XCI7XG5cbiAgICAvLyBqdXN0IGZpcmVkIHNwcml0ZXNcbiAgICBpZiAob2JqLmZpcmVfc3ByaXRlX2NvdW50KSB7XG4gICAgICB3ZWFwb25fc3ByaXRlID0gd2VhcG9uLmZpcmVfc3ByaXRlO1xuICAgICAgd2VhcG9uX2ZyYW1lID0gb2JqLmZpcmVfc3ByaXRlX2ZyYW1lO1xuICAgICAgdGhyb3dpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBhZGQgdGhlIHdlYXBvbiBzcHJpdGVcbiAgICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgICB0eXBlOiBcImFudC13ZWFwb24tXCIgKyB3ZWFwb25fc3ByaXRlICsgXCItXCIgKyBoZWFkX2RpcixcbiAgICAgIHg6IHRoaXMuY29yZS5tYXAubG9vcF94KG9iai5keCksXG4gICAgICB5OiB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkpLFxuICAgICAgZnJhbWU6IHdlYXBvbl9mcmFtZSxcbiAgICAgIGFuaW1hdGU6IHRydWUsXG4gICAgICByZXBlYXQ6IHRydWUsXG4gICAgICBhbmdsZTogaGVhZF9hbmdsZVxuICAgIH0pO1xuICB9XG5cbiAgLy8gaGVhZFxuICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgdHlwZTogXCJhbnQtaGVhZC1cIiArIGhlYWRfZGlyLFxuICAgIHg6IHRoaXMuY29yZS5tYXAubG9vcF94KG9iai5keCksXG4gICAgeTogdGhpcy5jb3JlLm1hcC5sb29wX3kob2JqLmR5KSxcbiAgICBhbmltYXRlOiB0cnVlLFxuICAgIHJlcGVhdDogdHJ1ZSxcbiAgICBhbmdsZTogaGVhZF9hbmdsZVxuICB9KTtcblxuICAvLyBhZGQgYSB0aHJvdyB3ZWFwb25cbiAgaWYgKHRocm93aW5nKSB7XG4gICAgdmFyIHRvYmogPSB0aGlzLmMub2JqZWN0c1t3ZWFwb24ub2JqZWN0XTtcbiAgICB2YXIgdHNwcml0ZSA9IHRvYmouYW5pbWF0aW9uLnNwcml0ZTtcbiAgICB2YXIgdG9mZl94ID0geHlfc3BlZWQob2JqLmJhcnJlbF9hbmdsZSwgLTE2KTtcbiAgICB2YXIgdG9mZl95ID0geHlfc3BlZWQoYW5nbGVfYWRkKGhlYWRfYW5nbGUsIDkwKSwgMTQpO1xuICAgIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICAgIHR5cGU6IHRzcHJpdGUsXG4gICAgICB4OiB0aGlzLmNvcmUubWFwLmxvb3BfeChvYmouZHggKyB0b2ZmX3gueCArIHRvZmZfeS54KSxcbiAgICAgIHk6IHRoaXMuY29yZS5tYXAubG9vcF95KG9iai5keSArIHRvZmZfeC55ICsgdG9mZl95LnkpLFxuICAgICAgYW5pbWF0ZTogZmFsc2UsXG4gICAgICBhbmdsZTogYW5nbGVfYWRkKG9iai5iYXJyZWxfYW5nbGUsIDkwKVxuICAgIH0pO1xuICB9XG5cbiAgLy8gLy8gc2V0IGNyb3NzaGFpclxuICAvLyBpZiAodGhpcy5wbGF5ZXJfaWQgPT09IG9iai5wbGF5ZXJfaWQpIHtcbiAgLy8gXHR2YXIgb2ZmeCA9IHh5X3NwZWVkKGFuZ2xlLCA1MCArIHdlYXBvbi5vZmZzZXRfeCk7XG4gIC8vIFx0dmFyIG9mZnkgPSB4eV9zcGVlZChvZmZzZXRfYW5nbGUsIDcpO1xuICAvLyBcdHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgLy8gXHRcdHR5cGU6IFwiY3Jvc3NoYWlyXCIsXG4gIC8vIFx0XHR4OiByb3VuZChvYmouZHggKyBvZmZ4LnggKyBvZmZ5LngpLFxuICAvLyBcdFx0eTogcm91bmQob2JqLmR5ICsgb2ZmeC55ICsgb2ZmeS55KSxcbiAgLy8gXHRcdGFuZ2xlOiBhbmdsZV9hZGQodGhpcy5jcm9zc2hhaXIsIDE4MClcbiAgLy8gXHR9KTtcbiAgLy8gfVxufTtcblxuLyogUGxheWVyIGhpdCBzcHJpdGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19wbGF5ZXJfaGl0X3Nwcml0ZXMgPSBmdW5jdGlvbihvYmosIGhpdCkge1xuICAvLyBib2R5XG4gIHRoaXMuc3ByaXRlcy5wdXNoKHtcbiAgICBmcmFtZTogb2JqLmZyYW1lLFxuICAgIHR5cGU6IGhpdCA8IDE1ID8gXCJhbnQtYm9keS1haXItbGVmdFwiIDogXCJhbnQtYm9keS1oaXRcIixcbiAgICB4OiBvYmouZHgsXG4gICAgeTogb2JqLmR5LFxuICAgIGFuZ2xlOiBvYmouZGlzcGxheV9hbmdsZSxcbiAgICBhbmltYXRlOiBvYmouYW5pbWF0ZSxcbiAgICByZXBlYXQ6IHRydWVcbiAgfSk7XG5cbiAgLy8gaGVhZFxuICB0aGlzLnNwcml0ZXMucHVzaCh7XG4gICAgdHlwZTogaGl0IDwgMTUgPyBcImFudC1oZWFkLWxlZnRcIiA6IFwiYW50LWhlYWQtaGl0XCIsXG4gICAgeDogdGhpcy5jb3JlLm1hcC5sb29wX3gob2JqLmR4KSxcbiAgICB5OiB0aGlzLmNvcmUubWFwLmxvb3BfeShvYmouZHkpLFxuICAgIGFuaW1hdGU6IHRydWUsXG4gICAgcmVwZWF0OiB0cnVlLFxuICAgIGFuZ2xlOiBvYmouZGlzcGxheV9hbmdsZVxuICB9KTtcbn07XG5cbi8qIERyYXcgc3ByaXRlcyBvbiB0aGUgY2FudmFzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZ2FtZS5wcm90b3R5cGUuZHJhd19zcHJpdGVzX2NhbnYgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNwcml0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc3ByaXRlID0gdGhpcy5zcHJpdGVzW2ldO1xuXG4gICAgLy8gZ2V0IHBvc2l0aW9uIG9uIHNjcmVlblxuICAgIHZhciBzY3JlZW5fcG9zaXRpb24gPSB0aGlzLnNjcmVlbl9wb3NpdGlvbihzcHJpdGUueCwgc3ByaXRlLnksIDQ4KTtcbiAgICBpZiAoIXNjcmVlbl9wb3NpdGlvbi5vbl9zY3JlZW4pIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBzcHJpdGUga2V5XG4gICAgdmFyIHNwcml0ZV9rZXkgPSBzcHJpdGUudHlwZTtcbiAgICB2YXIgYW5pbWF0aW9uID0gdGhpcy5jLmFuaW1hdGlvbnNbc3ByaXRlX2tleV07XG4gICAgaWYgKGFuaW1hdGlvbikge1xuICAgICAgc3ByaXRlX2tleSA9IGFuaW1hdGlvblswXTtcbiAgICAgIGlmIChzcHJpdGUuYW5pbWF0ZSkge1xuICAgICAgICB2YXIgZnJhbWUgPSBzcHJpdGUuZnJhbWUgfHwgMDtcbiAgICAgICAgZnJhbWUgPSBmbG9vcigodGhpcy5jb3JlLnN0YXRlLmZyYW1lIC0gZnJhbWUpIC8gMik7XG4gICAgICAgIGlmIChzcHJpdGUucmVwZWF0KSB7XG4gICAgICAgICAgZnJhbWUgPSBmcmFtZSAlIGFuaW1hdGlvbi5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgc3ByaXRlX2tleSA9IGFuaW1hdGlvbltmcmFtZV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZ2V0IHNwcml0ZSByZWZlcmVuY2UgcG9zaXRpb25zXG4gICAgdmFyIHNwcml0ZV9yZWYgPSB0aGlzLmMuc3ByaXRlc1tzcHJpdGVfa2V5XTtcbiAgICBpZiAoIXNwcml0ZV9yZWYpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIGdldCBuZXcgcG9zaXRpb24gdG8gZHJhdyBvblxuICAgIHZhciBzaXplID0gc3ByaXRlX3JlZi5zaXplO1xuICAgIHZhciBwb3MgPSAtKHNpemUgLyAyKTtcblxuICAgIC8vIGZsb2F0IGVmZmVjdFxuICAgIHZhciB5X2FkZCA9IDA7XG4gICAgaWYgKHNwcml0ZS5mbG9hdCkge1xuICAgICAgeV9hZGQgPSBjb3MoKHRoaXMuY29yZS5zdGF0ZS5mcmFtZSAtIHNwcml0ZS5mcmFtZSkgLyA0KSAqIDI7XG4gICAgfVxuXG4gICAgLy8gZHJhdyBpdFxuICAgIHRoaXMuY2FudmFzLmNvbnQuc2F2ZSgpO1xuICAgIHRoaXMuY2FudmFzLmNvbnQudHJhbnNsYXRlKHNjcmVlbl9wb3NpdGlvbi54LCBzY3JlZW5fcG9zaXRpb24ueSArIHlfYWRkKTtcbiAgICBpZiAoc3ByaXRlLmFuZ2xlICE9PSAwKSB7XG4gICAgICB0aGlzLmNhbnZhcy5jb250LnJvdGF0ZSgoc3ByaXRlLmFuZ2xlICogTWF0aC5QSSkgLyAxODApO1xuICAgIH1cbiAgICB0aGlzLmNhbnZhcy5jb250LmRyYXdJbWFnZShcbiAgICAgIHRoaXMuaW1nLnNwcml0ZXMsXG4gICAgICBzcHJpdGVfcmVmLngsXG4gICAgICBzcHJpdGVfcmVmLnksXG4gICAgICBzaXplLFxuICAgICAgc2l6ZSxcbiAgICAgIHBvcyxcbiAgICAgIHBvcyxcbiAgICAgIHNpemUsXG4gICAgICBzaXplXG4gICAgKTtcbiAgICB0aGlzLmNhbnZhcy5jb250LnRyYW5zbGF0ZShcbiAgICAgIC1zY3JlZW5fcG9zaXRpb24ueCxcbiAgICAgIC0oc2NyZWVuX3Bvc2l0aW9uLnkgKyB5X2FkZClcbiAgICApO1xuICAgIHRoaXMuY2FudmFzLmNvbnQucmVzdG9yZSgpO1xuICB9XG59O1xuIl19
